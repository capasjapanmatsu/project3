var e=Object.defineProperty,s=Object.defineProperties,a=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,n=(s,a,t)=>a in s?e(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t,i=(e,s)=>{for(var a in s||(s={}))r.call(s,a)&&n(e,a,s[a]);if(t)for(var a of t(s))l.call(s,a)&&n(e,a,s[a]);return e},c=(e,t)=>s(e,a(t)),o=(e,s,a)=>new Promise((t,r)=>{var l=e=>{try{i(a.next(e))}catch(s){r(s)}},n=e=>{try{i(a.throw(e))}catch(s){r(s)}},i=e=>e.done?t(e.value):Promise.resolve(e.value).then(l,n);i((a=a.apply(e,s)).next())});import{u as d,s as m,j as x,B as h,C as u}from"./index.Drgpoyph.js";import{r as p}from"./vendor.CKEClKZl.js";import{c as b,u as g,L as j}from"./router.B_7Atevv.js";import{I as _}from"./Input.CUuxlVXM.js";import{n as f,F as v,ai as y,aj as N,a as w,b as k,X as q,A as O,z as S,g as C,V as $,ak as E,Q as L,Y as P,G as I}from"./ui.C72fRZ1L.js";import"./supabase.X3H3st79.js";const T={overview:{label:"施設全景",description:"ドッグランの全体が見渡せる写真",icon:f,required:!0},entrance:{label:"入口",description:"入口の様子がわかる写真",icon:k,required:!0},gate:{label:"ゲート",description:"ドッグランのゲート（入退場管理）の写真",icon:w,required:!0},large_dog_area:{label:"大型犬エリア",description:"大型犬用のエリアの写真",icon:f,required:!1,conditionalOn:"large_dog_area"},small_dog_area:{label:"小型犬エリア",description:"小型犬用のエリアの写真",icon:f,required:!1,conditionalOn:"small_dog_area"},private_booth:{label:"プライベートブース",description:"プライベートブースの内部と外観",icon:f,required:!1,conditionalOn:"private_booths"},parking:{label:"駐車場",description:"駐車場の様子がわかる写真",icon:N,required:!1,conditionalOn:"facilities.parking"},shower:{label:"シャワー設備",description:"シャワー設備の写真",icon:y,required:!1,conditionalOn:"facilities.shower"},restroom:{label:"トイレ",description:"トイレ設備の写真",icon:v,required:!1,conditionalOn:"facilities.restroom"},agility:{label:"アジリティ設備",description:"アジリティ設備の写真",icon:f,required:!1,conditionalOn:"facilities.agility"},rest_area:{label:"休憩スペース",description:"休憩スペースの写真",icon:f,required:!1,conditionalOn:"facilities.rest_area"},water_station:{label:"給水設備",description:"給水設備の写真",icon:f,required:!1,conditionalOn:"facilities.water_station"}};function D(){const{parkId:e}=b(),{user:s}=d(),a=g(),[t,r]=p.useState(null),[l,n]=p.useState([]),[y,N]=p.useState(!0),[k,D]=p.useState(!1),[B,G]=p.useState(""),[z,A]=p.useState(""),[Q,U]=p.useState(null),[J,R]=p.useState("images"),[W,V]=p.useState({bank_name:"",bank_code:"",branch_name:"",branch_code:"",account_type:"ordinary",account_number:"",account_holder_name:""}),[Y,H]=p.useState(!1),[K,X]=p.useState(""),[Z,ee]=p.useState(""),[se,ae]=p.useState(!1),[te,re]=p.useState("");p.useEffect(()=>{s&&e?le():a("/owner-dashboard")},[s,e,a]);const le=()=>o(this,null,function*(){try{N(!0);const{data:t,error:l}=yield m.from("dog_parks").select("*").eq("id",e).eq("owner_id",null==s?void 0:s.id).single();if(l)throw l;if(!t)return void a("/owner-dashboard");r(t);const{data:i,error:c}=yield m.from("dog_park_facility_images").select("*").eq("park_id",e),o=Object.entries(T).filter(([,e])=>{var s,a;if(e.required)return!0;if(e.conditionalOn&&t){const r=e.conditionalOn.split(".");if(1===r.length)return null!=(s=t[r[0]])&&s;if(2===r.length){const e=t[r[0]];if(e&&"object"==typeof e)return null!=(a=e[r[1]])&&a}}return!1}).map(([e])=>e).map(e=>{var s;const a=(i||[]).find(s=>s.image_type===e);return{id:null==a?void 0:a.id,image_type:e,image_url:null==a?void 0:a.image_url,is_approved:null!=(s=null==a?void 0:a.is_approved)?s:null,admin_notes:null==a?void 0:a.admin_notes}});n(o);const{data:d,error:x}=yield m.rpc("get_owner_bank_account");!x&&d&&d.length>0&&V({id:d[0].id,bank_name:d[0].bank_name,bank_code:d[0].bank_code,branch_name:d[0].branch_name,branch_code:d[0].branch_code,account_type:d[0].account_type,account_number:d[0].account_number,account_holder_name:d[0].account_holder_name})}catch(t){G(t.message||"エラーが発生しました")}finally{N(!1)}}),ne=s=>o(this,null,function*(){const a=l.find(e=>e.image_type===s);if(a&&a.file)try{n(e=>e.map(e=>e.image_type===s?c(i({},e),{uploading:!0,error:void 0}):e));const t=a.file.name.split(".").pop(),r=`${e}/${s}_${Date.now()}.${t}`,{error:l}=yield m.storage.from("dog-park-images").upload(r,a.file);if(l)throw l;const{data:{publicUrl:o}}=m.storage.from("dog-park-images").getPublicUrl(r);if(a.id){const{error:e}=yield m.from("dog_park_facility_images").update({image_url:o,is_approved:null,updated_at:(new Date).toISOString()}).eq("id",a.id);if(e)throw e}else{const{error:a}=yield m.from("dog_park_facility_images").insert({park_id:e,image_type:s,image_url:o});if(a)throw a}yield le();const d=T[s],x=(null==d?void 0:d.label)||s;A(`${x}の画像をアップロードしました`),setTimeout(()=>A(""),3e3)}catch(t){n(e=>e.map(e=>e.image_type===s?c(i({},e),{uploading:!1,error:"アップロードに失敗しました"}):e))}}),ie=e=>o(this,null,function*(){if(e)try{const{error:s}=yield m.from("dog_park_facility_images").delete().eq("id",e);if(s)throw s;yield le(),A("画像を削除しました"),setTimeout(()=>A(""),3e3)}catch(s){G("画像の削除に失敗しました"),setTimeout(()=>G(""),3e3)}});return y?x.jsx("div",{className:"flex justify-center items-center h-64",children:x.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):Q?x.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50",children:x.jsxs("div",{className:"relative max-w-4xl w-full",children:[x.jsx("button",{onClick:()=>U(null),className:"absolute top-2 right-2 p-2 bg-white bg-opacity-90 shadow-lg rounded-full text-gray-800 hover:bg-opacity-100 transition-all",children:x.jsx(q,{className:"w-6 h-6"})}),x.jsx("img",{src:Q,alt:"画像プレビュー",className:"max-h-[80vh] max-w-full mx-auto rounded-lg",onError:e=>{e.currentTarget.src="https://via.placeholder.com/800x600?text=Image+Not+Available"}})]})}):t?"first_stage_passed"!==t.status&&"second_stage_waiting"!==t.status&&"second_stage_review"!==t.status?x.jsxs("div",{className:"max-w-4xl mx-auto",children:[x.jsx("div",{className:"mb-6",children:x.jsxs(j,{to:"/owner-dashboard",className:"flex items-center text-blue-600 hover:text-blue-800",children:[x.jsx(S,{className:"w-4 h-4 mr-2"}),"ダッシュボードに戻る"]})}),x.jsxs(u,{className:"text-center py-8",children:[x.jsx(O,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),x.jsx("h2",{className:"text-2xl font-bold mb-2",children:"このドッグランは現在第二審査の対象ではありません"}),x.jsxs("p",{className:"text-gray-600 mb-4",children:["pending"===t.status&&"第一審査が完了するまでお待ちください。","smart_lock_testing"===t.status&&"スマートロック実証検査中です。管理者からの連絡をお待ちください。","approved"===t.status&&"このドッグランは既に承認されています。","rejected"===t.status&&"審査が却下されました。詳細はダッシュボードでご確認ください。"]}),x.jsx(j,{to:"/owner-dashboard",children:x.jsx(h,{children:"ダッシュボードに戻る"})})]})]}):x.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[x.jsx("div",{className:"flex items-center space-x-4 mb-6",children:x.jsxs(j,{to:"/owner-dashboard",className:"flex items-center text-blue-600 hover:text-blue-800",children:[x.jsx(S,{className:"w-4 h-4 mr-2"}),"ダッシュボードに戻る"]})}),x.jsxs("div",{className:"text-center mb-8",children:[x.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-4 flex items-center justify-center",children:[x.jsx(f,{className:"w-8 h-8 text-blue-600 mr-3"}),t.name,"の第二審査"]}),x.jsx("p",{className:"text-lg text-gray-600",children:"施設の詳細画像と振込先情報を登録して審査を完了させましょう"})]}),x.jsx(u,{className:"bg-blue-50 border-blue-200",children:x.jsxs("div",{className:"flex items-start space-x-3",children:[x.jsx(v,{className:"w-6 h-6 text-blue-600 mt-1"}),x.jsxs("div",{children:[x.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"審査ステータス"}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 text-sm text-blue-800",children:[x.jsxs("div",{className:"flex items-center space-x-2",children:[x.jsx("div",{className:"w-6 h-6 bg-green-600 text-white rounded-full flex items-center justify-center text-xs font-bold",children:"1"}),x.jsxs("div",{children:[x.jsx("span",{className:"font-medium",children:"第一審査"}),x.jsx("p",{className:"text-xs text-green-600",children:"完了"})]})]}),x.jsxs("div",{className:"flex items-center space-x-2",children:[x.jsx("div",{className:`w-6 h-6 ${"second_stage_review"===t.status?"bg-green-600":"bg-blue-600"} text-white rounded-full flex items-center justify-center text-xs font-bold`,children:"2"}),x.jsxs("div",{children:[x.jsx("span",{className:"font-medium",children:"第二審査"}),x.jsxs("p",{className:"text-xs text-blue-600",children:["first_stage_passed"===t.status&&"画像アップロード中","second_stage_waiting"===t.status&&"申請準備中","second_stage_review"===t.status&&"審査中"]})]})]}),x.jsxs("div",{className:"flex items-center space-x-2",children:[x.jsx("div",{className:"w-6 h-6 bg-gray-400 text-white rounded-full flex items-center justify-center text-xs font-bold",children:"3"}),x.jsxs("div",{children:[x.jsx("span",{className:"font-medium",children:"QR実証検査"}),x.jsx("p",{className:"text-xs text-gray-600",children:"未実施"})]})]}),x.jsxs("div",{className:"flex items-center space-x-2",children:[x.jsx("div",{className:"w-6 h-6 bg-gray-400 text-white rounded-full flex items-center justify-center text-xs font-bold",children:"4"}),x.jsxs("div",{children:[x.jsx("span",{className:"font-medium",children:"運営開始"}),x.jsx("p",{className:"text-xs text-gray-600",children:"未完了"})]})]})]})]})]})}),B&&x.jsxs("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4 flex items-start",children:[x.jsx(O,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),x.jsx("p",{children:B})]}),z&&x.jsxs("div",{className:"bg-green-100 border border-green-300 text-green-800 rounded-lg p-4 flex items-start",children:[x.jsx(C,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),x.jsx("p",{children:z})]}),x.jsx(u,{className:"bg-orange-50 border-orange-200",children:x.jsxs("div",{className:"flex items-start space-x-3",children:[x.jsx(w,{className:"w-6 h-6 text-orange-600 mt-1"}),x.jsxs("div",{className:"flex-1",children:[x.jsx("h3",{className:"font-semibold text-orange-900 mb-2",children:"スマートロック購入確認"}),x.jsx("p",{className:"text-sm text-orange-800 mb-4",children:"第二審査に進む前に、スマートロックの購入と設置が完了していることを確認してください。"}),x.jsxs("div",{className:"space-y-3",children:[x.jsxs("div",{className:"flex items-center space-x-3",children:[x.jsx("input",{type:"checkbox",id:"smartLockPurchased",checked:se,onChange:e=>{ae(e.target.checked),re("")},className:"w-5 h-5 text-orange-600 rounded border-gray-300 focus:ring-orange-500"}),x.jsx("label",{htmlFor:"smartLockPurchased",className:"text-sm font-medium text-orange-900",children:"スマートロックを購入し、設置を完了しました"})]}),te&&x.jsx("div",{className:"text-sm text-red-600 bg-red-50 p-2 rounded",children:te}),x.jsxs("div",{className:"text-xs text-orange-700 space-y-1",children:[x.jsx("p",{children:"• スマートロックはペットショップで購入できます"}),x.jsx("p",{children:"• 設置完了後、動作確認を行ってください"}),x.jsx("p",{children:"• 第二審査では実際の設置状況を確認します"})]})]})]})]})}),x.jsxs("div",{className:"flex space-x-4 border-b",children:[x.jsxs("button",{className:"px-4 py-2 font-medium "+("images"===J?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>R("images"),children:[x.jsx($,{className:"w-4 h-4 inline mr-2"}),"施設画像"]}),x.jsxs("button",{className:"px-4 py-2 font-medium "+("bank"===J?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>R("bank"),children:[x.jsx(M,{className:"w-4 h-4 inline mr-2"}),"振込先情報"]})]}),"images"===J&&x.jsxs(u,{children:[x.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[x.jsx($,{className:"w-6 h-6 text-blue-600 mr-2"}),"施設画像のアップロード"]}),x.jsxs("div",{className:"space-y-6",children:[x.jsx("div",{className:"bg-yellow-50 p-4 rounded-lg",children:x.jsxs("div",{className:"flex items-start space-x-2",children:[x.jsx(O,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),x.jsxs("div",{className:"text-sm text-yellow-800",children:[x.jsx("p",{className:"font-medium mb-1",children:"画像アップロードのガイドライン"}),x.jsxs("ul",{className:"space-y-1",children:[x.jsx("li",{children:"• 鮮明で明るい画像を選んでください"}),x.jsx("li",{children:"• 施設の特徴がよくわかる角度から撮影してください"}),x.jsx("li",{children:"• 画像サイズは10MB以下にしてください"}),x.jsx("li",{children:"• JPG、PNG、GIF形式のみ対応しています"}),x.jsx("li",{children:"• 必須項目（*）は必ずアップロードしてください"})]})]})]})}),x.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:l.map(e=>{var s,a,t,r;const l=T[e.image_type],o=(null==l?void 0:l.icon)||f,d=(null==l?void 0:l.required)||!1;let m=null;if(null!==(null!=(s=e.is_approved)?s:null)&&e.image_url){const s=!0===(u=null!=(a=e.is_approved)?a:null)?{icon:C,color:"text-green-600",label:"承認済み"}:!1===u?{icon:q,color:"text-red-600",label:"却下"}:{icon:F,color:"text-yellow-600",label:"審査中"},t=s.icon;m=x.jsxs("div",{className:`flex items-center space-x-1 ${s.color}`,children:[x.jsx(t,{className:"w-4 h-4"}),x.jsx("span",{className:"text-xs",children:s.label})]})}var u;return x.jsxs("div",{className:"border rounded-lg p-4 relative",children:[x.jsxs("div",{className:"flex items-center justify-between mb-3",children:[x.jsxs("div",{className:"flex items-center space-x-2",children:[x.jsx(o,{className:"w-5 h-5 text-blue-600"}),x.jsxs("h3",{className:"font-medium",children:[(null==l?void 0:l.label)||e.image_type,d&&x.jsx("span",{className:"text-red-600 ml-1",children:"*"})]})]}),m]}),x.jsx("p",{className:"text-sm text-gray-600 mb-3",children:(null==l?void 0:l.description)||"画像をアップロードしてください"}),e.image_url?x.jsxs("div",{className:"relative",children:[x.jsx("div",{className:"h-40 bg-gray-100 rounded-lg overflow-hidden cursor-pointer",onClick:()=>U(e.image_url||null),children:x.jsx("img",{src:e.image_url,alt:(null==l?void 0:l.label)||e.image_type,className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://via.placeholder.com/400x300?text=Image+Not+Available"}})}),x.jsxs("div",{className:"absolute top-2 right-2 flex space-x-2",children:[x.jsx("button",{onClick:()=>U(e.image_url||null),className:"p-1 bg-white rounded-full shadow hover:bg-gray-100",children:x.jsx(E,{className:"w-4 h-4 text-blue-600"})}),x.jsx("button",{onClick:()=>ie(e.id),className:"p-1 bg-white rounded-full shadow hover:bg-gray-100",disabled:!0===(null!=(t=e.is_approved)?t:null),children:x.jsx(L,{className:"w-4 h-4 "+(!0===(null!=(r=e.is_approved)?r:null)?"text-gray-400":"text-red-600")})})]}),!1===e.is_approved&&e.admin_notes&&x.jsxs("div",{className:"mt-2 p-2 bg-red-50 rounded text-sm text-red-800",children:[x.jsx("p",{className:"font-medium",children:"却下理由:"}),x.jsx("p",{children:e.admin_notes})]})]}):x.jsxs("div",{className:"space-y-3",children:[x.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-blue-500 transition-colors",children:[x.jsx("input",{type:"file",id:`image-${e.image_type}`,accept:"image/*",className:"hidden",onChange:s=>{var a;const t=null==(a=s.target.files)?void 0:a[0];t&&((e,s)=>{n(a=>a.map(a=>a.image_type===e?c(i({},a),{file:s,error:void 0}):a))})(e.image_type,t)}}),x.jsxs("label",{htmlFor:`image-${e.image_type}`,className:"cursor-pointer flex flex-col items-center",children:[x.jsx(P,{className:"w-8 h-8 text-gray-400 mb-2"}),x.jsx("span",{className:"text-sm text-gray-600",children:"クリックして画像を選択"})]})]}),e.file&&x.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-2 rounded",children:[x.jsx("span",{className:"text-sm truncate",children:e.file.name}),x.jsx(h,{size:"sm",onClick:()=>ne(e.image_type),isLoading:!!e.uploading,children:"アップロード"})]}),e.error&&x.jsx("p",{className:"text-sm text-red-600",children:e.error})]})]},e.image_type)})})]})]}),"bank"===J&&x.jsxs(u,{children:[x.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[x.jsx(M,{className:"w-6 h-6 text-blue-600 mr-2"}),"振込先情報"]}),K&&x.jsxs("div",{className:"mb-6 p-4 bg-red-50 rounded-lg flex items-start",children:[x.jsx(O,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),x.jsx("p",{className:"text-red-800",children:K})]}),Z&&x.jsxs("div",{className:"mb-6 p-4 bg-green-50 rounded-lg flex items-start",children:[x.jsx(C,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),x.jsx("p",{className:"text-green-800",children:Z})]}),x.jsx("form",{onSubmit:e=>o(this,null,function*(){e.preventDefault(),H(!0),X(""),ee("");try{if(!W.bank_name)throw new Error("銀行名を入力してください");if(!W.bank_code)throw new Error("銀行コードを入力してください");if(!W.branch_name)throw new Error("支店名を入力してください");if(!W.branch_code)throw new Error("支店コードを入力してください");if(!W.account_number)throw new Error("口座番号を入力してください");if(!W.account_holder_name)throw new Error("口座名義を入力してください");if(!/^\d{4}$/.test(W.bank_code))throw new Error("銀行コードは4桁の数字で入力してください");if(!/^\d{3}$/.test(W.branch_code))throw new Error("支店コードは3桁の数字で入力してください");if(!/^\d{7}$/.test(W.account_number))throw new Error("口座番号は7桁の数字で入力してください");const{error:e}=yield m.rpc("update_owner_bank_account",{bank_name_param:W.bank_name,bank_code_param:W.bank_code,branch_name_param:W.branch_name,branch_code_param:W.branch_code,account_type_param:W.account_type,account_number_param:W.account_number,account_holder_name_param:W.account_holder_name});if(e)throw e;ee("振込先情報を保存しました"),setTimeout(()=>{ee("")},3e3)}catch(s){X(s.message||"振込先情報の保存に失敗しました")}finally{H(!1)}}),children:x.jsxs("div",{className:"space-y-6",children:[x.jsx("div",{className:"bg-yellow-50 p-4 rounded-lg mb-6",children:x.jsxs("div",{className:"flex items-start space-x-3",children:[x.jsx(O,{className:"w-5 h-5 text-yellow-600 mt-0.5 flex-shrink-0"}),x.jsxs("div",{className:"text-sm text-yellow-800",children:[x.jsx("p",{className:"font-medium mb-1",children:"振込先情報について"}),x.jsxs("ul",{className:"space-y-1",children:[x.jsx("li",{children:"• 売上金の振込先となる銀行口座情報を入力してください"}),x.jsx("li",{children:"• 振込は毎月15日に前月分を一括で行います"}),x.jsx("li",{children:"• 振込手数料は当社負担です"}),x.jsx("li",{children:"• 振込金額が5,000円未満の場合は翌月に繰り越されます"}),x.jsx("li",{children:"• 口座名義は正確に入力してください（例：ヤマダ タロウ）"})]})]})]})}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[x.jsx(_,{label:"銀行名 *",value:W.bank_name,onChange:e=>V(c(i({},W),{bank_name:e.target.value})),placeholder:"例：三菱UFJ銀行",required:!0,icon:x.jsx(M,{className:"w-4 h-4 text-gray-500"})}),x.jsx(_,{label:"銀行コード（4桁） *",value:W.bank_code,onChange:e=>{const s=e.target.value.replace(/\D/g,"");V(c(i({},W),{bank_code:s}))},placeholder:"例：0005",maxLength:4,required:!0,helperText:"4桁の数字で入力してください"}),x.jsx(_,{label:"支店名 *",value:W.branch_name,onChange:e=>V(c(i({},W),{branch_name:e.target.value})),placeholder:"例：渋谷支店",required:!0}),x.jsx(_,{label:"支店コード（3桁） *",value:W.branch_code,onChange:e=>{const s=e.target.value.replace(/\D/g,"");V(c(i({},W),{branch_code:s}))},placeholder:"例：135",maxLength:3,required:!0,helperText:"3桁の数字で入力してください"}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"口座種別 *"}),x.jsxs("div",{className:"flex space-x-4",children:[x.jsxs("label",{className:"flex items-center space-x-2",children:[x.jsx("input",{type:"radio",checked:"ordinary"===W.account_type,onChange:()=>V(c(i({},W),{account_type:"ordinary"})),className:"form-radio text-blue-600"}),x.jsx("span",{children:"普通"})]}),x.jsxs("label",{className:"flex items-center space-x-2",children:[x.jsx("input",{type:"radio",checked:"checking"===W.account_type,onChange:()=>V(c(i({},W),{account_type:"checking"})),className:"form-radio text-blue-600"}),x.jsx("span",{children:"当座"})]})]})]}),x.jsx(_,{label:"口座番号（7桁） *",value:W.account_number,onChange:e=>{const s=e.target.value.replace(/\D/g,"");V(c(i({},W),{account_number:s}))},placeholder:"例：1234567",maxLength:7,required:!0,helperText:"7桁の数字で入力してください",icon:x.jsx(I,{className:"w-4 h-4 text-gray-500"})}),x.jsx("div",{className:"md:col-span-2",children:x.jsx(_,{label:"口座名義（カタカナ） *",value:W.account_holder_name,onChange:e=>V(c(i({},W),{account_holder_name:e.target.value})),placeholder:"例：ヤマダ タロウ",required:!0,helperText:"カタカナで入力してください（姓と名の間にスペース）"})})]}),x.jsx("div",{className:"flex justify-end",children:x.jsx(h,{type:"submit",isLoading:Y,children:"振込先情報を保存"})})]})})]}),x.jsx("div",{className:"mt-8 flex justify-end",children:x.jsx(h,{onClick:()=>o(this,null,function*(){try{if(D(!0),G(""),!se)return re("スマートロックの購入・設置完了をご確認ください"),void D(!1);const c=Object.entries(T).filter(([,e])=>{var s,a;if(e.required)return!0;if(e.conditionalOn&&t){const r=e.conditionalOn.split(".");if(1===r.length)return null!=(s=t[r[0]])&&s;if(2===r.length){const e=t[r[0]];if(e&&"object"==typeof e)return null!=(a=e[r[1]])&&a}}return!1}).map(([e])=>e).filter(e=>!l.some(s=>s.image_type===e&&s.image_url));if(c.length>0){const e=c.map(e=>{const s=T[e];return(null==s?void 0:s.label)||e}).join("、");return G(`以下の必要な画像がアップロードされていません: ${e}`),void D(!1)}if(!(W.bank_name&&W.bank_code&&W.branch_name&&W.branch_code&&W.account_number&&W.account_holder_name))return G("振込先情報を入力してください"),R("bank"),void D(!1);try{const{data:s,error:a}=yield m.from("dog_park_review_stages").select("id").eq("park_id",e).single();if(a&&a.code,s){const{error:s}=yield m.from("dog_park_review_stages").update({second_stage_submitted_at:(new Date).toISOString()}).eq("park_id",e)}else{const{error:s}=yield m.from("dog_park_review_stages").insert({park_id:e,second_stage_submitted_at:(new Date).toISOString()})}}catch(s){}try{const{error:s}=yield m.from("dog_parks").update({status:"second_stage_review"}).eq("id",e)}catch(r){}try{const{error:e}=yield m.rpc("update_owner_bank_account",{bank_name_param:W.bank_name,bank_code_param:W.bank_code,branch_name_param:W.branch_name,branch_code_param:W.branch_code,account_type_param:W.account_type,account_number_param:W.account_number,account_holder_name_param:W.account_holder_name})}catch(n){}try{const{error:s}=yield m.from("admin_notifications").insert([{type:"park_approval",title:"新しいドッグラン第二審査申請",message:`${null==t?void 0:t.name}の第二審査が申請されました。確認してください。`,data:{park_id:e},created_at:(new Date).toISOString()}])}catch(i){}A("第二審査の申請が完了しました。審査結果をお待ちください。"),yield le(),setTimeout(()=>{a("/owner-dashboard")},3e3)}catch(c){G("審査申請に失敗しました: "+c.message)}finally{D(!1)}}),isLoading:k,disabled:"second_stage_review"===t.status,className:"bg-blue-600 hover:bg-blue-700",children:"second_stage_review"===t.status?"審査中です":"第二審査を申請する"})}),x.jsx(u,{className:"bg-gray-50",children:x.jsxs("div",{className:"flex items-start space-x-3",children:[x.jsx(v,{className:"w-6 h-6 text-gray-600 mt-1"}),x.jsxs("div",{children:[x.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"審査プロセスについて"}),x.jsxs("div",{className:"text-sm text-gray-700 space-y-1",children:[x.jsx("p",{children:"• 第二審査では、施設の詳細画像と振込先情報を確認します"}),x.jsx("p",{children:"• 審査期間は通常3-5営業日です"}),x.jsx("p",{children:"• 画像に問題がある場合は再提出を求められることがあります"}),x.jsx("p",{children:"• 審査通過後、QRコード実証検査の日程調整を行います"}),x.jsx("p",{children:"• 実証検査完了後、一般公開となります"})]})]})]})})]}):x.jsxs("div",{className:"max-w-4xl mx-auto text-center py-12",children:[x.jsx(O,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),x.jsx("h2",{className:"text-2xl font-bold mb-2",children:"ドッグランが見つかりません"}),x.jsx("p",{className:"text-gray-600 mb-6",children:"指定されたドッグランが見つからないか、アクセス権限がありません。"}),x.jsx(j,{to:"/owner-dashboard",children:x.jsx(h,{children:"ダッシュボードに戻る"})})]})}function M({className:e}){return x.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,children:[x.jsx("path",{d:"M3 21h18"}),x.jsx("path",{d:"M3 10h18"}),x.jsx("path",{d:"M5 6l7-3 7 3"}),x.jsx("path",{d:"M4 10v11"}),x.jsx("path",{d:"M20 10v11"}),x.jsx("path",{d:"M8 14v3"}),x.jsx("path",{d:"M12 14v3"}),x.jsx("path",{d:"M16 14v3"})]})}function F({className:e}){return x.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,children:[x.jsx("circle",{cx:"12",cy:"12",r:"10"}),x.jsx("polyline",{points:"12 6 12 12 16 14"})]})}export{D as ParkRegistrationSecondStage};

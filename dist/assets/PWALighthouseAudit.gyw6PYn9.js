var e=(e,s,t)=>new Promise((a,i)=>{var n=e=>{try{r(t.next(e))}catch(s){i(s)}},l=e=>{try{r(t.throw(e))}catch(s){i(s)}},r=e=>e.done?a(e.value):Promise.resolve(e.value).then(n,l);r((t=t.apply(e,s)).next())});import{j as s,B as t,C as a}from"./index.Drgpoyph.js";import{r as i}from"./vendor.CKEClKZl.js";import{R as n,aU as l,g as r,e as c,D as o,k as m,a_ as d,h,f as x}from"./ui.C72fRZ1L.js";import"./router.B_7Atevv.js";import"./supabase.X3H3st79.js";const p=()=>{const[p,u]=i.useState(null),[j,g]=i.useState([]),[y,f]=i.useState(!1),[v,N]=i.useState("overview"),w=()=>e(void 0,null,function*(){f(!0);try{const e=yield b();u(e);const s=yield A();g(s)}catch(e){}finally{f(!1)}}),b=()=>e(void 0,null,function*(){yield new Promise(e=>setTimeout(e,2e3));return{performance:yield k(),accessibility:yield S(),bestPractices:yield W(),seo:yield P(),pwa:yield $()}}),k=()=>e(void 0,null,function*(){if("performance"in window&&performance.timing){const e=performance.timing,s=e.loadEventEnd-e.navigationStart,t=Math.max(0,Math.min(100,100-s/100));return{score:Math.round(t),displayValue:`${s}ms`,description:"ページの読み込み時間とパフォーマンス指標"}}return{score:85,displayValue:"1.2s",description:"ページの読み込み時間とパフォーマンス指標"}}),S=()=>e(void 0,null,function*(){let e=100,s=[];const t=document.querySelectorAll("img"),a=Array.from(t).filter(e=>!e.alt);a.length>0&&(e-=10,s.push(`${a.length}個の画像にalt属性がありません`));0===document.querySelectorAll("h1, h2, h3, h4, h5, h6").length&&(e-=15,s.push("見出し要素が見つかりません"));const i=document.querySelectorAll("a"),n=Array.from(i).filter(e=>{var s;return!(null==(s=e.textContent)?void 0:s.trim())});return n.length>0&&(e-=5,s.push(`${n.length}個のリンクにテキストがありません`)),{score:Math.max(0,e),displayValue:`${Math.max(0,e)}%`,description:s.length>0?s.join(", "):"アクセシビリティ要件を満たしています"}}),W=()=>e(void 0,null,function*(){let e=100,s=[];"https:"!==location.protocol&&"localhost"!==location.hostname&&(e-=20,s.push("HTTPS接続を使用していません"));document.querySelector('meta[http-equiv="Content-Security-Policy"]')||(e-=10,s.push("Content Security Policyが設定されていません"));const t=console.errors||[];return t.length>0&&(e-=15,s.push(`${t.length}個のJavaScriptエラーが発生しています`)),{score:Math.max(0,e),displayValue:`${Math.max(0,e)}%`,description:s.length>0?s.join(", "):"ベストプラクティスに従っています"}}),P=()=>e(void 0,null,function*(){var e;let s=100,t=[];const a=document.querySelector("title");a&&(null==(e=a.textContent)?void 0:e.trim())||(s-=20,t.push("titleタグが設定されていません"));document.querySelector('meta[name="description"]')||(s-=15,t.push("meta descriptionが設定されていません"));document.querySelector('meta[name="viewport"]')||(s-=10,t.push("viewportが設定されていません"));return document.documentElement.lang||(s-=5,t.push("html要素にlang属性が設定されていません")),{score:Math.max(0,s),displayValue:`${Math.max(0,s)}%`,description:t.length>0?t.join(", "):"SEO要件を満たしています"}}),$=()=>e(void 0,null,function*(){let e=0,s=[];try{(yield fetch("/manifest.json")).ok&&(e+=20,s.push("マニフェストファイル"))}catch(t){}if("serviceWorker"in navigator){(yield navigator.serviceWorker.getRegistration())&&(e+=30,s.push("Service Worker"))}if("caches"in window){(yield caches.keys()).length>0&&(e+=25,s.push("オフライン対応"))}return window.matchMedia("(display-mode: standalone)").matches?(e+=25,s.push("インストール可能")):e+=10,{score:e,displayValue:`${s.length}/4 機能`,description:`実装済み: ${s.join(", ")}`}}),A=()=>e(void 0,null,function*(){const e=[];try{const s=yield fetch("/manifest.json");if(s.ok){const t=yield s.json();e.push({id:"manifest-exists",name:"Webアプリマニフェスト",description:"manifest.jsonファイルが存在し、適切に設定されている",status:"compliant",score:100,details:"✓ マニフェストファイルが正常に読み込まれました",recommendation:"引き続き適切に管理してください"});const a=["name","short_name","start_url","display","icons"].filter(e=>!t[e]);0===a.length?e.push({id:"manifest-complete",name:"マニフェスト完全性",description:"マニフェストに必要なフィールドがすべて設定されている",status:"compliant",score:100,details:"✓ すべての必須フィールドが設定されています"}):e.push({id:"manifest-incomplete",name:"マニフェスト完全性",description:"マニフェストに必要なフィールドがすべて設定されている",status:"non-compliant",score:60,details:`✗ 不足フィールド: ${a.join(", ")}`,recommendation:"不足しているフィールドを追加してください"})}else e.push({id:"manifest-missing",name:"Webアプリマニフェスト",description:"manifest.jsonファイルが存在し、適切に設定されている",status:"non-compliant",score:0,details:"✗ マニフェストファイルが見つかりません",recommendation:"manifest.jsonファイルを作成してください"})}catch(a){e.push({id:"manifest-error",name:"Webアプリマニフェスト",description:"manifest.jsonファイルが存在し、適切に設定されている",status:"non-compliant",score:0,details:"✗ マニフェストファイルの読み込みに失敗しました",recommendation:"マニフェストファイルの構文を確認してください"})}if("serviceWorker"in navigator)try{(yield navigator.serviceWorker.getRegistration())?e.push({id:"service-worker",name:"Service Worker",description:"Service Workerが登録され、オフライン機能を提供している",status:"compliant",score:100,details:"✓ Service Workerが正常に登録されています"}):e.push({id:"service-worker-missing",name:"Service Worker",description:"Service Workerが登録され、オフライン機能を提供している",status:"non-compliant",score:0,details:"✗ Service Workerが登録されていません",recommendation:"Service Workerを実装してください"})}catch(a){e.push({id:"service-worker-error",name:"Service Worker",description:"Service Workerが登録され、オフライン機能を提供している",status:"non-compliant",score:0,details:"✗ Service Workerの確認中にエラーが発生しました",recommendation:"Service Workerの実装を確認してください"})}else e.push({id:"service-worker-unsupported",name:"Service Worker",description:"Service Workerが登録され、オフライン機能を提供している",status:"non-compliant",score:0,details:"✗ このブラウザはService Workerをサポートしていません",recommendation:"モダンブラウザでアクセスしてください"});const s="https:"===location.protocol||"localhost"===location.hostname;e.push({id:"https",name:"セキュア接続 (HTTPS)",description:"PWAはHTTPS接続で提供されている必要がある",status:s?"compliant":"non-compliant",score:s?100:0,details:s?"✓ セキュアな接続を使用しています":"✗ HTTPSを使用していません",recommendation:s?void 0:"HTTPSでアプリを提供してください"});const t=document.querySelector('meta[name="viewport"]');if(e.push({id:"responsive",name:"レスポンシブデザイン",description:"アプリが複数のデバイスサイズに対応している",status:t?"compliant":"non-compliant",score:t?100:0,details:t?"✓ ビューポートが適切に設定されています":"✗ ビューポートが設定されていません",recommendation:t?void 0:"ビューポートメタタグを追加してください"}),"caches"in window)try{const s=yield caches.keys();e.push({id:"offline",name:"オフライン機能",description:"アプリがオフラインでも動作する",status:s.length>0?"compliant":"non-compliant",score:s.length>0?100:0,details:s.length>0?`✓ ${s.length}個のキャッシュが設定されています`:"✗ キャッシュが設定されていません",recommendation:s.length>0?void 0:"キャッシュ戦略を実装してください"})}catch(a){e.push({id:"offline-error",name:"オフライン機能",description:"アプリがオフラインでも動作する",status:"unknown",score:0,details:"? キャッシュの確認中にエラーが発生しました",recommendation:"キャッシュ機能を確認してください"})}else e.push({id:"offline-unsupported",name:"オフライン機能",description:"アプリがオフラインでも動作する",status:"non-compliant",score:0,details:"✗ このブラウザはCache APIをサポートしていません",recommendation:"モダンブラウザでアクセスしてください"});return e}),q=e=>e>=90?"text-green-600":e>=70?"text-yellow-600":"text-red-600",T=e=>{switch(e){case"compliant":return s.jsx(r,{className:"h-5 w-5 text-green-500"});case"non-compliant":return s.jsx(x,{className:"h-5 w-5 text-red-500"});case"unknown":return s.jsx(m,{className:"h-5 w-5 text-yellow-500"})}};return i.useEffect(()=>{w()},[]),s.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"PWA Lighthouse 監査"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"Google Lighthouseスタイルの包括的なPWA監査を実行し、改善点を特定します。"}),s.jsxs(t,{onClick:w,disabled:y,className:"flex items-center gap-2 mx-auto",children:[s.jsx(n,{className:"h-4 w-4 "+(y?"animate-spin":"")}),y?"監査実行中...":"監査を再実行"]})]}),s.jsx("div",{className:"flex justify-center",children:s.jsx("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[{key:"overview",label:"概要",icon:s.jsx(l,{className:"h-4 w-4"})},{key:"requirements",label:"PWA要件",icon:s.jsx(r,{className:"h-4 w-4"})},{key:"suggestions",label:"改善提案",icon:s.jsx(c,{className:"h-4 w-4"})}].map(e=>s.jsxs("button",{onClick:()=>N(e.key),className:"flex items-center gap-2 px-4 py-2 rounded-md transition-colors "+(v===e.key?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"),children:[e.icon,e.label]},e.key))})}),"overview"===v&&p&&s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:Object.entries(p).map(([e,t])=>{return s.jsxs(a,{className:"p-6 text-center "+(i=t.score,i>=90?"bg-green-100":i>=70?"bg-yellow-100":"bg-red-100"),children:[s.jsx("div",{className:`text-3xl font-bold ${q(t.score)} mb-2`,children:t.score}),s.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1 capitalize",children:"bestPractices"===e?"Best Practices":"seo"===e?"SEO":"pwa"===e?"PWA":e}),s.jsx("div",{className:"text-xs text-gray-600",children:t.displayValue})]},e);var i})}),"requirements"===v&&s.jsx("div",{className:"space-y-4",children:j.map(e=>s.jsx(a,{className:"p-6",children:s.jsxs("div",{className:"flex items-start gap-4",children:[T(e.status),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:e.name}),void 0!==e.score&&s.jsxs("span",{className:`text-sm font-medium ${q(e.score)}`,children:[e.score,"/100"]})]}),s.jsx("p",{className:"text-gray-600 text-sm mb-3",children:e.description}),s.jsx("p",{className:"text-sm text-gray-700 mb-2",children:e.details}),e.recommendation&&s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-3",children:s.jsxs("p",{className:"text-sm text-blue-800",children:[s.jsx("strong",{children:"推奨事項:"})," ",e.recommendation]})})]})]})},e.id))}),"suggestions"===v&&s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs(a,{className:"p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[s.jsx(o,{className:"h-5 w-5"}),"インストール最適化"]}),s.jsxs("ul",{className:"space-y-3 text-sm",children:[s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx(r,{className:"h-4 w-4 text-green-500 mt-0.5"}),s.jsx("span",{children:"カスタムインストールプロンプトを実装"})]}),s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx(r,{className:"h-4 w-4 text-green-500 mt-0.5"}),s.jsx("span",{children:"アプリアイコンを複数サイズで提供"})]}),s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx(m,{className:"h-4 w-4 text-yellow-500 mt-0.5"}),s.jsx("span",{children:"スプラッシュスクリーン画像を追加"})]})]})]}),s.jsxs(a,{className:"p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[s.jsx(d,{className:"h-5 w-5"}),"オフライン機能強化"]}),s.jsxs("ul",{className:"space-y-3 text-sm",children:[s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx(r,{className:"h-4 w-4 text-green-500 mt-0.5"}),s.jsx("span",{children:"重要なページのプリキャッシュ"})]}),s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx(m,{className:"h-4 w-4 text-yellow-500 mt-0.5"}),s.jsx("span",{children:"オフライン状態の通知機能"})]}),s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx(m,{className:"h-4 w-4 text-yellow-500 mt-0.5"}),s.jsx("span",{children:"データ同期機能の実装"})]})]})]}),s.jsxs(a,{className:"p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[s.jsx(n,{className:"h-5 w-5"}),"パフォーマンス向上"]}),s.jsxs("ul",{className:"space-y-3 text-sm",children:[s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx(r,{className:"h-4 w-4 text-green-500 mt-0.5"}),s.jsx("span",{children:"リソースの圧縮とminify"})]}),s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx(m,{className:"h-4 w-4 text-yellow-500 mt-0.5"}),s.jsx("span",{children:"重要でないリソースの遅延読み込み"})]}),s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx(m,{className:"h-4 w-4 text-yellow-500 mt-0.5"}),s.jsx("span",{children:"CDNの活用"})]})]})]}),s.jsxs(a,{className:"p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[s.jsx(h,{className:"h-5 w-5"}),"ユーザー体験向上"]}),s.jsxs("ul",{className:"space-y-3 text-sm",children:[s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx(m,{className:"h-4 w-4 text-yellow-500 mt-0.5"}),s.jsx("span",{children:"プッシュ通知機能の実装"})]}),s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx(m,{className:"h-4 w-4 text-yellow-500 mt-0.5"}),s.jsx("span",{children:"バックグラウンド同期"})]}),s.jsxs("li",{className:"flex items-start gap-2",children:[s.jsx(m,{className:"h-4 w-4 text-yellow-500 mt-0.5"}),s.jsx("span",{children:"アプリ更新通知"})]})]})]})]}),y&&s.jsx(a,{className:"p-8",children:s.jsxs("div",{className:"text-center",children:[s.jsx(n,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-blue-500"}),s.jsx("p",{className:"text-gray-600",children:"Lighthouse監査を実行中..."}),s.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"パフォーマンス、アクセシビリティ、PWA要件などを総合的に分析しています"})]})})]})};export{p as default};

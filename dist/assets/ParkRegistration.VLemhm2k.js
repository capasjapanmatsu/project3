var e=Object.defineProperty,s=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,n=(s,a,r)=>a in s?e(s,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[a]=r,i=(e,s)=>{for(var a in s||(s={}))t.call(s,a)&&n(e,a,s[a]);if(r)for(var a of r(s))l.call(s,a)&&n(e,a,s[a]);return e},c=(e,r)=>s(e,a(r)),o=(e,s,a)=>new Promise(((r,t)=>{var l=e=>{try{i(a.next(e))}catch(s){t(s)}},n=e=>{try{i(a.throw(e))}catch(s){t(s)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(l,n);i((a=a.apply(e,s)).next())}));import{j as d,C as m,B as x,s as u,h,u as b}from"./index.oOj2R_C7.js";import{r as g,L as p,u as j}from"./router.icJHpBzt.js";import{X as y,A as f,a2 as N,ab as v,ac as w,C as k,ad as C,c as _,a as E,R as D,ae as O,H as R,h as S,n as A,a8 as P,F as L,f as F,O as $,j as I,_ as M,T as z}from"./ui.UnEvinBv.js";import{I as q}from"./Input.DeZ8m3vP.js";import"./vendor.D1SiiUJb.js";import"./supabase.CZ8ekJUM.js";const B=({type:e,className:s="w-6 h-6"})=>{switch(e){case"network":return d.jsx(E,{className:`${s} text-orange-600`});case"authentication":return d.jsx(_,{className:`${s} text-red-600`});case"authorization":return d.jsx(C,{className:`${s} text-red-600`});case"validation":return d.jsx(f,{className:`${s} text-yellow-600`});case"timeout":return d.jsx(k,{className:`${s} text-blue-600`});case"server":return d.jsx(w,{className:`${s} text-red-600`});case"not_found":return d.jsx(v,{className:`${s} text-gray-600`});case"storage":return d.jsx(v,{className:`${s} text-orange-600`});case"payment":return d.jsx(N,{className:`${s} text-purple-600`});default:return d.jsx(f,{className:`${s} text-gray-600`})}},Q=({error:e,onClear:s,onRetry:a,className:r="",showAsModal:t=!1})=>{if(g.useEffect((()=>{if(e&&"low"===e.severity&&"validation"===e.type){const e=setTimeout((()=>{s()}),5e3);return()=>clearTimeout(e)}}),[e,s]),!e)return null;const l=(e=>{switch(e){case"low":return{bg:"bg-yellow-50",border:"border-yellow-200",text:"text-yellow-800",button:"bg-yellow-600 hover:bg-yellow-700"};case"medium":return{bg:"bg-orange-50",border:"border-orange-200",text:"text-orange-800",button:"bg-orange-600 hover:bg-orange-700"};case"high":return{bg:"bg-red-50",border:"border-red-200",text:"text-red-800",button:"bg-red-600 hover:bg-red-700"};case"critical":return{bg:"bg-red-100",border:"border-red-300",text:"text-red-900",button:"bg-red-700 hover:bg-red-800"};default:return{bg:"bg-gray-50",border:"border-gray-200",text:"text-gray-800",button:"bg-gray-600 hover:bg-gray-700"}}})(e.severity),n=d.jsx("div",{className:`${l.bg} ${l.border} border rounded-lg p-4 ${r}`,children:d.jsxs("div",{className:"flex items-start space-x-3",children:[d.jsx(B,{type:e.type,className:"flex-shrink-0 mt-0.5"}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsxs("div",{className:"flex items-start justify-between",children:[d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:`text-sm font-medium ${l.text} mb-1`,children:"エラーが発生しました"}),d.jsx("p",{className:`text-sm ${l.text} mb-3`,children:e.userMessage}),!1]}),!t&&d.jsx("button",{onClick:s,className:`ml-2 ${l.text} hover:opacity-75`,"aria-label":"エラーを閉じる",children:d.jsx(y,{className:"w-4 h-4"})})]}),d.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:(()=>{const r=[];return e.retryable&&a&&r.push(d.jsxs(x,{size:"sm",onClick:()=>{a()},className:l.button,children:[d.jsx(D,{className:"w-4 h-4 mr-1"}),"再試行"]},"retry")),"authentication"===e.type&&r.push(d.jsxs(x,{size:"sm",onClick:()=>window.location.href="/login",className:"bg-blue-600 hover:bg-blue-700",children:[d.jsx(O,{className:"w-4 h-4 mr-1"}),"ログイン"]},"login")),"high"!==e.severity&&"critical"!==e.severity||r.push(d.jsxs(x,{size:"sm",variant:"secondary",onClick:()=>window.location.href="/",children:[d.jsx(R,{className:"w-4 h-4 mr-1"}),"ホームに戻る"]},"home")),r.push(d.jsxs(x,{size:"sm",variant:"secondary",onClick:s,children:[d.jsx(y,{className:"w-4 h-4 mr-1"}),"閉じる"]},"close")),r})()})]})]})});return t?d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:d.jsx(m,{className:"max-w-md w-full",children:n})}):n};function W({formData:e,onFormDataChange:s,onSubmit:a,error:r,isLoading:t}){const l=e=>{s(e)};return d.jsxs("div",{className:"max-w-2xl mx-auto",children:[d.jsxs("div",{className:"mb-6",children:[d.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[d.jsx(S,{className:"w-6 h-6 text-green-600"}),d.jsx("span",{className:"text-green-800 font-medium",children:"第一審査・本人確認完了"})]}),d.jsx("h1",{className:"text-2xl font-bold mb-2",children:"ドッグラン登録 - 詳細情報入力"}),d.jsx("p",{className:"text-gray-600",children:"第一審査・本人確認が完了しました。詳細な施設情報を入力してください。"})]}),d.jsx(m,{className:"mb-6 bg-green-50 border-green-200",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center space-x-3",children:[d.jsx(S,{className:"w-6 h-6 text-green-600"}),d.jsxs("div",{children:[d.jsx("h3",{className:"font-semibold text-green-900",children:"第一審査・本人確認完了"}),d.jsx("p",{className:"text-sm text-green-800",children:"基本条件と本人確認をクリアしました"})]})]}),d.jsx("div",{className:"text-right text-sm text-green-700",children:d.jsx("p",{children:"次のステップ: 第二審査（書類審査）"})})]})}),r&&d.jsx("div",{className:"mb-6 p-4 bg-red-50 rounded-lg",children:d.jsxs("div",{className:"flex items-start space-x-2",children:[d.jsx(f,{className:"w-5 h-5 text-red-600 mt-0.5"}),d.jsx("p",{className:"text-sm text-red-800",children:r})]})}),d.jsx(m,{className:"p-6",children:d.jsxs("form",{onSubmit:a,className:"space-y-6",children:[d.jsx("div",{className:"mb-4",children:d.jsx(q,{label:"ドッグラン名 *",value:e.name,onChange:e=>l({name:e.target.value}),placeholder:"例: 渋谷中央ドッグラン",required:!0})}),d.jsxs("div",{className:"mb-4",children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"説明"}),d.jsx("textarea",{value:e.description,onChange:e=>l({description:e.target.value}),placeholder:"ドッグランの特徴や魅力をご紹介ください",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3})]}),d.jsx("div",{className:"mb-4",children:d.jsx(q,{label:"住所 *",value:e.address,onChange:e=>l({address:e.target.value}),placeholder:"例: 東京都渋谷区道玄坂1-1-1",required:!0})}),d.jsxs("div",{className:"mb-4",children:[d.jsx(q,{label:"最大収容頭数 *",type:"number",min:"1",value:e.maxCapacity,onChange:e=>l({maxCapacity:e.target.value}),placeholder:"例: 15",required:!0}),d.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"同時に利用できる犬の最大頭数を入力してください"})]}),d.jsxs("div",{className:"mb-4",children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"対応犬種 *"}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("label",{className:"flex items-center space-x-2",children:[d.jsx("input",{type:"checkbox",checked:e.largeDogArea,onChange:e=>l({largeDogArea:e.target.checked}),className:"rounded text-blue-600"}),d.jsx("span",{children:"大型犬エリア"})]}),d.jsxs("label",{className:"flex items-center space-x-2",children:[d.jsx("input",{type:"checkbox",checked:e.smallDogArea,onChange:e=>l({smallDogArea:e.target.checked}),className:"rounded text-blue-600"}),d.jsx("span",{children:"小型犬エリア"})]})]})]}),d.jsxs("div",{className:"mb-4",children:[d.jsxs("label",{className:"flex items-center space-x-2 mb-2",children:[d.jsx("input",{type:"checkbox",checked:e.privateBooths,onChange:e=>l({privateBooths:e.target.checked}),className:"rounded text-blue-600"}),d.jsx("span",{className:"text-sm font-medium text-gray-700",children:"貸し切りブース"})]}),e.privateBooths&&d.jsx("div",{className:"ml-6",children:d.jsx(q,{label:"貸し切りブース数",type:"number",min:"1",value:e.privateBoothCount,onChange:e=>l({privateBoothCount:e.target.value}),placeholder:"例: 2"})})]}),d.jsxs("div",{className:"mb-4",children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"設備・サービス（第一審査で選択した内容を確認・修正できます）"}),d.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries({parking:"駐車場",shower:"シャワー設備",restroom:"トイレ",agility:"アジリティ設備",rest_area:"休憩スペース",water_station:"給水設備"}).map((([s,a])=>d.jsxs("label",{className:"flex items-center space-x-2",children:[d.jsx("input",{type:"checkbox",checked:e.facilities[s],onChange:a=>l({facilities:c(i({},e.facilities),{[s]:a.target.checked})}),className:"rounded text-blue-600"}),d.jsx("span",{children:a})]},s)))})]}),d.jsxs("div",{className:"mb-4",children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"設備の詳細情報"}),d.jsx("textarea",{value:e.facilityDetails,onChange:e=>l({facilityDetails:e.target.value}),placeholder:"設備やサービスについての詳細な情報を入力してください",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3})]}),d.jsx(m,{className:"bg-blue-50 border-blue-200",children:d.jsxs("div",{className:"flex items-start space-x-2",children:[d.jsx(A,{className:"w-5 h-5 text-blue-600 mt-0.5"}),d.jsxs("div",{className:"text-sm text-blue-800",children:[d.jsx("p",{className:"font-medium mb-1",children:"第二審査について"}),d.jsxs("ul",{className:"space-y-1 text-xs",children:[d.jsx("li",{children:"• 詳細な施設情報と必要書類の審査を行います"}),d.jsx("li",{children:"• 審査期間は通常3-5営業日です"}),d.jsx("li",{children:"• 通過後、QRコード実証検査の日程調整を行います"}),d.jsx("li",{children:"• 実証検査完了後、一般公開となります"})]})]})]})}),d.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[d.jsxs(p,{to:"/owner-payment-system",className:"text-blue-600 hover:text-blue-800 flex items-center",children:[d.jsx(P,{className:"w-4 h-4 mr-1"}),d.jsx("span",{className:"text-sm",children:"収益システムについて"})]}),d.jsx(x,{type:"submit",isLoading:t,className:"bg-blue-600 hover:bg-blue-700",children:"第二審査に申し込む"})]})]})})]})}function V({formData:e,onFormDataChange:s,onSubmit:a,error:r,profileData:t,profileLoading:l,onProfileUpdate:n}){const[o,u]=g.useState(!1),[h,b]=g.useState(!1),[j,y]=g.useState(t),N=e=>{s(e)};return d.jsxs("div",{className:"max-w-2xl mx-auto",children:[d.jsx("h1",{className:"text-2xl font-bold text-center mb-8",children:"ドッグラン登録 - 第一審査・本人確認"}),d.jsx(m,{className:"mb-6 bg-blue-50 border-blue-200",children:d.jsxs("div",{className:"flex items-start space-x-3",children:[d.jsx(L,{className:"w-6 h-6 text-blue-600 mt-1"}),d.jsxs("div",{children:[d.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"新しい審査プロセスについて"}),d.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[d.jsxs("p",{children:[d.jsx("strong",{children:"第一審査・本人確認:"})," 基本的な条件の確認と本人確認書類の審査"]}),d.jsxs("p",{children:[d.jsx("strong",{children:"第二審査:"})," 詳細な施設情報と書類審査"]}),d.jsxs("p",{children:[d.jsx("strong",{children:"QRコード実証検査:"})," 実際の施設での動作確認"]}),d.jsxs("p",{children:[d.jsx("strong",{children:"掲載・運営開始:"})," 一般公開と予約受付開始"]})]}),d.jsx("div",{className:"mt-3 flex items-center",children:d.jsxs(p,{to:"/owner-payment-system",className:"text-blue-600 hover:text-blue-800 flex items-center",children:[d.jsx(P,{className:"w-4 h-4 mr-1"}),d.jsx("span",{className:"text-sm font-medium",children:"料金体系と収益システムについて詳しく見る"})]})})]})]})}),d.jsx(m,{className:"mb-6 bg-yellow-50 border-yellow-200",children:d.jsxs("div",{className:"flex items-start space-x-3",children:[d.jsx(F,{className:"w-6 h-6 text-yellow-600 mt-1"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"font-semibold text-yellow-900 mb-2",children:"登録情報の確認"}),d.jsxs("div",{className:"text-sm text-yellow-800 mb-4",children:[d.jsx("p",{children:"本人確認書類に記載された情報と一致するかご確認ください。"}),d.jsx("p",{children:"間違いがある場合は修正してから本人確認書類をアップロードしてください。"})]}),l?d.jsxs("div",{className:"flex items-center justify-center py-4",children:[d.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-yellow-600"}),d.jsx("span",{className:"ml-2 text-yellow-800",children:"プロフィール情報を読み込み中..."})]}):d.jsxs("div",{className:"bg-white p-4 rounded-lg border border-yellow-200",children:[d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-sm text-gray-600",children:"氏名"}),d.jsx("p",{className:"font-medium text-gray-900",children:t.name||"未設定"})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm text-gray-600",children:"郵便番号"}),d.jsx("p",{className:"font-medium text-gray-900",children:t.postal_code||"未設定"})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm text-gray-600",children:"住所"}),d.jsx("p",{className:"font-medium text-gray-900",children:t.address||"未設定"})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm text-gray-600",children:"電話番号"}),d.jsx("p",{className:"font-medium text-gray-900",children:t.phone_number||"未設定"})]})]}),d.jsx("div",{className:"mt-4 flex justify-end",children:d.jsxs(x,{variant:"secondary",onClick:()=>{y(t),b(!0)},className:"flex items-center",children:[d.jsx($,{className:"w-4 h-4 mr-1"}),"情報を修正"]})})]})]})]})}),d.jsx(m,{className:"mb-6 bg-green-50 border-green-200",children:d.jsxs("div",{className:"flex items-start space-x-3",children:[d.jsx(_,{className:"w-6 h-6 text-green-600 mt-1"}),d.jsxs("div",{children:[d.jsx("h3",{className:"font-semibold text-green-900 mb-2",children:"本人確認書類について"}),d.jsxs("div",{className:"text-sm text-green-800 space-y-1",children:[d.jsx("p",{children:"安全なプラットフォーム運営のため、ドッグランオーナーには本人確認が必要です。"}),d.jsx("p",{children:"運転免許証、マイナンバーカード、パスポートなどの本人確認書類の画像をアップロードしてください。"}),d.jsx("p",{children:"住所と氏名が登録情報と一致することを確認させていただきます。"})]})]})]})}),d.jsx(m,{className:"mb-6 bg-orange-50 border-orange-200",children:d.jsxs("div",{className:"flex items-start space-x-3",children:[d.jsx(I,{className:"w-6 h-6 text-orange-600 mt-1"}),d.jsxs("div",{children:[d.jsx("h3",{className:"font-semibold text-orange-900 mb-2",children:"重要な注意事項"}),d.jsxs("div",{className:"text-sm text-orange-800 space-y-1",children:[d.jsx("p",{children:d.jsx("strong",{children:"本人確認書類の住所・氏名と上記の登録情報が一致している必要があります。"})}),d.jsx("p",{children:"一致しない場合は審査が通らない場合があります。"}),d.jsx("p",{children:"引っ越しなどで住所が変わった場合は、必ず上記の「情報を修正」から最新の情報に更新してください。"})]})]})]})}),h&&d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:d.jsxs("div",{className:"bg-white p-6 rounded-lg max-w-md w-full mx-4",children:[d.jsx("h3",{className:"text-lg font-semibold mb-4",children:"登録情報の修正"}),d.jsxs("div",{className:"space-y-4",children:[d.jsx(q,{label:"氏名",value:j.name,onChange:e=>y(c(i({},j),{name:e.target.value})),placeholder:"山田太郎"}),d.jsx(q,{label:"郵便番号",value:j.postal_code,onChange:e=>y(c(i({},j),{postal_code:e.target.value})),placeholder:"123-4567"}),d.jsx(q,{label:"住所",value:j.address,onChange:e=>y(c(i({},j),{address:e.target.value})),placeholder:"東京都新宿区西新宿1-1-1"}),d.jsx(q,{label:"電話番号",value:j.phone_number,onChange:e=>y(c(i({},j),{phone_number:e.target.value})),placeholder:"090-1234-5678"})]}),d.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[d.jsx(x,{variant:"secondary",onClick:()=>b(!1),children:"キャンセル"}),d.jsx(x,{onClick:()=>{n(j),b(!1)},disabled:l,children:"保存"})]})]})}),r&&d.jsx("div",{className:"mb-6 p-4 bg-red-50 rounded-lg",children:d.jsxs("div",{className:"flex items-start space-x-2",children:[d.jsx(f,{className:"w-5 h-5 text-red-600 mt-0.5"}),d.jsx("p",{className:"text-sm text-red-800",children:r})]})}),d.jsx(m,{className:"p-6",children:d.jsxs("form",{onSubmit:a,className:"space-y-6",children:[d.jsxs("div",{className:"mb-6",children:[d.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"現在ドッグランを運営していますか？ *"}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("label",{className:"flex items-center space-x-2",children:[d.jsx("input",{type:"radio",name:"isCurrentlyOperating",value:"yes",checked:"yes"===e.isCurrentlyOperating,onChange:e=>N({isCurrentlyOperating:e.target.value}),className:"text-blue-600"}),d.jsx("span",{children:"はい（すでに運営中）"})]}),d.jsxs("label",{className:"flex items-center space-x-2",children:[d.jsx("input",{type:"radio",name:"isCurrentlyOperating",value:"no",checked:"no"===e.isCurrentlyOperating,onChange:e=>N({isCurrentlyOperating:e.target.value}),className:"text-blue-600"}),d.jsx("span",{children:"いいえ（新規開設予定）"})]})]}),"no"===e.isCurrentlyOperating&&d.jsx(d.Fragment,{children:d.jsxs("div",{className:"mt-4 pl-4 border-l-4 border-blue-200",children:[d.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"予定地はあなたの所有地ですか？ *"}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("label",{className:"flex items-center space-x-2",children:[d.jsx("input",{type:"radio",name:"isOwnedLand",value:"yes",checked:"yes"===e.isOwnedLand,onChange:e=>N({isOwnedLand:e.target.value}),className:"text-blue-600"}),d.jsx("span",{children:"はい（所有地）"})]}),d.jsxs("label",{className:"flex items-center space-x-2",children:[d.jsx("input",{type:"radio",name:"isOwnedLand",value:"no",checked:"no"===e.isOwnedLand,onChange:e=>N({isOwnedLand:e.target.value}),className:"text-blue-600"}),d.jsx("span",{children:"いいえ（借用地）"})]})]}),"no"===e.isOwnedLand&&d.jsxs("div",{className:"mt-4 pl-4 border-l-4 border-yellow-200",children:[d.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"土地所有者の許可は得ていますか？ *"}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("label",{className:"flex items-center space-x-2",children:[d.jsx("input",{type:"radio",name:"hasOwnerPermission",value:"yes",checked:"yes"===e.hasOwnerPermission,onChange:e=>N({hasOwnerPermission:e.target.value}),className:"text-blue-600"}),d.jsx("span",{children:"はい"})]}),d.jsxs("label",{className:"flex items-center space-x-2",children:[d.jsx("input",{type:"radio",name:"hasOwnerPermission",value:"no",checked:"no"===e.hasOwnerPermission,onChange:e=>N({hasOwnerPermission:e.target.value}),className:"text-blue-600"}),d.jsx("span",{children:"いいえ"})]})]})]}),d.jsxs("div",{className:"mt-4 pl-4 border-l-4 border-green-200",children:[d.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"近隣住民の理解は得ていますか？ *"}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("label",{className:"flex items-center space-x-2",children:[d.jsx("input",{type:"radio",name:"hasNeighborConsent",value:"yes",checked:"yes"===e.hasNeighborConsent,onChange:e=>N({hasNeighborConsent:e.target.value}),className:"text-blue-600"}),d.jsx("span",{children:"はい"})]}),d.jsxs("label",{className:"flex items-center space-x-2",children:[d.jsx("input",{type:"radio",name:"hasNeighborConsent",value:"no",checked:"no"===e.hasNeighborConsent,onChange:e=>N({hasNeighborConsent:e.target.value}),className:"text-blue-600"}),d.jsx("span",{children:"いいえ"})]})]})]})]})})]}),d.jsxs("div",{className:"mb-6",children:[d.jsx(q,{label:d.jsx("span",{className:"text-lg font-bold text-gray-800",children:"広さ（㎡） *"}),type:"number",min:"1",value:e.landArea,onChange:e=>N({landArea:e.target.value}),placeholder:"例: 500",required:!0}),d.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"ドッグランの運営には最低100㎡以上の広さが必要です"})]}),d.jsxs("div",{className:"mb-6",children:[d.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"施設までは週に1度程度、状況の確認やメンテナンスに行くことができますか？ *"}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("label",{className:"flex items-center space-x-2",children:[d.jsx("input",{type:"radio",name:"canVisitWeekly",value:"yes",checked:"yes"===e.canVisitWeekly,onChange:e=>N({canVisitWeekly:e.target.value}),className:"text-blue-600"}),d.jsx("span",{children:"はい"})]}),d.jsxs("label",{className:"flex items-center space-x-2",children:[d.jsx("input",{type:"radio",name:"canVisitWeekly",value:"no",checked:"no"===e.canVisitWeekly,onChange:e=>N({canVisitWeekly:e.target.value}),className:"text-blue-600"}),d.jsx("span",{children:"いいえ"})]})]})]}),d.jsxs("div",{className:"mb-6",children:[d.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"緊急時（怪我や事故など）に1時間以内に施設に到着できますか？ *"}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("label",{className:"flex items-center space-x-2",children:[d.jsx("input",{type:"radio",name:"canReachQuickly",value:"yes",checked:"yes"===e.canReachQuickly,onChange:e=>N({canReachQuickly:e.target.value}),className:"text-blue-600"}),d.jsx("span",{children:"はい"})]}),d.jsxs("label",{className:"flex items-center space-x-2",children:[d.jsx("input",{type:"radio",name:"canReachQuickly",value:"no",checked:"no"===e.canReachQuickly,onChange:e=>N({canReachQuickly:e.target.value}),className:"text-blue-600"}),d.jsx("span",{children:"いいえ"})]})]})]}),d.jsxs("div",{className:"mb-6",children:[d.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"反社会的勢力との関係はありますか？ *"}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("label",{className:"flex items-center space-x-2",children:[d.jsx("input",{type:"radio",name:"isAntiSocialForces",value:"no",checked:"no"===e.isAntiSocialForces,onChange:e=>N({isAntiSocialForces:e.target.value}),className:"text-blue-600"}),d.jsx("span",{children:"いいえ（関係なし）"})]}),d.jsxs("label",{className:"flex items-center space-x-2",children:[d.jsx("input",{type:"radio",name:"isAntiSocialForces",value:"yes",checked:"yes"===e.isAntiSocialForces,onChange:e=>N({isAntiSocialForces:e.target.value}),className:"text-blue-600"}),d.jsx("span",{children:"はい（関係あり）"})]})]}),"yes"===e.isAntiSocialForces&&d.jsx("div",{className:"mt-2 p-3 bg-red-50 rounded-lg",children:d.jsxs("div",{className:"flex items-start space-x-2",children:[d.jsx(C,{className:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0"}),d.jsx("p",{className:"text-sm text-red-800",children:"反社会的勢力との関係がある場合、ドッグランの登録はできません。当社は反社会的勢力との関係を一切認めておりません。"})]})})]}),d.jsxs("div",{className:"mb-6",children:[d.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"本人確認書類のアップロード *"}),d.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[d.jsx(M,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),d.jsx("input",{type:"file",accept:"image/*,application/pdf",onChange:e=>{e.target.files&&e.target.files[0]&&N({identityDocument:e.target.files[0]})},className:"hidden",id:"identity-upload",required:!0}),d.jsx("label",{htmlFor:"identity-upload",className:"cursor-pointer text-blue-600 hover:text-blue-800 font-medium",children:"ファイルを選択"}),d.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"運転免許証・マイナンバーカード・パスポート等の画像またはPDF"}),d.jsx("p",{className:"text-sm text-gray-500",children:"最大ファイルサイズ: 10MB"}),e.identityDocument&&d.jsxs("p",{className:"text-sm text-green-600 mt-2",children:["選択されたファイル: ",e.identityDocument.name]})]})]}),d.jsxs("div",{className:"mb-6",children:[d.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"予定設備 *"}),d.jsx("div",{className:"grid grid-cols-2 gap-3",children:Object.entries({parking:"駐車場",shower:"シャワー設備",restroom:"トイレ",agility:"アジリティ設備",rest_area:"休憩スペース",water_station:"給水設備"}).map((([s,a])=>d.jsxs("label",{className:"flex items-center space-x-2",children:[d.jsx("input",{type:"checkbox",checked:e.facilities[s],onChange:a=>N({facilities:c(i({},e.facilities),{[s]:a.target.checked})}),className:"rounded text-blue-600"}),d.jsx("span",{className:"text-sm",children:a})]},s)))})]}),d.jsx(m,{className:"bg-yellow-50 border-yellow-200",children:d.jsxs("div",{className:"flex items-start space-x-2",children:[d.jsx(f,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),d.jsxs("div",{className:"text-sm text-yellow-800",children:[d.jsx("p",{className:"font-medium mb-1",children:"第一審査・本人確認について"}),d.jsxs("ul",{className:"space-y-1 text-xs",children:[d.jsx("li",{children:"• 基本的な開設条件を満たしているかを確認します"}),d.jsx("li",{children:"• 本人確認書類の住所・氏名が登録情報と一致することを確認します"}),d.jsx("li",{children:"• 通過後、詳細な施設情報の入力に進みます"}),d.jsx("li",{children:"• 第二審査では書類審査を行います"}),d.jsx("li",{children:"• 最終的にQRコード実証検査を経て掲載開始となります"})]})]})]})}),d.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[d.jsxs(p,{to:"/owner-payment-system",className:"text-blue-600 hover:text-blue-800 flex items-center",children:[d.jsx(P,{className:"w-4 h-4 mr-1"}),d.jsx("span",{className:"text-sm",children:"収益システムについて"})]}),d.jsxs(x,{type:"submit",className:"w-1/2 bg-blue-600 hover:bg-blue-700",disabled:!e.identityDocument||o,isLoading:o,children:[d.jsx(_,{className:"w-4 h-4 mr-2"}),"第一審査・本人確認を申し込む"]})]})]})})]})}function T({rejectedParks:e,onUpdateRejectedParks:s,onResubmit:a,onError:r}){const[t,l]=g.useState(!1),[n,i]=g.useState(null);return 0===e.length?null:d.jsxs(d.Fragment,{children:[d.jsx(m,{className:"mb-6 bg-red-50 border-red-200",children:d.jsxs("div",{className:"flex items-start space-x-3",children:[d.jsx(f,{className:"w-6 h-6 text-red-600 mt-1"}),d.jsxs("div",{children:[d.jsx("h3",{className:"font-semibold text-red-900 mb-2",children:"却下された申請"}),d.jsx("p",{className:"text-sm text-red-800 mb-4",children:"以下の申請は審査の結果、却下されました。申請内容を見直して再提出するか、削除することができます。"}),d.jsx("div",{className:"space-y-4",children:e.map((e=>d.jsx("div",{className:"bg-white p-4 rounded-lg border border-red-200",children:d.jsxs("div",{className:"flex justify-between items-start",children:[d.jsxs("div",{children:[d.jsx("h4",{className:"font-medium",children:e.name}),d.jsx("p",{className:"text-sm text-gray-600",children:e.address}),d.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["申請日: ",new Date(e.created_at).toLocaleDateString("ja-JP")]})]}),d.jsxs("div",{className:"flex space-x-2",children:[d.jsxs(x,{size:"sm",variant:"secondary",onClick:()=>a(e),children:[d.jsx(D,{className:"w-4 h-4 mr-1"}),"再申請"]}),d.jsxs(x,{size:"sm",variant:"secondary",className:"text-red-600 hover:text-red-700",onClick:()=>i(e.id),children:[d.jsx(z,{className:"w-4 h-4 mr-1"}),"削除"]})]})]})},e.id)))})]})]})}),n&&d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:d.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[d.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"申請を削除しますか？"}),d.jsx("p",{className:"text-gray-600 mb-6",children:"この操作は取り消せません。申請を削除してもよろしいですか？"}),d.jsxs("div",{className:"flex justify-end space-x-3",children:[d.jsx(x,{variant:"secondary",onClick:()=>i(null),children:"キャンセル"}),d.jsxs(x,{className:"bg-red-600 hover:bg-red-700",isLoading:t,onClick:()=>{return a=n,o(null,null,(function*(){try{l(!0);const{error:r}=yield u.from("dog_parks").delete().eq("id",a);if(r)throw r;const t=e.filter((e=>e.id!==a));s(t),i(null)}catch(t){r(t.message||"ドッグランの削除に失敗しました")}finally{l(!1)}}));var a},children:[d.jsx(z,{className:"w-4 h-4 mr-2"}),"削除する"]})]})]})})]})}const U={maxAttempts:3,baseDelay:1e3,maxDelay:1e4,backoffFactor:2,retryableErrors:["network","timeout","server","storage"],autoRetry:!0};const H={maxAttempts:3,baseDelay:1e3,maxDelay:5e3,backoffFactor:1.5,retryableErrors:["network","timeout","server"],autoRetry:!0};function G(){const e=j(),{user:s}=b(),[a,r]=g.useState(!1),[t,l]=g.useState(1),[n,m]=g.useState([]),[x,p]=g.useState(null),[y,f]=g.useState({name:"",postal_code:"",address:"",phone_number:"",email:""}),[N,v]=g.useState(!1),[w,k]=g.useState(!1),{error:C,clearError:_,handleError:E,executeWithErrorHandling:D}=function(){const[e,s]=g.useState(null),[a,r]=g.useState(!1),[t,l]=g.useState(null),n=g.useCallback((()=>{s(null),l(null)}),[]),d=g.useCallback((e=>{if(e instanceof Error){const s=e.message.toLowerCase();if(s.includes("network")||s.includes("fetch")||s.includes("connection"))return{type:"network",severity:"medium",message:e.message,originalError:e,userMessage:"ネットワーク接続に問題があります。インターネット接続を確認してください。",recoverable:!0,retryable:!0};if(s.includes("timeout")||s.includes("timed out")||"AbortError"===e.name)return{type:"timeout",severity:"medium",message:e.message,originalError:e,userMessage:"リクエストがタイムアウトしました。もう一度お試しください。",recoverable:!0,retryable:!0};if(s.includes("jwt")||s.includes("unauthorized")||s.includes("refresh_token"))return{type:"authentication",severity:"high",message:e.message,originalError:e,userMessage:"セッションが期限切れです。再度ログインしてください。",recoverable:!0,retryable:!1};if(s.includes("forbidden")||s.includes("permission")||s.includes("row-level security"))return{type:"authorization",severity:"high",message:e.message,originalError:e,userMessage:"この操作を実行する権限がありません。",recoverable:!1,retryable:!1};if(s.includes("validation")||s.includes("invalid")||s.includes("required"))return{type:"validation",severity:"low",message:e.message,originalError:e,userMessage:"入力内容に問題があります。確認してください。",recoverable:!0,retryable:!1};if(s.includes("storage")||s.includes("bucket")||s.includes("file"))return{type:"storage",severity:"medium",message:e.message,originalError:e,userMessage:"ファイルの処理中にエラーが発生しました。しばらく待ってから再度お試しください。",recoverable:!0,retryable:!0};if(s.includes("payment")||s.includes("stripe")||s.includes("subscription"))return{type:"payment",severity:"high",message:e.message,originalError:e,userMessage:"決済処理中にエラーが発生しました。カード情報を確認してください。",recoverable:!0,retryable:!0};if(s.includes("500")||s.includes("502")||s.includes("503")||s.includes("520"))return{type:"server",severity:"high",message:e.message,originalError:e,userMessage:"サーバーで一時的な問題が発生しています。しばらく待ってから再度お試しください。",recoverable:!0,retryable:!0};if(s.includes("404")||s.includes("not found"))return{type:"not_found",severity:"medium",message:e.message,originalError:e,userMessage:"要求されたリソースが見つかりません。",recoverable:!1,retryable:!1}}if("object"==typeof e&&null!==e&&"code"in e){const s=h(e);return{type:"server",severity:"medium",message:s,originalError:e,userMessage:s,recoverable:!0,retryable:!0}}return{type:"unknown",severity:"medium",message:e instanceof Error?e.message:String(e),originalError:e,userMessage:"予期しないエラーが発生しました。しばらく待ってから再度お試しください。",recoverable:!0,retryable:!0}}),[]),m=g.useCallback((e=>{e.severity}),[]),x=g.useCallback(((e,a)=>{const r=i(c(i({},d(e)),{timestamp:new Date}),a&&{context:a});m(r),s(r)}),[d,m]),u=g.useCallback(((e,s)=>o(null,null,(function*(){r(!0),n();try{const s=yield e();return r(!1),s}catch(a){return x(a,s),r(!1),d(a).retryable&&l((()=>()=>o(null,null,(function*(){yield u(e,s)})))),null}}))),[x,n,d]);return{error:e,isLoading:a,clearError:n,handleError:x,retryAction:t,executeWithErrorHandling:u}}(),O=function(e={}){const s=i(i({},U),e),[a,r]=g.useState({attempts:0,isRetrying:!1,lastError:null,nextRetryIn:0}),t=g.useRef(),l=g.useRef(),n=g.useCallback((()=>{t.current&&clearTimeout(t.current),l.current&&clearInterval(l.current),r({attempts:0,isRetrying:!1,lastError:null,nextRetryIn:0})}),[]),d=g.useCallback((()=>{t.current&&clearTimeout(t.current),l.current&&clearInterval(l.current),r((e=>c(i({},e),{isRetrying:!1,nextRetryIn:0})))}),[]),m=g.useCallback((e=>{const a=s.baseDelay*Math.pow(s.backoffFactor,e);return Math.min(a,s.maxDelay)}),[s]),x=g.useCallback((e=>{const a=e.message.toLowerCase();return!!(s.retryableErrors.includes("network")&&(a.includes("network")||a.includes("fetch")||a.includes("connection"))||s.retryableErrors.includes("timeout")&&(a.includes("timeout")||a.includes("timed out")||"AbortError"===e.name)||s.retryableErrors.includes("server")&&(a.includes("500")||a.includes("502")||a.includes("503")||a.includes("520"))||s.retryableErrors.includes("storage")&&(a.includes("storage")||a.includes("bucket")))}),[s.retryableErrors]),u=g.useCallback(((e,s)=>{let a=Math.ceil(e/1e3);r((e=>c(i({},e),{nextRetryIn:a}))),l.current=setInterval((()=>{a--,r((e=>c(i({},e),{nextRetryIn:a}))),a<=0&&(l.current&&clearInterval(l.current),s())}),1e3)}),[]),h=g.useCallback(((e,a=0)=>o(null,null,(function*(){try{r((e=>c(i({},e),{attempts:a,lastError:null})));const s=yield e();return n(),s}catch(C){const n=C instanceof Error?C:new Error(String(C));if(r((e=>c(i({},e),{lastError:n}))),a>=s.maxAttempts-1)throw r((e=>c(i({},e),{isRetrying:!1}))),n;if(!x(n))throw r((e=>c(i({},e),{isRetrying:!1}))),n;if(!s.autoRetry)throw r((e=>c(i({},e),{isRetrying:!1}))),n;const o=m(a);return r((e=>c(i({},e),{isRetrying:!0}))),new Promise(((s,r)=>{u(o,(()=>{t.current=setTimeout((()=>{h(e,a+1).then(s).catch(r)}),0)}))}))}}))),[s,x,m,n,u]);return{execute:g.useCallback((e=>h(e,0)),[h]),state:a,reset:n,cancelRetry:d}}(H),[R,S]=g.useState({isCurrentlyOperating:"",isOwnedLand:"",hasOwnerPermission:"",hasNeighborConsent:"",landArea:"",isAntiSocialForces:"",canVisitWeekly:"",canReachQuickly:"",identityDocument:null,name:"",description:"",address:"",maxCapacity:"10",largeDogArea:!0,smallDogArea:!0,privateBooths:!1,privateBoothCount:"0",facilities:{parking:!1,shower:!1,restroom:!1,agility:!1,rest_area:!1,water_station:!1},facilityDetails:""});g.useEffect((()=>{s?(A(),P(),L()):e("/login")}),[s,e]);const A=()=>o(null,null,(function*(){yield D((()=>o(null,null,(function*(){const{data:e,error:a}=yield u.from("dog_parks").select("*").eq("owner_id",null==s?void 0:s.id).eq("status","rejected");if(a)throw a;m(e||[])}))),{operation:"fetch_rejected_parks"})})),P=()=>o(null,null,(function*(){yield D((()=>o(null,null,(function*(){const{data:e,error:a}=yield u.from("owner_verifications").select("status").eq("user_id",null==s?void 0:s.id).single();if(a&&"PGRST116"!==a.code)throw a;p((null==e?void 0:e.status)||null)}))),{operation:"check_identity_verification"})})),L=()=>o(null,null,(function*(){yield D((()=>o(null,null,(function*(){v(!0);const{data:e,error:a}=yield u.from("profiles").select("name, postal_code, address, phone_number, email").eq("id",null==s?void 0:s.id).single();if(a)throw a;f(e||{name:"",postal_code:"",address:"",phone_number:"",email:""})}))),{operation:"fetch_profile_data"}),v(!1)})),F=e=>o(null,null,(function*(){yield D((()=>o(null,null,(function*(){v(!0);const{error:a}=yield u.from("profiles").update(e).eq("id",null==s?void 0:s.id);if(a)throw a;f(e),k(!1)}))),{operation:"update_profile_data"}),v(!1)})),$=e=>{S((s=>i(i({},s),e)))},I=e=>{m(e)},M=e=>{S((s=>{var a,r;return c(i({},s),{name:e.name,description:e.description||"",address:e.address,maxCapacity:(null==(a=e.max_capacity)?void 0:a.toString())||"10",largeDogArea:e.large_dog_area||!0,smallDogArea:e.small_dog_area||!0,privateBooths:e.private_booths||!1,privateBoothCount:(null==(r=e.private_booth_count)?void 0:r.toString())||"0",facilities:e.facilities||{parking:!1,shower:!1,restroom:!1,agility:!1,rest_area:!1,water_station:!1},facilityDetails:e.facility_details||""})})),l(2)},z=e=>o(null,null,(function*(){e.preventDefault(),yield D((()=>o(null,null,(function*(){if((e=>{if(!e.isCurrentlyOperating)throw new Error("現在の運営状況を選択してください。");if("no"===e.isCurrentlyOperating){if(!e.isOwnedLand)throw new Error("予定地の所有状況を選択してください。");if("no"===e.isOwnedLand&&!e.hasOwnerPermission)throw new Error("土地所有者の許可について選択してください。");if(!e.hasNeighborConsent)throw new Error("近隣住民の理解について選択してください。")}if(!e.landArea||parseInt(e.landArea)<=0)throw new Error("広さを正しく入力してください。");if(!e.isAntiSocialForces)throw new Error("反社会的勢力との関係について選択してください。");if("yes"===e.isAntiSocialForces)throw new Error("反社会的勢力との関係がある場合、ドッグランの登録はできません。");if(!e.canVisitWeekly)throw new Error("週1回の訪問可否について選択してください。");if(!e.canReachQuickly)throw new Error("緊急時の到着可否について選択してください。");if(!e.identityDocument)throw new Error("本人確認書類をアップロードしてください。");if("no"===e.isCurrentlyOperating){if("no"===e.isOwnedLand&&"no"===e.hasOwnerPermission)throw new Error("土地所有者の許可を得てからお申し込みください。借用地でのドッグラン運営には所有者の同意が必要です。");if("no"===e.hasNeighborConsent)throw new Error("近隣住民の理解を得てからお申し込みください。地域との良好な関係は運営において重要です。")}if(parseInt(e.landArea)<100)throw new Error("ドッグランの運営には最低100㎡以上の広さが必要です。");if("no"===e.canVisitWeekly)throw new Error("週に1度程度の訪問が必要です。施設の状況確認やメンテナンスのため、定期的な訪問ができる方のみお申し込みください。");if("no"===e.canReachQuickly)throw new Error("緊急時に1時間以内に施設に到着できることが必要です。迅速な対応ができる方のみお申し込みください。")})(R),!s)throw new Error("ユーザー情報が取得できません。再度ログインしてください。");r(!0);try{if(R.identityDocument){const e=`identity_${s.id}_${Date.now()}_${R.identityDocument.name}`,{data:a,error:r}=yield u.storage.from("vaccine-certs").upload(e,R.identityDocument,{upsert:!0});if(r)throw new Error(`ファイルアップロードに失敗しました: ${r.message}`);const t={user_id:s.id,verification_id:a.path,status:"pending",verification_data:{document_url:a.path,uploaded_at:(new Date).toISOString(),file_name:R.identityDocument.name,file_size:R.identityDocument.size,file_type:R.identityDocument.type,application_stage:"first_stage"}},{error:l}=yield u.from("owner_verifications").upsert(t,{onConflict:"user_id"});if(l)throw new Error(`データベース保存に失敗しました: ${l.message}`)}l(2),window.scrollTo({top:0,behavior:"smooth"})}catch(e){const s=e instanceof Error?e.message:"申込みに失敗しました。";throw new Error(s)}finally{r(!1)}}))),{operation:"first_stage_submission"})}));return 1===t?d.jsxs("div",{children:[d.jsx(Q,{error:C,onClear:_,className:"mb-6"}),d.jsx(T,{rejectedParks:n,onUpdateRejectedParks:I,onResubmit:M,onError:E}),d.jsx(V,{formData:R,onFormDataChange:$,onSubmit:z,error:(null==C?void 0:C.userMessage)||"",profileData:y,profileLoading:N,onProfileUpdate:F})]}):d.jsxs("div",{children:[d.jsx(Q,c(i({error:C,onClear:_},O.state.isRetrying?{}:{onRetry:()=>O.execute((()=>Promise.resolve()))}),{className:"mb-6"})),O.state.isRetrying&&d.jsx("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-blue-800 font-medium",children:"自動リトライ中..."}),d.jsxs("p",{className:"text-blue-600 text-sm",children:["試行回数: ",O.state.attempts+1,"/",H.maxAttempts,O.state.nextRetryIn>0&&` | 次の試行まで: ${O.state.nextRetryIn}秒`]})]}),d.jsx("button",{onClick:O.cancelRetry,className:"text-blue-600 hover:text-blue-800 text-sm underline",children:"キャンセル"})]})}),2===t&&d.jsx(W,{formData:R,onFormDataChange:$,onSubmit:s=>o(null,null,(function*(){s.preventDefault(),r(!0);try{yield D((()=>o(null,null,(function*(){const{data:{user:s},error:a}=yield u.auth.getUser();if(a||!s)throw new Error("ユーザー認証に失敗しました。再度ログインしてください。");const{error:r}=yield u.from("profiles").update({user_type:"owner"}).eq("id",s.id);if(r)throw new Error("プロフィールの更新に失敗しました。");const{error:t}=yield u.from("dog_parks").insert([{owner_id:s.id,name:R.name,description:R.description,address:R.address,price:800,max_capacity:parseInt(R.maxCapacity,10),large_dog_area:R.largeDogArea,small_dog_area:R.smallDogArea,private_booths:R.privateBooths,private_booth_count:parseInt(R.privateBoothCount,10),private_booth_price:0,facilities:R.facilities,facility_details:R.facilityDetails,status:"pending"}]);if(t)throw t;e("/owner-dashboard")}))))}finally{r(!1)}})),error:(null==C?void 0:C.userMessage)||"",isLoading:a})]})}export{G as ParkRegistration};

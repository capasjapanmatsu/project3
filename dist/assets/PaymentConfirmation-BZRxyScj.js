import{j as e,V as s,f as a,K as t,A as l,P as c}from"./ui-vendor-CTwuE44L.js";import{u as r,i as n,r as i}from"./react-vendor-BBLDtDmh.js";import{u as m,B as x,C as o}from"./index-BbveZyU8.js";import"./query-vendor-9fkSW1iq.js";import"./supabase-vendor-BcfcqyaE.js";function d(){const d=r(),[u]=n(),{user:j}=m(),[h,N]=i.useState(!1),[b,p]=i.useState("processing"),[f,g]=i.useState(5);i.useEffect(()=>{const e=setTimeout(async()=>{const e=u.get("status"),s=u.get("session_id"),a=u.get("canceled");p("success"===e&&s?"success":"cancel"===e||"true"===a?"failed":"processing");const t=localStorage.getItem("pre_payment_auth_state");if(t)try{const e=JSON.parse(t);j&&j.id===e.user_id||"true"===a&&(p("failed"),setTimeout(()=>{d("/login")},5e3)),localStorage.removeItem("pre_payment_auth_state")}catch(l){}N(!1)},100);return()=>clearTimeout(e)},[u,j,d]),i.useEffect(()=>{if("success"===b&&f>0){const e=setTimeout(()=>{g(f-1)},1e3);return()=>clearTimeout(e)}"success"===b&&0===f&&d("/access-control")},[b,f,d]);return h?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsxs(x,{variant:"primary",size:"sm",onClick:()=>d(-1),className:"mr-3",children:[e.jsx(s,{className:"w-4 h-4 mr-2"}),"戻る"]}),e.jsx("h1",{className:"text-2xl font-bold",children:"決済確認"})]}),"success"===b&&e.jsxs(o,{className:"text-center p-8",children:[e.jsx(a,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-green-800 mb-4",children:"決済が完了しました！"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"ありがとうございます。決済が正常に処理されました。"}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg mb-6",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[e.jsx(t,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-semibold text-blue-900",children:"次のステップ"})]}),e.jsx("p",{className:"text-sm text-blue-800",children:"入場にはPINコードが必要です。下のボタンからPINコードを生成してください。"})]}),e.jsxs(x,{onClick:()=>{d("/access-control")},className:"w-full bg-blue-600 hover:bg-blue-700 mb-4",children:[e.jsx(t,{className:"w-5 h-5 mr-2"}),"PINコードを生成する"]}),e.jsx("p",{className:"text-sm text-gray-500",children:f>0&&`${f}秒後に自動的にPINコード生成画面に移動します...`})]}),"failed"===b&&e.jsxs(o,{className:"text-center p-8",children:[e.jsx(l,{className:"w-16 h-16 text-red-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-red-800 mb-4",children:"決済がキャンセルされました"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["決済がキャンセルまたは失敗しました。",j?"":"認証状態を確認してから","再度お試しください。"]}),!j&&e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg mb-6",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[e.jsx(l,{className:"w-5 h-5 text-orange-600"}),e.jsx("span",{className:"font-semibold text-orange-900",children:"認証状態が失われました"})]}),e.jsx("p",{className:"text-sm text-orange-800",children:"セッションが切断されました。3秒後にログインページに移動します。"})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg mb-6",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[e.jsx(c,{className:"w-5 h-5 text-yellow-600"}),e.jsx("span",{className:"font-semibold text-yellow-900",children:"ドッグランを利用するには"})]}),e.jsx("p",{className:"text-sm text-yellow-800",children:"入場にはPINコードが必要です。決済完了後にPINコードを生成できます。"})]}),e.jsx("div",{className:"space-y-3",children:j?e.jsxs(e.Fragment,{children:[e.jsx(x,{onClick:()=>d("/parks"),className:"w-full",children:"ドッグラン一覧に戻る"}),e.jsx(x,{variant:"secondary",onClick:()=>d("/subscription"),className:"w-full",children:"サブスクリプションを検討する"}),e.jsx(x,{variant:"secondary",onClick:()=>d("/cart"),className:"w-full",children:"カートを確認する"})]}):e.jsx(x,{onClick:()=>d("/login"),className:"w-full",children:"ログインする"})})]}),"processing"===b&&e.jsxs(o,{className:"text-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold mb-4",children:"決済を処理中..."}),e.jsx("p",{className:"text-gray-600",children:"しばらくお待ちください。決済の処理が完了するまでお時間をいただく場合があります。"})]})]})}export{d as PaymentConfirmation};

var e=Object.defineProperty,s=Object.defineProperties,t=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,c=(s,t,r)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,n=(e,s)=>{for(var t in s||(s={}))a.call(s,t)&&c(e,t,s[t]);if(r)for(var t of r(s))l.call(s,t)&&c(e,t,s[t]);return e},i=(e,r)=>s(e,t(r));import{l as d,j as x,B as m,C as u,G as o,a as p}from"./index.CQlxbczY.js";import{r as h}from"./vendor.CKEClKZl.js";import{L as j}from"./router.B_7Atevv.js";import{g as y}from"./deploymentStatus.DYNCI66r.js";import{d as b,A as f,a0 as g,z as N,aC as v,C as w,i as _}from"./ui.C72fRZ1L.js";import"./supabase.X3H3st79.js";function S({id:e,onStatusChange:s,className:t=""}){const[r,a]=h.useState(null),[l,c]=h.useState(!1),[n,i]=h.useState(null),u=h.useCallback(()=>{return t=this,r=null,l=function*(){if(e)try{c(!0),i(null);const t=yield y({id:e});a(t),s&&s(t)}catch(t){d("error"),i(t.message||"デプロイステータスの取得に失敗しました")}finally{c(!1)}},new Promise((e,s)=>{var a=e=>{try{n(l.next(e))}catch(t){s(t)}},c=e=>{try{n(l.throw(e))}catch(t){s(t)}},n=s=>s.done?e(s.value):Promise.resolve(s.value).then(a,c);n((l=l.apply(t,r)).next())});var t,r,l},[e,s]);h.useEffect(()=>{e&&u()},[e,u]);return l?x.jsxs("div",{className:`flex items-center space-x-2 ${t}`,children:[x.jsx(b,{className:"w-4 h-4 text-blue-600 animate-spin"}),x.jsx("span",{className:"text-sm text-gray-600",children:"ステータスを確認中..."})]}):n?x.jsxs("div",{className:`flex items-center space-x-2 ${t}`,children:[x.jsx(f,{className:"w-4 h-4 text-red-600"}),x.jsx("span",{className:"text-sm text-red-600",children:n}),x.jsx(m,{size:"sm",variant:"secondary",onClick:()=>{u()},children:"再試行"})]}):r?x.jsxs("div",{className:`space-y-2 ${t}`,children:[x.jsxs("div",{className:"flex items-center space-x-2",children:[x.jsx("span",{className:"text-sm text-gray-600",children:"ステータス:"}),x.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${(e=>{switch(e){case"ready":return"text-green-600 bg-green-100";case"error":case"failed":return"text-red-600 bg-red-100";case"building":case"enqueued":case"processing":return"text-blue-600 bg-blue-100";default:return"text-gray-600 bg-gray-100"}})(r.status||"")}`,children:(e=>{switch(e){case"ready":return"完了";case"error":case"failed":return"失敗";case"building":return"ビルド中";case"enqueued":return"待機中";case"processing":return"処理中";default:return e}})(r.status||"")})]}),r.deploy_url&&x.jsxs("div",{className:"flex items-center space-x-2",children:[x.jsx("span",{className:"text-sm text-gray-600",children:"URL:"}),x.jsxs("a",{href:r.deploy_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-800 flex items-center",children:[r.deploy_url.replace(/^https?:\/\//,""),x.jsx(g,{className:"w-3 h-3 ml-1"})]})]}),x.jsx(m,{size:"sm",variant:"secondary",onClick:()=>{u()},children:"更新"})]}):x.jsx("div",{className:`flex items-center space-x-2 ${t}`,children:x.jsx(m,{size:"sm",onClick:()=>{u()},children:"ステータスを確認"})})}function O(){const[e,s]=h.useState([]),[t,r]=h.useState(!0);h.useEffect(()=>{(()=>{try{const e=o("deploymentHistory");e&&s(JSON.parse(e))}catch(e){}finally{r(!1)}})()},[]);const a=e=>{switch(e){case"ready":return"text-green-600 bg-green-100";case"error":case"failed":return"text-red-600 bg-red-100";case"building":case"enqueued":case"processing":return"text-blue-600 bg-blue-100";default:return"text-gray-600 bg-gray-100"}},l=e=>{switch(e){case"ready":return"完了";case"error":case"failed":return"失敗";case"building":return"ビルド中";case"enqueued":return"待機中";case"processing":return"処理中";default:return e}};return t?x.jsx("div",{className:"flex justify-center items-center h-64",children:x.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):x.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[x.jsx("div",{className:"flex items-center space-x-4 mb-6",children:x.jsxs(j,{to:"/deploy",className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[x.jsx(N,{className:"w-4 h-4 mr-2"}),"デプロイページに戻る"]})}),x.jsxs("div",{className:"text-center mb-8",children:[x.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-4 flex items-center justify-center",children:[x.jsx(v,{className:"w-8 h-8 text-blue-600 mr-3"}),"デプロイ履歴"]}),x.jsx("p",{className:"text-lg text-gray-600",children:"過去のデプロイ履歴を確認できます"})]}),error&&x.jsxs("div",{className:"mb-6 p-4 bg-red-50 rounded-lg flex items-start",children:[x.jsx(f,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),x.jsx("p",{className:"text-red-800",children:error})]}),0===e.length?x.jsxs(u,{className:"p-6 text-center",children:[x.jsx(w,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),x.jsx("h2",{className:"text-xl font-semibold text-gray-700 mb-2",children:"デプロイ履歴がありません"}),x.jsx("p",{className:"text-gray-500 mb-6",children:"まだデプロイを行っていないようです"}),x.jsx(j,{to:"/deploy",children:x.jsxs(m,{children:[x.jsx(v,{className:"w-4 h-4 mr-2"}),"デプロイを開始する"]})})]}):x.jsx("div",{className:"space-y-4",children:e.map(t=>x.jsx(u,{className:"p-6",children:x.jsxs("div",{className:"flex justify-between items-start",children:[x.jsxs("div",{children:[x.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[x.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${a(t.status)}`,children:l(t.status)}),x.jsx("span",{className:"text-sm text-gray-500",children:new Date(t.created_at).toLocaleString("ja-JP")})]}),x.jsxs("h3",{className:"font-semibold mb-2",children:["デプロイID: ",t.id]}),t.deploy_url&&x.jsxs("a",{href:t.deploy_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-800 flex items-center",children:[t.deploy_url.replace(/^https?:\/\//,""),x.jsx(g,{className:"w-3 h-3 ml-1"})]})]}),x.jsx(S,{id:t.id,onStatusChange:r=>{return a=t.id,l=r,s(e=>e.map(e=>e.id===a?i(n({},e),{status:l.status||e.status,deploy_url:l.deploy_url||e.deploy_url}):e)),void p("deploymentHistory",JSON.stringify(e.map(e=>e.id===a?i(n({},e),{status:l.status||e.status,deploy_url:l.deploy_url||e.deploy_url}):e)));var a,l}})]})},t.id))}),x.jsx(u,{className:"p-6 bg-blue-50 border-blue-200",children:x.jsxs("div",{className:"flex items-start space-x-3",children:[x.jsx(_,{className:"w-6 h-6 text-blue-600 mt-1"}),x.jsxs("div",{children:[x.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"デプロイ履歴について"}),x.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[x.jsx("p",{children:"• デプロイ履歴はブラウザのローカルストレージに保存されます"}),x.jsx("p",{children:"• 別のブラウザやデバイスでは履歴が共有されません"}),x.jsx("p",{children:"• 各デプロイの最新ステータスを確認できます"}),x.jsx("p",{children:"• 「更新」ボタンをクリックすると最新の状態を取得します"})]})]})]})})]})}export{O as DeploymentHistory};

import{l as N,j as e,B as o,C as f,F as v,a as w}from"./index-BB1ywuBb.js";import{r as n,L as p}from"./react-vendor-Co5xHYdE.js";import{g as _}from"./deploymentStatus-ZSenpuF1.js";import{e as S,A as g,a9 as b,_ as k,Z as j,C,p as L}from"./ui-vendor-B2-VOB5s.js";import"./supabase-vendor-FDBaXLCh.js";function D({id:l,onStatusChange:x,className:d=""}){const[c,u]=n.useState(null),[h,m]=n.useState(!1),[s,t]=n.useState(null),r=n.useCallback(async()=>{if(l)try{m(!0),t(null);const a=await _({id:l});u(a),x&&x(a)}catch(a){N("error","Error checking deployment status:",{error:a}),t(a.message||"デプロイステータスの取得に失敗しました")}finally{m(!1)}},[l,x]);n.useEffect(()=>{l&&r()},[l,r]);const i=a=>{switch(a){case"ready":return"text-green-600 bg-green-100";case"error":case"failed":return"text-red-600 bg-red-100";case"building":case"enqueued":case"processing":return"text-blue-600 bg-blue-100";default:return"text-gray-600 bg-gray-100"}},y=a=>{switch(a){case"ready":return"完了";case"error":case"failed":return"失敗";case"building":return"ビルド中";case"enqueued":return"待機中";case"processing":return"処理中";default:return a}};return h?e.jsxs("div",{className:`flex items-center space-x-2 ${d}`,children:[e.jsx(S,{className:"w-4 h-4 text-blue-600 animate-spin"}),e.jsx("span",{className:"text-sm text-gray-600",children:"ステータスを確認中..."})]}):s?e.jsxs("div",{className:`flex items-center space-x-2 ${d}`,children:[e.jsx(g,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"text-sm text-red-600",children:s}),e.jsx(o,{size:"sm",variant:"secondary",onClick:()=>void r(),children:"再試行"})]}):c?e.jsxs("div",{className:`space-y-2 ${d}`,children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"ステータス:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${i(c.status||"")}`,children:y(c.status||"")})]}),c.deploy_url&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"URL:"}),e.jsxs("a",{href:c.deploy_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-800 flex items-center",children:[c.deploy_url.replace(/^https?:\/\//,""),e.jsx(b,{className:"w-3 h-3 ml-1"})]})]}),e.jsx(o,{size:"sm",variant:"secondary",onClick:()=>void r(),children:"更新"})]}):e.jsx("div",{className:`flex items-center space-x-2 ${d}`,children:e.jsx(o,{size:"sm",onClick:()=>void r(),children:"ステータスを確認"})})}function H(){const[l,x]=n.useState([]),[d,c]=n.useState(!0);n.useEffect(()=>{(()=>{try{const t=v("deploymentHistory");t&&x(JSON.parse(t))}catch(t){console.error("Error loading deployment history:",t)}finally{c(!1)}})()},[]);const u=(s,t)=>{x(r=>r.map(i=>i.id===s?{...i,status:t.status||i.status,deploy_url:t.deploy_url||i.deploy_url}:i)),w("deploymentHistory",JSON.stringify(l.map(r=>r.id===s?{...r,status:t.status||r.status,deploy_url:t.deploy_url||r.deploy_url}:r)))},h=s=>{switch(s){case"ready":return"text-green-600 bg-green-100";case"error":case"failed":return"text-red-600 bg-red-100";case"building":case"enqueued":case"processing":return"text-blue-600 bg-blue-100";default:return"text-gray-600 bg-gray-100"}},m=s=>{switch(s){case"ready":return"完了";case"error":case"failed":return"失敗";case"building":return"ビルド中";case"enqueued":return"待機中";case"processing":return"処理中";default:return s}};return d?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center space-x-4 mb-6",children:e.jsxs(p,{to:"/deploy",className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"デプロイページに戻る"]})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-4 flex items-center justify-center",children:[e.jsx(j,{className:"w-8 h-8 text-blue-600 mr-3"}),"デプロイ履歴"]}),e.jsx("p",{className:"text-lg text-gray-600",children:"過去のデプロイ履歴を確認できます"})]}),error&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 rounded-lg flex items-start",children:[e.jsx(g,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsx("p",{className:"text-red-800",children:error})]}),l.length===0?e.jsxs(f,{className:"p-6 text-center",children:[e.jsx(C,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-700 mb-2",children:"デプロイ履歴がありません"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"まだデプロイを行っていないようです"}),e.jsx(p,{to:"/deploy",children:e.jsxs(o,{children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"デプロイを開始する"]})})]}):e.jsx("div",{className:"space-y-4",children:l.map(s=>e.jsx(f,{className:"p-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${h(s.status)}`,children:m(s.status)}),e.jsx("span",{className:"text-sm text-gray-500",children:new Date(s.created_at).toLocaleString("ja-JP")})]}),e.jsxs("h3",{className:"font-semibold mb-2",children:["デプロイID: ",s.id]}),s.deploy_url&&e.jsxs("a",{href:s.deploy_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-800 flex items-center",children:[s.deploy_url.replace(/^https?:\/\//,""),e.jsx(b,{className:"w-3 h-3 ml-1"})]})]}),e.jsx(D,{id:s.id,onStatusChange:t=>u(s.id,t)})]})},s.id))}),e.jsx(f,{className:"p-6 bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(L,{className:"w-6 h-6 text-blue-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"デプロイ履歴について"}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("p",{children:"• デプロイ履歴はブラウザのローカルストレージに保存されます"}),e.jsx("p",{children:"• 別のブラウザやデバイスでは履歴が共有されません"}),e.jsx("p",{children:"• 各デプロイの最新ステータスを確認できます"}),e.jsx("p",{children:"• 「更新」ボタンをクリックすると最新の状態を取得します"})]})]})]})})]})}export{H as DeploymentHistory};

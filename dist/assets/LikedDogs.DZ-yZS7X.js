var e=(e,s,a)=>new Promise(((l,t)=>{var r=e=>{try{i(a.next(e))}catch(s){t(s)}},n=e=>{try{i(a.throw(e))}catch(s){t(s)}},i=e=>e.done?l(e.value):Promise.resolve(e.value).then(r,n);i((a=a.apply(e,s)).next())}));import{u as s,s as a,j as l,S as t,C as r,B as n}from"./index.D9xag4tn.js";import{u as i,r as o,L as c}from"./router.BWT_vQps.js";import{A as d,Y as x,a4 as m,a2 as u,c as h,U as g}from"./ui.BPlS2KKq.js";import"./vendor.D1SiiUJb.js";import"./supabase.CZ8ekJUM.js";function j(){const{user:j}=s(),p=i(),[f,v]=o.useState([]),[b,N]=o.useState([]),[y,w]=o.useState(!0),[_,C]=o.useState(""),[k,S]=o.useState(""),[D,L]=o.useState(""),[T,q]=o.useState(""),[M,$]=o.useState("latest");o.useEffect((()=>{j?P():p("/login")}),[j,p]),o.useEffect((()=>{z()}),[f,k,D,T,M]);const P=()=>e(null,null,(function*(){try{w(!0),C("");const{data:e,error:s}=yield a.from("dog_likes").select("\n          *,\n          dog:dogs (\n            *,\n            vaccine_certifications (*)\n          )\n        ").eq("user_id",null==j?void 0:j.id).order("created_at",{ascending:!1});if(s)throw s;v(e||[])}catch(e){C("ã„ã„ã­ã—ãŸãƒ¯ãƒ³ã¡ã‚ƒã‚“ã®æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚")}finally{w(!1)}})),z=()=>{let e=[...f];switch(k&&(e=e.filter((e=>e.dog.name.toLowerCase().includes(k.toLowerCase())||e.dog.breed.toLowerCase().includes(k.toLowerCase())))),D&&(e=e.filter((e=>e.dog.breed===D))),T&&(e=e.filter((e=>e.dog.gender===T))),M){case"name":e.sort(((e,s)=>e.dog.name.localeCompare(s.dog.name)));break;case"breed":e.sort(((e,s)=>e.dog.breed.localeCompare(s.dog.breed)));break;default:e.sort(((e,s)=>new Date(s.created_at).getTime()-new Date(e.created_at).getTime()))}N(e)},E=e=>{const s=new Date(e),a=new Date,l=Math.abs(a.getTime()-s.getTime()),t=Math.ceil(l/864e5);if(t<365){return`${Math.floor(t/30)}ãƒ¶æœˆ`}return`${Math.floor(t/365)}æ­³`};return y?l.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:l.jsx("div",{className:"flex items-center justify-center py-20",children:l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})}):l.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[l.jsx(t,{title:"ã„ã„ã­ã—ãŸãƒ¯ãƒ³ã¡ã‚ƒã‚“ | ãƒ‰ãƒƒã‚°ãƒ‘ãƒ¼ã‚¯",description:"ã‚ãªãŸãŒã„ã„ã­ã—ãŸãƒ¯ãƒ³ã¡ã‚ƒã‚“ã®ä¸€è¦§ã§ã™ã€‚ãŠæ°—ã«å…¥ã‚Šã®ãƒ¯ãƒ³ã¡ã‚ƒã‚“ã‚’ç®¡ç†ã—ã¾ã—ã‚‡ã†ã€‚",keywords:"ã„ã„ã­, ãƒ¯ãƒ³ã¡ã‚ƒã‚“, ãƒšãƒƒãƒˆ, çŠ¬, ãŠæ°—ã«å…¥ã‚Š"}),l.jsxs("div",{className:"mb-8",children:[l.jsx("div",{className:"flex items-center space-x-4 mb-4",children:l.jsxs(c,{to:"/dashboard",className:"flex items-center text-blue-600 hover:text-blue-800 transition-colors",children:[l.jsx(d,{className:"w-5 h-5 mr-2"}),"ãƒã‚¤ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹"]})}),l.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[l.jsx(x,{className:"w-8 h-8 text-pink-600"}),l.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"ã„ã„ã­ã—ãŸãƒ¯ãƒ³ã¡ã‚ƒã‚“"})]}),l.jsxs("p",{className:"text-gray-600",children:["ã‚ãªãŸãŒã„ã„ã­ã—ãŸãƒ¯ãƒ³ã¡ã‚ƒã‚“ã®ä¸€è¦§ã§ã™ï¼ˆ",f.length,"åŒ¹ï¼‰"]})]}),_&&l.jsx("div",{className:"mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:_}),l.jsx(r,{className:"p-6 mb-6",children:l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[l.jsxs("div",{className:"relative",children:[l.jsx(m,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),l.jsx("input",{type:"text",placeholder:"åå‰ãƒ»çŠ¬ç¨®ã§æ¤œç´¢...",value:k,onChange:e=>S(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),l.jsxs("select",{value:D,onChange:e=>L(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[l.jsx("option",{value:"",children:"ã™ã¹ã¦ã®çŠ¬ç¨®"}),[...new Set(f.map((e=>e.dog.breed)))].sort().map((e=>l.jsx("option",{value:e,children:e},e)))]}),l.jsxs("select",{value:T,onChange:e=>q(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[l.jsx("option",{value:"",children:"ã™ã¹ã¦ã®æ€§åˆ¥"}),l.jsx("option",{value:"ã‚ªã‚¹",children:"ã‚ªã‚¹"}),l.jsx("option",{value:"ãƒ¡ã‚¹",children:"ãƒ¡ã‚¹"})]}),l.jsxs("select",{value:M,onChange:e=>$(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[l.jsx("option",{value:"latest",children:"ã„ã„ã­ã—ãŸé †"}),l.jsx("option",{value:"name",children:"åå‰é †"}),l.jsx("option",{value:"breed",children:"çŠ¬ç¨®é †"})]})]})}),0===b.length?l.jsxs(r,{className:"text-center py-16",children:[l.jsx(x,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),l.jsx("h2",{className:"text-xl font-semibold text-gray-700 mb-2",children:0===f.length?"ã¾ã ã„ã„ã­ã—ãŸãƒ¯ãƒ³ã¡ã‚ƒã‚“ã¯ã„ã¾ã›ã‚“":"æ¤œç´¢æ¡ä»¶ã«åˆã†ãƒ¯ãƒ³ã¡ã‚ƒã‚“ãŒã„ã¾ã›ã‚“"}),l.jsx("p",{className:"text-gray-600 mb-6",children:0===f.length?"æ°—ã«ãªã‚‹ãƒ¯ãƒ³ã¡ã‚ƒã‚“ãŒã„ãŸã‚‰ã€ã„ã„ã­ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼":"åˆ¥ã®æ¤œç´¢æ¡ä»¶ã‚’è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚"}),l.jsxs("div",{className:"space-x-4",children:[l.jsx(c,{to:"/community",children:l.jsx(n,{children:"ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚’è¦‹ã‚‹"})}),f.length>0&&l.jsx(n,{variant:"secondary",onClick:()=>{S(""),L(""),q(""),$("latest")},children:"ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ã‚¯ãƒªã‚¢"})]})]}):l.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:b.map((s=>l.jsxs(r,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[l.jsxs("div",{className:"aspect-square bg-gray-200 overflow-hidden relative",children:[s.dog.image_url?l.jsx("img",{src:s.dog.image_url,alt:s.dog.name,className:"w-full h-full object-cover"}):l.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400 text-6xl",children:"ğŸ•"}),l.jsx("button",{onClick:()=>{return l=s.dog_id,e(null,null,(function*(){try{const{error:e}=yield a.from("dog_likes").delete().eq("dog_id",l).eq("user_id",null==j?void 0:j.id);if(e)throw e;v((e=>e.filter((e=>e.dog_id!==l))))}catch(e){}}));var l},className:"absolute top-2 right-2 p-2 bg-white bg-opacity-90 hover:bg-opacity-100 rounded-full transition-opacity",title:"ã„ã„ã­ã‚’å–ã‚Šæ¶ˆã™",children:l.jsx(x,{className:"w-4 h-4 text-pink-500 fill-current"})})]}),l.jsxs("div",{className:"p-4",children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsxs("h3",{className:"font-semibold text-lg text-gray-900 truncate",children:[s.dog.name,"ã‚ªã‚¹"===s.dog.gender?"ãã‚“":"ã¡ã‚ƒã‚“"]}),l.jsx("span",{className:"text-sm text-gray-500",children:"ã‚ªã‚¹"===s.dog.gender?"â™‚":"â™€"})]}),l.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[l.jsxs("div",{className:"flex items-center",children:[l.jsx(u,{className:"w-4 h-4 mr-1"}),l.jsx("span",{children:s.dog.breed})]}),l.jsxs("div",{className:"flex items-center",children:[l.jsx(h,{className:"w-4 h-4 mr-1"}),l.jsx("span",{children:E(s.dog.birth_date)})]}),l.jsxs("div",{className:"flex items-center",children:[l.jsx(x,{className:"w-4 h-4 mr-1 text-pink-500"}),l.jsx("span",{children:new Date(s.created_at).toLocaleDateString("ja-JP")})]})]}),l.jsxs("div",{className:"mt-4 flex space-x-2",children:[l.jsx(c,{to:`/dog/${s.dog_id}`,className:"flex-1",children:l.jsx(n,{size:"sm",className:"w-full",children:"è©³ç´°ã‚’è¦‹ã‚‹"})}),l.jsx(c,{to:`/profile/${s.dog.owner_id}`,title:"é£¼ã„ä¸»ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«",children:l.jsx(n,{size:"sm",variant:"secondary",children:l.jsx(g,{className:"w-4 h-4"})})})]})]})]},s.id)))}),b.length>8&&l.jsx("div",{className:"mt-8 text-center",children:l.jsx(n,{variant:"secondary",onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),children:"ãƒšãƒ¼ã‚¸ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹"})})]})}export{j as LikedDogs};

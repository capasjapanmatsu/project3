import{M as e,j as t,o as n,P as s,q as o,r,L as i}from"./index.Drgpoyph.js";import{r as c}from"./vendor.CKEClKZl.js";class u extends c.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function l({children:n,isPresent:s}){const o=c.useId(),r=c.useRef(null),i=c.useRef({width:0,height:0,top:0,left:0}),{nonce:l}=c.useContext(e);return c.useInsertionEffect(()=>{const{width:e,height:t,top:n,left:c}=i.current;if(s||!r.current||!e||!t)return;r.current.dataset.motionPopId=o;const u=document.createElement("style");return l&&(u.nonce=l),document.head.appendChild(u),u.sheet&&u.sheet.insertRule(`\n          [data-motion-pop-id="${o}"] {\n            position: absolute !important;\n            width: ${e}px !important;\n            height: ${t}px !important;\n            top: ${n}px !important;\n            left: ${c}px !important;\n          }\n        `),()=>{document.head.removeChild(u)}},[s]),t.jsx(u,{isPresent:s,childRef:r,sizeRef:i,children:c.cloneElement(n,{ref:r})})}const a=({children:e,initial:o,isPresent:r,onExitComplete:i,custom:u,presenceAffectsLayout:a,mode:p})=>{const f=n(d),h=c.useId(),m=c.useCallback(e=>{f.set(e,!0);for(const t of f.values())if(!t)return;i&&i()},[f,i]),x=c.useMemo(()=>({id:h,initial:o,isPresent:r,custom:u,onExitComplete:m,register:e=>(f.set(e,!1),()=>f.delete(e))}),a?[Math.random(),m]:[r,m]);return c.useMemo(()=>{f.forEach((e,t)=>f.set(t,!1))},[r]),c.useEffect(()=>{!r&&!f.size&&i&&i()},[r]),"popLayout"===p&&(e=t.jsx(l,{isPresent:r,children:e})),t.jsx(s.Provider,{value:x,children:e})};function d(){return new Map}const p=e=>e.key||"";function f(e){const t=[];return c.Children.forEach(e,e=>{c.isValidElement(e)&&t.push(e)}),t}const h=({children:e,custom:s,initial:u=!0,onExitComplete:l,presenceAffectsLayout:d=!0,mode:h="sync",propagate:m=!1})=>{const[x,g]=o(m),E=c.useMemo(()=>f(e),[e]),C=m&&!x?[]:E.map(p),P=c.useRef(!0),R=c.useRef(E),j=n(()=>new Map),[v,w]=c.useState(E),[y,M]=c.useState(E);r(()=>{P.current=!1,R.current=E;for(let e=0;e<y.length;e++){const t=p(y[e]);C.includes(t)?j.delete(t):!0!==j.get(t)&&j.set(t,!1)}},[y,C.length,C.join("-")]);const L=[];if(E!==v){let e=[...E];for(let t=0;t<y.length;t++){const n=y[t],s=p(n);C.includes(s)||(e.splice(t,0,n),L.push(n))}return"wait"===h&&L.length&&(e=L),M(f(e)),void w(E)}const{forceRender:$}=c.useContext(i);return t.jsx(t.Fragment,{children:y.map(e=>{const n=p(e),o=!(m&&!x)&&(E===y||C.includes(n));return t.jsx(a,{isPresent:o,initial:!(P.current&&!u)&&void 0,custom:o?void 0:s,presenceAffectsLayout:d,mode:h,onExitComplete:o?void 0:()=>{if(!j.has(n))return;j.set(n,!0);let e=!0;j.forEach(t=>{t||(e=!1)}),e&&(null==$||$(),M(R.current),m&&(null==g||g()),l&&l())},children:e},n)})})};export{h as A};

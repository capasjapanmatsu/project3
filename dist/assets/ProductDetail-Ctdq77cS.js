import{u as s,c as e,s as a,j as t,B as l}from"./index-T-nty6Ge.js";import{h as r,u as c,r as i,L as n}from"./vendor-BHVjIt_u.js";import{C as d}from"./Card-DW8Xk96S.js";import{D as x,ak as m,C as o,Z as h,_ as p,t as j,a as u,v as g,g as N,S as b,al as f,X as y}from"./ui-srxHNTHo.js";import"./supabase-CKbzEL5D.js";function v(){const{productId:v}=r(),{user:w}=s(),_=c(),[k,C]=i.useState(null),[q,F]=i.useState([]),[S,z]=i.useState(1),[O,E]=i.useState(!0),{isActive:L}=e(),[M,P]=i.useState([]),[$,A]=i.useState(0),[B,D]=i.useState(!1);i.useEffect((()=>{v&&I()}),[v,w]);const I=async()=>{try{const[s,e,t]=await Promise.all([a.from("products").select("*").eq("id",v).eq("is_active",!0).single(),w?a.from("cart_items").select("*, product:products(*)").eq("user_id",w.id):Promise.resolve({data:[]}),a.from("product_images").select("*").eq("product_id",v).order("display_order",{ascending:!0})]);if(s.error)return void _("/shop");C(s.data),F(e.data||[]);const l=[];s.data.image_url&&l.push({id:"main",url:s.data.image_url}),!t.error&&t.data&&t.data.forEach((s=>{l.push({id:s.id,url:s.image_url})})),P(l)}catch(s){_("/shop")}finally{E(!1)}},Q=async()=>{if(w&&k)try{const s=q.find((s=>s.product_id===k.id));if(s){const{error:e}=await a.from("cart_items").update({quantity:s.quantity+S}).eq("id",s.id);if(e)throw e}else{const{error:s}=await a.from("cart_items").insert([{user_id:w.id,product_id:k.id,quantity:S}]);if(s)throw s}await I(),alert("カートに追加しました！")}catch(s){alert("カートへの追加に失敗しました。")}else _("/login")},T=()=>{A((s=>(s+1)%M.length))},Z=()=>{A((s=>(s-1+M.length)%M.length))};if(O)return t.jsx("div",{className:"flex justify-center items-center h-64",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})});if(!k)return t.jsxs("div",{className:"text-center py-12",children:[t.jsx("p",{className:"text-gray-600",children:"商品が見つかりませんでした"}),t.jsx(l,{onClick:()=>_("/shop"),className:"mt-4",children:"ショップに戻る"})]});const G=k.price,H=(J=G,L?Math.round(.9*J):J);var J;const K=L&&H<G,R=(()=>{const s=q.find((s=>s.product_id===k?.id));return s?s.quantity:0})();return t.jsxs("div",{className:"max-w-6xl mx-auto",children:[t.jsx("div",{className:"mb-6",children:t.jsxs("button",{onClick:()=>_("/shop"),className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[t.jsx(x,{className:"w-4 h-4 mr-2"}),"ショップに戻る"]})}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"relative",children:[M.length>0?t.jsx("img",{src:M[$].url,alt:k.name,className:"w-full h-96 object-cover rounded-lg shadow-lg cursor-pointer",onClick:()=>(A($),void D(!0)),onError:s=>{s.currentTarget.src="https://images.pexels.com/photos/1108099/pexels-photo-1108099.jpeg"}}):t.jsx("div",{className:"w-full h-96 bg-gray-200 rounded-lg flex items-center justify-center",children:t.jsx(m,{className:"w-16 h-16 text-gray-400"})}),K&&t.jsx("div",{className:"absolute top-4 left-4",children:t.jsxs("span",{className:"bg-purple-500 text-white px-3 py-1 rounded-full text-sm font-medium flex items-center",children:[t.jsx(o,{className:"w-4 h-4 mr-1"}),"10%OFF"]})}),k.stock_quantity<=5&&t.jsx("div",{className:"absolute top-4 right-4",children:t.jsxs("span",{className:"bg-red-500 text-white px-3 py-1 rounded-full text-sm font-medium",children:["残り",k.stock_quantity,"個"]})}),M.length>1&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:Z,className:"absolute left-2 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-75 rounded-full p-2 hover:bg-opacity-100 transition-opacity",children:t.jsx(h,{className:"w-5 h-5 text-gray-800"})}),t.jsx("button",{onClick:T,className:"absolute right-2 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-75 rounded-full p-2 hover:bg-opacity-100 transition-opacity",children:t.jsx(p,{className:"w-5 h-5 text-gray-800"})})]})]}),M.length>1&&t.jsx("div",{className:"grid grid-cols-6 gap-2",children:M.map(((s,e)=>t.jsx("div",{className:"h-16 rounded-lg overflow-hidden cursor-pointer border-2 "+(e===$?"border-green-500":"border-transparent"),onClick:()=>A(e),children:t.jsx("img",{src:s.url,alt:`${k.name} - サムネイル ${e+1}`,className:"w-full h-full object-cover"})},e)))})]}),t.jsxs("div",{className:"space-y-6",children:[L&&t.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-pink-500 text-white p-4 rounded-lg",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(o,{className:"w-5 h-5"}),t.jsx("span",{className:"font-semibold",children:"サブスク会員特典: 10%OFF"})]})}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded text-sm",children:(W=k.category,{food:"ドッグフード",treats:"おやつ",toys:"おもちゃ",accessories:"アクセサリー",health:"ヘルスケア",sheets:"ペットシーツ"}[W]||W)}),k.brand&&t.jsx("span",{className:"text-gray-500 text-sm",children:k.brand})]}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:k.name}),t.jsxs("div",{className:"mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("span",{className:"text-3xl font-bold text-green-600",children:["¥",H.toLocaleString()]}),K&&t.jsxs("span",{className:"text-xl text-gray-500 line-through",children:["¥",G.toLocaleString()]})]}),L&&t.jsx("p",{className:"text-sm text-purple-600 mt-1",children:"サブスク会員価格"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[k.weight&&t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(m,{className:"w-4 h-4 text-gray-500"}),t.jsxs("span",{className:"text-sm",children:["内容量: ",k.weight,"g"]})]}),k.size&&t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(m,{className:"w-4 h-4 text-gray-500"}),t.jsxs("span",{className:"text-sm",children:["サイズ: ",k.size]})]}),k.age_group&&"all"!==k.age_group&&t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(j,{className:"w-4 h-4 text-gray-500"}),t.jsxs("span",{className:"text-sm",children:["対象年齢: ",(V=k.age_group,{puppy:"子犬",adult:"成犬",senior:"シニア犬",all:"全年齢"}[V]||V)]})]}),k.dog_size&&"all"!==k.dog_size&&t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(u,{className:"w-4 h-4 text-gray-500"}),t.jsxs("span",{className:"text-sm",children:["対象サイズ: ",(U=k.dog_size,{small:"小型犬",medium:"中型犬",large:"大型犬",all:"全サイズ"}[U]||U)]})]})]}),t.jsx("div",{className:"mb-6",children:k.stock_quantity>0?t.jsxs("div",{className:"flex items-center space-x-2 text-green-600",children:[t.jsx(m,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm font-medium",children:"在庫あり"})]}):t.jsxs("div",{className:"flex items-center space-x-2 text-red-600",children:[t.jsx(m,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm font-medium",children:"在庫切れ"})]})}),k.stock_quantity>0&&t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"数量"}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("button",{onClick:()=>z(Math.max(1,S-1)),className:"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center hover:bg-gray-300 transition-colors",children:t.jsx(g,{className:"w-4 h-4"})}),t.jsx("span",{className:"text-xl font-medium w-12 text-center",children:S}),t.jsx("button",{onClick:()=>z(Math.min(k.stock_quantity,S+1)),className:"w-10 h-10 bg-green-600 text-white rounded-full flex items-center justify-center hover:bg-green-700 transition-colors",children:t.jsx(N,{className:"w-4 h-4"})})]}),R>0&&t.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["カートに",R,"個入っています"]})]}),t.jsx("div",{className:"space-y-3",children:k.stock_quantity>0?t.jsxs(t.Fragment,{children:[t.jsx(l,{onClick:async()=>{await Q(),_("/cart")},className:"w-full bg-green-600 hover:bg-green-700 text-lg py-3",children:"今すぐ購入"}),t.jsxs(l,{onClick:Q,variant:"secondary",className:"w-full text-lg py-3",children:[t.jsx(b,{className:"w-5 h-5 mr-2"}),"カートに追加"]})]}):t.jsx(l,{disabled:!0,className:"w-full text-lg py-3",children:"在庫切れ"})})]})]})]}),t.jsxs("div",{className:"mt-12 grid grid-cols-1 lg:grid-cols-3 gap-8",children:[t.jsx("div",{className:"lg:col-span-2",children:t.jsxs(d,{className:"p-6",children:[t.jsx("h2",{className:"text-xl font-semibold mb-4",children:"商品説明"}),t.jsx("p",{className:"text-gray-700 leading-relaxed whitespace-pre-line",children:k.description}),k.ingredients&&t.jsxs("div",{className:"mt-6",children:[t.jsx("h3",{className:"font-semibold mb-2",children:"原材料"}),t.jsx("p",{className:"text-gray-700 text-sm",children:k.ingredients})]})]})}),t.jsxs("div",{className:"space-y-4",children:[t.jsx(d,{className:"p-4",children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(f,{className:"w-5 h-5 text-blue-600 mt-1"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-blue-900 mb-1",children:"配送について"}),t.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[t.jsx("p",{children:"• 送料：全国一律¥690"}),t.jsxs("p",{children:["• ¥5,000以上のご注文で",t.jsx("span",{className:"font-medium",children:"送料無料"})]}),t.jsxs("p",{children:["• サブスク会員は",t.jsx("span",{className:"font-medium",children:"常に送料無料"})]}),t.jsx("p",{children:"• 平日14時までのご注文で翌日お届け"})]})]})]})}),t.jsx(d,{className:"p-4",children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(u,{className:"w-5 h-5 text-green-600 mt-1"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-green-900 mb-1",children:"品質保証"}),t.jsxs("div",{className:"text-sm text-green-800 space-y-1",children:[t.jsx("p",{children:"• 厳選された安全な原材料のみ使用"}),t.jsx("p",{children:"• 品質に問題がある場合は返品・交換対応"}),t.jsx("p",{children:"• 愛犬の健康を第一に考えた商品選定"})]})]})]})}),L?t.jsx(d,{className:"p-4 bg-purple-50 border-purple-200",children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(o,{className:"w-5 h-5 text-purple-600 mt-1"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-purple-900 mb-1",children:"会員特典"}),t.jsxs("div",{className:"text-sm text-purple-800 space-y-1",children:[t.jsx("p",{children:"• 全商品10%OFF"}),t.jsx("p",{children:"• 送料無料"}),t.jsx("p",{children:"• 優先カスタマーサポート"})]})]})]})}):t.jsx(d,{className:"p-4 bg-purple-50 border-purple-200",children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(o,{className:"w-5 h-5 text-purple-600 mt-1"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-purple-900 mb-1",children:"サブスク会員になると"}),t.jsxs("div",{className:"text-sm text-purple-800 space-y-1 mb-3",children:[t.jsx("p",{children:"• 全商品10%OFF"}),t.jsx("p",{children:"• 送料無料"}),t.jsx("p",{children:"• ドッグラン使い放題"})]}),t.jsx(n,{to:"/subscription",children:t.jsxs(l,{size:"sm",className:"w-full bg-purple-600 hover:bg-purple-700",children:[t.jsx(o,{className:"w-3 h-3 mr-1"}),"詳細を見る"]})})]})]})})]})]}),B&&t.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",children:[t.jsx("button",{onClick:()=>D(!1),className:"absolute top-4 right-4 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-opacity",children:t.jsx(y,{className:"w-6 h-6"})}),t.jsx("button",{onClick:Z,className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-opacity",children:t.jsx(h,{className:"w-6 h-6"})}),t.jsx("button",{onClick:T,className:"absolute right-4 top-1/2 transform -translate-y-1/2 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70 transition-opacity",children:t.jsx(p,{className:"w-6 h-6"})}),t.jsx("img",{src:M[$].url,alt:k.name,className:"max-h-[80vh] max-w-full"}),t.jsx("div",{className:"absolute bottom-4 left-0 right-0 text-center",children:t.jsxs("p",{className:"text-white text-sm",children:[$+1," / ",M.length]})})]})]});var U,V,W}export{v as ProductDetail};

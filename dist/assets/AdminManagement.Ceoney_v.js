var e=Object.defineProperty,s=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,l=(s,a,r)=>a in s?e(s,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[a]=r,c=(e,s)=>{for(var a in s||(s={}))i.call(s,a)&&l(e,a,s[a]);if(r)for(var a of r(s))t.call(s,a)&&l(e,a,s[a]);return e},n=(e,r)=>s(e,a(r)),d=(e,s,a)=>new Promise(((r,i)=>{var t=e=>{try{c(a.next(e))}catch(s){i(s)}},l=e=>{try{c(a.throw(e))}catch(s){i(s)}},c=e=>e.done?r(e.value):Promise.resolve(e.value).then(t,l);c((a=a.apply(e,s)).next())}));import{l as o,s as m,e as x,j as u,B as g,C as h,g as p,u as b}from"./index.oOj2R_C7.js";import{r as j,u as y,L as N}from"./router.icJHpBzt.js";import{u as f,a as v,A as I}from"./AdminParkApproval.DkK6YtXj.js";import{az as w,Y as _,R as C,aA as Z,X as B,h as O,aB as D,t as S,c as P,A as M,e as z}from"./ui.UnEvinBv.js";import"./vendor.D1SiiUJb.js";import"./supabase.CZ8ekJUM.js";const A=e=>d(null,null,(function*(){var s,a,r;try{o("info","🔧 Checking admin user setup for:",{email:e});const{data:{user:i},error:t}=yield m.auth.getUser();if(t)return o("error","❌ Error getting current user:",t),{success:!1,error:t.message};if(!i)return o("error","❌ No user found"),{success:!1,error:"No user found"};o("info","👤 Current user:",{id:i.id,email:i.email,metadata:i.user_metadata});const l=!0===(null==(s=i.user_metadata)?void 0:s.admin);if(o("info","🔍 Admin status:",{isAdmin:l}),!l)return o("error","❌ User is not admin"),{success:!1,error:"User is not admin"};const{data:c,error:n}=yield m.from("profiles").select("*").eq("id",i.id).single();if(n){if(o("error","❌ Error getting profile:",n),"PGRST116"===n.code){o("info","📝 Creating admin profile...");const{data:e,error:s}=yield m.from("profiles").insert({id:i.id,name:(null==(a=i.user_metadata)?void 0:a.name)||(null==(r=i.email)?void 0:r.split("@")[0])||"Admin",user_type:"admin",email:i.email,postal_code:"",address:"",phone_number:"",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}).select().single();return s?(o("error","❌ Error creating admin profile:",s),{success:!1,error:s.message}):(o("info","✅ Admin profile created successfully:",e),{success:!0,profile:e,message:"Admin profile created successfully"})}return{success:!1,error:n.message}}if("admin"!==c.user_type){o("info","🔄 Updating user type to admin...");const{data:e,error:s}=yield m.from("profiles").update({user_type:"admin",updated_at:(new Date).toISOString()}).eq("id",i.id).select().single();return s?(o("error","❌ Error updating profile to admin:",s),{success:!1,error:s.message}):(o("info","✅ Profile updated to admin successfully:",e),{success:!0,profile:e,message:"Profile updated to admin successfully"})}return o("info","✅ Admin user already set up correctly:",c),{success:!0,profile:c,message:"Admin user already set up correctly"}}catch(i){return o("error","❌ Exception in checkAndSetAdminUser:",{error:x(i)}),{success:!1,error:x(i)}}})),k=({pendingVaccines:e,isLoading:s,onApprovalComplete:a,onError:r})=>{const[i,t]=j.useState(null),[l,o]=j.useState(""),[m,x]=j.useState({}),[b,y]=j.useState({}),[N,v]=j.useState(null),[I,P]=j.useState(1),[M,z]=j.useState(!1),[A,k]=j.useState({rabies_expiry_date:"",combo_expiry_date:""}),W=f(),G=(e,s)=>d(null,null,(function*(){try{const i=yield W.handleVaccineApproval(e,s,l);i.success?(a(i.message),t(null),o("")):r(i.message)}catch(i){r(`処理中にエラーが発生しました: ${i.message}`)}})),H=e=>{x((s=>n(c({},s),{[e]:!1})))},L=e=>{x((s=>n(c({},s),{[e]:!1}))),y((s=>n(c({},s),{[e]:!0})))},V=e=>{x((s=>n(c({},s),{[e]:!0}))),y((s=>n(c({},s),{[e]:!1})))},R=(e,s,a)=>{v({src:e,alt:s,type:a}),P(1)},E=()=>{v(null),P(1)},T=()=>{P((e=>Math.min(e+.5,3)))},U=()=>{P((e=>Math.max(e-.5,.5)))},J=e=>{k({rabies_expiry_date:e.rabies_expiry_date||"",combo_expiry_date:e.combo_expiry_date||""})},Q=e=>{if(!e)return"未設定";try{return new Date(e).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})}catch(s){return"無効な日付"}},$=e=>{if(!e)return!1;return new Date(e)<=new Date((new Date).getTime()+2592e6)},F=e=>{if(!e)return!1;return new Date(e)<new Date};return s?u.jsx("div",{className:"flex justify-center items-center h-64",children:u.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):i?(""===A.rabies_expiry_date&&""===A.combo_expiry_date&&J(i),u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[u.jsx(w,{className:"w-6 h-6 text-blue-600 mr-2"}),i.dog.name,"のワクチン証明書審査"]}),u.jsxs(g,{variant:"secondary",onClick:()=>{t(null),z(!1),k({rabies_expiry_date:"",combo_expiry_date:""})},children:[u.jsx(_,{className:"w-4 h-4 mr-2"}),"一覧に戻る"]})]}),u.jsxs(h,{className:"p-4",children:[u.jsx("h3",{className:"font-semibold mb-3",children:"犬の基本情報"}),u.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[u.jsxs("div",{children:[u.jsx("p",{className:"text-gray-600",children:"名前"}),u.jsx("p",{className:"font-medium",children:i.dog.name})]}),u.jsxs("div",{children:[u.jsx("p",{className:"text-gray-600",children:"犬種"}),u.jsx("p",{className:"font-medium",children:i.dog.breed})]}),u.jsxs("div",{children:[u.jsx("p",{className:"text-gray-600",children:"性別"}),u.jsx("p",{className:"font-medium",children:i.dog.gender})]}),u.jsxs("div",{children:[u.jsx("p",{className:"text-gray-600",children:"飼い主"}),u.jsx("p",{className:"font-medium",children:i.dog.owner.name})]})]})]}),u.jsxs(h,{className:"p-6",children:[u.jsxs("div",{className:"flex justify-between items-center mb-4",children:[u.jsx("h3",{className:"font-semibold",children:"ワクチン有効期限"}),u.jsx(g,{size:"sm",variant:"secondary",onClick:()=>z(!M),children:M?"キャンセル":"編集"})]}),M?u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"狂犬病ワクチン有効期限"}),u.jsx("input",{type:"date",value:A.rabies_expiry_date,onChange:e=>k((s=>n(c({},s),{rabies_expiry_date:e.target.value}))),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"混合ワクチン有効期限"}),u.jsx("input",{type:"date",value:A.combo_expiry_date,onChange:e=>k((s=>n(c({},s),{combo_expiry_date:e.target.value}))),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),u.jsxs("div",{className:"flex justify-end space-x-2",children:[u.jsx(g,{variant:"secondary",onClick:()=>{z(!1),J(i)},children:"キャンセル"}),u.jsx(g,{onClick:()=>{d(null,null,(function*(){if(i)try{const e=yield W.handleVaccineExpiryUpdate(i.id,A.rabies_expiry_date||null,A.combo_expiry_date||null);e.success?(a(e.message),z(!1),i&&(i.rabies_expiry_date=A.rabies_expiry_date||null,i.combo_expiry_date=A.combo_expiry_date||null)):r(e.message)}catch(e){r(`有効期限の更新に失敗しました: ${e.message}`)}}))},isLoading:W.isProcessing,className:"bg-blue-600 hover:bg-blue-700",children:"保存"})]})]}):u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"狂犬病ワクチン有効期限"}),u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx("p",{className:"font-medium "+(F(i.rabies_expiry_date)?"text-red-600":$(i.rabies_expiry_date)?"text-yellow-600":"text-green-600"),children:Q(i.rabies_expiry_date)}),F(i.rabies_expiry_date)&&u.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full",children:"期限切れ"}),$(i.rabies_expiry_date)&&!F(i.rabies_expiry_date)&&u.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:"期限間近"})]})]}),u.jsxs("div",{children:[u.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"混合ワクチン有効期限"}),u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx("p",{className:"font-medium "+(F(i.combo_expiry_date)?"text-red-600":$(i.combo_expiry_date)?"text-yellow-600":"text-green-600"),children:Q(i.combo_expiry_date)}),F(i.combo_expiry_date)&&u.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full",children:"期限切れ"}),$(i.combo_expiry_date)&&!F(i.combo_expiry_date)&&u.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:"期限間近"})]})]})]})]}),u.jsxs(h,{className:"p-6",children:[u.jsx("h3",{className:"font-semibold mb-4",children:"ワクチン証明書"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[u.jsxs("div",{children:[u.jsx("h4",{className:"font-medium mb-2",children:"狂犬病ワクチン"}),i.rabies_vaccine_image?u.jsxs("div",{className:"border rounded-lg overflow-hidden relative",children:[m[`rabies-${i.id}`]&&u.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 z-10",children:u.jsx(C,{className:"w-6 h-6 animate-spin text-gray-600"})}),u.jsx("img",{src:p(i.rabies_vaccine_image)||"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjNmNGY2Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzM3NDE1MSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPueUu+WDj+OBjOiqreOCgeWFpeOBv+OBvuOBm+OCk+OBp+OBl+OBnw==</dGV4dD48L3N2Zz4=",alt:"狂犬病ワクチン証明書",className:"w-full h-64 object-contain cursor-pointer hover:opacity-80 transition-opacity",onLoadStart:()=>V(`rabies-${i.id}`),onLoad:()=>H(`rabies-${i.id}`),onError:()=>L(`rabies-${i.id}`),onClick:()=>R(p(i.rabies_vaccine_image)||"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjNmNGY2Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzM3NDE1MSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPueUu+WDj+OBjOiqreOCgeWFpeOBv+OBvuOBm+OCk+OBp+OBl+OBnw==</dGV4dD48L3N2Zz4=","狂犬病ワクチン証明書","rabies")}),u.jsx("div",{className:"absolute top-2 left-2 bg-white bg-opacity-90 text-gray-800 p-1 rounded border shadow-sm",children:u.jsx(Z,{className:"w-4 h-4"})}),b[`rabies-${i.id}`]&&u.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-red-50 bg-opacity-90",children:u.jsxs("div",{className:"text-center",children:[u.jsx(B,{className:"w-12 h-12 text-red-500 mx-auto mb-2"}),u.jsx("p",{className:"text-red-700 font-medium",children:"画像が読み込めませんでした"})]})})]}):u.jsx("div",{className:"h-64 bg-gray-100 rounded-lg flex items-center justify-center",children:u.jsx("p",{className:"text-gray-500",children:"画像なし"})})]}),u.jsxs("div",{children:[u.jsx("h4",{className:"font-medium mb-2",children:"混合ワクチン"}),i.combo_vaccine_image?u.jsxs("div",{className:"border rounded-lg overflow-hidden relative",children:[m[`combo-${i.id}`]&&u.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 z-10",children:u.jsx(C,{className:"w-6 h-6 animate-spin text-gray-600"})}),u.jsx("img",{src:p(i.combo_vaccine_image)||"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjNmNGY2Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzM3NDE1MSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPueUu+WDj+OBjOiqreOCgeWFpeOBv+OBvuOBm+OCk+OBp+OBl+OBnw==</dGV4dD48L3N2Zz4=",alt:"混合ワクチン証明書",className:"w-full h-64 object-contain cursor-pointer hover:opacity-80 transition-opacity",onLoadStart:()=>V(`combo-${i.id}`),onLoad:()=>H(`combo-${i.id}`),onError:()=>L(`combo-${i.id}`),onClick:()=>R(p(i.combo_vaccine_image)||"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjNmNGY2Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzM3NDE1MSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPueUu+WDj+OBjOiqreOCgeWFpeOBv+OBvuOBm+OCk+OBp+OBl+OBnw==</dGV4dD48L3N2Zz4=","混合ワクチン証明書","combo")}),u.jsx("div",{className:"absolute top-2 left-2 bg-white bg-opacity-90 text-gray-800 p-1 rounded border shadow-sm",children:u.jsx(Z,{className:"w-4 h-4"})}),b[`combo-${i.id}`]&&u.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-red-50 bg-opacity-90",children:u.jsxs("div",{className:"text-center",children:[u.jsx(B,{className:"w-12 h-12 text-red-500 mx-auto mb-2"}),u.jsx("p",{className:"text-red-700 font-medium",children:"画像が読み込めませんでした"})]})})]}):u.jsx("div",{className:"h-64 bg-gray-100 rounded-lg flex items-center justify-center",children:u.jsx("p",{className:"text-gray-500",children:"画像なし"})})]})]})]}),u.jsxs(h,{className:"p-6",children:[u.jsx("h3",{className:"font-semibold mb-4",children:"審査結果"}),u.jsxs("div",{className:"mb-4",children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"却下理由（却下する場合のみ入力）"}),u.jsx("textarea",{value:l,onChange:e=>o(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,placeholder:"例: ワクチン証明書の有効期限が切れています。最新の証明書をアップロードしてください。"})]}),u.jsxs("div",{className:"flex justify-end space-x-3",children:[u.jsxs(g,{onClick:()=>{G(i.id,!1)},isLoading:W.isProcessing,className:"bg-red-600 hover:bg-red-700",children:[u.jsx(B,{className:"w-4 h-4 mr-2"}),"却下"]}),u.jsxs(g,{onClick:()=>{G(i.id,!0)},isLoading:W.isProcessing,className:"bg-green-600 hover:bg-green-700",children:[u.jsx(O,{className:"w-4 h-4 mr-2"}),"承認"]})]})]}),N&&u.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4",children:[u.jsxs("div",{className:"relative max-w-full max-h-full",children:[u.jsxs("div",{className:"absolute top-4 right-4 flex items-center space-x-2 z-10",children:[u.jsx("div",{className:"bg-white bg-opacity-90 text-gray-800 px-3 py-1 rounded border shadow-sm text-sm",children:"rabies"===N.type?"狂犬病ワクチン":"混合ワクチン"}),u.jsx(g,{size:"sm",onClick:U,className:"bg-white bg-opacity-90 shadow-lg text-gray-800 hover:bg-opacity-100 border border-gray-300",children:u.jsx(D,{className:"w-4 h-4"})}),u.jsx(g,{size:"sm",onClick:T,className:"bg-white bg-opacity-90 shadow-lg text-gray-800 hover:bg-opacity-100 border border-gray-300",children:u.jsx(Z,{className:"w-4 h-4"})}),u.jsx(g,{size:"sm",onClick:E,className:"bg-white bg-opacity-90 shadow-lg text-gray-800 hover:bg-opacity-100 border border-gray-300",children:u.jsx(B,{className:"w-4 h-4"})})]}),u.jsx("div",{className:"overflow-auto max-h-screen",children:u.jsx("img",{src:N.src,alt:N.alt,className:"max-w-none transition-transform duration-200",style:{transform:`scale(${I})`,transformOrigin:"center center"},onError:e=>{e.currentTarget.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjNmNGY2Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzM3NDE1MSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPueUu+WDj+OBjOiqreOCgeWFpeOBv+OBvuOBm+OCk+OBp+OBl+OBnw==</dGV4dD48L3N2Zz4="}})}),u.jsxs("div",{className:"absolute bottom-4 left-4 bg-white bg-opacity-90 text-gray-800 px-3 py-2 rounded border shadow-sm text-sm",children:[u.jsx("p",{children:"拡大/縮小: ズームボタンを使用"}),u.jsx("p",{children:"閉じる: Xボタンまたは画像外をクリック"})]})]}),u.jsx("div",{className:"absolute inset-0 -z-10",onClick:E})]})]})):u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"space-y-4",children:[u.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[u.jsx(w,{className:"w-6 h-6 text-blue-600 mr-2"}),"審査待ちワクチン証明書"]}),0===e.length?u.jsxs(h,{className:"text-center py-12",children:[u.jsx(O,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),u.jsx("p",{className:"text-gray-600",children:"審査待ちのワクチン証明書はありません"})]}):u.jsx("div",{className:"space-y-4",children:e.map((e=>u.jsx(h,{className:"p-6 hover:shadow-lg transition-shadow",children:u.jsxs("div",{className:"flex justify-between items-start",children:[u.jsxs("div",{className:"flex-1",children:[u.jsxs("h3",{className:"text-lg font-semibold mb-2",children:[e.dog.name,"のワクチン証明書"]}),u.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[u.jsxs("div",{children:[u.jsx("p",{className:"text-gray-600",children:"犬種"}),u.jsx("p",{className:"font-medium",children:e.dog.breed})]}),u.jsxs("div",{children:[u.jsx("p",{className:"text-gray-600",children:"性別"}),u.jsx("p",{className:"font-medium",children:e.dog.gender})]}),u.jsxs("div",{children:[u.jsx("p",{className:"text-gray-600",children:"飼い主"}),u.jsx("p",{className:"font-medium",children:e.dog.owner.name})]}),u.jsxs("div",{children:[u.jsx("p",{className:"text-gray-600",children:"申請日"}),u.jsx("p",{className:"font-medium",children:new Date(e.created_at).toLocaleDateString("ja-JP")})]})]})]}),u.jsxs("div",{className:"flex space-x-2 ml-4",children:[u.jsxs(g,{size:"sm",variant:"secondary",onClick:()=>t(e),children:[u.jsx(S,{className:"w-4 h-4 mr-1"}),"詳細"]}),u.jsxs(g,{size:"sm",onClick:()=>{G(e.id,!0)},className:"bg-green-600 hover:bg-green-700",disabled:W.isProcessing,children:[u.jsx(O,{className:"w-4 h-4 mr-1"}),"承認"]}),u.jsxs(g,{size:"sm",onClick:()=>{t(e),G(e.id,!1)},className:"bg-red-600 hover:bg-red-700",disabled:W.isProcessing,children:[u.jsx(B,{className:"w-4 h-4 mr-1"}),"却下"]})]})]})},e.id)))})]}),N&&u.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4",children:[u.jsxs("div",{className:"relative max-w-full max-h-full",children:[u.jsxs("div",{className:"absolute top-4 right-4 flex items-center space-x-2 z-10",children:[u.jsx("div",{className:"bg-white bg-opacity-90 text-gray-800 px-3 py-1 rounded border shadow-sm text-sm",children:"rabies"===N.type?"狂犬病ワクチン":"混合ワクチン"}),u.jsx(g,{size:"sm",onClick:U,className:"bg-white bg-opacity-90 shadow-lg text-gray-800 hover:bg-opacity-100 border border-gray-300",children:u.jsx(D,{className:"w-4 h-4"})}),u.jsx(g,{size:"sm",onClick:T,className:"bg-white bg-opacity-90 shadow-lg text-gray-800 hover:bg-opacity-100 border border-gray-300",children:u.jsx(Z,{className:"w-4 h-4"})}),u.jsx(g,{size:"sm",onClick:E,className:"bg-white bg-opacity-90 shadow-lg text-gray-800 hover:bg-opacity-100 border border-gray-300",children:u.jsx(B,{className:"w-4 h-4"})})]}),u.jsx("div",{className:"overflow-auto max-h-screen",children:u.jsx("img",{src:N.src,alt:N.alt,className:"max-w-none transition-transform duration-200",style:{transform:`scale(${I})`,transformOrigin:"center center"},onError:e=>{e.currentTarget.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjNmNGY2Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzM3NDE1MSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPueUu+WDj+OBjOiqreOCgeWFpeOBv+OBvuOBm+OCk+OBp+OBl+OBnw==</dGV4dD48L3N2Zz4="}})}),u.jsxs("div",{className:"absolute bottom-4 left-4 bg-white bg-opacity-90 text-gray-800 px-3 py-2 rounded border shadow-sm text-sm",children:[u.jsx("p",{children:"拡大/縮小: ズームボタンを使用"}),u.jsx("p",{children:"閉じる: Xボタンまたは画像外をクリック"})]})]}),u.jsx("div",{className:"absolute inset-0 -z-10",onClick:E})]})]})};function W(){const{user:e,isAdmin:s,userProfile:a}=b(),r=y(),[i,t]=j.useState("vaccines"),[l,c]=j.useState(""),[n,p]=j.useState(""),f=v(i),C=e=>{p(e),c(""),setTimeout((()=>p("")),5e3)},Z=e=>{c(e),p(""),setTimeout((()=>c("")),8e3)},B=()=>{c(""),p("")};j.useEffect((()=>{e&&!s&&d(null,null,(function*(){if("capasjapan@gmail.com"===(null==e?void 0:e.email)&&!s)try{(yield A(e.email)).success&&(C("管理者権限を設定しました。ページを再読み込みします..."),setTimeout((()=>window.location.reload()),1500))}catch(a){}}))}),[e,s]),j.useEffect((()=>{s?f.fetchData():r("/")}),[s,r,i]);const D=e=>d(null,null,(function*(){C(e),yield f.fetchData()})),S=e=>{Z(e)};return u.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[u.jsx("div",{className:"flex items-center space-x-4 mb-6",children:u.jsxs(N,{to:"/admin",className:"flex items-center text-blue-600 hover:text-blue-800",children:[u.jsx(_,{className:"w-4 h-4 mr-2"}),"管理者ダッシュボードに戻る"]})}),u.jsx("div",{className:"flex justify-between items-center",children:u.jsxs("h1",{className:"text-2xl font-bold flex items-center",children:[u.jsx(P,{className:"w-8 h-8 text-red-600 mr-3"}),"管理者審査ページ"]})}),l&&u.jsxs("div",{className:"mb-6 p-4 bg-red-50 rounded-lg flex items-start",children:[u.jsx(M,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),u.jsx("p",{className:"text-red-800",children:l})]}),n&&u.jsxs("div",{className:"mb-6 p-4 bg-green-50 rounded-lg flex items-start",children:[u.jsx(O,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),u.jsx("p",{className:"text-green-800",children:n})]}),!s&&u.jsxs(h,{className:"p-4 bg-red-50 border-l-4 border-red-500",children:[u.jsx("h3",{className:"font-semibold mb-3 text-red-900",children:"❌ 管理者権限が必要です"}),u.jsxs("div",{className:"text-sm text-red-800 space-y-2",children:[u.jsx("p",{children:u.jsx("strong",{children:"ユーザー情報:"})}),u.jsxs("p",{children:["• Email: ",(null==e?void 0:e.email)||"なし"]}),u.jsxs("p",{children:["• User Type: ",(null==a?void 0:a.user_type)||"undefined"]}),u.jsxs("p",{children:["• Is Admin: ",s?"true":"false"]}),"capasjapan@gmail.com"===(null==e?void 0:e.email)&&u.jsxs("div",{className:"mt-4 space-x-2",children:[u.jsx(g,{size:"sm",onClick:()=>d(null,null,(function*(){B();try{const s=yield A(e.email||"");s.success?(C("管理者権限を設定しました。ページを再読み込みします..."),setTimeout((()=>window.location.reload()),1500)):Z(`管理者権限の設定に失敗: ${s.error}`)}catch(s){Z(`エラーが発生しました: ${s.message}`)}})),className:"bg-blue-600 hover:bg-blue-700",children:"管理者権限を設定"}),u.jsx(g,{size:"sm",onClick:()=>d(null,null,(function*(){var s,a;if(B(),null==e?void 0:e.id)try{const r=yield(s=e.id,d(null,null,(function*(){try{o("info","🔧 Direct update user type:",{userId:s,userType:a});const{data:e,error:r}=yield m.from("profiles").update({user_type:a}).eq("id",s).select().single();return r?(o("error","❌ Direct update failed:",r),{success:!1,error:r.message}):(o("info","✅ Direct update successful:",e),{success:!0,data:e,message:"User type updated successfully"})}catch(l){return o("error","❌ Exception in directUpdateUserType:",{error:x(l)}),{success:!1,error:x(l)}}})));r.success?(C("プロファイルを更新しました。ページを再読み込みします..."),setTimeout((()=>window.location.reload()),1500)):Z(`プロファイル更新に失敗: ${r.error}`)}catch(r){Z(`エラーが発生しました: ${r.message}`)}else Z("ユーザーIDが見つかりません")})),className:"bg-orange-600 hover:bg-orange-700",children:"直接更新"})]})]})]}),s&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"flex space-x-4 border-b",children:[u.jsxs("button",{className:"px-4 py-2 font-medium "+("parks"===i?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>t("parks"),children:[u.jsx(z,{className:"w-4 h-4 inline mr-2"}),"ドッグラン審査"]}),u.jsxs("button",{className:"px-4 py-2 font-medium "+("vaccines"===i?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>t("vaccines"),children:[u.jsx(w,{className:"w-4 h-4 inline mr-2"}),"ワクチン証明書審査"]})]}),u.jsxs("div",{className:"mt-6",children:["parks"===i&&u.jsx(I,{pendingParks:f.pendingParks,isLoading:f.isLoading,onApprovalComplete:D,onError:S}),"vaccines"===i&&u.jsx(k,{pendingVaccines:f.pendingVaccines,isLoading:f.isLoading,onApprovalComplete:D,onError:S})]})]})]})}export{W as AdminManagement};

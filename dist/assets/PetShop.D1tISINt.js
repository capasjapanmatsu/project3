var e=(e,s,t)=>new Promise((a,r)=>{var l=e=>{try{c(t.next(e))}catch(s){r(s)}},i=e=>{try{c(t.throw(e))}catch(s){r(s)}},c=e=>e.done?a(e.value):Promise.resolve(e.value).then(l,i);c((t=t.apply(e,s)).next())});import{j as s,B as t,u as a,b as r,s as l,C as i}from"./index.CQlxbczY.js";import{r as c}from"./vendor.CKEClKZl.js";import{L as n}from"./router.B_7Atevv.js";import{I as o}from"./Input.DMWrIIWM.js";import{u as d}from"./useStripe.BHIkX24C.js";import{p as m}from"./stripe-config.03sBkt-B.js";import{o as x,j as h,S as u,an as p,ao as j,N as g,y as f,v as b,p as v,ap as N,aq as w}from"./ui.C72fRZ1L.js";import"./supabase.X3H3st79.js";import"./stripe.CcgPsVUa.js";function y({hasSubscription:a=!1,className:r="",variant:l="primary",size:i="md"}){const{createCheckoutSession:o,loading:h,error:u}=d(),[p,j]=c.useState(!1),g=()=>e(this,null,function*(){j(!1);const e=m.find(e=>"subscription"===e.mode);if(e)try{yield o({priceId:e.priceId,mode:"subscription",successUrl:`${window.location.origin}/dashboard?success=true`,cancelUrl:`${window.location.origin}/dashboard?canceled=true`})}catch(s){j(!0)}});return a?s.jsx(n,{to:"/subscription",children:s.jsxs(t,{variant:l,size:i,className:`flex items-center ${r}`,children:[s.jsx(x,{className:("sm"===i?"w-3 h-3":"w-4 h-4")+" mr-1"}),"サブスク管理"]})}):s.jsxs("div",{children:[s.jsxs(t,{onClick:()=>{g()},isLoading:h,variant:"primary",size:i,className:`flex items-center bg-purple-600 hover:bg-purple-700 text-white ${r}`,children:[s.jsx(x,{className:("sm"===i?"w-3 h-3":"w-4 h-4")+" mr-1"}),"サブスクに加入"]}),p&&u&&s.jsx("div",{className:"text-xs text-red-600 mt-1",children:u})]})}function _(){const{user:d}=a(),[m,_]=c.useState([]),[C,q]=c.useState([]),[S,k]=c.useState(!0),[L,z]=c.useState(""),[F,T]=c.useState("all"),[D,$]=c.useState("name"),{isActive:I}=r(),P=c.useDeferredValue(L),O=c.useDeferredValue(F),V=c.useDeferredValue(D),E=[{value:"all",label:"すべて",icon:h},{value:"food",label:"ドッグフード",icon:g},{value:"treats",label:"おやつ",icon:f},{value:"toys",label:"おもちゃ",icon:b},{value:"accessories",label:"アクセサリー",icon:x},{value:"health",label:"ヘルスケア",icon:v},{value:"sheets",label:"ペットシーツ",icon:g}];c.useEffect(()=>{M()},[d]);const M=()=>e(this,null,function*(){k(!0);try{yield Promise.all([U(),d?A():Promise.resolve()])}catch(e){}finally{k(!1)}}),U=()=>e(this,null,function*(){const{data:e,error:s}=yield l.from("products").select("*").eq("is_active",!0).order("created_at",{ascending:!1});if(s)throw s;_(e||[])}),A=()=>e(this,null,function*(){const{data:e,error:s}=yield l.from("cart_items").select("*, product:products(*)").eq("user_id",d.id);if(s)throw s;q(e||[])}),B=(s,t=1)=>e(this,null,function*(){if(d)try{const e=C.find(e=>e.product_id===s);if(e){const{error:s}=yield l.from("cart_items").update({quantity:e.quantity+t}).eq("id",e.id);if(s)throw s}else{const{error:e}=yield l.from("cart_items").insert([{user_id:d.id,product_id:s,quantity:t}]);if(e)throw e}yield M()}catch(e){}}),G=(s,t)=>e(this,null,function*(){if(t<=0)try{const{error:e}=yield l.from("cart_items").delete().eq("id",s);if(e)throw e;yield M()}catch(e){}else try{const{error:e}=yield l.from("cart_items").update({quantity:t}).eq("id",s);if(e)throw e;yield M()}catch(e){}}),H=e=>I?Math.round(.9*e):e,J=c.useMemo(()=>m.filter(e=>{const s=e.name.toLowerCase().includes(P.toLowerCase())||e.description.toLowerCase().includes(P.toLowerCase())||e.brand&&e.brand.toLowerCase().includes(P.toLowerCase()),t="all"===O||e.category===O;return s&&t}).sort((e,s)=>{switch(V){case"name":return e.name.localeCompare(s.name);case"price":return H(e.price)-H(s.price);case"category":return e.category.localeCompare(s.category);default:return new Date(s.created_at).getTime()-new Date(e.created_at).getTime()}}),[m,P,O,V]),K=e=>{c.startTransition(()=>{T(e)})};return S?s.jsx("div",{className:"flex justify-center items-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsxs("h1",{className:"text-2xl font-bold flex items-center",children:[s.jsx(h,{className:"w-8 h-8 text-green-600 mr-3"}),"ペットショップ"]}),s.jsx("p",{className:"text-gray-600",children:"愛犬のための厳選商品をお届け"})]}),s.jsx(n,{to:"/cart",children:s.jsxs(t,{className:"bg-green-600 hover:bg-green-700",children:[s.jsx(u,{className:"w-4 h-4 mr-2"}),"カート (",C.reduce((e,s)=>e+s.quantity,0),")"]})})]}),s.jsx("div",{className:"relative overflow-hidden",children:I?s.jsxs("div",{className:"bg-gradient-to-r from-purple-600 via-pink-600 to-purple-700 text-white p-8 rounded-xl shadow-2xl",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("div",{className:"bg-white/20 p-3 rounded-full",children:s.jsx(x,{className:"w-8 h-8"})}),s.jsxs("div",{children:[s.jsxs("h2",{className:"text-2xl font-bold mb-2 flex items-center",children:[s.jsx(p,{className:"w-6 h-6 mr-2"}),"サブスクリプション会員特典適用中！"]}),s.jsx("p",{className:"text-lg opacity-90",children:"全商品10%OFF + 送料無料でお買い物をお楽しみください"})]})]}),s.jsx("div",{className:"text-right",children:s.jsxs("div",{className:"bg-white/20 px-6 py-3 rounded-lg",children:[s.jsx("p",{className:"text-sm opacity-80",children:"今月の節約額"}),s.jsx("p",{className:"text-2xl font-bold",children:"¥1,200+"})]})})]}),s.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-16 -mt-16"}),s.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white/10 rounded-full -ml-12 -mb-12"})]}):s.jsxs("div",{className:"bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 text-white p-8 rounded-xl shadow-2xl",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("div",{className:"bg-white/20 p-3 rounded-full",children:s.jsx(j,{className:"w-8 h-8"})}),s.jsxs("div",{children:[s.jsxs("h2",{className:"text-2xl font-bold mb-2 flex items-center",children:[s.jsx(x,{className:"w-6 h-6 mr-2"}),"サブスク会員は全品10％OFF & 送料無料！"]}),s.jsx("p",{className:"text-lg opacity-90",children:"月額3,800円でどこでも使い放題 + ドッグラン使い放題"})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx(y,{hasSubscription:I,className:"bg-white text-purple-600 hover:bg-gray-100 font-bold px-6 py-3 text-lg"}),s.jsx("p",{className:"text-sm opacity-80 mt-2",children:"初月無料キャンペーン中"})]})]}),s.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-16 -mt-16"}),s.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white/10 rounded-full -ml-12 -mb-12"})]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsx("div",{className:"md:col-span-2",children:s.jsx(o,{label:"",value:L,onChange:e=>{return s=e.target.value,z(s),void c.startTransition(()=>{});var s},placeholder:"商品名、ブランド名で検索..."})}),s.jsx("div",{children:s.jsx("select",{value:F,onChange:e=>K(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",children:E.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))})}),s.jsx("div",{children:s.jsxs("select",{value:D,onChange:e=>{return s=e.target.value,void c.startTransition(()=>{$(s)});var s},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",children:[s.jsx("option",{value:"popular",children:"人気順"}),s.jsx("option",{value:"name",children:"名前順"}),s.jsx("option",{value:"price",children:"価格の安い順"}),s.jsx("option",{value:"category",children:"カテゴリー順"})]})})]}),s.jsx("div",{className:"flex space-x-2 overflow-x-auto pb-2",children:E.map(e=>{const t=e.icon;return s.jsxs("button",{onClick:()=>K(e.value),className:"flex items-center space-x-2 px-4 py-2 rounded-lg whitespace-nowrap transition-colors "+(F===e.value?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[s.jsx(t,{className:"w-4 h-4"}),s.jsx("span",{children:e.label})]},e.value)})}),0===J.length?s.jsxs(i,{className:"text-center py-12",children:[s.jsx(h,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"該当する商品が見つかりませんでした"})]}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:J.map(e=>{const a=(e=>{const s=C.find(s=>s.product_id===e);return s?s.quantity:0})(e.id),r=e.price,l=H(r),c=I&&l<r;return s.jsxs(i,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[s.jsxs("div",{className:"relative h-48 mb-4 -m-6 mb-4",children:[s.jsx("img",{src:e.image_url,alt:e.name,className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://images.pexels.com/photos/1108099/pexels-photo-1108099.jpeg"}}),c&&s.jsx("div",{className:"absolute top-3 left-3",children:s.jsxs("span",{className:"bg-purple-500 text-white px-2 py-1 rounded-full text-xs font-medium flex items-center",children:[s.jsx(x,{className:"w-3 h-3 mr-1"}),"10%OFF"]})}),e.stock_quantity<=5&&s.jsx("div",{className:"absolute top-3 right-3",children:s.jsxs("span",{className:"bg-red-500 text-white px-2 py-1 rounded-full text-xs font-medium",children:["残り",e.stock_quantity,"個"]})})]}),s.jsxs("div",{className:"px-6 pb-6",children:[s.jsxs("div",{className:"mb-2",children:[e.brand&&s.jsx("p",{className:"text-xs text-gray-500 mb-1",children:e.brand}),s.jsx("h3",{className:"text-lg font-semibold line-clamp-2",children:e.name})]}),s.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:e.description}),s.jsxs("div",{className:"space-y-1 text-xs text-gray-500 mb-3",children:[e.weight&&s.jsxs("p",{children:["内容量: ",e.weight,"g"]}),e.size&&s.jsxs("p",{children:["サイズ: ",e.size]}),e.age_group&&"all"!==e.age_group&&s.jsxs("p",{children:["対象年齢: ","puppy"===e.age_group?"子犬":"adult"===e.age_group?"成犬":"シニア犬"]}),e.dog_size&&"all"!==e.dog_size&&s.jsxs("p",{children:["対象サイズ: ","small"===e.dog_size?"小型犬":"medium"===e.dog_size?"中型犬":"大型犬"]})]}),s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("span",{className:"text-xl font-bold text-green-600",children:["¥",l.toLocaleString()]}),c&&s.jsxs("span",{className:"text-sm text-gray-500 line-through",children:["¥",r.toLocaleString()]})]}),I&&s.jsxs("p",{className:"text-xs text-purple-600 flex items-center",children:[s.jsx(x,{className:"w-3 h-3 mr-1"}),"サブスク会員価格"]})]}),s.jsxs("div",{className:"space-y-2",children:[a>0?s.jsxs("div",{className:"flex items-center justify-between bg-gray-50 rounded-lg p-2",children:[s.jsx("button",{onClick:()=>{const s=C.find(s=>s.product_id===e.id);s&&G(s.id,a-1)},className:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center hover:bg-gray-300 transition-colors",children:s.jsx(N,{className:"w-4 h-4"})}),s.jsx("span",{className:"font-medium",children:a}),s.jsx("button",{onClick:()=>{const s=C.find(s=>s.product_id===e.id);s&&G(s.id,a+1)},className:"w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center hover:bg-green-700 transition-colors",children:s.jsx(v,{className:"w-4 h-4"})})]}):s.jsx(t,{onClick:()=>B(e.id),className:"w-full bg-green-600 hover:bg-green-700",disabled:0===e.stock_quantity,children:0===e.stock_quantity?"在庫切れ":s.jsxs(s.Fragment,{children:[s.jsx(u,{className:"w-4 h-4 mr-2"}),"カートに追加"]})}),s.jsx(n,{to:`/shop/product/${e.id}`,children:s.jsx(t,{variant:"secondary",className:"w-full",children:"詳細を見る"})})]})]})]},e.id)})}),s.jsx(i,{className:"bg-blue-50 border-blue-200",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(w,{className:"w-6 h-6 text-blue-600 mt-1"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"配送について"}),s.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[s.jsx("p",{children:"• 送料：全国一律¥690"}),s.jsxs("p",{children:["• ¥5,000以上のご注文で",s.jsx("span",{className:"font-medium",children:"送料無料"})]}),s.jsxs("p",{children:["• サブスク会員は",s.jsx("span",{className:"font-medium",children:"常に送料無料"})]}),s.jsx("p",{children:"• 平日14時までのご注文で翌日お届け"}),s.jsx("p",{children:"• 土日祝日も配送いたします"})]})]})]})})]})}export{_ as PetShop};

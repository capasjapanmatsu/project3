import{s as T,F as g,a as m,j as e,C as _,B as y}from"./index-fyCrE4_U.js";import{u as U,r as o,L as A}from"./react-vendor-Co5xHYdE.js";import{g as q}from"./deploymentStatus-BgtY9cdA.js";import{V as $,Q as h,A as B,i as z,a6 as k,k as G,R as F,Z as K,C as P}from"./ui-vendor-C9ptRAmi.js";import"./supabase-vendor-FDBaXLCh.js";async function C(n={}){try{const{data:{session:l}}=await T.auth.getSession();if(!l?.access_token)throw new Error("認証が必要です");const i=await fetch("https://onmcivwxtzqajcovptgf.supabase.co/functions/v1/deploy-to-netlify",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l.access_token}`},body:JSON.stringify({buildCommand:n.buildCommand||"npm run build",outputDir:n.outputDir||"dist",siteId:n.siteId,deployId:n.deployId,netlifyApiKey:"your_netlify_api_key"})});if(!i.ok){const u=await i.json();throw new Error(u.error||"デプロイに失敗しました")}return await i.json()}catch(l){throw console.error("Deploy error:",l),l}}async function D(n,l){try{return await C({siteId:n,deployId:l})}catch(i){throw console.error("Error getting deployment status:",i),i}}function Y(){const n=U(),[l,i]=o.useState(!1),[u,x]=o.useState(!1),[a,p]=o.useState(null),[N,c]=o.useState(null),[j,d]=o.useState(null),[L,b]=o.useState(!1);o.useEffect(()=>{const s=g("lastDeployment");if(s)try{const r=JSON.parse(s);p(r),r.site_id&&r.deploy_id&&v(r.site_id,r.deploy_id)}catch(r){console.error("Error parsing saved deployment:",r),Q("lastDeployment")}},[]);const w=async()=>{try{i(!0),c(null),d(null);const s=await C();p(s),d("デプロイが開始されました！ステータスを確認してください。"),m("lastDeployment",JSON.stringify(s)),E(s);const r=setInterval(async()=>{try{const t=await D(s.site_id,s.deploy_id);p(t),["ready","error","failed"].includes(t.status)&&(clearInterval(r),t.status==="ready"?d("デプロイが完了しました！以下のURLでサイトを確認できます。"):c("デプロイに失敗しました。詳細はNetlifyダッシュボードで確認してください。")),m("lastDeployment",JSON.stringify(t)),S(t)}catch(t){console.error("Error checking deployment status:",t)}},5e3);return()=>clearInterval(r)}catch(s){c(s.message||"デプロイに失敗しました")}finally{i(!1)}},v=async(s,r)=>{try{x(!0),c(null);const t=await D(s,r);p(t),m("lastDeployment",JSON.stringify(t)),S(t),t.status==="ready"?d("デプロイが完了しています！以下のURLでサイトを確認できます。"):["error","failed"].includes(t.status)?c("デプロイに失敗しました。詳細はNetlifyダッシュボードで確認してください。"):d("デプロイは進行中です。ステータスを確認してください。")}catch(t){console.error("Error checking deployment status:",t),c(t.message||"デプロイステータスの確認に失敗しました")}finally{x(!1)}},E=s=>{try{const r=g("deploymentHistory");let t=r?JSON.parse(r):[];t.unshift({...s,created_at:new Date().toISOString()}),t.length>10&&(t=t.slice(0,10)),m("deploymentHistory",JSON.stringify(t))}catch(r){console.error("Error adding to deployment history:",r)}},S=s=>{try{const r=g("deploymentHistory");if(!r)return;let t=JSON.parse(r);t=t.map(f=>f.deploy_id===s.deploy_id?{...f,status:s.status,deploy_url:s.deploy_url}:f),m("deploymentHistory",JSON.stringify(t))}catch(r){console.error("Error updating deployment history:",r)}},I=s=>{navigator.clipboard.writeText(s).then(()=>{b(!0),setTimeout(()=>b(!1),2e3)})},R=s=>{switch(s){case"ready":return"text-green-600 bg-green-100";case"error":case"failed":return"text-red-600 bg-red-100";case"building":case"enqueued":case"processing":return"text-blue-600 bg-blue-100";default:return"text-gray-600 bg-gray-100"}},O=s=>{switch(s){case"ready":return"完了";case"error":case"failed":return"失敗";case"building":return"ビルド中";case"enqueued":return"待機中";case"processing":return"処理中";default:return s}},H=()=>{a?.site_id&&a?.deploy_id&&v(a.site_id,a.deploy_id)},J=async()=>{try{x(!0),c(null);const s=await q({});console.log("Deployment status:",s),s.status==="ready"&&d("デプロイが完了しています！以下のURLでサイトを確認できます。")}catch(s){console.error("Error checking deployment status:",s),c(s.message||"デプロイステータスの確認に失敗しました")}finally{x(!1)}};return e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center space-x-4 mb-6",children:e.jsxs(A,{to:"/dashboard",className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"ダッシュボードに戻る"]})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-4 flex items-center justify-center",children:[e.jsx(h,{className:"w-8 h-8 text-blue-600 mr-3"}),"サイトをデプロイ"]}),e.jsx("p",{className:"text-lg text-gray-600",children:"あなたのアプリケーションをNetlifyにデプロイします"})]}),N&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 rounded-lg flex items-start",children:[e.jsx(B,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsx("p",{className:"text-red-800",children:N})]}),j&&e.jsxs("div",{className:"mb-6 p-4 bg-green-50 rounded-lg flex items-start",children:[e.jsx(z,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsx("p",{className:"text-green-800",children:j})]}),e.jsxs(_,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-6",children:"デプロイ設定"}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(h,{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"Netlifyデプロイについて"}),e.jsx("p",{children:"このツールを使用すると、現在のプロジェクトをNetlifyに自動的にデプロイできます。デプロイが完了すると、公開URLが提供されます。"})]})]})}),a?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"最新のデプロイ情報"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"ステータス:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${R(a.status)}`,children:O(a.status)})]}),a.deploy_url&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"公開URL:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("a",{href:a.deploy_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-800 flex items-center",children:[a.deploy_url.replace(/^https?:\/\//,""),e.jsx(k,{className:"w-3 h-3 ml-1"})]}),e.jsx("button",{onClick:()=>I(a.deploy_url),className:"text-gray-500 hover:text-gray-700",title:"URLをコピー",children:e.jsx(G,{className:"w-4 h-4"})})]})]}),a.claim_url&&!a.claimed&&e.jsx("div",{className:"mt-2",children:e.jsxs("a",{href:a.claim_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-800 flex items-center",children:["Netlifyでサイトを管理する",e.jsx(k,{className:"w-3 h-3 ml-1"})]})})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(y,{onClick:H,variant:"secondary",isLoading:u,children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"ステータスを更新"]}),e.jsxs(y,{onClick:w,isLoading:l,disabled:["building","enqueued","processing"].includes(a.status),children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),"再デプロイ"]}),e.jsxs(y,{onClick:()=>n("/deployment-history"),variant:"secondary",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"デプロイ履歴"]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(y,{onClick:w,isLoading:l,className:"w-full",children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),"Netlifyにデプロイ"]}),e.jsxs(y,{onClick:J,variant:"secondary",isLoading:u,className:"w-full",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"デプロイステータスを確認"]})]}),L&&e.jsx("div",{className:"text-center text-sm text-green-600",children:"URLをコピーしました！"})]})]}),e.jsxs(_,{className:"p-6 bg-gray-50",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"デプロイについての注意事項"}),e.jsxs("div",{className:"text-sm text-gray-700 space-y-2",children:[e.jsx("p",{children:"• デプロイには数分かかる場合があります"}),e.jsx("p",{children:"• デプロイが完了すると、公開URLが提供されます"}),e.jsx("p",{children:"• Netlifyアカウントをお持ちの場合は、サイトを自分のアカウントに移行できます"}),e.jsx("p",{children:"• 環境変数は自動的に設定されます"}),e.jsx("p",{children:"• 問題が発生した場合は、Netlifyダッシュボードで詳細を確認してください"})]})]})]})}function Q(n){try{typeof window<"u"&&window.localStorage&&window.localStorage.removeItem(n)}catch(l){console.warn("Error removing item from localStorage:",l)}}export{Y as Deploy};

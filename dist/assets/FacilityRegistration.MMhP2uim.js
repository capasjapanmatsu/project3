var e=Object.defineProperty,s=Object.defineProperties,a=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,i=(s,a,t)=>a in s?e(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t,n=(e,s)=>{for(var a in s||(s={}))r.call(s,a)&&i(e,a,s[a]);if(t)for(var a of t(s))l.call(s,a)&&i(e,a,s[a]);return e},d=(e,t)=>s(e,a(t)),c=(e,s,a)=>new Promise(((t,r)=>{var l=e=>{try{n(a.next(e))}catch(s){r(s)}},i=e=>{try{n(a.throw(e))}catch(s){r(s)}},n=e=>e.done?t(e.value):Promise.resolve(e.value).then(l,i);n((a=a.apply(e,s)).next())}));import{u as m,j as o,C as x,B as h,s as g}from"./index.D9xag4tn.js";import{u,r as b}from"./router.BWT_vQps.js";import{I as f}from"./Input.tFQgyGuP.js";import{k as p,a as j,a7 as y,aE as N,x as v}from"./ui.BPlS2KKq.js";import"./vendor.D1SiiUJb.js";import"./supabase.CZ8ekJUM.js";const w=[{id:"pet_hotel",name:"ペットホテル",monthly_fee:5e3,is_free:!0},{id:"pet_salon",name:"ペットサロン",monthly_fee:3e3,is_free:!0},{id:"veterinary",name:"動物病院",monthly_fee:8e3,is_free:!0},{id:"pet_cafe",name:"ペットカフェ",monthly_fee:4e3,is_free:!0},{id:"pet_restaurant",name:"ペット同伴レストラン",monthly_fee:6e3,is_free:!0},{id:"pet_shop",name:"ペットショップ",monthly_fee:7e3,is_free:!0},{id:"pet_accommodation",name:"ペット同伴宿泊",monthly_fee:1e4,is_free:!0}];function _(){const{user:e,isAuthenticated:s}=m(),a=u(),[t,r]=b.useState(!1),[l,i]=b.useState(""),[_,O]=b.useState(""),[S,P]=b.useState([]),[C,k]=b.useState([]),[I,E]=b.useState({name:"",category_id:"",address:"",phone:"",website:"",description:"",images:[]});b.useEffect((()=>{s||a("/login")}),[s,a]);const D=e=>{const{name:s,value:a}=e.target;E((e=>d(n({},e),{[s]:a})))};return s?o.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[o.jsxs("div",{className:"mb-8",children:[o.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"ペット関連施設登録"}),o.jsx("p",{className:"text-gray-600",children:"ペット関連施設の掲載申請を行います。管理者の承認後、地図に表示されます。"})]}),l&&o.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:o.jsxs("div",{className:"flex items-center",children:[o.jsx(p,{className:"w-5 h-5 text-red-500 mr-2"}),o.jsx("span",{className:"text-red-700",children:l})]})}),_&&o.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:o.jsxs("div",{className:"flex items-center",children:[o.jsx(j,{className:"w-5 h-5 text-green-500 mr-2"}),o.jsx("span",{className:"text-green-700",children:_})]})}),o.jsxs("form",{onSubmit:s=>c(null,null,(function*(){if(s.preventDefault(),e)if(I.name&&I.category_id&&I.address){r(!0),i("");try{const s={owner_id:e.id,name:I.name,category_id:I.category_id,address:I.address,phone:I.phone,website:I.website,description:I.description,status:"pending",created_at:(new Date).toISOString()},{data:t,error:r}=yield g.from("pet_facilities").insert(s).select().single();if(r)throw r;if(I.images.length>0&&t){const e=I.images.map(((e,s)=>({facility_id:t.id,image_data:e,is_primary:0===s,created_at:(new Date).toISOString()}))),{error:s}=yield g.from("facility_images").insert(e)}O("施設の掲載申請が完了しました！管理者の承認後、地図に掲載されます。"),setTimeout((()=>{a("/dashboard")}),2e3)}catch(t){i(t instanceof Error?t.message:"申請に失敗しました")}finally{r(!1)}}else i("必須項目を入力してください");else i("ログインが必要です")})),className:"space-y-6",children:[o.jsx(x,{children:o.jsxs("div",{className:"p-6",children:[o.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center",children:[o.jsx(y,{className:"w-6 h-6 mr-2"}),"基本情報"]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["施設名 ",o.jsx("span",{className:"text-red-500",children:"*"})]}),o.jsx(f,{label:"施設名",name:"name",value:I.name,onChange:D,placeholder:"施設名を入力してください",required:!0})]}),o.jsxs("div",{children:[o.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["施設カテゴリ ",o.jsx("span",{className:"text-red-500",children:"*"})]}),o.jsxs("select",{name:"category_id",value:I.category_id,onChange:D,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[o.jsx("option",{value:"",children:"カテゴリを選択してください"}),w.map((e=>o.jsx("option",{value:e.id,children:e.name},e.id)))]})]}),o.jsxs("div",{children:[o.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["住所 ",o.jsx("span",{className:"text-red-500",children:"*"})]}),o.jsx(f,{label:"住所",name:"address",value:I.address,onChange:D,placeholder:"住所を入力してください",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"電話番号"}),o.jsx(f,{label:"電話番号",name:"phone",value:I.phone,onChange:D,placeholder:"電話番号を入力してください"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ウェブサイト"}),o.jsx(f,{label:"ウェブサイト",name:"website",value:I.website,onChange:D,placeholder:"https://example.com"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"施設の説明"}),o.jsx("textarea",{name:"description",value:I.description,onChange:D,rows:4,placeholder:"施設の特徴やサービス内容を入力してください",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})]})}),o.jsx(x,{className:"mb-6",children:o.jsxs("div",{className:"p-6",children:[o.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center",children:[o.jsx(N,{className:"w-6 h-6 mr-2"}),"施設画像 (最大5枚)"]}),o.jsxs("div",{className:"mb-4",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"画像をアップロード"}),o.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>c(null,null,(function*(){const s=Array.from(e.target.files||[]);if(0!==s.length)if(S.length+s.length>5)i("画像は最大5枚までアップロードできます");else{r(!0),i("");try{if(s.filter((e=>e.size>10485760)).length>0)return i("画像ファイルのサイズは10MB以下にしてください"),void r(!1);const e=yield Promise.all(s.map((e=>(e=>new Promise(((s,a)=>{const t=document.createElement("canvas"),r=t.getContext("2d"),l=new window.Image;l.onload=()=>{let{width:e,height:a}=l;e>a?e>800&&(a=800*a/e,e=800):a>600&&(e=600*e/a,a=600),t.width=e,t.height=a,null==r||r.drawImage(l,0,0,e,a);const i=t.toDataURL("image/jpeg",.8);s(i)},l.onerror=a,l.src=URL.createObjectURL(e)})))(e)))),a=s.slice(0,5-S.length);P((e=>[...e,...a])),k((s=>[...s,...e])),E((s=>d(n({},s),{images:[...s.images,...e]})))}catch(a){i(a instanceof Error?a.message:"画像の処理に失敗しました")}finally{r(!1)}}})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:t||S.length>=5}),o.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"JPG, PNG, GIF対応。1ファイル10MB以下。画像は自動的にリサイズ・圧縮されます。"})]}),C.length>0&&o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4",children:C.map(((e,s)=>o.jsxs("div",{className:"relative",children:[o.jsx("img",{src:e,alt:`施設画像 ${s+1}`,className:"w-full h-32 object-cover rounded-lg border border-gray-200"}),o.jsx("button",{type:"button",onClick:()=>(e=>{P((s=>s.filter(((s,a)=>a!==e)))),k((s=>s.filter(((s,a)=>a!==e)))),E((s=>d(n({},s),{images:s.images.filter(((s,a)=>a!==e))})))})(s),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center hover:bg-red-600",children:o.jsx(v,{className:"w-4 h-4"})}),0===s&&o.jsx("div",{className:"absolute bottom-1 left-1 bg-blue-500 text-white text-xs px-2 py-1 rounded",children:"メイン"})]},s)))})]})}),o.jsx(x,{className:"mb-6",children:o.jsx("div",{className:"p-6",children:o.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-center mb-2",children:[o.jsx(j,{className:"w-5 h-5 text-green-500 mr-2"}),o.jsx("span",{className:"font-medium text-green-800",children:"無料掲載キャンペーン実施中！"})]}),o.jsxs("p",{className:"text-green-700",children:["現在、すべてのペット関連施設が",o.jsx("strong",{className:"text-lg",children:"無料"}),"で掲載できます。"]}),o.jsx("p",{className:"text-sm text-green-600 mt-2",children:"申請後、管理者の承認を経て掲載開始となります。"})]})})}),o.jsx("div",{className:"flex justify-end",children:o.jsx(h,{type:"submit",disabled:t,children:t?"申請中...":"申請を送信する"})})]})]}):null}export{_ as default};

import{j as e,V as K,_ as m,q as x,a6 as F,a7 as z,Q as U,a as E,J as W,r as Y,S as Z,ar as ee,X as se}from"./ui-vendor-FlUr4cJt.js";import{h as te,u as ae,r as l,L as re}from"./react-vendor-_GyjDmDn.js";import{u as le,b as ce,s as h,B as p,C as u,n as M}from"./index-BSYT0262.js";import{l as ie}from"./logger-C8dD4C56.js";import"./supabase-vendor-Df9iqQzW.js";function he(){const{productId:g}=te(),{user:i}=le(),c=ae(),[t,D]=l.useState(null),[y,R]=l.useState([]),[n,v]=l.useState(1),[A,O]=l.useState(!0),{isActive:o}=ce(),[r,Q]=l.useState([]),[d,j]=l.useState(0),[T,w]=l.useState(!1);l.useEffect(()=>{g&&_()},[g,i]);const _=async()=>{try{const[s,a,f]=await Promise.all([h.from("products").select("*").eq("id",g).eq("is_active",!0).single(),i?h.from("cart_items").select("*, product:products(*)").eq("user_id",i.id):Promise.resolve({data:[]}),h.from("product_images").select("*").eq("product_id",g).order("display_order",{ascending:!0})]);if(s.error){console.error("Product not found:",s.error),c("/shop");return}D(s.data),R(a.data||[]);const b=[];s.data.image_url&&b.push({id:"main",url:s.data.image_url}),!f.error&&f.data&&f.data.forEach(L=>{b.push({id:L.id,url:L.image_url})}),Q(b)}catch(s){console.error("Error fetching product data:",s),c("/shop")}finally{O(!1)}},k=async()=>{if(!i){c("/login");return}try{const s=y.find(a=>a.product_id===t?.id);if(s){const{error:a}=await h.from("cart_items").update({quantity:s.quantity+n}).eq("id",s.id);if(a)throw a}else{const{error:a}=await h.from("cart_items").insert([{user_id:i.id,product_id:t.id,quantity:n}]);if(a)throw a}await _(),M.success("カートに追加しました！")}catch(s){ie.error("Error adding to cart:",s),M.error("カートへの追加に失敗しました。")}},$=async()=>{await k(),c("/cart")},B=s=>o?Math.round(s*.9):s,G=()=>{const s=y.find(a=>a.product_id===t?.id);return s?s.quantity:0},H=s=>({food:"ドッグフード",treats:"おやつ",toys:"おもちゃ",accessories:"アクセサリー",health:"ヘルスケア",sheets:"ペットシーツ"})[s]||s,J=s=>({puppy:"子犬",adult:"成犬",senior:"シニア犬",all:"全年齢"})[s]||s,V=s=>({small:"小型犬",medium:"中型犬",large:"大型犬",all:"全サイズ"})[s]||s,C=()=>{j(s=>(s+1)%r.length)},I=()=>{j(s=>(s-1+r.length)%r.length)},X=s=>{j(s),w(!0)};if(A)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})});if(!t)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-600",children:"商品が見つかりませんでした"}),e.jsx(p,{onClick:()=>c("/shop"),className:"mt-4",children:"ショップに戻る"})]});const N=t.price,q=B(N),S=o&&q<N,P=G();return e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:()=>c("/shop"),className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"ショップに戻る"]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[r.length>0?e.jsx("img",{src:r[d].url,alt:t.name,className:"w-full h-96 object-cover rounded-lg shadow-lg cursor-pointer",onClick:()=>X(d),onError:s=>{s.currentTarget.src="https://images.pexels.com/photos/1108099/pexels-photo-1108099.jpeg"}}):e.jsx("div",{className:"w-full h-96 bg-gray-200 rounded-lg flex items-center justify-center",children:e.jsx(m,{className:"w-16 h-16 text-gray-400"})}),S&&e.jsx("div",{className:"absolute top-4 left-4",children:e.jsxs("span",{className:"bg-purple-500 text-white px-3 py-1 rounded-full text-sm font-medium flex items-center",children:[e.jsx(x,{className:"w-4 h-4 mr-1"}),"10%OFF"]})}),t.stock_quantity<=5&&e.jsx("div",{className:"absolute top-4 right-4",children:e.jsxs("span",{className:"bg-red-500 text-white px-3 py-1 rounded-full text-sm font-medium",children:["残り",t.stock_quantity,"個"]})}),r.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:I,className:"absolute left-2 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-75 rounded-full p-2 hover:bg-opacity-100 transition-opacity",children:e.jsx(F,{className:"w-5 h-5 text-gray-800"})}),e.jsx("button",{onClick:C,className:"absolute right-2 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-75 rounded-full p-2 hover:bg-opacity-100 transition-opacity",children:e.jsx(z,{className:"w-5 h-5 text-gray-800"})})]})]}),r.length>1&&e.jsx("div",{className:"grid grid-cols-6 gap-2",children:r.map((s,a)=>e.jsx("div",{className:`h-16 rounded-lg overflow-hidden cursor-pointer border-2 ${a===d?"border-green-500":"border-transparent"}`,onClick:()=>j(a),children:e.jsx("img",{src:s.url,alt:`${t.name} - サムネイル ${a+1}`,className:"w-full h-full object-cover"})},a))})]}),e.jsxs("div",{className:"space-y-6",children:[o&&e.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-pink-500 text-white p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(x,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:"サブスク会員特典: 10%OFF"})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded text-sm",children:H(t.category)}),t.brand&&e.jsx("span",{className:"text-gray-500 text-sm",children:t.brand})]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:t.name}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:"text-3xl font-bold text-green-600",children:["¥",q.toLocaleString()]}),S&&e.jsxs("span",{className:"text-xl text-gray-500 line-through",children:["¥",N.toLocaleString()]})]}),o&&e.jsx("p",{className:"text-sm text-purple-600 mt-1",children:"サブスク会員価格"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[t.weight&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(m,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{className:"text-sm",children:["内容量: ",t.weight,"g"]})]}),t.size&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(m,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{className:"text-sm",children:["サイズ: ",t.size]})]}),t.age_group&&t.age_group!=="all"&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{className:"text-sm",children:["対象年齢: ",J(t.age_group)]})]}),t.dog_size&&t.dog_size!=="all"&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{className:"text-sm",children:["対象サイズ: ",V(t.dog_size)]})]})]}),e.jsx("div",{className:"mb-6",children:t.stock_quantity>0?e.jsxs("div",{className:"flex items-center space-x-2 text-green-600",children:[e.jsx(m,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"在庫あり"})]}):e.jsxs("div",{className:"flex items-center space-x-2 text-red-600",children:[e.jsx(m,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"在庫切れ"})]})}),t.stock_quantity>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"数量"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>v(Math.max(1,n-1)),className:"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center hover:bg-gray-300 transition-colors",children:e.jsx(W,{className:"w-4 h-4"})}),e.jsx("span",{className:"text-xl font-medium w-12 text-center",children:n}),e.jsx("button",{onClick:()=>v(Math.min(t.stock_quantity,n+1)),className:"w-10 h-10 bg-green-600 text-white rounded-full flex items-center justify-center hover:bg-green-700 transition-colors",children:e.jsx(Y,{className:"w-4 h-4"})})]}),P>0&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["カートに",P,"個入っています"]})]}),e.jsx("div",{className:"space-y-3",children:t.stock_quantity>0?e.jsxs(e.Fragment,{children:[e.jsx(p,{onClick:$,className:"w-full bg-green-600 hover:bg-green-700 text-lg py-3",children:"今すぐ購入"}),e.jsxs(p,{onClick:k,variant:"secondary",className:"w-full text-lg py-3",children:[e.jsx(Z,{className:"w-5 h-5 mr-2"}),"カートに追加"]})]}):e.jsx(p,{disabled:!0,className:"w-full text-lg py-3",children:"在庫切れ"})})]})]})]}),e.jsxs("div",{className:"mt-12 grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(u,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"商品説明"}),e.jsx("p",{className:"text-gray-700 leading-relaxed whitespace-pre-line",children:t.description}),t.ingredients&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"原材料"}),e.jsx("p",{className:"text-gray-700 text-sm",children:t.ingredients})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(ee,{className:"w-5 h-5 text-blue-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-1",children:"配送について"}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("p",{children:"• 送料：全国一律¥690"}),e.jsxs("p",{children:["• ¥5,000以上のご注文で",e.jsx("span",{className:"font-medium",children:"送料無料"})]}),e.jsxs("p",{children:["• サブスク会員は",e.jsx("span",{className:"font-medium",children:"常に送料無料"})]}),e.jsx("p",{children:"• 平日14時までのご注文で翌日お届け"})]})]})]})}),e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(E,{className:"w-5 h-5 text-green-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-green-900 mb-1",children:"品質保証"}),e.jsxs("div",{className:"text-sm text-green-800 space-y-1",children:[e.jsx("p",{children:"• 厳選された安全な原材料のみ使用"}),e.jsx("p",{children:"• 品質に問題がある場合は返品・交換対応"}),e.jsx("p",{children:"• 愛犬の健康を第一に考えた商品選定"})]})]})]})}),o?e.jsx(u,{className:"p-4 bg-purple-50 border-purple-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(x,{className:"w-5 h-5 text-purple-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-purple-900 mb-1",children:"会員特典"}),e.jsxs("div",{className:"text-sm text-purple-800 space-y-1",children:[e.jsx("p",{children:"• 全商品10%OFF"}),e.jsx("p",{children:"• 送料無料"}),e.jsx("p",{children:"• 優先カスタマーサポート"})]})]})]})}):e.jsx(u,{className:"p-4 bg-purple-50 border-purple-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(x,{className:"w-5 h-5 text-purple-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-purple-900 mb-1",children:"サブスク会員になると"}),e.jsxs("div",{className:"text-sm text-purple-800 space-y-1 mb-3",children:[e.jsx("p",{children:"• 全商品10%OFF"}),e.jsx("p",{children:"• 送料無料"}),e.jsx("p",{children:"• ドッグラン使い放題"})]}),e.jsx(re,{to:"/subscription",children:e.jsxs(p,{size:"sm",className:"w-full bg-purple-600 hover:bg-purple-700",children:[e.jsx(x,{className:"w-3 h-3 mr-1"}),"詳細を見る"]})})]})]})})]})]}),T&&e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",children:[e.jsx("button",{onClick:()=>w(!1),className:"absolute top-4 right-4 text-gray-800 bg-white bg-opacity-90 shadow-lg rounded-full p-2 hover:bg-opacity-100 transition-all",children:e.jsx(se,{className:"w-6 h-6"})}),e.jsx("button",{onClick:I,className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-800 bg-white bg-opacity-90 shadow-lg rounded-full p-2 hover:bg-opacity-100 transition-all",children:e.jsx(F,{className:"w-6 h-6"})}),e.jsx("button",{onClick:C,className:"absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-800 bg-white bg-opacity-90 shadow-lg rounded-full p-2 hover:bg-opacity-100 transition-all",children:e.jsx(z,{className:"w-6 h-6"})}),e.jsx("img",{src:r[d].url,alt:t.name,className:"max-h-[80vh] max-w-full"}),e.jsx("div",{className:"absolute bottom-4 left-0 right-0 text-center",children:e.jsxs("p",{className:"text-white text-sm",children:[d+1," / ",r.length]})})]})]})}export{he as ProductDetail};

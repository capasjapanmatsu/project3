import{u as e,s,j as t,B as a,C as l}from"./index.oOj2R_C7.js";import{u as r,d as n,r as c}from"./router.icJHpBzt.js";import{Y as i,o as d,h as x,g as m,f as o,d as h,v as j,e as p,q as g,C as u,a2 as N,aD as y}from"./ui.UnEvinBv.js";import"./vendor.D1SiiUJb.js";import"./supabase.CZ8ekJUM.js";function f(){const{isAdmin:f}=e(),v=r(),{userId:w}=n(),[b,_]=c.useState(null),[k,S]=c.useState(!0),[D,L]=c.useState("");c.useEffect((()=>{f?w&&P(w):v("/")}),[f,v,w]);const P=e=>{return t=null,a=null,l=function*(){var t;try{S(!0),L("");const{data:a,error:l}=yield s.from("profiles").select("*").eq("id",e).single();if(l)throw new Error("ユーザー情報の取得に失敗しました");const{data:r,error:n}=yield s.from("dogs").select("id, name, breed, age, gender, image_url").eq("owner_id",e),{data:c,error:i}=yield s.from("reservations").select("\n          id,\n          date,\n          time_slot,\n          total_amount,\n          status,\n          dog_parks (\n            name\n          )\n        ").eq("user_id",e).order("date",{ascending:!1}).limit(20),d=(c||[]).reduce(((e,s)=>e+(s.total_amount||0)),0),x=`user_${e.slice(0,8)}@unknown.com`,m={id:a.id,name:a.name||"Unknown",email:x,phone:a.phone_number||"",postal_code:a.postal_code||"",address:a.address||"",user_type:a.user_type||"user",created_at:a.created_at,is_active:!0,dogs:r||[],reservations:(c||[]).map((e=>{var s;return{id:e.id,park_name:(null==(s=e.dog_parks)?void 0:s.name)||"Unknown Park",date:e.date,time_slot:e.time_slot,total_amount:e.total_amount||0,status:e.status}})),subscription_status:"inactive",total_spent:d,last_activity:(null==(t=null==c?void 0:c[0])?void 0:t.date)||""};_(m)}catch(a){L(a instanceof Error?a.message:"ユーザー詳細の取得に失敗しました")}finally{S(!1)}},new Promise(((e,s)=>{var r=e=>{try{c(l.next(e))}catch(t){s(t)}},n=e=>{try{c(l.throw(e))}catch(t){s(t)}},c=s=>s.done?e(s.value):Promise.resolve(s.value).then(r,n);c((l=l.apply(t,a)).next())}));var t,a,l};return k?t.jsx("div",{className:"flex justify-center items-center h-screen",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):D?t.jsxs("div",{className:"max-w-4xl mx-auto p-4",children:[t.jsx("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4",children:D}),t.jsxs(a,{onClick:()=>v("/admin/users"),className:"mt-4",variant:"secondary",children:[t.jsx(i,{className:"w-4 h-4 mr-2"}),"ユーザー一覧に戻る"]})]}):b?t.jsxs("div",{className:"max-w-4xl mx-auto p-4 space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs(a,{onClick:()=>v("/admin/users"),variant:"secondary",size:"sm",children:[t.jsx(i,{className:"w-4 h-4 mr-2"}),"ユーザー一覧に戻る"]}),t.jsxs("div",{className:"flex items-center space-x-2",children:["active"===b.subscription_status&&t.jsxs("span",{className:"bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-sm font-medium flex items-center",children:[t.jsx(d,{className:"w-4 h-4 mr-1"}),"サブスク会員"]}),b.is_active?t.jsxs("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded-full text-sm font-medium flex items-center",children:[t.jsx(x,{className:"w-4 h-4 mr-1"}),"アクティブ"]}):t.jsxs("span",{className:"bg-red-100 text-red-800 px-2 py-1 rounded-full text-sm font-medium flex items-center",children:[t.jsx(m,{className:"w-4 h-4 mr-1"}),"非アクティブ"]})]})]}),t.jsxs(l,{className:"p-6",children:[t.jsxs("div",{className:"flex items-center mb-6",children:[t.jsx(o,{className:"w-8 h-8 text-blue-600 mr-3"}),t.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:b.name})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center text-gray-600",children:[t.jsx(h,{className:"w-5 h-5 mr-3 text-gray-400"}),t.jsx("span",{children:b.email})]}),b.phone&&t.jsxs("div",{className:"flex items-center text-gray-600",children:[t.jsx(j,{className:"w-5 h-5 mr-3 text-gray-400"}),t.jsx("span",{children:b.phone})]}),b.address&&t.jsxs("div",{className:"flex items-center text-gray-600",children:[t.jsx(p,{className:"w-5 h-5 mr-3 text-gray-400"}),t.jsxs("span",{children:[b.postal_code," ",b.address]})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center text-gray-600",children:[t.jsx(g,{className:"w-5 h-5 mr-3 text-gray-400"}),t.jsxs("span",{children:["登録日: ",new Date(b.created_at).toLocaleDateString("ja-JP")]})]}),b.last_activity&&t.jsxs("div",{className:"flex items-center text-gray-600",children:[t.jsx(u,{className:"w-5 h-5 mr-3 text-gray-400"}),t.jsxs("span",{children:["最終活動: ",new Date(b.last_activity).toLocaleDateString("ja-JP")]})]}),t.jsxs("div",{className:"flex items-center text-gray-600",children:[t.jsx(N,{className:"w-5 h-5 mr-3 text-gray-400"}),t.jsxs("span",{children:["総支払額: ¥",b.total_spent.toLocaleString()]})]})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsx(l,{className:"p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"登録犬数"}),t.jsx("p",{className:"text-2xl font-bold text-blue-600",children:b.dogs.length})]}),t.jsx(y,{className:"w-8 h-8 text-blue-600"})]})}),t.jsx(l,{className:"p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"予約数"}),t.jsx("p",{className:"text-2xl font-bold text-green-600",children:b.reservations.length})]}),t.jsx(g,{className:"w-8 h-8 text-green-600"})]})}),t.jsx(l,{className:"p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"総支払額"}),t.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:["¥",b.total_spent.toLocaleString()]})]}),t.jsx(N,{className:"w-8 h-8 text-purple-600"})]})})]}),t.jsxs(l,{className:"p-6",children:[t.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[t.jsx(y,{className:"w-5 h-5 mr-2"}),"登録犬一覧 (",b.dogs.length,"匹)"]}),0===b.dogs.length?t.jsx("p",{className:"text-gray-500",children:"登録された犬はありません"}):t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:b.dogs.map((e=>t.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[e.image_url?t.jsx("img",{src:e.image_url,alt:e.name,className:"w-12 h-12 rounded-full object-cover"}):t.jsx("div",{className:"w-12 h-12 bg-gray-300 rounded-full flex items-center justify-center",children:t.jsx(y,{className:"w-6 h-6 text-gray-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium text-gray-800",children:e.name}),t.jsxs("p",{className:"text-sm text-gray-600",children:[e.breed," • ",e.gender]}),t.jsxs("p",{className:"text-sm text-gray-500",children:[e.age,"歳"]})]})]})},e.id)))})]}),t.jsxs(l,{className:"p-6",children:[t.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[t.jsx(g,{className:"w-5 h-5 mr-2"}),"予約履歴 (",b.reservations.length,"件)"]}),0===b.reservations.length?t.jsx("p",{className:"text-gray-500",children:"予約履歴はありません"}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"ドッグパーク"}),t.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"予約日"}),t.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"時間"}),t.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"金額"}),t.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"ステータス"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200",children:b.reservations.map((e=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.park_name}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:new Date(e.date).toLocaleDateString("ja-JP")}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.time_slot}),t.jsxs("td",{className:"px-4 py-3 text-sm text-gray-900",children:["¥",e.total_amount.toLocaleString()]}),t.jsx("td",{className:"px-4 py-3",children:t.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("confirmed"===e.status?"bg-green-100 text-green-800":"cancelled"===e.status?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:"confirmed"===e.status?"確定":"cancelled"===e.status?"キャンセル":"保留中"})})]},e.id)))})]})})]})]}):t.jsx("div",{className:"max-w-4xl mx-auto p-4",children:t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-gray-600",children:"ユーザーが見つかりません"}),t.jsxs(a,{onClick:()=>v("/admin/users"),className:"mt-4",variant:"secondary",children:[t.jsx(i,{className:"w-4 h-4 mr-2"}),"ユーザー一覧に戻る"]})]})})}export{f as AdminUserDetail};

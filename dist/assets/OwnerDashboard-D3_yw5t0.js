import{u as e,j as s,B as t,b as a}from"./index-rzoKNnex.js";import{u as l,r,L as i}from"./vendor-Cwmn0chA.js";import{C as c}from"./Card-CRM3w0N8.js";import{$ as n,a0 as d,l as x,i as m,w as o,f as h,t as j,G as p,F as u,b as g,s as f,q as N,n as b,R as v,z as w,a1 as y}from"./ui-CMSAjam7.js";import"./supabase-Dzr8oIt2.js";function _(){const{user:_}=e(),q=l(),[z,C]=r.useState([]),[L,$]=r.useState(!0),[R,B]=r.useState(0),[E,Q]=r.useState(0),[D,F]=r.useState(0),[M,P]=r.useState(null),[T,W]=r.useState(!1),[G,H]=r.useState(""),[O,V]=r.useState("");r.useEffect((()=>{_?async function(){try{const{data:e,error:s}=await a.from("dog_parks").select("*").eq("owner_id",null==_?void 0:_.id).order("created_at",{ascending:!1});if(s)throw s;C(e||[]),B(25600),Q(32),F(128)}catch(e){}finally{$(!1)}}():q("/login")}),[_,q]);return L?s.jsx("div",{className:"flex justify-center items-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):_?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold",children:"オーナーダッシュボード"}),s.jsx("p",{className:"text-gray-600",children:"ドッグランの登録・管理を行います"})]}),s.jsxs("div",{className:"flex space-x-3",children:[s.jsx(i,{to:"/owner-payment-system",children:s.jsxs(t,{variant:"secondary",className:"flex items-center",children:[s.jsx(n,{className:"w-4 h-4 mr-2"}),"収益システム"]})}),s.jsx(i,{to:"/register-park",children:s.jsxs(t,{children:[s.jsx(d,{className:"w-4 h-4 mr-2"}),"ドッグランを登録"]})})]})]}),G&&s.jsxs("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4 flex items-start",children:[s.jsx(x,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),s.jsx("p",{children:G})]}),O&&s.jsxs("div",{className:"bg-green-100 border border-green-300 text-green-800 rounded-lg p-4 flex items-start",children:[s.jsx(m,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),s.jsx("p",{children:O})]}),z.some((e=>"approved"===e.status))&&s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsxs(c,{className:"p-6 hover:shadow-lg transition-shadow cursor-pointer",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"今月の収益"}),s.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["¥",R.toLocaleString()]}),s.jsx("p",{className:"text-xs text-green-600",children:"前月比 +8%"})]}),s.jsx(n,{className:"w-8 h-8 text-green-600"})]}),s.jsx("div",{className:"mt-3 text-blue-600 text-sm flex items-center",children:s.jsxs(i,{to:"/owner-payment-system",className:"flex items-center",children:[s.jsx("span",{children:"詳細を見る"}),s.jsx(o,{className:"w-4 h-4 ml-1"})]})})]}),s.jsxs(c,{className:"p-6 hover:shadow-lg transition-shadow cursor-pointer",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"今月の予約"}),s.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[E,"件"]}),s.jsx("p",{className:"text-xs text-blue-600",children:"前月比 +12%"})]}),s.jsx(k,{className:"w-8 h-8 text-blue-600"})]}),s.jsxs("div",{className:"mt-3 text-blue-600 text-sm flex items-center",children:[s.jsx("span",{children:"詳細を見る"}),s.jsx(o,{className:"w-4 h-4 ml-1"})]})]}),s.jsxs(c,{className:"p-6 hover:shadow-lg transition-shadow cursor-pointer",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"利用者数"}),s.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:[D,"人"]}),s.jsx("p",{className:"text-xs text-purple-600",children:"前月比 +15%"})]}),s.jsx(h,{className:"w-8 h-8 text-purple-600"})]}),s.jsxs("div",{className:"mt-3 text-blue-600 text-sm flex items-center",children:[s.jsx("span",{children:"詳細を見る"}),s.jsx(o,{className:"w-4 h-4 ml-1"})]})]})]}),s.jsx(c,{className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("div",{className:"bg-white/20 p-3 rounded-full",children:s.jsx(j,{className:"w-8 h-8"})}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-bold mb-1",children:"収益システム"}),s.jsx("p",{className:"text-sm opacity-90",children:"売上の80%がオーナー様に支払われます"})]})]}),s.jsx(i,{to:"/owner-payment-system",children:s.jsxs(t,{className:"bg-white text-gray-900 hover:bg-gray-100 hover:text-gray-900 font-bold",children:[s.jsx(p,{className:"w-4 h-4 mr-2"}),"詳細を見る"]})})]})}),s.jsx(c,{className:"bg-blue-50 border-blue-200",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(u,{className:"w-6 h-6 text-blue-600 mt-1"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"審査プロセス"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 text-sm text-blue-800",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold",children:"1"}),s.jsx("span",{children:"第一審査（基本条件確認）"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold",children:"2"}),s.jsx("span",{children:"第二審査（書類審査）"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold",children:"3"}),s.jsx("span",{children:"QRコード実証検査"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-bold",children:"4"}),s.jsx("span",{children:"掲載・運営開始"})]})]})]})]})}),0===z.length?s.jsxs(c,{className:"text-center py-12",children:[s.jsx(g,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),s.jsx("h2",{className:"text-xl font-semibold text-gray-700 mb-2",children:"まだドッグランが登録されていません"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"新しいドッグランを登録して、多くの愛犬家に利用してもらいましょう"}),s.jsx(i,{to:"/register-park",children:s.jsxs(t,{children:[s.jsx(d,{className:"w-4 h-4 mr-2"}),"ドッグランを登録する"]})})]}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:z.map((e=>{const a=(e=>{const s={pending:{label:"第一審査中",color:"bg-yellow-100 text-yellow-800",icon:u,description:"基本的な条件の審査中です"},approved:{label:"運営中",color:"bg-green-100 text-green-800",icon:m,description:"一般公開中・予約受付中"},rejected:{label:"審査不通過",color:"bg-red-100 text-red-800",icon:x,description:"審査基準を満たしていません"},first_stage_passed:{label:"第一審査通過",color:"bg-blue-100 text-blue-800",icon:m,description:"詳細情報入力待ち"},second_stage_review:{label:"第二審査中",color:"bg-purple-100 text-purple-800",icon:u,description:"書類審査中（3-5営業日）"},qr_testing:{label:"QRコード実証検査",color:"bg-orange-100 text-orange-800",icon:y,description:"実地検査・動作確認中"}};return s[e]||s.pending})(e.status),l=a.icon;return s.jsxs(c,{className:"hover:shadow-lg transition-shadow",children:[s.jsx("div",{className:"flex justify-between items-start mb-4",children:s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-xl font-semibold mb-2",children:e.name}),s.jsx("div",{className:"flex items-center space-x-2 mb-2",children:s.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-medium flex items-center space-x-1 ${a.color}`,children:[s.jsx(l,{className:"w-4 h-4"}),s.jsx("span",{children:a.label})]})}),s.jsx("p",{className:"text-sm text-gray-600 mb-3",children:a.description})]})}),s.jsx("p",{className:"text-gray-600 mb-4 line-clamp-2",children:e.description}),s.jsxs("div",{className:"space-y-2 mb-4",children:[s.jsxs("div",{className:"flex items-center text-gray-600",children:[s.jsx(g,{className:"w-4 h-4 mr-2"}),s.jsx("span",{className:"text-sm",children:e.address})]}),s.jsxs("div",{className:"flex items-center text-gray-600",children:[s.jsx(f,{className:"w-4 h-4 mr-2"}),s.jsx("span",{className:"text-sm",children:"24時間営業"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600",children:[s.jsxs("div",{children:["収容人数: ",e.max_capacity,"人"]}),s.jsxs("div",{children:["現在の利用者: ",e.current_occupancy,"人"]})]})]}),"approved"===e.status&&s.jsx("div",{className:"bg-green-50 p-3 rounded-lg mb-4",children:s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(N,{className:"w-4 h-4 text-yellow-500"}),s.jsxs("span",{children:["評価: ★",e.average_rating.toFixed(1)]})]}),s.jsx("div",{children:s.jsxs("span",{children:["レビュー: ",e.review_count,"件"]})}),s.jsx("div",{children:s.jsxs("span",{children:["現在の利用者: ",e.current_occupancy,"人"]})}),s.jsx("div",{children:s.jsxs("span",{children:["利用率: ",Math.round(e.current_occupancy/e.max_capacity*100),"%"]})})]})}),"pending"===e.status&&s.jsx("div",{className:"bg-yellow-50 p-3 rounded-lg mb-4",children:s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx(x,{className:"w-5 h-5 text-yellow-600 mt-0.5 flex-shrink-0"}),s.jsxs("div",{className:"text-sm text-yellow-800",children:[s.jsx("p",{className:"font-medium mb-1",children:"第一審査待ち"}),s.jsx("p",{children:"管理者による審査をお待ちください。通常3-5営業日で結果をお知らせします。"})]})]})}),"first_stage_passed"===e.status&&s.jsx("div",{className:"bg-blue-50 p-3 rounded-lg mb-4",children:s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx(m,{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),s.jsxs("div",{className:"text-sm text-blue-800",children:[s.jsx("p",{className:"font-medium mb-1",children:"第一審査通過！"}),s.jsx("p",{children:"第二審査の詳細情報を入力してください。"})]})]})}),"second_stage_review"===e.status&&s.jsx("div",{className:"bg-purple-50 p-3 rounded-lg mb-4",children:s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx(f,{className:"w-5 h-5 text-purple-600 mt-0.5 flex-shrink-0"}),s.jsxs("div",{className:"text-sm text-purple-800",children:[s.jsx("p",{className:"font-medium mb-1",children:"第二審査中です"}),s.jsx("p",{children:"審査結果をお待ちください。"})]})]})}),s.jsxs("div",{className:"flex space-x-2",children:["approved"===e.status&&s.jsxs("div",{className:"flex justify-between w-full",children:[s.jsx(i,{to:`/parks/${e.id}`,children:s.jsxs(t,{size:"sm",variant:"secondary",children:[s.jsx(b,{className:"w-4 h-4 mr-1"}),"公開ページを見る"]})}),s.jsx(i,{to:`/parks/${e.id}/manage`,children:s.jsx(t,{size:"sm",children:"管理する"})})]}),"first_stage_passed"===e.status&&s.jsx(i,{to:`/parks/${e.id}/second-stage`,className:"w-full",children:s.jsxs(t,{size:"sm",className:"w-full bg-blue-600 hover:bg-blue-700",children:[s.jsx(S,{className:"w-4 h-4 mr-1"}),"施設画像をアップロード"]})}),"rejected"===e.status&&s.jsxs("div",{className:"flex justify-between w-full",children:[s.jsxs(t,{size:"sm",variant:"secondary",onClick:e=>{e.preventDefault(),e.stopPropagation(),q("/register-park")},children:[s.jsx(v,{className:"w-4 h-4 mr-1"}),"再申請する"]}),s.jsxs(t,{size:"sm",variant:"secondary",className:"text-red-600 hover:text-red-700",onClick:s=>{s.preventDefault(),s.stopPropagation(),P(e.id)},children:[s.jsx(w,{className:"w-4 h-4 mr-1"}),"削除する"]})]}),"approved"!==e.status&&"first_stage_passed"!==e.status&&"rejected"!==e.status&&s.jsx(i,{to:`/parks/${e.id}/manage`,className:"w-full",children:s.jsx(t,{size:"sm",variant:"secondary",className:"w-full",children:"詳細を見る"})})]})]},e.id)}))}),s.jsx(c,{className:"bg-gray-50",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(u,{className:"w-6 h-6 text-gray-600 mt-1"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"運営サポート"}),s.jsxs("div",{className:"text-sm text-gray-700 space-y-1",children:[s.jsx("p",{children:"• 審査に関するご質問は運営事務局までお問い合わせください"}),s.jsx("p",{children:"• QRコードシステムの設置・設定サポートを提供しています"}),s.jsx("p",{children:"• 運営開始後も継続的なサポートを行います"}),s.jsx("p",{children:"• 📧 サポート窓口: info@dogparkjp.com"})]})]})]})}),M&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"申請を削除しますか？"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"この操作は取り消せません。申請を削除してもよろしいですか？"}),s.jsxs("div",{className:"flex justify-end space-x-3",children:[s.jsx(t,{variant:"secondary",onClick:()=>P(null),children:"キャンセル"}),s.jsxs(t,{className:"bg-red-600 hover:bg-red-700",isLoading:T,onClick:()=>(async e=>{try{W(!0),H("");const{data:s}=await a.from("dog_park_facility_images").select("id").eq("park_id",e);if(s&&s.length>0){const{error:s}=await a.from("dog_park_facility_images").delete().eq("park_id",e);if(s)throw new Error("施設画像の削除に失敗しました。")}const{data:t}=await a.from("dog_park_review_stages").select("id").eq("park_id",e);if(t&&t.length>0){const{error:s}=await a.from("dog_park_review_stages").delete().eq("park_id",e);if(s)throw new Error("審査ステージの削除に失敗しました。")}const{error:l}=await a.from("dog_parks").delete().eq("id",e).eq("owner_id",null==_?void 0:_.id);if(l)throw l;C((s=>s.filter((s=>s.id!==e)))),P(null),V("ドッグラン申請を削除しました"),setTimeout((()=>{V("")}),3e3)}catch(s){H(s.message||"エラーが発生しました"),setTimeout((()=>{H("")}),3e3)}finally{W(!1)}})(M),children:[s.jsx(w,{className:"w-4 h-4 mr-2"}),"削除する"]})]})]})})]}):void H("ユーザー情報が取得できません")}function k({className:e}){return s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,children:[s.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),s.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),s.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),s.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]})}function S({className:e}){return s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,children:[s.jsx("path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"}),s.jsx("circle",{cx:"12",cy:"13",r:"3"})]})}export{_ as OwnerDashboard};

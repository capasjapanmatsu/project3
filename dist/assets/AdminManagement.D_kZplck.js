var e=Object.defineProperty,s=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,l=(s,a,r)=>a in s?e(s,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[a]=r,n=(e,s)=>{for(var a in s||(s={}))t.call(s,a)&&l(e,a,s[a]);if(r)for(var a of r(s))i.call(s,a)&&l(e,a,s[a]);return e},c=(e,r)=>s(e,a(r)),d=(e,s,a)=>new Promise((r,t)=>{var i=e=>{try{n(a.next(e))}catch(s){t(s)}},l=e=>{try{n(a.throw(e))}catch(s){t(s)}},n=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,l);n((a=a.apply(e,s)).next())});import{s as o,j as m,C as x,B as u,D as h,l as g,E as p,u as j}from"./index.CQlxbczY.js";import{r as b}from"./vendor.CKEClKZl.js";import{u as f,L as v}from"./router.B_7Atevv.js";import{u as y,a as N}from"./useAdminData._DyUAAja.js";import{X as _,z as w,aH as I,g as k,n as C,a as S,d as D,A as P,c as O,F as Z,b as B,r as z,Q as A,aI as M,R as $,aJ as W}from"./ui.C72fRZ1L.js";import"./supabase.X3H3st79.js";const L=()=>{const[e,s]=b.useState(!1),a=e=>d(void 0,null,function*(){const s=[];if(e.rabies_vaccine_image){let a="";if(e.rabies_vaccine_image.includes("/temp/")){const s=e.rabies_vaccine_image.match(/temp\/[^\/]+\/[^\/\?]+/);s&&(a=s[0])}a&&s.push(a)}if(e.combo_vaccine_image){let a="";if(e.combo_vaccine_image.includes("/temp/")){const s=e.combo_vaccine_image.match(/temp\/[^\/]+\/[^\/\?]+/);s&&(a=s[0])}a&&s.push(a)}if(s.length>0)try{const{error:e}=yield o.storage.from("vaccine-certs").remove(s)}catch(a){}}),r=(e,s,a)=>d(void 0,null,function*(){const{error:r}=yield o.from("notifications").insert([{user_id:e.dog.owner_id,type:"vaccine_approval_required",title:s?"ワクチン証明書承認のお知らせ":"ワクチン証明書却下のお知らせ",message:s?`${e.dog.name}ちゃんのワクチン証明書が承認されました。ドッグランを利用できるようになりました。`:`${e.dog.name}ちゃんのワクチン証明書が却下されました。${a?`理由: ${a}`:"詳細はマイページをご確認ください。"}`,data:{dog_id:e.dog_id}}]);if(r)throw new Error(`通知の作成に失敗しました: ${r.message}`)}),t=(e,s,a)=>d(void 0,null,function*(){let r={};const{data:t,error:i}=yield o.from("dog_park_review_stages").select("id").eq("park_id",e).maybeSingle();if(i)throw i;if(t){s?r.first_stage_passed_at=(new Date).toISOString():(r.rejected_at=(new Date).toISOString(),(null==a?void 0:a.trim())&&(r.rejection_reason=a.trim()));const{error:t}=yield o.from("dog_park_review_stages").update(r).eq("park_id",e);if(t)throw t}else{r={park_id:e,first_stage_passed_at:(new Date).toISOString()},s?r.first_stage_passed_at=(new Date).toISOString():(r.rejected_at=(new Date).toISOString(),(null==a?void 0:a.trim())&&(r.rejection_reason=a.trim()));const{error:t}=yield o.from("dog_park_review_stages").insert([r]);if(t)throw t}}),i=(e,s,a)=>d(void 0,null,function*(){const{data:r,error:t}=yield o.from("dog_parks").select("id, name, owner_id").eq("id",e).single();if(t)throw t;const{error:i}=yield o.from("notifications").insert([{user_id:r.owner_id,type:"park_approval_required",title:s?"施設承認のお知らせ":"審査結果のお知らせ",message:s?`${r.name}の審査が完了し、承認されました。おめでとうございます！`:`${r.name}の審査結果をお知らせします。${a?`理由: ${a}`:"詳細はオーナーダッシュボードをご確認ください。"}`,data:{park_id:r.id}}]);if(i)throw new Error(`施設通知の作成に失敗しました: ${i.message}`)});return{isProcessing:e,handleVaccineApproval:(e,t,i)=>d(void 0,null,function*(){try{s(!0);const{data:l,error:n}=yield o.from("vaccine_certifications").select("*, dog:dogs(name, owner_id)").eq("id",e).single();if(n)throw n;const c=l,d={status:t?"approved":"rejected"};t&&(d.approved_at=(new Date).toISOString());const{error:m}=yield o.from("vaccine_certifications").update(d).eq("id",e);if(m)throw new Error(`ワクチン証明書の更新に失敗しました: ${m.message}`);const x=c.rabies_vaccine_image,u=c.combo_vaccine_image;return((null==x?void 0:x.includes("/temp/"))||(null==u?void 0:u.includes("/temp/")))&&(yield a(c)),yield r(c,t,i),{success:!0,message:`ワクチン証明書を${t?"承認":"却下"}しました`}}catch(l){return{success:!1,message:`承認処理に失敗しました: ${l.message}`}}finally{s(!1)}}),handleParkApproval:(e,a,r)=>d(void 0,null,function*(){try{s(!0);const l={status:a?"approved":"rejected"};a&&(l.approved_at=(new Date).toISOString());const{error:n}=yield o.from("dog_parks").update(l).eq("id",e);if(n)throw n;return yield t(e,a,r),yield i(e,a,r),{success:!0,message:`施設を${a?"承認":"却下"}しました`}}catch(l){return{success:!1,message:"承認処理に失敗しました"}}finally{s(!1)}}),handleImageApproval:(e,a,r)=>d(void 0,null,function*(){try{s(!0);const t={is_approved:a};!a&&(null==r?void 0:r.trim())?t.admin_notes=r.trim():t.admin_notes=null;const{error:i}=yield o.from("dog_park_facility_images").update(t).eq("id",e.id);if(i)throw i;return{success:!0,message:`画像を${a?"承認":"却下"}しました`}}catch(t){return{success:!1,message:"画像の承認処理に失敗しました"}}finally{s(!1)}}),handleVaccineExpiryUpdate:(e,a,r)=>d(void 0,null,function*(){try{s(!0);const t={};void 0!==a&&(t.rabies_expiry_date=a),void 0!==r&&(t.combo_expiry_date=r);const{error:i}=yield o.from("vaccine_certifications").update(t).eq("id",e);if(i)throw new Error(`有効期限の更新に失敗しました: ${i.message}`);return{success:!0,message:"有効期限を更新しました"}}catch(t){return{success:!1,message:`有効期限の更新に失敗しました: ${t.message}`}}finally{s(!1)}})}},G=({pendingParks:e,isLoading:s,onApprovalComplete:a,onError:r})=>{e.forEach((e,s)=>{});const[t,i]=b.useState(null),[l,n]=b.useState(""),[c,h]=b.useState(null),[g,p]=b.useState(!1),[j,f]=b.useState(null),[v,N]=b.useState(null),[M,$]=b.useState(null),[W,G]=b.useState(!1),E=L(),H=y((null==t?void 0:t.id)||null);b.useEffect(()=>{d(void 0,null,function*(){try{const{data:e,error:s}=yield o.from("owner_verifications").select("*").order("created_at",{ascending:!1});s||(null==e||e.filter(e=>e.verification_id&&e.verification_id.includes("identity_")),null==e||e.forEach(e=>{}))}catch(e){}})},[]),b.useEffect(()=>{(null==t?void 0:t.owner_id)&&q(t.owner_id)},[t]);const q=e=>d(void 0,null,function*(){try{G(!0),$(null);const{data:s,error:a}=yield o.from("profiles").select("name, postal_code, address, phone_number, email").eq("id",e).single();if(a)return void $(`プロフィール情報の取得に失敗しました: ${a.message}`);const{data:r,error:t}=yield o.from("owner_verifications").select("*").eq("user_id",e).order("created_at",{ascending:!1}).limit(1);if(r&&r.length>0){const e=r[0];let a="",t="";e.verification_data&&"object"==typeof e.verification_data&&(a=e.verification_data.document_url||e.verification_data.file_path||"",t=e.verification_data.file_name||e.verification_data.filename||""),!a&&e.verification_id&&(a=e.verification_id),t||(t=a.split("/").pop()||"identity_document"),N({id:e.id,owner_name:s.name||"名前未登録",postal_code:s.postal_code||"未登録",address:s.address||"未登録",phone_number:s.phone_number||"未登録",email:s.email||"未登録",identity_document_url:a,identity_document_filename:t,identity_status:e.status||"pending",identity_created_at:e.created_at||(new Date).toISOString()})}else N({id:"",owner_name:s.name||"名前未登録",postal_code:s.postal_code||"未登録",address:s.address||"未登録",phone_number:s.phone_number||"未登録",email:s.email||"未登録",identity_document_url:"",identity_document_filename:"",identity_status:"not_submitted",identity_created_at:""})}catch(s){$(`データの取得に失敗しました: ${s}`)}finally{G(!1)}}),V=(e,s)=>d(void 0,null,function*(){try{if(s){if(H.parkImages.filter(e=>null===e.is_approved||!1===e.is_approved).length>0)return void r("すべての画像を承認してから施設を承認してください")}const t=yield E.handleParkApproval(e,s,l);t.success?(a(t.message),i(null),n("")):r(t.message)}catch(t){r(`処理中にエラーが発生しました: ${t.message}`)}}),T=e=>d(void 0,null,function*(){if(c)try{const s=yield E.handleImageApproval(c,e,l);s.success?(a(s.message),yield H.fetchParkImages(t.id),p(!1),h(null),n("")):r(s.message)}catch(s){r(`処理中にエラーが発生しました: ${s.message}`)}}),U=e=>d(void 0,null,function*(){if(window.confirm("このドッグラン申請を削除してもよろしいですか？この操作は取り消せません。"))try{try{const{error:s}=yield o.from("news_announcements").delete().eq("park_id",e);if(s)return void r(`ニュースの削除に失敗しました: ${s.message}`)}catch(s){return void r("ニュース削除処理でエラーが発生しました。")}try{const{error:s}=yield o.from("new_park_openings").delete().eq("park_id",e);if(s)return void r(`新規開園情報の削除に失敗しました: ${s.message}`)}catch(s){return void r("新規開園情報削除処理でエラーが発生しました。")}try{const{data:s}=yield o.from("smart_locks").select("lock_id").eq("park_id",e);if(s&&s.length>0){const e=s.map(e=>e.lock_id),{error:a}=yield o.from("lock_access_logs").delete().in("lock_id",e);if(a)return void r(`ロックアクセスログの削除に失敗しました: ${a.message}`)}}catch(s){return void r("ロックアクセスログ削除処理でエラーが発生しました。")}try{const{error:s}=yield o.from("smart_locks").delete().eq("park_id",e);if(s)return void r(`スマートロックの削除に失敗しました: ${s.message}`)}catch(s){return void r("スマートロック削除処理でエラーが発生しました。")}try{const{error:s}=yield o.from("user_entry_status").delete().eq("park_id",e);if(s)return void r(`エントリーステータスの削除に失敗しました: ${s.message}`)}catch(s){return void r("エントリーステータス削除処理でエラーが発生しました。")}try{const{error:s}=yield o.from("reservations").delete().eq("park_id",e);if(s)return void r(`予約の削除に失敗しました: ${s.message}`)}catch(s){return void r("予約削除処理でエラーが発生しました。")}try{const{error:s}=yield o.from("dog_encounters").delete().eq("park_id",e);if(s)return void r(`出会い記録の削除に失敗しました: ${s.message}`)}catch(s){return void r("出会い記録削除処理でエラーが発生しました。")}try{const{data:s}=yield o.from("dog_park_reviews").select("id").eq("park_id",e);if(s&&s.length>0){const e=s.map(e=>e.id),{error:a}=yield o.from("dog_park_review_images").delete().in("review_id",e);if(a)return void r(`レビュー画像の削除に失敗しました: ${a.message}`)}}catch(s){return void r("レビュー画像削除処理でエラーが発生しました。")}try{const{error:s}=yield o.from("dog_park_reviews").delete().eq("park_id",e);if(s)return void r(`レビューの削除に失敗しました: ${s.message}`)}catch(s){return void r("レビュー削除処理でエラーが発生しました。")}try{const{error:s}=yield o.from("dog_park_facility_images").delete().eq("park_id",e);if(s)return void r(`施設画像の削除に失敗しました: ${s.message}`)}catch(s){return void r("施設画像削除処理でエラーが発生しました。")}try{const{error:s}=yield o.from("dog_park_images").delete().eq("park_id",e);if(s)return void r(`パーク画像の削除に失敗しました: ${s.message}`)}catch(s){return void r("パーク画像削除処理でエラーが発生しました。")}try{const{error:s}=yield o.from("dog_park_review_stages").delete().eq("park_id",e);if(s)return void r(`レビューステージの削除に失敗しました: ${s.message}`)}catch(s){return void r("レビューステージ削除処理でエラーが発生しました。")}try{const{error:s}=yield o.from("dog_parks").delete().eq("id",e);if(s)return void r(`ドッグランの削除に失敗しました: ${s.message}`)}catch(s){return void r("ドッグラン削除処理でエラーが発生しました。")}a("ドッグラン申請を削除しました。"),i(null)}catch(s){r("ドッグランの削除に失敗しました。")}}),R=e=>({overview:"施設全景",entrance:"入口",large_dog_area:"大型犬エリア",small_dog_area:"小型犬エリア",private_booth:"プライベートブース",parking:"駐車場",shower:"シャワー設備",restroom:"トイレ",agility:"アジリティ設備",rest_area:"休憩スペース",water_station:"給水設備",exterior:"外観",interior:"内装",equipment:"設備",area:"エリア",other:"その他"}[e]||e);return s?m.jsx("div",{className:"flex justify-center items-center h-64",children:m.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):j?m.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center p-4 z-50",children:m.jsxs("div",{className:"relative max-w-6xl w-full max-h-[90vh]",children:[m.jsx("button",{onClick:()=>f(null),className:"absolute top-4 right-4 p-2 bg-white bg-opacity-90 shadow-lg rounded-full text-gray-800 hover:bg-opacity-100 transition-all z-10",children:m.jsx(_,{className:"w-6 h-6"})}),m.jsx("img",{src:j,alt:"拡大画像",className:"max-w-full max-h-full mx-auto rounded-lg object-contain",onError:e=>{e.currentTarget.src="https://via.placeholder.com/800x600?text=Image+Not+Available"}})]})}):g&&c?m.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[m.jsx("div",{className:"flex items-center space-x-4 mb-6",children:m.jsxs("button",{onClick:()=>{p(!1),h(null),n("")},className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[m.jsx(w,{className:"w-4 h-4 mr-2"}),"画像一覧に戻る"]})}),m.jsxs(x,{className:"p-6",children:[m.jsxs("div",{className:"flex justify-between items-center mb-6",children:[m.jsxs("h2",{className:"text-xl font-bold",children:["画像レビュー: ",R(c.image_type)]}),m.jsx("div",{className:"flex space-x-2",children:m.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-medium "+(!0===c.is_approved?"bg-green-100 text-green-800":!1===c.is_approved?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:!0===c.is_approved?"承認済み":!1===c.is_approved?"却下":"審査待ち"})})]}),m.jsx("div",{className:"mb-6",children:m.jsxs("div",{className:"w-full h-96 bg-gray-100 rounded-lg overflow-hidden relative group",children:[m.jsx("img",{src:c.image_url,alt:R(c.image_type),className:"w-full h-full object-contain cursor-pointer",onClick:()=>f(c.image_url),onError:e=>{e.currentTarget.src="https://via.placeholder.com/800x600?text=Image+Not+Available"}}),m.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-200 flex items-center justify-center cursor-pointer",onClick:()=>f(c.image_url),children:m.jsx(I,{className:"w-12 h-12 text-white opacity-0 group-hover:opacity-100 transition-opacity duration-200"})}),m.jsx("div",{className:"absolute bottom-4 right-4",children:m.jsx("span",{className:"px-2 py-1 bg-white bg-opacity-90 text-gray-800 text-xs rounded border shadow-sm",children:"クリックで拡大"})})]})}),m.jsxs("div",{className:"mb-6",children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"却下理由（却下する場合のみ入力）"}),m.jsx("textarea",{value:l,onChange:e=>n(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,placeholder:"例: 画像が不鮮明です。より明るく鮮明な画像を再アップロードしてください。"})]}),m.jsxs("div",{className:"flex justify-end space-x-3",children:[m.jsx(u,{variant:"secondary",onClick:()=>{p(!1),h(null),n("")},children:"キャンセル"}),m.jsxs(u,{onClick:()=>{T(!1)},isLoading:E.isProcessing,className:"bg-red-600 hover:bg-red-700",children:[m.jsx(_,{className:"w-4 h-4 mr-2"}),"却下"]}),m.jsxs(u,{onClick:()=>{T(!0)},isLoading:E.isProcessing,className:"bg-green-600 hover:bg-green-700",children:[m.jsx(k,{className:"w-4 h-4 mr-2"}),"承認"]})]})]})]}):g&&c?m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("h2",{className:"text-xl font-semibold",children:"画像審査"}),m.jsxs(u,{variant:"secondary",onClick:()=>{p(!1),h(null),n("")},children:[m.jsx(w,{className:"w-4 h-4 mr-2"}),"戻る"]})]}),m.jsxs(x,{className:"p-6",children:[m.jsxs("div",{className:"mb-6",children:[m.jsxs("h3",{className:"font-semibold mb-2",children:["画像タイプ: ",R(c.image_type)]}),m.jsxs("div",{className:"relative w-full h-96 bg-gray-100 rounded-lg overflow-hidden group",children:[m.jsx("img",{src:c.image_url,alt:R(c.image_type),className:"w-full h-full object-contain cursor-pointer",onClick:()=>f(c.image_url),onError:e=>{e.currentTarget.src="https://via.placeholder.com/800x600?text=Image+Not+Available"}}),m.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-200 flex items-center justify-center cursor-pointer",onClick:()=>f(c.image_url),children:m.jsx(I,{className:"w-12 h-12 text-white opacity-0 group-hover:opacity-100 transition-opacity duration-200"})}),m.jsx("div",{className:"absolute bottom-4 right-4",children:m.jsx("span",{className:"px-2 py-1 bg-white bg-opacity-90 text-gray-800 text-xs rounded border shadow-sm",children:"クリックで拡大"})})]})]}),m.jsxs("div",{className:"mb-6",children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"却下理由（却下する場合のみ入力）"}),m.jsx("textarea",{value:l,onChange:e=>n(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,placeholder:"例: 画像が不鮮明です。より明るく鮮明な画像を再アップロードしてください。"})]}),m.jsxs("div",{className:"flex justify-end space-x-3",children:[m.jsx(u,{variant:"secondary",onClick:()=>{p(!1),h(null),n("")},children:"キャンセル"}),m.jsxs(u,{onClick:()=>{T(!1)},isLoading:E.isProcessing,className:"bg-red-600 hover:bg-red-700",children:[m.jsx(_,{className:"w-4 h-4 mr-2"}),"却下"]}),m.jsxs(u,{onClick:()=>{T(!0)},isLoading:E.isProcessing,className:"bg-green-600 hover:bg-green-700",children:[m.jsx(k,{className:"w-4 h-4 mr-2"}),"承認"]})]})]}),j&&m.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:m.jsxs("div",{className:"relative max-w-4xl max-h-full p-4",children:[m.jsx("img",{src:j.startsWith("http")?j:`${o.storage.from("vaccine-certs").getPublicUrl(j).data.publicUrl}`,alt:"拡大画像",className:"max-w-full max-h-full object-contain"}),m.jsx(u,{onClick:()=>f(null),className:"absolute top-2 right-2 bg-white text-black hover:bg-gray-100",children:m.jsx(_,{className:"w-4 h-4"})})]})})]}):t?m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[m.jsx(C,{className:"w-6 h-6 text-blue-600 mr-2"}),t.name,"の審査"]}),m.jsxs(u,{variant:"secondary",onClick:()=>i(null),children:[m.jsx(w,{className:"w-4 h-4 mr-2"}),"一覧に戻る"]})]}),m.jsxs(x,{className:"p-6",children:[m.jsxs("h3",{className:"font-semibold mb-4 flex items-center",children:[m.jsx(C,{className:"w-5 h-5 mr-2"}),"施設情報"]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-600",children:"施設名"}),m.jsx("p",{className:"font-medium",children:t.name})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-600",children:"住所"}),m.jsx("p",{className:"font-medium",children:t.address})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-600",children:"オーナー"}),m.jsx("p",{className:"font-medium",children:t.owner_name})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-600",children:"申請日"}),m.jsx("p",{className:"font-medium",children:new Date(t.created_at).toLocaleDateString("ja-JP")})]})]})]}),m.jsxs(x,{className:"p-6",children:[m.jsxs("h3",{className:"font-semibold mb-4 flex items-center",children:[m.jsx(S,{className:"w-5 h-5 mr-2"}),"本人確認書類・登録情報"]}),W?m.jsxs("div",{className:"flex justify-center items-center h-32",children:[m.jsx(D,{className:"w-8 h-8 animate-spin text-blue-600"}),m.jsx("span",{className:"ml-2 text-gray-600",children:"データを読み込み中..."})]}):M?m.jsxs("div",{className:"text-center py-8",children:[m.jsx(P,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),m.jsx("p",{className:"text-red-600 mb-2",children:M}),m.jsx(u,{variant:"secondary",onClick:()=>t&&q(t.owner_id),children:"再読み込み"})]}):v?m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{children:[m.jsxs("h4",{className:"font-medium mb-3 flex items-center",children:[m.jsx(O,{className:"w-4 h-4 mr-2"}),"登録住所情報（照合用）"]}),m.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-600",children:"氏名"}),m.jsx("p",{className:"font-medium text-blue-900",children:v.owner_name})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-600",children:"郵便番号"}),m.jsx("p",{className:"font-medium text-blue-900",children:v.postal_code})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-600",children:"住所"}),m.jsx("p",{className:"font-medium text-blue-900",children:v.address})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-600",children:"電話番号"}),m.jsx("p",{className:"font-medium text-blue-900",children:v.phone_number})]})]})})]}),v.identity_document_url?m.jsxs("div",{children:[m.jsxs("h4",{className:"font-medium mb-3 flex items-center",children:[m.jsx(Z,{className:"w-4 h-4 mr-2"}),"本人確認書類"]}),m.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm mb-4",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-600",children:"ファイル名"}),m.jsx("p",{className:"font-medium",children:v.identity_document_filename})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-600",children:"アップロード日"}),m.jsx("p",{className:"font-medium",children:new Date(v.identity_created_at).toLocaleDateString("ja-JP")})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-600",children:"審査状況"}),m.jsx("p",{className:"font-medium "+("verified"===v.identity_status?"text-green-600":"failed"===v.identity_status?"text-red-600":"text-yellow-600"),children:"verified"===v.identity_status?"承認済み":"failed"===v.identity_status?"却下":"審査待ち"})]})]}),m.jsxs("div",{className:"mb-4",children:[m.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"本人確認書類画像"}),m.jsxs("div",{className:"relative inline-block",children:[m.jsx("img",{src:`${o.storage.from("vaccine-certs").getPublicUrl(v.identity_document_url).data.publicUrl}`,alt:"本人確認書類",className:"max-w-full h-auto max-h-96 rounded-lg border shadow-sm cursor-pointer hover:shadow-md transition-shadow",onClick:()=>f(v.identity_document_url),onError:e=>{e.currentTarget.src="https://via.placeholder.com/400x300?text=Image+Not+Available"}}),m.jsx("div",{className:"absolute bottom-2 right-2",children:m.jsx("span",{className:"px-2 py-1 bg-white bg-opacity-90 text-gray-800 text-xs rounded border shadow-sm",children:"クリックで拡大"})})]})]}),m.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:m.jsxs("div",{className:"flex items-start",children:[m.jsx(P,{className:"w-5 h-5 text-yellow-600 mr-2 mt-0.5"}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"照合チェック"}),m.jsx("p",{className:"text-sm text-yellow-700",children:"本人確認書類に記載された住所・氏名と、上記の登録情報が一致するかご確認ください。"})]})]})})]})]}):m.jsxs("div",{children:[m.jsxs("h4",{className:"font-medium mb-3 flex items-center",children:[m.jsx(Z,{className:"w-4 h-4 mr-2"}),"本人確認書類"]}),m.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:m.jsxs("div",{className:"flex items-start",children:[m.jsx(P,{className:"w-5 h-5 text-red-600 mr-2 mt-0.5"}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-red-800",children:"not_submitted"===v.identity_status?"本人確認書類が未提出です":"本人確認書類の取得に失敗しました"}),m.jsx("p",{className:"text-sm text-red-700 mt-1",children:"not_submitted"===v.identity_status?"このドッグラン申請には本人確認書類が添付されていません。申請者に本人確認書類の提出を依頼してください。":"システムエラーまたは画像ファイルの問題が発生している可能性があります。"})]})]})})]})]}):m.jsx("div",{className:"text-center py-8",children:m.jsx("p",{className:"text-gray-600",children:"データを読み込み中..."})})]}),("second_stage_review"===t.status||"first_stage_passed"===t.status||t.total_images>0)&&m.jsxs(x,{className:"p-6",children:[m.jsx("h3",{className:"font-semibold mb-4",children:"施設画像"}),m.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[m.jsxs("div",{className:"bg-blue-50 p-3 rounded text-center",children:[m.jsx("p",{className:"font-medium text-blue-800",children:"全画像"}),m.jsxs("p",{className:"text-blue-600",children:[t.total_images,"枚"]})]}),m.jsxs("div",{className:"bg-yellow-50 p-3 rounded text-center",children:[m.jsx("p",{className:"font-medium text-yellow-800",children:"審査待ち"}),m.jsxs("p",{className:"text-yellow-600",children:[t.pending_images,"枚"]})]}),m.jsxs("div",{className:"bg-green-50 p-3 rounded text-center",children:[m.jsx("p",{className:"font-medium text-green-800",children:"承認済み"}),m.jsxs("p",{className:"text-green-600",children:[t.approved_images,"枚"]})]}),m.jsxs("div",{className:"bg-red-50 p-3 rounded text-center",children:[m.jsx("p",{className:"font-medium text-red-800",children:"却下"}),m.jsxs("p",{className:"text-red-600",children:[t.rejected_images,"枚"]})]})]}),m.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded text-sm",children:[m.jsx("p",{children:m.jsx("strong",{children:"デバッグ情報:"})}),m.jsxs("p",{children:["Park ID: ",t.id]}),m.jsxs("p",{children:["Status: ",t.status]}),m.jsxs("p",{children:["Images Loading: ",H.isLoading?"Yes":"No"]}),m.jsxs("p",{children:["Images Count: ",H.parkImages.length]}),m.jsxs("p",{children:["Images Error: ",H.error||"None"]}),m.jsxs("p",{children:["Expected Total: ",t.total_images]}),m.jsxs("div",{className:"mt-2 flex space-x-2",children:[m.jsx(u,{size:"sm",variant:"secondary",onClick:()=>{H.fetchParkImages(t.id)},children:"画像再取得"}),m.jsx(u,{size:"sm",variant:"secondary",onClick:()=>d(void 0,null,function*(){try{const{data:e,error:s}=yield o.from("dog_park_facility_images").select("*").eq("park_id",t.id);s||alert("データベース直接クエリ結果をコンソールに出力しました")}catch(e){}}),children:"DB直接確認"})]}),m.jsxs("div",{className:"mt-2",children:[m.jsx("p",{children:m.jsx("strong",{children:"Raw Images Data:"})}),m.jsx("pre",{className:"text-xs bg-white p-2 rounded border max-h-32 overflow-y-auto",children:JSON.stringify(H.parkImages,null,2)})]})]}),H.isLoading?m.jsxs("div",{className:"flex justify-center items-center h-32",children:[m.jsx(D,{className:"w-8 h-8 animate-spin text-blue-600"}),m.jsx("span",{className:"ml-2 text-gray-600",children:"画像を読み込み中..."})]}):H.error?m.jsxs("div",{className:"text-center py-8",children:[m.jsx("p",{className:"text-red-600 mb-2",children:"画像の読み込みに失敗しました"}),m.jsx("p",{className:"text-gray-500 text-sm",children:H.error}),m.jsx(u,{variant:"secondary",onClick:()=>{H.fetchParkImages(t.id)},className:"mt-4",children:"再読み込み"})]}):0===H.parkImages.length?m.jsxs("div",{className:"text-center py-8",children:[m.jsx("p",{className:"text-gray-600",children:"アップロードされた画像がありません"}),m.jsxs("p",{className:"text-gray-500 text-sm",children:["パークステータス: ",t.status]}),m.jsxs("p",{className:"text-gray-500 text-sm",children:["期待される画像数: ",t.total_images]}),m.jsx(u,{variant:"secondary",onClick:()=>{H.fetchParkImages(t.id)},className:"mt-4",children:"手動でリフレッシュ"})]}):m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:H.parkImages.map((e,s)=>m.jsxs("div",{className:"relative group",children:[m.jsxs("div",{className:"relative overflow-hidden rounded-lg bg-gray-100",children:[m.jsx("img",{src:e.image_url,alt:R(e.image_type),className:"w-full h-48 object-cover cursor-pointer hover:scale-105 transition-transform duration-200",onClick:()=>(e=>{h(e),p(!0),n(e.admin_notes||"")})(e),onLoad:()=>{},onError:e=>{e.currentTarget.src="https://via.placeholder.com/400x300?text=Image+Not+Available"}}),m.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-200 flex items-center justify-center cursor-pointer",onClick:s=>{s.stopPropagation(),f(e.image_url)},children:m.jsx(I,{className:"w-8 h-8 text-white opacity-0 group-hover:opacity-100 transition-opacity duration-200"})})]}),m.jsx("div",{className:"absolute top-2 right-2",children:m.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+(!0===e.is_approved?"bg-green-100 text-green-800":!1===e.is_approved?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:!0===e.is_approved?"承認済み":!1===e.is_approved?"却下":"審査待ち"})}),m.jsx("div",{className:"absolute bottom-2 left-2",children:m.jsx("span",{className:"px-2 py-1 bg-white bg-opacity-90 text-gray-800 text-xs rounded border shadow-sm",children:R(e.image_type)})}),!1===e.is_approved&&e.admin_notes&&m.jsxs("div",{className:"mt-2 p-2 bg-red-50 rounded text-sm",children:[m.jsx("p",{className:"text-red-800 font-medium",children:"却下理由:"}),m.jsx("p",{className:"text-red-700",children:e.admin_notes})]})]},e.id))})]}),m.jsxs(x,{className:"p-6",children:[m.jsx("h3",{className:"font-semibold mb-4",children:"審査結果"}),m.jsx("div",{className:"mb-4",children:m.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[m.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"審査チェックリスト"}),m.jsxs("div",{className:"space-y-2 text-sm",children:[m.jsxs("div",{className:"flex items-center",children:[m.jsx("span",{className:"w-4 h-4 rounded-full mr-2 "+((null==v?void 0:v.owner_name)&&"名前未登録"!==v.owner_name?"bg-green-500":"bg-red-500")}),m.jsxs("span",{children:["登録氏名: ",(null==v?void 0:v.owner_name)||"未登録"]})]}),m.jsxs("div",{className:"flex items-center",children:[m.jsx("span",{className:"w-4 h-4 rounded-full mr-2 "+((null==v?void 0:v.address)&&"未登録"!==v.address?"bg-green-500":"bg-red-500")}),m.jsxs("span",{children:["登録住所: ",(null==v?void 0:v.address)||"未登録"]})]}),m.jsxs("div",{className:"flex items-center",children:[m.jsx("span",{className:"w-4 h-4 rounded-full mr-2 "+((null==v?void 0:v.phone_number)&&"未登録"!==v.phone_number?"bg-green-500":"bg-red-500")}),m.jsxs("span",{children:["電話番号: ",(null==v?void 0:v.phone_number)||"未登録"]})]}),m.jsxs("div",{className:"flex items-center",children:[m.jsx("span",{className:"w-4 h-4 rounded-full mr-2 "+((null==v?void 0:v.identity_document_url)?"bg-green-500":"bg-red-500")}),m.jsxs("span",{children:["本人確認書類: ",(null==v?void 0:v.identity_document_url)?"提出済み":"未提出"]})]}),(null==v?void 0:v.identity_document_url)&&m.jsxs("div",{className:"flex items-center",children:[m.jsx("span",{className:"w-4 h-4 rounded-full mr-2 "+("verified"===v.identity_status?"bg-green-500":"failed"===v.identity_status?"bg-red-500":"bg-yellow-500")}),m.jsxs("span",{children:["本人確認状況: ","verified"===v.identity_status?"承認済み":"failed"===v.identity_status?"却下":"審査待ち"]})]})]})]})}),(!(null==v?void 0:v.identity_document_url)||"not_submitted"===v.identity_status)&&m.jsx("div",{className:"mb-4",children:m.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:m.jsxs("div",{className:"flex items-start",children:[m.jsx(P,{className:"w-5 h-5 text-yellow-600 mr-2 mt-0.5"}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"審査判断の推奨事項"}),m.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"本人確認書類が未提出のため、申請を承認する前に申請者に本人確認書類の提出を依頼することを推奨します。 または、不備として一時的に却下し、必要書類の提出を求めてください。"})]})]})})}),m.jsxs("div",{className:"mb-4",children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"却下理由（却下する場合のみ入力）"}),m.jsx("textarea",{value:l,onChange:e=>n(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,placeholder:"例: 本人確認書類が未提出のため、身元確認ができません。本人確認書類（運転免許証、パスポート、マイナンバーカードなど）を提出してから再度申請してください。"})]}),m.jsxs("div",{className:"flex justify-end space-x-3",children:[m.jsxs(u,{onClick:()=>{V(t.id,!1)},isLoading:E.isProcessing,className:"bg-red-600 hover:bg-red-700",children:[m.jsx(_,{className:"w-4 h-4 mr-2"}),"却下"]}),m.jsxs(u,{onClick:()=>{V(t.id,!0)},isLoading:E.isProcessing,className:"bg-green-600 hover:bg-green-700",disabled:!(null==v?void 0:v.identity_document_url)&&"not_submitted"===(null==v?void 0:v.identity_status),children:[m.jsx(k,{className:"w-4 h-4 mr-2"}),"承認"]}),m.jsxs(u,{onClick:()=>{U(t.id)},isLoading:E.isProcessing,className:"bg-red-600 hover:bg-red-700",children:[m.jsx(_,{className:"w-4 h-4 mr-2"}),"削除"]})]})]}),j&&m.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:m.jsxs("div",{className:"relative max-w-4xl max-h-full p-4",children:[m.jsx("img",{src:j.startsWith("http")?j:`${o.storage.from("vaccine-certs").getPublicUrl(j).data.publicUrl}`,alt:"拡大画像",className:"max-w-full max-h-full object-contain"}),m.jsx(u,{onClick:()=>f(null),className:"absolute top-2 right-2 bg-white text-black hover:bg-gray-100",children:m.jsx(_,{className:"w-4 h-4"})})]})})]}):m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[m.jsx(B,{className:"w-6 h-6 text-blue-600 mr-2"}),"ドッグラン審査管理"]}),m.jsxs("div",{className:"text-sm text-gray-600",children:["審査待ち: ",e.length,"件"]})]}),m.jsx(x,{className:"bg-blue-50 border-blue-200",children:m.jsxs("div",{className:"p-4",children:[m.jsx("h3",{className:"font-semibold text-blue-900 mb-3",children:"審査プロセス概要"}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[m.jsxs("div",{className:"text-center",children:[m.jsx("div",{className:"w-8 h-8 bg-yellow-600 text-white rounded-full flex items-center justify-center text-sm font-bold mx-auto mb-2",children:"1"}),m.jsx("div",{className:"text-sm font-medium text-blue-900",children:"第一審査"}),m.jsx("div",{className:"text-xs text-blue-700",children:"基本情報・本人確認"})]}),m.jsxs("div",{className:"text-center",children:[m.jsx("div",{className:"w-8 h-8 bg-orange-600 text-white rounded-full flex items-center justify-center text-sm font-bold mx-auto mb-2",children:"2"}),m.jsx("div",{className:"text-sm font-medium text-blue-900",children:"第二審査"}),m.jsx("div",{className:"text-xs text-blue-700",children:"施設画像・詳細審査"})]}),m.jsxs("div",{className:"text-center",children:[m.jsx("div",{className:"w-8 h-8 bg-indigo-600 text-white rounded-full flex items-center justify-center text-sm font-bold mx-auto mb-2",children:"3"}),m.jsx("div",{className:"text-sm font-medium text-blue-900",children:"実証検査"}),m.jsx("div",{className:"text-xs text-blue-700",children:"スマートロック確認"})]}),m.jsxs("div",{className:"text-center",children:[m.jsx("div",{className:"w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center text-sm font-bold mx-auto mb-2",children:"4"}),m.jsx("div",{className:"text-sm font-medium text-blue-900",children:"公開承認"}),m.jsx("div",{className:"text-xs text-blue-700",children:"一般公開開始"})]})]})]})}),e.length>0&&m.jsx(x,{className:"bg-gray-50",children:m.jsxs("div",{className:"p-4",children:[m.jsx("h3",{className:"font-medium mb-3",children:"審査状況統計"}),m.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 text-sm",children:[m.jsxs("div",{className:"text-center",children:[m.jsx("div",{className:"text-lg font-bold text-yellow-600",children:e.filter(e=>"pending"===e.status).length}),m.jsx("div",{className:"text-gray-600",children:"第一審査中"})]}),m.jsxs("div",{className:"text-center",children:[m.jsx("div",{className:"text-lg font-bold text-orange-600",children:e.filter(e=>"second_stage_waiting"===e.status).length}),m.jsx("div",{className:"text-gray-600",children:"第二審査待ち"})]}),m.jsxs("div",{className:"text-center",children:[m.jsx("div",{className:"text-lg font-bold text-purple-600",children:e.filter(e=>"second_stage_review"===e.status).length}),m.jsx("div",{className:"text-gray-600",children:"第二審査中"})]}),m.jsxs("div",{className:"text-center",children:[m.jsx("div",{className:"text-lg font-bold text-indigo-600",children:e.filter(e=>"smart_lock_testing"===e.status).length}),m.jsx("div",{className:"text-gray-600",children:"実証検査中"})]}),m.jsxs("div",{className:"text-center",children:[m.jsx("div",{className:"text-lg font-bold text-green-600",children:e.filter(e=>"approved"===e.status).length}),m.jsx("div",{className:"text-gray-600",children:"承認済み"})]})]})]})}),0===e.length?m.jsxs(x,{className:"text-center py-12",children:[m.jsx(k,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),m.jsx("p",{className:"text-gray-600",children:"審査待ちのドッグランはありません"})]}):m.jsx("div",{className:"space-y-4",children:e.map(e=>{const s=(e=>{switch(e){case"pending":return{color:"bg-yellow-100 text-yellow-800 border-yellow-300",label:"第一審査中",description:"基本情報と本人確認書類を確認してください",action:"承認または却下"};case"second_stage_waiting":return{color:"bg-orange-100 text-orange-800 border-orange-300",label:"第二審査提出待ち",description:"オーナーが第二審査書類を提出するまで待機",action:"待機中"};case"second_stage_review":return{color:"bg-purple-100 text-purple-800 border-purple-300",label:"第二審査中",description:"施設画像と詳細情報を確認してください",action:"画像審査・承認"};case"smart_lock_testing":return{color:"bg-indigo-100 text-indigo-800 border-indigo-300",label:"スマートロック実証検査中",description:"実際の施設でのスマートロック動作確認",action:"実証検査完了"};default:return{color:"bg-gray-100 text-gray-800 border-gray-300",label:e,description:"",action:""}}})(e.status);return m.jsx(x,{className:`p-6 border-2 ${s.color.includes("border")?s.color:s.color+" border-gray-200"}`,children:m.jsxs("div",{className:"flex items-start justify-between",children:[m.jsxs("div",{className:"flex-1",children:[m.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[m.jsx("h3",{className:"text-lg font-semibold",children:e.name}),m.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${s.color}`,children:s.label})]}),m.jsxs("div",{className:"space-y-1 text-sm text-gray-600 mb-3",children:[m.jsxs("p",{children:[m.jsx(B,{className:"w-4 h-4 inline mr-1"}),e.address]}),m.jsxs("p",{children:[m.jsx(O,{className:"w-4 h-4 inline mr-1"}),"オーナー: ",e.owner_name]})]}),m.jsxs("div",{className:"bg-white p-3 rounded-lg border",children:[m.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"現在の審査状況"}),m.jsx("p",{className:"text-sm text-gray-600",children:s.description}),s.action&&m.jsxs("p",{className:"text-sm font-medium text-blue-600 mt-2",children:["推奨アクション: ",s.action]})]})]}),m.jsxs("div",{className:"ml-4 flex flex-col space-y-2",children:[m.jsxs(u,{onClick:()=>i(e),className:"bg-blue-600 hover:bg-blue-700",size:"sm",children:[m.jsx(z,{className:"w-4 h-4 mr-2"}),"詳細確認"]}),m.jsxs(u,{onClick:()=>{U(e.id)},className:"bg-red-600 hover:bg-red-700",size:"sm",children:[m.jsx(A,{className:"w-4 h-4 mr-2"}),"削除"]}),"second_stage_waiting"===e.status&&m.jsx("div",{className:"text-xs text-gray-500 text-center",children:"オーナーの提出待ち"})]})]})},e.id)})})]})},E=({pendingVaccines:e,isLoading:s,onApprovalComplete:a,onError:r})=>{const[t,i]=b.useState(null),[l,o]=b.useState(""),[g,p]=b.useState({}),[j,f]=b.useState({}),[v,y]=b.useState(null),[N,C]=b.useState(1),[S,D]=b.useState(!1),[P,O]=b.useState({rabies_expiry_date:"",combo_expiry_date:""}),Z=L(),B=(e,s)=>d(void 0,null,function*(){try{const t=yield Z.handleVaccineApproval(e,s,l);t.success?(a(t.message),i(null),o("")):r(t.message)}catch(t){r(`処理中にエラーが発生しました: ${t.message}`)}}),A=e=>{p(s=>c(n({},s),{[e]:!1}))},G=e=>{p(s=>c(n({},s),{[e]:!1})),f(s=>c(n({},s),{[e]:!0}))},E=e=>{p(s=>c(n({},s),{[e]:!0})),f(s=>c(n({},s),{[e]:!1}))},H=(e,s,a)=>{y({src:e,alt:s,type:a}),C(1)},q=()=>{y(null),C(1)},V=()=>{C(e=>Math.min(e+.5,3))},T=()=>{C(e=>Math.max(e-.5,.5))},U=e=>{O({rabies_expiry_date:e.rabies_expiry_date||"",combo_expiry_date:e.combo_expiry_date||""})},R=e=>{if(!e)return"未設定";try{return new Date(e).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})}catch(s){return"無効な日付"}},J=e=>{if(!e)return!1;return new Date(e)<=new Date((new Date).getTime()+2592e6)},Q=e=>{if(!e)return!1;return new Date(e)<new Date};return s?m.jsx("div",{className:"flex justify-center items-center h-64",children:m.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):t?(""===P.rabies_expiry_date&&""===P.combo_expiry_date&&U(t),m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[m.jsx(M,{className:"w-6 h-6 text-blue-600 mr-2"}),t.dog.name,"のワクチン証明書審査"]}),m.jsxs(u,{variant:"secondary",onClick:()=>{i(null),D(!1),O({rabies_expiry_date:"",combo_expiry_date:""})},children:[m.jsx(w,{className:"w-4 h-4 mr-2"}),"一覧に戻る"]})]}),m.jsxs(x,{className:"p-4",children:[m.jsx("h3",{className:"font-semibold mb-3",children:"犬の基本情報"}),m.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-600",children:"名前"}),m.jsx("p",{className:"font-medium",children:t.dog.name})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-600",children:"犬種"}),m.jsx("p",{className:"font-medium",children:t.dog.breed})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-600",children:"性別"}),m.jsx("p",{className:"font-medium",children:t.dog.gender})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-600",children:"飼い主"}),m.jsx("p",{className:"font-medium",children:t.dog.owner.name})]})]})]}),m.jsxs(x,{className:"p-6",children:[m.jsxs("div",{className:"flex justify-between items-center mb-4",children:[m.jsx("h3",{className:"font-semibold",children:"ワクチン有効期限"}),m.jsx(u,{size:"sm",variant:"secondary",onClick:()=>D(!S),children:S?"キャンセル":"編集"})]}),S?m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"狂犬病ワクチン有効期限"}),m.jsx("input",{type:"date",value:P.rabies_expiry_date,onChange:e=>O(s=>c(n({},s),{rabies_expiry_date:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"混合ワクチン有効期限"}),m.jsx("input",{type:"date",value:P.combo_expiry_date,onChange:e=>O(s=>c(n({},s),{combo_expiry_date:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),m.jsxs("div",{className:"flex justify-end space-x-2",children:[m.jsx(u,{variant:"secondary",onClick:()=>{D(!1),U(t)},children:"キャンセル"}),m.jsx(u,{onClick:()=>{d(void 0,null,function*(){if(t)try{const e=yield Z.handleVaccineExpiryUpdate(t.id,P.rabies_expiry_date||null,P.combo_expiry_date||null);e.success?(a(e.message),D(!1),t&&(t.rabies_expiry_date=P.rabies_expiry_date||null,t.combo_expiry_date=P.combo_expiry_date||null)):r(e.message)}catch(e){r(`有効期限の更新に失敗しました: ${e.message}`)}})},isLoading:Z.isProcessing,className:"bg-blue-600 hover:bg-blue-700",children:"保存"})]})]}):m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"狂犬病ワクチン有効期限"}),m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx("p",{className:"font-medium "+(Q(t.rabies_expiry_date)?"text-red-600":J(t.rabies_expiry_date)?"text-yellow-600":"text-green-600"),children:R(t.rabies_expiry_date)}),Q(t.rabies_expiry_date)&&m.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full",children:"期限切れ"}),J(t.rabies_expiry_date)&&!Q(t.rabies_expiry_date)&&m.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:"期限間近"})]})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"混合ワクチン有効期限"}),m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx("p",{className:"font-medium "+(Q(t.combo_expiry_date)?"text-red-600":J(t.combo_expiry_date)?"text-yellow-600":"text-green-600"),children:R(t.combo_expiry_date)}),Q(t.combo_expiry_date)&&m.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full",children:"期限切れ"}),J(t.combo_expiry_date)&&!Q(t.combo_expiry_date)&&m.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:"期限間近"})]})]})]})]}),m.jsxs(x,{className:"p-6",children:[m.jsx("h3",{className:"font-semibold mb-4",children:"ワクチン証明書"}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[m.jsxs("div",{children:[m.jsx("h4",{className:"font-medium mb-2",children:"狂犬病ワクチン"}),t.rabies_vaccine_image?m.jsxs("div",{className:"border rounded-lg overflow-hidden relative",children:[g[`rabies-${t.id}`]&&m.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 z-10",children:m.jsx($,{className:"w-6 h-6 animate-spin text-gray-600"})}),m.jsx("img",{src:h(t.rabies_vaccine_image)||"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjNmNGY2Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzM3NDE1MSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPueUu+WDj+OBjOiqreOCgeWFpeOBv+OBvuOBm+OCk+OBp+OBl+OBnw==</dGV4dD48L3N2Zz4=",alt:"狂犬病ワクチン証明書",className:"w-full h-64 object-contain cursor-pointer hover:opacity-80 transition-opacity",onLoadStart:()=>E(`rabies-${t.id}`),onLoad:()=>A(`rabies-${t.id}`),onError:()=>G(`rabies-${t.id}`),onClick:()=>H(h(t.rabies_vaccine_image)||"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjNmNGY2Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzM3NDE1MSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPueUu+WDj+OBjOiqreOCgeWFpeOBv+OBvuOBm+OCk+OBp+OBl+OBnw==</dGV4dD48L3N2Zz4=","狂犬病ワクチン証明書","rabies")}),m.jsx("div",{className:"absolute top-2 left-2 bg-white bg-opacity-90 text-gray-800 p-1 rounded border shadow-sm",children:m.jsx(I,{className:"w-4 h-4"})}),j[`rabies-${t.id}`]&&m.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-red-50 bg-opacity-90",children:m.jsxs("div",{className:"text-center",children:[m.jsx(_,{className:"w-12 h-12 text-red-500 mx-auto mb-2"}),m.jsx("p",{className:"text-red-700 font-medium",children:"画像が読み込めませんでした"})]})})]}):m.jsx("div",{className:"h-64 bg-gray-100 rounded-lg flex items-center justify-center",children:m.jsx("p",{className:"text-gray-500",children:"画像なし"})})]}),m.jsxs("div",{children:[m.jsx("h4",{className:"font-medium mb-2",children:"混合ワクチン"}),t.combo_vaccine_image?m.jsxs("div",{className:"border rounded-lg overflow-hidden relative",children:[g[`combo-${t.id}`]&&m.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 z-10",children:m.jsx($,{className:"w-6 h-6 animate-spin text-gray-600"})}),m.jsx("img",{src:h(t.combo_vaccine_image)||"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjNmNGY2Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzM3NDE1MSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPueUu+WDj+OBjOiqreOCgeWFpeOBv+OBvuOBm+OCk+OBp+OBl+OBnw==</dGV4dD48L3N2Zz4=",alt:"混合ワクチン証明書",className:"w-full h-64 object-contain cursor-pointer hover:opacity-80 transition-opacity",onLoadStart:()=>E(`combo-${t.id}`),onLoad:()=>A(`combo-${t.id}`),onError:()=>G(`combo-${t.id}`),onClick:()=>H(h(t.combo_vaccine_image)||"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjNmNGY2Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzM3NDE1MSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPueUu+WDj+OBjOiqreOCgeWFpeOBv+OBvuOBm+OCk+OBp+OBl+OBnw==</dGV4dD48L3N2Zz4=","混合ワクチン証明書","combo")}),m.jsx("div",{className:"absolute top-2 left-2 bg-white bg-opacity-90 text-gray-800 p-1 rounded border shadow-sm",children:m.jsx(I,{className:"w-4 h-4"})}),j[`combo-${t.id}`]&&m.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-red-50 bg-opacity-90",children:m.jsxs("div",{className:"text-center",children:[m.jsx(_,{className:"w-12 h-12 text-red-500 mx-auto mb-2"}),m.jsx("p",{className:"text-red-700 font-medium",children:"画像が読み込めませんでした"})]})})]}):m.jsx("div",{className:"h-64 bg-gray-100 rounded-lg flex items-center justify-center",children:m.jsx("p",{className:"text-gray-500",children:"画像なし"})})]})]})]}),m.jsxs(x,{className:"p-6",children:[m.jsx("h3",{className:"font-semibold mb-4",children:"審査結果"}),m.jsxs("div",{className:"mb-4",children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"却下理由（却下する場合のみ入力）"}),m.jsx("textarea",{value:l,onChange:e=>o(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,placeholder:"例: ワクチン証明書の有効期限が切れています。最新の証明書をアップロードしてください。"})]}),m.jsxs("div",{className:"flex justify-end space-x-3",children:[m.jsxs(u,{onClick:()=>{B(t.id,!1)},isLoading:Z.isProcessing,className:"bg-red-600 hover:bg-red-700",children:[m.jsx(_,{className:"w-4 h-4 mr-2"}),"却下"]}),m.jsxs(u,{onClick:()=>{B(t.id,!0)},isLoading:Z.isProcessing,className:"bg-green-600 hover:bg-green-700",children:[m.jsx(k,{className:"w-4 h-4 mr-2"}),"承認"]})]})]}),v&&m.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4",children:[m.jsxs("div",{className:"relative max-w-full max-h-full",children:[m.jsxs("div",{className:"absolute top-4 right-4 flex items-center space-x-2 z-10",children:[m.jsx("div",{className:"bg-white bg-opacity-90 text-gray-800 px-3 py-1 rounded border shadow-sm text-sm",children:"rabies"===v.type?"狂犬病ワクチン":"混合ワクチン"}),m.jsx(u,{size:"sm",onClick:T,className:"bg-white bg-opacity-90 shadow-lg text-gray-800 hover:bg-opacity-100 border border-gray-300",children:m.jsx(W,{className:"w-4 h-4"})}),m.jsx(u,{size:"sm",onClick:V,className:"bg-white bg-opacity-90 shadow-lg text-gray-800 hover:bg-opacity-100 border border-gray-300",children:m.jsx(I,{className:"w-4 h-4"})}),m.jsx(u,{size:"sm",onClick:q,className:"bg-white bg-opacity-90 shadow-lg text-gray-800 hover:bg-opacity-100 border border-gray-300",children:m.jsx(_,{className:"w-4 h-4"})})]}),m.jsx("div",{className:"overflow-auto max-h-screen",children:m.jsx("img",{src:v.src,alt:v.alt,className:"max-w-none transition-transform duration-200",style:{transform:`scale(${N})`,transformOrigin:"center center"},onError:e=>{e.currentTarget.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjNmNGY2Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzM3NDE1MSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPueUu+WDj+OBjOiqreOCgeWFpeOBv+OBvuOBm+OCk+OBp+OBl+OBnw==</dGV4dD48L3N2Zz4="}})}),m.jsxs("div",{className:"absolute bottom-4 left-4 bg-white bg-opacity-90 text-gray-800 px-3 py-2 rounded border shadow-sm text-sm",children:[m.jsx("p",{children:"拡大/縮小: ズームボタンを使用"}),m.jsx("p",{children:"閉じる: Xボタンまたは画像外をクリック"})]})]}),m.jsx("div",{className:"absolute inset-0 -z-10",onClick:q})]})]})):m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"space-y-4",children:[m.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[m.jsx(M,{className:"w-6 h-6 text-blue-600 mr-2"}),"審査待ちワクチン証明書"]}),0===e.length?m.jsxs(x,{className:"text-center py-12",children:[m.jsx(k,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),m.jsx("p",{className:"text-gray-600",children:"審査待ちのワクチン証明書はありません"})]}):m.jsx("div",{className:"space-y-4",children:e.map(e=>m.jsx(x,{className:"p-6 hover:shadow-lg transition-shadow",children:m.jsxs("div",{className:"flex justify-between items-start",children:[m.jsxs("div",{className:"flex-1",children:[m.jsxs("h3",{className:"text-lg font-semibold mb-2",children:[e.dog.name,"のワクチン証明書"]}),m.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-600",children:"犬種"}),m.jsx("p",{className:"font-medium",children:e.dog.breed})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-600",children:"性別"}),m.jsx("p",{className:"font-medium",children:e.dog.gender})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-600",children:"飼い主"}),m.jsx("p",{className:"font-medium",children:e.dog.owner.name})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-gray-600",children:"申請日"}),m.jsx("p",{className:"font-medium",children:new Date(e.created_at).toLocaleDateString("ja-JP")})]})]})]}),m.jsxs("div",{className:"flex space-x-2 ml-4",children:[m.jsxs(u,{size:"sm",variant:"secondary",onClick:()=>i(e),children:[m.jsx(z,{className:"w-4 h-4 mr-1"}),"詳細"]}),m.jsxs(u,{size:"sm",onClick:()=>{B(e.id,!0)},className:"bg-green-600 hover:bg-green-700",disabled:Z.isProcessing,children:[m.jsx(k,{className:"w-4 h-4 mr-1"}),"承認"]}),m.jsxs(u,{size:"sm",onClick:()=>{i(e),B(e.id,!1)},className:"bg-red-600 hover:bg-red-700",disabled:Z.isProcessing,children:[m.jsx(_,{className:"w-4 h-4 mr-1"}),"却下"]})]})]})},e.id))})]}),v&&m.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4",children:[m.jsxs("div",{className:"relative max-w-full max-h-full",children:[m.jsxs("div",{className:"absolute top-4 right-4 flex items-center space-x-2 z-10",children:[m.jsx("div",{className:"bg-white bg-opacity-90 text-gray-800 px-3 py-1 rounded border shadow-sm text-sm",children:"rabies"===v.type?"狂犬病ワクチン":"混合ワクチン"}),m.jsx(u,{size:"sm",onClick:T,className:"bg-white bg-opacity-90 shadow-lg text-gray-800 hover:bg-opacity-100 border border-gray-300",children:m.jsx(W,{className:"w-4 h-4"})}),m.jsx(u,{size:"sm",onClick:V,className:"bg-white bg-opacity-90 shadow-lg text-gray-800 hover:bg-opacity-100 border border-gray-300",children:m.jsx(I,{className:"w-4 h-4"})}),m.jsx(u,{size:"sm",onClick:q,className:"bg-white bg-opacity-90 shadow-lg text-gray-800 hover:bg-opacity-100 border border-gray-300",children:m.jsx(_,{className:"w-4 h-4"})})]}),m.jsx("div",{className:"overflow-auto max-h-screen",children:m.jsx("img",{src:v.src,alt:v.alt,className:"max-w-none transition-transform duration-200",style:{transform:`scale(${N})`,transformOrigin:"center center"},onError:e=>{e.currentTarget.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjNmNGY2Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzM3NDE1MSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPueUu+WDj+OBjOiqreOCgeWFpeOBv+OBvuOBm+OCk+OBp+OBl+OBnw==</dGV4dD48L3N2Zz4="}})}),m.jsxs("div",{className:"absolute bottom-4 left-4 bg-white bg-opacity-90 text-gray-800 px-3 py-2 rounded border shadow-sm text-sm",children:[m.jsx("p",{children:"拡大/縮小: ズームボタンを使用"}),m.jsx("p",{children:"閉じる: Xボタンまたは画像外をクリック"})]})]}),m.jsx("div",{className:"absolute inset-0 -z-10",onClick:q})]})]})},H=e=>d(void 0,null,function*(){var s,a,r;try{g("info","🔧 Checking admin user setup for:",{email:e});const{data:{user:t},error:i}=yield o.auth.getUser();if(i)return g("error","❌ Error getting current user:",i),{success:!1,error:i.message};if(!t)return g("error","❌ No user found"),{success:!1,error:"No user found"};g("info","👤 Current user:",{id:t.id,email:t.email,metadata:t.user_metadata});const l=!0===(null==(s=t.user_metadata)?void 0:s.admin);if(g("info","🔍 Admin status:",{isAdmin:l}),!l)return g("error","❌ User is not admin"),{success:!1,error:"User is not admin"};const{data:n,error:c}=yield o.from("profiles").select("*").eq("id",t.id).single();if(c){if(g("error","❌ Error getting profile:",c),"PGRST116"===c.code){g("info","📝 Creating admin profile...");const{data:e,error:s}=yield o.from("profiles").insert({id:t.id,name:(null==(a=t.user_metadata)?void 0:a.name)||(null==(r=t.email)?void 0:r.split("@")[0])||"Admin",user_type:"admin",email:t.email,postal_code:"",address:"",phone_number:"",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}).select().single();return s?(g("error","❌ Error creating admin profile:",s),{success:!1,error:s.message}):(g("info","✅ Admin profile created successfully:",e),{success:!0,profile:e,message:"Admin profile created successfully"})}return{success:!1,error:c.message}}if("admin"!==n.user_type){g("info","🔄 Updating user type to admin...");const{data:e,error:s}=yield o.from("profiles").update({user_type:"admin",updated_at:(new Date).toISOString()}).eq("id",t.id).select().single();return s?(g("error","❌ Error updating profile to admin:",s),{success:!1,error:s.message}):(g("info","✅ Profile updated to admin successfully:",e),{success:!0,profile:e,message:"Profile updated to admin successfully"})}return g("info","✅ Admin user already set up correctly:",n),{success:!0,profile:n,message:"Admin user already set up correctly"}}catch(t){return g("error","❌ Exception in checkAndSetAdminUser:",{error:p(t)}),{success:!1,error:p(t)}}});function q(){const{user:e,isAdmin:s,userProfile:a}=j(),r=f(),[t,i]=b.useState("vaccines"),[l,n]=b.useState(""),[c,h]=b.useState(""),y=N(t),_=e=>{h(e),n(""),setTimeout(()=>h(""),5e3)},I=e=>{n(e),h(""),setTimeout(()=>n(""),8e3)},C=()=>{n(""),h("")};b.useEffect(()=>{e&&!s&&(()=>{d(this,null,function*(){if("capasjapan@gmail.com"===(null==e?void 0:e.email)&&!s)try{(yield H(e.email)).success&&(_("管理者権限を設定しました。ページを再読み込みします..."),setTimeout(()=>window.location.reload(),1500))}catch(a){}})})()},[e,s]),b.useEffect(()=>{s?y.refetch():r("/")},[s,r,t]);const D=e=>d(this,null,function*(){_(e),yield y.refetch()}),O=e=>{I(e)};return m.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[m.jsx("div",{className:"flex items-center space-x-4 mb-6",children:m.jsxs(v,{to:"/admin",className:"flex items-center text-blue-600 hover:text-blue-800",children:[m.jsx(w,{className:"w-4 h-4 mr-2"}),"管理者ダッシュボードに戻る"]})}),m.jsx("div",{className:"flex justify-between items-center",children:m.jsxs("h1",{className:"text-2xl font-bold flex items-center",children:[m.jsx(S,{className:"w-8 h-8 text-red-600 mr-3"}),"管理者審査ページ"]})}),l&&m.jsxs("div",{className:"mb-6 p-4 bg-red-50 rounded-lg flex items-start",children:[m.jsx(P,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),m.jsx("p",{className:"text-red-800",children:l})]}),c&&m.jsxs("div",{className:"mb-6 p-4 bg-green-50 rounded-lg flex items-start",children:[m.jsx(k,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),m.jsx("p",{className:"text-green-800",children:c})]}),!s&&m.jsxs(x,{className:"p-4 bg-red-50 border-l-4 border-red-500",children:[m.jsx("h3",{className:"font-semibold mb-3 text-red-900",children:"❌ 管理者権限が必要です"}),m.jsxs("div",{className:"text-sm text-red-800 space-y-2",children:[m.jsx("p",{children:m.jsx("strong",{children:"ユーザー情報:"})}),m.jsxs("p",{children:["• Email: ",(null==e?void 0:e.email)||"なし"]}),m.jsxs("p",{children:["• User Type: ",(null==a?void 0:a.user_type)||"undefined"]}),m.jsxs("p",{children:["• Is Admin: ",s?"true":"false"]}),"capasjapan@gmail.com"===(null==e?void 0:e.email)&&m.jsxs("div",{className:"mt-4 space-x-2",children:[m.jsx(u,{size:"sm",onClick:()=>d(this,null,function*(){C();try{const s=yield H(e.email||"");s.success?(_("管理者権限を設定しました。ページを再読み込みします..."),setTimeout(()=>window.location.reload(),1500)):I(`管理者権限の設定に失敗: ${s.error}`)}catch(s){I(`エラーが発生しました: ${s.message}`)}}),className:"bg-blue-600 hover:bg-blue-700",children:"管理者権限を設定"}),m.jsx(u,{size:"sm",onClick:()=>d(this,null,function*(){var s,a;if(C(),null==e?void 0:e.id)try{const r=yield(s=e.id,d(void 0,null,function*(){try{g("info","🔧 Direct update user type:",{userId:s,userType:a});const{data:e,error:r}=yield o.from("profiles").update({user_type:a}).eq("id",s).select().single();return r?(g("error","❌ Direct update failed:",r),{success:!1,error:r.message}):(g("info","✅ Direct update successful:",e),{success:!0,data:e,message:"User type updated successfully"})}catch(l){return g("error","❌ Exception in directUpdateUserType:",{error:p(l)}),{success:!1,error:p(l)}}}));r.success?(_("プロファイルを更新しました。ページを再読み込みします..."),setTimeout(()=>window.location.reload(),1500)):I(`プロファイル更新に失敗: ${r.error}`)}catch(r){I(`エラーが発生しました: ${r.message}`)}else I("ユーザーIDが見つかりません")}),className:"bg-orange-600 hover:bg-orange-700",children:"直接更新"})]})]})]}),s&&m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"flex space-x-4 border-b",children:[m.jsxs("button",{className:"px-4 py-2 font-medium "+("parks"===t?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>i("parks"),children:[m.jsx(B,{className:"w-4 h-4 inline mr-2"}),"ドッグラン審査"]}),m.jsxs("button",{className:"px-4 py-2 font-medium "+("vaccines"===t?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>i("vaccines"),children:[m.jsx(M,{className:"w-4 h-4 inline mr-2"}),"ワクチン証明書審査"]})]}),m.jsxs("div",{className:"mt-6",children:["parks"===t&&m.jsx(G,{pendingParks:y.pendingParks,isLoading:y.isLoading,onApprovalComplete:D,onError:O}),"vaccines"===t&&m.jsx(E,{pendingVaccines:y.pendingVaccines,isLoading:y.isLoading,onApprovalComplete:D,onError:O})]})]})]})}export{q as AdminManagement};

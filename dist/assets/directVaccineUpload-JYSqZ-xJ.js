import{s as e}from"./index-CG6tuKmC.js";import"./vendor-BHVjIt_u.js";import"./supabase-CKbzEL5D.js";import"./ui-BlUB7fmN.js";const r=async(r,t,a="vaccine-certs")=>{try{if(!(t&&t instanceof File))throw new Error("無効なファイルです");let s=t.type;if(!s||"application/octet-stream"===s){const e=t.name.split(".").pop()?.toLowerCase();switch(e){case"jpg":case"jpeg":s="image/jpeg";break;case"png":s="image/png";break;case"gif":s="image/gif";break;case"webp":s="image/webp";break;default:throw new Error(`サポートされていないファイル形式: ${e}`)}}if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(s))throw new Error(`サポートされていないMIMEタイプ: ${s}`);const{data:{session:o},error:i}=await e.auth.getSession();if(i)throw new Error("認証エラーが発生しました");if(!o?.access_token)throw new Error("認証されていません。ログインしてください。");const n=o.access_token,c=`${""}/storage/v1/object/${a}/${r}`,p=await fetch(c,{method:"PUT",headers:{Authorization:`Bearer ${n}`,"Content-Type":s,"Cache-Control":"3600","x-upsert":"true"},body:t});if(!p.ok){await p.text();throw 520===p.status?new Error("一時的なサーバーエラーが発生しました。しばらく待ってから再度お試しください。"):p.status>=500?new Error(`サーバーエラーが発生しました (${p.status})。しばらく待ってから再度お試しください。`):new Error(`アップロードに失敗しました: ${p.status} ${p.statusText}`)}await p.json();const{data:{publicUrl:g}}=e.storage.from(a).getPublicUrl(r);return{success:!0,url:g}}catch(s){return{success:!1,error:s.message}}};export{r as directVaccineUpload};

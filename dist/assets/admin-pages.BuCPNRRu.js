import{j as e,E as s,a,G as t,P as r,b as i,T as n,H as l,S as c,C as d,c as o,d as m,e as x,A as h,U as u,M as g,f as p,D as j,B as f,g as b,h as v,i as N,k as y,l as _,m as w,n as k,F as S,o as C,p as P,q as I,r as $,s as E,X as T,t as A,u as L,v as z,Z as q,w as D,x as M,y as R}from"./ui-vendor.5lywbznV.js";import{r as O,u as U,L as F}from"./react-vendor.C7ykWfwV.js";import{c as V}from"./supabase-vendor.CX-WoPCS.js";const J=V("https://onmcivwxtzqajcovptgf.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9ubWNpdnd4dHpxYWpjb3ZwdGdmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkxODk3OTUsImV4cCI6MjA2NDc2NTc5NX0.AqFCz3GQUVeGaG2988LCzsE4aJpeio3xScoxv5T0-OU",{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce",storage:"undefined"!=typeof window?window.localStorage:void 0,storageKey:"sb-dogpark-auth-token",debug:!1},realtime:{params:{eventsPerSecond:5}},db:{schema:"public"},global:{headers:{"X-Client-Info":"dogpark-jp-web-netlify","X-Environment":"production"}}}),W=e=>{if(!e)return null;if(e.startsWith("http"))return e;const{data:s}=J.storage.from("vaccine-certificates").getPublicUrl(e);return(null==s?void 0:s.publicUrl)||null},B=e=>{if(!e)return"不明なエラーが発生しました";if("string"==typeof e)return e;if(e&&"object"==typeof e&&"message"in e){const s=e;if("PGRST116"===s.code)return"データが見つかりません。Netlify の環境変数設定を確認してください。";if("PGRST301"===s.code)return"データベース接続エラー。Netlify Supabase Extension の設定を確認してください。";switch(s.message){case"Invalid API key":return"API キーが無効です。Netlify の環境変数 VITE_SUPABASE_ANON_KEY を確認してください。";case"Invalid URL":return"データベース URL が無効です。Netlify の環境変数 VITE_SUPABASE_URL を確認してください。";case"Network error":return"ネットワークエラーが発生しました。インターネット接続を確認してください。";case"Authentication required":return"認証が必要です。ログインしてください。";default:return s.message||"不明なエラーが発生しました"}}return"不明なエラーが発生しました"},G=O.createContext({user:null,session:null,loading:!0,logout:async()=>{await Promise.resolve()},isAuthenticated:!1,signInWithMagicLink:async()=>(await Promise.resolve(),{success:!1}),signInWithPassword:async()=>(await Promise.resolve(),{success:!1}),verify2FA:async()=>(await Promise.resolve(),{success:!1}),setIsTrustedDevice:()=>{},isAdmin:!1,userProfile:null}),X=({children:s})=>{const[a,t]=O.useState(null),[r,i]=O.useState(null),[n,l]=O.useState(!0),[c,d]=O.useState(!1),[o,m]=O.useState(!1),[x,h]=O.useState(null),u=async(e,s)=>{try{const{data:a,error:t}=await J.from("profiles").select("*").eq("id",e).single();if(t){if("PGRST116"===t.code&&s){const a={id:e,name:s.split("@")[0],user_type:"capasjapan@gmail.com"===s?"admin":"user",created_at:(new Date).toISOString()},{data:t,error:r}=await J.from("profiles").insert([a]).select().single();return r?null:t}return null}return a}catch(a){return null}},g=(e,s)=>{if(!e)return!1;const a="capasjapan@gmail.com"===e.email,t="admin"===(null==s?void 0:s.user_type);return a||t};O.useEffect(()=>{let e=!0;(async()=>{try{const{data:{session:s},error:a}=await J.auth.getSession();if(a)return void(e&&(i(null),t(null),d(!1),h(null),m(!1),l(!1)));s&&s.user&&e?(i(s),t(s.user),d(!0),u(s.user.id,s.user.email).then(a=>{e&&(h(a),m(g(s.user,a)))})):e&&(i(null),t(null),d(!1),h(null),m(!1))}catch(s){e&&(i(null),t(null),d(!1),h(null),m(!1))}finally{e&&l(!1)}})();const{data:{subscription:s}}=J.auth.onAuthStateChange(async(s,a)=>{e&&("SIGNED_IN"===s&&a?(i(a),t(a.user),d(!0),u(a.user.id,a.user.email).then(s=>{e&&(h(s),m(g(a.user,s)))})):"SIGNED_OUT"===s?e&&(i(null),t(null),d(!1),h(null),m(!1)):"TOKEN_REFRESHED"===s&&a&&e&&(i(a),t(a.user)))});return()=>{e=!1,s.unsubscribe()}},[]);const p=O.useCallback(async e=>{try{const{error:s}=await J.auth.signInWithOtp({email:e,options:{emailRedirectTo:`${window.location.origin}/dashboard`}});return s?{success:!1,error:s.message}:{success:!0}}catch(s){return{success:!1,error:String(s)}}},[]),j=O.useCallback(async(e,s)=>{try{const{data:a,error:t}=await J.auth.signInWithPassword({email:e,password:s});return t?{success:!1,error:t.message}:{success:!0}}catch(a){return{success:!1,error:String(a)}}},[]),f=O.useCallback(async e=>{try{if(!a)return{success:!1,error:"ユーザーが認証されていません"};const{data:{session:s}}=await J.auth.getSession();if(!(null==s?void 0:s.access_token))return{success:!1,error:"認証が必要です"};const t=await fetch("https://onmcivwxtzqajcovptgf.supabase.co/functions/v1/verify-2fa",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.access_token}`},body:JSON.stringify({userId:a.id,code:e})});if(!t.ok){return{success:!1,error:(await t.json()).error||"認証に失敗しました"}}const r=await t.json();return{success:r.success,...r.error&&{error:r.error}}}catch(s){return{success:!1,error:String(s)}}},[a]),b=O.useCallback(e=>{try{localStorage.setItem("isTrustedDevice",JSON.stringify(e))}catch(s){}},[]),v=O.useCallback(async()=>{try{await J.auth.signOut(),i(null),t(null),d(!1),h(null),m(!1);try{localStorage.removeItem("isTrustedDevice"),localStorage.removeItem("pre_payment_auth_state")}catch(e){}}catch(e){}},[]),N={user:a,session:r,loading:n,logout:v,isAuthenticated:c,signInWithMagicLink:p,signInWithPassword:j,verify2FA:f,setIsTrustedDevice:b,isAdmin:o,userProfile:x};return e.jsx(G.Provider,{value:N,children:s})},Y=()=>{const e=O.useContext(G);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e},K=e=>{if(!e)return"不明なエラーが発生しました";if("string"==typeof e)return e;if(e&&"object"==typeof e&&"message"in e){const s=e;if("PGRST116"===s.code)return"データが見つかりません。Netlify の環境変数設定を確認してください。";if("PGRST301"===s.code)return"データベース接続エラー。Netlify Supabase Extension の設定を確認してください。";switch(s.message){case"Invalid API key":return"API キーが無効です。Netlify の環境変数 VITE_SUPABASE_ANON_KEY を確認してください。";case"Invalid URL":return"データベース URL が無効です。Netlify の環境変数 VITE_SUPABASE_URL を確認してください。";case"Network error":return"ネットワークエラーが発生しました。インターネット接続を確認してください。";case"Authentication required":return"認証が必要です。ログインしてください。";default:return s.message||"不明なエラーが発生しました"}}return"不明なエラーが発生しました"},Z=async(e,s={})=>{const{retries:a=0,timeout:t=5e3}=s;for(let i=0;i<=a;i++)try{const s=new AbortController,a=setTimeout(()=>s.abort(),t),r=await e();return clearTimeout(a),{...r,isOffline:!1}}catch(r){if(i===a){const e=r instanceof Error&&(r.message.includes("Network")||r.message.includes("fetch")||r.message.includes("AbortError"));return{data:null,error:r,isOffline:e}}await new Promise(e=>setTimeout(e,1e3*Math.pow(2,i)))}return{data:null,error:new Error("Max retries exceeded"),isOffline:!1}},H=async e=>{const s=await Promise.allSettled(Object.entries(e).map(async([e,s])=>({key:e,result:await s()}))),a={};return s.forEach((s,t)=>{if("fulfilled"===s.status){const{key:e,result:t}=s.value;a[e]=t.data||null}else a[Object.keys(e)[t]]=null}),a},Q=(e,s,a)=>{(new Date).toISOString()};let ee=null,se=null;const ae=()=>ee?Promise.resolve({ip:ee}):se||(se=(async()=>{try{try{const e=await fetch("https://api.ipify.org?format=json"),s=await e.json();if(s.ip)return{ip:s.ip}}catch(e){}try{const e=await fetch("https://ipapi.co/ip/"),s=await e.text();if(s&&s.trim())return{ip:s.trim()}}catch(e){}try{const e=await fetch("https://httpbin.org/ip"),s=await e.json();if(s.origin)return{ip:s.origin}}catch(e){}return"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?{ip:"127.0.0.1"}:{ip:"127.0.0.1",error:"Unable to detect IP address"}}catch(e){return{ip:"127.0.0.1",error:"Error detecting IP address"}}})().then(e=>(e.error||(ee=e.ip),se=null,e)),se),te=O.createContext({isMaintenanceActive:!1,maintenanceInfo:null,loading:!0,error:null,clientIP:null,isIPWhitelisted:!1,refreshMaintenanceStatus:async()=>{}}),re=({children:s})=>{const[a,t]=O.useState(!1),[r,i]=O.useState(null),[n,l]=O.useState(!0),[c,d]=O.useState(null),[o,m]=O.useState(null),[x,h]=O.useState(!1),u=O.useCallback(async()=>{try{l(!0),d(null);const e=await ae();m(e.ip);const{data:s,error:a}=await J.rpc("should_show_maintenance",{client_ip:e.ip});if(a)return i(null),t(!1),h(!0),void d(null);if(s&&s.length>0){const e=s[0];t(e.is_maintenance_active),h(e.is_ip_allowed),e.is_maintenance_active&&e.maintenance_info?i(e.maintenance_info):i(null)}else i(null),t(!1),h(!0)}catch(e){i(null),t(!1),h(!0),d(null)}finally{l(!1)}},[]),g=O.useCallback(async()=>{await u()},[u]);O.useEffect(()=>{let e=!0;const s=async()=>{e&&await u()},a=setTimeout(()=>{e&&n&&(l(!1),t(!1),h(!0),i(null),d(null))},3e4);s().catch(s=>{e&&(l(!1),t(!1),h(!0),i(null),d(null))});const r=setInterval(()=>{e&&s().catch(e=>{})},3e5);return()=>{e=!1,clearTimeout(a),clearInterval(r)}},[]);const p={isMaintenanceActive:a,maintenanceInfo:r,loading:n,error:c,clientIP:o,isIPWhitelisted:x,refreshMaintenanceStatus:g};return e.jsx(te.Provider,{value:p,children:s})},ie=()=>{const e=O.useContext(te);if(!e)throw new Error("useMaintenance must be used within a MaintenanceProvider");return e},ne=O.forwardRef(({children:s,variant:a="primary",size:t="md",isLoading:r=!1,fullWidth:i=!1,className:n="",leftIcon:l,rightIcon:c,loadingText:d,ariaLabel:o,ariaDescribedBy:m,tooltip:x,...h},u)=>{const g=O.useId(),p=["inline-flex items-center justify-center","rounded-lg font-medium","transition-all duration-200","disabled:opacity-50 disabled:cursor-not-allowed","focus:outline-none focus:ring-2 focus:ring-offset-2","active:scale-95","min-h-[44px] sm:min-h-[40px]","dark:focus:ring-offset-gray-800"].join(" "),j={primary:["bg-white text-blue-700 border-2 border-blue-700","hover:bg-blue-50 disabled:bg-gray-100","focus:ring-blue-600","dark:bg-white dark:text-blue-700 dark:border-blue-700 dark:hover:bg-blue-50"].join(" "),secondary:["bg-gray-100 text-gray-700 border border-gray-300","hover:bg-gray-200 disabled:bg-gray-50","focus:ring-gray-500","dark:bg-gray-100 dark:text-gray-700 dark:border-gray-300 dark:hover:bg-gray-200"].join(" "),danger:["bg-red-600 text-white","hover:bg-red-700 disabled:bg-red-400","focus:ring-red-500","dark:bg-red-600 dark:hover:bg-red-700"].join(" "),success:["bg-green-600 text-white","hover:bg-green-700 disabled:bg-green-400","focus:ring-green-500","dark:bg-green-600 dark:hover:bg-green-700"].join(" "),warning:["bg-yellow-500 text-white","hover:bg-yellow-600 disabled:bg-yellow-300","focus:ring-yellow-500","dark:bg-yellow-600 dark:hover:bg-yellow-700"].join(" ")},f=i?"w-full":"",b=n.split(" ").filter(e=>!(e.startsWith("bg-")||e.startsWith("text-")||e.startsWith("hover:bg-")||e.startsWith("focus:ring-"))).join(" "),v={"aria-label":o,"aria-describedby":m,"aria-busy":r,"aria-live":r?"polite":void 0,title:x},N=d||`${"string"==typeof s?s:"ボタン"}を処理中...`;return e.jsx("button",{ref:u,className:`${p} ${j[a]} ${{xs:"px-2 py-1 text-xs gap-1",sm:"px-3 py-1.5 text-sm gap-1.5",md:"px-4 py-2 text-base gap-2",lg:"px-6 py-3 text-lg gap-2.5"}[t]} ${f} ${b}`,disabled:r||h.disabled,...v,...h,children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin flex-shrink-0","aria-hidden":"true"}),e.jsx("span",{className:"truncate",children:d||s}),e.jsx("span",{className:"sr-only","aria-live":"polite",id:g,children:N})]}):e.jsxs(e.Fragment,{children:[l&&e.jsx("span",{className:"flex-shrink-0","aria-hidden":"true",children:l}),e.jsx("span",{className:"truncate",children:s}),c&&e.jsx("span",{className:"flex-shrink-0","aria-hidden":"true",children:c})]})})});ne.displayName="Button";const le=O.forwardRef(({children:s,className:a="",onClick:t,elevation:r="md",rounded:i="lg",border:n=!1,hoverEffect:l=!1,as:c="div",...d},o)=>{const m=n?"border border-gray-200":"",x=l?"hover:shadow-lg transition-shadow duration-300":"",h=t?"cursor-pointer":"";return e.jsx(c,{ref:o,className:`bg-white ${{none:"",sm:"shadow-sm",md:"shadow-md",lg:"shadow-lg"}[r]} ${{none:"rounded-none",sm:"rounded-sm",md:"rounded-md",lg:"rounded-lg",full:"rounded-full"}[i]} ${m} ${x} ${h} ${a}`,onClick:t,...d,children:s})});le.displayName="Card";const ce=O.forwardRef(({label:t,error:r,icon:i,helperText:n,showPasswordToggle:l=!1,type:c="text",...d},o)=>{const[m,x]=O.useState(!1),h=l&&"password"===c?m?"text":"password":c;return e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[t,d.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsxs("div",{className:"relative "+(i?"flex items-center":""),children:[i&&e.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:i}),e.jsx("input",{ref:o,type:h,className:`w-full px-3 py-2 ${i?"pl-10":""} border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${r?"border-red-500":"border-gray-300"} ${d.disabled?"bg-gray-100 cursor-not-allowed":""}`,"aria-invalid":r?"true":"false","aria-describedby":r?`${d.id||d.name}-error`:void 0,...d}),l&&"password"===c&&e.jsx("button",{type:"button",className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700",onClick:()=>x(!m),"aria-label":m?"パスワードを隠す":"パスワードを表示",children:m?e.jsx(s,{size:18}):e.jsx(a,{size:18})})]}),r&&e.jsx("p",{className:"mt-1 text-sm text-red-500",id:`${d.id||d.name}-error`,role:"alert",children:r}),n&&!r&&e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:n})]})});ce.displayName="Input";const de=O.forwardRef(({label:s,options:a,error:t,helperText:r,icon:i,...n},l)=>e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[s,n.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsxs("div",{className:"relative "+(i?"flex items-center":""),children:[i&&e.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:i}),e.jsxs("select",{ref:l,className:`w-full px-3 py-2 ${i?"pl-10":""} border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${t?"border-red-500":"border-gray-300"} ${n.disabled?"bg-gray-100 cursor-not-allowed":""} appearance-none`,"aria-invalid":t?"true":"false","aria-describedby":t?`${n.id||n.name}-error`:void 0,...n,children:[!n.required&&e.jsx("option",{value:"",children:"選択してください"}),a.map((s,a)=>e.jsx("option",{value:s.value,children:s.label},`${s.value}-${a}`))]}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),t&&e.jsx("p",{className:"mt-1 text-sm text-red-500",id:`${n.id||n.name}-error`,role:"alert",children:t}),r&&!t&&e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:r})]}));de.displayName="Select";const oe=({onError:d,onSuccess:o})=>{const{clientIP:m}=ie(),[x,h]=O.useState([]),[u,g]=O.useState(!0),[p,j]=O.useState(!1),[f,b]=O.useState(null),[v,N]=O.useState({ip_address:"",description:"",is_active:!0});O.useEffect(()=>{y()},[]);const y=async()=>{try{g(!0);const{data:e,error:s}=await J.from("ip_whitelist").select("*").order("created_at",{ascending:!1});if(s)return void d(`IPホワイトリストの取得に失敗しました: ${s.message}`);h(e||[])}catch(e){d("IPホワイトリストの取得中にエラーが発生しました")}finally{g(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(le,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(t,{className:"w-5 h-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"現在のIPアドレス"}),e.jsx("p",{className:"text-sm text-gray-600",children:m||"取得中..."})]})]}),e.jsxs(ne,{variant:"secondary",size:"sm",onClick:()=>{m&&(N({ip_address:`${m}/32`,description:"現在のIPアドレス",is_active:!0}),j(!0))},disabled:!m,children:[e.jsx(r,{className:"w-4 h-4 mr-1"}),"ホワイトリストに追加"]})]})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"IPホワイトリスト管理"}),e.jsxs(ne,{onClick:()=>j(!0),className:"flex items-center space-x-2",children:[e.jsx(r,{className:"w-4 h-4"}),e.jsx("span",{children:"新規作成"})]})]}),p&&e.jsxs(le,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:f?"IPホワイトリスト編集":"IPホワイトリスト作成"}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),v.ip_address&&v.description)try{const e={ip_address:v.ip_address,description:v.description,is_active:v.is_active};if(f){const{error:s}=await J.from("ip_whitelist").update(e).eq("id",f.id);if(s)return void d(`IPホワイトリストの更新に失敗しました: ${s.message}`);o("IPホワイトリストを更新しました")}else{const{error:s}=await J.from("ip_whitelist").insert([e]);if(s)return void d(`IPホワイトリストの作成に失敗しました: ${s.message}`);o("IPホワイトリストを作成しました")}N({ip_address:"",description:"",is_active:!0}),j(!1),b(null),await y()}catch(s){d("IPホワイトリストの保存中にエラーが発生しました")}else d("IPアドレスと説明は必須です")},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["IPアドレス/CIDR ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(ce,{type:"text",value:v.ip_address,onChange:e=>N({...v,ip_address:e.target.value}),placeholder:"例: 192.168.1.0/24 または 192.168.1.100/32",label:"IPアドレス/CIDR",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"CIDR形式で入力してください。単一IPの場合は /32 を付けてください。"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["説明 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(ce,{type:"text",value:v.description,onChange:e=>N({...v,description:e.target.value}),placeholder:"例: 本社オフィス",label:"説明",required:!0})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:v.is_active,onChange:e=>N({...v,is_active:e.target.checked}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"is_active",className:"text-sm font-medium",children:"有効"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(ne,{type:"button",variant:"secondary",onClick:()=>{j(!1),b(null),N({ip_address:"",description:"",is_active:!0})},children:"キャンセル"}),e.jsx(ne,{type:"submit",children:f?"更新":"作成"})]})]})]}),e.jsxs(le,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"IPホワイトリスト一覧"}),u?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"text-gray-600",children:"読み込み中..."})}):0===x.length?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"IPホワイトリストエントリがありません"}):e.jsx("div",{className:"space-y-4",children:x.map(r=>{return e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[(x=r.ip_address,x.includes("127.0.0.1")||x.includes("::1")?e.jsx(l,{className:"w-4 h-4 text-blue-500"}):x.includes("192.168.")||x.includes("10.")||x.includes("172.")?e.jsx(c,{className:"w-4 h-4 text-green-500"}):e.jsx(t,{className:"w-4 h-4 text-orange-500"})),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{className:"font-medium",children:r.ip_address}),r.is_active&&e.jsx("span",{className:"bg-green-100 text-green-800 text-xs px-2 py-1 rounded",children:"有効"}),!r.is_active&&e.jsx("span",{className:"bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded",children:"無効"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:r.description}),e.jsxs("p",{className:"text-xs text-gray-500",children:["作成: ",(m=r.created_at,new Date(m).toLocaleString("ja-JP",{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"}))]})]})]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ne,{variant:r.is_active?"warning":"success",size:"sm",onClick:()=>(async e=>{try{const{error:s}=await J.from("ip_whitelist").update({is_active:!e.is_active}).eq("id",e.id);if(s)return void d(`IPホワイトリストの状態変更に失敗しました: ${s.message}`);o(`IPホワイトリストを${e.is_active?"無効":"有効"}にしました`),await y()}catch(s){d("IPホワイトリストの状態変更中にエラーが発生しました")}})(r),children:r.is_active?e.jsxs(e.Fragment,{children:[e.jsx(s,{className:"w-4 h-4 mr-1"}),"無効化"]}):e.jsxs(e.Fragment,{children:[e.jsx(a,{className:"w-4 h-4 mr-1"}),"有効化"]})}),e.jsx(ne,{variant:"secondary",size:"sm",onClick:()=>(e=>{b(e),N({ip_address:e.ip_address,description:e.description,is_active:e.is_active}),j(!0)})(r),children:e.jsx(i,{className:"w-4 h-4"})}),e.jsx(ne,{variant:"danger",size:"sm",onClick:()=>(async e=>{if(confirm("このIPホワイトリストエントリを削除しますか？"))try{const{error:s}=await J.from("ip_whitelist").delete().eq("id",e);if(s)return void d(`IPホワイトリストの削除に失敗しました: ${s.message}`);o("IPホワイトリストを削除しました"),await y()}catch(s){d("IPホワイトリストの削除中にエラーが発生しました")}})(r.id),children:e.jsx(n,{className:"w-4 h-4"})})]})]})},r.id);var m,x})})]})]})},me=e=>{if(!e)return null;return new Date(e).toISOString()},xe=e=>{if(!e)return"";const s=new Date(e);return new Date(s.getTime()-6e4*s.getTimezoneOffset()).toISOString().slice(0,16)},he=({onError:s,onSuccess:a})=>{const{refreshMaintenanceStatus:t,isMaintenanceActive:l,maintenanceInfo:h}=ie(),[u,g]=O.useState([]),[p,j]=O.useState(!0),[f,b]=O.useState(!1),[v,N]=O.useState(null),[y,_]=O.useState("schedules"),[w,k]=O.useState({title:"",message:"",start_time:"",end_time:"",is_emergency:!1});O.useEffect(()=>{S()},[]);const S=async()=>{try{j(!0);const{data:e,error:a}=await J.from("maintenance_schedules").select("*").order("created_at",{ascending:!1});if(a)return void s(`メンテナンス予定の取得に失敗しました: ${a.message}`);g(e||[])}catch(e){s("メンテナンス予定の取得中にエラーが発生しました")}finally{j(!1)}},C=e=>e?new Date(e).toLocaleString("ja-JP",{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit",timeZone:"Asia/Tokyo"}):"未設定";return e.jsxs("div",{className:"space-y-6",children:[e.jsx(le,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-4 h-4 rounded-full "+(l?"bg-red-500":"bg-green-500")}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:l?"メンテナンス中":"サービス稼働中"}),l&&h&&e.jsx("p",{className:"text-sm text-gray-600",children:h.title})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:l?e.jsx(d,{className:"w-5 h-5 text-red-500"}):e.jsx(d,{className:"w-5 h-5 text-green-500"})})]})}),e.jsxs("div",{className:"flex space-x-4 border-b",children:[e.jsxs("button",{className:"px-4 py-2 font-medium "+("schedules"===y?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>_("schedules"),children:[e.jsx(o,{className:"w-4 h-4 inline mr-2"}),"メンテナンス予定"]}),e.jsxs("button",{className:"px-4 py-2 font-medium "+("whitelist"===y?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>_("whitelist"),children:[e.jsx(c,{className:"w-4 h-4 inline mr-2"}),"IPホワイトリスト"]})]}),"schedules"===y?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"メンテナンス予定管理"}),e.jsxs(ne,{onClick:()=>b(!0),className:"flex items-center space-x-2",children:[e.jsx(r,{className:"w-4 h-4"}),e.jsx("span",{children:"新規作成"})]})]}),f&&e.jsxs(le,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:v?"メンテナンス予定編集":"メンテナンス予定作成"}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),w.title&&w.message)try{const e={title:w.title,message:w.message,start_time:me(w.start_time),end_time:me(w.end_time),is_emergency:w.is_emergency};if(v){const{error:t}=await J.from("maintenance_schedules").update(e).eq("id",v.id);if(t)return void s(`メンテナンス予定の更新に失敗しました: ${t.message}`);a("メンテナンス予定を更新しました")}else{const{error:t}=await J.from("maintenance_schedules").insert([e]);if(t)return void s(`メンテナンス予定の作成に失敗しました: ${t.message}`);a("メンテナンス予定を作成しました")}k({title:"",message:"",start_time:"",end_time:"",is_emergency:!1}),b(!1),N(null),await S()}catch(t){s("メンテナンス予定の保存中にエラーが発生しました")}else s("タイトルとメッセージは必須です")},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["タイトル ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(ce,{type:"text",value:w.title,onChange:e=>k({...w,title:e.target.value}),placeholder:"例: システムメンテナンス",label:"タイトル",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["メッセージ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:w.message,onChange:e=>k({...w,message:e.target.value}),placeholder:"メンテナンス中に表示されるメッセージ",className:"w-full p-2 border border-gray-300 rounded-lg",rows:3,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"開始時刻（日本時間）"}),e.jsx(ce,{type:"datetime-local",value:w.start_time,onChange:e=>k({...w,start_time:e.target.value}),label:"開始時刻"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"日本時間で入力してください"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"終了時刻（日本時間）"}),e.jsx(ce,{type:"datetime-local",value:w.end_time,onChange:e=>k({...w,end_time:e.target.value}),label:"終了時刻"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"日本時間で入力してください"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"is_emergency",checked:w.is_emergency,onChange:e=>k({...w,is_emergency:e.target.checked}),className:"w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500"}),e.jsx("label",{htmlFor:"is_emergency",className:"text-sm font-medium",children:"緊急メンテナンス"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(ne,{type:"button",variant:"secondary",onClick:()=>{b(!1),N(null),k({title:"",message:"",start_time:"",end_time:"",is_emergency:!1})},children:"キャンセル"}),e.jsx(ne,{type:"submit",children:v?"更新":"作成"})]})]})]}),e.jsxs(le,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"メンテナンス予定一覧"}),p?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"text-gray-600",children:"読み込み中..."})}):0===u.length?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"メンテナンス予定がありません"}):e.jsx("div",{className:"space-y-4",children:u.map(r=>e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{className:"font-medium",children:r.title}),r.is_active&&e.jsx("span",{className:"bg-red-100 text-red-800 text-xs px-2 py-1 rounded",children:"有効"}),r.is_emergency&&e.jsx("span",{className:"bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded",children:"緊急"})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:r.message}),e.jsxs("div",{className:"text-sm text-gray-500 mt-2",children:[e.jsxs("div",{children:["開始: ",C(r.start_time)]}),e.jsxs("div",{children:["終了: ",C(r.end_time)]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ne,{variant:r.is_active?"danger":"success",size:"sm",onClick:()=>(async e=>{try{const{error:r}=await J.from("maintenance_schedules").update({is_active:!e.is_active}).eq("id",e.id);if(r)return void s(`メンテナンス状態の変更に失敗しました: ${r.message}`);a(`メンテナンスを${e.is_active?"無効":"有効"}にしました`),await S(),await t()}catch(r){s("メンテナンス状態の変更中にエラーが発生しました")}})(r),children:r.is_active?e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"w-4 h-4 mr-1"}),"無効化"]}):e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"w-4 h-4 mr-1"}),"有効化"]})}),e.jsx(ne,{variant:"secondary",size:"sm",onClick:()=>(e=>{N(e),k({title:e.title,message:e.message,start_time:xe(e.start_time||""),end_time:xe(e.end_time||""),is_emergency:e.is_emergency}),b(!0)})(r),children:e.jsx(i,{className:"w-4 h-4"})}),e.jsx(ne,{variant:"danger",size:"sm",onClick:()=>(async e=>{if(confirm("このメンテナンス予定を削除しますか？"))try{const{error:r}=await J.from("maintenance_schedules").delete().eq("id",e);if(r)return void s(`メンテナンス予定の削除に失敗しました: ${r.message}`);a("メンテナンス予定を削除しました"),await S(),await t()}catch(r){s("メンテナンス予定の削除中にエラーが発生しました")}})(r.id),children:e.jsx(n,{className:"w-4 h-4"})})]})]})},r.id))})]})]}):e.jsx(oe,{onError:s,onSuccess:a})]})};const ue=Object.freeze(Object.defineProperty({__proto__:null,AdminDashboard:function(){const{user:s,isAdmin:a}=Y(),t=U(),[r,i]=O.useState("overview"),[n,l]=O.useState({totalUsers:0,totalParks:0,pendingParks:0,pendingVaccines:0,pendingFacilities:0,totalReservations:0,monthlyRevenue:0,lastMonthRevenue:0,totalSubscriptions:0,activeSubscriptions:0,newUsersThisMonth:0,unreadMessages:0}),[m,x]=O.useState(!0),[k,S]=O.useState(""),[C,P]=O.useState("");O.useEffect(()=>{a?I():t("/")},[a,t]);const I=async()=>{try{x(!0),S(""),P("");const{data:e,error:s}=await J.rpc("get_admin_stats");if(s)throw s;const a=e,{data:t,error:r}=await J.from("pet_facilities").select("id",{count:"exact"}).eq("status","pending"),i=(null==t?void 0:t.length)||0,{data:n,error:c}=await J.from("dog_parks").select("id",{count:"exact"}).in("status",["pending","first_stage_passed","second_stage_waiting","second_stage_review","smart_lock_testing"]),d=(null==n?void 0:n.length)||0;l({totalUsers:(null==a?void 0:a.total_users)||0,totalParks:(null==a?void 0:a.total_parks)||0,pendingParks:d,pendingVaccines:(null==a?void 0:a.pending_vaccines)||0,pendingFacilities:i,totalReservations:(null==a?void 0:a.total_reservations)||0,monthlyRevenue:(null==a?void 0:a.monthly_revenue)||0,lastMonthRevenue:(null==a?void 0:a.last_month_revenue)||0,totalSubscriptions:(null==a?void 0:a.total_subscriptions)||0,activeSubscriptions:(null==a?void 0:a.active_subscriptions)||0,newUsersThisMonth:(null==a?void 0:a.new_users_this_month)||0,unreadMessages:(null==a?void 0:a.unread_messages)||0})}catch(e){S("統計データの取得に失敗しました。")}finally{x(!1)}};return m?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center",children:[e.jsx(c,{className:"w-8 h-8 text-red-600 mr-3"}),"管理者ダッシュボード"]}),e.jsx("p",{className:"text-gray-600",children:"システム全体の管理と監視"})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["最終更新: ",(new Date).toLocaleString("ja-JP")]})]}),k&&e.jsxs("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4 flex items-start",children:[e.jsx(h,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsx("p",{children:k})]}),C&&e.jsxs("div",{className:"bg-green-100 border border-green-300 text-green-800 rounded-lg p-4 flex items-start",children:[e.jsx(d,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsx("p",{children:C})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(F,{to:"/admin/users",children:e.jsx(le,{className:"p-6 hover:shadow-lg transition-all duration-200 cursor-pointer hover:scale-105",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"総ユーザー数"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:n.totalUsers}),e.jsxs("p",{className:"text-xs text-green-600",children:["+",n.newUsersThisMonth," 今月"]})]}),e.jsx(u,{className:"w-8 h-8 text-blue-600"})]})})}),e.jsx(F,{to:"/admin/parks",children:e.jsx(le,{className:"p-6 hover:shadow-lg transition-all duration-200 cursor-pointer hover:scale-105",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"総ドッグラン数"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:n.totalParks}),n.pendingParks>0&&e.jsxs("p",{className:"text-xs text-orange-600",children:["承認待ち: ",n.pendingParks]})]}),e.jsx(g,{className:"w-8 h-8 text-green-600"})]})})}),e.jsx(F,{to:"/admin/reservations",children:e.jsx(le,{className:"p-6 hover:shadow-lg transition-all duration-200 cursor-pointer hover:scale-105",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"今月の予約数"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:n.totalReservations}),e.jsxs("p",{className:"text-xs text-purple-600",children:["サブスク会員: ",n.activeSubscriptions]})]}),e.jsx(p,{className:"w-8 h-8 text-purple-600"})]})})}),e.jsx(F,{to:"/admin/sales",children:e.jsx(le,{className:"p-6 hover:shadow-lg transition-all duration-200 cursor-pointer hover:scale-105",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"今月の売上"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-600",children:["¥",n.monthlyRevenue.toLocaleString()]}),n.lastMonthRevenue>0&&e.jsxs("p",{className:"text-xs text-gray-500",children:["前月比: ",Math.round(100*(n.monthlyRevenue/n.lastMonthRevenue-1)),"%"]})]}),e.jsx(j,{className:"w-8 h-8 text-orange-600"})]})})})]}),(n.pendingParks>0||n.pendingVaccines>0||n.pendingFacilities>0)&&e.jsxs(le,{className:"p-6 bg-red-50 border-red-200",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx(h,{className:"w-6 h-6 text-red-600"}),e.jsx("h2",{className:"text-lg font-semibold text-red-900",children:"緊急対応が必要"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[n.pendingParks>0&&e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-red-200",children:[e.jsx("p",{className:"font-medium text-red-900",children:"ドッグラン承認待ち"}),e.jsxs("p",{className:"text-2xl font-bold text-red-600",children:[n.pendingParks,"件"]}),e.jsx(F,{to:"/admin/parks",children:e.jsx(ne,{size:"sm",className:"mt-2",children:"確認する"})})]}),n.pendingVaccines>0&&e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-red-200",children:[e.jsx("p",{className:"font-medium text-red-900",children:"ワクチン証明書承認待ち"}),e.jsxs("p",{className:"text-2xl font-bold text-red-600",children:[n.pendingVaccines,"件"]}),e.jsx(F,{to:"/admin/vaccine-approval",children:e.jsx(ne,{size:"sm",className:"mt-2",children:"確認する"})})]}),n.pendingFacilities>0&&e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-red-200",children:[e.jsx("p",{className:"font-medium text-red-900",children:"ペット関連施設承認待ち"}),e.jsxs("p",{className:"text-2xl font-bold text-red-600",children:[n.pendingFacilities,"件"]}),e.jsx(F,{to:"/admin/facility-approval",children:e.jsx(ne,{size:"sm",className:"mt-2",children:"確認する"})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx(F,{to:"/admin/vaccine-approval",children:e.jsx(le,{className:"p-6 hover:shadow-lg transition-shadow cursor-pointer",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-blue-100 p-3 rounded-full",children:e.jsx(f,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold",children:"ワクチン証明書管理"}),e.jsx("p",{className:"text-sm text-gray-600",children:"ワクチン証明書の承認・管理"}),n.pendingVaccines>0&&e.jsxs("div",{className:"mt-2 inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[e.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full mr-1"}),n.pendingVaccines,"件の承認待ち"]})]})]})})}),e.jsx(F,{to:"/admin/parks",children:e.jsx(le,{className:"p-6 hover:shadow-lg transition-shadow cursor-pointer",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-green-100 p-3 rounded-full",children:e.jsx(g,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold",children:"ドッグラン管理"}),e.jsx("p",{className:"text-sm text-gray-600",children:"ドッグランの審査・管理"}),n.pendingParks>0&&e.jsxs("div",{className:"mt-2 inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[e.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full mr-1"}),n.pendingParks,"件の承認待ち"]})]})]})})}),e.jsx(F,{to:"/admin/facility-approval",children:e.jsx(le,{className:"p-6 hover:shadow-lg transition-shadow cursor-pointer",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-indigo-100 p-3 rounded-full",children:e.jsx(b,{className:"w-6 h-6 text-indigo-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold",children:"ペット関連施設承認"}),e.jsx("p",{className:"text-sm text-gray-600",children:"ペット関連施設の掲載申請承認・管理"}),n.pendingFacilities>0&&e.jsxs("div",{className:"mt-2 inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[e.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full mr-1"}),n.pendingFacilities,"件の承認待ち"]})]})]})})}),e.jsx(F,{to:"/admin/shop",children:e.jsx(le,{className:"p-6 hover:shadow-lg transition-shadow cursor-pointer",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-green-100 p-3 rounded-full",children:e.jsx(v,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"ショップ管理"}),e.jsx("p",{className:"text-sm text-gray-600",children:"商品管理・注文管理・在庫管理"})]})]})})}),e.jsx(F,{to:"/admin/revenue",children:e.jsx(le,{className:"p-6 hover:shadow-lg transition-shadow cursor-pointer",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-purple-100 p-3 rounded-full",children:e.jsx(N,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"売上レポート"}),e.jsx("p",{className:"text-sm text-gray-600",children:"ドッグラン別売上・振込管理"})]})]})})}),e.jsx(F,{to:"/admin/news",children:e.jsx(le,{className:"p-6 hover:shadow-lg transition-shadow cursor-pointer",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-yellow-100 p-3 rounded-full",children:e.jsx(y,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"新着情報管理"}),e.jsx("p",{className:"text-sm text-gray-600",children:"サイトの新着情報・お知らせを管理"})]})]})})}),e.jsx("div",{onClick:()=>i("maintenance"),children:e.jsx(le,{className:"p-6 hover:shadow-lg transition-shadow cursor-pointer",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-orange-100 p-3 rounded-full",children:e.jsx(o,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"メンテナンス管理"}),e.jsx("p",{className:"text-sm text-gray-600",children:"システムメンテナンス・IP管理"})]})]})})})]}),e.jsxs("div",{className:"flex space-x-4 border-b",children:[e.jsxs("button",{className:"px-4 py-2 font-medium relative flex items-center space-x-2 "+("overview"===r?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>i("overview"),children:[e.jsx(_,{className:"w-4 h-4"}),e.jsx("span",{children:"概要"})]}),e.jsxs("button",{className:"px-4 py-2 font-medium relative flex items-center space-x-2 "+("parks"===r?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>i("parks"),children:[e.jsx(g,{className:"w-4 h-4"}),e.jsx("span",{children:"ドッグラン管理"}),n.pendingParks>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:n.pendingParks})]}),e.jsxs("button",{className:"px-4 py-2 font-medium relative flex items-center space-x-2 "+("vaccines"===r?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>i("vaccines"),children:[e.jsx(f,{className:"w-4 h-4"}),e.jsx("span",{children:"ワクチン承認"}),n.pendingVaccines>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:n.pendingVaccines})]}),e.jsxs("button",{className:"px-4 py-2 font-medium relative flex items-center space-x-2 "+("facilities"===r?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>i("facilities"),children:[e.jsx(b,{className:"w-4 h-4"}),e.jsx("span",{children:"施設承認"}),n.pendingFacilities>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:n.pendingFacilities})]}),e.jsxs("button",{className:"px-4 py-2 font-medium relative flex items-center space-x-2 "+("users"===r?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>i("users"),children:[e.jsx(u,{className:"w-4 h-4"}),e.jsx("span",{children:"ユーザー管理"})]}),e.jsxs("button",{className:"px-4 py-2 font-medium relative flex items-center space-x-2 "+("maintenance"===r?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>i("maintenance"),children:[e.jsx(o,{className:"w-4 h-4"}),e.jsx("span",{children:"メンテナンス"})]})]}),"overview"===r&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(le,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"システム概要"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"プラットフォーム統計"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"アクティブユーザー:"}),e.jsxs("span",{className:"font-medium",children:[n.totalUsers,"人"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"承認済みドッグラン:"}),e.jsxs("span",{className:"font-medium",children:[n.totalParks-n.pendingParks,"施設"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"今月の予約:"}),e.jsxs("span",{className:"font-medium",children:[n.totalReservations,"件"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"今月の売上:"}),e.jsxs("span",{className:"font-medium",children:["¥",n.monthlyRevenue.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"アクティブサブスク:"}),e.jsxs("span",{className:"font-medium",children:[n.activeSubscriptions,"件"]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"承認待ち項目"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"ドッグラン:"}),e.jsxs("span",{className:"font-medium "+(n.pendingParks>0?"text-red-600":"text-green-600"),children:[n.pendingParks,"件"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"ワクチン証明書:"}),e.jsxs("span",{className:"font-medium "+(n.pendingVaccines>0?"text-red-600":"text-green-600"),children:[n.pendingVaccines,"件"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"ペット関連施設:"}),e.jsxs("span",{className:"font-medium "+(n.pendingFacilities>0?"text-red-600":"text-green-600"),children:[n.pendingFacilities,"件"]})]})]})]})]})]}),e.jsxs(le,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"売上推移"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(F,{to:"/admin/revenue",children:e.jsxs(ne,{size:"sm",variant:"secondary",children:[e.jsx(N,{className:"w-4 h-4 mr-1"}),"詳細レポート"]})}),e.jsxs(ne,{size:"sm",variant:"secondary",children:[e.jsx(w,{className:"w-4 h-4 mr-1"}),"CSV"]})]})]}),e.jsx("div",{className:"h-64 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"売上グラフ（実装予定）"})})]}),e.jsxs(le,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"新着情報管理"}),e.jsxs("p",{className:"text-gray-600",children:["サイトの新着情報・お知らせを管理するには",e.jsx(F,{to:"/admin/news",className:"text-blue-600 hover:text-blue-800 mx-1",children:"こちら"}),"からアクセスしてください。"]})]})]}),"parks"===r&&e.jsxs(le,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"ドッグラン管理"}),e.jsxs("p",{className:"text-gray-600",children:["詳細なドッグラン管理は",e.jsx(F,{to:"/admin/parks",className:"text-blue-600 hover:text-blue-800 mx-1",children:"ドッグラン管理ページ"}),"で行えます。"]}),n.pendingParks>0&&e.jsxs("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("p",{className:"text-red-700",children:[e.jsxs("strong",{children:[n.pendingParks,"件"]}),"のドッグラン承認待ちがあります。"]}),e.jsx(F,{to:"/admin/parks",children:e.jsx(ne,{size:"sm",className:"mt-2",children:"今すぐ確認する"})})]})]}),"vaccines"===r&&e.jsxs(le,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"ワクチン証明書管理"}),e.jsxs("p",{className:"text-gray-600",children:["詳細なワクチン証明書管理は",e.jsx(F,{to:"/admin/vaccine-approval",className:"text-blue-600 hover:text-blue-800 mx-1",children:"ワクチン証明書管理ページ"}),"で行えます。"]}),n.pendingVaccines>0&&e.jsxs("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("p",{className:"text-red-700",children:[e.jsxs("strong",{children:[n.pendingVaccines,"件"]}),"のワクチン証明書承認待ちがあります。"]}),e.jsx(F,{to:"/admin/vaccine-approval",children:e.jsx(ne,{size:"sm",className:"mt-2",children:"今すぐ確認する"})})]})]}),"facilities"===r&&e.jsxs(le,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"ペット関連施設承認管理"}),e.jsxs("p",{className:"text-gray-600",children:["詳細なペット関連施設の承認管理は",e.jsx(F,{to:"/admin/facility-approval",className:"text-blue-600 hover:text-blue-800 mx-1",children:"施設承認ページ"}),"で行えます。"]}),n.pendingFacilities>0&&e.jsxs("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("p",{className:"text-red-700",children:[e.jsxs("strong",{children:[n.pendingFacilities,"件"]}),"の施設承認待ちがあります。"]}),e.jsx(F,{to:"/admin/facility-approval",children:e.jsx(ne,{size:"sm",className:"mt-2",children:"今すぐ確認する"})})]})]}),"users"===r&&e.jsxs(le,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"ユーザー管理"}),e.jsxs("p",{className:"text-gray-600",children:["詳細なユーザー管理は",e.jsx(F,{to:"/admin/users",className:"text-blue-600 hover:text-blue-800 mx-1",children:"ユーザー管理ページ"}),"で行えます。"]})]}),"maintenance"===r&&e.jsx(he,{onError:S,onSuccess:P})]})}},Symbol.toStringTag,{value:"Module"})),ge=e=>{const[s,a]=O.useState([]),[t,r]=O.useState([]),[i,n]=O.useState(!0),[l,c]=O.useState(""),[d,o]=O.useState(""),m=async()=>{try{Q("info"),await(async()=>{try{const{error:e}=await J.storage.updateBucket("vaccine-certs",{public:!0});return!e}catch(l){return!1}})();const e=await Z(()=>J.from("vaccine_certifications").select("\n            id,\n            dog_id,\n            rabies_vaccine_image,\n            combo_vaccine_image,\n            rabies_expiry_date,\n            combo_expiry_date,\n            status,\n            created_at,\n            dog:dogs (\n              id,\n              name,\n              breed,\n              gender,\n              birth_date,\n              owner:profiles (\n                id,\n                name\n              )\n            )\n          ").eq("status","pending").order("created_at",{ascending:!1}));if(e.error)throw Q("error",0,e.error),e.error;const s=e.data||[];if(0===s.length)return Q("info"),void r([]);Q("info",s.length);const a=s.map(e=>{const s=Array.isArray(e.dog)?e.dog[0]:e.dog,a=s?Array.isArray(s.owner)?s.owner[0]:s.owner:null;return s&&a?{id:e.id,dog_id:e.dog_id,rabies_vaccine_image:e.rabies_vaccine_image,combo_vaccine_image:e.combo_vaccine_image,rabies_expiry_date:e.rabies_expiry_date,combo_expiry_date:e.combo_expiry_date,status:e.status,created_at:e.created_at,dog:{id:s.id,name:s.name,breed:s.breed,gender:s.gender,birth_date:s.birth_date,owner:{id:a.id,name:a.name}}}:(Q("warn"),null)}).filter(e=>null!==e);r(a)}catch(e){Q("error",0,K(e)),c(`ワクチン証明書データの取得に失敗しました: ${K(e)}`)}},x=async()=>{try{n(!0),c(""),"parks"===e?await(async()=>{try{Q("info");const e=await Z(()=>J.from("dog_parks").select("\n            id,\n            name,\n            address,\n            status,\n            created_at,\n            owner_id\n          ").in("status",["pending","first_stage_passed","second_stage_waiting","second_stage_review","smart_lock_testing"]).order("created_at",{ascending:!1}));if(e.error)throw Q("error",0,e.error),e.error;const s=e.data||[];if(0===s.length)return Q("info"),void a([]);Q("info",s.length);const t=[...new Set(s.map(e=>e.owner_id))],r=s.map(e=>e.id),[i,n,l,c]=await Promise.allSettled([t.length>0?J.from("profiles").select("id, name, postal_code, address, phone_number, email").in("id",t):Promise.resolve({data:[],error:null}),r.length>0?J.from("dog_park_review_stages").select("park_id, second_stage_submitted_at").in("park_id",r):Promise.resolve({data:[],error:null}),r.length>0?J.from("dog_park_facility_images").select("park_id, is_approved").in("park_id",r):Promise.resolve({data:[],error:null}),t.length>0?J.from("owner_verifications").select("user_id, verification_id, status, verification_data, created_at").in("user_id",t):Promise.resolve({data:[],error:null})]),d="fulfilled"===i.status&&i.value.data||[],o=new Map(d.map(e=>[e.id,e])),m="fulfilled"===n.status&&n.value.data||[],x=new Map(m.map(e=>[e.park_id,e])),h="fulfilled"===l.status&&l.value.data||[],u=new Map;h.forEach(e=>{u.has(e.park_id)||u.set(e.park_id,[]),u.get(e.park_id).push(e)});const g="fulfilled"===c.status&&c.value.data||[],p=new Map(g.map(e=>[e.user_id,e])),j=s.map(e=>{const s=o.get(e.owner_id),a=x.get(e.id),t=u.get(e.id)||[],r=p.get(e.owner_id),i=t.length,n=t.filter(e=>!0===e.is_approved).length,l=t.filter(e=>!1===e.is_approved).length,c=t.filter(e=>null===e.is_approved).length;let d="",m="";return r&&r.verification_data&&"object"==typeof r.verification_data&&(d=r.verification_data.document_url||r.verification_data.file_path||"",m=r.verification_data.file_name||r.verification_data.filename||""),!d&&(null==r?void 0:r.verification_id)&&(d=r.verification_id),!m&&d&&(m=d.split("/").pop()||"identity_document"),{id:e.id,name:e.name,address:e.address,status:e.status,created_at:e.created_at,owner_id:e.owner_id,owner_name:(null==s?void 0:s.name)||"Unknown Owner",second_stage_submitted_at:(null==a?void 0:a.second_stage_submitted_at)||null,total_images:i,approved_images:n,rejected_images:l,pending_images:c,owner_postal_code:(null==s?void 0:s.postal_code)||"",owner_address:(null==s?void 0:s.address)||"",owner_phone_number:(null==s?void 0:s.phone_number)||"",owner_email:(null==s?void 0:s.email)||"",identity_document_url:d,identity_document_filename:m,identity_status:(null==r?void 0:r.status)||"not_submitted",identity_created_at:(null==r?void 0:r.created_at)||""}});Q("info",j.length),a(j)}catch(e){Q("error",0,K(e)),c(`ドッグラン申請データの取得に失敗しました: ${K(e)}`)}})():"vaccines"===e&&await m()}catch(s){Q("error",0,K(s)),c(`データの取得に失敗しました: ${K(s)}`)}finally{n(!1)}};return O.useEffect(()=>{x()},[e]),{pendingParks:s,pendingVaccines:t,isLoading:i,error:l,success:d,refetch:x}},pe=e=>{const[s,a]=O.useState([]),[t,r]=O.useState(!1),[i,n]=O.useState(""),l=async e=>{try{r(!0),n(""),Q("info");const s=await Z(()=>J.from("dog_park_facility_images").select("*").eq("park_id",e).order("created_at",{ascending:!1}));if(s.error)throw Q("error",0,s.error),s.error;const t=s.data||[];Q("info",t.length),a(t)}catch(s){Q("error",0,K(s)),n(`画像データの取得に失敗しました: ${K(s)}`)}finally{r(!1)}};return O.useEffect(()=>{e&&l(e)},[e]),{parkImages:s,isLoading:t,error:i,fetchParkImages:l}};const je=Object.freeze(Object.defineProperty({__proto__:null,AdminParkManagement:function(){const{isAdmin:s}=Y(),t=U(),[r,i]=O.useState("applications"),[l,c]=O.useState([]),[d,o]=O.useState([]),[m,x]=O.useState([]),[f,v]=O.useState([]),[N,y]=O.useState([]),[_,w]=O.useState(!0),[A,L]=O.useState(""),[z,q]=O.useState(""),[D,M]=O.useState(""),[R,V]=O.useState("all"),[W,B]=O.useState("created_at"),[G,X]=O.useState("desc"),[K,Z]=O.useState(null),H=ge("parks"),Q=async e=>{if(0===e.length)return new Map;try{const{data:s,error:a}=await J.from("dog_parks").select("\n          id,\n          description,\n          price,\n          max_capacity,\n          large_dog_area,\n          small_dog_area,\n          private_booths,\n          facilities,\n          facility_details,\n          private_booth_count,\n          image_url,\n          cover_image_url,\n          average_rating,\n          review_count\n        ").in("id",e);if(a)return new Map;const t=new Map;return(s||[]).forEach(e=>{t.set(e.id,e)}),t}catch(s){return new Map}},ee=async e=>{if(0===e.length)return new Map;try{const{data:s,error:a}=await J.from("dog_park_facility_images").select("\n          id,\n          park_id,\n          image_type,\n          image_url,\n          is_approved,\n          admin_notes,\n          created_at\n        ").in("park_id",e);if(a)return new Map;const t=new Map;return(s||[]).forEach(e=>{t.has(e.park_id)||t.set(e.park_id,[]),t.get(e.park_id).push(e)}),t}catch(s){return new Map}},se=async()=>{try{const{data:e,error:s}=await J.from("dog_parks").select("\n          *,\n          profiles:owner_id (\n            name,\n            address,\n            phone_number,\n            email,\n            postal_code\n          )\n        ").eq("status","approved").order("created_at",{ascending:!1});if(s)return[];return e.map(e=>{const s=Array.isArray(e.profiles)?e.profiles[0]:e.profiles;return me({id:e.id,name:e.name,address:e.address,status:e.status,created_at:e.created_at,owner_id:e.owner_id,owner_name:(null==s?void 0:s.name)||"Unknown",owner_email:(null==s?void 0:s.email)||"Unknown",owner_phone_number:(null==s?void 0:s.phone_number)||"",owner_address:(null==s?void 0:s.address)||"",identity_document_url:"",identity_document_filename:"",identity_status:"approved",identity_created_at:""},e,[])})}catch(e){return[]}},ae=(e,s,a)=>{Z({url:e,type:s,parkName:a})},te=()=>{Z(null)},re=e=>{q(e),L(""),setTimeout(()=>q(""),5e3)},ie=e=>{L(e),q(""),setTimeout(()=>L(""),8e3)},oe=async e=>{if(window.confirm("このドッグラン申請を削除してもよろしいですか？この操作は取り消せません。"))try{L(""),q("");try{const{error:s}=await J.from("news_announcements").delete().eq("park_id",e);if(s)return void ie(`ニュースの削除に失敗しました: ${s.message}`)}catch(s){return void ie("ニュース削除処理でエラーが発生しました。")}try{const{error:s}=await J.from("new_park_openings").delete().eq("park_id",e);if(s)return void ie(`新規開園情報の削除に失敗しました: ${s.message}`)}catch(s){return void ie("新規開園情報削除処理でエラーが発生しました。")}try{const{data:s}=await J.from("smart_locks").select("lock_id").eq("park_id",e);if(s&&s.length>0){const e=s.map(e=>e.lock_id),{error:a}=await J.from("lock_access_logs").delete().in("lock_id",e);if(a)return void ie(`ロックアクセスログの削除に失敗しました: ${a.message}`)}}catch(s){return void ie("ロックアクセスログ削除処理でエラーが発生しました。")}try{const{error:s}=await J.from("smart_locks").delete().eq("park_id",e);if(s)return void ie(`スマートロックの削除に失敗しました: ${s.message}`)}catch(s){return void ie("スマートロック削除処理でエラーが発生しました。")}try{const{error:s}=await J.from("user_entry_status").delete().eq("park_id",e);if(s)return void ie(`エントリーステータスの削除に失敗しました: ${s.message}`)}catch(s){return void ie("エントリーステータス削除処理でエラーが発生しました。")}try{const{error:s}=await J.from("reservations").delete().eq("park_id",e);if(s)return void ie(`予約の削除に失敗しました: ${s.message}`)}catch(s){return void ie("予約削除処理でエラーが発生しました。")}try{const{error:s}=await J.from("dog_encounters").delete().eq("park_id",e);if(s)return void ie(`出会い記録の削除に失敗しました: ${s.message}`)}catch(s){return void ie("出会い記録削除処理でエラーが発生しました。")}try{const{data:s}=await J.from("dog_park_reviews").select("id").eq("park_id",e);if(s&&s.length>0){const e=s.map(e=>e.id),{error:a}=await J.from("dog_park_review_images").delete().in("review_id",e);if(a)return void ie(`レビュー画像の削除に失敗しました: ${a.message}`)}}catch(s){return void ie("レビュー画像削除処理でエラーが発生しました。")}try{const{error:s}=await J.from("dog_park_reviews").delete().eq("park_id",e);if(s)return void ie(`レビューの削除に失敗しました: ${s.message}`)}catch(s){return void ie("レビュー削除処理でエラーが発生しました。")}try{const{error:s}=await J.from("dog_park_facility_images").delete().eq("park_id",e);if(s)return void ie(`施設画像の削除に失敗しました: ${s.message}`)}catch(s){return void ie("施設画像削除処理でエラーが発生しました。")}try{const{error:s}=await J.from("dog_park_images").delete().eq("park_id",e);if(s)return void ie(`パーク画像の削除に失敗しました: ${s.message}`)}catch(s){return void ie("パーク画像削除処理でエラーが発生しました。")}try{const{error:s}=await J.from("dog_park_review_stages").delete().eq("park_id",e);if(s)return void ie(`レビューステージの削除に失敗しました: ${s.message}`)}catch(s){return void ie("レビューステージ削除処理でエラーが発生しました。")}try{const{error:s}=await J.from("dog_parks").delete().eq("id",e);if(s)return void ie(`ドッグランの削除に失敗しました: ${s.message}`)}catch(s){return void ie("ドッグラン削除処理でエラーが発生しました。")}re("ドッグラン申請を削除しました。"),c(s=>s.filter(s=>s.id!==e))}catch(s){ie("ドッグランの削除に失敗しました。")}},me=(e,s,a)=>{const t=s||{};return{id:e.id,name:e.name,description:t.description||"",address:e.address,price:t.price||0,status:e.status,owner_id:e.owner_id,created_at:e.created_at,max_capacity:t.max_capacity||0,large_dog_area:t.large_dog_area||!1,small_dog_area:t.small_dog_area||!1,private_booths:t.private_booths||!1,facilities:t.facilities||{parking:!1,shower:!1,restroom:!1,agility:!1,rest_area:!1,water_station:!1},average_rating:t.average_rating||0,review_count:t.review_count||0,facility_details:t.facility_details||"",private_booth_count:t.private_booth_count||0,image_url:t.image_url||"",cover_image_url:t.cover_image_url||"",owner_name:e.owner_name||"Unknown",owner_email:e.owner_email||"Unknown",owner_phone:e.owner_phone_number||"",owner_address:e.owner_address||"",facility_images:a||[],identity_document_url:e.identity_document_url||"",identity_document_filename:e.identity_document_filename||"",identity_status:e.identity_status||"not_submitted",identity_created_at:e.identity_created_at||""}};O.useEffect(()=>{s||t("/admin-dashboard")},[s,t]),O.useEffect(()=>{if(!H.isLoading&&H.pendingParks.length>0){(async()=>{const e=H.pendingParks.map(e=>e.id),[s,a]=await Promise.all([Q(e),ee(e)]),t=H.pendingParks.map(e=>{const t=s.get(e.id),r=a.get(e.id)||[];return me(e,t,r)});c(t),w(!1),he(),se().then(e=>{v(e),xe(e)})})()}else H.isLoading?w(!0):(c([]),w(!1),he(),se().then(e=>{v(e),xe(e)}))},[H.pendingParks,H.isLoading]);const xe=e=>{let s=e.filter(e=>(!D||e.name.toLowerCase().includes(D.toLowerCase())||e.address.toLowerCase().includes(D.toLowerCase())||e.owner_name.toLowerCase().includes(D.toLowerCase()))&&("all"===R||"approved"===R));s=s.sort((e,s)=>{let a,t;switch(W){case"name":a=e.name,t=s.name;break;case"average_rating":a=e.average_rating||0,t=s.average_rating||0;break;default:a=e.created_at,t=s.created_at}return"asc"===G?a>t?1:-1:a<t?1:-1}),x(s)};O.useEffect(()=>{f.length>0&&xe(f)},[D,R,W,G,f]),O.useEffect(()=>{l.length>0&&he()},[D,R,W,G,l]);const he=()=>{const e=["pending","first_stage_passed","second_stage_waiting","second_stage_review","smart_lock_testing"],s=["approved"];let a=l.filter(e=>{const s=!D||e.name.toLowerCase().includes(D.toLowerCase())||e.address.toLowerCase().includes(D.toLowerCase())||e.owner_name.toLowerCase().includes(D.toLowerCase()),a="all"===R||e.status===R;return s&&a});a=a.sort((e,s)=>{let a,t;switch(W){case"name":a=e.name,t=s.name;break;case"average_rating":a=e.average_rating||0,t=s.average_rating||0;break;default:a=e.created_at,t=s.created_at}return"asc"===G?a>t?1:-1:a<t?1:-1}),o(a);const t=a.filter(s=>e.includes(s.status));a.filter(e=>s.includes(e.status));y(t)},ue=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"first_stage_passed":return"bg-blue-100 text-blue-800";case"second_stage_waiting":return"bg-orange-100 text-orange-800";case"second_stage_review":return"bg-purple-100 text-purple-800";case"smart_lock_testing":return"bg-indigo-100 text-indigo-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},pe=e=>{switch(e){case"pending":return"第一審査中";case"first_stage_passed":return"第一審査通過（旧）";case"second_stage_waiting":return"第二審査提出待ち";case"second_stage_review":return"第二審査中";case"smart_lock_testing":return"スマートロック認証待ち";case"approved":return"承認済み・公開可能";case"rejected":return"却下";default:return"不明"}},je=e=>`¥${e.toLocaleString()}`,fe=e=>new Date(e).toLocaleDateString("ja-JP",{year:"numeric",month:"short",day:"numeric"});return _?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"データを読み込み中..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 py-8",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"bg-white shadow rounded-lg mb-8",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"ドッグラン管理"}),e.jsx("p",{className:"text-gray-600",children:"ドッグラン施設の詳細情報と申請管理"})]}),A&&e.jsx("div",{className:"px-6 py-4 bg-red-50 border-l-4 border-red-400",children:e.jsxs("div",{className:"flex",children:[e.jsx(h,{className:"h-5 w-5 text-red-400 mr-2"}),e.jsx("p",{className:"text-sm text-red-700",children:A})]})}),z&&e.jsx("div",{className:"px-6 py-4 bg-green-50 border-l-4 border-green-400",children:e.jsxs("div",{className:"flex",children:[e.jsx(k,{className:"h-5 w-5 text-green-400 mr-2"}),e.jsx("p",{className:"text-sm text-green-700",children:z})]})}),e.jsx("div",{className:"px-6",children:e.jsxs("nav",{className:"flex space-x-8","aria-label":"Tabs",children:[e.jsxs("button",{onClick:()=>i("applications"),className:"whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm "+("applications"===r?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx(S,{className:"w-5 h-5 inline mr-2"}),"ドッグラン申請",e.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:N.length})]}),e.jsxs("button",{onClick:()=>i("parks"),className:"whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm "+("parks"===r?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx(b,{className:"w-5 h-5 inline mr-2"}),"ドッグラン一覧",e.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:m.length})]})]})})]}),"parks"===r&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(le,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(C,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(ce,{label:"",placeholder:"施設名、住所、オーナー名で検索...",value:D,onChange:e=>M(e.target.value),className:"pl-10"})]}),e.jsx(de,{label:"",options:[{value:"all",label:"全ステータス"},{value:"approved",label:"承認済み"}],value:R,onChange:e=>V(e.target.value)}),e.jsx(de,{label:"",options:[{value:"created_at",label:"作成日時"},{value:"name",label:"施設名"},{value:"average_rating",label:"平均評価"}],value:W,onChange:e=>B(e.target.value)}),e.jsxs(ne,{variant:"secondary",onClick:()=>X("asc"===G?"desc":"asc"),className:"flex items-center justify-center",children:["asc"===G?e.jsx(P,{className:"w-4 h-4 mr-2"}):e.jsx(I,{className:"w-4 h-4 mr-2"}),"asc"===G?"昇順":"降順"]})]})}),0===m.length?e.jsxs(le,{className:"text-center py-12",children:[e.jsx(b,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:D||"all"!==R?"条件に一致するドッグランが見つかりません":"承認済みのドッグランがありません"})]}):e.jsx("div",{className:"grid grid-cols-1 gap-6",children:m.map(s=>e.jsx(le,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.name}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${ue(s.status)}`,children:pe(s.status)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[e.jsx(g,{className:"w-4 h-4 mr-1"}),s.address]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[e.jsx(j,{className:"w-4 h-4 mr-1"}),je(s.price)]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(p,{className:"w-4 h-4 mr-1"}),fe(s.created_at)]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[e.jsx($,{className:"w-4 h-4 mr-1"}),s.owner_name]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[e.jsx(u,{className:"w-4 h-4 mr-1"}),"定員: ",s.max_capacity,"頭"]}),s.average_rating&&s.average_rating>0&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(E,{className:"w-4 h-4 mr-1"}),s.average_rating.toFixed(1)," (",s.review_count||0,"件)"]})]})]}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:s.description}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.large_dog_area&&e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:"大型犬エリア"}),s.small_dog_area&&e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded",children:"小型犬エリア"}),s.private_booths&&e.jsx("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded",children:"個室あり"}),s.facilities.parking&&e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"駐車場"}),s.facilities.shower&&e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"シャワー"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(F,{to:`/parks/${s.id}`,className:"flex items-center px-3 py-1 text-sm bg-blue-100 text-blue-800 rounded-md hover:bg-blue-200",children:[e.jsx(a,{className:"w-4 h-4 mr-1"}),"詳細"]}),e.jsxs(ne,{size:"sm",variant:"secondary",onClick:()=>oe(s.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[e.jsx(n,{className:"w-4 h-4 mr-1"}),"削除"]})]})]})},s.id))})]}),"applications"===r&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(le,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(C,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(ce,{label:"",placeholder:"施設名、住所、オーナー名で検索...",value:D,onChange:e=>M(e.target.value),className:"pl-10"})]}),e.jsx(de,{label:"",options:[{value:"all",label:"全ステータス"},{value:"pending",label:"第一審査中"},{value:"first_stage_passed",label:"第一審査通過（旧）"},{value:"second_stage_waiting",label:"第二審査提出待ち"},{value:"second_stage_review",label:"第二審査中"},{value:"smart_lock_testing",label:"スマートロック認証待ち"},{value:"rejected",label:"却下"}],value:R,onChange:e=>V(e.target.value)}),e.jsx(de,{label:"",options:[{value:"created_at",label:"作成日時"},{value:"name",label:"施設名"},{value:"average_rating",label:"平均評価"}],value:W,onChange:e=>B(e.target.value)}),e.jsxs(ne,{variant:"secondary",onClick:()=>X("asc"===G?"desc":"asc"),className:"flex items-center justify-center",children:["asc"===G?e.jsx(P,{className:"w-4 h-4 mr-2"}):e.jsx(I,{className:"w-4 h-4 mr-2"}),"asc"===G?"昇順":"降順"]})]})}),0===N.length?e.jsxs(le,{className:"text-center py-12",children:[e.jsx(S,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:D||"all"!==R?"条件に一致する申請が見つかりません":"審査中の申請がありません"})]}):e.jsx("div",{className:"grid grid-cols-1 gap-6",children:N.map(s=>e.jsxs(le,{className:"p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.name}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${ue(s.status)}`,children:pe(s.status)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"申請者情報"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx($,{className:"w-4 h-4 mr-2"}),s.owner_name]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(g,{className:"w-4 h-4 mr-2"}),s.owner_address||"住所未登録"]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"申請日: ",fe(s.created_at)]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"施設情報"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(g,{className:"w-4 h-4 mr-2"}),s.address]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),je(s.price)]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(u,{className:"w-4 h-4 mr-2"}),"定員: ",s.max_capacity,"頭"]})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center",children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"本人確認書類"]}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:s.identity_document_url&&""!==s.identity_document_url?e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"relative",children:e.jsx("img",{src:`${J.storage.from("vaccine-certs").getPublicUrl(s.identity_document_url||"").data.publicUrl}`,alt:"本人確認書類",className:"w-32 h-32 object-cover rounded border shadow-sm cursor-pointer hover:shadow-md transition-shadow",onClick:()=>ae(`${J.storage.from("vaccine-certs").getPublicUrl(s.identity_document_url||"").data.publicUrl}`,"本人確認書類",s.name)})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"ファイル名:"}),e.jsx("span",{className:"text-sm text-gray-600 ml-2",children:s.identity_document_filename||"identity_document"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"審査状況:"}),e.jsx("span",{className:"text-sm ml-2 px-2 py-1 rounded-full "+("approved"===s.identity_status?"bg-green-100 text-green-800":"rejected"===s.identity_status?"bg-red-100 text-red-800":"submitted"===s.identity_status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:"approved"===s.identity_status?"承認済み":"rejected"===s.identity_status?"却下":"submitted"===s.identity_status?"審査中":"未提出"})]}),s.identity_created_at&&e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"提出日:"}),e.jsx("span",{className:"text-sm text-gray-600 ml-2",children:fe(s.identity_created_at)})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:"クリックして拡大表示"})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(S,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"本人確認書類が提出されていません"})]})})]}),s.description&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"施設説明"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"設備・サービス"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.large_dog_area&&e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:"大型犬エリア"}),s.small_dog_area&&e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded",children:"小型犬エリア"}),s.private_booths&&e.jsx("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded",children:"個室あり"}),s.facilities.parking&&e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"駐車場"}),s.facilities.shower&&e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"シャワー"}),s.facilities.restroom&&e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"トイレ"}),s.facilities.agility&&e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"アジリティ"}),s.facilities.rest_area&&e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"休憩エリア"}),s.facilities.water_station&&e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"給水設備"})]})]}),"second_stage_review"===s.status&&s.facility_images&&s.facility_images.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-2",children:["設備画像 (",s.facility_images.length,"枚)"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:s.facility_images.map((a,t)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:a.image_url,alt:`設備画像 ${t+1}`,className:"w-full h-24 object-cover rounded-md border cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>ae(a.image_url,a.image_type,s.name)}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded-b-md",children:a.image_type})]},a.id))})]})]})}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[("pending"===s.status||"first_stage_passed"===s.status||"second_stage_review"===s.status)&&e.jsxs(e.Fragment,{children:[e.jsxs(ne,{size:"sm",onClick:()=>(async e=>{const s=l.find(s=>s.id===e);if(!s)return;let a,t,r;if(window.confirm("⚠️ 一時的な回避策を使用しますか？\n\n「はい」を選択すると、第一審査から直接「承認済み」に変更されます。\n「いいえ」を選択すると、通常の承認処理を実行します（データベース制約の修正が必要）。"))a="second_stage_waiting",t="⚠️ 一時的な回避策として、このドッグランを「第二審査提出待ち」にしてもよろしいですか？\n\n※ 申請タブに残り、後で再度承認処理ができます。",r="⚠️ 一時的な回避策により、ドッグランのステータスが「第二審査提出待ち」に変更されました。",s.name;else switch(s.status){case"pending":a="second_stage_waiting",t="このドッグランの第一審査を承認してもよろしいですか？",r="ドッグランの第一審査を承認しました。",s.name;break;case"second_stage_waiting":a="second_stage_review",t="このドッグランを第二審査中に変更しますか？",r="ドッグランが第二審査中に変更されました。",s.name;break;case"second_stage_review":a="smart_lock_testing",t="このドッグランの第二審査を承認してもよろしいですか？",r="ドッグランの第二審査を承認しました。",s.name;break;case"smart_lock_testing":a="approved",t="このドッグランの承認を完了してもよろしいですか？",r="ドッグランが承認されました。",s.name;break;default:return void ie("このドッグランの現在のステータスでは承認できません。")}if(window.confirm(t))try{L(""),q("");const{error:s}=await J.from("dog_parks").update({status:a}).eq("id",e);if(s)return void("23514"===s.code?ie(`承認処理に失敗しました: ステータス "${a}" が許可されていません。\n\n📋 データベースの制約を更新してください：\n\n1. https://app.supabase.com にアクセス\n2. プロジェクトを選択\n3. 左側メニューから「SQL Editor」を選択\n4. 以下のSQLを実行：\n\nALTER TABLE dog_parks DROP CONSTRAINT IF EXISTS dog_parks_status_check;\nALTER TABLE dog_parks ADD CONSTRAINT dog_parks_status_check CHECK (status IN ('pending', 'first_stage_passed', 'second_stage_waiting', 'second_stage_review', 'smart_lock_testing', 'approved', 'rejected'));\n\n5. ページを再読み込み`):ie(`承認処理に失敗しました: ${s.message||"不明なエラー"}`));re(r);const t=l.map(s=>s.id===e?{...s,status:a}:s);c(t),setTimeout(()=>{const e=["pending","first_stage_passed","second_stage_waiting","second_stage_review","smart_lock_testing"],s=t.filter(e=>{const s=!D||e.name.toLowerCase().includes(D.toLowerCase())||e.address.toLowerCase().includes(D.toLowerCase())||e.owner_name.toLowerCase().includes(D.toLowerCase()),a="all"===R||e.status===R;return s&&a}).filter(s=>e.includes(s.status));y(s)},100)}catch(i){ie(`承認処理に失敗しました: ${i instanceof Error?i.message:"不明なエラー"}`)}})(s.id),className:"bg-green-600 hover:bg-green-700",children:[e.jsx(k,{className:"w-4 h-4 mr-1"}),"pending"===s.status?"第一審査承認":"second_stage_review"===s.status?"第二審査承認":"承認"]}),e.jsxs(ne,{size:"sm",variant:"secondary",onClick:()=>(async e=>{if(window.confirm("このドッグラン申請を却下してもよろしいですか？"))try{L(""),q("");const{error:s}=await J.from("dog_parks").update({status:"rejected"}).eq("id",e);if(s)return void ie("却下の処理に失敗しました。");const a=l.find(s=>s.id===e);a&&await J.from("notifications").insert([{user_id:a.owner_id,title:"ドッグラン申請却下",message:`${a.name}の申請が却下されました。詳細については管理者までお問い合わせください。`,type:"park_rejected",created_at:(new Date).toISOString(),read:!1}]),re("ドッグラン申請を却下しました。"),c(s=>s.map(s=>s.id===e?{...s,status:"rejected"}:s))}catch(s){ie("却下の処理に失敗しました。")}})(s.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[e.jsx(T,{className:"w-4 h-4 mr-1"}),"却下"]})]}),e.jsxs(ne,{size:"sm",variant:"secondary",onClick:()=>oe(s.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[e.jsx(n,{className:"w-4 h-4 mr-1"}),"削除"]})]})]},s.id))})]})]}),K&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",onClick:te,onKeyDown:e=>{"Escape"===e.key&&te()},tabIndex:0,children:e.jsxs("div",{className:"relative max-w-4xl max-h-full",children:[e.jsx("img",{src:K.url,alt:`${K.parkName} - ${K.type}`,className:"max-w-full max-h-full object-contain rounded-lg",onClick:e=>e.stopPropagation()}),e.jsxs("div",{className:"absolute bottom-4 left-4 right-4 bg-black bg-opacity-50 text-white p-3 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-lg",children:K.parkName}),e.jsx("p",{className:"text-sm text-gray-300",children:K.type})]}),e.jsx("button",{onClick:te,className:"absolute top-4 right-4 text-white hover:text-gray-300 bg-black bg-opacity-50 rounded-full p-2",children:e.jsx(T,{className:"w-6 h-6"})})]})})]})}},Symbol.toStringTag,{value:"Module"}));const fe=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const{user:s,isAdmin:t}=Y(),r=U(),[i,n]=O.useState([]),[l,c]=O.useState([]),[o,m]=O.useState([]),[x,u]=O.useState(!0),[p,j]=O.useState(""),[f,b]=O.useState(""),[v,N]=O.useState("pending"),[y,_]=O.useState(null),[w,k]=O.useState(!1),[C,P]=O.useState(!1),[I,E]=O.useState(null);O.useEffect(()=>{t?M():r("/")},[t,r]),O.useEffect(()=>{i.length>0&&D()},[i]);const T=e=>{j(e),b(""),setTimeout(()=>j(""),8e3)},D=()=>{const e=i.filter(e=>"pending"===e.status),s=i.filter(e=>"approved"===e.status);c(e),m(s)},M=async()=>{try{u(!0),j("");const{data:e,error:s}=await J.from("vaccine_certifications").select("\n          *,\n          dog:dogs (\n            id,\n            name,\n            breed,\n            gender,\n            birth_date,\n            owner:profiles (\n              id,\n              name,\n              email,\n              phone_number,\n              address,\n              postal_code\n            )\n          )\n        ").order("created_at",{ascending:!1});if(s)throw s;const a=(e||[]).map(e=>{var s,a,t,r,i,n,l,c,d,o,m,x,h,u;return{id:e.id,dog_id:e.dog_id,dog_name:(null==(s=e.dog)?void 0:s.name)||"不明",dog_breed:(null==(a=e.dog)?void 0:a.breed)||"不明",dog_gender:(null==(t=e.dog)?void 0:t.gender)||"不明",dog_birth_date:(null==(r=e.dog)?void 0:r.birth_date)||"",owner_id:e.owner_id,owner_name:(null==(n=null==(i=e.dog)?void 0:i.owner)?void 0:n.name)||"不明",owner_email:(null==(c=null==(l=e.dog)?void 0:l.owner)?void 0:c.email)||"不明",owner_phone:(null==(o=null==(d=e.dog)?void 0:d.owner)?void 0:o.phone_number)||"",owner_address:(null==(x=null==(m=e.dog)?void 0:m.owner)?void 0:x.address)||"",owner_postal_code:(null==(u=null==(h=e.dog)?void 0:h.owner)?void 0:u.postal_code)||"",rabies_vaccine_image:e.rabies_vaccine_image||"",combo_vaccine_image:e.combo_vaccine_image||"",rabies_expiry_date:e.rabies_expiry_date||"",combo_expiry_date:e.combo_expiry_date||"",status:e.status||"pending",created_at:e.created_at,admin_notes:e.admin_notes||""}});n(a)}catch(e){T("ワクチン証明書申請の取得に失敗しました。")}finally{u(!1)}},R=async e=>{if(window.confirm("このワクチン証明書申請を承認してもよろしいですか？"))try{P(!0),j(""),b("");const{error:s}=await J.from("vaccine_certifications").update({status:"approved",approved_at:(new Date).toISOString()}).eq("id",e);if(s)throw s;const a=i.find(s=>s.id===e);a&&await J.from("notifications").insert([{user_id:a.owner_id,title:"ワクチン証明書承認",message:`${a.dog_name}ちゃんのワクチン証明書が承認されました。`,type:"vaccine_approved",created_at:(new Date).toISOString(),read:!1}]),b("ワクチン証明書を承認しました。"),j(""),setTimeout(()=>b(""),5e3),n(s=>s.map(s=>s.id===e?{...s,status:"approved"}:s))}catch(s){T("承認処理に失敗しました。")}finally{P(!1)}},F=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},V=e=>{switch(e){case"pending":return"承認待ち";case"approved":return"承認済み";case"rejected":return"却下";default:return"不明"}},W=e=>new Date(e).toLocaleDateString("ja-JP"),B=e=>{if(!e)return"不明";const s=new Date,a=new Date(e),t=s.getFullYear()-a.getFullYear(),r=s.getMonth()-a.getMonth();return r<0||0===r&&s.getDate()<a.getDate()?t-1+"歳":`${t}歳`};return t?x?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"データを読み込み中..."})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"bg-white shadow rounded-lg mb-8",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"ワクチン証明書 承認管理"}),e.jsx("p",{className:"text-gray-600",children:"登録されたワクチン証明書の承認・却下を管理します。"})]}),p&&e.jsx("div",{className:"px-6 py-4 bg-red-50 border-l-4 border-red-400",children:e.jsxs("div",{className:"flex",children:[e.jsx(h,{className:"h-5 w-5 text-red-400 mr-2"}),e.jsx("p",{className:"text-sm text-red-700",children:p})]})}),f&&e.jsx("div",{className:"px-6 py-4 bg-green-50 border-l-4 border-green-400",children:e.jsxs("div",{className:"flex",children:[e.jsx(d,{className:"h-5 w-5 text-green-400 mr-2"}),e.jsx("p",{className:"text-sm text-green-700",children:f})]})}),e.jsx("div",{className:"px-6",children:e.jsxs("nav",{className:"flex space-x-8","aria-label":"Tabs",children:[e.jsxs("button",{onClick:()=>N("pending"),className:"whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm "+("pending"===v?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx(S,{className:"w-5 h-5 inline mr-2"}),"承認待ち",e.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:l.length})]}),e.jsxs("button",{onClick:()=>N("approved"),className:"whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm "+("approved"===v?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx(A,{className:"w-5 h-5 inline mr-2"}),"登録中のワンちゃん",e.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:o.length})]})]})})]}),"pending"===v&&e.jsx("div",{className:"space-y-6",children:0===l.length?e.jsxs(le,{className:"text-center py-12",children:[e.jsx(S,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"承認待ちのワクチン証明書申請がありません"})]}):e.jsx("div",{className:"space-y-4",children:l.map(s=>e.jsx(le,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx(A,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.dog_name}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${F(s.status)}`,children:V(s.status)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"ワンちゃん情報"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{children:["犬種: ",s.dog_breed]}),e.jsxs("div",{children:["性別: ",s.dog_gender]}),e.jsxs("div",{children:["年齢: ",B(s.dog_birth_date)]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"飼い主情報"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx($,{className:"w-4 h-4 mr-1"}),s.owner_name]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(L,{className:"w-4 h-4 mr-1"}),s.owner_email]}),s.owner_phone&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(z,{className:"w-4 h-4 mr-1"}),s.owner_phone]}),s.owner_address&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(g,{className:"w-4 h-4 mr-1"}),"〒",s.owner_postal_code," ",s.owner_address]})]})]})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["申請日: ",W(s.created_at)]})]}),e.jsxs("div",{className:"flex space-x-2 ml-4",children:[e.jsxs(ne,{size:"sm",variant:"secondary",onClick:()=>{_(s),k(!0)},children:[e.jsx(a,{className:"w-4 h-4 mr-1"}),"詳細"]}),e.jsxs(ne,{size:"sm",onClick:()=>R(s.id),className:"bg-green-600 hover:bg-green-700",disabled:C,children:[e.jsx(d,{className:"w-4 h-4 mr-1"}),"承認"]})]})]})},s.id))})}),"approved"===v&&e.jsx("div",{className:"space-y-6",children:0===o.length?e.jsxs(le,{className:"text-center py-12",children:[e.jsx(A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"承認済みのワクチン証明書がありません"})]}):e.jsx("div",{className:"space-y-4",children:o.map(s=>e.jsx(le,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx(A,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.dog_name}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${F(s.status)}`,children:V(s.status)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"ワンちゃん情報"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{children:["犬種: ",s.dog_breed]}),e.jsxs("div",{children:["性別: ",s.dog_gender]}),e.jsxs("div",{children:["年齢: ",B(s.dog_birth_date)]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"飼い主情報"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx($,{className:"w-4 h-4 mr-1"}),s.owner_name]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(L,{className:"w-4 h-4 mr-1"}),s.owner_email]}),s.owner_phone&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(z,{className:"w-4 h-4 mr-1"}),s.owner_phone]}),s.owner_address&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(g,{className:"w-4 h-4 mr-1"}),"〒",s.owner_postal_code," ",s.owner_address]})]})]})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["申請日: ",W(s.created_at)]})]}),e.jsx("div",{className:"flex space-x-2 ml-4",children:e.jsxs(ne,{size:"sm",variant:"secondary",onClick:()=>{_(s),k(!0)},children:[e.jsx(a,{className:"w-4 h-4 mr-1"}),"詳細"]})})]})},s.id))})}),w&&y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold",children:"ワクチン証明書詳細"}),e.jsx("button",{onClick:()=>{k(!1),_(null)},className:"text-gray-500 hover:text-gray-700",children:"×"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"ワンちゃん情報"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"名前:"})," ",y.dog_name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"犬種:"})," ",y.dog_breed]}),e.jsxs("div",{children:[e.jsx("strong",{children:"性別:"})," ",y.dog_gender]}),e.jsxs("div",{children:[e.jsx("strong",{children:"年齢:"})," ",B(y.dog_birth_date)]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"飼い主情報"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"名前:"})," ",y.owner_name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"メール:"})," ",y.owner_email]}),y.owner_phone&&e.jsxs("div",{children:[e.jsx("strong",{children:"電話:"})," ",y.owner_phone]}),y.owner_address&&e.jsxs("div",{children:[e.jsx("strong",{children:"住所:"})," 〒",y.owner_postal_code," ",y.owner_address]})]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"ワクチン証明書画像"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[y.rabies_vaccine_image&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:["狂犬病ワクチン",y.rabies_expiry_date&&e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(有効期限: ",W(y.rabies_expiry_date),")"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:y.rabies_vaccine_image,alt:"狂犬病ワクチン証明書",className:"w-full h-48 object-cover rounded-lg border cursor-pointer",onClick:()=>E(y.rabies_vaccine_image)}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("button",{onClick:()=>E(y.rabies_vaccine_image),className:"bg-black bg-opacity-50 text-white p-1 rounded-full hover:bg-opacity-70",children:e.jsx(q,{className:"w-4 h-4"})})})]})]}),y.combo_vaccine_image&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:["混合ワクチン",y.combo_expiry_date&&e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(有効期限: ",W(y.combo_expiry_date),")"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:y.combo_vaccine_image,alt:"混合ワクチン証明書",className:"w-full h-48 object-cover rounded-lg border cursor-pointer",onClick:()=>E(y.combo_vaccine_image)}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("button",{onClick:()=>E(y.combo_vaccine_image),className:"bg-black bg-opacity-50 text-white p-1 rounded-full hover:bg-opacity-70",children:e.jsx(q,{className:"w-4 h-4"})})})]})]})]})]}),e.jsxs("div",{className:"mt-6 text-sm text-gray-500",children:["申請日: ",W(y.created_at)]})]})})}),I&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"relative max-w-4xl max-h-full",children:[e.jsx("button",{onClick:()=>E(null),className:"absolute top-4 right-4 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70",children:"×"}),e.jsx("img",{src:I,alt:"拡大画像",className:"max-w-full max-h-full object-contain"})]})})]})}):e.jsx("div",{className:"max-w-4xl mx-auto p-4",children:e.jsx(le,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(h,{className:"w-12 h-12 text-red-500 mr-4"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-red-700",children:"アクセス権限がありません"}),e.jsx("p",{className:"text-red-600",children:"このページは管理者のみアクセス可能です。"})]})]})})})}},Symbol.toStringTag,{value:"Module"})),be={pet_hotel:"ペットホテル",pet_salon:"ペットサロン",veterinary:"動物病院",pet_cafe:"ペットカフェ",pet_restaurant:"ペット同伴レストラン",pet_shop:"ペットショップ",pet_accommodation:"ペット同伴宿泊"};const ve=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const{user:s,isAdmin:a}=Y(),[r,i]=O.useState("pending"),[l,c]=O.useState([]),[o,m]=O.useState([]),[x,h]=O.useState([]),[u,j]=O.useState(!0),[f,v]=O.useState(""),[N,y]=O.useState(""),[_,w]=O.useState(!1),[S,C]=O.useState(null),[P,I]=O.useState(!1),[$,E]=O.useState(""),[A,L]=O.useState(!1),q=e=>{y(e),v(""),setTimeout(()=>y(""),5e3)},U=e=>{v(e),y(""),setTimeout(()=>v(""),8e3)};O.useEffect(()=>{a?F():U("管理者権限が必要です")},[a,s]),O.useEffect(()=>{l.length>0&&V()},[l]);const F=async()=>{try{j(!0),v("");const{data:e,error:a}=await J.from("profiles").select("*").eq("id",null==s?void 0:s.id).single(),{data:t,error:r}=await J.from("pet_facilities").select("*").order("created_at",{ascending:!1});if(r)throw r;const i=await Promise.all((t||[]).map(async e=>{const{data:s,error:a}=await J.from("facility_images").select("*").eq("facility_id",e.id).order("is_primary",{ascending:!1});return a?{...e,images:[]}:{...e,images:s||[]}}));c(i)}catch(e){U(e instanceof Error?e.message:"データの取得に失敗しました")}finally{j(!1)}},V=()=>{const e=l.filter(e=>"pending"===e.status),s=l.filter(e=>"approved"===e.status);m(e),h(s)},W=async e=>{if(window.confirm("この施設を承認してもよろしいですか？"))try{I(!0),v("");const{data:a,error:t}=await J.from("pet_facilities").update({status:"approved",approved_at:(new Date).toISOString(),approved_by:null==s?void 0:s.id}).eq("id",e).select();if(t)throw t;q("施設を承認しました。"),c(s=>s.map(s=>s.id===e?{...s,status:"approved"}:s)),w(!1),C(null)}catch(a){if(a&&"object"==typeof a){const e=a;e.message?U(`施設の承認に失敗しました: ${e.message}`):U("施設の承認に失敗しました")}else U("施設の承認に失敗しました")}finally{I(!1)}},B=async e=>{if(window.confirm("この施設を完全に削除してもよろしいですか？この操作は取り消せません。"))try{I(!0),v("");const{error:s}=await J.from("facility_images").delete().eq("facility_id",e),{data:a,error:t}=await J.from("pet_facilities").delete().eq("id",e).select();if(t)throw t;q("施設を削除しました。"),c(s=>s.filter(s=>s.id!==e)),w(!1),C(null)}catch(s){if(s&&"object"==typeof s){const e=s;e.message?U(`施設の削除に失敗しました: ${e.message}`):U("施設の削除に失敗しました")}else U("施設の削除に失敗しました")}finally{I(!1)}},G=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},X=e=>{switch(e){case"pending":return"承認待ち";case"approved":return"承認済み";case"rejected":return"却下";default:return"不明"}};return a?u?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"データを読み込み中..."})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"bg-white shadow rounded-lg mb-8",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"ペット関連施設承認管理"}),e.jsx("p",{className:"text-gray-600",children:"登録されたペット関連施設の承認・却下を管理します"})]}),f&&e.jsx("div",{className:"px-6 py-4 bg-red-50 border-l-4 border-red-400",children:e.jsxs("div",{className:"flex",children:[e.jsx(D,{className:"h-5 w-5 text-red-400 mr-2"}),e.jsx("p",{className:"text-sm text-red-700",children:f})]})}),N&&e.jsx("div",{className:"px-6 py-4 bg-green-50 border-l-4 border-green-400",children:e.jsxs("div",{className:"flex",children:[e.jsx(k,{className:"h-5 w-5 text-green-400 mr-2"}),e.jsx("p",{className:"text-sm text-green-700",children:N})]})}),e.jsx("div",{className:"px-6",children:e.jsxs("nav",{className:"flex space-x-8","aria-label":"Tabs",children:[e.jsxs("button",{onClick:()=>i("pending"),className:"whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm "+("pending"===r?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx(M,{className:"w-5 h-5 inline mr-2"}),"承認待ち",e.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:o.length})]}),e.jsxs("button",{onClick:()=>i("approved"),className:"whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm "+("approved"===r?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx(b,{className:"w-5 h-5 inline mr-2"}),"掲載中施設",e.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:x.length})]})]})})]}),"pending"===r&&e.jsx("div",{className:"space-y-6",children:0===o.length?e.jsxs(le,{className:"text-center py-12",children:[e.jsx(M,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"承認待ちの施設がありません"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:o.map(s=>e.jsx(le,{className:"overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:be[s.category_id]||s.category_id}),e.jsxs("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${G(s.status)}`,children:[e.jsx(M,{className:"w-3 h-3 mr-1"}),X(s.status)]})]})}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(g,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"truncate",children:s.address})]}),s.phone&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:s.phone})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:new Date(s.created_at).toLocaleDateString("ja-JP")})]})]}),s.images.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"grid grid-cols-3 gap-2",children:s.images.slice(0,3).map((s,a)=>e.jsx("img",{src:s.image_data,alt:`施設画像 ${a+1}`,className:"w-full h-16 object-cover rounded border"},s.id))}),s.images.length>3&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["+",s.images.length-3,"枚の画像"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(ne,{onClick:()=>{C(s),w(!0)},className:"flex-1",size:"sm",variant:"secondary",children:"詳細を確認"}),e.jsxs(ne,{onClick:()=>{W(s.id)},disabled:P,className:"flex-1 bg-green-600 hover:bg-green-700",size:"sm",children:[e.jsx(d,{className:"w-4 h-4 mr-1"}),"承認"]})]}),e.jsxs("div",{className:"flex space-x-2 mt-2",children:[e.jsxs(ne,{onClick:()=>{C(s),L(!0)},disabled:P,className:"flex-1 bg-red-600 hover:bg-red-700",size:"sm",children:[e.jsx(T,{className:"w-4 h-4 mr-1"}),"拒否"]}),e.jsxs(ne,{onClick:()=>{B(s.id)},disabled:P,className:"flex-1 bg-gray-600 hover:bg-gray-700",size:"sm",children:[e.jsx(n,{className:"w-4 h-4 mr-1"}),"削除"]})]})]})},s.id))})}),"approved"===r&&e.jsx("div",{className:"space-y-6",children:0===x.length?e.jsxs(le,{className:"text-center py-12",children:[e.jsx(b,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"掲載中の施設がありません"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:x.map(s=>e.jsx(le,{className:"overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:be[s.category_id]||s.category_id}),e.jsxs("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${G(s.status)}`,children:[e.jsx(d,{className:"w-3 h-3 mr-1"}),X(s.status)]})]})}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(g,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"truncate",children:s.address})]}),s.phone&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:s.phone})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:new Date(s.created_at).toLocaleDateString("ja-JP")})]})]}),s.images.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"grid grid-cols-3 gap-2",children:s.images.slice(0,3).map((s,a)=>e.jsx("img",{src:s.image_data,alt:`施設画像 ${a+1}`,className:"w-full h-16 object-cover rounded border"},s.id))}),s.images.length>3&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["+",s.images.length-3,"枚の画像"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(ne,{onClick:()=>{C(s),w(!0)},className:"flex-1",size:"sm",variant:"secondary",children:"詳細を確認"}),e.jsxs(ne,{onClick:()=>{B(s.id)},disabled:P,className:"flex-1 bg-red-600 hover:bg-red-700",size:"sm",children:[e.jsx(n,{className:"w-4 h-4 mr-1"}),"削除"]})]})]})},s.id))})}),_&&S&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:S.name}),e.jsx("p",{className:"text-gray-600",children:be[S.category_id]||S.category_id})]}),e.jsx("button",{onClick:()=>w(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(R,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"基本情報"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(g,{className:"w-5 h-5 text-gray-500 mr-3"}),e.jsx("span",{children:S.address})]}),S.phone&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(z,{className:"w-5 h-5 text-gray-500 mr-3"}),e.jsx("span",{children:S.phone})]}),S.website&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(t,{className:"w-5 h-5 text-gray-500 mr-3"}),e.jsx("a",{href:S.website,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800",children:S.website})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"ステータス"}),e.jsxs("div",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${G(S.status)}`,children:["pending"===S.status&&e.jsx(M,{className:"w-4 h-4 mr-2"}),"approved"===S.status&&e.jsx(d,{className:"w-4 h-4 mr-2"}),"rejected"===S.status&&e.jsx(R,{className:"w-4 h-4 mr-2"}),X(S.status)]})]})]}),S.description&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"施設紹介"}),e.jsx("p",{className:"text-gray-700 whitespace-pre-line",children:S.description})]}),S.images.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-3",children:["施設画像 (",S.images.length,"枚)"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:S.images.map((s,a)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s.image_data,alt:`施設画像 ${a+1}`,className:"w-full h-32 object-cover rounded-lg border"}),s.is_primary&&e.jsx("div",{className:"absolute top-2 left-2 bg-blue-500 text-white text-xs px-2 py-1 rounded",children:"メイン"})]},s.id))})]}),"pending"===S.status&&e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs(ne,{onClick:()=>{W(S.id)},disabled:P,className:"flex-1 bg-green-600 hover:bg-green-700",children:[e.jsx(d,{className:"w-4 h-4 mr-2"}),"承認する"]}),e.jsxs(ne,{onClick:()=>{w(!1),L(!0)},disabled:P,className:"flex-1 bg-red-600 hover:bg-red-700",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"拒否する"]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsxs(ne,{onClick:()=>{B(S.id)},disabled:P,className:"w-full bg-gray-600 hover:bg-gray-700",children:[e.jsx(n,{className:"w-4 h-4 mr-2"}),"施設を削除"]})})]})})}),A&&S&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-lg max-w-md w-full",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"施設の拒否理由を入力"}),e.jsx("button",{onClick:()=>{L(!1),E("")},className:"text-gray-400 hover:text-gray-600",children:e.jsx(R,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["施設名: ",e.jsx("span",{className:"font-medium",children:S.name})]}),e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"拒否理由を入力してください"}),e.jsx("textarea",{value:$,onChange:e=>E(e.target.value),placeholder:"拒否理由を詳しく入力してください...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",rows:4,required:!0})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(ne,{onClick:()=>{L(!1),E("")},variant:"secondary",className:"flex-1",disabled:P,children:"キャンセル"}),e.jsxs(ne,{onClick:()=>{(async(e,a)=>{try{I(!0),v("");const{data:t,error:r}=await J.from("pet_facilities").update({status:"rejected",rejection_reason:a,rejected_at:(new Date).toISOString(),rejected_by:null==s?void 0:s.id}).eq("id",e).select();if(r)throw r;q("施設を拒否しました。"),c(s=>s.map(s=>s.id===e?{...s,status:"rejected",rejection_reason:a}:s)),w(!1),L(!1),C(null),E("")}catch(t){if(t&&"object"==typeof t){const e=t;e.message?U(`施設の拒否に失敗しました: ${e.message}`):U("施設の拒否に失敗しました")}else U("施設の拒否に失敗しました")}finally{I(!1)}})(S.id,$)},disabled:P||!$.trim(),className:"flex-1 bg-red-600 hover:bg-red-700",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"拒否する"]})]})]})})})]})}):e.jsx("div",{className:"max-w-4xl mx-auto p-4",children:e.jsx(le,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(D,{className:"w-12 h-12 text-red-500 mr-4"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-red-700",children:"アクセス権限がありません"}),e.jsx("p",{className:"text-red-600",children:"このページは管理者のみアクセス可能です。"})]})]})})})}},Symbol.toStringTag,{value:"Module"}));export{X as A,ne as B,le as C,ce as I,re as M,de as S,Z as a,pe as b,ge as c,B as d,ie as e,ue as f,W as g,K as h,je as i,fe as j,ve as k,Q as l,H as p,J as s,Y as u};

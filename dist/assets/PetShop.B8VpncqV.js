var e=(e,s,a)=>new Promise(((t,l)=>{var r=e=>{try{c(a.next(e))}catch(s){l(s)}},i=e=>{try{c(a.throw(e))}catch(s){l(s)}},c=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,i);c((a=a.apply(e,s)).next())}));import{j as s,B as a,u as t,b as l,s as r,C as i}from"./index.oOj2R_C7.js";import{r as c,L as n}from"./router.icJHpBzt.js";import{I as d}from"./Input.DeZ8m3vP.js";import{u as o}from"./useStripe.C7uENATF.js";import{p as m}from"./stripe-config.03sBkt-B.js";import{o as x,r as h,b as u,ap as p,aq as j,ar as g,V as f,N as b,p as v,z as N,as as w}from"./ui.UnEvinBv.js";import"./vendor.D1SiiUJb.js";import"./supabase.CZ8ekJUM.js";import"./stripe.ONZxK9h-.js";function y({hasSubscription:t=!1,className:l="",variant:r="primary",size:i="md"}){const{createCheckoutSession:d,loading:h,error:u}=o(),[p,j]=c.useState(!1);return t?s.jsx(n,{to:"/subscription",children:s.jsxs(a,{variant:r,size:i,className:`flex items-center ${l}`,children:[s.jsx(x,{className:("sm"===i?"w-3 h-3":"w-4 h-4")+" mr-1"}),"サブスク管理"]})}):s.jsxs("div",{children:[s.jsxs(a,{onClick:()=>{e(null,null,(function*(){j(!1);const e=m.find((e=>"subscription"===e.mode));if(e)try{yield d({priceId:e.priceId,mode:"subscription",successUrl:`${window.location.origin}/dashboard?success=true`,cancelUrl:`${window.location.origin}/dashboard?canceled=true`})}catch(s){j(!0)}}))},isLoading:h,variant:"primary",size:i,className:`flex items-center bg-purple-600 hover:bg-purple-700 text-white ${l}`,children:[s.jsx(x,{className:("sm"===i?"w-3 h-3":"w-4 h-4")+" mr-1"}),"サブスクに加入"]}),p&&u&&s.jsx("div",{className:"text-xs text-red-600 mt-1",children:u})]})}function _(){const{user:o}=t(),[m,_]=c.useState([]),[C,q]=c.useState([]),[S,k]=c.useState(!0),[z,L]=c.useState(""),[F,$]=c.useState("all"),[I,P]=c.useState("name"),{isActive:O}=l(),T=[{value:"all",label:"すべて",icon:h},{value:"food",label:"ドッグフード",icon:g},{value:"treats",label:"おやつ",icon:f},{value:"toys",label:"おもちゃ",icon:b},{value:"accessories",label:"アクセサリー",icon:x},{value:"health",label:"ヘルスケア",icon:v},{value:"sheets",label:"ペットシーツ",icon:g}];c.useEffect((()=>{D()}),[o]);const D=()=>e(null,null,(function*(){try{const[e,s]=yield Promise.all([r.from("products").select("*").eq("is_active",!0).order("created_at",{ascending:!1}),o?r.from("cart_items").select("*, product:products(*)").eq("user_id",o.id):Promise.resolve({data:[]})]);if(e.error)throw e.error;_(e.data||[]),q(s.data||[])}catch(e){}finally{k(!1)}})),E=(s,a)=>e(null,null,(function*(){if(a<=0)try{const{error:e}=yield r.from("cart_items").delete().eq("id",s);if(e)throw e;yield D()}catch(e){}else try{const{error:e}=yield r.from("cart_items").update({quantity:a}).eq("id",s);if(e)throw e;yield D()}catch(e){}})),U=e=>O?Math.round(.9*e):e,A=m.filter((e=>{const s=e.name.toLowerCase().includes(z.toLowerCase())||e.description.toLowerCase().includes(z.toLowerCase())||e.brand&&e.brand.toLowerCase().includes(z.toLowerCase()),a="all"===F||e.category===F;return s&&a})).sort(((e,s)=>{switch(I){case"name":return e.name.localeCompare(s.name);case"price":return U(e.price)-U(s.price);case"category":return e.category.localeCompare(s.category);default:return new Date(s.created_at).getTime()-new Date(e.created_at).getTime()}}));return S?s.jsx("div",{className:"flex justify-center items-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsxs("h1",{className:"text-2xl font-bold flex items-center",children:[s.jsx(h,{className:"w-8 h-8 text-green-600 mr-3"}),"ペットショップ"]}),s.jsx("p",{className:"text-gray-600",children:"愛犬のための厳選商品をお届け"})]}),s.jsx(n,{to:"/cart",children:s.jsxs(a,{className:"bg-green-600 hover:bg-green-700",children:[s.jsx(u,{className:"w-4 h-4 mr-2"}),"カート (",C.reduce(((e,s)=>e+s.quantity),0),")"]})})]}),s.jsx("div",{className:"relative overflow-hidden",children:O?s.jsxs("div",{className:"bg-gradient-to-r from-purple-600 via-pink-600 to-purple-700 text-white p-8 rounded-xl shadow-2xl",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("div",{className:"bg-white/20 p-3 rounded-full",children:s.jsx(x,{className:"w-8 h-8"})}),s.jsxs("div",{children:[s.jsxs("h2",{className:"text-2xl font-bold mb-2 flex items-center",children:[s.jsx(p,{className:"w-6 h-6 mr-2"}),"サブスクリプション会員特典適用中！"]}),s.jsx("p",{className:"text-lg opacity-90",children:"全商品10%OFF + 送料無料でお買い物をお楽しみください"})]})]}),s.jsx("div",{className:"text-right",children:s.jsxs("div",{className:"bg-white/20 px-6 py-3 rounded-lg",children:[s.jsx("p",{className:"text-sm opacity-80",children:"今月の節約額"}),s.jsx("p",{className:"text-2xl font-bold",children:"¥1,200+"})]})})]}),s.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-16 -mt-16"}),s.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white/10 rounded-full -ml-12 -mb-12"})]}):s.jsxs("div",{className:"bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 text-white p-8 rounded-xl shadow-2xl",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("div",{className:"bg-white/20 p-3 rounded-full",children:s.jsx(j,{className:"w-8 h-8"})}),s.jsxs("div",{children:[s.jsxs("h2",{className:"text-2xl font-bold mb-2 flex items-center",children:[s.jsx(x,{className:"w-6 h-6 mr-2"}),"サブスク会員は全品10％OFF & 送料無料！"]}),s.jsx("p",{className:"text-lg opacity-90",children:"月額3,800円でどこでも使い放題 + ドッグラン使い放題"})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx(y,{hasSubscription:O,className:"bg-white text-purple-600 hover:bg-gray-100 font-bold px-6 py-3 text-lg"}),s.jsx("p",{className:"text-sm opacity-80 mt-2",children:"初月無料キャンペーン中"})]})]}),s.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-16 -mt-16"}),s.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white/10 rounded-full -ml-12 -mb-12"})]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsx("div",{className:"md:col-span-2",children:s.jsx(d,{label:"",value:z,onChange:e=>L(e.target.value),placeholder:"商品名、ブランド名で検索..."})}),s.jsx("div",{children:s.jsx("select",{value:F,onChange:e=>$(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",children:T.map((e=>s.jsx("option",{value:e.value,children:e.label},e.value)))})}),s.jsx("div",{children:s.jsxs("select",{value:I,onChange:e=>P(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",children:[s.jsx("option",{value:"popular",children:"人気順"}),s.jsx("option",{value:"name",children:"名前順"}),s.jsx("option",{value:"price",children:"価格の安い順"}),s.jsx("option",{value:"category",children:"カテゴリー順"})]})})]}),s.jsx("div",{className:"flex space-x-2 overflow-x-auto pb-2",children:T.map((e=>{const a=e.icon;return s.jsxs("button",{onClick:()=>$(e.value),className:"flex items-center space-x-2 px-4 py-2 rounded-lg whitespace-nowrap transition-colors "+(F===e.value?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[s.jsx(a,{className:"w-4 h-4"}),s.jsx("span",{children:e.label})]},e.value)}))}),0===A.length?s.jsxs(i,{className:"text-center py-12",children:[s.jsx(h,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"該当する商品が見つかりませんでした"})]}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:A.map((t=>{const l=(e=>{const s=C.find((s=>s.product_id===e));return s?s.quantity:0})(t.id),c=t.price,d=U(c),m=O&&d<c;return s.jsxs(i,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[s.jsxs("div",{className:"relative h-48 mb-4 -m-6 mb-4",children:[s.jsx("img",{src:t.image_url,alt:t.name,className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://images.pexels.com/photos/1108099/pexels-photo-1108099.jpeg"}}),m&&s.jsx("div",{className:"absolute top-3 left-3",children:s.jsxs("span",{className:"bg-purple-500 text-white px-2 py-1 rounded-full text-xs font-medium flex items-center",children:[s.jsx(x,{className:"w-3 h-3 mr-1"}),"10%OFF"]})}),t.stock_quantity<=5&&s.jsx("div",{className:"absolute top-3 right-3",children:s.jsxs("span",{className:"bg-red-500 text-white px-2 py-1 rounded-full text-xs font-medium",children:["残り",t.stock_quantity,"個"]})})]}),s.jsxs("div",{className:"px-6 pb-6",children:[s.jsxs("div",{className:"mb-2",children:[t.brand&&s.jsx("p",{className:"text-xs text-gray-500 mb-1",children:t.brand}),s.jsx("h3",{className:"text-lg font-semibold line-clamp-2",children:t.name})]}),s.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:t.description}),s.jsxs("div",{className:"space-y-1 text-xs text-gray-500 mb-3",children:[t.weight&&s.jsxs("p",{children:["内容量: ",t.weight,"g"]}),t.size&&s.jsxs("p",{children:["サイズ: ",t.size]}),t.age_group&&"all"!==t.age_group&&s.jsxs("p",{children:["対象年齢: ","puppy"===t.age_group?"子犬":"adult"===t.age_group?"成犬":"シニア犬"]}),t.dog_size&&"all"!==t.dog_size&&s.jsxs("p",{children:["対象サイズ: ","small"===t.dog_size?"小型犬":"medium"===t.dog_size?"中型犬":"大型犬"]})]}),s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("span",{className:"text-xl font-bold text-green-600",children:["¥",d.toLocaleString()]}),m&&s.jsxs("span",{className:"text-sm text-gray-500 line-through",children:["¥",c.toLocaleString()]})]}),O&&s.jsxs("p",{className:"text-xs text-purple-600 flex items-center",children:[s.jsx(x,{className:"w-3 h-3 mr-1"}),"サブスク会員価格"]})]}),s.jsxs("div",{className:"space-y-2",children:[l>0?s.jsxs("div",{className:"flex items-center justify-between bg-gray-50 rounded-lg p-2",children:[s.jsx("button",{onClick:()=>{const e=C.find((e=>e.product_id===t.id));e&&E(e.id,l-1)},className:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center hover:bg-gray-300 transition-colors",children:s.jsx(N,{className:"w-4 h-4"})}),s.jsx("span",{className:"font-medium",children:l}),s.jsx("button",{onClick:()=>{const e=C.find((e=>e.product_id===t.id));e&&E(e.id,l+1)},className:"w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center hover:bg-green-700 transition-colors",children:s.jsx(v,{className:"w-4 h-4"})})]}):s.jsx(a,{onClick:()=>((s,a=1)=>e(null,null,(function*(){if(o)try{const e=C.find((e=>e.product_id===s));if(e){const{error:s}=yield r.from("cart_items").update({quantity:e.quantity+a}).eq("id",e.id);if(s)throw s}else{const{error:e}=yield r.from("cart_items").insert([{user_id:o.id,product_id:s,quantity:a}]);if(e)throw e}yield D()}catch(e){}})))(t.id),className:"w-full bg-green-600 hover:bg-green-700",disabled:0===t.stock_quantity,children:0===t.stock_quantity?"在庫切れ":s.jsxs(s.Fragment,{children:[s.jsx(u,{className:"w-4 h-4 mr-2"}),"カートに追加"]})}),s.jsx(n,{to:`/shop/product/${t.id}`,children:s.jsx(a,{variant:"secondary",className:"w-full",children:"詳細を見る"})})]})]})]},t.id)}))}),s.jsx(i,{className:"bg-blue-50 border-blue-200",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(w,{className:"w-6 h-6 text-blue-600 mt-1"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"配送について"}),s.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[s.jsx("p",{children:"• 送料：全国一律¥690"}),s.jsxs("p",{children:["• ¥5,000以上のご注文で",s.jsx("span",{className:"font-medium",children:"送料無料"})]}),s.jsxs("p",{children:["• サブスク会員は",s.jsx("span",{className:"font-medium",children:"常に送料無料"})]}),s.jsx("p",{children:"• 平日14時までのご注文で翌日お届け"}),s.jsx("p",{children:"• 土日祝日も配送いたします"})]})]})]})})]})}export{_ as PetShop};

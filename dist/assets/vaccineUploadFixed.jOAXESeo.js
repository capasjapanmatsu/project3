var e=Object.defineProperty,r=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,s=(r,t,c)=>t in r?e(r,t,{enumerable:!0,configurable:!0,writable:!0,value:c}):r[t]=c,o=(e,o)=>{for(var i in o||(o={}))t.call(o,i)&&s(e,i,o[i]);if(r)for(var i of r(o))c.call(o,i)&&s(e,i,o[i]);return e},i=(e,r,t)=>new Promise((c,s)=>{var o=e=>{try{a(t.next(e))}catch(r){s(r)}},i=e=>{try{a(t.throw(e))}catch(r){s(r)}},a=e=>e.done?c(e.value):Promise.resolve(e.value).then(o,i);a((t=t.apply(e,r)).next())});import{s as a}from"./index.CQlxbczY.js";const n=(e,r,t)=>i(void 0,null,function*(){try{const c=e.name.split(".").pop()||"jpg",s=Date.now(),o=`${r}/${t}_${s}.${c}`;if(!(e instanceof File))throw new Error("Invalid file object: expected File, got "+typeof e);const{data:i,error:n}=yield a.storage.from("vaccine-certs").upload(o,e,{cacheControl:"3600",upsert:!0,contentType:e.type});if(n)return{success:!1,error:`アップロードに失敗しました: ${n.message}`};const{data:{publicUrl:l}}=a.storage.from("vaccine-certs").getPublicUrl(o);return{success:!0,filePath:o}}catch(c){return{success:!1,error:c.message}}}),l=(e,r,t,c,s)=>i(void 0,null,function*(){try{let i,l;if(r){const t=yield n(r,e,"rabies");if(!t.success)return{success:!1,error:`狂犬病ワクチン証明書: ${t.error}`};i=t.filePath}if(t){const r=yield n(t,e,"combo");if(!r.success)return{success:!1,error:`混合ワクチン証明書: ${r.error}`};l=r.filePath}const{data:u,error:f}=yield a.from("vaccine_certifications").select("id").eq("dog_id",e).maybeSingle();if(f&&"PGRST116"!==f.code)return{success:!1,error:`データベース確認エラー: ${f.message}`};const d={status:"pending"};if(i&&(d.rabies_vaccine_image=i),l&&(d.combo_vaccine_image=l),c&&(d.rabies_expiry_date=c),s&&(d.combo_expiry_date=s),u){const{error:e}=yield a.from("vaccine_certifications").update(d).eq("id",u.id);if(e)return{success:!1,error:`証明書更新エラー: ${e.message}`}}else{const{error:r}=yield a.from("vaccine_certifications").insert([o({dog_id:e},d)]);if(r)return{success:!1,error:`証明書作成エラー: ${r.message}`}}return{success:!0}}catch(i){return{success:!1,error:i.message}}});export{l as h};

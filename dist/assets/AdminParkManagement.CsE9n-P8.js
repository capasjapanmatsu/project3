var e=Object.defineProperty,s=Object.defineProperties,a=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,i=(s,a,t)=>a in s?e(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t,n=(e,s)=>{for(var a in s||(s={}))r.call(s,a)&&i(e,a,s[a]);if(t)for(var a of t(s))l.call(s,a)&&i(e,a,s[a]);return e},c=(e,t)=>s(e,a(t)),d=(e,s,a)=>new Promise(((t,r)=>{var l=e=>{try{n(a.next(e))}catch(s){r(s)}},i=e=>{try{n(a.throw(e))}catch(s){r(s)}},n=e=>e.done?t(e.value):Promise.resolve(e.value).then(l,i);n((a=a.apply(e,s)).next())}));import{u as m,s as x,j as o,C as p,B as g}from"./index.D9xag4tn.js";import{u,r as h,L as j}from"./router.BWT_vQps.js";import{I as v}from"./Input.tFQgyGuP.js";import{S as y}from"./Select.BO4O17RR.js";import{u as b}from"./useAdminData.BRCG3e5g.js";import{p as f,ad as N,F as _,a7 as w,a4 as k,ae as C,af as S,b as O,ag as L,c as P,U as $,aa as D,a2 as I,o as q,w as z,x as F}from"./ui.BPlS2KKq.js";import"./vendor.D1SiiUJb.js";import"./supabase.CZ8ekJUM.js";function E(){const{isAdmin:e}=m(),s=u(),[a,t]=h.useState("applications"),[r,l]=h.useState([]),[i,E]=h.useState([]),[T,U]=h.useState([]),[A,B]=h.useState([]),[J,G]=h.useState(!0),[H,K]=h.useState(""),[M,Q]=h.useState(""),[R,V]=h.useState(""),[W,X]=h.useState("all"),[Y,Z]=h.useState("created_at"),[ee,se]=h.useState("desc");b("parks");const ae=e=>{Q(e),K(""),setTimeout((()=>Q("")),5e3)},te=e=>{K(e),Q(""),setTimeout((()=>K("")),8e3)},re=e=>d(null,null,(function*(){if(window.confirm("このドッグラン申請を削除してもよろしいですか？この操作は取り消せません。"))try{K(""),Q("");const{error:s}=yield x.from("dog_parks").delete().eq("id",e);if(s)return void te("ドッグランの削除に失敗しました。");ae("ドッグラン申請を削除しました。"),l((s=>s.filter((s=>s.id!==e))))}catch(s){te("ドッグランの削除に失敗しました。")}}));h.useEffect((()=>{e?le():s("/")}),[e,s]),h.useEffect((()=>{r.length>0&&ie()}),[r,R,W,Y,ee]);const le=()=>d(null,null,(function*(){G(!0),K("");try{const{data:e,error:s}=yield x.from("dog_parks").select("\n          id,\n          name,\n          description,\n          address,\n          price,\n          status,\n          owner_id,\n          created_at,\n          max_capacity,\n          large_dog_area,\n          small_dog_area,\n          private_booths,\n          facilities,\n          average_rating,\n          review_count,\n          facility_details,\n          private_booth_count,\n          image_url,\n          cover_image_url,\n          profiles!owner_id (\n            name,\n            email,\n            phone_number,\n            address\n          )\n        ").order("created_at",{ascending:!1});if(s)return void te(`データの取得に失敗しました: ${s.message}`);const a=yield Promise.all((e||[]).map((e=>d(null,null,(function*(){var s,a,t,r,l,i,d,m;let o=[];if("second_stage_review"===e.status)try{const{data:s,error:a}=yield x.from("dog_park_facility_images").select("*").eq("park_id",e.id).order("created_at",{ascending:!0});a||(o=s||[])}catch(p){}return c(n({},e),{owner_name:(null==(a=null==(s=e.profiles)?void 0:s[0])?void 0:a.name)||"Unknown",owner_email:(null==(r=null==(t=e.profiles)?void 0:t[0])?void 0:r.email)||"Unknown",owner_phone:(null==(i=null==(l=e.profiles)?void 0:l[0])?void 0:i.phone_number)||"",owner_address:(null==(m=null==(d=e.profiles)?void 0:d[0])?void 0:m.address)||"",facility_images:o,facilities:e.facilities||{parking:!1,shower:!1,restroom:!1,agility:!1,rest_area:!1,water_station:!1}})})))));l(a)}catch(e){te("データの取得に失敗しました。")}finally{G(!1)}})),ie=()=>{const e=["pending","first_stage_passed","second_stage_review"],s=["approved"];let a=r.filter((e=>{const s=!R||e.name.toLowerCase().includes(R.toLowerCase())||e.address.toLowerCase().includes(R.toLowerCase())||e.owner_name.toLowerCase().includes(R.toLowerCase()),a="all"===W||e.status===W;return s&&a}));a=a.sort(((e,s)=>{let a,t;switch(Y){case"name":a=e.name,t=s.name;break;case"average_rating":a=e.average_rating||0,t=s.average_rating||0;break;default:a=e.created_at,t=s.created_at}return"asc"===ee?a>t?1:-1:a<t?1:-1}));const t=a.filter((e=>s.includes(e.status))),l=a.filter((s=>e.includes(s.status)));U(t),B(l),E(a)},ne=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"first_stage_passed":return"bg-blue-100 text-blue-800";case"second_stage_review":return"bg-purple-100 text-purple-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},ce=e=>{switch(e){case"pending":case"first_stage_passed":return"一次審査中";case"second_stage_review":return"二次審査中";case"approved":return"承認済み";case"rejected":return"却下";default:return"不明"}},de=e=>`¥${e.toLocaleString()}`,me=e=>new Date(e).toLocaleDateString("ja-JP",{year:"numeric",month:"short",day:"numeric"});return J?o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),o.jsx("p",{className:"text-gray-600",children:"データを読み込み中..."})]})}):o.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:o.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[o.jsxs("div",{className:"bg-white shadow rounded-lg mb-8",children:[o.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[o.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"ドッグラン管理"}),o.jsx("p",{className:"text-gray-600",children:"ドッグラン施設の詳細情報と申請管理"})]}),H&&o.jsx("div",{className:"px-6 py-4 bg-red-50 border-l-4 border-red-400",children:o.jsxs("div",{className:"flex",children:[o.jsx(f,{className:"h-5 w-5 text-red-400 mr-2"}),o.jsx("p",{className:"text-sm text-red-700",children:H})]})}),M&&o.jsx("div",{className:"px-6 py-4 bg-green-50 border-l-4 border-green-400",children:o.jsxs("div",{className:"flex",children:[o.jsx(N,{className:"h-5 w-5 text-green-400 mr-2"}),o.jsx("p",{className:"text-sm text-green-700",children:M})]})}),o.jsx("div",{className:"px-6",children:o.jsxs("nav",{className:"flex space-x-8","aria-label":"Tabs",children:[o.jsxs("button",{onClick:()=>t("applications"),className:"whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm "+("applications"===a?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[o.jsx(_,{className:"w-5 h-5 inline mr-2"}),"ドッグラン申請",o.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:A.length})]}),o.jsxs("button",{onClick:()=>t("parks"),className:"whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm "+("parks"===a?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[o.jsx(w,{className:"w-5 h-5 inline mr-2"}),"ドッグラン一覧",o.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:T.length})]})]})})]}),"parks"===a&&o.jsxs("div",{className:"space-y-6",children:[o.jsx(p,{className:"p-6",children:o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[o.jsxs("div",{className:"relative",children:[o.jsx(k,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),o.jsx(v,{label:"",placeholder:"施設名、住所、オーナー名で検索...",value:R,onChange:e=>V(e.target.value),className:"pl-10"})]}),o.jsx(y,{label:"",options:[{value:"all",label:"全ステータス"},{value:"approved",label:"承認済み"}],value:W,onChange:e=>X(e.target.value)}),o.jsx(y,{label:"",options:[{value:"created_at",label:"作成日時"},{value:"name",label:"施設名"},{value:"average_rating",label:"平均評価"}],value:Y,onChange:e=>Z(e.target.value)}),o.jsxs(g,{variant:"secondary",onClick:()=>se("asc"===ee?"desc":"asc"),className:"flex items-center justify-center",children:["asc"===ee?o.jsx(C,{className:"w-4 h-4 mr-2"}):o.jsx(S,{className:"w-4 h-4 mr-2"}),"asc"===ee?"昇順":"降順"]})]})}),0===T.length?o.jsxs(p,{className:"text-center py-12",children:[o.jsx(w,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),o.jsx("p",{className:"text-gray-600",children:R||"all"!==W?"条件に一致する承認済みドッグランが見つかりません":"承認済みドッグランがありません"})]}):o.jsx("div",{className:"grid grid-cols-1 gap-6",children:T.map((e=>o.jsx(p,{className:"p-6",children:o.jsxs("div",{className:"flex items-start justify-between",children:[o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),o.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${ne(e.status)}`,children:ce(e.status)})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[o.jsx(O,{className:"w-4 h-4 mr-1"}),e.address]}),o.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[o.jsx(L,{className:"w-4 h-4 mr-1"}),de(e.price)]}),o.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[o.jsx(P,{className:"w-4 h-4 mr-1"}),me(e.created_at)]})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[o.jsx($,{className:"w-4 h-4 mr-1"}),e.owner_name]}),o.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[o.jsx(D,{className:"w-4 h-4 mr-1"}),"定員: ",e.max_capacity,"頭"]}),e.average_rating&&e.average_rating>0&&o.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[o.jsx(I,{className:"w-4 h-4 mr-1"}),e.average_rating.toFixed(1)," (",e.review_count||0,"件)"]})]})]}),e.description&&o.jsx("p",{className:"text-sm text-gray-600 mb-3",children:e.description}),o.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.large_dog_area&&o.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:"大型犬エリア"}),e.small_dog_area&&o.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded",children:"小型犬エリア"}),e.private_booths&&o.jsx("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded",children:"個室あり"}),e.facilities.parking&&o.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"駐車場"}),e.facilities.shower&&o.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"シャワー"})]})]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsxs(j,{to:`/parks/${e.id}`,className:"flex items-center px-3 py-1 text-sm bg-blue-100 text-blue-800 rounded-md hover:bg-blue-200",children:[o.jsx(q,{className:"w-4 h-4 mr-1"}),"詳細"]}),o.jsxs(g,{size:"sm",variant:"secondary",onClick:()=>re(e.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[o.jsx(z,{className:"w-4 h-4 mr-1"}),"削除"]})]})]})},e.id)))})]}),"applications"===a&&o.jsxs("div",{className:"space-y-6",children:[o.jsx(p,{className:"p-6",children:o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[o.jsxs("div",{className:"relative",children:[o.jsx(k,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),o.jsx(v,{label:"",placeholder:"施設名、住所、オーナー名で検索...",value:R,onChange:e=>V(e.target.value),className:"pl-10"})]}),o.jsx(y,{label:"",options:[{value:"all",label:"全ステータス"},{value:"pending",label:"審査中"},{value:"first_stage_passed",label:"1次審査通過"},{value:"second_stage_review",label:"2次審査中"},{value:"rejected",label:"却下"}],value:W,onChange:e=>X(e.target.value)}),o.jsx(y,{label:"",options:[{value:"created_at",label:"作成日時"},{value:"name",label:"施設名"},{value:"average_rating",label:"平均評価"}],value:Y,onChange:e=>Z(e.target.value)}),o.jsxs(g,{variant:"secondary",onClick:()=>se("asc"===ee?"desc":"asc"),className:"flex items-center justify-center",children:["asc"===ee?o.jsx(C,{className:"w-4 h-4 mr-2"}):o.jsx(S,{className:"w-4 h-4 mr-2"}),"asc"===ee?"昇順":"降順"]})]})}),0===A.length?o.jsxs(p,{className:"text-center py-12",children:[o.jsx(_,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),o.jsx("p",{className:"text-gray-600",children:R||"all"!==W?"条件に一致する申請が見つかりません":"審査中の申請がありません"})]}):o.jsx("div",{className:"grid grid-cols-1 gap-6",children:A.map((e=>o.jsxs(p,{className:"p-6",children:[o.jsx("div",{className:"flex items-start justify-between mb-4",children:o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),o.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${ne(e.status)}`,children:ce(e.status)})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-4",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"申請者情報"}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[o.jsx($,{className:"w-4 h-4 mr-2"}),e.owner_name]}),o.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[o.jsx(O,{className:"w-4 h-4 mr-2"}),e.owner_address||"住所未登録"]}),o.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[o.jsx(P,{className:"w-4 h-4 mr-2"}),"申請日: ",me(e.created_at)]})]})]}),o.jsxs("div",{children:[o.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"施設情報"}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[o.jsx(O,{className:"w-4 h-4 mr-2"}),e.address]}),o.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[o.jsx(L,{className:"w-4 h-4 mr-2"}),de(e.price)]}),o.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[o.jsx(D,{className:"w-4 h-4 mr-2"}),"定員: ",e.max_capacity,"頭"]})]})]})]}),e.description&&o.jsxs("div",{className:"mb-4",children:[o.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"施設説明"}),o.jsx("p",{className:"text-sm text-gray-600",children:e.description})]}),o.jsxs("div",{className:"mb-4",children:[o.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"設備・サービス"}),o.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.large_dog_area&&o.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:"大型犬エリア"}),e.small_dog_area&&o.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded",children:"小型犬エリア"}),e.private_booths&&o.jsx("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded",children:"個室あり"}),e.facilities.parking&&o.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"駐車場"}),e.facilities.shower&&o.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"シャワー"}),e.facilities.restroom&&o.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"トイレ"}),e.facilities.agility&&o.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"アジリティ"}),e.facilities.rest_area&&o.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"休憩エリア"}),e.facilities.water_station&&o.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"給水設備"})]})]}),"second_stage_review"===e.status&&e.facility_images&&e.facility_images.length>0&&o.jsxs("div",{className:"mb-4",children:[o.jsxs("h4",{className:"font-medium text-gray-900 mb-2",children:["設備画像 (",e.facility_images.length,"枚)"]}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:e.facility_images.map(((e,s)=>o.jsxs("div",{className:"relative",children:[o.jsx("img",{src:e.image_url,alt:`設備画像 ${s+1}`,className:"w-full h-24 object-cover rounded-md border"}),o.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded-b-md",children:e.image_type})]},e.id)))})]})]})}),o.jsxs("div",{className:"flex justify-end space-x-2",children:[("pending"===e.status||"first_stage_passed"===e.status||"second_stage_review"===e.status)&&o.jsxs(o.Fragment,{children:[o.jsxs(g,{size:"sm",onClick:()=>{return s=e.id,d(null,null,(function*(){if(window.confirm("このドッグラン申請を承認してもよろしいですか？"))try{K(""),Q("");const{error:e}=yield x.from("dog_parks").update({status:"approved"}).eq("id",s);if(e)return void te("承認の処理に失敗しました。");const a=r.find((e=>e.id===s));a&&(yield x.from("notifications").insert([{user_id:a.owner_id,title:"ドッグラン申請承認",message:`${a.name}の申請が承認されました。おめでとうございます！`,type:"park_approved",created_at:(new Date).toISOString(),read:!1}])),ae("ドッグラン申請を承認しました。"),l((e=>e.map((e=>e.id===s?c(n({},e),{status:"approved"}):e))))}catch(e){te("承認の処理に失敗しました。")}}));var s},className:"bg-green-600 hover:bg-green-700",children:[o.jsx(N,{className:"w-4 h-4 mr-1"}),"承認"]}),o.jsxs(g,{size:"sm",variant:"secondary",onClick:()=>{return s=e.id,d(null,null,(function*(){if(window.confirm("このドッグラン申請を却下してもよろしいですか？"))try{K(""),Q("");const{error:e}=yield x.from("dog_parks").update({status:"rejected"}).eq("id",s);if(e)return void te("却下の処理に失敗しました。");const a=r.find((e=>e.id===s));a&&(yield x.from("notifications").insert([{user_id:a.owner_id,title:"ドッグラン申請却下",message:`${a.name}の申請が却下されました。詳細については管理者までお問い合わせください。`,type:"park_rejected",created_at:(new Date).toISOString(),read:!1}])),ae("ドッグラン申請を却下しました。"),l((e=>e.map((e=>e.id===s?c(n({},e),{status:"rejected"}):e))))}catch(e){te("却下の処理に失敗しました。")}}));var s},className:"text-red-600 hover:text-red-700",children:[o.jsx(F,{className:"w-4 h-4 mr-1"}),"却下"]})]}),o.jsxs(g,{size:"sm",variant:"secondary",onClick:()=>re(e.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[o.jsx(z,{className:"w-4 h-4 mr-1"}),"削除"]})]})]},e.id)))})]})]})})}export{E as AdminParkManagement};

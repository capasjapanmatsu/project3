var e=Object.defineProperty,s=Object.defineProperties,t=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,n=(s,t,a)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,l=(e,s)=>{for(var t in s||(s={}))r.call(s,t)&&n(e,t,s[t]);if(a)for(var t of a(s))i.call(s,t)&&n(e,t,s[t]);return e},o=(e,a)=>s(e,t(a)),d=(e,s)=>{var t={};for(var n in e)r.call(e,n)&&s.indexOf(n)<0&&(t[n]=e[n]);if(null!=e&&a)for(var n of a(e))s.indexOf(n)<0&&i.call(e,n)&&(t[n]=e[n]);return t},c=(e,s,t)=>new Promise((a,r)=>{var i=e=>{try{l(t.next(e))}catch(s){r(s)}},n=e=>{try{l(t.throw(e))}catch(s){r(s)}},l=e=>e.done?a(e.value):Promise.resolve(e.value).then(i,n);l((t=t.apply(e,s)).next())});import{j as m,C as u,B as g,s as x,u as h,b as p}from"./index.CQlxbczY.js";import{d as b,r as f}from"./vendor.CKEClKZl.js";import{L as v,u as j,a as N}from"./router.B_7Atevv.js";import{D as y,a as w}from"./DogCard.C4vAyVq8.js";import{p as _,B as S,t as E,g as k,n as D,u as T,i as I,v as O,F as L,w as A,A as P,C,X as R,r as U,x as M,o as V,b as F,U as $,j as q,y as B,c as J}from"./ui.C72fRZ1L.js";import{h as Y}from"./vaccineUploadFixed.jOAXESeo.js";import"./supabase.X3H3st79.js";import"./dogBreeds.6lxY8Uni.js";import"./Input.DMWrIIWM.js";import"./Select.DfMWSl4f.js";import"./VaccineBadge.RvE4iloV.js";const z=({dogs:e,user:s,selectedDog:t,showDogEditModal:a,isUpdatingDog:r,dogUpdateError:i,dogUpdateSuccess:n,dogFormData:l,dogImageFile:o,dogImagePreview:d,rabiesVaccineFile:c,comboVaccineFile:g,rabiesExpiryDate:x,comboExpiryDate:h,onDogSelect:p,onCloseDogEditModal:b,onUpdateDog:f,onDeleteDog:v,onDogImageSelect:j,onDogImageRemove:N,onRabiesVaccineSelect:S,onComboVaccineSelect:E,onFormDataChange:k,onRabiesExpiryDateChange:D,onComboExpiryDateChange:T})=>m.jsxs(u,{className:"p-6",children:[m.jsxs("div",{className:"flex justify-between items-center mb-6",children:[m.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[m.jsx("span",{className:"mr-2",children:"🐕"}),"登録済みの愛犬"]}),m.jsxs("a",{href:"/register-dog",className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1.5 rounded-md text-sm font-medium inline-flex items-center",children:[m.jsx(_,{className:"w-4 h-4 mr-2"}),"愛犬を登録"]})]}),0===e.length?m.jsxs("div",{className:"text-center py-8 text-gray-500",children:[m.jsx("div",{className:"text-6xl mb-4",children:"🐕"}),m.jsx("p",{className:"text-lg font-medium mb-2",children:"まだ愛犬が登録されていません"}),m.jsx("p",{className:"text-sm mb-4",children:"ドッグランを利用するために、愛犬の情報を登録してください"}),m.jsxs("a",{href:"/register-dog",className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md font-medium inline-flex items-center",children:[m.jsx(_,{className:"w-4 h-4 mr-2"}),"愛犬を登録"]})]}):m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:e.map(e=>m.jsx(y,{dog:e,onEdit:()=>p(e)},e.id))}),a&&t&&m.jsx(w,{dog:t,isUpdating:r,error:i,success:n,dogFormData:l,dogImagePreview:d,onClose:b,onSubmit:f,onDelete:v,onFormChange:k,onImageSelect:j,onImageRemove:N,rabiesVaccineFile:c,comboVaccineFile:g,rabiesExpiryDate:x,comboExpiryDate:h,onRabiesVaccineSelect:S,onComboVaccineSelect:E,onRabiesExpiryDateChange:D,onComboExpiryDateChange:T})]}),G=({notifications:e,onMarkAsRead:s})=>{const t=e=>{switch(e){case"reservation":return m.jsx(I,{className:"w-4 h-4 text-blue-600"});case"message":return m.jsx(T,{className:"w-4 h-4 text-green-600"});case"park_approval":return m.jsx(D,{className:"w-4 h-4 text-purple-600"});case"vaccine_approval":return m.jsx(k,{className:"w-4 h-4 text-green-600"});default:return m.jsx(S,{className:"w-4 h-4 text-gray-600"})}};return m.jsxs(u,{className:"p-6",children:[m.jsxs("div",{className:"flex justify-between items-center mb-6",children:[m.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[m.jsx(S,{className:"w-5 h-5 mr-2"}),"通知",e.length>0&&m.jsx("span",{className:"ml-2 bg-red-500 text-white text-xs rounded-full px-2 py-1",children:e.length})]}),e.length>0&&m.jsxs(g,{size:"sm",className:"bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>{e.forEach(e=>{s(e.id)})},children:[m.jsx(E,{className:"w-4 h-4 mr-2"}),"すべて既読にする"]})]}),0===e.length?m.jsxs("div",{className:"text-center py-8 text-gray-500",children:[m.jsx("div",{className:"text-4xl mb-4",children:"🔔"}),m.jsx("p",{className:"text-lg font-medium mb-2",children:"新しい通知はありません"}),m.jsx("p",{className:"text-sm",children:"最新の情報やお知らせがあるとここに表示されます"})]}):m.jsx("div",{className:"space-y-4",children:e.map(e=>m.jsxs("div",{className:"flex items-start space-x-3 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[m.jsx("div",{className:"flex-shrink-0 mt-1",children:t(e.type)}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsx("h3",{className:"font-medium text-gray-900 truncate",children:e.title}),m.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.message}),m.jsx("p",{className:"text-xs text-gray-500 mt-2",children:new Date(e.created_at).toLocaleString("ja-JP")})]}),m.jsx("div",{className:"flex-shrink-0",children:m.jsx(g,{size:"sm",onClick:()=>s(e.id),className:"bg-blue-600 hover:bg-blue-700 text-white",children:m.jsx(E,{className:"w-4 h-4"})})})]},e.id))})]})};function H({park:e,onSelect:s}){return m.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",onClick:t=>{t.target.closest(".detail-button")||s(e)},children:[m.jsxs("div",{className:"flex justify-between items-start mb-2",children:[m.jsxs("div",{children:[m.jsx("h3",{className:"font-semibold",children:e.name}),m.jsx("p",{className:"text-sm text-gray-600",children:e.address}),m.jsxs("div",{className:"flex items-center space-x-4 mt-2",children:[m.jsxs("div",{className:"flex items-center space-x-1",children:[m.jsx(O,{className:"w-4 h-4 text-yellow-400 fill-current"}),m.jsx("span",{className:"text-sm",children:e.average_rating.toFixed(1)})]}),m.jsxs("span",{className:"text-sm text-gray-500",children:[e.review_count,"件のレビュー"]})]})]}),m.jsxs("div",{className:"flex items-center space-x-2",children:[K(e.status),"second_stage_waiting"===e.status?m.jsx(v,{to:`/parks/${e.id}/second-stage`,className:"detail-button",children:m.jsxs(g,{size:"sm",className:"bg-orange-600 hover:bg-orange-700 text-white",children:[m.jsx(L,{className:"w-4 h-4 mr-1"}),"申し込み"]})}):"approved"===e.status?m.jsx(v,{to:`/parks/${e.id}/manage`,className:"detail-button",children:m.jsx(g,{size:"sm",className:"bg-blue-50 hover:bg-blue-100 text-blue-600 border-0",children:m.jsx(A,{className:"w-4 h-4"})})}):m.jsx(g,{size:"sm",className:"bg-blue-50 hover:bg-blue-100 text-blue-600 border-0 detail-button",children:m.jsx(A,{className:"w-4 h-4"})})]})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600",children:[m.jsxs("div",{children:["料金: ¥",e.price,"/日"]}),m.jsxs("div",{children:["収容人数: ",e.max_capacity,"人"]}),m.jsxs("div",{children:["現在の利用者: ",e.current_occupancy,"人"]}),m.jsxs("div",{children:["レビュー: ★",e.average_rating.toFixed(1)]})]}),"pending"===e.status&&m.jsxs("div",{className:"mt-3 p-2 bg-yellow-50 rounded text-sm text-yellow-800",children:[m.jsx(P,{className:"w-4 h-4 inline mr-1"}),"管理者による承認をお待ちください"]}),"first_stage_passed"===e.status&&m.jsxs("div",{className:"mt-3 p-2 bg-blue-50 rounded text-sm text-blue-800",children:[m.jsx(k,{className:"w-4 h-4 inline mr-1"}),"第一審査通過！第二審査の詳細情報を入力してください"]}),"second_stage_review"===e.status&&m.jsxs("div",{className:"mt-3 p-2 bg-purple-50 rounded text-sm text-purple-800",children:[m.jsx(C,{className:"w-4 h-4 inline mr-1"}),"第二審査中です。審査完了までお待ちください"]}),"second_stage_waiting"===e.status&&m.jsxs("div",{className:"mt-3 p-2 bg-orange-50 rounded text-sm text-orange-800",children:[m.jsx(k,{className:"w-4 h-4 inline mr-1"}),"第一審査通過！第二審査の申し込みが可能です"]})]})}function K(e){return m.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${{pending:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",confirmed:"bg-blue-100 text-blue-800",cancelled:"bg-gray-100 text-gray-800",first_stage_passed:"bg-blue-100 text-blue-800",second_stage_waiting:"bg-orange-100 text-orange-800",second_stage_review:"bg-purple-100 text-purple-800",qr_testing:"bg-orange-100 text-orange-800"}[e]||"bg-gray-100 text-gray-800"}`,children:{pending:"承認待ち",approved:"承認済み",rejected:"却下",confirmed:"確定",cancelled:"キャンセル",first_stage_passed:"第一審査通過",second_stage_waiting:"二次審査申し込み",second_stage_review:"第二審査中",qr_testing:"QR検査中"}[e]||e})}function W({park:e,onClose:s}){return m.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:m.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:m.jsxs("div",{className:"p-6",children:[m.jsxs("div",{className:"flex justify-between items-center mb-6",children:[m.jsxs("h2",{className:"text-xl font-bold",children:[e.name,"の管理"]}),m.jsx("button",{onClick:s,className:"text-gray-500 hover:text-gray-700",children:m.jsx(R,{className:"w-6 h-6"})})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[m.jsxs("div",{children:[m.jsx("h3",{className:"font-semibold mb-3",children:"基本情報"}),m.jsxs("div",{className:"space-y-2 text-sm",children:[m.jsxs("p",{children:[m.jsx("span",{className:"font-medium",children:"住所:"})," ",e.address]}),m.jsxs("p",{children:[m.jsx("span",{className:"font-medium",children:"ステータス:"})," ",K(e.status)]}),m.jsxs("p",{children:[m.jsx("span",{className:"font-medium",children:"料金:"})," ¥",e.price,"/日"]}),m.jsxs("p",{children:[m.jsx("span",{className:"font-medium",children:"最大収容人数:"})," ",e.max_capacity,"人"]}),m.jsxs("p",{children:[m.jsx("span",{className:"font-medium",children:"現在の利用者数:"})," ",e.current_occupancy,"人"]}),m.jsxs("p",{children:[m.jsx("span",{className:"font-medium",children:"評価:"})," ★",e.average_rating.toFixed(1)," (",e.review_count,"件)"]})]})]}),m.jsxs("div",{children:[m.jsx("h3",{className:"font-semibold mb-3",children:"設備情報"}),m.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries({parking:"駐車場",shower:"シャワー設備",restroom:"トイレ",agility:"アジリティ設備",rest_area:"休憩スペース",water_station:"給水設備"}).map(([s,t])=>m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx("div",{className:"w-4 h-4 rounded "+(e.facilities[s]?"bg-green-500":"bg-gray-300")}),m.jsx("span",{className:"text-sm",children:t})]},s))})]})]}),"first_stage_passed"===e.status&&m.jsx("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg",children:m.jsxs("div",{className:"flex items-start space-x-3",children:[m.jsx(k,{className:"w-5 h-5 text-blue-600 mt-1 flex-shrink-0"}),m.jsxs("div",{children:[m.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"第一審査通過"}),m.jsx("p",{className:"text-sm text-blue-800 mb-3",children:"おめでとうございます！第一審査に通過しました。次は詳細な施設情報と画像のアップロードが必要です。"}),m.jsx(v,{to:`/parks/${e.id}/second-stage`,children:m.jsx(g,{className:"bg-blue-600 hover:bg-blue-700",children:"第二審査を進める"})})]})]})}),"second_stage_review"===e.status&&m.jsx("div",{className:"mb-6 p-4 bg-purple-50 rounded-lg",children:m.jsxs("div",{className:"flex items-start space-x-3",children:[m.jsx(C,{className:"w-5 h-5 text-purple-600 mt-1 flex-shrink-0"}),m.jsxs("div",{children:[m.jsx("h3",{className:"font-semibold text-purple-900 mb-2",children:"第二審査中"}),m.jsx("p",{className:"text-sm text-purple-800",children:"現在、管理者が施設画像を確認しています。審査完了までお待ちください。 審査には通常3-5営業日かかります。結果はメールとアプリ内通知でお知らせします。"})]})]})}),"approved"===e.status&&m.jsxs("div",{className:"mb-6",children:[m.jsx("h3",{className:"font-semibold mb-3",children:"統計情報"}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[m.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[m.jsx("div",{className:"flex items-center space-x-2 mb-2",children:m.jsx("h4",{className:"font-medium text-blue-900",children:"今月の予約"})}),m.jsx("p",{className:"text-2xl font-bold text-blue-600",children:"32件"}),m.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"前月比 +12%"})]}),m.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[m.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[m.jsx(Q,{className:"w-5 h-5 text-green-600"}),m.jsx("h4",{className:"font-medium text-green-900",children:"今月の収益"})]}),m.jsx("p",{className:"text-2xl font-bold text-green-600",children:"¥25,600"}),m.jsx("p",{className:"text-xs text-green-700 mt-1",children:"前月比 +8%"})]}),m.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[m.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[m.jsx(X,{className:"w-5 h-5 text-purple-600"}),m.jsx("h4",{className:"font-medium text-purple-900",children:"利用者数"})]}),m.jsx("p",{className:"text-2xl font-bold text-purple-600",children:"128人"}),m.jsx("p",{className:"text-xs text-purple-700 mt-1",children:"前月比 +15%"})]})]})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:["approved"===e.status&&m.jsx(v,{to:`/parks/${e.id}`,children:m.jsxs(g,{className:"w-full bg-white hover:bg-gray-50 border border-gray-300 text-gray-700",children:[m.jsx(U,{className:"w-4 h-4 mr-2"}),"公開ページを見る"]})}),"approved"===e.status&&m.jsx(v,{to:"/owner-payment-system",children:m.jsxs(g,{className:"w-full bg-white hover:bg-gray-50 border border-gray-300 text-gray-700",children:[m.jsx(M,{className:"w-4 h-4 mr-2"}),"収益レポート"]})}),"second_stage_review"===e.status?m.jsx("div",{className:"w-full text-center py-3 text-gray-600 text-sm bg-gray-50 rounded border",children:"審査中のため操作できません"}):m.jsx(v,{to:"first_stage_passed"===e.status||"second_stage_waiting"===e.status?`/parks/${e.id}/second-stage`:`/parks/${e.id}/manage`,children:m.jsx(g,{className:"w-full",children:"first_stage_passed"===e.status||"second_stage_waiting"===e.status?m.jsxs(m.Fragment,{children:[m.jsx(Z,{className:"w-4 h-4 mr-2"}),"second_stage_waiting"===e.status?"第二審査を申し込む":"第二審査を進める"]}):m.jsxs(m.Fragment,{children:[m.jsx(A,{className:"w-4 h-4 mr-2"}),"approved"===e.status?"設定を編集":"詳細を見る"]})})})]})]})})})}function Q({className:e}){return m.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,children:[m.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),m.jsx("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]})}function X({className:e}){return m.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,children:[m.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),m.jsx("circle",{cx:"9",cy:"7",r:"4"}),m.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),m.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]})}function Z({className:e}){return m.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,children:[m.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),m.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}const ee=e=>{let s;const t=new Set,a=(e,a)=>{const r="function"==typeof e?e(s):e;if(!Object.is(r,s)){const e=s;s=(null!=a?a:"object"!=typeof r||null===r)?r:Object.assign({},s,r),t.forEach(t=>t(s,e))}},r=()=>s,i={setState:a,getState:r,getInitialState:()=>n,subscribe:e=>(t.add(e),()=>t.delete(e))},n=s=e(a,r,i);return i},se=e=>e;const te=e=>{const s=(e=>e?ee(e):ee)(e),t=e=>function(e,s=se){const t=b.useSyncExternalStore(e.subscribe,()=>s(e.getState()),()=>s(e.getInitialState()));return b.useDebugValue(t),t}(s,e);return Object.assign(t,s),t},ae=e=>e?te(e):te,re={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_GOOGLE_MAPS_API_KEY:"AIzaSyC9sxGamDZmdKIz3vP1CWLJORl-QkoWgHg",VITE_NETLIFY_API_KEY:"your_netlify_api_key",VITE_PAYPAY_API_KEY:"",VITE_PAYPAY_MERCHANT_ID:"",VITE_PAYPAY_SECRET_KEY:"",VITE_STRIPE_PUBLIC_KEY:"pk_live_51RYUXtAHWLDQ7ynZJ2Rse439JRUesTrISQjlUpQLJs4RKprLygju98sbPHbhXwSixvYxo2pyo1c5uo4j93pQieSt00z0re16rJ",VITE_SUPABASE_ANON_KEY:"",VITE_SUPABASE_JWT_SECRET:"",VITE_SUPABASE_SERVICE_ROLE_KEY:"",VITE_SUPABASE_URL:""},ie=new Map,ne=e=>{const s=ie.get(e);return s?Object.fromEntries(Object.entries(s.stores).map(([e,s])=>[e,s.getState()])):{}},le=e=>{var s,t;if(!e)return;const a=e.split("\n"),r=a.findIndex(e=>e.includes("api.setState"));if(r<0)return;const i=(null==(s=a[r+1])?void 0:s.trim())||"";return null==(t=/.+ (.+) .+/.exec(i))?void 0:t[1]},oe=(e,s={})=>(t,a,r)=>{const i=s,{enabled:n,anonymousActionType:c,store:m}=i,u=d(i,["enabled","anonymousActionType","store"]);let g;try{g=(null!=n?n:"production"!==(re?"production":void 0))&&window.__REDUX_DEVTOOLS_EXTENSION__}catch(j){}if(!g)return e(t,a,r);const x=((e,s,t)=>{if(void 0===e)return{type:"untracked",connection:s.connect(t)};const a=ie.get(t.name);if(a)return l({type:"tracked",store:e},a);const r={connection:s.connect(t),stores:{}};return ie.set(t.name,r),l({type:"tracked",store:e},r)})(m,g,u),{connection:h}=x,p=d(x,["connection"]);let b=!0;r.setState=(e,s,i)=>{const n=t(e,s);if(!b)return n;const d=void 0===i?{type:c||le((new Error).stack)||"anonymous"}:"string"==typeof i?{type:i}:i;return void 0===m?(null==h||h.send(d,a()),n):(null==h||h.send(o(l({},d),{type:`${m}/${d.type}`}),o(l({},ne(u.name)),{[m]:r.getState()})),n)},r.devtools={cleanup:()=>{h&&"function"==typeof h.unsubscribe&&h.unsubscribe(),((e,s)=>{if(void 0===s)return;const t=ie.get(e);t&&(delete t.stores[s],0===Object.keys(t.stores).length&&ie.delete(e))})(u.name,m)}};const f=(...e)=>{const s=b;b=!1,t(...e),b=s},v=e(r.setState,a,r);if("untracked"===p.type?null==h||h.init(v):(p.stores[p.store]=r,null==h||h.init(Object.fromEntries(Object.entries(p.stores).map(([e,s])=>[e,e===p.store?v:s.getState()])))),r.dispatchFromDevtools&&"function"==typeof r.dispatch){let e=!1;const s=r.dispatch;r.dispatch=(...t)=>{"production"===(re?"production":void 0)||"__setState"!==t[0].type||e||(e=!0),s(...t)}}return h.subscribe(e=>{var s;switch(e.type){case"ACTION":if("string"!=typeof e.payload)return;return de(e.payload,e=>{if("__setState"===e.type){if(void 0===m)return void f(e.state);Object.keys(e.state).length;const s=e.state[m];if(null==s)return;return void(JSON.stringify(r.getState())!==JSON.stringify(s)&&f(s))}r.dispatchFromDevtools&&"function"==typeof r.dispatch&&r.dispatch(e)});case"DISPATCH":switch(e.payload.type){case"RESET":return f(v),void 0===m?null==h?void 0:h.init(r.getState()):null==h?void 0:h.init(ne(u.name));case"COMMIT":return void 0===m?void(null==h||h.init(r.getState())):null==h?void 0:h.init(ne(u.name));case"ROLLBACK":return de(e.state,e=>{if(void 0===m)return f(e),void(null==h||h.init(r.getState()));f(e[m]),null==h||h.init(ne(u.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return de(e.state,e=>{void 0!==m?JSON.stringify(r.getState())!==JSON.stringify(e[m])&&f(e[m]):f(e)});case"IMPORT_STATE":{const{nextLiftedState:t}=e.payload,a=null==(s=t.computedStates.slice(-1)[0])?void 0:s.state;if(!a)return;return f(void 0===m?a:a[m]),void(null==h||h.send(null,t))}case"PAUSE_RECORDING":return b=!b}return}}),v},de=(e,s)=>{let t;try{t=JSON.parse(e)}catch(a){}void 0!==t&&s(t)};function ce(e,s){let t;try{t=e()}catch(a){return}return{getItem:e=>{var s;const a=e=>null===e?null:JSON.parse(e,void 0),r=null!=(s=t.getItem(e))?s:null;return r instanceof Promise?r.then(a):a(r)},setItem:(e,s)=>t.setItem(e,JSON.stringify(s,void 0)),removeItem:e=>t.removeItem(e)}}const me=e=>s=>{try{const t=e(s);return t instanceof Promise?t:{then:e=>me(e)(t),catch(e){return this}}}catch(t){return{then(e){return this},catch:e=>me(e)(t)}}},ue=(e,s)=>(t,a,r)=>{let i=l({storage:ce(()=>localStorage),partialize:e=>e,version:0,merge:(e,s)=>l(l({},s),e)},s),n=!1;const o=new Set,d=new Set;let c=i.storage;if(!c)return e((...e)=>{t(...e)},a,r);const m=()=>{const e=i.partialize(l({},a()));return c.setItem(i.name,{state:e,version:i.version})},u=r.setState;r.setState=(e,s)=>{u(e,s),m()};const g=e((...e)=>{t(...e),m()},a,r);let x;r.getInitialState=()=>g;const h=()=>{var e,s;if(!c)return;n=!1,o.forEach(e=>{var s;return e(null!=(s=a())?s:g)});const r=(null==(s=i.onRehydrateStorage)?void 0:s.call(i,null!=(e=a())?e:g))||void 0;return me(c.getItem.bind(c))(i.name).then(e=>{if(e){if("number"!=typeof e.version||e.version===i.version)return[!1,e.state];if(i.migrate){const s=i.migrate(e.state,e.version);return s instanceof Promise?s.then(e=>[!0,e]):[!0,s]}}return[!1,void 0]}).then(e=>{var s;const[r,n]=e;if(x=i.merge(n,null!=(s=a())?s:g),t(x,!0),r)return m()}).then(()=>{null==r||r(x,void 0),x=a(),n=!0,d.forEach(e=>e(x))}).catch(e=>{null==r||r(void 0,e)})};return r.persist={setOptions:e=>{i=l(l({},i),e),e.storage&&(c=e.storage)},clearStorage:()=>{null==c||c.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>h(),hasHydrated:()=>n,onHydrate:e=>(o.add(e),()=>{o.delete(e)}),onFinishHydration:e=>(d.add(e),()=>{d.delete(e)})},i.skipHydration||h(),x||g},ge=ae()(oe(ue((e,s)=>({user:null,isAuthenticated:!1,isLoading:!0,setUser:s=>e({user:s,isAuthenticated:!!s},!1,"setUser"),setLoading:s=>e({isLoading:s},!1,"setLoading"),login:(t,a)=>c(void 0,null,function*(){e({isLoading:!0},!1,"login/start");try{const{data:r,error:i}=yield x.auth.signInWithPassword({email:t,password:a});if(i)throw i;if(r.user){const{data:t}=yield x.from("profiles").select("name, role").eq("id",r.user.id).single(),a={id:r.user.id,email:r.user.email||"",name:null==t?void 0:t.name,role:(null==t?void 0:t.role)||"user"};return s().setUser(a),e({isLoading:!1},!1,"login/success"),!0}return e({isLoading:!1},!1,"login/failed"),!1}catch(r){return e({isLoading:!1},!1,"login/error"),!1}}),logout:()=>c(void 0,null,function*(){e({isLoading:!0},!1,"logout/start");try{yield x.auth.signOut(),e({user:null,isAuthenticated:!1,isLoading:!1},!1,"logout/success")}catch(s){e({isLoading:!1},!1,"logout/error")}}),checkAuth:()=>c(void 0,null,function*(){e({isLoading:!0},!1,"checkAuth/start");try{const{data:{session:e}}=yield x.auth.getSession();if(null==e?void 0:e.user){const{data:t}=yield x.from("profiles").select("name, role").eq("id",e.user.id).single(),a={id:e.user.id,email:e.user.email||"",name:null==t?void 0:t.name,role:(null==t?void 0:t.role)||"user"};s().setUser(a)}else s().setUser(null)}catch(t){s().setUser(null)}finally{e({isLoading:!1},!1,"checkAuth/complete")}}),updateProfile:t=>c(void 0,null,function*(){const{user:a}=s();if(!a)return!1;try{const{error:s}=yield x.from("profiles").update(t).eq("id",a.id);if(s)throw s;return e({user:l(l({},a),t)},!1,"updateProfile"),!0}catch(r){return!1}})}),{name:"auth-store",partialize:e=>({user:e.user,isAuthenticated:e.isAuthenticated})}),{name:"auth-store"})),xe=ae()(oe((e,s)=>({isGlobalLoading:!1,loadingTasks:new Set,notifications:[],activeModal:null,isMenuOpen:!1,activeTab:"",theme:"light",isMobile:!1,isTablet:!1,setGlobalLoading:s=>e({isGlobalLoading:s},!1,"setGlobalLoading"),addLoadingTask:s=>e(e=>({loadingTasks:new Set([...e.loadingTasks,s]),isGlobalLoading:!0}),!1,"addLoadingTask"),removeLoadingTask:s=>e(e=>{const t=new Set(e.loadingTasks);return t.delete(s),{loadingTasks:t,isGlobalLoading:t.size>0}},!1,"removeLoadingTask"),addNotification:t=>{const a=Date.now().toString(),r=o(l({},t),{id:a});e(e=>({notifications:[...e.notifications,r]}),!1,"addNotification");const i=t.duration||5e3;setTimeout(()=>{s().removeNotification(a)},i)},removeNotification:s=>e(e=>({notifications:e.notifications.filter(e=>e.id!==s)}),!1,"removeNotification"),clearNotifications:()=>e({notifications:[]},!1,"clearNotifications"),showModal:s=>{const t=Date.now().toString();e({activeModal:o(l({},s),{id:t})},!1,"showModal")},hideModal:()=>e({activeModal:null},!1,"hideModal"),setMenuOpen:s=>e({isMenuOpen:s},!1,"setMenuOpen"),setActiveTab:s=>e({activeTab:s},!1,"setActiveTab"),setTheme:s=>{e({theme:s},!1,"setTheme"),document.documentElement.className=s},toggleTheme:()=>{const e="light"===s().theme?"dark":"light";s().setTheme(e)},setDeviceType:(s,t)=>e({isMobile:s,isTablet:t},!1,"setDeviceType")}),{name:"ui-store"}));function he(){const{user:e,logout:s,isAdmin:t}=h(),a=j(),r=N(),{user:i,setUser:n,updateProfile:l}=ge(),{setGlobalLoading:o,addNotification:d,removeNotification:g,isGlobalLoading:b}=xe(),[y,w]=f.useState(null),[_,E]=f.useState([]),[T,I]=f.useState([]),[O,L]=f.useState([]),[A,P]=f.useState([]),[C,R]=f.useState([]),[U,M]=f.useState([]),[K,Q]=f.useState(!0),[X,Z]=f.useState(!1),[ee,se]=f.useState(""),[te,ae]=f.useState(""),[re,ie]=f.useState(null),[ne,le]=f.useState(!1),[oe,de]=f.useState(null),[ce,me]=f.useState(!1),[ue,he]=f.useState(!1),[pe,be]=f.useState({name:"",breed:"",gender:"",birthDate:""}),[fe,ve]=f.useState(null),[je,Ne]=f.useState(null),[ye,we]=f.useState(null),[_e,Se]=f.useState(null),[Ee,ke]=f.useState(""),[De,Te]=f.useState("");p();const Ie=()=>c(this,null,function*(){try{o(!0),Q(!0);const[t,a,r,l,c,m]=yield Promise.all([x.from("profiles").select("*").eq("id",null==e?void 0:e.id).single(),x.from("dogs").select("*, vaccine_certifications(*)").eq("owner_id",null==e?void 0:e.id).order("created_at",{ascending:!1}),x.from("dog_parks").select("*").eq("owner_id",null==e?void 0:e.id).order("created_at",{ascending:!1}),x.from("reservations").select("*, dog_park:dog_parks(*), dog:dogs(*)").eq("user_id",null==e?void 0:e.id).order("created_at",{ascending:!1}).limit(5),x.from("notifications").select("*").eq("user_id",null==e?void 0:e.id).eq("read",!1).order("created_at",{ascending:!1}).limit(5),x.from("news_announcements").select("*").order("created_at",{ascending:!1}).limit(3)]);let u=[];try{const s=yield x.from("dog_likes").select("\n            *,\n            dog:dogs(\n              *,\n              vaccine_certifications(*)\n            )\n          ").eq("user_id",null==e?void 0:e.id).order("created_at",{ascending:!1}).limit(10);s.data&&(u=s.data)}catch(s){}[t,a,r,l,c,m].forEach((e,s)=>{e.error&&d({type:"error",title:"データ取得エラー",message:"一部のデータの取得に失敗しました",duration:5e3})}),w(t.data),E(a.data||[]),I(r.data||[]),L(l.data||[]),P(c.data||[]),R(m.data||[]),M(u.map(e=>e.dog).filter(Boolean)),t.data&&!i&&n({id:(null==e?void 0:e.id)||"",email:(null==e?void 0:e.email)||"",name:t.data.name,role:t.data.user_type||"user"})}catch(t){se("データの取得に失敗しました。ページを再読み込みしてください。"),d({type:"error",title:"エラー",message:"データの取得に失敗しました",duration:5e3})}finally{Q(!1),o(!1)}});f.useEffect(()=>{e?(Ie(),r.search.includes("success=true")&&(Z(!0),ae("操作が正常に完了しました！"),d({type:"success",title:"成功",message:"操作が正常に完了しました！",duration:3e3}),window.history.replaceState({},document.title,r.pathname),setTimeout(()=>{Z(!1),ae("")},5e3))):a("/login")},[e,a,r]);const Oe=()=>{ve(null),we(null),Se(null),ke(""),Te(""),Ne(null)},Le=e=>{ie(e),le(!0)};return K||b?m.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:m.jsx("div",{className:"flex items-center justify-center py-20",children:m.jsxs("div",{className:"relative",children:[m.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),m.jsx("div",{className:"absolute inset-0 animate-ping rounded-full h-12 w-12 border border-blue-400 opacity-20"})]})})}):m.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-2 pb-8 space-y-8",children:[m.jsxs("div",{className:"flex justify-between items-center mb-4",children:[m.jsxs("div",{children:[m.jsx("h1",{className:"text-xl font-bold text-gray-900 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"マイページ"}),m.jsxs("p",{className:"text-gray-600 mt-1",children:["ようこそ、",(null==y?void 0:y.name)||(null==i?void 0:i.name)||"ユーザー","さん！"]})]}),m.jsx("div",{className:"flex items-center space-x-4",children:t&&m.jsxs("a",{href:"/admin",className:"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-4 py-2 rounded-lg font-medium inline-flex items-center transition-all duration-200 shadow-lg hover:shadow-xl",children:[m.jsx(V,{className:"w-4 h-4 mr-2"}),"管理者画面"]})})]}),X&&m.jsxs("div",{className:"mb-6 p-4 bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 text-green-800 rounded-lg flex items-center animate-fade-in",children:[m.jsx(k,{className:"w-5 h-5 mr-2 text-green-600"}),"操作が正常に完了しました！"]}),ee&&m.jsxs("div",{className:"mb-6 p-4 bg-gradient-to-r from-red-50 to-pink-50 border border-red-200 text-red-800 rounded-lg flex items-center",children:[m.jsx("div",{className:"w-5 h-5 mr-2 text-red-600",children:"⚠️"}),ee]}),te&&m.jsxs("div",{className:"mb-6 p-4 bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 text-green-800 rounded-lg flex items-center",children:[m.jsx(k,{className:"w-5 h-5 mr-2 text-green-600"}),te]}),m.jsx(z,{dogs:_,user:e,selectedDog:oe,showDogEditModal:ce,isUpdatingDog:ue,dogUpdateError:ee,dogUpdateSuccess:te,dogFormData:pe,dogImageFile:fe,dogImagePreview:je,rabiesVaccineFile:ye,comboVaccineFile:_e,rabiesExpiryDate:Ee,comboExpiryDate:De,onDogSelect:e=>{var s;de(e);const t=new Date(e.birth_date).toISOString().split("T")[0];be({name:e.name,breed:e.breed,gender:e.gender,birthDate:t||""}),Ne(e.image_url||null);const a=null==(s=e.vaccine_certifications)?void 0:s[0];ke((null==a?void 0:a.rabies_expiry_date)||""),Te((null==a?void 0:a.combo_expiry_date)||""),me(!0)},onCloseDogEditModal:()=>me(!1),onUpdateDog:s=>c(this,null,function*(){if(s.preventDefault(),oe&&e)try{if(he(!0),se(""),!(pe.name&&pe.breed&&pe.gender&&pe.birthDate))return void se("すべての必須項目を入力してください。");if(!["オス","メス"].includes(pe.gender))return void se("性別は「オス」または「メス」を選択してください");if(ye||_e){const e=yield Y(oe.id,ye||void 0,_e||void 0,Ee,De);if(!e.success)return void se(e.error||"ワクチン証明書のアップロードに失敗しました")}const e={name:pe.name,breed:pe.breed,gender:pe.gender,birth_date:pe.birthDate};if(fe){const s=`profile_${Date.now()}_${fe.name}`,t=`${oe.id}/${s}`,{error:a}=yield x.storage.from("dog-images").upload(t,fe,{upsert:!0});if(a)throw a;e.image_url=x.storage.from("dog-images").getPublicUrl(t).data.publicUrl}const{error:s}=yield x.from("dogs").update(e).eq("id",oe.id);if(s)throw s;ae("ワンちゃんの情報を更新しました！"),d({type:"success",title:"成功",message:"ワンちゃんの情報を更新しました！",duration:3e3}),me(!1),yield Ie(),Oe()}catch(t){const e=t instanceof Error?t.message:"ワンちゃんの情報の更新に失敗しました";se(e),d({type:"error",title:"エラー",message:e,duration:5e3})}finally{he(!1)}}),onDeleteDog:e=>c(this,null,function*(){if(window.confirm(`${e.name}の情報を削除しますか？\n\nこの操作は元に戻せません。`))try{he(!0);const{error:s}=yield x.from("dogs").delete().eq("id",e.id);if(s)throw s;ae(`${e.name}の情報を削除しました。`),d({type:"success",title:"削除完了",message:`${e.name}の情報を削除しました。`,duration:3e3}),me(!1),yield Ie()}catch(s){se("ワンちゃんの情報の削除に失敗しました。")}finally{he(!1)}}),onDogImageSelect:e=>c(this,null,function*(){var s;const t=null==(s=e.target.files)?void 0:s[0];if(t)try{if(t.size>10485760)return void se("ファイルサイズは10MB以下にしてください。");if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(t.type))return void se(`サポートされていない画像形式です: ${t.type}`);ve(t);const e=new FileReader;e.onload=e=>{var s;Ne(null==(s=e.target)?void 0:s.result)},e.readAsDataURL(t),se("")}catch(a){se("画像の処理に失敗しました。別の画像をお試しください。")}}),onDogImageRemove:()=>{},onRabiesVaccineSelect:e=>{var s;return we((null==(s=e.target.files)?void 0:s[0])||null)},onComboVaccineSelect:e=>{var s;return Se((null==(s=e.target.files)?void 0:s[0])||null)},onFormDataChange:be,onRabiesExpiryDateChange:ke,onComboExpiryDateChange:Te}),T.length>0&&m.jsxs(u,{className:"p-6 bg-gradient-to-br from-green-50 to-emerald-50 border-green-200",children:[m.jsx("div",{className:"mb-4",children:m.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[m.jsx(D,{className:"w-6 h-6 text-green-600 mr-2"}),"管理中のドッグラン (",T.length,"施設)"]})}),m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:T.map(e=>m.jsx(H,{park:e,onSelect:Le},e.id))})]}),m.jsxs(u,{className:"p-6",children:[m.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[m.jsx("span",{className:"text-2xl mr-2",children:"🚀"}),"クイックアクション"]}),m.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[m.jsx(v,{to:"/parks",className:"group",children:m.jsxs("div",{className:"p-6 bg-gradient-to-br from-blue-50 to-sky-50 rounded-xl hover:from-blue-100 hover:to-sky-100 transition-all duration-300 transform hover:scale-105 shadow-sm hover:shadow-md border border-blue-200",children:[m.jsx(F,{className:"w-8 h-8 text-blue-600 mb-3"}),m.jsx("h3",{className:"font-semibold text-blue-900 mb-1",children:"ドッグラン検索"}),m.jsx("p",{className:"text-sm text-blue-700",children:"近くのドッグランを探す"})]})}),m.jsx(v,{to:"/community",className:"group",children:m.jsxs("div",{className:"p-6 bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl hover:from-green-100 hover:to-emerald-100 transition-all duration-300 transform hover:scale-105 shadow-sm hover:shadow-md border border-green-200",children:[m.jsx($,{className:"w-8 h-8 text-green-600 mb-3"}),m.jsx("h3",{className:"font-semibold text-green-900 mb-1",children:"コミュニティ"}),m.jsx("p",{className:"text-sm text-green-700",children:"他の飼い主と交流"})]})}),m.jsx(v,{to:"/petshop",className:"group",children:m.jsxs("div",{className:"p-6 bg-gradient-to-br from-purple-50 to-violet-50 rounded-xl hover:from-purple-100 hover:to-violet-100 transition-all duration-300 transform hover:scale-105 shadow-sm hover:shadow-md border border-purple-200",children:[m.jsx(q,{className:"w-8 h-8 text-purple-600 mb-3"}),m.jsx("h3",{className:"font-semibold text-purple-900 mb-1",children:"ペットショップ"}),m.jsx("p",{className:"text-sm text-purple-700",children:"ペット用品を購入"})]})}),m.jsx(v,{to:"/news",className:"group",children:m.jsxs("div",{className:"p-6 bg-gradient-to-br from-orange-50 to-amber-50 rounded-xl hover:from-orange-100 hover:to-amber-100 transition-all duration-300 transform hover:scale-105 shadow-sm hover:shadow-md border border-orange-200",children:[m.jsx(S,{className:"w-8 h-8 text-orange-600 mb-3"}),m.jsx("h3",{className:"font-semibold text-orange-900 mb-1",children:"新着情報"}),m.jsx("p",{className:"text-sm text-orange-700",children:"最新のお知らせ"})]})}),m.jsx(v,{to:"/park-registration-agreement",className:"group",children:m.jsxs("div",{className:"p-6 bg-gradient-to-br from-yellow-50 to-orange-50 rounded-xl hover:from-yellow-100 hover:to-orange-100 transition-all duration-300 transform hover:scale-105 shadow-sm hover:shadow-md border-2 border-orange-200",children:[m.jsx(D,{className:"w-8 h-8 text-orange-600 mb-3"}),m.jsx("h3",{className:"font-semibold text-orange-900 mb-1",children:"ドッグランオーナー募集"}),m.jsx("p",{className:"text-sm text-orange-700 mb-2",children:"あなたのドッグランを登録"}),m.jsx("div",{className:"text-xs text-orange-600 font-semibold bg-orange-100 px-2 py-1 rounded-full inline-block",children:"💰 収益化のチャンス！"})]})}),m.jsx(v,{to:"/facility-registration",className:"group",children:m.jsxs("div",{className:"p-6 bg-gradient-to-br from-teal-50 to-cyan-50 rounded-xl hover:from-teal-100 hover:to-cyan-100 transition-all duration-300 transform hover:scale-105 shadow-sm hover:shadow-md border-2 border-teal-200",children:[m.jsxs("div",{className:"flex items-center mb-3",children:[m.jsx(B,{className:"w-6 h-6 text-teal-600 mr-2"}),m.jsx(q,{className:"w-6 h-6 text-teal-600"})]}),m.jsx("h3",{className:"font-semibold text-teal-900 mb-1",children:"ペット関連施設登録"}),m.jsx("p",{className:"text-sm text-teal-700 mb-2",children:"店舗・宿泊施設・サロンなど"}),m.jsx("div",{className:"text-xs text-teal-600 font-semibold bg-teal-100 px-2 py-1 rounded-full inline-block",children:"🎉 今なら無料掲載！"})]})}),m.jsx(v,{to:"/profile-settings",className:"group",children:m.jsxs("div",{className:"p-6 bg-gradient-to-br from-indigo-50 to-purple-50 rounded-xl hover:from-indigo-100 hover:to-purple-100 transition-all duration-300 transform hover:scale-105 shadow-sm hover:shadow-md border border-indigo-200",children:[m.jsx(J,{className:"w-8 h-8 text-indigo-600 mb-3"}),m.jsx("h3",{className:"font-semibold text-indigo-900 mb-1",children:"登録情報"}),m.jsx("p",{className:"text-sm text-indigo-700",children:"住所・氏名・連絡先を編集"})]})})]})]}),A.length>0&&m.jsx(G,{notifications:A,onMarkAsRead:e=>c(this,null,function*(){try{yield x.from("notifications").update({read:!0}).eq("id",e),P(s=>s.filter(s=>s.id!==e)),d({type:"info",title:"通知",message:"通知を既読にしました",duration:2e3})}catch(s){se("通知の更新に失敗しました。")}})}),ne&&re&&m.jsx(W,{park:re,onClose:()=>le(!1)})]})}export{he as UserDashboard};

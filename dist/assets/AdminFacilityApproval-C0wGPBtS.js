import{j as e,l as s,v as a,C as t,p as r,b as l,u as i,i as c,g as d,X as n,a0 as m,f as x,aE as o}from"./ui-vendor-B03FHkej.js";import{r as h}from"./react-vendor-BBLDtDmh.js";import{u as g,s as j,C as p,B as N}from"./index-CWMjoAp3.js";import"./query-vendor-Cy2yKKks.js";import"./supabase-vendor-BcfcqyaE.js";const f={pet_hotel:"ペットホテル",pet_salon:"ペットサロン",veterinary:"動物病院",pet_cafe:"ペットカフェ",pet_restaurant:"ペット同伴レストラン",pet_shop:"ペットショップ",pet_accommodation:"ペット同伴宿泊"};function b(){const{user:b,isAdmin:u}=g(),[y,v]=h.useState("pending"),[w,_]=h.useState([]),[k,C]=h.useState([]),[S,$]=h.useState([]),[q,z]=h.useState(!0),[D,E]=h.useState(""),[P,T]=h.useState(""),[I,J]=h.useState(!1),[L,O]=h.useState(null),[A,B]=h.useState(!1),[F,G]=h.useState(""),[H,K]=h.useState(!1),M=e=>{T(e),E(""),setTimeout(()=>T(""),5e3)},Q=e=>{E(e),T(""),setTimeout(()=>E(""),8e3)};h.useEffect(()=>{u?R():Q("管理者権限が必要です")},[u,b]),h.useEffect(()=>{w.length>0&&U()},[w]);const R=async()=>{try{z(!0),E("");const{data:e,error:s}=await j.from("profiles").select("*").eq("id",b?.id).single(),{data:a,error:t}=await j.from("pet_facilities").select("*").order("created_at",{ascending:!1});if(t)throw t;const r=await Promise.all((a||[]).map(async e=>{const{data:s,error:a}=await j.from("facility_images").select("*").eq("facility_id",e.id).order("is_primary",{ascending:!1});return a?{...e,images:[]}:{...e,images:s||[]}}));_(r)}catch(e){Q(e instanceof Error?e.message:"データの取得に失敗しました")}finally{z(!1)}},U=()=>{const e=w.filter(e=>"pending"===e.status),s=w.filter(e=>"approved"===e.status);C(e),$(s)},V=async e=>{if(window.confirm("この施設を承認してもよろしいですか？"))try{B(!0),E("");const{data:s,error:a}=await j.from("pet_facilities").update({status:"approved",approved_at:(new Date).toISOString(),approved_by:b?.id}).eq("id",e).select();if(a)throw a;M("施設を承認しました。"),_(s=>s.map(s=>s.id===e?{...s,status:"approved"}:s)),J(!1),O(null)}catch(s){if(s&&"object"==typeof s){const e=s;e.message?Q(`施設の承認に失敗しました: ${e.message}`):Q("施設の承認に失敗しました")}else Q("施設の承認に失敗しました")}finally{B(!1)}},W=async e=>{if(window.confirm("この施設を完全に削除してもよろしいですか？この操作は取り消せません。"))try{B(!0),E("");const{error:s}=await j.from("facility_images").delete().eq("facility_id",e),{data:a,error:t}=await j.from("pet_facilities").delete().eq("id",e).select();if(t)throw t;M("施設を削除しました。"),_(s=>s.filter(s=>s.id!==e)),J(!1),O(null)}catch(s){if(s&&"object"==typeof s){const e=s;e.message?Q(`施設の削除に失敗しました: ${e.message}`):Q("施設の削除に失敗しました")}else Q("施設の削除に失敗しました")}finally{B(!1)}},X=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},Y=e=>{switch(e){case"pending":return"承認待ち";case"approved":return"承認済み";case"rejected":return"却下";default:return"不明"}};return u?q?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"データを読み込み中..."})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"bg-white shadow rounded-lg mb-8",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"ペット関連施設承認管理"}),e.jsx("p",{className:"text-gray-600",children:"登録されたペット関連施設の承認・却下を管理します"})]}),D&&e.jsx("div",{className:"px-6 py-4 bg-red-50 border-l-4 border-red-400",children:e.jsxs("div",{className:"flex",children:[e.jsx(s,{className:"h-5 w-5 text-red-400 mr-2"}),e.jsx("p",{className:"text-sm text-red-700",children:D})]})}),P&&e.jsx("div",{className:"px-6 py-4 bg-green-50 border-l-4 border-green-400",children:e.jsxs("div",{className:"flex",children:[e.jsx(a,{className:"h-5 w-5 text-green-400 mr-2"}),e.jsx("p",{className:"text-sm text-green-700",children:P})]})}),e.jsx("div",{className:"px-6",children:e.jsxs("nav",{className:"flex space-x-8","aria-label":"Tabs",children:[e.jsxs("button",{onClick:()=>v("pending"),className:"whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm "+("pending"===y?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx(t,{className:"w-5 h-5 inline mr-2"}),"承認待ち",e.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:k.length})]}),e.jsxs("button",{onClick:()=>v("approved"),className:"whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm "+("approved"===y?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx(r,{className:"w-5 h-5 inline mr-2"}),"掲載中施設",e.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:S.length})]})]})})]}),"pending"===y&&e.jsx("div",{className:"space-y-6",children:0===k.length?e.jsxs(p,{className:"text-center py-12",children:[e.jsx(t,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"承認待ちの施設がありません"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:k.map(s=>e.jsx(p,{className:"overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:f[s.category_id]||s.category_id}),e.jsxs("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${X(s.status)}`,children:[e.jsx(t,{className:"w-3 h-3 mr-1"}),Y(s.status)]})]})}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(l,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"truncate",children:s.address})]}),s.phone&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(i,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:s.phone})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(c,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:new Date(s.created_at).toLocaleDateString("ja-JP")})]})]}),s.images.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"grid grid-cols-3 gap-2",children:s.images.slice(0,3).map((s,a)=>e.jsx("img",{src:s.image_data,alt:`施設画像 ${a+1}`,className:"w-full h-16 object-cover rounded border"},s.id))}),s.images.length>3&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["+",s.images.length-3,"枚の画像"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(N,{onClick:()=>{O(s),J(!0)},className:"flex-1",size:"sm",variant:"secondary",children:"詳細を確認"}),e.jsxs(N,{onClick:()=>{V(s.id)},disabled:A,className:"flex-1 bg-green-600 hover:bg-green-700",size:"sm",children:[e.jsx(d,{className:"w-4 h-4 mr-1"}),"承認"]})]}),e.jsxs("div",{className:"flex space-x-2 mt-2",children:[e.jsxs(N,{onClick:()=>{O(s),K(!0)},disabled:A,className:"flex-1 bg-red-600 hover:bg-red-700",size:"sm",children:[e.jsx(n,{className:"w-4 h-4 mr-1"}),"拒否"]}),e.jsxs(N,{onClick:()=>{W(s.id)},disabled:A,className:"flex-1 bg-gray-600 hover:bg-gray-700",size:"sm",children:[e.jsx(m,{className:"w-4 h-4 mr-1"}),"削除"]})]})]})},s.id))})}),"approved"===y&&e.jsx("div",{className:"space-y-6",children:0===S.length?e.jsxs(p,{className:"text-center py-12",children:[e.jsx(r,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"掲載中の施設がありません"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:S.map(s=>e.jsx(p,{className:"overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:f[s.category_id]||s.category_id}),e.jsxs("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${X(s.status)}`,children:[e.jsx(d,{className:"w-3 h-3 mr-1"}),Y(s.status)]})]})}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(l,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"truncate",children:s.address})]}),s.phone&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(i,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:s.phone})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(c,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:new Date(s.created_at).toLocaleDateString("ja-JP")})]})]}),s.images.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"grid grid-cols-3 gap-2",children:s.images.slice(0,3).map((s,a)=>e.jsx("img",{src:s.image_data,alt:`施設画像 ${a+1}`,className:"w-full h-16 object-cover rounded border"},s.id))}),s.images.length>3&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["+",s.images.length-3,"枚の画像"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(N,{onClick:()=>{O(s),J(!0)},className:"flex-1",size:"sm",variant:"secondary",children:"詳細を確認"}),e.jsxs(N,{onClick:()=>{W(s.id)},disabled:A,className:"flex-1 bg-red-600 hover:bg-red-700",size:"sm",children:[e.jsx(m,{className:"w-4 h-4 mr-1"}),"削除"]})]})]})},s.id))})}),I&&L&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:L.name}),e.jsx("p",{className:"text-gray-600",children:f[L.category_id]||L.category_id})]}),e.jsx("button",{onClick:()=>J(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(x,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"基本情報"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(l,{className:"w-5 h-5 text-gray-500 mr-3"}),e.jsx("span",{children:L.address})]}),L.phone&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(i,{className:"w-5 h-5 text-gray-500 mr-3"}),e.jsx("span",{children:L.phone})]}),L.website&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(o,{className:"w-5 h-5 text-gray-500 mr-3"}),e.jsx("a",{href:L.website,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800",children:L.website})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"ステータス"}),e.jsxs("div",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${X(L.status)}`,children:["pending"===L.status&&e.jsx(t,{className:"w-4 h-4 mr-2"}),"approved"===L.status&&e.jsx(d,{className:"w-4 h-4 mr-2"}),"rejected"===L.status&&e.jsx(x,{className:"w-4 h-4 mr-2"}),Y(L.status)]})]})]}),L.description&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"施設紹介"}),e.jsx("p",{className:"text-gray-700 whitespace-pre-line",children:L.description})]}),L.images.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-3",children:["施設画像 (",L.images.length,"枚)"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:L.images.map((s,a)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s.image_data,alt:`施設画像 ${a+1}`,className:"w-full h-32 object-cover rounded-lg border"}),s.is_primary&&e.jsx("div",{className:"absolute top-2 left-2 bg-blue-500 text-white text-xs px-2 py-1 rounded",children:"メイン"})]},s.id))})]}),"pending"===L.status&&e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs(N,{onClick:()=>{V(L.id)},disabled:A,className:"flex-1 bg-green-600 hover:bg-green-700",children:[e.jsx(d,{className:"w-4 h-4 mr-2"}),"承認する"]}),e.jsxs(N,{onClick:()=>{J(!1),K(!0)},disabled:A,className:"flex-1 bg-red-600 hover:bg-red-700",children:[e.jsx(n,{className:"w-4 h-4 mr-2"}),"拒否する"]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsxs(N,{onClick:()=>{W(L.id)},disabled:A,className:"w-full bg-gray-600 hover:bg-gray-700",children:[e.jsx(m,{className:"w-4 h-4 mr-2"}),"施設を削除"]})})]})})}),H&&L&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-lg max-w-md w-full",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"施設の拒否理由を入力"}),e.jsx("button",{onClick:()=>{K(!1),G("")},className:"text-gray-400 hover:text-gray-600",children:e.jsx(x,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["施設名: ",e.jsx("span",{className:"font-medium",children:L.name})]}),e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"拒否理由を入力してください"}),e.jsx("textarea",{value:F,onChange:e=>G(e.target.value),placeholder:"拒否理由を詳しく入力してください...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",rows:4,required:!0})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(N,{onClick:()=>{K(!1),G("")},variant:"secondary",className:"flex-1",disabled:A,children:"キャンセル"}),e.jsxs(N,{onClick:()=>{(async(e,s)=>{try{B(!0),E("");const{data:a,error:t}=await j.from("pet_facilities").update({status:"rejected",rejection_reason:s,rejected_at:(new Date).toISOString(),rejected_by:b?.id}).eq("id",e).select();if(t)throw t;M("施設を拒否しました。"),_(a=>a.map(a=>a.id===e?{...a,status:"rejected",rejection_reason:s}:a)),J(!1),K(!1),O(null),G("")}catch(a){if(a&&"object"==typeof a){const e=a;e.message?Q(`施設の拒否に失敗しました: ${e.message}`):Q("施設の拒否に失敗しました")}else Q("施設の拒否に失敗しました")}finally{B(!1)}})(L.id,F)},disabled:A||!F.trim(),className:"flex-1 bg-red-600 hover:bg-red-700",children:[e.jsx(n,{className:"w-4 h-4 mr-2"}),"拒否する"]})]})]})})})]})}):e.jsx("div",{className:"max-w-4xl mx-auto p-4",children:e.jsx(p,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(s,{className:"w-12 h-12 text-red-500 mr-4"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-red-700",children:"アクセス権限がありません"}),e.jsx("p",{className:"text-red-600",children:"このページは管理者のみアクセス可能です。"})]})]})})})}export{b as default};

var e=(e,s,a)=>new Promise(((t,r)=>{var i=e=>{try{n(a.next(e))}catch(s){r(s)}},l=e=>{try{n(a.throw(e))}catch(s){r(s)}},n=e=>e.done?t(e.value):Promise.resolve(e.value).then(i,l);n((a=a.apply(e,s)).next())}));import{s,j as a,C as t,B as r}from"./index.oOj2R_C7.js";import{r as i}from"./router.icJHpBzt.js";import{X as l,Y as n,aA as c,h as d,n as o,c as m,u as x,A as g,f as u,F as h,e as p,t as j}from"./ui.UnEvinBv.js";const _=a=>{const[t,r]=i.useState([]),[l,n]=i.useState([]),[c,d]=i.useState(!0),[o,m]=i.useState(""),[x,g]=i.useState(""),u=()=>e(null,null,(function*(){try{yield e(null,null,(function*(){try{const{error:e}=yield s.storage.updateBucket("vaccine-certs",{public:!0});return!e}catch(o){return!1}}));const{data:a,error:t}=yield s.from("vaccine_certifications").select("\n          id,\n          dog_id,\n          rabies_vaccine_image,\n          combo_vaccine_image,\n          rabies_expiry_date,\n          combo_expiry_date,\n          status,\n          created_at,\n          dog:dogs (\n            id,\n            name,\n            breed,\n            gender,\n            birth_date,\n            owner:profiles (\n              id,\n              name\n            )\n          )\n        ").eq("status","pending").order("created_at",{ascending:!1});if(t)throw t;if(!a||0===a.length)return void n([]);const r=a.map((e=>{const s=Array.isArray(e.dog)?e.dog[0]:e.dog,a=s?Array.isArray(s.owner)?s.owner[0]:s.owner:null;return s&&a?{id:e.id,dog_id:e.dog_id,rabies_vaccine_image:e.rabies_vaccine_image,combo_vaccine_image:e.combo_vaccine_image,rabies_expiry_date:e.rabies_expiry_date,combo_expiry_date:e.combo_expiry_date,status:e.status,created_at:e.created_at,dog:{id:s.id,name:s.name,breed:s.breed,gender:s.gender,birth_date:s.birth_date,owner:{id:a.id,name:a.name}}}:null})).filter((e=>null!==e));n(r)}catch(a){m(`ワクチン証明書データの取得に失敗しました: ${a instanceof Error?a.message:"Unknown error"}`)}})),h=()=>e(null,null,(function*(){try{d(!0),m(""),"parks"===a?yield e(null,null,(function*(){try{const{data:e,error:a}=yield s.from("dog_parks").select("\n          id,\n          name,\n          address,\n          status,\n          created_at,\n          owner_id\n        ").in("status",["pending","first_stage_passed","second_stage_review"]).order("created_at",{ascending:!1});if(a)throw a;if(!e||0===e.length)return void r([]);const t=[...new Set(e.map((e=>e.owner_id)))],i=e.map((e=>e.id)),[l,n,c]=yield Promise.allSettled([t.length>0?s.from("profiles").select("id, name").in("id",t):Promise.resolve({data:[],error:null}),i.length>0?s.from("dog_park_review_stages").select("park_id, second_stage_submitted_at").in("park_id",i):Promise.resolve({data:[],error:null}),i.length>0?s.from("dog_park_facility_images").select("park_id, is_approved").in("park_id",i):Promise.resolve({data:[],error:null})]),d="fulfilled"===l.status&&l.value.data||[],o=new Map(d.map((e=>[e.id,e]))),m="fulfilled"===n.status&&n.value.data||[],x=new Map(m.map((e=>[e.park_id,e]))),g="fulfilled"===c.status&&c.value.data||[],u=new Map;g.forEach((e=>{u.has(e.park_id)||u.set(e.park_id,[]),u.get(e.park_id).push(e)}));const h=e.map((e=>{const s=o.get(e.owner_id),a=x.get(e.id),t=u.get(e.id)||[],r=t.length,i=t.filter((e=>!0===e.is_approved)).length,l=t.filter((e=>!1===e.is_approved)).length,n=t.filter((e=>null===e.is_approved)).length;return{id:e.id,name:e.name,address:e.address,status:e.status,created_at:e.created_at,owner_id:e.owner_id,owner_name:(null==s?void 0:s.name)||"Unknown Owner",second_stage_submitted_at:(null==a?void 0:a.second_stage_submitted_at)||null,total_images:r,approved_images:i,rejected_images:l,pending_images:n}}));r(h)}catch(e){m(`ドッグラン申請データの取得に失敗しました: ${e instanceof Error?e.message:"Unknown error"}`)}})):"vaccines"===a&&(yield u())}catch(t){m(`データの取得に失敗しました: ${t instanceof Error?t.message:"Unknown error"}`)}finally{d(!1)}}));return i.useEffect((()=>{h()}),[a]),{pendingParks:t,pendingVaccines:l,isLoading:c,error:o,success:x,refetch:h}},f=()=>{const[a,t]=i.useState(!1),r=a=>e(null,null,(function*(){const e=[];if(a.rabies_vaccine_image){let s="";if(a.rabies_vaccine_image.includes("/temp/")){const e=a.rabies_vaccine_image.match(/temp\/[^\/]+\/[^\/\?]+/);e&&(s=e[0])}s&&e.push(s)}if(a.combo_vaccine_image){let s="";if(a.combo_vaccine_image.includes("/temp/")){const e=a.combo_vaccine_image.match(/temp\/[^\/]+\/[^\/\?]+/);e&&(s=e[0])}s&&e.push(s)}if(e.length>0)try{const{error:a}=yield s.storage.from("vaccine-certs").remove(e)}catch(t){}})),l=(a,t,r)=>e(null,null,(function*(){const{error:e}=yield s.from("notifications").insert([{user_id:a.dog.owner_id,type:"vaccine_approval_required",title:t?"ワクチン証明書承認のお知らせ":"ワクチン証明書却下のお知らせ",message:t?`${a.dog.name}ちゃんのワクチン証明書が承認されました。ドッグランを利用できるようになりました。`:`${a.dog.name}ちゃんのワクチン証明書が却下されました。${r?`理由: ${r}`:"詳細はマイページをご確認ください。"}`,data:{dog_id:a.dog_id}}]);if(e)throw new Error(`通知の作成に失敗しました: ${e.message}`)})),n=(a,t,r)=>e(null,null,(function*(){let e={};const{data:i,error:l}=yield s.from("dog_park_review_stages").select("id").eq("park_id",a).maybeSingle();if(l)throw l;if(i){t?e.first_stage_passed_at=(new Date).toISOString():(e.rejected_at=(new Date).toISOString(),(null==r?void 0:r.trim())&&(e.rejection_reason=r.trim()));const{error:i}=yield s.from("dog_park_review_stages").update(e).eq("park_id",a);if(i)throw i}else{e={park_id:a,first_stage_passed_at:(new Date).toISOString()},t?e.first_stage_passed_at=(new Date).toISOString():(e.rejected_at=(new Date).toISOString(),(null==r?void 0:r.trim())&&(e.rejection_reason=r.trim()));const{error:i}=yield s.from("dog_park_review_stages").insert([e]);if(i)throw i}})),c=(a,t,r)=>e(null,null,(function*(){const{data:e,error:i}=yield s.from("dog_parks").select("id, name, owner_id").eq("id",a).single();if(i)throw i;const{error:l}=yield s.from("notifications").insert([{user_id:e.owner_id,type:"park_approval_required",title:t?"施設承認のお知らせ":"審査結果のお知らせ",message:t?`${e.name}の審査が完了し、承認されました。おめでとうございます！`:`${e.name}の審査結果をお知らせします。${r?`理由: ${r}`:"詳細はオーナーダッシュボードをご確認ください。"}`,data:{park_id:e.id}}]);if(l)throw new Error(`施設通知の作成に失敗しました: ${l.message}`)}));return{isProcessing:a,handleVaccineApproval:(a,i,n)=>e(null,null,(function*(){try{t(!0);const{data:e,error:c}=yield s.from("vaccine_certifications").select("*, dog:dogs(name, owner_id)").eq("id",a).single();if(c)throw c;const d=e,o={status:i?"approved":"rejected"};i&&(o.approved_at=(new Date).toISOString());const{error:m}=yield s.from("vaccine_certifications").update(o).eq("id",a);if(m)throw new Error(`ワクチン証明書の更新に失敗しました: ${m.message}`);const x=d.rabies_vaccine_image,g=d.combo_vaccine_image;return((null==x?void 0:x.includes("/temp/"))||(null==g?void 0:g.includes("/temp/")))&&(yield r(d)),yield l(d,i,n),{success:!0,message:`ワクチン証明書を${i?"承認":"却下"}しました`}}catch(e){return{success:!1,message:`承認処理に失敗しました: ${e.message}`}}finally{t(!1)}})),handleParkApproval:(a,r,i)=>e(null,null,(function*(){try{t(!0);const e={status:r?"approved":"rejected"};r&&(e.approved_at=(new Date).toISOString());const{error:l}=yield s.from("dog_parks").update(e).eq("id",a);if(l)throw l;return yield n(a,r,i),yield c(a,r,i),{success:!0,message:`施設を${r?"承認":"却下"}しました`}}catch(e){return{success:!1,message:"承認処理に失敗しました"}}finally{t(!1)}})),handleImageApproval:(a,r,i)=>e(null,null,(function*(){try{t(!0);const e={is_approved:r};!r&&(null==i?void 0:i.trim())?e.admin_notes=i.trim():e.admin_notes=null;const{error:l}=yield s.from("dog_park_facility_images").update(e).eq("id",a.id);if(l)throw l;return{success:!0,message:`画像を${r?"承認":"却下"}しました`}}catch(e){return{success:!1,message:"画像の承認処理に失敗しました"}}finally{t(!1)}})),handleVaccineExpiryUpdate:(a,r,i)=>e(null,null,(function*(){try{t(!0);const e={};void 0!==r&&(e.rabies_expiry_date=r),void 0!==i&&(e.combo_expiry_date=i);const{error:l}=yield s.from("vaccine_certifications").update(e).eq("id",a);if(l)throw new Error(`有効期限の更新に失敗しました: ${l.message}`);return{success:!0,message:"有効期限を更新しました"}}catch(e){return{success:!1,message:`有効期限の更新に失敗しました: ${e.message}`}}finally{t(!1)}}))}},v=({pendingParks:_,isLoading:v,onApprovalComplete:b,onError:y})=>{const[N,w]=i.useState(null),[k,S]=i.useState(""),[C,P]=i.useState(null),[I,$]=i.useState(!1),[E,D]=i.useState(null),[A,L]=i.useState(null),[q,U]=i.useState(null),[O,z]=i.useState(!1),J=f(),T=(a=>{const[t,r]=i.useState([]),[l,n]=i.useState(!1),[c,d]=i.useState(""),o=a=>e(null,null,(function*(){try{n(!0),d("");const{data:e,error:t}=yield s.from("dog_park_facility_images").select("*").eq("park_id",a).order("created_at",{ascending:!1});if(t)throw t;r(e||[])}catch(e){d(`画像データの取得に失敗しました: ${e instanceof Error?e.message:"Unknown error"}`)}finally{n(!1)}}));return i.useEffect((()=>{a&&o(a)}),[a]),{parkImages:t,isLoading:l,error:c,fetchParkImages:o}})((null==N?void 0:N.id)||null);i.useEffect((()=>{(null==N?void 0:N.owner_id)&&B(N.owner_id)}),[N]);const B=a=>e(null,null,(function*(){var e,t;try{z(!0),U(null);const{data:r,error:i}=yield s.from("profiles").select("name, postal_code, address, phone_number, email").eq("id",a).single();if(i)return void U("プロフィール情報の取得に失敗しました");const{data:l,error:n}=yield s.from("owner_verifications").select("*").eq("user_id",a).order("created_at",{ascending:!1}).limit(1);if(n)return void U("本人確認書類の取得に失敗しました");if(l&&l.length>0){const s=l[0],a=(null==(e=s.verification_data)?void 0:e.document_url)||s.verification_id,i=(null==(t=s.verification_data)?void 0:t.file_name)||"identity_document";L({id:s.id,owner_name:r.name||"",postal_code:r.postal_code||"",address:r.address||"",phone_number:r.phone_number||"",email:r.email||"",identity_document_url:a,identity_document_filename:i,identity_status:s.status||"",identity_created_at:s.created_at||""})}else L({id:"",owner_name:r.name||"",postal_code:r.postal_code||"",address:r.address||"",phone_number:r.phone_number||"",email:r.email||"",identity_document_url:"",identity_document_filename:"",identity_status:"",identity_created_at:""})}catch(r){U(`データの取得に失敗しました: ${r}`)}finally{z(!1)}})),M=(s,a)=>e(null,null,(function*(){try{if(a){if(T.parkImages.filter((e=>null===e.is_approved||!1===e.is_approved)).length>0)return void y("すべての画像を承認してから施設を承認してください")}const e=yield J.handleParkApproval(s,a,k);e.success?(b(e.message),w(null),S("")):y(e.message)}catch(e){y(`処理中にエラーが発生しました: ${e.message}`)}})),V=s=>e(null,null,(function*(){if(C)try{const e=yield J.handleImageApproval(C,s,k);e.success?(b(e.message),yield T.fetchParkImages(N.id),$(!1),P(null),S("")):y(e.message)}catch(e){y(`処理中にエラーが発生しました: ${e.message}`)}})),W=e=>({overview:"施設全景",entrance:"入口",large_dog_area:"大型犬エリア",small_dog_area:"小型犬エリア",private_booth:"プライベートブース",parking:"駐車場",shower:"シャワー設備",restroom:"トイレ",agility:"アジリティ設備",rest_area:"休憩スペース",water_station:"給水設備",exterior:"外観",interior:"内装",equipment:"設備",area:"エリア",other:"その他"}[e]||e);return v?a.jsx("div",{className:"flex justify-center items-center h-64",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):E?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"relative max-w-6xl w-full max-h-[90vh]",children:[a.jsx("button",{onClick:()=>D(null),className:"absolute top-4 right-4 p-2 bg-white bg-opacity-90 shadow-lg rounded-full text-gray-800 hover:bg-opacity-100 transition-all z-10",children:a.jsx(l,{className:"w-6 h-6"})}),a.jsx("img",{src:E,alt:"拡大画像",className:"max-w-full max-h-full mx-auto rounded-lg object-contain",onError:e=>{e.currentTarget.src="https://via.placeholder.com/800x600?text=Image+Not+Available"}})]})}):I&&C?a.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[a.jsx("div",{className:"flex items-center space-x-4 mb-6",children:a.jsxs("button",{onClick:()=>{$(!1),P(null),S("")},className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[a.jsx(n,{className:"w-4 h-4 mr-2"}),"画像一覧に戻る"]})}),a.jsxs(t,{className:"p-6",children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsxs("h2",{className:"text-xl font-bold",children:["画像レビュー: ",W(C.image_type)]}),a.jsx("div",{className:"flex space-x-2",children:a.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-medium "+(!0===C.is_approved?"bg-green-100 text-green-800":!1===C.is_approved?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:!0===C.is_approved?"承認済み":!1===C.is_approved?"却下":"審査待ち"})})]}),a.jsx("div",{className:"mb-6",children:a.jsxs("div",{className:"w-full h-96 bg-gray-100 rounded-lg overflow-hidden relative group",children:[a.jsx("img",{src:C.image_url,alt:W(C.image_type),className:"w-full h-full object-contain cursor-pointer",onClick:()=>D(C.image_url),onError:e=>{e.currentTarget.src="https://via.placeholder.com/800x600?text=Image+Not+Available"}}),a.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-200 flex items-center justify-center cursor-pointer",onClick:()=>D(C.image_url),children:a.jsx(c,{className:"w-12 h-12 text-white opacity-0 group-hover:opacity-100 transition-opacity duration-200"})}),a.jsx("div",{className:"absolute bottom-4 right-4",children:a.jsx("span",{className:"px-2 py-1 bg-white bg-opacity-90 text-gray-800 text-xs rounded border shadow-sm",children:"クリックで拡大"})})]})}),a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"却下理由（却下する場合のみ入力）"}),a.jsx("textarea",{value:k,onChange:e=>S(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,placeholder:"例: 画像が不鮮明です。より明るく鮮明な画像を再アップロードしてください。"})]}),a.jsxs("div",{className:"flex justify-end space-x-3",children:[a.jsx(r,{variant:"secondary",onClick:()=>{$(!1),P(null),S("")},children:"キャンセル"}),a.jsxs(r,{onClick:()=>{V(!1)},isLoading:J.isProcessing,className:"bg-red-600 hover:bg-red-700",children:[a.jsx(l,{className:"w-4 h-4 mr-2"}),"却下"]}),a.jsxs(r,{onClick:()=>{V(!0)},isLoading:J.isProcessing,className:"bg-green-600 hover:bg-green-700",children:[a.jsx(d,{className:"w-4 h-4 mr-2"}),"承認"]})]})]})]}):I&&C?a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h2",{className:"text-xl font-semibold",children:"画像審査"}),a.jsxs(r,{variant:"secondary",onClick:()=>{$(!1),P(null),S("")},children:[a.jsx(n,{className:"w-4 h-4 mr-2"}),"戻る"]})]}),a.jsxs(t,{className:"p-6",children:[a.jsxs("div",{className:"mb-6",children:[a.jsxs("h3",{className:"font-semibold mb-2",children:["画像タイプ: ",W(C.image_type)]}),a.jsxs("div",{className:"relative w-full h-96 bg-gray-100 rounded-lg overflow-hidden group",children:[a.jsx("img",{src:C.image_url,alt:W(C.image_type),className:"w-full h-full object-contain cursor-pointer",onClick:()=>D(C.image_url),onError:e=>{e.currentTarget.src="https://via.placeholder.com/800x600?text=Image+Not+Available"}}),a.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-200 flex items-center justify-center cursor-pointer",onClick:()=>D(C.image_url),children:a.jsx(c,{className:"w-12 h-12 text-white opacity-0 group-hover:opacity-100 transition-opacity duration-200"})}),a.jsx("div",{className:"absolute bottom-4 right-4",children:a.jsx("span",{className:"px-2 py-1 bg-white bg-opacity-90 text-gray-800 text-xs rounded border shadow-sm",children:"クリックで拡大"})})]})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"却下理由（却下する場合のみ入力）"}),a.jsx("textarea",{value:k,onChange:e=>S(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,placeholder:"例: 画像が不鮮明です。より明るく鮮明な画像を再アップロードしてください。"})]}),a.jsxs("div",{className:"flex justify-end space-x-3",children:[a.jsx(r,{variant:"secondary",onClick:()=>{$(!1),P(null),S("")},children:"キャンセル"}),a.jsxs(r,{onClick:()=>{V(!1)},isLoading:J.isProcessing,className:"bg-red-600 hover:bg-red-700",children:[a.jsx(l,{className:"w-4 h-4 mr-2"}),"却下"]}),a.jsxs(r,{onClick:()=>{V(!0)},isLoading:J.isProcessing,className:"bg-green-600 hover:bg-green-700",children:[a.jsx(d,{className:"w-4 h-4 mr-2"}),"承認"]})]})]}),E&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:a.jsxs("div",{className:"relative max-w-4xl max-h-full p-4",children:[a.jsx("img",{src:E.startsWith("http")?E:`${s.storage.from("vaccine-certs").getPublicUrl(E).data.publicUrl}`,alt:"拡大画像",className:"max-w-full max-h-full object-contain"}),a.jsx(r,{onClick:()=>D(null),className:"absolute top-2 right-2 bg-white text-black hover:bg-gray-100",children:a.jsx(l,{className:"w-4 h-4"})})]})})]}):N?a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[a.jsx(o,{className:"w-6 h-6 text-blue-600 mr-2"}),N.name,"の審査"]}),a.jsxs(r,{variant:"secondary",onClick:()=>w(null),children:[a.jsx(n,{className:"w-4 h-4 mr-2"}),"一覧に戻る"]})]}),a.jsxs(t,{className:"p-6",children:[a.jsxs("h3",{className:"font-semibold mb-4 flex items-center",children:[a.jsx(o,{className:"w-5 h-5 mr-2"}),"施設情報"]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-gray-600",children:"施設名"}),a.jsx("p",{className:"font-medium",children:N.name})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-gray-600",children:"住所"}),a.jsx("p",{className:"font-medium",children:N.address})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-gray-600",children:"オーナー"}),a.jsx("p",{className:"font-medium",children:N.owner_name})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-gray-600",children:"申請日"}),a.jsx("p",{className:"font-medium",children:new Date(N.created_at).toLocaleDateString("ja-JP")})]})]})]}),a.jsxs(t,{className:"p-6",children:[a.jsxs("h3",{className:"font-semibold mb-4 flex items-center",children:[a.jsx(m,{className:"w-5 h-5 mr-2"}),"本人確認書類・登録情報"]}),O?a.jsxs("div",{className:"flex justify-center items-center h-32",children:[a.jsx(x,{className:"w-8 h-8 animate-spin text-blue-600"}),a.jsx("span",{className:"ml-2 text-gray-600",children:"データを読み込み中..."})]}):q?a.jsxs("div",{className:"text-center py-8",children:[a.jsx(g,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),a.jsx("p",{className:"text-red-600 mb-2",children:q}),a.jsx(r,{variant:"secondary",onClick:()=>N&&B(N.owner_id),children:"再読み込み"})]}):A?a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsxs("h4",{className:"font-medium mb-3 flex items-center",children:[a.jsx(u,{className:"w-4 h-4 mr-2"}),"登録住所情報（照合用）"]}),a.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-gray-600",children:"氏名"}),a.jsx("p",{className:"font-medium text-blue-900",children:A.owner_name})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-gray-600",children:"郵便番号"}),a.jsx("p",{className:"font-medium text-blue-900",children:A.postal_code})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-gray-600",children:"住所"}),a.jsx("p",{className:"font-medium text-blue-900",children:A.address})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-gray-600",children:"電話番号"}),a.jsx("p",{className:"font-medium text-blue-900",children:A.phone_number})]})]})})]}),A.identity_document_url?a.jsxs("div",{children:[a.jsxs("h4",{className:"font-medium mb-3 flex items-center",children:[a.jsx(h,{className:"w-4 h-4 mr-2"}),"本人確認書類"]}),a.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm mb-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-gray-600",children:"ファイル名"}),a.jsx("p",{className:"font-medium",children:A.identity_document_filename})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-gray-600",children:"アップロード日"}),a.jsx("p",{className:"font-medium",children:new Date(A.identity_created_at).toLocaleDateString("ja-JP")})]})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"本人確認書類画像"}),a.jsxs("div",{className:"relative inline-block",children:[a.jsx("img",{src:`${s.storage.from("vaccine-certs").getPublicUrl(A.identity_document_url).data.publicUrl}`,alt:"本人確認書類",className:"max-w-full h-auto max-h-96 rounded-lg border shadow-sm cursor-pointer hover:shadow-md transition-shadow",onClick:()=>D(A.identity_document_url)}),a.jsx("div",{className:"absolute bottom-2 right-2",children:a.jsx("span",{className:"px-2 py-1 bg-white bg-opacity-90 text-gray-800 text-xs rounded border shadow-sm",children:"クリックで拡大"})})]})]}),a.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:a.jsxs("div",{className:"flex items-start",children:[a.jsx(g,{className:"w-5 h-5 text-yellow-600 mr-2 mt-0.5"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"照合チェック"}),a.jsx("p",{className:"text-sm text-yellow-700",children:"本人確認書類に記載された住所・氏名と、上記の登録情報が一致するかご確認ください。"})]})]})})]})]}):a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(g,{className:"w-5 h-5 text-red-600 mr-2"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-red-800",children:"本人確認書類未提出"}),a.jsx("p",{className:"text-sm text-red-700",children:"このオーナーは本人確認書類を提出していません。"})]})]})})]}):a.jsx("div",{className:"text-center py-8",children:a.jsx("p",{className:"text-gray-600",children:"データを読み込み中..."})})]}),("second_stage_review"===N.status||"first_stage_passed"===N.status||N.total_images>0)&&a.jsxs(t,{className:"p-6",children:[a.jsx("h3",{className:"font-semibold mb-4",children:"施設画像"}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[a.jsxs("div",{className:"bg-blue-50 p-3 rounded text-center",children:[a.jsx("p",{className:"font-medium text-blue-800",children:"全画像"}),a.jsxs("p",{className:"text-blue-600",children:[N.total_images,"枚"]})]}),a.jsxs("div",{className:"bg-yellow-50 p-3 rounded text-center",children:[a.jsx("p",{className:"font-medium text-yellow-800",children:"審査待ち"}),a.jsxs("p",{className:"text-yellow-600",children:[N.pending_images,"枚"]})]}),a.jsxs("div",{className:"bg-green-50 p-3 rounded text-center",children:[a.jsx("p",{className:"font-medium text-green-800",children:"承認済み"}),a.jsxs("p",{className:"text-green-600",children:[N.approved_images,"枚"]})]}),a.jsxs("div",{className:"bg-red-50 p-3 rounded text-center",children:[a.jsx("p",{className:"font-medium text-red-800",children:"却下"}),a.jsxs("p",{className:"text-red-600",children:[N.rejected_images,"枚"]})]})]}),a.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded text-sm",children:[a.jsx("p",{children:a.jsx("strong",{children:"デバッグ情報:"})}),a.jsxs("p",{children:["Park ID: ",N.id]}),a.jsxs("p",{children:["Status: ",N.status]}),a.jsxs("p",{children:["Images Loading: ",T.isLoading?"Yes":"No"]}),a.jsxs("p",{children:["Images Count: ",T.parkImages.length]}),a.jsxs("p",{children:["Images Error: ",T.error||"None"]}),a.jsxs("p",{children:["Expected Total: ",N.total_images]}),a.jsxs("div",{className:"mt-2 flex space-x-2",children:[a.jsx(r,{size:"sm",variant:"secondary",onClick:()=>{T.fetchParkImages(N.id)},children:"画像再取得"}),a.jsx(r,{size:"sm",variant:"secondary",onClick:()=>e(null,null,(function*(){try{const{data:e,error:a}=yield s.from("dog_park_facility_images").select("*").eq("park_id",N.id);a||alert("データベース直接クエリ結果をコンソールに出力しました")}catch(e){}})),children:"DB直接確認"})]}),a.jsxs("div",{className:"mt-2",children:[a.jsx("p",{children:a.jsx("strong",{children:"Raw Images Data:"})}),a.jsx("pre",{className:"text-xs bg-white p-2 rounded border max-h-32 overflow-y-auto",children:JSON.stringify(T.parkImages,null,2)})]})]}),T.isLoading?a.jsxs("div",{className:"flex justify-center items-center h-32",children:[a.jsx(x,{className:"w-8 h-8 animate-spin text-blue-600"}),a.jsx("span",{className:"ml-2 text-gray-600",children:"画像を読み込み中..."})]}):T.error?a.jsxs("div",{className:"text-center py-8",children:[a.jsx("p",{className:"text-red-600 mb-2",children:"画像の読み込みに失敗しました"}),a.jsx("p",{className:"text-gray-500 text-sm",children:T.error}),a.jsx(r,{variant:"secondary",onClick:()=>{T.fetchParkImages(N.id)},className:"mt-4",children:"再読み込み"})]}):0===T.parkImages.length?a.jsxs("div",{className:"text-center py-8",children:[a.jsx("p",{className:"text-gray-600",children:"アップロードされた画像がありません"}),a.jsxs("p",{className:"text-gray-500 text-sm",children:["パークステータス: ",N.status]}),a.jsxs("p",{className:"text-gray-500 text-sm",children:["期待される画像数: ",N.total_images]}),a.jsx(r,{variant:"secondary",onClick:()=>{T.fetchParkImages(N.id)},className:"mt-4",children:"手動でリフレッシュ"})]}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:T.parkImages.map(((e,s)=>a.jsxs("div",{className:"relative group",children:[a.jsxs("div",{className:"relative overflow-hidden rounded-lg bg-gray-100",children:[a.jsx("img",{src:e.image_url,alt:W(e.image_type),className:"w-full h-48 object-cover cursor-pointer hover:scale-105 transition-transform duration-200",onClick:()=>(e=>{P(e),$(!0),S(e.admin_notes||"")})(e),onLoad:()=>{},onError:e=>{e.currentTarget.src="https://via.placeholder.com/400x300?text=Image+Not+Available"}}),a.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-200 flex items-center justify-center cursor-pointer",onClick:s=>{s.stopPropagation(),D(e.image_url)},children:a.jsx(c,{className:"w-8 h-8 text-white opacity-0 group-hover:opacity-100 transition-opacity duration-200"})})]}),a.jsx("div",{className:"absolute top-2 right-2",children:a.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+(!0===e.is_approved?"bg-green-100 text-green-800":!1===e.is_approved?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:!0===e.is_approved?"承認済み":!1===e.is_approved?"却下":"審査待ち"})}),a.jsx("div",{className:"absolute bottom-2 left-2",children:a.jsx("span",{className:"px-2 py-1 bg-white bg-opacity-90 text-gray-800 text-xs rounded border shadow-sm",children:W(e.image_type)})}),!1===e.is_approved&&e.admin_notes&&a.jsxs("div",{className:"mt-2 p-2 bg-red-50 rounded text-sm",children:[a.jsx("p",{className:"text-red-800 font-medium",children:"却下理由:"}),a.jsx("p",{className:"text-red-700",children:e.admin_notes})]})]},e.id)))})]}),a.jsxs(t,{className:"p-6",children:[a.jsx("h3",{className:"font-semibold mb-4",children:"審査結果"}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"却下理由（却下する場合のみ入力）"}),a.jsx("textarea",{value:k,onChange:e=>S(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,placeholder:"例: 施設の安全性に問題があります。安全対策を講じてから再度申請してください。"})]}),a.jsxs("div",{className:"flex justify-end space-x-3",children:[a.jsxs(r,{onClick:()=>{M(N.id,!1)},isLoading:J.isProcessing,className:"bg-red-600 hover:bg-red-700",children:[a.jsx(l,{className:"w-4 h-4 mr-2"}),"却下"]}),a.jsxs(r,{onClick:()=>{M(N.id,!0)},isLoading:J.isProcessing,className:"bg-green-600 hover:bg-green-700",children:[a.jsx(d,{className:"w-4 h-4 mr-2"}),"承認"]})]})]}),E&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:a.jsxs("div",{className:"relative max-w-4xl max-h-full p-4",children:[a.jsx("img",{src:E.startsWith("http")?E:`${s.storage.from("vaccine-certs").getPublicUrl(E).data.publicUrl}`,alt:"拡大画像",className:"max-w-full max-h-full object-contain"}),a.jsx(r,{onClick:()=>D(null),className:"absolute top-2 right-2 bg-white text-black hover:bg-gray-100",children:a.jsx(l,{className:"w-4 h-4"})})]})})]}):a.jsxs("div",{className:"space-y-4",children:[a.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[a.jsx(p,{className:"w-6 h-6 text-blue-600 mr-2"}),"審査待ちドッグラン"]}),0===_.length?a.jsxs(t,{className:"text-center py-12",children:[a.jsx(d,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"審査待ちのドッグランはありません"})]}):a.jsx("div",{className:"space-y-4",children:_.map((e=>a.jsx(t,{className:"p-6 hover:shadow-lg transition-shadow",children:a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[a.jsx("h3",{className:"text-lg font-semibold",children:e.name}),a.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("first_stage_passed"===e.status?"bg-blue-100 text-blue-800":"second_stage_review"===e.status?"bg-purple-100 text-purple-800":"bg-yellow-100 text-yellow-800"),children:"first_stage_passed"===e.status?"第一審査通過":"second_stage_review"===e.status?"第二審査中":"審査待ち"})]}),a.jsx("p",{className:"text-gray-600 mb-2",children:e.address}),a.jsxs("div",{className:"text-sm text-gray-500",children:[a.jsxs("p",{children:["オーナー: ",e.owner_name]}),a.jsxs("p",{children:["申請日: ",new Date(e.created_at).toLocaleDateString("ja-JP")]}),e.second_stage_submitted_at&&a.jsxs("p",{children:["第二審査申請日: ",new Date(e.second_stage_submitted_at).toLocaleDateString("ja-JP")]})]}),"second_stage_review"===e.status&&a.jsxs("div",{className:"mt-3 grid grid-cols-4 gap-2 text-sm",children:[a.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[a.jsx("p",{className:"font-medium text-blue-800",children:"全画像"}),a.jsxs("p",{className:"text-blue-600",children:[e.total_images,"枚"]})]}),a.jsxs("div",{className:"bg-yellow-50 p-2 rounded text-center",children:[a.jsx("p",{className:"font-medium text-yellow-800",children:"審査待ち"}),a.jsxs("p",{className:"text-yellow-600",children:[e.pending_images,"枚"]})]}),a.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[a.jsx("p",{className:"font-medium text-green-800",children:"承認済み"}),a.jsxs("p",{className:"text-green-600",children:[e.approved_images,"枚"]})]}),a.jsxs("div",{className:"bg-red-50 p-2 rounded text-center",children:[a.jsx("p",{className:"font-medium text-red-800",children:"却下"}),a.jsxs("p",{className:"text-red-600",children:[e.rejected_images,"枚"]})]})]})]}),a.jsxs("div",{className:"flex flex-col space-y-2",children:[a.jsxs(r,{onClick:()=>w(e),variant:"secondary",children:[a.jsx(j,{className:"w-4 h-4 mr-2"}),"詳細を見る"]}),a.jsxs(r,{onClick:()=>{M(e.id,!0)},className:"bg-green-600 hover:bg-green-700",disabled:J.isProcessing,children:[a.jsx(d,{className:"w-4 h-4 mr-1"}),"承認"]}),a.jsxs(r,{onClick:()=>{M(e.id,!1)},className:"bg-red-600 hover:bg-red-700",disabled:J.isProcessing,children:[a.jsx(l,{className:"w-4 h-4 mr-1"}),"却下"]})]})]})},e.id)))})]})};export{v as A,_ as a,f as u};

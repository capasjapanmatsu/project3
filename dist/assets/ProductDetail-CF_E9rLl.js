import{j as s,V as e,_ as a,q as t,a6 as l,a7 as r,Q as c,a as i,J as n,r as d,S as x,ar as m,X as o}from"./ui-vendor-B03FHkej.js";import{h,u as p,r as j,L as u}from"./react-vendor-BBLDtDmh.js";import{u as g,b as N,s as f,B as b,C as y,n as v}from"./index-CWMjoAp3.js";import{l as w}from"./logger-hQPzKOcf.js";import"./query-vendor-Cy2yKKks.js";import"./supabase-vendor-BcfcqyaE.js";function _(){const{productId:_}=h(),{user:k}=g(),q=p(),[C,F]=j.useState(null),[S,z]=j.useState([]),[E,O]=j.useState(1),[L,M]=j.useState(!0),{isActive:P}=N(),[$,A]=j.useState([]),[B,I]=j.useState(0),[J,Q]=j.useState(!1);j.useEffect(()=>{_&&T()},[_,k]);const T=async()=>{try{const[s,e,a]=await Promise.all([f.from("products").select("*").eq("id",_).eq("is_active",!0).single(),k?f.from("cart_items").select("*, product:products(*)").eq("user_id",k.id):Promise.resolve({data:[]}),f.from("product_images").select("*").eq("product_id",_).order("display_order",{ascending:!0})]);if(s.error)return void q("/shop");F(s.data),z(e.data||[]);const t=[];s.data.image_url&&t.push({id:"main",url:s.data.image_url}),!a.error&&a.data&&a.data.forEach(s=>{t.push({id:s.id,url:s.image_url})}),A(t)}catch(s){q("/shop")}finally{M(!1)}},V=async()=>{if(k)try{const s=S.find(s=>s.product_id===C?.id);if(s){const{error:e}=await f.from("cart_items").update({quantity:s.quantity+E}).eq("id",s.id);if(e)throw e}else{const{error:s}=await f.from("cart_items").insert([{user_id:k.id,product_id:C.id,quantity:E}]);if(s)throw s}await T(),v.success("カートに追加しました！")}catch(s){w.error("Error adding to cart:",s),v.error("カートへの追加に失敗しました。")}else q("/login")},D=()=>{I(s=>(s+1)%$.length)},G=()=>{I(s=>(s-1+$.length)%$.length)};if(L)return s.jsx("div",{className:"flex justify-center items-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})});if(!C)return s.jsxs("div",{className:"text-center py-12",children:[s.jsx("p",{className:"text-gray-600",children:"商品が見つかりませんでした"}),s.jsx(b,{onClick:()=>q("/shop"),className:"mt-4",children:"ショップに戻る"})]});const H=C.price,K=(R=H,P?Math.round(.9*R):R);var R;const U=P&&K<H,W=(()=>{const s=S.find(s=>s.product_id===C?.id);return s?s.quantity:0})();return s.jsxs("div",{className:"max-w-6xl mx-auto",children:[s.jsx("div",{className:"mb-6",children:s.jsxs("button",{onClick:()=>q("/shop"),className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[s.jsx(e,{className:"w-4 h-4 mr-2"}),"ショップに戻る"]})}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"relative",children:[$.length>0?s.jsx("img",{src:$[B].url,alt:C.name,className:"w-full h-96 object-cover rounded-lg shadow-lg cursor-pointer",onClick:()=>(I(B),void Q(!0)),onError:s=>{s.currentTarget.src="https://images.pexels.com/photos/1108099/pexels-photo-1108099.jpeg"}}):s.jsx("div",{className:"w-full h-96 bg-gray-200 rounded-lg flex items-center justify-center",children:s.jsx(a,{className:"w-16 h-16 text-gray-400"})}),U&&s.jsx("div",{className:"absolute top-4 left-4",children:s.jsxs("span",{className:"bg-purple-500 text-white px-3 py-1 rounded-full text-sm font-medium flex items-center",children:[s.jsx(t,{className:"w-4 h-4 mr-1"}),"10%OFF"]})}),C.stock_quantity<=5&&s.jsx("div",{className:"absolute top-4 right-4",children:s.jsxs("span",{className:"bg-red-500 text-white px-3 py-1 rounded-full text-sm font-medium",children:["残り",C.stock_quantity,"個"]})}),$.length>1&&s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:G,className:"absolute left-2 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-75 rounded-full p-2 hover:bg-opacity-100 transition-opacity",children:s.jsx(l,{className:"w-5 h-5 text-gray-800"})}),s.jsx("button",{onClick:D,className:"absolute right-2 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-75 rounded-full p-2 hover:bg-opacity-100 transition-opacity",children:s.jsx(r,{className:"w-5 h-5 text-gray-800"})})]})]}),$.length>1&&s.jsx("div",{className:"grid grid-cols-6 gap-2",children:$.map((e,a)=>s.jsx("div",{className:"h-16 rounded-lg overflow-hidden cursor-pointer border-2 "+(a===B?"border-green-500":"border-transparent"),onClick:()=>I(a),children:s.jsx("img",{src:e.url,alt:`${C.name} - サムネイル ${a+1}`,className:"w-full h-full object-cover"})},a))})]}),s.jsxs("div",{className:"space-y-6",children:[P&&s.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-pink-500 text-white p-4 rounded-lg",children:s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(t,{className:"w-5 h-5"}),s.jsx("span",{className:"font-semibold",children:"サブスク会員特典: 10%OFF"})]})}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded text-sm",children:(Z=C.category,{food:"ドッグフード",treats:"おやつ",toys:"おもちゃ",accessories:"アクセサリー",health:"ヘルスケア",sheets:"ペットシーツ"}[Z]||Z)}),C.brand&&s.jsx("span",{className:"text-gray-500 text-sm",children:C.brand})]}),s.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:C.name}),s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsxs("span",{className:"text-3xl font-bold text-green-600",children:["¥",K.toLocaleString()]}),U&&s.jsxs("span",{className:"text-xl text-gray-500 line-through",children:["¥",H.toLocaleString()]})]}),P&&s.jsx("p",{className:"text-sm text-purple-600 mt-1",children:"サブスク会員価格"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[C.weight&&s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(a,{className:"w-4 h-4 text-gray-500"}),s.jsxs("span",{className:"text-sm",children:["内容量: ",C.weight,"g"]})]}),C.size&&s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(a,{className:"w-4 h-4 text-gray-500"}),s.jsxs("span",{className:"text-sm",children:["サイズ: ",C.size]})]}),C.age_group&&"all"!==C.age_group&&s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(c,{className:"w-4 h-4 text-gray-500"}),s.jsxs("span",{className:"text-sm",children:["対象年齢: ",(Y=C.age_group,{puppy:"子犬",adult:"成犬",senior:"シニア犬",all:"全年齢"}[Y]||Y)]})]}),C.dog_size&&"all"!==C.dog_size&&s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(i,{className:"w-4 h-4 text-gray-500"}),s.jsxs("span",{className:"text-sm",children:["対象サイズ: ",(X=C.dog_size,{small:"小型犬",medium:"中型犬",large:"大型犬",all:"全サイズ"}[X]||X)]})]})]}),s.jsx("div",{className:"mb-6",children:C.stock_quantity>0?s.jsxs("div",{className:"flex items-center space-x-2 text-green-600",children:[s.jsx(a,{className:"w-4 h-4"}),s.jsx("span",{className:"text-sm font-medium",children:"在庫あり"})]}):s.jsxs("div",{className:"flex items-center space-x-2 text-red-600",children:[s.jsx(a,{className:"w-4 h-4"}),s.jsx("span",{className:"text-sm font-medium",children:"在庫切れ"})]})}),C.stock_quantity>0&&s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"数量"}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("button",{onClick:()=>O(Math.max(1,E-1)),className:"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center hover:bg-gray-300 transition-colors",children:s.jsx(n,{className:"w-4 h-4"})}),s.jsx("span",{className:"text-xl font-medium w-12 text-center",children:E}),s.jsx("button",{onClick:()=>O(Math.min(C.stock_quantity,E+1)),className:"w-10 h-10 bg-green-600 text-white rounded-full flex items-center justify-center hover:bg-green-700 transition-colors",children:s.jsx(d,{className:"w-4 h-4"})})]}),W>0&&s.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["カートに",W,"個入っています"]})]}),s.jsx("div",{className:"space-y-3",children:C.stock_quantity>0?s.jsxs(s.Fragment,{children:[s.jsx(b,{onClick:async()=>{await V(),q("/cart")},className:"w-full bg-green-600 hover:bg-green-700 text-lg py-3",children:"今すぐ購入"}),s.jsxs(b,{onClick:V,variant:"secondary",className:"w-full text-lg py-3",children:[s.jsx(x,{className:"w-5 h-5 mr-2"}),"カートに追加"]})]}):s.jsx(b,{disabled:!0,className:"w-full text-lg py-3",children:"在庫切れ"})})]})]})]}),s.jsxs("div",{className:"mt-12 grid grid-cols-1 lg:grid-cols-3 gap-8",children:[s.jsx("div",{className:"lg:col-span-2",children:s.jsxs(y,{className:"p-6",children:[s.jsx("h2",{className:"text-xl font-semibold mb-4",children:"商品説明"}),s.jsx("p",{className:"text-gray-700 leading-relaxed whitespace-pre-line",children:C.description}),C.ingredients&&s.jsxs("div",{className:"mt-6",children:[s.jsx("h3",{className:"font-semibold mb-2",children:"原材料"}),s.jsx("p",{className:"text-gray-700 text-sm",children:C.ingredients})]})]})}),s.jsxs("div",{className:"space-y-4",children:[s.jsx(y,{className:"p-4",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(m,{className:"w-5 h-5 text-blue-600 mt-1"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-blue-900 mb-1",children:"配送について"}),s.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[s.jsx("p",{children:"• 送料：全国一律¥690"}),s.jsxs("p",{children:["• ¥5,000以上のご注文で",s.jsx("span",{className:"font-medium",children:"送料無料"})]}),s.jsxs("p",{children:["• サブスク会員は",s.jsx("span",{className:"font-medium",children:"常に送料無料"})]}),s.jsx("p",{children:"• 平日14時までのご注文で翌日お届け"})]})]})]})}),s.jsx(y,{className:"p-4",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(i,{className:"w-5 h-5 text-green-600 mt-1"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-green-900 mb-1",children:"品質保証"}),s.jsxs("div",{className:"text-sm text-green-800 space-y-1",children:[s.jsx("p",{children:"• 厳選された安全な原材料のみ使用"}),s.jsx("p",{children:"• 品質に問題がある場合は返品・交換対応"}),s.jsx("p",{children:"• 愛犬の健康を第一に考えた商品選定"})]})]})]})}),P?s.jsx(y,{className:"p-4 bg-purple-50 border-purple-200",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(t,{className:"w-5 h-5 text-purple-600 mt-1"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-purple-900 mb-1",children:"会員特典"}),s.jsxs("div",{className:"text-sm text-purple-800 space-y-1",children:[s.jsx("p",{children:"• 全商品10%OFF"}),s.jsx("p",{children:"• 送料無料"}),s.jsx("p",{children:"• 優先カスタマーサポート"})]})]})]})}):s.jsx(y,{className:"p-4 bg-purple-50 border-purple-200",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(t,{className:"w-5 h-5 text-purple-600 mt-1"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-purple-900 mb-1",children:"サブスク会員になると"}),s.jsxs("div",{className:"text-sm text-purple-800 space-y-1 mb-3",children:[s.jsx("p",{children:"• 全商品10%OFF"}),s.jsx("p",{children:"• 送料無料"}),s.jsx("p",{children:"• ドッグラン使い放題"})]}),s.jsx(u,{to:"/subscription",children:s.jsxs(b,{size:"sm",className:"w-full bg-purple-600 hover:bg-purple-700",children:[s.jsx(t,{className:"w-3 h-3 mr-1"}),"詳細を見る"]})})]})]})})]})]}),J&&s.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",children:[s.jsx("button",{onClick:()=>Q(!1),className:"absolute top-4 right-4 text-gray-800 bg-white bg-opacity-90 shadow-lg rounded-full p-2 hover:bg-opacity-100 transition-all",children:s.jsx(o,{className:"w-6 h-6"})}),s.jsx("button",{onClick:G,className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-800 bg-white bg-opacity-90 shadow-lg rounded-full p-2 hover:bg-opacity-100 transition-all",children:s.jsx(l,{className:"w-6 h-6"})}),s.jsx("button",{onClick:D,className:"absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-800 bg-white bg-opacity-90 shadow-lg rounded-full p-2 hover:bg-opacity-100 transition-all",children:s.jsx(r,{className:"w-6 h-6"})}),s.jsx("img",{src:$[B].url,alt:C.name,className:"max-h-[80vh] max-w-full"}),s.jsx("div",{className:"absolute bottom-4 left-0 right-0 text-center",children:s.jsxs("p",{className:"text-white text-sm",children:[B+1," / ",$.length]})})]})]});var X,Y,Z}export{_ as ProductDetail};

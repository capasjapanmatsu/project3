/*! Build: 2025-07-17T07:59:15.523Z
Version: 0.0.0 */
import{r as e,j as s,f as a,R as t,M as l,t as r,a5 as i,o as c,z as n,S as d,ag as o,ai as x,C as m,n as h,L as p,aj as u,ac as j,p as g,ak as b,k as N,P as f,$ as y,T as v,ad as w,ab as _,u as k,X as S,a8 as C,a9 as D,al as T,am as P,J as I,B as $,an as E,ao as O,ap as q,aq as L,ar as F,H as R,D as M,F as z,U as A,a7 as U,af as J,as as W,A as Q,a as B,c as G,at as V,au as H,K as Y,w as K,av as Z,ae as X,aw as ee,ax as se,O as ae,ay as te,az as le,aA as re,aB as ie,W as ce,a4 as ne}from"./vendor-react.D8SVeCGP.js";import{L as de}from"./vendor-maps.BrTP1vhu.js";import{C as oe,B as xe,u as me,S as he,I as pe}from"./components-admin.GT3qRZg5.js";import{s as ue}from"./utils.C9ZsMnW6.js";import{c as je,d as ge,e as be,f as Ne,r as fe}from"./hooks.CTtJlocA.js";import{V as ye,g as ve}from"./pages-dog.BrfoFXaJ.js";const we=Object.freeze(Object.defineProperty({__proto__:null,DogParkList:function(){const[p,u]=e.useState([]),[j,g]=e.useState({}),[b,N]=e.useState({}),[f,y]=e.useState(!0),[v,w]=e.useState(null),[_,k]=e.useState(""),[S,C]=e.useState(null),[D,T]=e.useState(new Date),[P,I]=e.useState(!1),[$,E]=e.useState({}),O=e.useRef(null),q=e.useRef(null),L=e.useRef([]),F=e.useRef(null),[R,M]=e.useState(!1);e.useEffect((()=>{navigator.geolocation.getCurrentPosition((e=>{C({lat:e.coords.latitude,lng:e.coords.longitude})}),(e=>{C({lat:35.6812,lng:139.7671})}))}),[]);const z=async()=>{try{I(!0);const{data:e,error:s}=await ue.from("dog_parks").select("id, current_occupancy, max_capacity").eq("status","approved");if(s)return;const a=new Date;T(a),u((s=>s.map((s=>{const t=null==e?void 0:e.find((e=>e.id===s.id));if(t&&e){const e=[...$[s.id]||[],{timestamp:a.toISOString(),occupancy:t.current_occupancy,maxCapacity:t.max_capacity}].slice(-20);return E((a=>({...a,[s.id]:e}))),{...s,...t}}return s}))))}catch(e){}finally{I(!1)}};e.useEffect((()=>{(async()=>{try{y(!0),w(null);const{data:e,error:s}=await ue.from("dog_parks").select("*").eq("status","approved").order("created_at",{ascending:!1});if(s)throw w(`データ取得エラー: ${s.message||"Unknown error"}`),s;S&&e&&e.sort(((e,s)=>U(S.lat,S.lng,e.latitude,e.longitude)-U(S.lat,S.lng,s.latitude,s.longitude))),u(e||[]),e&&0!==e.length||w("表示できるドッグランがありません。データベースの内容を確認してください。");const a=(new Date).toISOString().split("T")[0],{data:t,error:l}=await ue.from("reservations").select("*").eq("reservation_type","whole_facility").eq("status","confirmed").eq("date",a),r={};(t||[]).forEach((e=>{if(e&&e.park_id){const s=e.park_id;r[s]||(r[s]=[]),r[s].push(e)}})),g(r);const{data:i,error:c}=await ue.from("park_maintenance").select("park_id, title, description, start_date, end_date, is_emergency, status").in("status",["scheduled","active"]).gte("end_date",(new Date).toISOString());if(c);else{const e={};(i||[]).forEach((s=>{const a=new Date,t=new Date(s.start_date),l=new Date(s.end_date);l>a&&(!e[s.park_id]||t<=a&&l>a)&&(e[s.park_id]={id:s.park_id,title:s.title,description:s.description,start_date:s.start_date,end_date:s.end_date,is_emergency:s.is_emergency})})),N(e)}}catch(e){w(`データ取得エラー: ${e.message||"Unknown error"}`)}finally{y(!1)}})();const e=ue.channel("dog_parks_changes").on("postgres_changes",{event:"UPDATE",schema:"public",table:"dog_parks"},(e=>{u((s=>s.map((s=>s.id===e.new.id?{...s,...e.new}:s))));const s=new Date;E((a=>{const t=[...a[e.new.id]||[],{timestamp:s.toISOString(),occupancy:e.new.current_occupancy,maxCapacity:e.new.max_capacity}].slice(-20);return{...a,[e.new.id]:t}}))})).subscribe();return F.current=setInterval(z,3e4),()=>{e.unsubscribe(),F.current&&clearInterval(F.current)}}),[S]);const A=(e,s)=>{const a=e/s*100;return a<25?{text:"空いています",color:"text-green-600 bg-green-100",barColor:"bg-green-500",description:"快適に利用できます",emoji:"😊"}:a<50?{text:"やや空いています",color:"text-blue-600 bg-blue-100",barColor:"bg-blue-500",description:"適度な混雑です",emoji:"🙂"}:a<75?{text:"やや混んでいます",color:"text-yellow-600 bg-yellow-100",barColor:"bg-yellow-500",description:"少し混雑しています",emoji:"😐"}:{text:"混んでいます",color:"text-red-600 bg-red-100",barColor:"bg-red-500",description:"大変混雑しています",emoji:"😰"}};e.useEffect((()=>{S&&O.current&&(async()=>{try{const e=new de({apiKey:"AIzaSyC9sxGamDZmdKIz3vP1CWLJORl-QkoWgHg",version:"weekly",libraries:["places"]}),s=await e.load();if(!O.current)return;const a=new s.maps.Map(O.current,{center:S,zoom:13,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1,styles:[{featureType:"poi.business",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels.icon",stylers:[{visibility:"off"}]}]});q.current=a,L.current.forEach((e=>e.setMap(null))),L.current=[];const t=new s.maps.Marker({position:S,map:a,icon:{path:s.maps.SymbolPath.CIRCLE,scale:10,fillColor:"#4285F4",fillOpacity:1,strokeWeight:2,strokeColor:"#FFFFFF"},title:"現在地"});L.current.push(t),p.forEach((e=>{const t=A(e.current_occupancy,e.max_capacity);let l="red";t.color.includes("green")?l="green":t.color.includes("blue")?l="blue":t.color.includes("yellow")&&(l="yellow");const r=new s.maps.Marker({position:{lat:Number(e.latitude),lng:Number(e.longitude)},map:a,title:e.name,icon:{url:`https://maps.google.com/mapfiles/ms/icons/${l}-dot.png`}}),i=Array.from({length:5},((s,a)=>`<span style="color: ${a<Math.round(e.average_rating)?"#fbbf24":"#d1d5db"};">★</span>`)).join(""),c=j[e.id]||[];let n="";if(c.length>0){const e=[];c.forEach((s=>{const a=parseInt(s.start_time),t=a+s.duration;e.push({start:`${a.toString().padStart(2,"0")}:00`,end:`${t.toString().padStart(2,"0")}:00`})})),n='\n              <div style="margin-top: 8px; padding: 8px; background-color: #fff7ed; border: 1px solid #fed7aa; border-radius: 4px;">\n                <p style="font-weight: 500; color: #9a3412; margin-bottom: 4px; font-size: 12px;">本日の貸し切り時間</p>\n            ',e.forEach((e=>{n+=`<p style="font-size: 11px; color: #9a3412; margin: 2px 0;">${e.start}〜${e.end}</p>`})),n+="</div>"}const d=new s.maps.InfoWindow({content:`\n              <div style="padding: 12px; max-width: 300px;">\n                <h3 style="margin: 0 0 8px 0; font-size: 16px; font-weight: bold;">${e.name}</h3>\n                <div style="display: flex; align-items: center; margin-bottom: 4px;">\n                  ${i}\n                  <span style="margin-left: 4px; font-size: 12px; color: #666;">${e.average_rating.toFixed(1)} (${e.review_count}件)</span>\n                </div>\n                <p style="margin: 0 0 4px 0; font-size: 14px; color: #666;">${e.address}</p>\n                <p style="margin: 0 0 4px 0; font-size: 14px;">通常利用: ¥800/日</p>\n                <p style="margin: 0 0 4px 0; font-size: 14px;">施設貸し切り: ¥4,400/時間</p>\n                ${e.private_booths?'<p style="margin: 0 0 4px 0; font-size: 14px;">プライベートブース: サブスク使い放題・1日券でも利用可能</p>':""}\n                <p style="margin: 0 0 8px 0; font-size: 14px;">${t.text} (${e.current_occupancy}/${e.max_capacity})</p>\n                ${n}\n                <a href="/parks/${e.id}" style="display: inline-block; padding: 8px 16px; background-color: #2563eb; color: white; text-decoration: none; border-radius: 6px; font-size: 14px; margin-top: 8px;">詳細を見る</a>\n              </div>\n            `});r.addListener("click",(()=>{d.open(a,r)})),L.current.push(r)})),k("")}catch(e){k("Google Mapsの読み込みに失敗しました。APIキーが正しく設定されているか確認してください。")}})()}),[S,p,j]);const U=(e,s,a,t)=>{const l=(a-e)*Math.PI/180,r=(t-s)*Math.PI/180,i=Math.sin(l/2)*Math.sin(l/2)+Math.cos(e*Math.PI/180)*Math.cos(a*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2);return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371};return e.useEffect((()=>{const e=setTimeout((()=>{f&&(M(!0),w("タイムアウト: サーバーから応答がありません。ネットワークやRLS設定を再確認してください。"),y(!1))}),1e4);return()=>clearTimeout(e)}),[f]),f&&!R?s.jsx("div",{className:"flex justify-center items-center h-64",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"ドッグラン情報を読み込み中..."})]})}):v?s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"flex justify-between items-center",children:s.jsx("h1",{className:"text-2xl font-bold",children:"ドッグラン一覧"})}),s.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx(a,{className:"w-6 h-6 text-red-500 mr-2"}),s.jsx("h2",{className:"text-lg font-semibold text-red-800",children:"エラーが発生しました"})]}),s.jsx("p",{className:"text-red-700 mb-4",children:v}),s.jsxs("div",{className:"space-y-2 text-sm text-red-600",children:[s.jsx("p",{children:s.jsx("strong",{children:"考えられる原因:"})}),s.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[s.jsx("li",{children:"データベースの接続エラー"}),s.jsx("li",{children:"ドッグランデータが登録されていない"}),s.jsx("li",{children:"RLS（Row Level Security）の設定問題"}),s.jsx("li",{children:"ネットワーク接続の問題"})]})]}),s.jsxs("div",{className:"mt-4 flex space-x-2",children:[s.jsx("button",{onClick:()=>window.location.reload(),className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium",children:"再読み込み"}),s.jsx("button",{onClick:()=>{w(null),y(!0)},className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium",children:"再試行"})]})]})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h1",{className:"text-2xl font-bold",children:"ドッグラン一覧"}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsxs("div",{className:"text-sm text-gray-600",children:["最終更新: ",D.toLocaleTimeString("ja-JP")]}),s.jsxs("button",{onClick:()=>{z()},disabled:P,className:"flex items-center space-x-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors "+(P?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-100 text-blue-700 hover:bg-blue-200"),children:[s.jsx(t,{className:"w-4 h-4 "+(P?"animate-spin":"")}),s.jsx("span",{children:P?"更新中...":"更新"})]})]})]}),s.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-2 h-2 rounded-full "+(P?"bg-yellow-500 animate-pulse":"bg-green-500")}),s.jsx("span",{className:"text-sm font-medium text-blue-900",children:P?"リアルタイム更新中...":"リアルタイム更新中"})]}),s.jsx("div",{className:"text-xs text-blue-700",children:"30秒ごとに自動更新"})]})}),s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[s.jsx("h2",{className:"font-semibold text-blue-900 mb-2",children:"料金体系"}),s.jsxs("div",{className:"grid md:grid-cols-3 gap-4 text-sm text-blue-800",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium",children:"通常利用"}),s.jsx("p",{children:"1日800円（時間制限なし）"})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium",children:"サブスクリプション"}),s.jsx("p",{children:"月額3,800円（全国共通）"})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium",children:"施設貸し切り"}),s.jsx("p",{children:"4,400円/時間（人数制限なし）"}),s.jsx("p",{className:"text-xs text-blue-600",children:"※前日までの予約が必要"})]})]})]}),s.jsx("div",{className:"relative",children:_?s.jsx("div",{className:"w-full h-[400px] bg-gray-100 rounded-lg shadow-md flex items-center justify-center",children:s.jsxs("div",{className:"text-center p-6",children:[s.jsx(l,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600 mb-2",children:"地図を表示できません"}),s.jsx("p",{className:"text-sm text-red-600",children:_}),s.jsx("div",{className:"mt-4 p-3 bg-yellow-50 rounded-lg text-left",children:s.jsxs("p",{className:"text-sm text-yellow-800",children:[s.jsx("strong",{children:"解決方法:"}),s.jsx("br",{}),"1. .envファイルにVITE_GOOGLE_MAPS_API_KEY=your_api_keyを追加",s.jsx("br",{}),"2. Google Cloud ConsoleでMaps JavaScript APIを有効化",s.jsx("br",{}),"3. APIキーの制限設定を確認"]})})]})}):s.jsx("div",{ref:O,className:"w-full h-[400px] rounded-lg shadow-md"})}),0===p.length?s.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:s.jsxs("div",{className:"text-center",children:[s.jsx(l,{className:"w-12 h-12 text-yellow-500 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-semibold text-yellow-800 mb-2",children:"ドッグランが見つかりません"}),s.jsx("p",{className:"text-yellow-700 mb-4",children:"現在表示できるドッグランがありません。"}),s.jsxs("div",{className:"space-y-2 text-sm text-yellow-600",children:[s.jsx("p",{children:s.jsx("strong",{children:"考えられる原因:"})}),s.jsxs("ul",{className:"list-disc pl-5 space-y-1 text-left inline-block",children:[s.jsx("li",{children:"データベースにドッグランデータが登録されていない"}),s.jsx("li",{children:"承認済み（status='approved'）のドッグランがない"}),s.jsx("li",{children:"RLS（Row Level Security）の設定により表示されない"})]})]}),s.jsx("div",{className:"mt-4",children:s.jsx("button",{onClick:()=>window.location.reload(),className:"bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg font-medium",children:"再読み込み"})})]})}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:p.map((e=>{const t=A(e.current_occupancy,e.max_capacity),p=(e=>{const s=$[e]||[];if(s.length<2)return"stable";const a=s.slice(-3),t=s.slice(-6,-3);if(0===a.length||0===t.length)return"stable";const l=a.reduce(((e,s)=>e+s.occupancy),0)/a.length,r=t.reduce(((e,s)=>e+s.occupancy),0)/t.length;return l>r+1?"increasing":l<r-1?"decreasing":"stable"})(e.id),u=S?U(S.lat,S.lng,Number(e.latitude),Number(e.longitude)):null,g=(e=>{const s=j[e]||[];if(0===s.length)return null;const a=[];return s.forEach((e=>{const s=parseInt(e.start_time),t=s+e.duration;a.push({start:`${s.toString().padStart(2,"0")}:00`,end:`${t.toString().padStart(2,"0")}:00`})})),a})(e.id),N=g&&g.length>0,f=b[e.id];let y=null;if(f){const e=new Date,s=new Date(f.start_date),a=new Date(f.end_date);e>=s&&e<a?y="active":e<s&&(y="scheduled")}return s.jsxs(oe,{className:"overflow-hidden",children:[e.image_url&&s.jsxs("div",{className:"relative h-56 mb-4 -m-6 mb-4",children:[s.jsx("img",{src:e.image_url,alt:e.name,className:"w-full h-full object-cover",loading:"lazy",onError:e=>{e.currentTarget.src="https://images.pexels.com/photos/1108099/pexels-photo-1108099.jpeg"}}),s.jsx("div",{className:"absolute bottom-3 left-1/2 transform -translate-x-1/2",children:s.jsx("span",{className:`px-3 py-1.5 rounded-full text-sm font-semibold shadow-lg ${t.color}`,children:t.text})}),y&&f&&s.jsx("div",{className:"absolute top-2 left-2",children:s.jsx("span",{className:"px-3 py-1.5 rounded-full text-sm font-semibold text-white shadow-lg "+("active"===y?f.is_emergency?"bg-red-600":"bg-orange-600":"bg-blue-600"),children:"active"===y?f.is_emergency?"緊急メンテナンス中":"メンテナンス中":"メンテナンス予定"})}),!y&&N&&s.jsx("div",{className:"absolute top-2 left-2",children:s.jsx("span",{className:"px-3 py-1.5 rounded-full text-sm font-semibold bg-orange-500 text-white shadow-lg",children:"本日貸し切りあり"})})]}),s.jsxs("div",{className:e.image_url?"px-6 pb-6":"",children:[s.jsx("h3",{className:"text-lg font-semibold mb-2",children:e.name}),u&&s.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-2",children:[s.jsx(l,{className:"w-4 h-4 mr-1"}),s.jsxs("span",{children:[u.toFixed(1),"km"]})]}),p&&s.jsxs("div",{className:"flex items-center text-sm mb-3",children:["increasing"===p?s.jsx(r,{className:"w-4 h-4 mr-1 text-orange-500"}):"decreasing"===p?s.jsx(i,{className:"w-4 h-4 mr-1 text-green-500"}):null,s.jsx("span",{className:"text-gray-600",children:"increasing"===p?"混雑傾向":"decreasing"===p?"空いてきています":""})]}),s.jsxs("div",{className:"flex items-center justify-between text-sm mb-3",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(c,{className:"w-4 h-4 mr-1 text-blue-600"}),s.jsx("span",{className:"text-gray-600",children:"現在の利用者数"})]}),s.jsx("div",{className:"flex items-center",children:s.jsxs("span",{className:"font-semibold "+(e.current_occupancy/e.max_capacity>.8?"text-red-600":e.current_occupancy/e.max_capacity>.6?"text-orange-600":"text-green-600"),children:[e.current_occupancy,"/",e.max_capacity]})})]}),y&&f&&s.jsxs("div",{className:"bg-red-50 p-3 rounded-lg mb-3",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[s.jsx(a,{className:"w-4 h-4 text-red-600"}),s.jsx("span",{className:"text-sm font-medium text-red-800",children:f.title})]}),f.description&&s.jsx("p",{className:"text-sm text-red-700 mb-2",children:f.description}),s.jsx("div",{className:"text-xs text-red-600",children:s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx(n,{className:"w-3 h-3"}),s.jsxs("span",{children:[new Date(f.start_date).toLocaleDateString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),"〜",new Date(f.end_date).toLocaleDateString("ja-JP",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]})}),s.jsx("p",{className:`text-xs ${"active"===y?f.is_emergency?"text-red-600":"text-orange-600":"text-blue-600"} mt-2`,children:"※メンテナンス期間中は利用できません"})]}),!y&&N&&s.jsxs("div",{className:"bg-orange-50 p-3 rounded-lg",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[s.jsx(a,{className:"w-4 h-4 text-orange-600"}),s.jsx("span",{className:"text-sm font-medium text-orange-800",children:"本日の貸し切り時間"})]}),s.jsx("div",{className:"space-y-1",children:g.map(((e,a)=>s.jsxs("div",{className:"flex items-center text-xs text-orange-700",children:[s.jsx(n,{className:"w-3 h-3 mr-1 flex-shrink-0"}),s.jsxs("span",{children:[e.start,"〜",e.end]})]},a)))}),s.jsx("p",{className:"text-xs text-orange-600 mt-2",children:"※貸し切り時間中は通常利用できません"})]}),s.jsxs("div",{className:"flex items-center space-x-4",children:[e.large_dog_area&&s.jsxs("div",{className:"flex items-center text-sm text-blue-600",children:[s.jsx(d,{className:"w-4 h-4 mr-1"}),s.jsx("span",{children:"大型犬OK"})]}),e.small_dog_area&&s.jsxs("div",{className:"flex items-center text-sm text-pink-600",children:[s.jsx(o,{className:"w-4 h-4 mr-1"}),s.jsx("span",{children:"小型犬OK"})]})]}),s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{className:"flex items-center text-gray-600",children:[s.jsx(x,{className:"w-4 h-4 mr-2"}),s.jsx("span",{className:"text-sm font-medium",children:"¥800/日"})]})}),e.private_booths&&s.jsxs("div",{className:"bg-purple-50 p-3 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm font-medium text-purple-800",children:"プライベートブース"}),s.jsxs("span",{className:"text-sm text-purple-600",children:[e.private_booth_count,"室"]})]}),s.jsx("p",{className:"text-xs text-purple-600 mt-1",children:"サブスク使い放題・1日券でも利用可能（追加料金なし）"})]})]}),s.jsxs("div",{className:"mt-4 space-y-3",children:[s.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries({parking:"駐車場",shower:"シャワー設備",restroom:"トイレ",agility:"アジリティ設備",rest_area:"休憩スペース",water_station:"給水設備"}).map((([a,t])=>e.facilities[a]&&s.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[s.jsx(m,{className:"w-4 h-4 mr-1 text-green-600 flex-shrink-0"}),s.jsx("span",{children:t})]},a)))}),e.facility_details&&s.jsx("p",{className:"text-sm text-gray-600 border-t pt-3 line-clamp-2",children:e.facility_details}),s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsx(h,{to:`/parks/${e.id}`,children:s.jsx(xe,{variant:"secondary",className:"w-full",style:{backgroundColor:"white",color:"#2563eb",borderColor:"#d1d5db"},children:"詳細・レビュー"})}),"active"===y?s.jsx(xe,{className:"w-full bg-gray-400 cursor-not-allowed",disabled:!0,title:"メンテナンス中のため予約できません",children:"予約不可"}):s.jsx(h,{to:`/parks/${e.id}/reserve`,children:s.jsx(xe,{className:"w-full",children:"予約する"})})]})]})]},e.id)}))})]})}},Symbol.toStringTag,{value:"Module"}));function _e({lockId:t,className:l="",variant:r="primary",size:i="md",label:c="ドアを開ける",showStatus:n=!0,onSuccess:d,onError:o,reservationId:x}){const{user:h}=me(),[b,N]=e.useState(!1),[f,y]=e.useState(null),[v,w]=e.useState(null),[_,k]=e.useState(!1),[S,C]=e.useState("");e.useEffect((()=>{if(v){const e=setTimeout((()=>{w(null)}),3e3);return()=>clearTimeout(e)}}),[v]),e.useEffect((()=>{if(f){const e=setTimeout((()=>{y(null)}),5e3);return()=>clearTimeout(e)}}),[f]);return s.jsxs("div",{className:"space-y-2",children:[s.jsxs(xe,{onClick:()=>{(async()=>{if(h){N(!0),y(null),w(null);try{const{data:{session:e},error:s}=await ue.auth.getSession();if(s||!(null==e?void 0:e.access_token))throw new Error("認証が必要です");let a=5,l=null;if(x){const e=await(async e=>{try{const{data:s,error:a}=await ue.from("reservations").select("\n          *,\n          dog_park:dog_parks(*),\n          dog:dogs(*)\n        ").eq("id",e).single();return a?null:s}catch(s){return null}})(x);if(e&&"whole_facility"===e.reservation_type&&(l=(e=>{try{const s=new Date(e.date),a=e.start_time.split(":").map(Number),t=a[0]??0,l=a[1]??0;return s.setHours(t,l,0,0),new Date(s.getTime()+60*e.duration*60*1e3)}catch(s){return null}})(e),l)){const e=new Date,s=l.getTime()-e.getTime();a=Math.max(1,Math.ceil(s/6e4))}}const r=await fetch("/functions/v1/generate-pin",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.access_token}`},body:JSON.stringify({lock_id:t,purpose:"entry",expiry_minutes:a,reservation_id:x||void 0})});if(!r.ok){const e=await r.json();throw new Error(e.error||"PINコードの生成に失敗しました")}const{pin:i}=await r.json();alert(`PINコード: ${i}\n\nこのPINコードをスマートロックのキーパッドに入力してください。`),w(i),d&&d()}catch(e){if(e.message&&e.message.startsWith("PAYMENT_REQUIRED:")){const s=e.message.replace("PAYMENT_REQUIRED:","").trim();C(s),k(!0),y(null)}else y(e.message||"PINコードの生成に失敗しました"),k(!1);o&&o(e.message||"PINコードの生成に失敗しました")}finally{N(!1)}}})()},isLoading:b,variant:r,size:i,className:`flex items-center ${l}`,children:[b?s.jsx(p,{className:"w-4 h-4 mr-2 animate-spin"}):s.jsx(u,{className:"w-4 h-4 mr-2"}),c]}),n&&s.jsxs(s.Fragment,{children:[v&&s.jsxs("div",{className:"flex items-center text-green-600 text-sm mt-1",children:[s.jsx(m,{className:"w-4 h-4 mr-1"}),s.jsx("span",{children:"PINコードを生成しました"})]}),f&&s.jsxs("div",{className:"flex items-center text-red-600 text-sm mt-1",children:[s.jsx(a,{className:"w-4 h-4 mr-1"}),s.jsx("span",{children:f})]}),_&&s.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg border border-blue-200 mt-2",children:[s.jsxs("div",{className:"flex items-start space-x-2 mb-3",children:[s.jsx(j,{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-blue-900 mb-1",children:"決済が必要です"}),s.jsx("p",{className:"text-sm text-blue-800",children:S})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs(xe,{onClick:()=>window.location.href="/subscription",size:"sm",className:"w-full bg-purple-600 hover:bg-purple-700",children:[s.jsx(j,{className:"w-3 h-3 mr-1"}),"サブスク加入"]}),s.jsxs(xe,{onClick:()=>window.location.href="/parks",size:"sm",variant:"secondary",className:"w-full",children:[s.jsx(g,{className:"w-3 h-3 mr-1"}),"1日券購入"]})]})]})]})]})}function ke({park:e,parkImages:a,todayRentals:t,onImageClick:l}){const r=function(e,s){const a=e/s*100;return a<25?{text:"空いています",color:"text-green-600 bg-green-100"}:a<50?{text:"やや空いています",color:"text-blue-600 bg-blue-100"}:a<75?{text:"やや混んでいます",color:"text-yellow-600 bg-yellow-100"}:{text:"混んでいます",color:"text-red-600 bg-red-100"}}(e.current_occupancy,e.max_capacity);return s.jsx(s.Fragment,{children:a.length>0&&s.jsxs("div",{className:"relative h-64 rounded-lg overflow-hidden",children:[s.jsx("img",{src:a[0].url,alt:e.name,className:"w-full h-full object-cover cursor-pointer",onClick:()=>l(0),onError:e=>{e.currentTarget.src="https://images.pexels.com/photos/1108099/pexels-photo-1108099.jpeg"}}),s.jsx("div",{className:"absolute top-4 right-4",children:s.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${r.color}`,children:r.text})}),t.length>0&&s.jsx("div",{className:"absolute top-4 left-4",children:s.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-orange-500 text-white",children:"本日貸し切りあり"})})]})})}function Se({parkImages:e,onImageClick:a}){return e.length<=1?null:s.jsxs("div",{className:"grid grid-cols-5 gap-2",children:[e.slice(1,6).map(((e,t)=>s.jsx("div",{className:"h-20 rounded-lg overflow-hidden cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>a(t+1),children:s.jsx("img",{src:e.url,alt:e.caption||`画像 ${t+2}`,className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://images.pexels.com/photos/1108099/pexels-photo-1108099.jpeg"}})},e.id))),e.length>6&&s.jsxs("div",{className:"h-20 rounded-lg overflow-hidden cursor-pointer relative bg-gray-200 flex items-center justify-center",onClick:()=>a(6),children:[s.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:s.jsxs("span",{className:"text-white font-medium",children:["+",e.length-6]})}),s.jsx("img",{src:e[6].url,alt:"その他の画像",className:"w-full h-full object-cover opacity-60"})]})]})}function Ce({park:e}){return s.jsxs(oe,{className:"p-6",children:[s.jsx("h2",{className:"text-xl font-semibold mb-4",children:"設備・サービス"}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:Object.entries({parking:"駐車場",shower:"シャワー設備",restroom:"トイレ",agility:"アジリティ設備",rest_area:"休憩スペース",water_station:"給水設備"}).map((([a,t])=>s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-4 h-4 rounded "+(e.facilities[a]?"bg-green-500":"bg-gray-300")}),s.jsx("span",{className:"text-sm",children:t})]},a)))}),e.facility_details&&s.jsx("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:s.jsx("p",{className:"text-sm text-gray-700",children:e.facility_details})})]})}function De({park:e,reviews:a,userReview:t,canReview:l,user:r,userDogs:i,showReviewForm:c,setShowReviewForm:n,reviewFormData:d,setReviewFormData:o,isSubmitting:x,handleReviewSubmit:m,handleDeleteReview:h}){return s.jsxs(oe,{className:"p-6",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[s.jsx(b,{className:"w-6 h-6 mr-2"}),"レビュー (",e.review_count,")"]}),r&&l&&s.jsx(xe,{onClick:()=>n(!c),variant:t?"secondary":"primary",size:"sm",children:t?s.jsxs(s.Fragment,{children:[s.jsx(N,{className:"w-4 h-4 mr-2"}),"レビューを編集"]}):s.jsxs(s.Fragment,{children:[s.jsx(f,{className:"w-4 h-4 mr-2"}),"レビューを書く"]})})]}),c&&s.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[s.jsx("h3",{className:"font-semibold text-blue-900 mb-4",children:t?"レビューを編集":"レビューを投稿"}),s.jsxs("form",{onSubmit:m,className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"評価 *"}),s.jsxs("div",{className:"flex items-center space-x-2",children:[[1,2,3,4,5].map((e=>s.jsx("button",{type:"button",onClick:()=>o({...d,rating:e}),className:"focus:outline-none",children:s.jsx(y,{className:`w-8 h-8 ${e<=d.rating?"text-yellow-400 fill-current":"text-gray-300 hover:text-yellow-300"} transition-colors`})},e))),s.jsxs("span",{className:"ml-2 text-sm text-gray-600",children:[d.rating,"つ星"]})]})]}),s.jsx(he,{label:"レビューするワンちゃん *",options:i.map((e=>({value:e.id,label:e.name}))),value:d.dog_id,onChange:e=>o({...d,dog_id:e.target.value}),required:!0}),s.jsx(pe,{label:"訪問日 *",type:"date",value:d.visit_date,onChange:e=>o({...d,visit_date:e.target.value}),max:(new Date).toISOString().split("T")[0],required:!0}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"レビュー内容"}),s.jsx("textarea",{value:d.review_text,onChange:e=>o({...d,review_text:e.target.value}),placeholder:"ドッグランの感想をお聞かせください...",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("div",{className:"flex space-x-2",children:[s.jsx(xe,{type:"button",variant:"secondary",onClick:()=>n(!1),children:"キャンセル"}),t&&s.jsxs(xe,{type:"button",onClick:h,className:"bg-red-600 hover:bg-red-700",children:[s.jsx(v,{className:"w-4 h-4 mr-2"}),"削除"]})]}),s.jsx(xe,{type:"submit",isLoading:x,disabled:!d.dog_id||!d.visit_date,children:t?"更新する":"投稿する"})]})]})]}),0===a.length?s.jsxs("div",{className:"text-center py-8",children:[s.jsx(b,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"まだレビューがありません"}),r&&l&&s.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"最初のレビューを投稿してみませんか？"})]}):s.jsx("div",{className:"space-y-6",children:a.map((e=>s.jsx("div",{className:"border-b border-gray-200 pb-6 last:border-b-0",children:s.jsxs("div",{className:"flex items-start space-x-4",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center overflow-hidden",children:e.dog_image_url?s.jsx("img",{src:e.dog_image_url,alt:e.dog_name,className:"w-full h-full object-cover"}):s.jsx(w,{className:"w-6 h-6 text-gray-500"})})}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("h4",{className:"font-semibold text-gray-900",children:e.user_name}),s.jsx("span",{className:"text-sm text-gray-500",children:"と"}),s.jsxs("span",{className:"font-medium text-blue-600",children:[e.dog_name,"ちゃん"]}),s.jsxs("span",{className:"text-xs text-gray-400",children:["(",e.dog_breed,")"]})]}),s.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[s.jsx("div",{className:"flex items-center space-x-1",children:[1,2,3,4,5].map((a=>s.jsx(y,{className:"w-4 h-4 "+(a<=e.rating?"text-yellow-400 fill-current":"text-gray-300")},a)))}),s.jsxs("span",{className:"text-sm text-gray-600",children:[new Date(e.visit_date).toLocaleDateString("ja-JP")," に訪問"]})]})]}),s.jsx("span",{className:"text-xs text-gray-400",children:new Date(e.created_at).toLocaleDateString("ja-JP")})]}),e.review_text&&s.jsx("p",{className:"text-gray-700 leading-relaxed mb-3",children:e.review_text}),e.review_images&&e.review_images.length>0&&s.jsx("div",{className:"mt-3",children:s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:e.review_images.map(((e,a)=>s.jsxs("div",{className:"relative group cursor-pointer",children:[s.jsx("img",{src:e.url,alt:e.caption||`レビュー画像 ${a+1}`,className:"w-full h-24 object-cover rounded-lg border border-gray-200 hover:opacity-90 transition-opacity",onClick:()=>window.open(e.url,"_blank")}),e.caption&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white text-xs p-1 rounded-b-lg opacity-0 group-hover:opacity-100 transition-opacity",children:e.caption})]},a)))})}),e.main_image_url&&(!e.review_images||0===e.review_images.length)&&s.jsx("div",{className:"mt-3",children:s.jsx("img",{src:e.main_image_url,alt:"レビュー画像",className:"w-full max-w-md h-48 object-cover rounded-lg border border-gray-200 cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>window.open(e.main_image_url,"_blank")})})]})]})},e.id)))}),r&&!l&&s.jsx("div",{className:"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:s.jsx("p",{className:"text-sm text-yellow-800",children:"レビューを投稿するには、このドッグランを実際に利用する必要があります。"})})]})}function Te({rentalInfo:e}){return s.jsx(oe,{className:"p-6 bg-orange-50 border-orange-200",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(a,{className:"w-6 h-6 text-orange-600 mt-1 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-orange-900 mb-3",children:"施設貸し切り予約あり"}),s.jsx("p",{className:"text-sm text-orange-800 mb-4",children:"以下の日時は施設貸し切りのため、通常利用（1日券・サブスク）での入場はできません。"}),s.jsx("div",{className:"space-y-4",children:e.map(((e,a)=>s.jsxs("div",{className:"bg-white p-3 rounded-lg border border-orange-200",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(g,{className:"w-5 h-5 text-orange-600"}),s.jsx("span",{className:"font-medium text-orange-900",children:new Date(e.date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric",weekday:"long"})})]}),s.jsx("div",{className:"space-y-1",children:e.slots.map(((e,a)=>s.jsxs("div",{className:"flex items-center text-sm text-orange-800",children:[s.jsx(n,{className:"w-4 h-4 mr-2"}),s.jsxs("span",{children:[e.start," 〜 ",e.end]})]},a)))})]},a)))})]})]})})}const Pe=(e,s)=>{const a=e/s*100;return a<25?{text:"空いています",color:"text-green-600 bg-green-100",barColor:"bg-green-500",description:"快適に利用できます",emoji:"😊"}:a<50?{text:"やや空いています",color:"text-blue-600 bg-blue-100",barColor:"bg-blue-500",description:"適度な混雑です",emoji:"🙂"}:a<75?{text:"やや混んでいます",color:"text-yellow-600 bg-yellow-100",barColor:"bg-yellow-500",description:"少し混雑しています",emoji:"😐"}:{text:"混んでいます",color:"text-red-600 bg-red-100",barColor:"bg-red-500",description:"大変混雑しています",emoji:"😰"}},Ie=Object.freeze(Object.defineProperty({__proto__:null,DogParkDetail:function(){const{parkId:r}=_(),{user:i}=me(),p=k(),[j,g]=e.useState(null),[b,N]=e.useState([]),[f,v]=e.useState(null),[w,T]=e.useState([]),[P,I]=e.useState(!1),[$,E]=e.useState(!0),[O,q]=e.useState(!1),[L,F]=e.useState(!1),[R,M]=e.useState([]),[z,A]=e.useState([]),[U,J]=e.useState(null),[W,Q]=e.useState({rating:5,review_text:"",visit_date:"",dog_id:""}),[B,G]=e.useState([]),[V,H]=e.useState(!1),[Y,K]=e.useState(0),[Z,X]=e.useState([]),[ee,se]=e.useState(!1),[ae,te]=e.useState(!1),[le,re]=e.useState(new Date),[ie,ce]=e.useState(null),[ne,de]=e.useState([]),[he,pe]=e.useState(null);e.useEffect((()=>{r&&je()}),[r,i]);const je=async()=>{try{const{data:e,error:s}=await ue.from("dog_parks").select("*").eq("id",r).eq("status","approved").single();if(s)return void p("/parks");g(e);const{data:a,error:t}=await ue.from("dog_park_images").select("*").eq("park_id",r).order("display_order",{ascending:!0});if(!t&&a){const s=[];e.image_url&&s.push({id:"main",url:e.image_url,caption:`${e.name} - メイン画像`}),e.cover_image_url&&s.push({id:"cover",url:e.cover_image_url,caption:`${e.name} - カバー画像`}),a.forEach((a=>{s.push({id:a.id,url:a.image_url,caption:a.caption||`${e.name} - 施設画像`})})),G(s)}const{data:l,error:c}=await ue.rpc("get_park_reviews",{park_id_param:r});c||N(l||[]);const{data:n,error:d}=await ue.from("reservations").select("*").eq("park_id",r).eq("reservation_type","whole_facility").eq("status","confirmed").gte("date",(new Date).toISOString().split("T")[0]);if(d);else{M(n||[]);const e=(new Date).toISOString().split("T")[0],s=(null==n?void 0:n.filter((s=>s.date===e)))||[];A(s)}const{data:o,error:x}=await ue.from("smart_locks").select("id, lock_id, lock_name, park_id").eq("park_id",r).eq("status","active");if(x||X(o||[]),i){const{data:e,error:s}=await ue.from("dogs").select("\n            *,\n            vaccine_certifications!inner(*)\n          ").eq("owner_id",i.id).eq("vaccine_certifications.status","approved");s||T(e||[]);const{data:a,error:t}=await ue.rpc("can_user_review_park",{user_id_param:i.id,park_id_param:r});t||I(a);const{data:l,error:c}=await ue.rpc("get_user_park_review",{user_id_param:i.id,park_id_param:r});if(!c&&l&&l.length>0&&(v(l[0]),Q({rating:l[0].rating,review_text:l[0].review_text||"",visit_date:l[0].visit_date,dog_id:l[0].dog_id})),Z.length>0){const{data:e,error:s}=await ue.rpc("check_user_park_access",{p_user_id:i.id,p_lock_id:Z[0].lock_id});!s&&e&&e.has_access&&se(!0)}const n=(new Date).toISOString().split("T")[0],{data:d,error:o}=await ue.from("reservations").select("\n            *,\n            dog_park:dog_parks(*),\n            dog:dogs(*)\n          ").eq("park_id",r).eq("user_id",i.id).eq("status","confirmed").eq("date",n).order("start_time",{ascending:!0}).limit(1).single();!o&&d&&J(d)}const{data:m,error:h}=await ue.from("park_maintenance").select("*").eq("park_id",r).in("status",["scheduled","active"]).gte("end_date",(new Date).toISOString()).order("start_date",{ascending:!0});if(!h&&m){de(m);const e=new Date,s=m.find((s=>{const a=new Date(s.start_date),t=new Date(s.end_date);return a<=e&&t>e}));pe(s||null)}}catch(e){ce(e.message||"エラーが発生しました"),p("/parks")}finally{E(!1)}},ge=e=>{K(e),H(!0)},be=()=>{alert("PINコードを生成しました！")},Ne=e=>{alert(`PINコードの生成に失敗しました: ${e}`)};if($)return s.jsx("div",{className:"flex justify-center items-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})});if(!j)return s.jsxs("div",{className:"text-center py-12",children:[s.jsx("p",{className:"text-gray-600",children:"ドッグランが見つかりませんでした"}),s.jsx(xe,{onClick:()=>p("/parks"),className:"mt-4",children:"ドッグラン一覧に戻る"})]});const fe=(()=>{if(0===R.length)return[];const e={};return R.forEach((s=>{const a=s.date;e[a]||(e[a]={date:a,slots:[]});const t=parseInt(s.start_time),l=t+s.duration;e[a].slots.push({start:`${t.toString().padStart(2,"0")}:00`,end:`${l.toString().padStart(2,"0")}:00`})})),Object.values(e).sort(((e,s)=>new Date(e.date).getTime()-new Date(s.date).getTime()))})();return s.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[ie&&s.jsx("div",{className:"mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:ie}),j&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex justify-between items-start mb-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:j.name}),s.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[s.jsx("span",{children:j.address}),s.jsx("span",{children:"•"}),s.jsxs("span",{children:["¥",j.price,"/日"]})]})]}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsxs("div",{className:"text-sm text-gray-600",children:["最終更新: ",le.toLocaleTimeString("ja-JP")]}),s.jsxs("button",{onClick:()=>{(async()=>{if(r)try{te(!0);const{data:e,error:s}=await ue.from("dog_parks").select("*").eq("id",r).single();if(s)return;g(e),re(new Date)}catch(e){}finally{te(!1)}})()},disabled:ae,className:"flex items-center space-x-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors "+(ae?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-100 text-blue-700 hover:bg-blue-200"),children:[s.jsx(t,{className:"w-4 h-4 "+(ae?"animate-spin":"")}),s.jsx("span",{children:ae?"更新中...":"更新"})]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[s.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[s.jsx(ke,{park:j,parkImages:B,todayRentals:z,onImageClick:ge}),s.jsx(Se,{parkImages:B,onImageClick:ge}),s.jsxs(oe,{className:"p-6",children:[s.jsxs("div",{className:"flex justify-between items-start mb-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:j.name}),s.jsx("div",{className:"flex items-center space-x-4 mb-4",children:s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"flex items-center space-x-1",children:[1,2,3,4,5].map((e=>s.jsx(y,{className:"w-5 h-5 "+(e<=Math.round(j.average_rating)?"text-yellow-400 fill-current":"text-gray-300")},e)))}),s.jsx("span",{className:"text-lg font-semibold text-gray-900",children:j.average_rating.toFixed(1)}),s.jsxs("span",{className:"text-sm text-gray-600",children:["(",j.review_count,"件のレビュー)"]})]})})]}),he?s.jsx(xe,{className:"bg-gray-400 cursor-not-allowed",disabled:!0,title:"メンテナンス中のため予約できません",children:"予約不可"}):s.jsx(h,{to:`/parks/${j.id}/reserve`,children:s.jsx(xe,{className:"bg-blue-600 hover:bg-blue-700",children:"予約する"})})]}),s.jsx("p",{className:"text-gray-700 mb-6",children:j.description}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center text-gray-600",children:[s.jsx(l,{className:"w-5 h-5 mr-3"}),s.jsx("span",{children:j.address})]}),s.jsxs("div",{className:"flex items-center text-gray-600",children:[s.jsx(c,{className:"w-5 h-5 mr-3"}),s.jsxs("span",{children:["現在の利用者: ",j.current_occupancy,"/",j.max_capacity,"人"]})]}),s.jsxs("div",{className:"flex items-center text-gray-600",children:[s.jsx(x,{className:"w-5 h-5 mr-3"}),s.jsxs("span",{children:["料金: ¥",j.price,"/日"]})]})]}),s.jsxs("div",{className:"space-y-3",children:[j.large_dog_area&&s.jsxs("div",{className:"flex items-center text-blue-600",children:[s.jsx(d,{className:"w-5 h-5 mr-3"}),s.jsx("span",{children:"大型犬OK"})]}),j.small_dog_area&&s.jsxs("div",{className:"flex items-center text-pink-600",children:[s.jsx(o,{className:"w-5 h-5 mr-3"}),s.jsx("span",{children:"小型犬OK"})]}),j.private_booths&&s.jsxs("div",{className:"flex items-center text-purple-600",children:[s.jsx(m,{className:"w-5 h-5 mr-3"}),s.jsxs("span",{children:["プライベートブース ",j.private_booth_count,"室"]})]})]})]})]}),(he||ne.length>0)&&s.jsxs(oe,{className:"p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[s.jsx(a,{className:"w-6 h-6 text-yellow-600 mr-2"}),"メンテナンス情報"]}),he&&s.jsxs("div",{className:`mb-4 p-4 rounded-lg ${he.is_emergency?"bg-red-50 border-red-200":"bg-yellow-50 border-yellow-200"} border`,children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(a,{className:"w-5 h-5 "+(he.is_emergency?"text-red-600":"text-yellow-600")}),s.jsx("span",{className:"text-lg font-semibold "+(he.is_emergency?"text-red-800":"text-yellow-800"),children:he.is_emergency?"緊急メンテナンス中":"メンテナンス中"})]}),s.jsx("p",{className:`text-lg font-medium ${he.is_emergency?"text-red-700":"text-yellow-700"} mb-2`,children:he.title}),he.description&&s.jsx("p",{className:`text-sm ${he.is_emergency?"text-red-600":"text-yellow-600"} mb-3`,children:he.description}),s.jsx("div",{className:"flex items-center space-x-4 text-sm",children:s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx(n,{className:"w-4 h-4 "+(he.is_emergency?"text-red-600":"text-yellow-600")}),s.jsxs("span",{className:"font-medium "+(he.is_emergency?"text-red-700":"text-yellow-700"),children:[new Date(he.start_date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})," ",new Date(he.start_date).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"}),"〜",new Date(he.end_date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})," ",new Date(he.end_date).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"})]})]})}),s.jsx("p",{className:`text-sm ${he.is_emergency?"text-red-600":"text-yellow-600"} mt-3 font-medium`,children:"※メンテナンス期間中は休業となります"})]}),ne.length>0&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"今後のメンテナンス予定"}),s.jsx("div",{className:"space-y-3",children:ne.filter((e=>"scheduled"===e.status&&new Date(e.start_date)>new Date)).slice(0,3).map(((e,a)=>s.jsx("div",{className:"p-3 bg-gray-50 rounded-lg",children:s.jsx("div",{className:"flex items-start justify-between",children:s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[s.jsx(n,{className:"w-4 h-4 text-gray-600"}),s.jsx("span",{className:"font-medium text-gray-900",children:e.title}),e.is_emergency&&s.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full",children:"緊急"})]}),s.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[new Date(e.start_date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})," ",new Date(e.start_date).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"}),"〜",new Date(e.end_date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})," ",new Date(e.end_date).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"})]}),e.description&&s.jsx("p",{className:"text-sm text-gray-500",children:e.description})]})})},a)))})]})]}),Z.length>0&&ee&&s.jsxs(oe,{className:"p-6 bg-blue-50 border-blue-200",children:[s.jsxs("div",{className:"flex items-start space-x-3 mb-4",children:[s.jsx(u,{className:"w-6 h-6 text-blue-600 mt-1 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-blue-900 mb-2",children:"入口ドアの開錠"}),s.jsx("p",{className:"text-sm text-blue-800 mb-4",children:"PINコードを生成して入口のスマートロックを開錠できます。"})]})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Z.map((e=>s.jsx(_e,{lockId:e.lock_id,label:`${e.lock_name}のPINコードを生成`,className:"w-full",onSuccess:be,onError:Ne,reservationId:null==U?void 0:U.id},e.id)))})]}),z.length>0&&s.jsx(oe,{className:"p-6 bg-orange-50 border-orange-200",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(a,{className:"w-6 h-6 text-orange-600 mt-1 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-orange-900 mb-3",children:"本日の貸し切り時間"}),s.jsx("p",{className:"text-sm text-orange-800 mb-4",children:"以下の時間帯は施設貸し切りのため、通常利用（1日券・サブスク）での入場はできません。"}),s.jsx("div",{className:"space-y-3",children:z.map(((e,a)=>{const t=parseInt(e.start_time),l=t+e.duration;return s.jsx("div",{className:"bg-white p-3 rounded-lg border border-orange-200",children:s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(n,{className:"w-5 h-5 text-orange-600"}),s.jsxs("span",{className:"font-medium text-orange-900",children:[t,":00 〜 ",l,":00"]})]})},a)}))})]})]})}),fe.length>0&&s.jsx(Te,{rentalInfo:fe}),s.jsx(Ce,{park:j}),s.jsx(De,{park:j,reviews:b,userReview:f,canReview:P,user:i,userDogs:w,showReviewForm:O,setShowReviewForm:q,reviewFormData:W,setReviewFormData:Q,isSubmitting:L,handleReviewSubmit:async e=>{if(e.preventDefault(),i&&j){F(!0);try{if(f){const{error:e}=await ue.from("dog_park_reviews").update({rating:W.rating,review_text:W.review_text,visit_date:W.visit_date,dog_id:W.dog_id,updated_at:(new Date).toISOString()}).eq("id",f.id);if(e)throw e}else{const{error:e}=await ue.from("dog_park_reviews").insert([{park_id:r,user_id:i.id,dog_id:W.dog_id,rating:W.rating,review_text:W.review_text,visit_date:W.visit_date}]);if(e)throw e}await je(),q(!1),alert(f?"レビューを更新しました！":"レビューを投稿しました！")}catch(s){alert("レビューの投稿に失敗しました。もう一度お試しください。")}finally{F(!1)}}},handleDeleteReview:async()=>{if(f&&confirm("レビューを削除しますか？"))try{const{error:e}=await ue.from("dog_park_reviews").delete().eq("id",f.id);if(e)throw e;await je(),v(null),Q({rating:5,review_text:"",visit_date:"",dog_id:""}),alert("レビューを削除しました。")}catch(e){alert("レビューの削除に失敗しました。")}}})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsx(oe,{className:"p-4",children:s.jsx(h,{to:`/parks/${j.id}/reserve`,children:s.jsx(xe,{className:"w-full bg-blue-600 hover:bg-blue-700 text-lg py-3",children:"予約する"})})}),Z.length>0&&ee&&s.jsxs(oe,{className:"p-4 bg-blue-50 border-blue-200",children:[s.jsxs("h3",{className:"font-semibold text-blue-900 mb-3 flex items-center",children:[s.jsx(u,{className:"w-5 h-5 text-blue-600 mr-2"}),"入口ドアを開ける"]}),s.jsx("div",{className:"space-y-3",children:Z.map((e=>s.jsx(_e,{lockId:e.lock_id,label:`${e.lock_name}のPINコードを生成`,className:"w-full",onSuccess:be,onError:Ne,reservationId:null==U?void 0:U.id},e.id)))})]}),s.jsxs(oe,{className:"p-4",children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"料金情報"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"通常利用"}),s.jsxs("span",{className:"font-medium",children:["¥",j.price,"/日"]})]}),j.private_booths&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"プライベートブース"}),s.jsx("span",{className:"font-medium text-green-600",children:"追加料金なし"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"施設貸し切り"}),s.jsx("span",{className:"font-medium",children:"¥4,400/時間"})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"サブスクリプション"}),s.jsx("span",{className:"font-medium",children:"¥3,800/月"})]})]})]}),s.jsxs(oe,{className:"p-4",children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"現在の状況"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm",children:"利用者数"}),s.jsxs("span",{className:"font-medium",children:[j.current_occupancy,"/",j.max_capacity,"人"]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between text-xs text-gray-600",children:[s.jsxs("span",{children:[j.current_occupancy,"人"]}),s.jsxs("span",{children:[Math.round(j.current_occupancy/j.max_capacity*100),"%"]}),s.jsxs("span",{children:[j.max_capacity,"人"]})]}),s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:s.jsx("div",{className:`h-3 rounded-full transition-all duration-300 ${Pe(j.current_occupancy,j.max_capacity).barColor}`,style:{width:j.current_occupancy/j.max_capacity*100+"%"}})})]}),s.jsxs("div",{className:"text-center",children:[s.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-medium flex items-center justify-center space-x-1 ${Pe(j.current_occupancy,j.max_capacity).color}`,children:[s.jsx("span",{children:Pe(j.current_occupancy,j.max_capacity).emoji}),s.jsx("span",{children:Pe(j.current_occupancy,j.max_capacity).text})]}),s.jsx("p",{className:"text-xs text-gray-600 mt-1",children:Pe(j.current_occupancy,j.max_capacity).description})]}),s.jsxs("div",{className:"flex items-center justify-center space-x-2 text-xs text-gray-500",children:[s.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),s.jsx("span",{children:"リアルタイム更新中"})]})]})]}),s.jsxs(oe,{className:"p-4",children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"評価"}),s.jsxs("div",{className:"text-center mb-4",children:[s.jsx("div",{className:"text-3xl font-bold text-gray-900 mb-1",children:j.average_rating.toFixed(1)}),s.jsx("div",{className:"flex items-center justify-center space-x-1",children:[1,2,3,4,5].map((e=>s.jsx(y,{className:"w-6 h-6 "+(e<=Math.round(j.average_rating)?"text-yellow-400 fill-current":"text-gray-300")},e)))}),s.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:[j.review_count,"件のレビュー"]})]}),j.review_count>0&&s.jsx("div",{className:"space-y-2",children:[5,4,3,2,1].map((e=>{const a=b.filter((s=>s.rating===e)).length,t=j.review_count>0?a/j.review_count*100:0;return s.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[s.jsx("span",{className:"w-3",children:e}),s.jsx(y,{className:"w-3 h-3 text-yellow-400 fill-current"}),s.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:s.jsx("div",{className:"bg-yellow-400 h-2 rounded-full",style:{width:`${t}%`}})}),s.jsx("span",{className:"w-8 text-right",children:a})]},e)}))})]}),s.jsxs(oe,{className:"p-4",children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"アクセス"}),s.jsxs("div",{className:"text-sm text-gray-700 space-y-2",children:[s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx(l,{className:"w-4 h-4 text-gray-500 mt-0.5 flex-shrink-0"}),s.jsx("span",{children:j.address})]}),s.jsx("div",{className:"mt-3",children:s.jsx(xe,{variant:"secondary",size:"sm",className:"w-full",onClick:()=>{const e=encodeURIComponent(j.address);window.open(`https://maps.google.com/maps?q=${e}`,"_blank")},children:"Google Mapsで開く"})})]})]})]})]}),V&&B.length>0&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"relative w-full max-w-4xl",children:[s.jsx("button",{onClick:()=>{H(!1)},className:"absolute top-4 right-4 text-gray-800 bg-white bg-opacity-90 shadow-lg rounded-full p-2 hover:bg-opacity-100 transition-all z-10",children:s.jsx(S,{className:"w-6 h-6"})}),s.jsx("button",{onClick:()=>{K((e=>(e-1+B.length)%B.length))},className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-800 bg-white bg-opacity-90 shadow-lg rounded-full p-2 hover:bg-opacity-100 transition-all z-10",children:s.jsx(C,{className:"w-6 h-6"})}),s.jsx("button",{onClick:()=>{K((e=>(e+1)%B.length))},className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-800 bg-white bg-opacity-90 shadow-lg rounded-full p-2 hover:bg-opacity-100 transition-all z-10",children:s.jsx(D,{className:"w-6 h-6"})}),s.jsx("div",{className:"flex items-center justify-center h-[80vh]",children:s.jsx("img",{src:B[Y].url,alt:B[Y].caption||`${j.name} - 画像 ${Y+1}`,className:"max-h-full max-w-full object-contain"})}),s.jsxs("div",{className:"absolute bottom-4 left-0 right-0 text-center text-white",children:[s.jsx("p",{className:"text-sm mb-2",children:B[Y].caption}),s.jsxs("p",{className:"text-xs",children:[Y+1," / ",B.length]})]})]})})]})]})}},Symbol.toStringTag,{value:"Module"})),$e=[{id:"prod_STbyLoouD9odGI",priceId:"price_1RZpDjAHWLDQ7ynZP7zD3TQB",name:"ドッグパークJPサブスク",description:"月額3,800円で全国のドッグラン使い放題 + ペットショップ10%OFF",mode:"subscription"},{id:"prod_SUPYdaPibyt70U",priceId:"price_1Ra8ZvAHWLDQ7ynZQnuailVL",name:"ドッグラン1日券",description:"ドッグラン施設利用1日券です",mode:"payment"},{id:"prod_facility_rental",priceId:"price_1Ra8awAHWLDQ7ynZvp1jAlPT",name:"施設貸し切り",description:"施設貸し切り1時間",mode:"payment"},{id:"prod_shop_item",priceId:"price_1RcGbaAHWLDQ7ynZA0PmtKbS",name:"ペットショップ購入品",description:"ペットショップ商品",mode:"payment"}];function Ee({park:e,error:t,formData:r,setFormData:i,timeSlots:c,isDateTooSoon:n,selectedDogs:d,dogs:o,handleDogSelection:x,handleTimeSlotSelect:h,getEndTime:p,getSlotStatus:u,getSelectedDogNames:g,calculateDayPassPrice:b,calculateTotalPrice:N,hasSubscription:f,handleSubmit:y,isLoading:v,checkoutLoading:_,MAX_DOGS:k}){return s.jsxs(oe,{children:[s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[s.jsx(l,{className:"w-5 h-5 text-gray-500"}),s.jsx("p",{className:"text-gray-600",children:e.address})]}),s.jsx("p",{className:"text-gray-600 mb-4",children:e.description}),s.jsxs("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(T,{className:"w-5 h-5 text-blue-600"}),s.jsx("h3",{className:"font-semibold text-blue-900",children:"料金体系"})]}),s.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[s.jsx("p",{children:"• 1日券: ¥800（24時間有効）"}),s.jsx("p",{children:"• 2頭目以降: +¥400/頭（半額）"}),s.jsx("p",{children:"• サブスク: 月額¥3,800（3頭まで使い放題）"}),s.jsx("p",{children:"• 施設貸し切り: ¥4,400/時間（サブスク会員20%OFF）"})]})]}),s.jsxs("div",{className:"mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(P,{className:"w-5 h-5 text-yellow-600"}),s.jsx("h3",{className:"font-semibold text-yellow-900",children:"施設貸し切りの注意事項"})]}),s.jsxs("div",{className:"text-sm text-yellow-800 space-y-1",children:[s.jsx("p",{children:"• 施設貸し切りは1時間単位で予約可能です"}),s.jsxs("p",{children:["• ",s.jsx("strong",{children:"2日前までの予約が必要です"}),"（当日・翌日の予約不可）"]}),s.jsx("p",{children:"• 貸し切り中は他のお客様は入場できません"}),s.jsx("p",{children:"• 友達にPINコードを共有して一緒に利用できます"})]})]})]}),s.jsxs("form",{onSubmit:y,children:[t&&s.jsx("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded-lg",children:t}),s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"flex justify-between items-center mb-3",children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["入場するワンちゃんを選択（最大",k,"頭）"]}),s.jsxs("div",{className:"text-sm text-gray-600",children:[d.length,"/",k,"頭選択中"]})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:o.map((e=>{const a=d.includes(e.id),t=!a&&d.length>=k;return s.jsxs("div",{className:"p-4 border-2 rounded-lg cursor-pointer transition-colors relative "+(a?"border-green-500 bg-green-50":t?"border-gray-200 bg-gray-50 opacity-50 cursor-not-allowed":"border-gray-200 hover:border-gray-300"),onClick:()=>!t&&x(e.id),children:[a&&s.jsx("div",{className:"absolute top-2 right-2 w-6 h-6 bg-green-500 text-white rounded-full flex items-center justify-center",children:s.jsx(m,{className:"w-4 h-4"})}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center overflow-hidden",children:e.image_url?s.jsx("img",{src:e.image_url,alt:e.name,className:"w-full h-full object-cover"}):s.jsx(w,{className:"w-6 h-6 text-gray-500"})}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[s.jsxs("h3",{className:"font-semibold",children:[e.name,"ちゃん"]}),s.jsx(ye,{status:ve(e),size:"sm"})]}),s.jsxs("p",{className:"text-sm text-gray-600",children:[e.breed," • ",e.gender]})]})]})]},e.id)}))}),d.length>0&&s.jsxs("div",{className:"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:[s.jsx("h4",{className:"font-medium text-green-900 mb-1",children:"選択中のワンちゃん"}),s.jsx("p",{className:"text-sm text-green-800",children:g()}),s.jsxs("p",{className:"text-xs text-green-700 mt-1",children:[d.length,"頭が同時入場できます"]})]})]}),s.jsx(pe,{label:"日付",type:"date",value:r.date,onChange:e=>i({date:e.target.value,selectedTimeSlot:""}),min:(new Date).toISOString().split("T")[0],required:!0}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"支払い方法"}),s.jsxs("div",{className:"space-y-4",children:[!f&&s.jsxs("label",{className:"flex items-center space-x-3 p-4 border-2 rounded-lg cursor-pointer transition-colors "+("single"===r.paymentType?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:[s.jsx("input",{type:"radio",value:"single",checked:"single"===r.paymentType,onChange:e=>i({paymentType:e.target.value}),className:"form-radio text-blue-600"}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(T,{className:"w-5 h-5 text-blue-600"}),s.jsx("span",{className:"font-medium",children:"1日券（段階的料金制）"})]}),s.jsx("p",{className:"text-sm text-gray-600",children:"1頭目¥800 + 2頭目以降¥400/頭・24時間有効"}),d.length>0&&s.jsxs("p",{className:"text-sm text-blue-600 mt-1",children:[d.length,"頭選択中: ¥",b().toLocaleString()]})]})]}),s.jsxs("label",{className:"flex items-center space-x-3 p-4 border-2 rounded-lg cursor-pointer transition-colors "+("subscription"===r.paymentType?"border-purple-500 bg-purple-50":"border-gray-200 hover:border-gray-300"),children:[s.jsx("input",{type:"radio",value:"subscription",checked:"subscription"===r.paymentType,onChange:e=>i({paymentType:e.target.value}),className:"form-radio text-purple-600"}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(I,{className:"w-5 h-5 text-purple-600"}),s.jsx("span",{className:"font-medium",children:"サブスクリプション（月額¥3,800）"}),f?s.jsx("span",{className:"bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-xs",children:"ご利用中"}):s.jsx("span",{className:"bg-orange-100 text-orange-800 px-2 py-1 rounded-full text-xs",children:"未加入"})]}),s.jsx("p",{className:"text-sm text-gray-600",children:"3頭まで使い放題・施設貸し切り20%OFF"}),!f&&s.jsx("p",{className:"text-xs text-purple-600 mt-1",children:"※ サブスクリプションに加入していません"})]})]}),s.jsxs("label",{className:"flex items-center space-x-3 p-4 border-2 rounded-lg cursor-pointer transition-colors "+("facility_rental"===r.paymentType?"border-orange-500 bg-orange-50":"border-gray-200 hover:border-gray-300"),children:[s.jsx("input",{type:"radio",value:"facility_rental",checked:"facility_rental"===r.paymentType,onChange:e=>i({paymentType:e.target.value,duration:"1"}),className:"form-radio text-orange-600"}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx($,{className:"w-5 h-5 text-orange-600"}),s.jsx("span",{className:"font-medium",children:"施設貸し切り"}),s.jsxs("span",{className:"bg-orange-200 text-orange-800 px-2 py-1 rounded-full text-xs",children:["1時間¥",f?"3,520":"4,400"]})]}),s.jsx("p",{className:"text-sm text-gray-600",children:"施設全体を独占利用・人数制限なし・友達にPINコード共有可能"}),f&&s.jsx("p",{className:"text-sm text-purple-700 font-medium mt-1",children:"サブスク会員20%OFF適用済み！"})]})]})]})]}),"facility_rental"===r.paymentType&&r.date&&s.jsx(s.Fragment,{children:s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"flex justify-between items-center mb-3",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"利用開始時間を選択してください"}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("label",{className:"text-sm text-gray-700",children:"利用時間:"}),s.jsx("select",{value:r.duration,onChange:e=>i({duration:e.target.value}),className:"px-2 py-1 border border-gray-300 rounded text-sm",children:[1,2,3,4].map((e=>s.jsxs("option",{value:e.toString(),children:[e,"時間"]},e)))})]})]}),n&&s.jsxs("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded-lg flex items-start",children:[s.jsx(a,{className:"w-5 h-5 mt-0.5 mr-2 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:"施設貸し切りは2日前までの予約が必要です"}),s.jsx("p",{className:"text-sm",children:"2日後以降の日付を選択してください。"})]})]}),s.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-3",children:c.map((e=>{const a=u(e),t=a.icon,l=r.selectedTimeSlot===e.time,i=e.isWholeFacilityAvailable&&!n,d=parseInt(r.duration);let o=!0;if(i&&d>1){const s=parseInt(e.time.split(":")[0]);for(let e=1;e<d;e++){const a=s+e,t=c.find((e=>parseInt(e.time.split(":")[0])===a));if(!t||!t.isWholeFacilityAvailable){o=!1;break}}}const x=i&&o;return s.jsx("button",{type:"button",onClick:()=>{x&&h(e.time)},disabled:!x,className:"p-3 rounded-lg border-2 transition-all "+(l?"border-orange-500 bg-orange-50":x?"border-gray-200 hover:border-gray-300":"border-gray-200 opacity-50 cursor-not-allowed"),children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"font-medium text-gray-900",children:e.time}),s.jsxs("div",{className:`inline-flex items-center space-x-1 px-2 py-1 rounded-full text-xs mt-1 ${x?a.color:"bg-red-500 text-white"}`,children:[s.jsx(t,{className:"w-3 h-3"}),s.jsx("span",{children:x?a.label:"利用不可"})]}),!x&&i&&!o&&s.jsxs("div",{className:"text-xs text-red-600 mt-1",children:["連続",d,"時間予約不可"]})]})},e.time)}))}),r.selectedTimeSlot&&s.jsxs("div",{className:"text-sm mt-3 p-3 rounded-lg bg-orange-50 text-orange-800 border border-orange-200",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx($,{className:"w-4 h-4"}),s.jsxs("span",{className:"font-medium",children:["選択時間: ",r.selectedTimeSlot," ～ ",p(r.selectedTimeSlot,r.duration)]})]}),s.jsx("p",{className:"text-xs mt-1 flex items-center",children:"施設貸し切りは1時間単位での利用となります。"})]})]})}),s.jsxs("div",{className:"mt-4 p-3 rounded-lg bg-blue-50 text-blue-700 border border-blue-200",children:[s.jsx("p",{className:"font-medium",children:"予約内容"}),s.jsxs("div",{className:"mt-1 space-y-1",children:[s.jsxs("p",{children:["選択ワンちゃん: ",d.length,"頭"]}),"single"===r.paymentType&&s.jsxs("div",{children:[s.jsxs("p",{children:["1日券料金: ¥",b().toLocaleString(),"（",d.length,"頭・段階的料金）"]}),s.jsx("p",{className:"text-xs",children:"24時間有効・全国のドッグランで利用可能"})]}),"subscription"===r.paymentType&&s.jsx("div",{children:f?s.jsxs("div",{children:[s.jsx("p",{className:"text-purple-700 font-medium",children:"サブスク会員: 3頭まで使い放題"}),s.jsx("p",{className:"text-xs",children:"追加料金なし・全国のドッグランで利用可能"})]}):s.jsxs("div",{children:[s.jsx("p",{className:"text-orange-700 font-medium",children:"サブスクリプション申し込み: 月額¥3,800"}),s.jsx("p",{className:"text-xs",children:"申し込み後、3頭まで使い放題・全国のドッグランで利用可能"})]})}),"facility_rental"===r.paymentType&&s.jsxs("div",{children:[s.jsxs("p",{children:["施設貸し切り料金: ¥",N().toLocaleString()]}),s.jsxs("p",{className:"text-xs",children:[r.duration,"時間利用・施設全体独占・友達にPINコード共有可能"]}),f&&s.jsx("p",{className:"text-purple-700 font-medium text-xs",children:"サブスク会員20%OFF適用済み"})]}),s.jsx("div",{className:"border-t border-blue-300 pt-2 mt-2",children:s.jsxs("p",{className:"font-bold",children:["合計料金: ¥",N().toLocaleString()]})})]}),s.jsxs("p",{className:"text-sm mt-2 flex items-center",children:[s.jsx(j,{className:"w-3 h-3 mr-1"}),"決済完了後、入場用PINコードが発行されます"]})]}),s.jsxs(xe,{type:"submit",isLoading:v||_,className:"w-full mt-4 bg-blue-600 hover:bg-blue-700",disabled:0===d.length||"facility_rental"===r.paymentType&&(!r.selectedTimeSlot||n),children:["subscription"!==r.paymentType||f?s.jsxs(s.Fragment,{children:[s.jsx(j,{className:"w-4 h-4 mr-2"}),f&&"subscription"===r.paymentType?"PINコードを発行する":"決済に進む"]}):s.jsxs(s.Fragment,{children:[s.jsx(I,{className:"w-4 h-4 mr-2"}),"サブスクリプションに加入する"]}),d.length>0&&s.jsxs("span",{className:"ml-2 bg-blue-500 text-white px-2 py-1 rounded-full text-sm",children:[d.length,"頭・¥",N().toLocaleString()]})]})]})]})}function Oe({hasSubscription:e}){return s.jsxs("div",{className:"space-y-6",children:[e?s.jsxs(oe,{className:"bg-gradient-to-r from-purple-500 to-pink-500 text-white p-4",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(I,{className:"w-5 h-5"}),s.jsx("span",{className:"font-semibold",children:"サブスク会員特典"})]}),s.jsxs("div",{className:"text-sm space-y-1",children:[s.jsx("p",{children:"• 3頭まで使い放題"}),s.jsx("p",{children:"• 施設貸し切り20%OFF"}),s.jsx("p",{children:"• ペットショップ10%OFF"})]})]}):s.jsxs(oe,{className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white p-4",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(I,{className:"w-5 h-5"}),s.jsx("span",{className:"font-semibold",children:"サブスクリプションがお得！"})]}),s.jsxs("div",{className:"text-sm space-y-1 mb-3",children:[s.jsx("p",{children:"• 月額¥3,800で3頭まで使い放題"}),s.jsx("p",{children:"• 施設貸し切り20%OFF"}),s.jsx("p",{children:"• ペットショップ10%OFF"}),s.jsx("p",{children:"• 全国のドッグランで利用可能"})]}),s.jsx("p",{className:"text-xs",children:"サブスクリプションを選択して決済ページで申し込みできます"})]}),s.jsxs(oe,{className:"p-4 bg-blue-50 border-blue-200",children:[s.jsxs("h3",{className:"font-semibold text-blue-900 mb-2 flex items-center",children:[s.jsx(T,{className:"w-4 h-4 mr-2"}),"料金体系"]}),s.jsxs("div",{className:"space-y-2 text-sm text-blue-800",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:"1日券（段階的料金制）"}),s.jsxs("div",{className:"ml-2 space-y-1",children:[s.jsx("p",{children:"• 1頭目: ¥800"}),s.jsx("p",{children:"• 2頭目: +¥400"}),s.jsx("p",{children:"• 3頭目: +¥400"}),s.jsx("p",{className:"font-medium",children:"3頭合計: ¥1,600"})]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:"サブスク: 月額¥3,800"}),s.jsx("p",{className:"ml-2",children:"3頭まで使い放題"})]}),s.jsxs("div",{children:[s.jsxs("p",{className:"font-medium flex items-center",children:[s.jsx($,{className:"w-3 h-3 mr-1"}),"施設貸し切り"]}),s.jsxs("div",{className:"ml-2 space-y-1",children:[s.jsx("p",{children:"• 通常: ¥4,400/1時間"}),s.jsx("p",{className:"text-purple-700 font-medium",children:"• サブスク: ¥3,520/1時間（20%OFF）"}),s.jsx("p",{children:"• 1時間単位で予約可能"}),s.jsxs("p",{children:["• ",s.jsx("strong",{children:"2日前までの予約が必要"})]})]})]})]})]}),s.jsxs(oe,{className:"p-4 bg-green-50 border-green-200",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(j,{className:"w-5 h-5 text-green-600"}),s.jsx("h3",{className:"font-semibold text-green-900",children:"決済について"})]}),s.jsxs("div",{className:"space-y-1 text-sm text-green-800",children:[s.jsx("p",{children:"• 安全なクレジットカード決済"}),s.jsx("p",{children:"• 決済完了後、即座にPINコード発行"}),s.jsx("p",{children:"• 24時間有効（1日券の場合）"}),s.jsx("p",{children:"• 全国のドッグランで利用可能"}),s.jsx("p",{children:"• 最大3頭まで同時入場"})]})]}),s.jsxs(oe,{className:"p-4 bg-green-50 border-green-200",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(T,{className:"w-5 h-5 text-green-600"}),s.jsx("h3",{className:"font-semibold text-green-900",children:"1日券の特徴"})]}),s.jsxs("div",{className:"space-y-1 text-sm text-green-800",children:[s.jsx("p",{children:"• 24時間有効（発行から24時間後に失効）"}),s.jsx("p",{children:"• 最大3頭まで同時入場可能"}),s.jsx("p",{children:"• 段階的料金制でお得"}),s.jsx("p",{children:"• 全国のドッグランで利用可能"}),s.jsx("p",{className:"text-red-600 font-medium",children:"• 施設貸し切り中は入場できません"})]})]}),s.jsxs(oe,{className:"p-4 bg-orange-50 border-orange-200",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx($,{className:"w-5 h-5 text-orange-600"}),s.jsx("h3",{className:"font-semibold text-orange-900",children:"施設貸し切り特典"})]}),s.jsxs("div",{className:"space-y-1 text-sm text-orange-800",children:[s.jsx("p",{children:"• 施設全体を独占利用"}),s.jsx("p",{children:"• 人数制限なし"}),s.jsx("p",{children:"• 1時間単位での利用"}),s.jsx("p",{children:"• 最大3頭まで同時入場"}),s.jsx("p",{children:"• 友達にPINコード共有可能"}),s.jsx("p",{children:"• 他の利用者を一切気にせず自由に遊べます"}),s.jsx("p",{children:"• 大型犬・小型犬エリア両方利用可能"}),s.jsx("p",{className:"text-purple-700 font-medium",children:"• サブスク会員は20%OFF！"}),s.jsxs("p",{className:"text-red-600 font-medium",children:["• ",s.jsx("strong",{children:"2日前までの予約が必要"})]})]})]}),s.jsxs(oe,{className:"p-4 bg-yellow-50 border-yellow-200",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(w,{className:"w-5 h-5 text-yellow-600"}),s.jsx("h3",{className:"font-semibold text-yellow-900",children:"入場時の犬選択"})]}),s.jsxs("div",{className:"space-y-1 text-sm text-yellow-800",children:[s.jsx("p",{children:"• 最大3頭まで選択可能"}),s.jsx("p",{children:"• 選択した犬のみ入場可能"}),s.jsx("p",{children:"• 全ての犬のワクチン証明書が必要"}),s.jsx("p",{children:"• 後から犬の変更はできません"})]})]}),s.jsxs(oe,{className:"p-4 bg-green-50 border-green-200",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(u,{className:"w-4 h-4 text-green-600"}),s.jsx("span",{className:"text-sm font-medium text-green-900",children:"決済完了後の流れ"})]}),s.jsxs("div",{className:"text-xs text-green-800 space-y-1",children:[s.jsx("p",{children:"1. 決済完了と同時に入場用PINコードが発行されます"}),s.jsx("p",{children:"2. マイページの「入退場」からPINコードを確認"}),s.jsx("p",{children:"3. 予約日時にドッグラン入口でPINコードを入力"}),s.jsx("p",{children:"4. 選択した全ての犬と一緒に入場できます"}),s.jsx("p",{className:"text-orange-700 font-medium",children:"5. 施設貸し切りの場合、友達にPINコードを共有可能！"})]})]})]})}const qe=Object.freeze(Object.defineProperty({__proto__:null,ParkReservation:function(){const{parkId:a}=_(),t=k(),{user:l}=me(),{isActive:r}=je(),{createCheckoutSession:i,loading:c}=ge(),[n,d]=e.useState(!1),[o,x]=e.useState(""),[m,h]=e.useState([]),[p,u]=e.useState(null),[j,g]=e.useState([]),[b,N]=e.useState([]),[f,y]=e.useState([]),[v,w]=e.useState({date:"",selectedTimeSlot:"",duration:"1",reservationType:"whole_facility",paymentType:"single"}),C=e=>{w((s=>({...s,...e})))},[D,T]=e.useState(!1),P=e.useMemo((()=>{const e=[];for(let s=6;s<=21;s++){const a=`${s.toString().padStart(2,"0")}:00`;e.push({time:a,available:!0,reservationCount:0,maxCapacity:(null==p?void 0:p.max_capacity)||10,isPrivateBoothAvailable:!0,isWholeFacilityAvailable:!0})}return e}),[null==p?void 0:p.max_capacity]);e.useEffect((()=>{l?async function(){if(l)try{const[e,s]=await Promise.all([ue.from("dogs").select("\n              *,\n              vaccine_certifications(*)\n            ").eq("owner_id",l.id),ue.from("dog_parks").select("*").eq("id",a).single()]);if(e.error)throw e.error;if(s.error)throw s.error;const t=(e.data||[]).filter((e=>e.vaccine_certifications&&e.vaccine_certifications.some((e=>"approved"===e.status))));h(t),u(s.data)}catch(e){}}():t("/login")}),[l,a,t]),e.useEffect((()=>{r&&"single"===v.paymentType&&C({paymentType:"subscription"})}),[r]),e.useEffect((()=>{v.date&&p&&I()}),[v.date,p]),e.useEffect((()=>{if(v.date){const e=new Date(v.date),s=new Date;s.setHours(0,0,0,0);const a=new Date(s);a.setDate(s.getDate()+2);const t="facility_rental"===v.paymentType&&e<a;T(t),x(t?"施設貸し切りは2日前までの予約が必要です。":"")}}),[v.date,v.paymentType]);const I=async()=>{if(v.date&&p)try{const{data:e,error:s}=await ue.from("reservations").select("*").eq("park_id",a).eq("date",v.date).eq("status","confirmed");if(s)throw s;N(e||[]),E(e||[])}catch(e){}},E=e=>{const s=[...P];s.forEach((s=>{const a=parseInt(s.time.split(":")[0]);let t=0,l=0,r=0;e.forEach((e=>{const s=parseInt(e.start_time.split(":")[0]),i=s+e.duration;a>=s&&a<i&&("whole_facility"===e.reservation_type||e.total_amount>=4400?r++:"private_booth"===e.reservation_type||5e3===e.total_amount?l++:t++)})),s.reservationCount=t,s.available=t<s.maxCapacity&&0===r,s.isPrivateBoothAvailable=l<((null==p?void 0:p.private_booth_count)||0)&&0===r,s.isWholeFacilityAvailable=0===t&&0===l&&0===r})),g(s)},O=()=>{const e=parseInt(v.duration);if(r){const s=4400*e;return Math.round(.8*s)}return 4400*e},q=()=>{const e=f.length;return 0===e?0:1===e?800:800+400*(e-1)},L=()=>"subscription"===v.paymentType?r?0:3800:"facility_rental"===v.paymentType?O():q(),F=()=>f.map((e=>{const s=m.find((s=>s.id===e));return(null==s?void 0:s.name)||""})).filter((e=>e)).join("、");return p?0===m.length?s.jsxs(oe,{className:"max-w-2xl mx-auto text-center py-8",children:[s.jsx("h2",{className:"text-xl font-semibold mb-4",children:"ワクチン接種証明書が必要です"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"ドッグランを利用するには、ワクチン接種証明書の承認が必要です。 まだ証明書を提出していない場合は、ワンちゃんの登録時に提出してください。"}),s.jsx(xe,{onClick:()=>t("/register-dog"),children:"ワンちゃんを登録する"})]}):s.jsxs("div",{className:"max-w-6xl mx-auto",children:[s.jsxs("h1",{className:"text-2xl font-bold text-center mb-8",children:[p.name,"の予約"]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[s.jsx("div",{className:"lg:col-span-2",children:s.jsx(Ee,{park:p,error:o,formData:v,setFormData:C,timeSlots:j,isDateTooSoon:D,selectedDogs:f,dogs:m,handleDogSelection:e=>{y((s=>s.includes(e)?s.filter((s=>s!==e)):s.length>=3?(x("最大3頭まで選択可能です。"),s):(x(""),[...s,e])))},handleTimeSlotSelect:e=>{w((s=>({...s,selectedTimeSlot:e})))},getEndTime:(e,s)=>`${(parseInt(e.split(":")[0])+parseInt(s)).toString().padStart(2,"0")}:00`,getSlotStatus:e=>e.isWholeFacilityAvailable?{label:"施設貸し切り可能",color:"bg-orange-500 text-white hover:bg-orange-600",icon:$}:{label:"利用不可",color:"bg-red-500 text-white cursor-not-allowed",icon:S},getSelectedDogNames:F,calculateDayPassPrice:q,calculateTotalPrice:L,hasSubscription:r,handleSubmit:async e=>{if(e.preventDefault(),l&&p){d(!0),x("");try{if("facility_rental"===v.paymentType&&!v.selectedTimeSlot)return x("施設貸し切りの場合は時間を選択してください。"),void d(!1);if(0===f.length)return x("ワンちゃんを1頭以上選択してください。"),void d(!1);if("facility_rental"===v.paymentType){const e=j.find((e=>e.time===v.selectedTimeSlot));if(!e||!e.isWholeFacilityAvailable)return x("選択された時間は施設貸し切りできません。他の予約が入っています。"),void d(!1);const s=new Date(v.date),a=new Date;a.setHours(0,0,0,0);const t=new Date(a);if(t.setDate(a.getDate()+2),s<t)return x("施設貸し切りは2日前までの予約が必要です。"),void d(!1)}const e={parkId:a,parkName:p.name,selectedDogs:f,dogNames:F(),date:v.date,selectedTimeSlot:v.selectedTimeSlot,duration:parseInt(v.duration),paymentType:v.paymentType,totalPrice:L(),reservationType:"facility_rental"===v.paymentType?"whole_facility":"regular"},s=`DP${Date.now()}${Math.floor(1e3*Math.random())}`;if("single"===v.paymentType){const t=$e.find((e=>"payment"===e.mode));return t?void(await i({priceId:t.priceId,mode:"payment",successUrl:`${window.location.origin}/payment-confirmation?success=true&type=day_pass&order_number=${s}`,cancelUrl:`${window.location.origin}/parks/${a}/reserve?canceled=true`,customParams:{reservation_data:JSON.stringify(e),order_number:s}})):(x("1日券商品が見つかりません。"),void d(!1))}if("subscription"===v.paymentType&&!r){const e=$e.find((e=>"subscription"===e.mode));return e?void(await i({priceId:e.priceId,mode:"subscription",successUrl:`${window.location.origin}/payment-confirmation?success=true&type=subscription`,cancelUrl:`${window.location.origin}/parks/${a}/reserve?canceled=true`})):(x("サブスクリプション商品が見つかりません。"),void d(!1))}if("subscription"===v.paymentType&&r)return void t("/access-control");if("facility_rental"===v.paymentType)return void(await i({priceId:"price_placeholder",mode:"payment",successUrl:`${window.location.origin}/payment-confirmation?success=true&order_number=${s}`,cancelUrl:`${window.location.origin}/parks/${a}/reserve`,customAmount:O(),customName:`${p.name} 施設貸し切り ${v.date} ${v.selectedTimeSlot}〜${parseInt(v.selectedTimeSlot)+parseInt(v.duration)}:00`,customParams:{reservation_data:JSON.stringify(e),order_number:s}}));t("/checkout",{state:{reservationData:e}})}catch(s){x(`予約データの準備に失敗しました: ${s.message}`)}finally{d(!1)}}},isLoading:n,checkoutLoading:c,MAX_DOGS:3})}),s.jsx(Oe,{hasSubscription:r})]})]}):s.jsx("div",{className:"flex justify-center items-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})}},Symbol.toStringTag,{value:"Module"})),Le=({type:e,className:t="w-6 h-6"})=>{switch(e){case"network":return s.jsx(L,{className:`${t} text-orange-600`});case"authentication":return s.jsx(d,{className:`${t} text-red-600`});case"authorization":return s.jsx(q,{className:`${t} text-red-600`});case"validation":return s.jsx(a,{className:`${t} text-yellow-600`});case"timeout":return s.jsx(n,{className:`${t} text-blue-600`});case"server":return s.jsx(O,{className:`${t} text-red-600`});case"not_found":return s.jsx(E,{className:`${t} text-gray-600`});case"storage":return s.jsx(E,{className:`${t} text-orange-600`});case"payment":return s.jsx(j,{className:`${t} text-purple-600`});default:return s.jsx(a,{className:`${t} text-gray-600`})}},Fe=({error:a,onClear:l,onRetry:r,className:i="",showAsModal:c=!1})=>{if(e.useEffect((()=>{if(a&&"low"===a.severity&&"validation"===a.type){const e=setTimeout((()=>{l()}),5e3);return()=>clearTimeout(e)}}),[a,l]),!a)return null;const n=(e=>{switch(e){case"low":return{bg:"bg-yellow-50",border:"border-yellow-200",text:"text-yellow-800",button:"bg-yellow-600 hover:bg-yellow-700"};case"medium":return{bg:"bg-orange-50",border:"border-orange-200",text:"text-orange-800",button:"bg-orange-600 hover:bg-orange-700"};case"high":return{bg:"bg-red-50",border:"border-red-200",text:"text-red-800",button:"bg-red-600 hover:bg-red-700"};case"critical":return{bg:"bg-red-100",border:"border-red-300",text:"text-red-900",button:"bg-red-700 hover:bg-red-800"};default:return{bg:"bg-gray-50",border:"border-gray-200",text:"text-gray-800",button:"bg-gray-600 hover:bg-gray-700"}}})(a.severity),d=s.jsx("div",{className:`${n.bg} ${n.border} border rounded-lg p-4 ${i}`,children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(Le,{type:a.type,className:"flex-shrink-0 mt-0.5"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:`text-sm font-medium ${n.text} mb-1`,children:"エラーが発生しました"}),s.jsx("p",{className:`text-sm ${n.text} mb-3`,children:a.userMessage}),!1]}),!c&&s.jsx("button",{onClick:l,className:`ml-2 ${n.text} hover:opacity-75`,"aria-label":"エラーを閉じる",children:s.jsx(S,{className:"w-4 h-4"})})]}),s.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:(()=>{const e=[];return a.retryable&&r&&e.push(s.jsxs(xe,{size:"sm",onClick:()=>{r()},className:n.button,children:[s.jsx(t,{className:"w-4 h-4 mr-1"}),"再試行"]},"retry")),"authentication"===a.type&&e.push(s.jsxs(xe,{size:"sm",onClick:()=>window.location.href="/login",className:"bg-blue-600 hover:bg-blue-700",children:[s.jsx(F,{className:"w-4 h-4 mr-1"}),"ログイン"]},"login")),"high"!==a.severity&&"critical"!==a.severity||e.push(s.jsxs(xe,{size:"sm",variant:"secondary",onClick:()=>window.location.href="/",children:[s.jsx(R,{className:"w-4 h-4 mr-1"}),"ホームに戻る"]},"home")),e.push(s.jsxs(xe,{size:"sm",variant:"secondary",onClick:l,children:[s.jsx(S,{className:"w-4 h-4 mr-1"}),"閉じる"]},"close")),e})()})]})]})});return c?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsx(oe,{className:"max-w-md w-full",children:d})}):d};function Re({formData:t,onFormDataChange:l,onSubmit:r,error:i,isLoading:c}){const[n,d]=e.useState(""),[o,x]=e.useState(!1),p=e=>{l(e)};return e.useEffect((()=>{const e=setTimeout((()=>{t.name.trim()?(async e=>{if(e.trim()){x(!0);try{const{data:s,error:a}=await ue.from("dog_parks").select("id, name").eq("name",e.trim()).limit(1);if(a)return void d("");s&&s.length>0?d("このドッグラン名は既に使用されています。別の名前を選択してください。"):d("")}catch(s){d("")}finally{x(!1)}}else d("")})(t.name):d("")}),500);return()=>clearTimeout(e)}),[t.name]),s.jsxs("div",{className:"max-w-2xl mx-auto",children:[s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[s.jsx(m,{className:"w-6 h-6 text-green-600"}),s.jsx("span",{className:"text-green-800 font-medium",children:"第一次審査/本人確認申請中"})]}),s.jsx("h1",{className:"text-2xl font-bold mb-2",children:"ドッグラン登録 - 詳細情報入力"}),s.jsx("p",{className:"text-gray-600",children:"第一次審査/本人確認申請中です。詳細な施設情報を入力してください。"})]}),s.jsx(oe,{className:"mb-6 bg-green-50 border-green-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(m,{className:"w-6 h-6 text-green-600"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-green-900",children:"第一次審査/本人確認申請中"}),s.jsx("p",{className:"text-sm text-green-800",children:"基本条件と本人確認を申請中です"})]})]}),s.jsx("div",{className:"text-right text-sm text-green-700",children:s.jsx("p",{children:"次のステップ: 第二審査（書類審査）"})})]})}),i&&s.jsx("div",{className:"mb-6 p-4 bg-red-50 rounded-lg",children:s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx(a,{className:"w-5 h-5 text-red-600 mt-0.5"}),s.jsx("p",{className:"text-sm text-red-800",children:i})]})}),s.jsx(oe,{className:"p-6",children:s.jsxs("form",{onSubmit:r,className:"space-y-6",children:[s.jsxs("div",{className:"mb-4",children:[s.jsx(pe,{label:"ドッグラン名 *",value:t.name,onChange:e=>p({name:e.target.value}),placeholder:"例: 渋谷中央ドッグラン",required:!0}),o&&s.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"名前の重複を確認中..."}),n&&s.jsxs("p",{className:"text-xs text-red-600 mt-1 flex items-start space-x-1",children:[s.jsx(a,{className:"w-3 h-3 mt-0.5 flex-shrink-0"}),s.jsx("span",{children:n})]})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"説明"}),s.jsx("textarea",{value:t.description,onChange:e=>p({description:e.target.value}),placeholder:"ドッグランの特徴や魅力をご紹介ください",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3})]}),s.jsx("div",{className:"mb-4",children:s.jsx(pe,{label:"住所 *",value:t.address,onChange:e=>p({address:e.target.value}),placeholder:"例: 東京都渋谷区道玄坂1-1-1",required:!0})}),s.jsxs("div",{className:"mb-4",children:[s.jsx(pe,{label:"最大収容頭数 *",type:"number",min:"1",value:t.maxCapacity,onChange:e=>p({maxCapacity:e.target.value}),placeholder:"例: 15",required:!0}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"同時に利用できる犬の最大頭数を入力してください"})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"対応犬種 *"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("label",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"checkbox",checked:t.largeDogArea,onChange:e=>p({largeDogArea:e.target.checked}),className:"rounded text-blue-600"}),s.jsx("span",{children:"大型犬エリア"})]}),s.jsxs("label",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"checkbox",checked:t.smallDogArea,onChange:e=>p({smallDogArea:e.target.checked}),className:"rounded text-blue-600"}),s.jsx("span",{children:"小型犬エリア"})]})]})]}),s.jsxs("div",{className:"mb-4",children:[s.jsxs("label",{className:"flex items-center space-x-2 mb-2",children:[s.jsx("input",{type:"checkbox",checked:t.privateBooths,onChange:e=>p({privateBooths:e.target.checked}),className:"rounded text-blue-600"}),s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"貸し切りブース"})]}),t.privateBooths&&s.jsx("div",{className:"ml-6",children:s.jsx(pe,{label:"貸し切りブース数",type:"number",min:"1",value:t.privateBoothCount,onChange:e=>p({privateBoothCount:e.target.value}),placeholder:"例: 2"})})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"設備・サービス（第一審査で選択した内容を確認・修正できます）"}),s.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries({parking:"駐車場",shower:"シャワー設備",restroom:"トイレ",agility:"アジリティ設備",rest_area:"休憩スペース",water_station:"給水設備"}).map((([e,a])=>s.jsxs("label",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"checkbox",checked:t.facilities[e],onChange:s=>p({facilities:{...t.facilities,[e]:s.target.checked}}),className:"rounded text-blue-600"}),s.jsx("span",{children:a})]},e)))})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"設備の詳細情報"}),s.jsx("textarea",{value:t.facilityDetails,onChange:e=>p({facilityDetails:e.target.value}),placeholder:"設備やサービスについての詳細な情報を入力してください",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3})]}),s.jsx(oe,{className:"bg-blue-50 border-blue-200",children:s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx($,{className:"w-5 h-5 text-blue-600 mt-0.5"}),s.jsxs("div",{className:"text-sm text-blue-800",children:[s.jsx("p",{className:"font-medium mb-1",children:"第二審査について"}),s.jsxs("ul",{className:"space-y-1 text-xs",children:[s.jsx("li",{children:"• 詳細な施設情報と必要書類の審査を行います"}),s.jsx("li",{children:"• 審査期間は通常3-5営業日です"}),s.jsx("li",{children:"• 通過後、QRコード実証検査の日程調整を行います"}),s.jsx("li",{children:"• 実証検査完了後、一般公開となります"})]})]})]})}),s.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[s.jsxs(h,{to:"/owner-payment-system",className:"text-blue-600 hover:text-blue-800 flex items-center",children:[s.jsx(M,{className:"w-4 h-4 mr-1"}),s.jsx("span",{className:"text-sm",children:"収益システムについて"})]}),s.jsx(xe,{type:"submit",isLoading:c,disabled:c||!!n||o,className:"bg-blue-600 hover:bg-blue-700",children:"第二審査に申し込む"})]}),n&&s.jsx("div",{className:"mt-2 p-3 bg-red-50 rounded-lg",children:s.jsxs("p",{className:"text-sm text-red-800 flex items-start space-x-2",children:[s.jsx(a,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),s.jsx("span",{children:"ドッグラン名に問題があります。名前を変更してから再度お試しください。"})]})})]})})]})}function Me({formData:t,onFormDataChange:l,onSubmit:r,error:i,profileData:c,profileLoading:n,onProfileUpdate:o}){const[x,m]=e.useState(!1),[p,u]=e.useState(!1),[j,g]=e.useState(c),b=e=>{l(e)};return s.jsxs("div",{className:"max-w-2xl mx-auto",children:[s.jsx("h1",{className:"text-2xl font-bold text-center mb-8",children:"ドッグラン登録 - 第一審査・本人確認"}),s.jsx(oe,{className:"mb-6 bg-blue-50 border-blue-200",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(z,{className:"w-6 h-6 text-blue-600 mt-1"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"新しい審査プロセスについて"}),s.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[s.jsxs("p",{children:[s.jsx("strong",{children:"第一審査・本人確認:"})," 基本的な条件の確認と本人確認書類の審査"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"第二審査:"})," 詳細な施設情報"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"スマートロック実証検査:"})," 実際の施設での動作確認"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"掲載・運営開始:"})," 一般公開と予約受付開始"]})]}),s.jsx("div",{className:"mt-3 flex items-center",children:s.jsxs(h,{to:"/owner-payment-system",className:"text-blue-600 hover:text-blue-800 flex items-center",children:[s.jsx(M,{className:"w-4 h-4 mr-1"}),s.jsx("span",{className:"text-sm font-medium",children:"料金体系と収益システムについて詳しく見る"})]})})]})]})}),s.jsx(oe,{className:"mb-6 bg-yellow-50 border-yellow-200",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(A,{className:"w-6 h-6 text-yellow-600 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-semibold text-yellow-900 mb-2",children:"登録情報の確認"}),s.jsxs("div",{className:"text-sm text-yellow-800 mb-4",children:[s.jsx("p",{children:"本人確認書類に記載された情報と一致するかご確認ください。"}),s.jsx("p",{children:"間違いがある場合は修正してから本人確認書類をアップロードしてください。"})]}),n?s.jsxs("div",{className:"flex items-center justify-center py-4",children:[s.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-yellow-600"}),s.jsx("span",{className:"ml-2 text-yellow-800",children:"プロフィール情報を読み込み中..."})]}):s.jsxs("div",{className:"bg-white p-4 rounded-lg border border-yellow-200",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"氏名"}),s.jsx("p",{className:"font-medium text-gray-900",children:c.name||"未設定"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"郵便番号"}),s.jsx("p",{className:"font-medium text-gray-900",children:c.postal_code||"未設定"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"住所"}),s.jsx("p",{className:"font-medium text-gray-900",children:c.address||"未設定"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"電話番号"}),s.jsx("p",{className:"font-medium text-gray-900",children:c.phone_number||"未設定"})]})]}),s.jsx("div",{className:"mt-4 flex justify-end",children:s.jsxs(xe,{variant:"secondary",onClick:()=>{g(c),u(!0)},className:"flex items-center",children:[s.jsx(N,{className:"w-4 h-4 mr-1"}),"情報を修正"]})})]})]})]})}),s.jsx(oe,{className:"mb-6 bg-green-50 border-green-200",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(d,{className:"w-6 h-6 text-green-600 mt-1"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-green-900 mb-2",children:"本人確認書類について"}),s.jsxs("div",{className:"text-sm text-green-800 space-y-1",children:[s.jsx("p",{children:"安全なプラットフォーム運営のため、ドッグランオーナーには本人確認が必要です。"}),s.jsx("p",{children:"運転免許証、マイナンバーカード、パスポートなどの本人確認書類の画像をアップロードしてください。"}),s.jsx("p",{children:"住所と氏名が登録情報と一致することを確認させていただきます。"})]})]})]})}),s.jsx(oe,{className:"mb-6 bg-orange-50 border-orange-200",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(U,{className:"w-6 h-6 text-orange-600 mt-1"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-orange-900 mb-2",children:"重要な注意事項"}),s.jsxs("div",{className:"text-sm text-orange-800 space-y-1",children:[s.jsx("p",{children:s.jsx("strong",{children:"本人確認書類の住所・氏名と上記の登録情報が一致している必要があります。"})}),s.jsx("p",{children:"一致しない場合は審査が通らない場合があります。"}),s.jsx("p",{children:"引っ越しなどで住所が変わった場合は、必ず上記の「情報を修正」から最新の情報に更新してください。"})]})]})]})}),p&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white p-6 rounded-lg max-w-md w-full mx-4",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"登録情報の修正"}),s.jsxs("div",{className:"space-y-4",children:[s.jsx(pe,{label:"氏名",value:j.name,onChange:e=>g({...j,name:e.target.value}),placeholder:"山田太郎"}),s.jsx(pe,{label:"郵便番号",value:j.postal_code,onChange:e=>g({...j,postal_code:e.target.value}),placeholder:"123-4567"}),s.jsx(pe,{label:"住所",value:j.address,onChange:e=>g({...j,address:e.target.value}),placeholder:"東京都新宿区西新宿1-1-1"}),s.jsx(pe,{label:"電話番号",value:j.phone_number,onChange:e=>g({...j,phone_number:e.target.value}),placeholder:"090-1234-5678"})]}),s.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[s.jsx(xe,{variant:"secondary",onClick:()=>u(!1),children:"キャンセル"}),s.jsx(xe,{onClick:()=>{o(j),u(!1)},disabled:n,children:"保存"})]})]})}),i&&s.jsx("div",{className:"mb-6 p-4 bg-red-50 rounded-lg",children:s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx(a,{className:"w-5 h-5 text-red-600 mt-0.5"}),s.jsx("p",{className:"text-sm text-red-800",children:i})]})}),s.jsx(oe,{className:"p-6",children:s.jsxs("form",{onSubmit:r,className:"space-y-6",children:[s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"現在ドッグランを運営していますか？ *"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("label",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"radio",name:"isCurrentlyOperating",value:"yes",checked:"yes"===t.isCurrentlyOperating,onChange:e=>b({isCurrentlyOperating:e.target.value}),className:"text-blue-600"}),s.jsx("span",{children:"はい（すでに運営中）"})]}),s.jsxs("label",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"radio",name:"isCurrentlyOperating",value:"no",checked:"no"===t.isCurrentlyOperating,onChange:e=>b({isCurrentlyOperating:e.target.value}),className:"text-blue-600"}),s.jsx("span",{children:"いいえ（新規開設予定）"})]})]}),"no"===t.isCurrentlyOperating&&s.jsx(s.Fragment,{children:s.jsxs("div",{className:"mt-4 pl-4 border-l-4 border-blue-200",children:[s.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"予定地はあなたの所有地ですか？ *"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("label",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"radio",name:"isOwnedLand",value:"yes",checked:"yes"===t.isOwnedLand,onChange:e=>b({isOwnedLand:e.target.value}),className:"text-blue-600"}),s.jsx("span",{children:"はい（所有地）"})]}),s.jsxs("label",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"radio",name:"isOwnedLand",value:"no",checked:"no"===t.isOwnedLand,onChange:e=>b({isOwnedLand:e.target.value}),className:"text-blue-600"}),s.jsx("span",{children:"いいえ（借用地）"})]})]}),"no"===t.isOwnedLand&&s.jsxs("div",{className:"mt-4 pl-4 border-l-4 border-yellow-200",children:[s.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"土地所有者の許可は得ていますか？ *"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("label",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"radio",name:"hasOwnerPermission",value:"yes",checked:"yes"===t.hasOwnerPermission,onChange:e=>b({hasOwnerPermission:e.target.value}),className:"text-blue-600"}),s.jsx("span",{children:"はい"})]}),s.jsxs("label",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"radio",name:"hasOwnerPermission",value:"no",checked:"no"===t.hasOwnerPermission,onChange:e=>b({hasOwnerPermission:e.target.value}),className:"text-blue-600"}),s.jsx("span",{children:"いいえ"})]})]})]}),s.jsxs("div",{className:"mt-4 pl-4 border-l-4 border-green-200",children:[s.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"近隣住民の理解は得ていますか？ *"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("label",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"radio",name:"hasNeighborConsent",value:"yes",checked:"yes"===t.hasNeighborConsent,onChange:e=>b({hasNeighborConsent:e.target.value}),className:"text-blue-600"}),s.jsx("span",{children:"はい"})]}),s.jsxs("label",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"radio",name:"hasNeighborConsent",value:"no",checked:"no"===t.hasNeighborConsent,onChange:e=>b({hasNeighborConsent:e.target.value}),className:"text-blue-600"}),s.jsx("span",{children:"いいえ"})]})]})]})]})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx(pe,{label:s.jsx("span",{className:"text-lg font-bold text-gray-800",children:"広さ（㎡） *"}),type:"number",min:"1",value:t.landArea,onChange:e=>b({landArea:e.target.value}),placeholder:"例: 500",required:!0}),s.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"ドッグランの運営には最低100㎡以上の広さが必要です"})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"施設までは週に1度程度、状況の確認やメンテナンスに行くことができますか？ *"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("label",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"radio",name:"canVisitWeekly",value:"yes",checked:"yes"===t.canVisitWeekly,onChange:e=>b({canVisitWeekly:e.target.value}),className:"text-blue-600"}),s.jsx("span",{children:"はい"})]}),s.jsxs("label",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"radio",name:"canVisitWeekly",value:"no",checked:"no"===t.canVisitWeekly,onChange:e=>b({canVisitWeekly:e.target.value}),className:"text-blue-600"}),s.jsx("span",{children:"いいえ"})]})]})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"緊急時（怪我や事故など）に1時間以内に施設に到着できますか？ *"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("label",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"radio",name:"canReachQuickly",value:"yes",checked:"yes"===t.canReachQuickly,onChange:e=>b({canReachQuickly:e.target.value}),className:"text-blue-600"}),s.jsx("span",{children:"はい"})]}),s.jsxs("label",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"radio",name:"canReachQuickly",value:"no",checked:"no"===t.canReachQuickly,onChange:e=>b({canReachQuickly:e.target.value}),className:"text-blue-600"}),s.jsx("span",{children:"いいえ"})]})]})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"反社会的勢力との関係はありますか？ *"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("label",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"radio",name:"isAntiSocialForces",value:"no",checked:"no"===t.isAntiSocialForces,onChange:e=>b({isAntiSocialForces:e.target.value}),className:"text-blue-600"}),s.jsx("span",{children:"いいえ（関係なし）"})]}),s.jsxs("label",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"radio",name:"isAntiSocialForces",value:"yes",checked:"yes"===t.isAntiSocialForces,onChange:e=>b({isAntiSocialForces:e.target.value}),className:"text-blue-600"}),s.jsx("span",{children:"はい（関係あり）"})]})]}),"yes"===t.isAntiSocialForces&&s.jsx("div",{className:"mt-2 p-3 bg-red-50 rounded-lg",children:s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx(q,{className:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0"}),s.jsx("p",{className:"text-sm text-red-800",children:"反社会的勢力との関係がある場合、ドッグランの登録はできません。当社は反社会的勢力との関係を一切認めておりません。"})]})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"本人確認書類のアップロード *"}),s.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[s.jsx(J,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),s.jsx("input",{type:"file",accept:"image/*,application/pdf",onChange:e=>{e.target.files&&e.target.files[0]&&b({identityDocument:e.target.files[0]})},className:"hidden",id:"identity-upload",required:!0}),s.jsx("label",{htmlFor:"identity-upload",className:"cursor-pointer text-blue-600 hover:text-blue-800 font-medium",children:"ファイルを選択"}),s.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"運転免許証・マイナンバーカード・パスポート等の画像またはPDF"}),s.jsx("p",{className:"text-sm text-gray-500",children:"最大ファイルサイズ: 10MB"}),t.identityDocument&&s.jsxs("p",{className:"text-sm text-green-600 mt-2",children:["選択されたファイル: ",t.identityDocument.name]})]})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"予定設備 *"}),s.jsx("div",{className:"grid grid-cols-2 gap-3",children:Object.entries({parking:"駐車場",shower:"シャワー設備",restroom:"トイレ",agility:"アジリティ設備",rest_area:"休憩スペース",water_station:"給水設備"}).map((([e,a])=>s.jsxs("label",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"checkbox",checked:t.facilities[e],onChange:s=>b({facilities:{...t.facilities,[e]:s.target.checked}}),className:"rounded text-blue-600"}),s.jsx("span",{className:"text-sm",children:a})]},e)))})]}),s.jsx(oe,{className:"bg-yellow-50 border-yellow-200",children:s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx(a,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),s.jsxs("div",{className:"text-sm text-yellow-800",children:[s.jsx("p",{className:"font-medium mb-1",children:"第一審査・本人確認について"}),s.jsxs("ul",{className:"space-y-1 text-xs",children:[s.jsx("li",{children:"• 基本的な開設条件を満たしているかを確認します"}),s.jsx("li",{children:"• 本人確認書類の住所・氏名が登録情報と一致することを確認します"}),s.jsx("li",{children:"• 通過後、詳細な施設情報の入力に進みます"}),s.jsx("li",{children:"• 第二審査では書類審査を行います"}),s.jsx("li",{children:"• 最終的にQRコード実証検査を経て掲載開始となります"})]})]})]})}),s.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[s.jsxs(h,{to:"/owner-payment-system",className:"text-blue-600 hover:text-blue-800 flex items-center",children:[s.jsx(M,{className:"w-4 h-4 mr-1"}),s.jsx("span",{className:"text-sm",children:"収益システムについて"})]}),s.jsxs(xe,{type:"submit",className:"w-1/2 bg-blue-600 hover:bg-blue-700",disabled:!t.identityDocument||x,isLoading:x,children:[s.jsx(d,{className:"w-4 h-4 mr-2"}),"第一審査・本人確認を申し込む"]})]})]})})]})}function ze({rejectedParks:l,onUpdateRejectedParks:r,onResubmit:i,onError:c}){const[n,d]=e.useState(!1),[o,x]=e.useState(null);return 0===l.length?null:s.jsxs(s.Fragment,{children:[s.jsx(oe,{className:"mb-6 bg-red-50 border-red-200",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(a,{className:"w-6 h-6 text-red-600 mt-1"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-red-900 mb-2",children:"却下された申請"}),s.jsx("p",{className:"text-sm text-red-800 mb-4",children:"以下の申請は審査の結果、却下されました。申請内容を見直して再提出するか、削除することができます。"}),s.jsx("div",{className:"space-y-4",children:l.map((e=>s.jsx("div",{className:"bg-white p-4 rounded-lg border border-red-200",children:s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium",children:e.name}),s.jsx("p",{className:"text-sm text-gray-600",children:e.address}),s.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["申請日: ",new Date(e.created_at).toLocaleDateString("ja-JP")]})]}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsxs(xe,{size:"sm",variant:"secondary",onClick:()=>i(e),children:[s.jsx(t,{className:"w-4 h-4 mr-1"}),"再申請"]}),s.jsxs(xe,{size:"sm",variant:"secondary",className:"text-red-600 hover:text-red-700",onClick:()=>x(e.id),children:[s.jsx(v,{className:"w-4 h-4 mr-1"}),"削除"]})]})]})},e.id)))})]})]})}),o&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"申請を削除しますか？"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"この操作は取り消せません。申請を削除してもよろしいですか？"}),s.jsxs("div",{className:"flex justify-end space-x-3",children:[s.jsx(xe,{variant:"secondary",onClick:()=>x(null),children:"キャンセル"}),s.jsxs(xe,{className:"bg-red-600 hover:bg-red-700",isLoading:n,onClick:()=>(async e=>{try{d(!0);const{error:s}=await ue.from("dog_parks").delete().eq("id",e);if(s)throw s;const a=l.filter((s=>s.id!==e));r(a),x(null)}catch(s){c(s.message||"ドッグランの削除に失敗しました")}finally{d(!1)}})(o),children:[s.jsx(v,{className:"w-4 h-4 mr-2"}),"削除する"]})]})]})})]})}const Ae=Object.freeze(Object.defineProperty({__proto__:null,ParkRegistration:function(){const a=k(),{user:t}=me(),[l,r]=e.useState(!1),[i,c]=e.useState(1),[n,d]=e.useState([]),[o,x]=e.useState(null),[m,h]=e.useState({name:"",postal_code:"",address:"",phone_number:"",email:""}),[p,u]=e.useState(!1),[j,g]=e.useState(!1),{error:b,clearError:N,handleError:f,executeWithErrorHandling:y}=be(),v=Ne(fe.api),[w,_]=e.useState({isCurrentlyOperating:"",isOwnedLand:"",hasOwnerPermission:"",hasNeighborConsent:"",landArea:"",isAntiSocialForces:"",canVisitWeekly:"",canReachQuickly:"",identityDocument:null,name:"",description:"",address:"",maxCapacity:"10",largeDogArea:!0,smallDogArea:!0,privateBooths:!1,privateBoothCount:"0",facilities:{parking:!1,shower:!1,restroom:!1,agility:!1,rest_area:!1,water_station:!1},facilityDetails:""});e.useEffect((()=>{t?(S(),C(),D()):a("/login")}),[t,a]);const S=async()=>{await y((async()=>{const{data:e,error:s}=await ue.from("dog_parks").select("*").eq("owner_id",null==t?void 0:t.id).eq("status","rejected");if(s)throw s;d(e||[])}),{operation:"fetch_rejected_parks"})},C=async()=>{await y((async()=>{const{data:e,error:s}=await ue.from("owner_verifications").select("status").eq("user_id",null==t?void 0:t.id).single();if(s&&"PGRST116"!==s.code)throw s;x((null==e?void 0:e.status)||null)}),{operation:"check_identity_verification"})},D=async()=>{await y((async()=>{u(!0);const{data:e,error:s}=await ue.from("profiles").select("name, postal_code, address, phone_number, email").eq("id",null==t?void 0:t.id).single();if(s)throw s;h(e||{name:"",postal_code:"",address:"",phone_number:"",email:""})}),{operation:"fetch_profile_data"}),u(!1)},T=e=>{_((s=>({...s,...e})))};return 1===i?s.jsxs("div",{children:[s.jsx(Fe,{error:b,onClear:N,className:"mb-6"}),s.jsx(ze,{rejectedParks:n,onUpdateRejectedParks:e=>{d(e)},onResubmit:e=>{_((s=>{var a,t;return{...s,name:e.name,description:e.description||"",address:e.address,maxCapacity:(null==(a=e.max_capacity)?void 0:a.toString())||"10",largeDogArea:e.large_dog_area||!0,smallDogArea:e.small_dog_area||!0,privateBooths:e.private_booths||!1,privateBoothCount:(null==(t=e.private_booth_count)?void 0:t.toString())||"0",facilities:e.facilities||{parking:!1,shower:!1,restroom:!1,agility:!1,rest_area:!1,water_station:!1},facilityDetails:e.facility_details||""}})),c(2)},onError:f}),s.jsx(Me,{formData:w,onFormDataChange:T,onSubmit:async e=>{e.preventDefault(),await y((async()=>{if((e=>{if(!e.isCurrentlyOperating)throw new Error("現在の運営状況を選択してください。");if("no"===e.isCurrentlyOperating){if(!e.isOwnedLand)throw new Error("予定地の所有状況を選択してください。");if("no"===e.isOwnedLand&&!e.hasOwnerPermission)throw new Error("土地所有者の許可について選択してください。");if(!e.hasNeighborConsent)throw new Error("近隣住民の理解について選択してください。")}if(!e.landArea||parseInt(e.landArea)<=0)throw new Error("広さを正しく入力してください。");if(!e.isAntiSocialForces)throw new Error("反社会的勢力との関係について選択してください。");if("yes"===e.isAntiSocialForces)throw new Error("反社会的勢力との関係がある場合、ドッグランの登録はできません。");if(!e.canVisitWeekly)throw new Error("週1回の訪問可否について選択してください。");if(!e.canReachQuickly)throw new Error("緊急時の到着可否について選択してください。");if(!e.identityDocument)throw new Error("本人確認書類をアップロードしてください。");if("no"===e.isCurrentlyOperating){if("no"===e.isOwnedLand&&"no"===e.hasOwnerPermission)throw new Error("土地所有者の許可を得てからお申し込みください。借用地でのドッグラン運営には所有者の同意が必要です。");if("no"===e.hasNeighborConsent)throw new Error("近隣住民の理解を得てからお申し込みください。地域との良好な関係は運営において重要です。")}if(parseInt(e.landArea)<100)throw new Error("ドッグランの運営には最低100㎡以上の広さが必要です。");if("no"===e.canVisitWeekly)throw new Error("週に1度程度の訪問が必要です。施設の状況確認やメンテナンスのため、定期的な訪問ができる方のみお申し込みください。");if("no"===e.canReachQuickly)throw new Error("緊急時に1時間以内に施設に到着できることが必要です。迅速な対応ができる方のみお申し込みください。")})(w),!t)throw new Error("ユーザー情報が取得できません。再度ログインしてください。");r(!0);try{if(w.identityDocument){const e=`identity_${t.id}_${Date.now()}_${w.identityDocument.name}`,{data:s,error:a}=await ue.storage.from("vaccine-certs").upload(e,w.identityDocument,{upsert:!0});if(a)throw new Error(`ファイルアップロードに失敗しました: ${a.message}`);const l={user_id:t.id,verification_id:s.path,status:"pending",verification_data:{document_url:s.path,uploaded_at:(new Date).toISOString(),file_name:w.identityDocument.name,file_size:w.identityDocument.size,file_type:w.identityDocument.type,application_stage:"first_stage"}},{error:r}=await ue.from("owner_verifications").upsert(l,{onConflict:"user_id"});if(r)throw new Error(`データベース保存に失敗しました: ${r.message}`)}c(2),window.scrollTo({top:0,behavior:"smooth"})}catch(e){const s=e instanceof Error?e.message:"申込みに失敗しました。";throw new Error(s)}finally{r(!1)}}),{operation:"first_stage_submission"})},error:(null==b?void 0:b.userMessage)||"",profileData:m,profileLoading:p,onProfileUpdate:async e=>{await y((async()=>{u(!0);const{error:s}=await ue.from("profiles").update(e).eq("id",null==t?void 0:t.id);if(s)throw s;h(e),g(!1)}),{operation:"update_profile_data"}),u(!1)}})]}):s.jsxs("div",{children:[s.jsx(Fe,{error:b,onClear:N,...v.state.isRetrying?{}:{onRetry:()=>v.execute((()=>Promise.resolve()))},className:"mb-6"}),v.state.isRetrying&&s.jsx("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-blue-800 font-medium",children:"自動リトライ中..."}),s.jsxs("p",{className:"text-blue-600 text-sm",children:["試行回数: ",v.state.attempts+1,"/",fe.api.maxAttempts,v.state.nextRetryIn>0&&` | 次の試行まで: ${v.state.nextRetryIn}秒`]})]}),s.jsx("button",{onClick:v.cancelRetry,className:"text-blue-600 hover:text-blue-800 text-sm underline",children:"キャンセル"})]})}),2===i&&s.jsx(Re,{formData:w,onFormDataChange:T,onSubmit:async e=>{e.preventDefault(),r(!0),N();try{await y((async()=>{const{data:{user:e},error:s}=await ue.auth.getUser();if(s||!e)throw new Error("ユーザー認証に失敗しました。再度ログインしてください。");const{error:t}=await ue.from("profiles").update({user_type:"owner"}).eq("id",e.id);if(t)throw new Error("プロフィールの更新に失敗しました。");const l={owner_id:e.id,name:w.name,description:w.description,address:w.address,price:800,max_capacity:parseInt(w.maxCapacity,10),large_dog_area:w.largeDogArea,small_dog_area:w.smallDogArea,private_booths:w.privateBooths,private_booth_count:parseInt(w.privateBoothCount,10),private_booth_price:0,facilities:w.facilities,facility_details:w.facilityDetails,status:"pending"},{error:r}=await ue.from("dog_parks").insert([l]);if(r)throw r;setTimeout((()=>{a("/owner-dashboard")}),100)}))}catch(s){f(s instanceof Error?s:new Error("不明なエラーが発生しました。"))}finally{r(!1)}},error:(null==b?void 0:b.userMessage)||"",isLoading:l})]})}},Symbol.toStringTag,{value:"Module"}));function Ue({lockId:l,parkName:r="ドッグパーク",purpose:i="entry",className:c="",onSuccess:d,onError:o,reservationId:x}){const{user:h}=me(),[p,b]=e.useState(null),[N,f]=e.useState(null),[y,v]=e.useState(null),[w,_]=e.useState(!1),[k,S]=e.useState(null),[C,D]=e.useState(!1),[T,P]=e.useState(!1),[I,$]=e.useState(!1),[E,O]=e.useState("");e.useEffect((()=>{if(p&&N){const e=setInterval((()=>{const s=new Date,a=N.getTime()-s.getTime();if(a<=0)v("期限切れ"),b(null),f(null),clearInterval(e);else{const e=Math.floor(a/6e4),s=Math.floor(a%6e4/1e3);v(`${e}:${s.toString().padStart(2,"0")}`)}}),1e3);return()=>clearInterval(e)}}),[p,N]);const q=async()=>{if(h){_(!0),S(null);try{const{data:{session:e}}=await ue.auth.getSession();if(!(null==e?void 0:e.access_token))throw new Error("認証が必要です");let s=5,a=null;if(x){const e=await(async e=>{try{const{data:s,error:a}=await ue.from("reservations").select("\n          *,\n          dog_park:dog_parks(*),\n          dog:dogs(*)\n        ").eq("id",e).single();return a?null:s}catch(s){return null}})(x);if(e&&"whole_facility"===e.reservation_type&&(a=(e=>{try{const s=new Date(e.date),a=e.start_time.split(":").map(Number),t=a[0]??0,l=a[1]??0;return s.setHours(t,l,0,0),new Date(s.getTime()+60*e.duration*60*1e3)}catch(s){return null}})(e),a)){const e=new Date,t=a.getTime()-e.getTime();s=Math.max(1,Math.ceil(t/6e4))}}const t=await fetch("/functions/v1/generate-pin",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.access_token}`},body:JSON.stringify({lock_id:l,purpose:i,expiry_minutes:s,reservation_id:x||void 0})});if(!t.ok){const e=await t.json();throw new Error(e.error||"PINコードの生成に失敗しました")}const{pin:r,expires_at:c}=await t.json();b(r),f(new Date(c)),P(!0),d&&d(r),setTimeout((()=>{P(!1)}),3e3)}catch(e){const s=e instanceof Error?e.message:"PINコードの生成に失敗しました";if(s.startsWith("PAYMENT_REQUIRED:")){const e=s.replace("PAYMENT_REQUIRED:","").trim();O(e),$(!0),S(null)}else S(s),$(!1);o&&o(s)}finally{_(!1)}}};return s.jsx(oe,{className:`p-4 ${c}`,children:s.jsxs("div",{className:"text-center",children:[s.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center justify-center",children:[s.jsx(u,{className:"w-5 h-5 text-blue-600 mr-2"}),r,"の","entry"===i?"入口":"出口"]}),p?s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border-2 border-blue-200 mx-auto",children:[s.jsx("p",{className:"text-sm text-blue-800 mb-1",children:"PINコード:"}),s.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[s.jsx("p",{className:"text-3xl font-bold tracking-widest text-blue-700",children:p}),s.jsx("button",{onClick:()=>{p&&navigator.clipboard.writeText(p).then((()=>{D(!0),setTimeout((()=>D(!1)),2e3)})).catch((()=>{}))},className:"p-1 text-blue-600 hover:text-blue-800 transition-colors",title:"コピー",children:C?s.jsx(m,{className:"w-5 h-5"}):s.jsx(W,{className:"w-5 h-5"})})]})]}),s.jsx("div",{className:"bg-yellow-50 p-2 rounded-lg",children:s.jsxs("div",{className:"flex items-center justify-center space-x-2 text-yellow-800",children:[s.jsx(n,{className:"w-4 h-4"}),s.jsxs("span",{className:"font-medium",children:["有効期限: ",y]})]})}),s.jsx("div",{className:"flex justify-center space-x-3",children:s.jsxs(xe,{onClick:()=>{q()},variant:"secondary",size:"sm",isLoading:w,children:[s.jsx(t,{className:"w-4 h-4 mr-1"}),"再生成"]})}),s.jsxs("p",{className:"text-xs text-gray-500",children:["entry"===i?"入場":"退場","時にスマートロックのキーパッドに上記のPINコードを入力してください"]})]}):s.jsxs("div",{className:"space-y-4",children:[s.jsxs("p",{className:"text-gray-600 mb-4",children:["entry"===i?"入場":"退場","用のPINコードを生成します。",s.jsx("br",{}),"生成されたPINコードは5分間有効です。"]}),k&&s.jsxs("div",{className:"bg-red-50 p-3 rounded-lg flex items-center justify-center text-red-600",children:[s.jsx(a,{className:"w-4 h-4 mr-1"}),s.jsx("span",{children:k})]}),I&&s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[s.jsxs("div",{className:"flex items-start space-x-3 mb-4",children:[s.jsx(j,{className:"w-6 h-6 text-blue-600 mt-1 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"決済が必要です"}),s.jsx("p",{className:"text-sm text-blue-800 mb-4",children:E})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs(xe,{onClick:()=>window.location.href="/subscription",className:"w-full bg-purple-600 hover:bg-purple-700",children:[s.jsx(j,{className:"w-4 h-4 mr-2"}),"サブスクリプションに加入（¥3,800/月）"]}),s.jsxs(xe,{onClick:()=>window.location.href="/parks",variant:"secondary",className:"w-full",children:[s.jsx(g,{className:"w-4 h-4 mr-2"}),"1日券を購入（¥800）"]})]}),s.jsxs("p",{className:"text-xs text-blue-700 mt-3",children:["• サブスクリプション：全国のドッグランが使い放題",s.jsx("br",{}),"• 1日券：選択したドッグランで24時間利用可能"]})]}),T&&s.jsxs("div",{className:"bg-green-50 p-3 rounded-lg flex items-center justify-center text-green-600",children:[s.jsx(m,{className:"w-4 h-4 mr-1"}),s.jsx("span",{children:"PINコードを生成しました"})]}),s.jsxs(xe,{onClick:()=>{q()},isLoading:w,className:"w-full",children:[s.jsx(u,{className:"w-4 h-4 mr-2"}),"entry"===i?"入場":"退場","用PINを生成"]})]})]})})}const Je=e=>e?new Date(e).toISOString():null,We=Object.freeze(Object.defineProperty({__proto__:null,ParkManagement:function(){const{parkId:t}=_(),{user:r}=me(),i=k(),[d,o]=e.useState(null),[x,p]=e.useState(!0),[j,b]=e.useState(""),[v,w]=e.useState(""),[C,D]=e.useState("overview"),[T,P]=e.useState([]),[I,E]=e.useState(null),[O,q]=e.useState("entry"),[L,F]=e.useState([]),[R,A]=e.useState([]),[U,J]=e.useState([]),[W,Y]=e.useState(!1),[K,Z]=e.useState({title:"",description:"",start_date:"",end_date:"",is_emergency:!1,notify_users:!0}),[X,ee]=e.useState(!1),[se,ae]=e.useState(!1),[te,le]=e.useState(!1),[re,ie]=e.useState({max_capacity:0,facilities:{parking:!1,shower:!1,restroom:!1,agility:!1,rest_area:!1,water_station:!1},large_dog_area:!1,small_dog_area:!1,private_booths:!1,private_booth_count:0,facility_details:"",description:""});e.useEffect((()=>{r&&t?ce():i("/owner-dashboard")}),[r,t,i]),e.useEffect((()=>{(async()=>{if(r)try{const{data:e,error:s}=await ue.from("dogs").select("\n            *,\n            vaccine_certifications (\n              id,\n              status,\n              rabies_expiry_date,\n              combo_expiry_date,\n              approved_at\n            )\n          ").eq("owner_id",r.id);if(s)throw s;const a=(e||[]).filter((e=>"approved"===ve(e)));F(a)}catch(e){}})()}),[r]);const ce=async()=>{try{p(!0);const{data:e,error:s}=await ue.from("dog_parks").select("*").eq("id",t).eq("owner_id",null==r?void 0:r.id).single();if(s)throw s;if(!e)return void i("/owner-dashboard");o(e),ie({max_capacity:e.max_capacity||0,facilities:e.facilities||{parking:!1,shower:!1,restroom:!1,agility:!1,rest_area:!1,water_station:!1},large_dog_area:e.large_dog_area||!1,small_dog_area:e.small_dog_area||!1,private_booths:e.private_booths||!1,private_booth_count:e.private_booth_count||0,facility_details:e.facility_details||"",description:e.description||""});const{data:a,error:l}=await ue.from("smart_locks").select("*").eq("park_id",t);if(l)throw l;P(a||[]),a&&a.length>0&&E(a[0]);const{data:c,error:n}=await ue.from("dogs").select("\n          *,\n          vaccine_certifications!inner(*)\n        ").eq("owner_id",null==r?void 0:r.id).eq("vaccine_certifications.status","approved");if(n)throw n;F(c||[]),await ne()}catch(e){b("データの取得に失敗しました。")}finally{p(!1)}},ne=async()=>{try{const{data:e,error:s}=await ue.from("park_maintenance").select("*").eq("park_id",t).order("start_date",{ascending:!1});if(s)throw s;J(e||[])}catch(e){}},de=e=>"オス"===e?"くん":"ちゃん",he=e=>e?new Date(e).toLocaleString("ja-JP",{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit",timeZone:"Asia/Tokyo"}):"未設定";return x?s.jsx("div",{className:"flex justify-center items-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):d?s.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[s.jsx("div",{className:"flex items-center space-x-4 mb-6",children:s.jsxs(h,{to:"/owner-dashboard",className:"flex items-center text-blue-600 hover:text-blue-800",children:[s.jsx(Q,{className:"w-4 h-4 mr-2"}),"ダッシュボードに戻る"]})}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsxs("h1",{className:"text-2xl font-bold text-gray-900 mb-2 flex items-center",children:[s.jsx($,{className:"w-8 h-8 text-blue-600 mr-3"}),d.name,"の管理"]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(l,{className:"w-4 h-4 text-gray-500"}),s.jsx("p",{className:"text-gray-600",children:d.address})]})]}),s.jsxs("div",{className:"flex space-x-3",children:[s.jsx(h,{to:`/parks/${d.id}`,children:s.jsxs(xe,{variant:"secondary",children:[s.jsx(B,{className:"w-4 h-4 mr-2"}),"公開ページを見る"]})}),s.jsxs(xe,{onClick:()=>ae(!0),children:[s.jsx(N,{className:"w-4 h-4 mr-2"}),"設定を編集"]})]})]}),j&&s.jsxs("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4 flex items-start",children:[s.jsx(a,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),s.jsx("p",{children:j})]}),v&&s.jsxs("div",{className:"bg-green-100 border border-green-300 text-green-800 rounded-lg p-4 flex items-start",children:[s.jsx(m,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),s.jsx("p",{children:v})]}),s.jsxs("div",{className:"flex space-x-4 border-b",children:[s.jsxs("button",{className:"px-4 py-2 font-medium "+("overview"===C?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>D("overview"),children:[s.jsx($,{className:"w-4 h-4 inline mr-2"}),"概要"]}),s.jsxs("button",{className:"px-4 py-2 font-medium "+("stats"===C?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>D("stats"),children:[s.jsx(y,{className:"w-4 h-4 inline mr-2"}),"統計・収益"]}),s.jsxs("button",{className:"px-4 py-2 font-medium "+("pins"===C?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>D("pins"),children:[s.jsx(u,{className:"w-4 h-4 inline mr-2"}),"PINコード管理"]}),s.jsxs("button",{className:"px-4 py-2 font-medium "+("settings"===C?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>D("settings"),children:[s.jsx(G,{className:"w-4 h-4 inline mr-2"}),"設定"]})]}),"overview"===C&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs(oe,{className:"p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[s.jsx(z,{className:"w-6 h-6 text-blue-600 mr-2"}),"基本情報"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold mb-3",children:"施設情報"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("p",{children:[s.jsx("span",{className:"font-medium",children:"住所:"})," ",d.address]}),s.jsxs("p",{children:[s.jsx("span",{className:"font-medium",children:"ステータス:"})," ","approved"===d.status?"運営中":"審査中"]}),s.jsxs("p",{children:[s.jsx("span",{className:"font-medium",children:"料金:"})," ¥",d.price,"/日"]}),s.jsxs("p",{children:[s.jsx("span",{className:"font-medium",children:"最大収容人数:"})," ",d.max_capacity,"人"]}),s.jsxs("p",{children:[s.jsx("span",{className:"font-medium",children:"現在の利用者数:"})," ",d.current_occupancy,"人"]}),s.jsxs("p",{children:[s.jsx("span",{className:"font-medium",children:"評価:"})," ★",d.average_rating.toFixed(1)," (",d.review_count,"件)"]})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold mb-3",children:"設備情報"}),s.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries({parking:"駐車場",shower:"シャワー設備",restroom:"トイレ",agility:"アジリティ設備",rest_area:"休憩スペース",water_station:"給水設備"}).map((([e,a])=>s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-4 h-4 rounded "+(d.facilities[e]?"bg-green-500":"bg-gray-300")}),s.jsx("span",{className:"text-sm",children:a})]},e)))}),s.jsxs("div",{className:"mt-4 space-y-2",children:[s.jsxs("p",{children:[s.jsx("span",{className:"font-medium",children:"大型犬エリア:"})," ",d.large_dog_area?"あり":"なし"]}),s.jsxs("p",{children:[s.jsx("span",{className:"font-medium",children:"小型犬エリア:"})," ",d.small_dog_area?"あり":"なし"]}),s.jsxs("p",{children:[s.jsx("span",{className:"font-medium",children:"プライベートブース:"})," ",d.private_booths?`${d.private_booth_count}室`:"なし"]})]})]})]})]}),s.jsxs(oe,{className:"p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[s.jsx(g,{className:"w-6 h-6 text-blue-600 mr-2"}),"今日の統計"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(g,{className:"w-5 h-5 text-blue-600"}),s.jsx("h4",{className:"font-medium text-blue-900",children:"今日の予約"})]}),s.jsx("p",{className:"text-2xl font-bold text-blue-600",children:"5件"}),s.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"前日比 +2件"})]}),s.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(M,{className:"w-5 h-5 text-green-600"}),s.jsx("h4",{className:"font-medium text-green-900",children:"今日の収益"})]}),s.jsx("p",{className:"text-2xl font-bold text-green-600",children:"¥4,000"}),s.jsx("p",{className:"text-xs text-green-700 mt-1",children:"前日比 +¥1,600"})]}),s.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(c,{className:"w-5 h-5 text-purple-600"}),s.jsx("h4",{className:"font-medium text-purple-900",children:"利用者数"})]}),s.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:[d.current_occupancy,"人"]}),s.jsxs("p",{className:"text-xs text-purple-700 mt-1",children:["最大: ",d.max_capacity,"人"]})]})]})]}),s.jsxs(oe,{className:"p-6",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[s.jsx(V,{className:"w-6 h-6 text-blue-600 mr-2"}),"施設画像"]}),s.jsx(h,{to:`/parks/${d.id}/second-stage`,children:s.jsxs(xe,{size:"sm",children:[s.jsx(N,{className:"w-4 h-4 mr-2"}),"画像を管理"]})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[d.image_url?s.jsx("div",{className:"h-48 rounded-lg overflow-hidden",children:s.jsx("img",{src:d.image_url,alt:`${d.name} - メイン画像`,className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://via.placeholder.com/400x300?text=No+Image"}})}):s.jsx("div",{className:"h-48 bg-gray-100 rounded-lg flex items-center justify-center",children:s.jsx("p",{className:"text-gray-500",children:"メイン画像なし"})}),d.cover_image_url?s.jsx("div",{className:"h-48 rounded-lg overflow-hidden",children:s.jsx("img",{src:d.cover_image_url,alt:`${d.name} - カバー画像`,className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://via.placeholder.com/400x300?text=No+Image"}})}):s.jsx("div",{className:"h-48 bg-gray-100 rounded-lg flex items-center justify-center",children:s.jsx("p",{className:"text-gray-500",children:"カバー画像なし"})}),s.jsx("div",{className:"h-48 bg-gray-100 rounded-lg flex items-center justify-center",children:s.jsxs(h,{to:`/parks/${d.id}/second-stage`,className:"text-blue-600 hover:text-blue-800 flex flex-col items-center",children:[s.jsx(V,{className:"w-8 h-8 mb-2"}),s.jsx("p",{children:"その他の画像を管理"})]})})]})]})]}),"stats"===C&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs(oe,{className:"p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[s.jsx(y,{className:"w-6 h-6 text-blue-600 mr-2"}),"利用統計"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(g,{className:"w-5 h-5 text-blue-600"}),s.jsx("h4",{className:"font-medium text-blue-900",children:"今月の予約"})]}),s.jsx("p",{className:"text-2xl font-bold text-blue-600",children:"32件"}),s.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"前月比 +12%"})]}),s.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(M,{className:"w-5 h-5 text-green-600"}),s.jsx("h4",{className:"font-medium text-green-900",children:"今月の収益"})]}),s.jsx("p",{className:"text-2xl font-bold text-green-600",children:"¥25,600"}),s.jsx("p",{className:"text-xs text-green-700 mt-1",children:"前月比 +8%"})]}),s.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(c,{className:"w-5 h-5 text-purple-600"}),s.jsx("h4",{className:"font-medium text-purple-900",children:"利用者数"})]}),s.jsx("p",{className:"text-2xl font-bold text-purple-600",children:"128人"}),s.jsx("p",{className:"text-xs text-purple-700 mt-1",children:"前月比 +15%"})]})]}),s.jsx("div",{className:"h-64 bg-gray-100 rounded-lg flex items-center justify-center",children:s.jsx("p",{className:"text-gray-500",children:"利用統計グラフ（実装予定）"})})]}),s.jsxs(oe,{className:"p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[s.jsx(M,{className:"w-6 h-6 text-blue-600 mr-2"}),"収益情報"]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"font-semibold text-blue-900 mb-3",children:"収益配分"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-blue-800 mb-1",children:"オーナー取り分（80%）"}),s.jsx("p",{className:"text-2xl font-bold text-blue-600",children:"¥20,480"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-blue-800 mb-1",children:"プラットフォーム手数料（20%）"}),s.jsx("p",{className:"text-2xl font-bold text-blue-600",children:"¥5,120"})]})]})]}),s.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"font-semibold text-green-900 mb-3",children:"収益内訳"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-green-800 mb-1",children:"通常利用"}),s.jsx("p",{className:"text-xl font-bold text-green-600",children:"¥12,800"}),s.jsx("p",{className:"text-xs text-green-700",children:"16件"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-green-800 mb-1",children:"施設貸し切り"}),s.jsx("p",{className:"text-xl font-bold text-green-600",children:"¥8,800"}),s.jsx("p",{className:"text-xs text-green-700",children:"2件"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-green-800 mb-1",children:"プライベートブース"}),s.jsx("p",{className:"text-xl font-bold text-green-600",children:"¥4,000"}),s.jsx("p",{className:"text-xs text-green-700",children:"2件"})]})]})]}),s.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"font-semibold text-purple-900 mb-3",children:"振込情報"}),s.jsx("p",{className:"text-sm text-purple-800 mb-2",children:"振込は毎月15日に前月分を一括で行います。振込手数料は当社負担です。"}),s.jsx(h,{to:"/owner-payment-system",children:s.jsxs(xe,{size:"sm",className:"bg-purple-600 hover:bg-purple-700",children:[s.jsx(M,{className:"w-4 h-4 mr-2"}),"振込情報を確認"]})})]})]})]})]}),"pins"===C&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs(oe,{className:"p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[s.jsx(u,{className:"w-6 h-6 text-blue-600 mr-2"}),"オーナー用PINコード発行"]}),s.jsx("div",{className:"bg-blue-50 p-4 rounded-lg mb-6",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(m,{className:"w-5 h-5 text-blue-600 mt-1 flex-shrink-0"}),s.jsxs("div",{className:"text-sm text-blue-800",children:[s.jsx("p",{className:"font-medium mb-1",children:"オーナー特権"}),s.jsx("p",{children:"オーナーは決済不要でPINコードを発行できます。施設の管理やメンテナンスに使用してください。"}),s.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[s.jsx("li",{children:"PINコードは5分間有効です"}),s.jsx("li",{children:"入場・退場それぞれでPINコードが必要です"}),s.jsx("li",{children:"スタッフと共有することもできます"}),s.jsx("li",{children:"入場する犬を選択してください"})]})]})]})}),s.jsxs("div",{className:"flex justify-center space-x-4 mb-4",children:[s.jsxs("button",{className:"px-6 py-3 rounded-lg flex items-center space-x-2 "+("entry"===O?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),onClick:()=>q("entry"),children:[s.jsx(Q,{className:"w-5 h-5"}),s.jsx("span",{children:"入場"})]}),s.jsxs("button",{className:"px-6 py-3 rounded-lg flex items-center space-x-2 "+("exit"===O?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),onClick:()=>q("exit"),children:[s.jsx(Q,{className:"w-5 h-5 rotate-180"}),s.jsx("span",{children:"退場"})]})]}),T.length>0&&s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"スマートロックを選択"}),s.jsx("select",{value:(null==I?void 0:I.id)||"",onChange:e=>{const s=T.find((s=>s.id===e.target.value));E(s||null)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:T.map((e=>s.jsx("option",{value:e.id,children:e.lock_name},e.id)))})]}),s.jsxs("div",{className:"mb-6",children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["入場するワンちゃんを選択（最大",3,"頭）"]}),0===L.length?s.jsx("div",{className:"p-4 bg-yellow-50 rounded-lg",children:s.jsxs("p",{className:"text-yellow-800",children:["ワクチン接種証明書が承認されたワンちゃんがいません。",s.jsx(h,{to:"/register-dog",className:"text-blue-600 hover:underline ml-1",children:"ワンちゃんを登録する"})]})}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:L.map((e=>{const a=R.includes(e.id),t=!a&&R.length>=3;return s.jsxs("div",{className:"p-4 border-2 rounded-lg cursor-pointer transition-colors relative "+(a?"border-green-500 bg-green-50":t?"border-gray-200 bg-gray-50 opacity-50 cursor-not-allowed":"border-gray-200 hover:border-gray-300"),onClick:()=>{return!t&&(s=e.id,void A((e=>e.includes(s)?e.filter((e=>e!==s)):e.length>=3?(b("最大3頭まで選択可能です。"),e):(b(""),[...e,s]))));var s},children:[a&&s.jsx("div",{className:"absolute top-2 right-2 w-6 h-6 bg-green-500 text-white rounded-full flex items-center justify-center",children:s.jsx(m,{className:"w-4 h-4"})}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center overflow-hidden",children:e.image_url?s.jsx("img",{src:e.image_url,alt:e.name,className:"w-full h-full object-cover"}):s.jsx("div",{className:"w-6 h-6 text-gray-500",children:"🐾"})}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[s.jsxs("h3",{className:"font-semibold",children:[e.name,de(e.gender)]}),s.jsx(ye,{status:ve(e),size:"sm"})]}),s.jsxs("p",{className:"text-sm text-gray-600",children:[e.breed," • ",e.gender]})]})]})]},e.id)}))}),R.length>0&&s.jsxs("div",{className:"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:[s.jsx("h4",{className:"font-medium text-green-900 mb-1",children:"選択中のワンちゃん"}),s.jsx("p",{className:"text-sm text-green-800",children:R.map((e=>{const s=L.find((s=>s.id===e));return s?`${s.name}${de(s.gender)}`:""})).filter((e=>e)).join("、")}),s.jsxs("p",{className:"text-xs text-green-700 mt-1",children:[R.length,"頭が同時入場できます"]})]})]}),I?s.jsx("div",{className:"mt-6",children:R.length>0?s.jsx(Ue,{lockId:I.lock_id,parkName:d.name,purpose:O,onSuccess:e=>{w(`PINコードを生成しました: ${e}`),setTimeout((()=>{w("")}),3e3)},onError:e=>{b(e),setTimeout((()=>{b("")}),5e3)}}):s.jsxs("div",{className:"p-4 bg-yellow-50 rounded-lg text-center",children:[s.jsx(a,{className:"w-6 h-6 text-yellow-600 mx-auto mb-2"}),s.jsx("p",{className:"text-yellow-800 font-medium",children:"ワンちゃんを1頭以上選択してください"}),s.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"PINコードを発行するには、入場するワンちゃんを選択する必要があります"})]})}):s.jsxs("div",{className:"text-center py-8",children:[s.jsx(u,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"スマートロックが設定されていません"}),s.jsx(xe,{onClick:()=>D("settings"),children:"スマートロックを設定する"})]})]}),s.jsx(oe,{className:"p-6 bg-blue-50 border-blue-200",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(u,{className:"w-6 h-6 text-blue-600 mt-1"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"PINコードについて"}),s.jsxs("div",{className:"text-sm text-blue-800 space-y-2",children:[s.jsx("p",{children:"• 利用者はPINコードを使用して入退場します"}),s.jsx("p",{children:"• PINコードは5分間有効で、利用者が支払い後に発行されます"}),s.jsx("p",{children:"• オーナーは決済不要でPINコードを発行できます"}),s.jsx("p",{children:"• 施設貸し切りの場合、利用者は友達にPINコードを共有できます"})]})]})]})})]}),"settings"===C&&s.jsxs("div",{className:"space-y-6",children:[se&&s.jsxs(oe,{className:"p-6 bg-blue-50 border-blue-200",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h3",{className:"text-xl font-semibold text-blue-900",children:"施設情報の編集"}),s.jsx("button",{onClick:()=>ae(!1),className:"text-blue-600 hover:text-blue-800",children:s.jsx(S,{className:"w-5 h-5"})})]}),s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),d&&r){le(!0);try{if(re.max_capacity<1)throw new Error("収容人数は1人以上で入力してください。");if(re.private_booths&&re.private_booth_count<1)throw new Error("プライベートブースがある場合は、部屋数を1以上で入力してください。");const{error:e}=await ue.from("dog_parks").update({max_capacity:re.max_capacity,facilities:re.facilities,large_dog_area:re.large_dog_area,small_dog_area:re.small_dog_area,private_booths:re.private_booths,private_booth_count:re.private_booths?re.private_booth_count:0,facility_details:re.facility_details,description:re.description,updated_at:(new Date).toISOString()}).eq("id",d.id);if(e)throw e;w("施設情報を更新しました。"),ae(!1),await ce(),setTimeout((()=>{w("")}),3e3)}catch(s){b(s instanceof Error?s.message:"施設情報の更新に失敗しました。"),setTimeout((()=>{b("")}),5e3)}finally{le(!1)}}},className:"space-y-6",children:[s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"変更不可項目"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600",children:[s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"住所:"})," ",d.address]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"料金:"})," ¥",d.price,"/日（全国統一料金）"]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"最大収容人数 *"}),s.jsx("input",{type:"number",min:"1",max:"100",value:re.max_capacity,onChange:e=>ie((s=>({...s,max_capacity:parseInt(e.target.value)||0}))),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"説明文"}),s.jsx("textarea",{value:re.description,onChange:e=>ie((s=>({...s,description:e.target.value}))),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:"施設の特徴や利用案内など"})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"エリア設定"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("label",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"checkbox",checked:re.large_dog_area,onChange:e=>ie((s=>({...s,large_dog_area:e.target.checked}))),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),s.jsx("span",{className:"text-sm text-gray-700",children:"大型犬エリア"})]}),s.jsxs("label",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"checkbox",checked:re.small_dog_area,onChange:e=>ie((s=>({...s,small_dog_area:e.target.checked}))),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),s.jsx("span",{className:"text-sm text-gray-700",children:"小型犬エリア"})]})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"プライベートブース"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("label",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"checkbox",checked:re.private_booths,onChange:e=>ie((s=>({...s,private_booths:e.target.checked}))),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),s.jsx("span",{className:"text-sm text-gray-700",children:"プライベートブースあり"})]}),re.private_booths&&s.jsxs("div",{className:"ml-6",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"部屋数"}),s.jsx("input",{type:"number",min:"1",max:"10",value:re.private_booth_count,onChange:e=>ie((s=>({...s,private_booth_count:parseInt(e.target.value)||0}))),className:"w-24 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"設備情報"}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:Object.entries({parking:"駐車場",shower:"シャワー設備",restroom:"トイレ",agility:"アジリティ設備",rest_area:"休憩スペース",water_station:"給水設備"}).map((([e,a])=>s.jsxs("label",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"checkbox",checked:re.facilities[e],onChange:s=>ie((a=>({...a,facilities:{...a.facilities,[e]:s.target.checked}}))),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),s.jsx("span",{className:"text-sm text-gray-700",children:a})]},e)))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"設備詳細説明"}),s.jsx("textarea",{value:re.facility_details,onChange:e=>ie((s=>({...s,facility_details:e.target.value}))),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:"設備の詳細説明や利用案内など"})]}),s.jsxs("div",{className:"flex justify-end space-x-3",children:[s.jsx(xe,{type:"button",variant:"secondary",onClick:()=>ae(!1),children:"キャンセル"}),s.jsx(xe,{type:"submit",isLoading:te,className:"bg-blue-600 hover:bg-blue-700",children:"更新"})]})]})]}),s.jsxs(oe,{className:"p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[s.jsx(G,{className:"w-6 h-6 text-blue-600 mr-2"}),"施設設定"]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"font-semibold text-blue-900 mb-3",children:"基本設定"}),s.jsx("p",{className:"text-sm text-blue-800 mb-3",children:"施設の基本情報や設備情報を編集できます。住所と料金は変更できません。"}),s.jsxs(xe,{size:"sm",onClick:()=>ae(!0),children:[s.jsx(N,{className:"w-4 h-4 mr-2"}),"基本情報を編集"]})]}),s.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"font-semibold text-green-900 mb-3",children:"料金設定"}),s.jsx("p",{className:"text-sm text-green-800 mb-3",children:"料金体系は全国統一です。変更はできません。"}),s.jsxs("ul",{className:"text-sm text-green-800 space-y-1",children:[s.jsx("li",{children:"• 通常利用: ¥800/日（固定）"}),s.jsx("li",{children:"• 施設貸し切り: ¥4,400/時間（固定）"}),s.jsx("li",{children:"• プライベートブース: サブスク使い放題・1日券でも利用可能（追加料金なし）"})]})]}),s.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"font-semibold text-purple-900 mb-3",children:"スマートロック設定"}),s.jsx("p",{className:"text-sm text-purple-800 mb-3",children:"スマートロックの設定を管理します。"}),s.jsxs(xe,{size:"sm",className:"bg-purple-600 hover:bg-purple-700",children:[s.jsx(u,{className:"w-4 h-4 mr-2"}),"スマートロックを管理"]})]}),s.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"font-semibold text-orange-900 mb-3",children:"営業時間設定"}),s.jsx("p",{className:"text-sm text-orange-800 mb-3",children:"営業時間は24時間です。変更はできません。"}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(n,{className:"w-5 h-5 text-orange-600"}),s.jsx("span",{className:"font-medium",children:"24時間営業"})]})]})]})]}),s.jsxs(oe,{className:"p-6",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[s.jsx(H,{className:"w-6 h-6 text-blue-600 mr-2"}),"メンテナンス管理"]}),s.jsxs(xe,{onClick:()=>Y(!0),className:"bg-blue-600 hover:bg-blue-700",children:[s.jsx(f,{className:"w-4 h-4 mr-2"}),"メンテナンス予定を追加"]})]}),W&&s.jsxs(oe,{className:"p-4 mb-6 bg-blue-50 border-blue-200",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-blue-900",children:"新しいメンテナンス予定"}),s.jsx("button",{onClick:()=>Y(!1),className:"text-blue-600 hover:text-blue-800",children:s.jsx(S,{className:"w-5 h-5"})})]}),s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),r&&t){ee(!0);try{if(!K.title||!K.start_date||!K.end_date)throw new Error("必須項目を入力してください。");const e=new Date(K.start_date);if(new Date(K.end_date)<=e)throw new Error("終了日時は開始日時より後に設定してください。");if(e<new Date)throw new Error("開始日時は現在時刻より後に設定してください。");const{error:s}=await ue.from("park_maintenance").insert({park_id:t,title:K.title,description:K.description,start_date:Je(K.start_date),end_date:Je(K.end_date),is_emergency:K.is_emergency,notify_users:K.notify_users,created_by:r.id});if(s)throw s;w("メンテナンススケジュールを作成しました。"),Y(!1),Z({title:"",description:"",start_date:"",end_date:"",is_emergency:!1,notify_users:!0}),await ne()}catch(s){b(s instanceof Error?s.message:"メンテナンススケジュールの作成に失敗しました。")}finally{ee(!1)}}},className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"メンテナンス内容 *"}),s.jsx("input",{type:"text",value:K.title,onChange:e=>Z((s=>({...s,title:e.target.value}))),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例：設備点検・清掃作業",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"開始日時 * (日本時間)"}),s.jsx("input",{type:"datetime-local",value:K.start_date,onChange:e=>Z((s=>({...s,start_date:e.target.value}))),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"日本時間で入力してください"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"終了日時 * (日本時間)"}),s.jsx("input",{type:"datetime-local",value:K.end_date,onChange:e=>Z((s=>({...s,end_date:e.target.value}))),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"日本時間で入力してください"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"詳細説明"}),s.jsx("textarea",{value:K.description,onChange:e=>Z((s=>({...s,description:e.target.value}))),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:"メンテナンス内容の詳細説明（任意）"})]}),s.jsxs("div",{className:"flex items-center space-x-6",children:[s.jsxs("label",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"checkbox",checked:K.is_emergency,onChange:e=>Z((s=>({...s,is_emergency:e.target.checked}))),className:"rounded border-gray-300 text-red-600 focus:ring-red-500"}),s.jsx("span",{className:"text-sm text-gray-700",children:"緊急メンテナンス"})]}),s.jsxs("label",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"checkbox",checked:K.notify_users,onChange:e=>Z((s=>({...s,notify_users:e.target.checked}))),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),s.jsx("span",{className:"text-sm text-gray-700",children:"ユーザーに通知"})]})]}),s.jsxs("div",{className:"flex justify-end space-x-3",children:[s.jsx(xe,{type:"button",variant:"secondary",onClick:()=>Y(!1),children:"キャンセル"}),s.jsx(xe,{type:"submit",isLoading:X,className:"bg-blue-600 hover:bg-blue-700",children:"作成"})]})]})]}),s.jsx("div",{className:"space-y-4",children:0===U.length?s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx(H,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),s.jsx("p",{className:"text-lg font-medium mb-2",children:"メンテナンス予定がありません"}),s.jsx("p",{className:"text-sm",children:"施設のメンテナンス予定を追加してください"})]}):U.map((e=>{const a=(e=>{const s=new Date,a=new Date(e.start_date),t=new Date(e.end_date);return"cancelled"===e.status?{status:"cancelled",label:"キャンセル済み",color:"bg-gray-500"}:"completed"===e.status?{status:"completed",label:"完了",color:"bg-gray-500"}:s>=a&&s<t?{status:"active",label:"メンテナンス中",color:"bg-red-500"}:s<a?{status:"scheduled",label:"予定",color:"bg-yellow-500"}:{status:"completed",label:"完了",color:"bg-gray-500"}})(e);return s.jsx(oe,{className:"p-4",children:s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[s.jsx("h3",{className:"font-semibold text-lg",children:e.title}),s.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium text-white ${a.color}`,children:a.label}),e.is_emergency&&s.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:"緊急"})]}),e.description&&s.jsx("p",{className:"text-gray-600 mb-3",children:e.description}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600",children:[s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"開始:"})," ",he(e.start_date)]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"終了:"})," ",he(e.end_date)]})]})]}),s.jsx("div",{className:"flex items-center space-x-2",children:"scheduled"===e.status&&s.jsx(xe,{size:"sm",variant:"secondary",onClick:()=>(async e=>{if(window.confirm("このメンテナンススケジュールを削除しますか？"))try{const{error:s}=await ue.from("park_maintenance").delete().eq("id",e);if(s)throw s;w("メンテナンススケジュールを削除しました。"),await ne()}catch(s){b("メンテナンススケジュールの削除に失敗しました。")}})(e.id),className:"text-red-600 hover:text-red-800",children:s.jsx(S,{className:"w-4 h-4"})})})]})},e.id)}))}),s.jsx("div",{className:"mt-6 p-4 bg-yellow-50 rounded-lg",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(a,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),s.jsxs("div",{className:"text-sm text-yellow-800",children:[s.jsx("p",{className:"font-medium mb-1",children:"メンテナンス機能について"}),s.jsxs("ul",{className:"space-y-1",children:[s.jsx("li",{children:"• メンテナンス中は新規予約を受け付けません"}),s.jsx("li",{children:"• 既存の予約がある場合は事前に利用者に連絡してください"}),s.jsx("li",{children:"• 緊急メンテナンスの場合は即座に施設が利用停止になります"}),s.jsx("li",{children:"• ユーザー通知を有効にすると、利用者にメール通知が送信されます"})]})]})]})})]}),s.jsx(oe,{className:"p-6 bg-gray-50",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(z,{className:"w-6 h-6 text-gray-600 mt-1"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"運営サポート"}),s.jsxs("div",{className:"text-sm text-gray-700 space-y-1",children:[s.jsx("p",{children:"• 設定に関するご質問は運営事務局までお問い合わせください"}),s.jsx("p",{children:"• QRコードシステムの設置・設定サポートを提供しています"}),s.jsx("p",{children:"• 運営開始後も継続的なサポートを行います"}),s.jsx("p",{children:"• 📧 サポート窓口: info@dogparkjp.com"})]})]})]})})]})]}):s.jsxs("div",{className:"max-w-4xl mx-auto text-center py-12",children:[s.jsx(a,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),s.jsx("h2",{className:"text-2xl font-bold mb-2",children:"ドッグランが見つかりません"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"指定されたドッグランが見つからないか、アクセス権限がありません。"}),s.jsx(h,{to:"/owner-dashboard",children:s.jsx(xe,{children:"ダッシュボードに戻る"})})]})}},Symbol.toStringTag,{value:"Module"})),Qe=Object.freeze(Object.defineProperty({__proto__:null,DogParkHistory:function(){const{user:t}=me(),r=k(),[i,d]=e.useState([]),[x,p]=e.useState(!0),[u,j]=e.useState(""),[b,N]=e.useState("all"),[f,v]=e.useState((new Date).getFullYear().toString()),[_,C]=e.useState("all"),[D,T]=e.useState([]),[P,I]=e.useState(0),[E,O]=e.useState(0),[q,L]=e.useState(""),[F,R]=e.useState([]),[M,z]=e.useState(null),[A,U]=e.useState(null),[J,W]=e.useState(null),[B,G]=e.useState(null);e.useEffect((()=>{t?V():r("/login")}),[t,r]);const V=async()=>{try{p(!0);const{data:e,error:s}=await ue.from("reservations").select("\n          *,\n          dog_park:dog_parks(*),\n          dog:dogs(*)\n        ").eq("user_id",null==t?void 0:t.id).order("date",{ascending:!1}).limit(50);if(s)throw s;const{data:a,error:l}=await ue.from("dogs").select("*").eq("owner_id",null==t?void 0:t.id);if(l)throw l;if(d(e||[]),T(a||[]),e){I(e.length);const s=new Set(e.map((e=>e.park_id)));O(s.size);const a={};e.forEach((e=>{const s=e.park_id;a[s]||(a[s]={count:0,name:e.dog_park.name,id:s}),a[s].count++}));const t=Object.values(a).sort(((e,s)=>s.count-e.count)).slice(0,3).map((e=>({id:e.id,name:e.name,visits:e.count})));R(t),t.length>0&&L(t[0].name)}}catch(e){}finally{p(!1)}},H=e=>["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"][e-1],Z=e.useMemo((()=>i.filter((e=>{const s=e.dog_park.name.toLowerCase().includes(u.toLowerCase())||e.dog_park.address.toLowerCase().includes(u.toLowerCase())||e.dog.name.toLowerCase().includes(u.toLowerCase()),a="all"===b||e.dog_id===b,t=new Date(e.date),l="all"===f||t.getFullYear().toString()===f,r="all"===_||(t.getMonth()+1).toString()===_;return s&&a&&l&&r}))),[i,u,b,f,_]);return x?s.jsx("div",{className:"flex justify-center items-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):s.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[s.jsx("div",{className:"flex items-center space-x-4 mb-6",children:s.jsxs(h,{to:"/dashboard",className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[s.jsx(Q,{className:"w-4 h-4 mr-2"}),"ダッシュボードに戻る"]})}),s.jsxs("div",{className:"text-center mb-8",children:[s.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-4 flex items-center justify-center",children:[s.jsx(g,{className:"w-8 h-8 text-blue-600 mr-3"}),"ドッグラン利用履歴"]}),s.jsx("p",{className:"text-lg text-gray-600",children:"これまでのドッグラン利用記録を確認できます"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsxs(oe,{className:"p-6 text-center",children:[s.jsx(g,{className:"w-12 h-12 text-blue-600 mx-auto mb-2"}),s.jsx("p",{className:"text-3xl font-bold text-gray-900",children:P}),s.jsx("p",{className:"text-gray-600",children:"総利用回数"})]}),s.jsxs(oe,{className:"p-6 text-center",children:[s.jsx($,{className:"w-12 h-12 text-green-600 mx-auto mb-2"}),s.jsx("p",{className:"text-3xl font-bold text-gray-900",children:E}),s.jsx("p",{className:"text-gray-600",children:"訪問したドッグラン数"})]}),s.jsxs(oe,{className:"p-6 text-center",children:[s.jsx(l,{className:"w-12 h-12 text-purple-600 mx-auto mb-2"}),s.jsx("p",{className:"text-xl font-bold text-gray-900 mb-1",children:q||"-"}),s.jsx("p",{className:"text-gray-600",children:"最も訪問したドッグラン"})]})]}),F.length>0&&s.jsxs(oe,{className:"p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center",children:[s.jsx(o,{className:"w-6 h-6 text-pink-600 mr-2"}),"よく行くドッグラン"]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:F.map(((e,a)=>s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx("div",{className:"w-8 h-8 bg-pink-100 rounded-full flex items-center justify-center text-pink-600 font-bold",children:a+1}),s.jsx("h3",{className:"font-semibold",children:e.name})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(g,{className:"w-4 h-4 text-gray-500 mr-1"}),s.jsxs("span",{className:"text-sm text-gray-600",children:[e.visits,"回利用"]})]}),s.jsx(h,{to:`/parks/${e.id}`,children:s.jsx(xe,{size:"sm",variant:"secondary",children:"詳細"})})]})]},e.id)))})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsx("div",{className:"md:col-span-2",children:s.jsx(pe,{label:"",value:u,onChange:e=>j(e.target.value),placeholder:"ドッグラン名、住所で検索...",icon:s.jsx(Y,{className:"w-4 h-4 text-gray-500"})})}),s.jsx("div",{children:s.jsxs("select",{value:b,onChange:e=>N(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:"all",children:"すべてのワンちゃん"}),D.map((e=>s.jsxs("option",{value:e.id,children:[e.name,"ちゃん"]},e.id)))]})}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsxs("select",{value:f,onChange:e=>v(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:"all",children:"すべての年"}),(()=>{const e=(new Date).getFullYear(),s=[];for(let a=e;a>=e-2;a--)s.push({value:a.toString(),label:`${a}年`});return s})().map((e=>s.jsx("option",{value:e.value,children:e.label},e.value)))]}),s.jsx("select",{value:_,onChange:e=>C(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:(()=>{const e=[{value:"all",label:"すべての月"}];for(let s=1;s<=12;s++)e.push({value:s.toString(),label:H(s)});return e})().map((e=>s.jsx("option",{value:e.value,children:e.label},e.value)))})]})]}),s.jsx("div",{className:"flex justify-end",children:s.jsxs(xe,{variant:"secondary",size:"sm",onClick:()=>{if(0===Z.length)return;const e="\ufeff"+[["日付","時間","ドッグラン名","住所","ワンちゃん","料金","予約タイプ"].join(","),...Z.map((e=>[new Date(e.date).toLocaleDateString("ja-JP"),`${e.start_time}〜${parseInt(e.start_time)+e.duration}:00`,`"${e.dog_park.name.replace(/"/g,'""')}"`,`"${e.dog_park.address.replace(/"/g,'""')}"`,`"${e.dog.name.replace(/"/g,'""')}"`,`¥${e.total_amount}`,"regular"===e.reservation_type?"通常利用":"private_booth"===e.reservation_type?"プライベートブース":"施設貸し切り"].join(",")))].join("\n"),s=new Blob([e],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(s),t=document.createElement("a");t.setAttribute("href",a),t.setAttribute("download",`dogpark_history_${(new Date).toISOString().split("T")[0]}.csv`),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t)},children:[s.jsx(K,{className:"w-4 h-4 mr-2"}),"CSV出力"]})}),0===Z.length?s.jsxs(oe,{className:"text-center py-12",children:[s.jsx(g,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),s.jsx("h2",{className:"text-xl font-semibold text-gray-700 mb-2",children:"利用履歴がありません"}),s.jsx("p",{className:"text-gray-500 mb-6",children:"まだドッグランを利用していないようです"}),s.jsx(h,{to:"/parks",children:s.jsx(xe,{children:"ドッグランを予約する"})})]}):s.jsx("div",{className:"space-y-6",children:Z.map((e=>{const a=new Date(e.date),t=a.toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric",weekday:"long"}),r=e.start_time,i=`${parseInt(r)+e.duration}:00`,c="regular"===e.reservation_type?"通常利用":"private_booth"===e.reservation_type?"プライベートブース":"施設貸し切り";return s.jsxs(oe,{className:"p-6 hover:shadow-lg transition-shadow",children:[s.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-start gap-4",children:[s.jsxs("div",{className:"flex items-start space-x-4",children:[s.jsxs("div",{className:"bg-blue-100 rounded-lg p-3 text-center min-w-[80px]",children:[s.jsx("p",{className:"text-sm text-blue-800",children:a.getFullYear()}),s.jsx("p",{className:"text-xl font-bold text-blue-600",children:a.getDate()}),s.jsx("p",{className:"text-sm text-blue-800",children:H(a.getMonth()+1)})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold",children:e.dog_park.name}),s.jsxs("div",{className:"flex items-center text-gray-600 mt-1",children:[s.jsx(l,{className:"w-4 h-4 mr-1 flex-shrink-0"}),s.jsx("span",{className:"text-sm",children:e.dog_park.address})]}),s.jsxs("div",{className:"flex items-center text-gray-600 mt-1",children:[s.jsx(n,{className:"w-4 h-4 mr-1 flex-shrink-0"}),s.jsxs("span",{className:"text-sm",children:[r," 〜 ",i]})]}),s.jsxs("div",{className:"flex items-center text-gray-600 mt-1",children:[s.jsx(w,{className:"w-4 h-4 mr-1 flex-shrink-0"}),s.jsxs("span",{className:"text-sm",children:[e.dog.name,"ちゃん（",e.dog.breed,"）"]})]}),Math.random()>.5&&s.jsx("div",{className:"flex items-center mt-2",children:[1,2,3,4,5].map((e=>s.jsx(y,{className:"w-4 h-4 "+(e<=Math.floor(3+2*Math.random())?"text-yellow-400 fill-current":"text-gray-300")},e)))})]})]}),s.jsxs("div",{className:"flex flex-col items-end",children:[s.jsx("div",{className:"text-right",children:s.jsxs("span",{className:"text-lg font-bold text-green-600",children:["¥",e.total_amount.toLocaleString()]})}),s.jsx("div",{className:"mt-2",children:s.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-medium "+("regular"===e.reservation_type?"bg-blue-100 text-blue-800":"private_booth"===e.reservation_type?"bg-purple-100 text-purple-800":"bg-orange-100 text-orange-800"),children:c})}),s.jsx("div",{className:"mt-2",children:s.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-medium "+("confirmed"===e.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:"confirmed"===e.status?"利用済み":"キャンセル"})})]})]}),s.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 flex justify-between items-center",children:[s.jsx("div",{className:"text-sm text-gray-500",children:t}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx(h,{to:`/parks/${e.park_id}`,children:s.jsxs(xe,{size:"sm",variant:"secondary",children:[s.jsx($,{className:"w-4 h-4 mr-1"}),"施設詳細"]})}),s.jsx(h,{to:`/parks/${e.park_id}/reserve`,children:s.jsxs(xe,{size:"sm",children:[s.jsx(g,{className:"w-4 h-4 mr-1"}),"再予約"]})}),"confirmed"===e.status&&s.jsxs(xe,{size:"sm",variant:"secondary",className:"text-red-600 hover:text-red-700",isLoading:M===e.id,onClick:async()=>{const s=await(async e=>{const s="whole_facility"===e.reservation_type,a=new Date,t=new Date(e.date),l=new Date(t);if(l.setDate(t.getDate()-1),s)return a<l;{const{data:s}=await ue.from("user_entry_exit_logs").select("*").eq("user_id",e.user_id).eq("park_id",e.park_id).eq("action","entry").gte("timestamp",e.date);return!s||0===s.length}})(e);s?U(e.id):W("この予約はキャンセルできません（貸し切りは1日前まで、通常予約はPIN未使用時のみ）")},children:[s.jsx(S,{className:"w-4 h-4 mr-1"}),"キャンセル"]})]})]})]},e.id)}))}),Z.length>0&&s.jsx(oe,{className:"p-6 bg-blue-50 border-blue-200",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(c,{className:"w-6 h-6 text-blue-600 mt-1"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"コミュニティ機能"}),s.jsx("p",{className:"text-sm text-blue-800 mb-3",children:"同じドッグランを利用した他のワンちゃんとの出会いを「コミュニティ」ページで確認できます。 友達申請を送ったり、次回の予約を調整したりして、ワンちゃん同士の交流を深めましょう。"}),s.jsx(h,{to:"/community",children:s.jsxs(xe,{size:"sm",className:"bg-blue-600 hover:bg-blue-700",children:[s.jsx(c,{className:"w-4 h-4 mr-2"}),"コミュニティを見る"]})})]})]})}),A&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[s.jsxs("div",{className:"text-center mb-6",children:[s.jsx(a,{className:"w-12 h-12 text-red-600 mx-auto mb-4"}),s.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"予約をキャンセルしますか？"}),s.jsx("p",{className:"text-gray-600",children:"この操作は取り消せません。本当にキャンセルしますか？"})]}),s.jsxs("div",{className:"flex justify-end space-x-3",children:[s.jsx(xe,{variant:"secondary",onClick:()=>U(null),children:"戻る"}),s.jsx(xe,{className:"bg-red-600 hover:bg-red-700",isLoading:M===A,onClick:()=>{const e=Z.find((e=>e.id===A));e&&(async e=>{z(e.id),W(null),G(null);try{const{data:s,error:a}=await ue.rpc("cancel_reservation",{p_reservation_id:e.id,p_user_id:e.user_id});if(a||!(null==s?void 0:s.success))return void W(s&&s.message||(null==a?void 0:a.message)||"キャンセルに失敗しました");G("予約をキャンセルしました"),U(null),await V(),setTimeout((()=>G(null)),3e3)}catch(s){W(s.message||"キャンセルに失敗しました")}finally{z(null)}})(e)},children:"キャンセルする"})]})]})}),B&&s.jsx("div",{className:"mb-6 p-4 bg-green-100 border border-green-300 rounded-lg",children:s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(m,{className:"w-5 h-5 text-green-600"}),s.jsx("span",{className:"font-semibold text-green-800",children:B})]})}),J&&s.jsxs("div",{className:"mb-6 p-4 bg-red-100 border border-red-300 rounded-lg",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(a,{className:"w-5 h-5 text-red-600"}),s.jsx("span",{className:"font-semibold text-red-800",children:"エラー"})]}),s.jsx("p",{className:"text-red-700 mt-1",children:J})]})]})}},Symbol.toStringTag,{value:"Module"})),Be=Object.freeze(Object.defineProperty({__proto__:null,DogParkRules:function(){return s.jsxs("div",{className:"max-w-4xl mx-auto px-4 space-y-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"mb-4",children:s.jsxs(h,{to:"/",className:"inline-flex items-center text-blue-600 hover:text-blue-700 transition-colors",children:[s.jsx(Q,{className:"w-4 h-4 mr-2"}),"ホームに戻る"]})}),s.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 mb-4",children:"ドッグラン利用ルール"}),s.jsx("p",{className:"text-base md:text-lg text-gray-600",children:"すべての利用者と愛犬が安全で楽しく過ごすためのルールです"})]}),s.jsx(oe,{className:"bg-red-50 border-red-200 p-4",children:s.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:space-x-3",children:[s.jsx(a,{className:"w-6 h-6 text-red-600 mb-2 md:mb-0 md:mt-1 md:flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-red-900 mb-3",children:"重要な注意事項"}),s.jsxs("div",{className:"space-y-2 text-red-800",children:[s.jsxs("p",{className:"flex items-start",children:[s.jsx("span",{className:"w-2 h-2 bg-red-600 rounded-full mt-2 mr-3 flex-shrink-0"}),s.jsx("span",{children:"ワクチン接種証明書が承認されていない犬は入場できません"})]}),s.jsxs("p",{className:"flex items-start",children:[s.jsx("span",{className:"w-2 h-2 bg-red-600 rounded-full mt-2 mr-3 flex-shrink-0"}),s.jsx("span",{children:"発情中のメス犬、病気や怪我をしている犬の入場はお断りします"})]}),s.jsxs("p",{className:"flex items-start",children:[s.jsx("span",{className:"w-2 h-2 bg-red-600 rounded-full mt-2 mr-3 flex-shrink-0"}),s.jsx("span",{children:"攻撃的な行動を示す犬は即座に退場していただきます"})]}),s.jsxs("p",{className:"flex items-start",children:[s.jsx("span",{className:"w-2 h-2 bg-red-600 rounded-full mt-2 mr-3 flex-shrink-0"}),s.jsx("span",{children:"事故やトラブルについて、施設は一切の責任を負いません"})]})]})]})]})}),s.jsxs(oe,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[s.jsx(d,{className:"w-6 h-6 text-blue-600"}),s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"基本ルール"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(m,{className:"w-5 h-5 text-green-600 mt-1 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:"入場前の準備"}),s.jsx("p",{className:"text-sm text-gray-600",children:"必ずリードを装着し、排泄を済ませてから入場してください"})]})]}),s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(m,{className:"w-5 h-5 text-green-600 mt-1 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:"飼い主の責任"}),s.jsx("p",{className:"text-sm text-gray-600",children:"愛犬から目を離さず、常に監視・管理してください"})]})]}),s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(m,{className:"w-5 h-5 text-green-600 mt-1 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:"清潔の維持"}),s.jsx("p",{className:"text-sm text-gray-600",children:"排泄物は必ず飼い主が責任を持って処理してください"})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(m,{className:"w-5 h-5 text-green-600 mt-1 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:"他の利用者への配慮"}),s.jsx("p",{className:"text-sm text-gray-600",children:"大きな声での会話や騒音は控えめにしてください"})]})]}),s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(m,{className:"w-5 h-5 text-green-600 mt-1 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:"施設の保護"}),s.jsx("p",{className:"text-sm text-gray-600",children:"設備や備品を大切に扱い、破損させないよう注意してください"})]})]}),s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(m,{className:"w-5 h-5 text-green-600 mt-1 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:"緊急時の対応"}),s.jsx("p",{className:"text-sm text-gray-600",children:"事故や怪我が発生した場合は、すぐに管理者に連絡してください"})]})]})]})]})]}),s.jsxs(oe,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[s.jsx(w,{className:"w-6 h-6 text-purple-600"}),s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"愛犬に関するルール"})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-3 flex items-center",children:[s.jsx(o,{className:"w-5 h-5 text-red-500 mr-2"}),"入場条件"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[s.jsx("h4",{className:"font-semibold text-green-900 mb-2",children:"✅ 入場可能"}),s.jsxs("ul",{className:"text-sm text-green-800 space-y-1",children:[s.jsx("li",{children:"• ワクチン接種証明書が承認済みの犬"}),s.jsx("li",{children:"• 健康で元気な犬"}),s.jsx("li",{children:"• 社会化ができている犬"}),s.jsx("li",{children:"• 飼い主の指示に従える犬"})]})]}),s.jsxs("div",{className:"bg-red-50 p-4 rounded-lg",children:[s.jsx("h4",{className:"font-semibold text-red-900 mb-2",children:"❌ 入場不可"}),s.jsxs("ul",{className:"text-sm text-red-800 space-y-1",children:[s.jsx("li",{children:"• 発情中のメス犬"}),s.jsx("li",{children:"• 病気や怪我をしている犬"}),s.jsx("li",{children:"• 攻撃的な行動を示す犬"}),s.jsx("li",{children:"• ワクチン未接種・証明書未承認の犬"})]})]})]})]}),s.jsxs("div",{children:[s.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-3 flex items-center",children:[s.jsx(c,{className:"w-5 h-5 text-blue-500 mr-2"}),"サイズ別エリアの利用"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"border border-blue-200 p-4 rounded-lg",children:[s.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"🐕 大型犬エリア"}),s.jsx("p",{className:"text-sm text-blue-800",children:"体重20kg以上の犬が対象です。小型犬の入場はご遠慮ください。"})]}),s.jsxs("div",{className:"border border-pink-200 p-4 rounded-lg",children:[s.jsx("h4",{className:"font-semibold text-pink-900 mb-2",children:"🐕‍🦺 小型犬エリア"}),s.jsx("p",{className:"text-sm text-pink-800",children:"体重20kg未満の犬が対象です。大型犬との事故防止のため、サイズを守ってください。"})]})]})]})]})]}),s.jsxs(oe,{className:"bg-yellow-50 border-yellow-200 p-4",children:[s.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[s.jsx(a,{className:"w-6 h-6 text-yellow-600"}),s.jsx("h2",{className:"text-xl font-semibold text-yellow-900",children:"禁止事項"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(Z,{className:"w-5 h-5 text-red-500 mt-1 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:"大声・騒音"}),s.jsx("p",{className:"text-sm text-gray-600",children:"大声での会話、音楽の再生、犬の過度な鳴き声"})]})]}),s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(X,{className:"w-5 h-5 text-red-500 mt-1 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:"無断撮影"}),s.jsx("p",{className:"text-sm text-gray-600",children:"他の利用者や犬の無断撮影・SNS投稿"})]})]}),s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(v,{className:"w-5 h-5 text-red-500 mt-1 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:"ゴミの放置"}),s.jsx("p",{className:"text-sm text-gray-600",children:"排泄物やゴミの放置、施設の汚損"})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(o,{className:"w-5 h-5 text-red-500 mt-1 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:"食べ物の持ち込み"}),s.jsx("p",{className:"text-sm text-gray-600",children:"犬用・人用問わず、食べ物の持ち込み・給餌"})]})]}),s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(ee,{className:"w-5 h-5 text-red-500 mt-1 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:"指定外駐車"}),s.jsx("p",{className:"text-sm text-gray-600",children:"指定された駐車場以外への駐車"})]})]}),s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(c,{className:"w-5 h-5 text-red-500 mt-1 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:"犬以外の動物"}),s.jsx("p",{className:"text-sm text-gray-600",children:"犬以外のペットの同伴入場"})]})]})]})]})]}),s.jsxs(oe,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[s.jsx(n,{className:"w-6 h-6 text-green-600"}),s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"利用時間・料金"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[s.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-2",children:"営業時間"}),s.jsx("p",{className:"text-xl md:text-2xl font-bold text-blue-600 mb-2",children:"6:00 - 22:00"}),s.jsx("p",{className:"text-sm text-blue-700",children:"年中無休・24時間無人営業"})]}),s.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[s.jsx("h3",{className:"text-lg font-semibold text-green-800 mb-2",children:"通常利用"}),s.jsx("p",{className:"text-xl md:text-2xl font-bold text-green-600 mb-2",children:"¥800"}),s.jsx("p",{className:"text-sm text-green-700",children:"1日利用（時間制限なし）"})]}),s.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[s.jsx("h3",{className:"text-lg font-semibold text-purple-800 mb-2",children:"サブスクリプション"}),s.jsx("p",{className:"text-xl md:text-2xl font-bold text-purple-600 mb-2",children:"¥3,800"}),s.jsx("p",{className:"text-sm text-purple-700",children:"月額（どこでも使い放題）"})]})]}),s.jsxs("div",{className:"mt-4 p-4 bg-orange-50 rounded-lg",children:[s.jsx("h3",{className:"text-lg font-semibold text-orange-800 mb-2 text-center",children:"施設貸し切り"}),s.jsx("p",{className:"text-xl md:text-2xl font-bold text-orange-600 mb-2 text-center",children:"¥4,400/時間"}),s.jsxs("div",{className:"text-sm text-orange-700 text-center space-y-1",children:[s.jsx("p",{children:"1時間単位で予約可能"}),s.jsx("p",{children:"人数制限なし・友達と一緒に利用可能"}),s.jsx("p",{children:"前日までの予約が必要"}),s.jsx("p",{children:"サブスク会員は20%OFF（¥3,520/時間）"})]})]})]}),s.jsxs(oe,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[s.jsx(se,{className:"w-6 h-6 text-cyan-600"}),s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"設備・サービス"})]}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[{icon:se,label:"給水設備",desc:"清潔な飲み水"},{icon:ee,label:"駐車場",desc:"無料駐車場完備"},{icon:se,label:"シャワー設備",desc:"犬用洗い場"},{icon:c,label:"休憩スペース",desc:"飼い主用ベンチ"},{icon:v,label:"ゴミ箱",desc:"分別ゴミ箱設置"},{icon:d,label:"セキュリティ",desc:"防犯カメラ設置"},{icon:ae,label:"緊急連絡",desc:"24時間対応"},{icon:o,label:"アジリティ",desc:"運動器具完備"}].map(((e,a)=>{const t=e.icon;return s.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[s.jsx(t,{className:"w-6 h-6 text-blue-600 mx-auto mb-2"}),s.jsx("h4",{className:"font-semibold text-gray-900 text-sm",children:e.label}),s.jsx("p",{className:"text-xs text-gray-600",children:e.desc})]},a)}))})]}),s.jsxs(oe,{className:"bg-orange-50 border-orange-200 p-4",children:[s.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[s.jsx(ae,{className:"w-6 h-6 text-orange-600"}),s.jsx("h2",{className:"text-xl font-semibold text-orange-900",children:"緊急時の対応"})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-orange-900 mb-2",children:"事故・怪我が発生した場合"}),s.jsxs("ol",{className:"text-sm text-orange-800 space-y-1",children:[s.jsx("li",{children:"1. まず安全を確保し、他の犬を遠ざける"}),s.jsx("li",{children:"2. 怪我の程度を確認し、必要に応じて応急処置"}),s.jsx("li",{children:"3. 重傷の場合は救急車・動物病院に連絡"}),s.jsx("li",{children:"4. 管理者に速やかに報告"})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-orange-900 mb-2",children:"トラブルが発生した場合"}),s.jsxs("ol",{className:"text-sm text-orange-800 space-y-1",children:[s.jsx("li",{children:"1. 冷静に対応し、感情的にならない"}),s.jsx("li",{children:"2. 当事者同士で話し合いを試みる"}),s.jsx("li",{children:"3. 解決しない場合は管理者に相談"}),s.jsx("li",{children:"4. 必要に応じて警察に通報"})]})]})]}),s.jsxs("div",{className:"bg-orange-100 p-4 rounded-lg",children:[s.jsx("h3",{className:"font-semibold text-orange-900 mb-2",children:"緊急連絡先"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-orange-800",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:"管理者"}),s.jsx("p",{children:"各ドッグランに掲示しています"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:"救急車"}),s.jsx("p",{children:"📞 119"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:"警察"}),s.jsx("p",{children:"📞 110"})]})]})]})]})]}),s.jsx(oe,{className:"bg-gray-50 border-gray-200 p-4",children:s.jsxs("div",{className:"text-center",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"利用規約への同意"}),s.jsxs("p",{className:"text-gray-700 mb-6",children:["ドッグランをご利用いただく際は、上記のルールをすべて理解し、遵守していただく必要があります。",s.jsx("br",{}),"ルールに違反した場合、退場していただく場合があります。"]}),s.jsxs("div",{className:"flex flex-col md:flex-row justify-center space-y-3 md:space-y-0 md:space-x-4",children:[s.jsx(h,{to:"/parks",children:s.jsx(xe,{className:"w-full md:w-auto bg-blue-600 hover:bg-blue-700",children:"ルールを理解してドッグランを予約する"})}),s.jsx(h,{to:"/",children:s.jsx(xe,{variant:"secondary",className:"w-full md:w-auto",children:"ホームに戻る"})})]})]})})]})}},Symbol.toStringTag,{value:"Module"})),Ge=Object.freeze(Object.defineProperty({__proto__:null,ParkRegistrationAgreement:function(){const t=k(),{user:l}=me(),[r,i]=e.useState(!1),[c,d]=e.useState(""),[o,x]=e.useState(!1);return s.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[s.jsx("div",{className:"flex items-center space-x-4 mb-6",children:s.jsxs(h,{to:"/dashboard",className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[s.jsx(Q,{className:"w-4 h-4 mr-2"}),"ダッシュボードに戻る"]})}),s.jsxs("div",{className:"text-center mb-8",children:[s.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-4 flex items-center justify-center",children:[s.jsx($,{className:"w-8 h-8 text-blue-600 mr-3"}),"ドッグランオーナー契約"]}),s.jsx("p",{className:"text-lg text-gray-600",children:"ドッグランオーナーとして登録する前に、契約内容をご確認ください"})]}),c&&s.jsxs("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4 flex items-start",children:[s.jsx(a,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),s.jsx("p",{children:c})]}),s.jsxs(oe,{className:"p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[s.jsx(z,{className:"w-6 h-6 text-blue-600 mr-2"}),"ドッグランオーナー契約内容"]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[s.jsxs("h3",{className:"font-semibold text-blue-900 mb-2 flex items-center",children:[s.jsx($,{className:"w-5 h-5 text-blue-600 mr-2"}),"施設運営について"]}),s.jsxs("div",{className:"text-sm text-blue-800 space-y-2",children:[s.jsx("p",{children:"1. オーナーは、ドッグラン施設の安全性と清潔さを維持する責任があります。"}),s.jsx("p",{children:"2. 施設は24時間営業を基本とし、無人運営システムを導入します。"}),s.jsx("p",{children:"3. 週に1回以上の定期的な施設点検・清掃が必要です。"}),s.jsx("p",{children:"4. 緊急時には1時間以内に施設に到着できる体制を整えてください。"}),s.jsx("p",{children:"5. 施設内でのトラブルや事故に関しては、当社は一切の責任を負いません。"})]})]}),s.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[s.jsxs("h3",{className:"font-semibold text-green-900 mb-2 flex items-center",children:[s.jsx(M,{className:"w-5 h-5 text-green-600 mr-2"}),"料金と収益配分"]}),s.jsxs("div",{className:"text-sm text-green-800 space-y-2",children:[s.jsx("p",{children:"1. 利用料金は全国統一で以下の通りです："}),s.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[s.jsx("li",{children:"通常利用：800円/日（時間制限なし）"}),s.jsx("li",{children:"サブスクリプション：3,800円/月（全国共通）"}),s.jsx("li",{children:"施設貸し切り：4,400円/時間"})]}),s.jsxs("p",{children:["2. 売上の",s.jsx("span",{className:"font-bold",children:"80%"}),"がオーナーに支払われます。"]}),s.jsxs("p",{children:["3. 残りの",s.jsx("span",{className:"font-bold",children:"20%"}),"は当社の手数料となります。"]}),s.jsx("p",{children:"4. 振込は毎月15日に前月分を一括で行います。"}),s.jsx("p",{children:"5. 振込手数料は当社が負担します。"})]})]}),s.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[s.jsxs("h3",{className:"font-semibold text-yellow-900 mb-2 flex items-center",children:[s.jsx(te,{className:"w-5 h-5 text-yellow-600 mr-2"}),"税金と法的責任"]}),s.jsxs("div",{className:"text-sm text-yellow-800 space-y-2",children:[s.jsx("p",{children:"1. オーナーは収益に対する税金の申告・納税義務があります。"}),s.jsx("p",{children:"2. 施設運営に必要な許認可の取得はオーナーの責任で行ってください。"}),s.jsx("p",{children:"3. 施設内での事故・トラブルに関する法的責任はオーナーが負うものとします。"}),s.jsx("p",{children:"4. 施設賠償責任保険への加入を強く推奨します。"})]})]}),s.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[s.jsxs("h3",{className:"font-semibold text-purple-900 mb-2 flex items-center",children:[s.jsx(n,{className:"w-5 h-5 text-purple-600 mr-2"}),"契約期間と解約"]}),s.jsxs("div",{className:"text-sm text-purple-800 space-y-2",children:[s.jsx("p",{children:"1. 契約期間は1年間とし、自動更新されます。"}),s.jsx("p",{children:"2. 解約を希望する場合は、30日前までに書面で通知が必要です。"}),s.jsx("p",{children:"3. 以下の場合、当社は即時契約解除できるものとします："}),s.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[s.jsx("li",{children:"本契約に違反した場合"}),s.jsx("li",{children:"施設の安全性が確保できない場合"}),s.jsx("li",{children:"利用者からの苦情が著しく多い場合"}),s.jsx("li",{children:"当社の信用を著しく毀損する行為があった場合"})]})]})]}),s.jsxs("div",{className:"bg-red-50 p-4 rounded-lg",children:[s.jsxs("h3",{className:"font-semibold text-red-900 mb-2 flex items-center",children:[s.jsx(a,{className:"w-5 h-5 text-red-600 mr-2"}),"禁止事項"]}),s.jsxs("div",{className:"text-sm text-red-800 space-y-2",children:[s.jsx("p",{children:"1. 当社の許可なく料金体系を変更すること"}),s.jsx("p",{children:"2. 当社のシステムを迂回して予約・決済を受けること"}),s.jsx("p",{children:"3. 利用者の個人情報を不正に収集・利用すること"}),s.jsx("p",{children:"4. 当社や他のオーナーの信用を毀損する行為"}),s.jsx("p",{children:"5. 反社会的勢力との関係を持つこと"})]})]}),s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsxs("h3",{className:"font-semibold text-gray-900 mb-2 flex items-center",children:[s.jsx(le,{className:"w-5 h-5 text-gray-600 mr-2"}),"個人情報と機密保持"]}),s.jsxs("div",{className:"text-sm text-gray-800 space-y-2",children:[s.jsx("p",{children:"1. オーナーは利用者の個人情報を適切に管理し、漏洩防止に努めること"}),s.jsx("p",{children:"2. 契約期間中および終了後も、当社の機密情報を第三者に開示しないこと"}),s.jsx("p",{children:"3. 当社は法令に基づき、オーナーの個人情報を適切に管理します"})]})]}),s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),o)try{i(!0),d("");const{error:e}=await ue.from("owner_agreements").upsert([{user_id:null==l?void 0:l.id,agreed_at:(new Date).toISOString(),agreement_version:"1.0",agreement_type:"park_owner"}]);if(e)throw e;t("/register-park")}catch(s){d(s.message||"契約同意の処理に失敗しました。")}finally{i(!1)}else d("契約内容に同意してください。")},children:[s.jsx("div",{className:"border-t pt-6 mt-6",children:s.jsxs("label",{className:"flex items-start space-x-3 cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:o,onChange:e=>x(e.target.checked),className:"mt-1 rounded text-blue-600"}),s.jsx("span",{className:"text-gray-700",children:"上記の契約内容をすべて読み、理解し、同意します。この契約は法的拘束力を持ちます。"})]})}),s.jsx("div",{className:"mt-6 flex justify-end",children:s.jsx(xe,{type:"submit",isLoading:r,disabled:!o,children:"同意して本人確認に進む"})})]})]})]}),s.jsx(oe,{className:"bg-gray-50",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(z,{className:"w-6 h-6 text-gray-600 mt-1"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"審査プロセスについて"}),s.jsxs("div",{className:"text-sm text-gray-700 space-y-1",children:[s.jsxs("p",{children:[s.jsx("strong",{children:"契約同意:"})," ドッグランオーナー契約への同意"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"本人確認:"})," 安全なプラットフォーム運営のための本人確認"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"第一審査:"})," 基本的な条件の確認"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"第二審査:"})," 詳細な施設情報と書類審査"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"QRコード実証検査:"})," 実際の施設での動作確認"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"掲載・運営開始:"})," 一般公開と予約受付開始"]})]}),s.jsx("div",{className:"mt-3 flex items-center",children:s.jsxs(h,{to:"/owner-payment-system",className:"text-blue-600 hover:text-blue-800 flex items-center",children:[s.jsx(M,{className:"w-4 h-4 mr-1"}),s.jsx("span",{className:"text-sm font-medium",children:"料金体系と収益システムについて詳しく見る"})]})})]})]})})]})}},Symbol.toStringTag,{value:"Module"})),Ve={overview:{label:"施設全景",description:"ドッグランの全体が見渡せる写真",icon:$,required:!0},entrance:{label:"入口",description:"入口の様子がわかる写真",icon:l,required:!0},gate:{label:"ゲート",description:"ドッグラン入口のゲートの写真",icon:$,required:!0},fence:{label:"フェンス",description:"ドッグラン周囲のフェンスの写真",icon:$,required:!0},large_dog_area:{label:"大型犬エリア",description:"大型犬用のエリアの写真",icon:$,required:!1,conditionalOn:"large_dog_area"},small_dog_area:{label:"小型犬エリア",description:"小型犬用のエリアの写真",icon:$,required:!1,conditionalOn:"small_dog_area"},private_booth:{label:"プライベートブース",description:"プライベートブースの内部と外観",icon:$,required:!1,conditionalOn:"private_booths"},parking:{label:"駐車場",description:"駐車場の様子がわかる写真",icon:ie,required:!1,conditionalOn:"facilities.parking"},shower:{label:"シャワー設備",description:"シャワー設備の写真",icon:re,required:!1,conditionalOn:"facilities.shower"},restroom:{label:"トイレ",description:"トイレ設備の写真",icon:z,required:!1,conditionalOn:"facilities.restroom"},agility:{label:"アジリティ設備",description:"アジリティ設備の写真",icon:$,required:!1,conditionalOn:"facilities.agility"},rest_area:{label:"休憩スペース",description:"休憩スペースの写真",icon:$,required:!1,conditionalOn:"facilities.rest_area"},water_station:{label:"給水設備",description:"給水設備の写真",icon:$,required:!1,conditionalOn:"facilities.water_station"}};function He({className:e}){return s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,children:[s.jsx("path",{d:"M3 21h18"}),s.jsx("path",{d:"M3 10h18"}),s.jsx("path",{d:"M5 6l7-3 7 3"}),s.jsx("path",{d:"M4 10v11"}),s.jsx("path",{d:"M20 10v11"}),s.jsx("path",{d:"M8 14v3"}),s.jsx("path",{d:"M12 14v3"}),s.jsx("path",{d:"M16 14v3"})]})}function Ye({className:e}){return s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,children:[s.jsx("circle",{cx:"12",cy:"12",r:"10"}),s.jsx("polyline",{points:"12 6 12 12 16 14"})]})}const Ke=Object.freeze(Object.defineProperty({__proto__:null,ParkRegistrationSecondStage:function(){const{parkId:t}=_(),{user:l}=me(),r=k(),[i,c]=e.useState(null),[n,d]=e.useState([]),[o,x]=e.useState(!0),[p,u]=e.useState(!1),[g,b]=e.useState(""),[N,f]=e.useState(""),[y,w]=e.useState(null),[C,D]=e.useState("images"),[T,P]=e.useState({bank_name:"",bank_code:"",branch_name:"",branch_code:"",account_type:"ordinary",account_number:"",account_holder_name:""}),[I,E]=e.useState(!1),[O,q]=e.useState(""),[L,F]=e.useState("");e.useEffect((()=>{l&&t?R():r("/owner-dashboard")}),[l,t,r]);const R=async()=>{try{x(!0);const{data:e,error:s}=await ue.from("dog_parks").select("*").eq("id",t).eq("owner_id",null==l?void 0:l.id).single();if(s)throw s;if(!e)return void r("/owner-dashboard");c(e);const{data:a,error:i}=await ue.from("dog_park_facility_images").select("*").eq("park_id",t),n=Object.entries(Ve).filter((([,s])=>{if(s.required)return!0;if(s.conditionalOn&&e){const a=s.conditionalOn.split(".");if(1===a.length)return e[a[0]]??!1;if(2===a.length){const s=e[a[0]];if(s&&"object"==typeof s)return s[a[1]]??!1}}return!1})).map((([e])=>e)).map((e=>{const s=(a||[]).find((s=>s.image_type===e));return{id:null==s?void 0:s.id,image_type:e,image_url:null==s?void 0:s.image_url,is_approved:(null==s?void 0:s.is_approved)??null,admin_notes:null==s?void 0:s.admin_notes}}));d(n);const{data:o,error:m}=await ue.rpc("get_owner_bank_account");!m&&o&&o.length>0&&P({id:o[0].id,bank_name:o[0].bank_name,bank_code:o[0].bank_code,branch_name:o[0].branch_name,branch_code:o[0].branch_code,account_type:o[0].account_type,account_number:o[0].account_number,account_holder_name:o[0].account_holder_name})}catch(e){b(e.message||"エラーが発生しました")}finally{x(!1)}};return o?s.jsx("div",{className:"flex justify-center items-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):y?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50",children:s.jsxs("div",{className:"relative max-w-4xl w-full",children:[s.jsx("button",{onClick:()=>w(null),className:"absolute top-2 right-2 p-2 bg-white bg-opacity-90 shadow-lg rounded-full text-gray-800 hover:bg-opacity-100 transition-all",children:s.jsx(S,{className:"w-6 h-6"})}),s.jsx("img",{src:y,alt:"画像プレビュー",className:"max-h-[80vh] max-w-full mx-auto rounded-lg",onError:e=>{e.currentTarget.src="https://via.placeholder.com/800x600?text=Image+Not+Available"}})]})}):i?"first_stage_passed"!==i.status&&"second_stage_review"!==i.status?s.jsxs("div",{className:"max-w-4xl mx-auto",children:[s.jsx("div",{className:"mb-6",children:s.jsxs(h,{to:"/owner-dashboard",className:"flex items-center text-blue-600 hover:text-blue-800",children:[s.jsx(Q,{className:"w-4 h-4 mr-2"}),"ダッシュボードに戻る"]})}),s.jsxs(oe,{className:"text-center py-8",children:[s.jsx(a,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),s.jsx("h2",{className:"text-2xl font-bold mb-2",children:"このドッグランは現在第二審査の対象ではありません"}),s.jsxs("p",{className:"text-gray-600 mb-4",children:["pending"===i.status&&"第一審査が完了するまでお待ちください。","qr_testing"===i.status&&"QRコード実証検査中です。管理者からの連絡をお待ちください。","approved"===i.status&&"このドッグランは既に承認されています。","rejected"===i.status&&"審査が却下されました。詳細はダッシュボードでご確認ください。"]}),s.jsx(h,{to:"/owner-dashboard",children:s.jsx(xe,{children:"ダッシュボードに戻る"})})]})]}):s.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[s.jsx("div",{className:"flex items-center space-x-4 mb-6",children:s.jsxs(h,{to:"/owner-dashboard",className:"flex items-center text-blue-600 hover:text-blue-800",children:[s.jsx(Q,{className:"w-4 h-4 mr-2"}),"ダッシュボードに戻る"]})}),s.jsxs("div",{className:"text-center mb-8",children:[s.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-4 flex items-center justify-center",children:[s.jsx($,{className:"w-8 h-8 text-blue-600 mr-3"}),i.name,"の第二審査"]}),s.jsx("p",{className:"text-lg text-gray-600",children:"施設の詳細画像と振込先情報を登録して審査を完了させましょう"})]}),s.jsx(oe,{className:"bg-blue-50 border-blue-200",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(z,{className:"w-6 h-6 text-blue-600 mt-1"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"審査ステータス"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 text-sm text-blue-800",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-6 h-6 bg-green-600 text-white rounded-full flex items-center justify-center text-xs font-bold",children:"1"}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"第一審査"}),s.jsx("p",{className:"text-xs text-green-600",children:"完了"})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:`w-6 h-6 ${"second_stage_review"===i.status?"bg-green-600":"bg-blue-600"} text-white rounded-full flex items-center justify-center text-xs font-bold`,children:"2"}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"第二審査"}),s.jsx("p",{className:"text-xs text-blue-600",children:"first_stage_passed"===i.status?"画像アップロード中":"審査中"})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-6 h-6 bg-gray-400 text-white rounded-full flex items-center justify-center text-xs font-bold",children:"3"}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"QR実証検査"}),s.jsx("p",{className:"text-xs text-gray-600",children:"未実施"})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-6 h-6 bg-gray-400 text-white rounded-full flex items-center justify-center text-xs font-bold",children:"4"}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"運営開始"}),s.jsx("p",{className:"text-xs text-gray-600",children:"未完了"})]})]})]})]})]})}),g&&s.jsxs("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4 flex items-start",children:[s.jsx(a,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),s.jsx("p",{children:g})]}),N&&s.jsxs("div",{className:"bg-green-100 border border-green-300 text-green-800 rounded-lg p-4 flex items-start",children:[s.jsx(m,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),s.jsx("p",{children:N})]}),s.jsxs("div",{className:"flex space-x-4 border-b",children:[s.jsxs("button",{className:"px-4 py-2 font-medium "+("images"===C?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>D("images"),children:[s.jsx(X,{className:"w-4 h-4 inline mr-2"}),"施設画像"]}),s.jsxs("button",{className:"px-4 py-2 font-medium "+("bank"===C?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>D("bank"),children:[s.jsx(He,{className:"w-4 h-4 inline mr-2"}),"振込先情報"]})]}),"images"===C&&s.jsxs(oe,{children:[s.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[s.jsx(X,{className:"w-6 h-6 text-blue-600 mr-2"}),"施設画像のアップロード"]}),s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"bg-yellow-50 p-4 rounded-lg",children:s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx(a,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),s.jsxs("div",{className:"text-sm text-yellow-800",children:[s.jsx("p",{className:"font-medium mb-1",children:"画像アップロードのガイドライン"}),s.jsxs("ul",{className:"space-y-1",children:[s.jsx("li",{children:"• 鮮明で明るい画像を選んでください"}),s.jsx("li",{children:"• 施設の特徴がよくわかる角度から撮影してください"}),s.jsx("li",{children:"• 画像サイズは10MB以下にしてください"}),s.jsx("li",{children:"• JPG、PNG、GIF形式のみ対応しています"}),s.jsx("li",{children:"• 必須項目（*）は必ずアップロードしてください"})]})]})]})}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:n.map((e=>{const a=Ve[e.image_type],l=(null==a?void 0:a.icon)||$,r=(null==a?void 0:a.required)||!1;let i=null;if(null!==(e.is_approved??null)&&e.image_url){const a=!0===(c=e.is_approved??null)?{icon:m,color:"text-green-600",label:"承認済み"}:!1===c?{icon:S,color:"text-red-600",label:"却下"}:{icon:Ye,color:"text-yellow-600",label:"審査中"},t=a.icon;i=s.jsxs("div",{className:`flex items-center space-x-1 ${a.color}`,children:[s.jsx(t,{className:"w-4 h-4"}),s.jsx("span",{className:"text-xs",children:a.label})]})}var c;return s.jsxs("div",{className:"border rounded-lg p-4 relative",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(l,{className:"w-5 h-5 text-blue-600"}),s.jsxs("h3",{className:"font-medium",children:[(null==a?void 0:a.label)||e.image_type,r&&s.jsx("span",{className:"text-red-600 ml-1",children:"*"})]})]}),i]}),s.jsx("p",{className:"text-sm text-gray-600 mb-3",children:(null==a?void 0:a.description)||"画像をアップロードしてください"}),e.image_url?s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"h-40 bg-gray-100 rounded-lg overflow-hidden cursor-pointer",onClick:()=>w(e.image_url||null),children:s.jsx("img",{src:e.image_url,alt:(null==a?void 0:a.label)||e.image_type,className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://via.placeholder.com/400x300?text=Image+Not+Available"}})}),s.jsxs("div",{className:"absolute top-2 right-2 flex space-x-2",children:[s.jsx("button",{onClick:()=>w(e.image_url||null),className:"p-1 bg-white rounded-full shadow hover:bg-gray-100",children:s.jsx(V,{className:"w-4 h-4 text-blue-600"})}),s.jsx("button",{onClick:()=>(async e=>{if(e)try{const{error:s}=await ue.from("dog_park_facility_images").delete().eq("id",e);if(s)throw s;await R(),f("画像を削除しました"),setTimeout((()=>f("")),3e3)}catch(s){b("画像の削除に失敗しました"),setTimeout((()=>b("")),3e3)}})(e.id),className:"p-1 bg-white rounded-full shadow hover:bg-gray-100",disabled:!0===(e.is_approved??null),children:s.jsx(v,{className:"w-4 h-4 "+(!0===(e.is_approved??null)?"text-gray-400":"text-red-600")})})]}),!1===e.is_approved&&e.admin_notes&&s.jsxs("div",{className:"mt-2 p-2 bg-red-50 rounded text-sm text-red-800",children:[s.jsx("p",{className:"font-medium",children:"却下理由:"}),s.jsx("p",{children:e.admin_notes})]})]}):s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-blue-500 transition-colors",children:[s.jsx("input",{type:"file",id:`image-${e.image_type}`,accept:"image/*",className:"hidden",onChange:s=>{var a;const t=null==(a=s.target.files)?void 0:a[0];t&&((e,s)=>{d((a=>a.map((a=>a.image_type===e?{...a,file:s,error:void 0}:a))))})(e.image_type,t)}}),s.jsxs("label",{htmlFor:`image-${e.image_type}`,className:"cursor-pointer flex flex-col items-center",children:[s.jsx(J,{className:"w-8 h-8 text-gray-400 mb-2"}),s.jsx("span",{className:"text-sm text-gray-600",children:"クリックして画像を選択"})]})]}),e.file&&s.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-2 rounded",children:[s.jsx("span",{className:"text-sm truncate",children:e.file.name}),s.jsx(xe,{size:"sm",onClick:()=>(async e=>{const s=n.find((s=>s.image_type===e));if(s&&s.file)try{d((s=>s.map((s=>s.image_type===e?{...s,uploading:!0,error:void 0}:s))));const a=s.file.name.split(".").pop(),l=`${t}/${e}_${Date.now()}.${a}`,{error:r}=await ue.storage.from("dog-park-images").upload(l,s.file);if(r)throw r;const{data:{publicUrl:i}}=ue.storage.from("dog-park-images").getPublicUrl(l);if(s.id){const{error:e}=await ue.from("dog_park_facility_images").update({image_url:i,is_approved:null,updated_at:(new Date).toISOString()}).eq("id",s.id);if(e)throw e}else{const{error:s}=await ue.from("dog_park_facility_images").insert({park_id:t,image_type:e,image_url:i});if(s)throw s}await R();const c=Ve[e],n=(null==c?void 0:c.label)||e;f(`${n}の画像をアップロードしました`),setTimeout((()=>f("")),3e3)}catch(a){d((s=>s.map((s=>s.image_type===e?{...s,uploading:!1,error:"アップロードに失敗しました"}:s))))}})(e.image_type),isLoading:!!e.uploading,children:"アップロード"})]}),e.error&&s.jsx("p",{className:"text-sm text-red-600",children:e.error})]})]},e.image_type)}))})]})]}),"bank"===C&&s.jsxs(oe,{children:[s.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[s.jsx(He,{className:"w-6 h-6 text-blue-600 mr-2"}),"振込先情報"]}),O&&s.jsxs("div",{className:"mb-6 p-4 bg-red-50 rounded-lg flex items-start",children:[s.jsx(a,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),s.jsx("p",{className:"text-red-800",children:O})]}),L&&s.jsxs("div",{className:"mb-6 p-4 bg-green-50 rounded-lg flex items-start",children:[s.jsx(m,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),s.jsx("p",{className:"text-green-800",children:L})]}),s.jsx("form",{onSubmit:async e=>{e.preventDefault(),E(!0),q(""),F("");try{if(!T.bank_name)throw new Error("銀行名を入力してください");if(!T.bank_code)throw new Error("銀行コードを入力してください");if(!T.branch_name)throw new Error("支店名を入力してください");if(!T.branch_code)throw new Error("支店コードを入力してください");if(!T.account_number)throw new Error("口座番号を入力してください");if(!T.account_holder_name)throw new Error("口座名義を入力してください");if(!/^\d{4}$/.test(T.bank_code))throw new Error("銀行コードは4桁の数字で入力してください");if(!/^\d{3}$/.test(T.branch_code))throw new Error("支店コードは3桁の数字で入力してください");if(!/^\d{7}$/.test(T.account_number))throw new Error("口座番号は7桁の数字で入力してください");const{error:e}=await ue.rpc("update_owner_bank_account",{bank_name_param:T.bank_name,bank_code_param:T.bank_code,branch_name_param:T.branch_name,branch_code_param:T.branch_code,account_type_param:T.account_type,account_number_param:T.account_number,account_holder_name_param:T.account_holder_name});if(e)throw e;F("振込先情報を保存しました"),setTimeout((()=>{F("")}),3e3)}catch(s){q(s.message||"振込先情報の保存に失敗しました")}finally{E(!1)}},children:s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"bg-yellow-50 p-4 rounded-lg mb-6",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(a,{className:"w-5 h-5 text-yellow-600 mt-0.5 flex-shrink-0"}),s.jsxs("div",{className:"text-sm text-yellow-800",children:[s.jsx("p",{className:"font-medium mb-1",children:"振込先情報について"}),s.jsxs("ul",{className:"space-y-1",children:[s.jsx("li",{children:"• 売上金の振込先となる銀行口座情報を入力してください"}),s.jsx("li",{children:"• 振込は毎月15日に前月分を一括で行います"}),s.jsx("li",{children:"• 振込手数料は当社負担です"}),s.jsx("li",{children:"• 振込金額が5,000円未満の場合は翌月に繰り越されます"}),s.jsx("li",{children:"• 口座名義は正確に入力してください（例：ヤマダ タロウ）"})]})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsx(pe,{label:"銀行名 *",value:T.bank_name,onChange:e=>P({...T,bank_name:e.target.value}),placeholder:"例：三菱UFJ銀行",required:!0,icon:s.jsx(He,{className:"w-4 h-4 text-gray-500"})}),s.jsx(pe,{label:"銀行コード（4桁） *",value:T.bank_code,onChange:e=>{const s=e.target.value.replace(/\D/g,"");P({...T,bank_code:s})},placeholder:"例：0005",maxLength:4,required:!0,helperText:"4桁の数字で入力してください"}),s.jsx(pe,{label:"支店名 *",value:T.branch_name,onChange:e=>P({...T,branch_name:e.target.value}),placeholder:"例：渋谷支店",required:!0}),s.jsx(pe,{label:"支店コード（3桁） *",value:T.branch_code,onChange:e=>{const s=e.target.value.replace(/\D/g,"");P({...T,branch_code:s})},placeholder:"例：135",maxLength:3,required:!0,helperText:"3桁の数字で入力してください"}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"口座種別 *"}),s.jsxs("div",{className:"flex space-x-4",children:[s.jsxs("label",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"radio",checked:"ordinary"===T.account_type,onChange:()=>P({...T,account_type:"ordinary"}),className:"form-radio text-blue-600"}),s.jsx("span",{children:"普通"})]}),s.jsxs("label",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"radio",checked:"checking"===T.account_type,onChange:()=>P({...T,account_type:"checking"}),className:"form-radio text-blue-600"}),s.jsx("span",{children:"当座"})]})]})]}),s.jsx(pe,{label:"口座番号（7桁） *",value:T.account_number,onChange:e=>{const s=e.target.value.replace(/\D/g,"");P({...T,account_number:s})},placeholder:"例：1234567",maxLength:7,required:!0,helperText:"7桁の数字で入力してください",icon:s.jsx(j,{className:"w-4 h-4 text-gray-500"})}),s.jsx("div",{className:"md:col-span-2",children:s.jsx(pe,{label:"口座名義（カタカナ） *",value:T.account_holder_name,onChange:e=>P({...T,account_holder_name:e.target.value}),placeholder:"例：ヤマダ タロウ",required:!0,helperText:"カタカナで入力してください（姓と名の間にスペース）"})})]}),s.jsx("div",{className:"flex justify-end",children:s.jsx(xe,{type:"submit",isLoading:I,children:"振込先情報を保存"})})]})})]}),s.jsx("div",{className:"mt-8 flex justify-end",children:s.jsx(xe,{onClick:async()=>{var e,s,a,l,c,d;try{u(!0),b("");const o=["overview","entrance","gate","fence"];i&&(i.large_dog_area&&o.push("large_dog_area"),i.small_dog_area&&o.push("small_dog_area"),i.private_booths&&o.push("private_booth"),(null==(e=i.facilities)?void 0:e.parking)&&o.push("parking"),(null==(s=i.facilities)?void 0:s.shower)&&o.push("shower"),(null==(a=i.facilities)?void 0:a.restroom)&&o.push("restroom"),(null==(l=i.facilities)?void 0:l.agility)&&o.push("agility"),(null==(c=i.facilities)?void 0:c.rest_area)&&o.push("rest_area"),(null==(d=i.facilities)?void 0:d.water_station)&&o.push("water_station"));const x=o.filter((e=>!n.some((s=>s.image_type===e&&s.image_url))));if(x.length>0){const e=x.map((e=>{const s=Ve[e];return(null==s?void 0:s.label)||e})).join("、");return b(`以下の必要な画像がアップロードされていません: ${e}`),void u(!1)}const{error:m}=await ue.rpc("submit_second_stage_review",{park_id_param:t});if(m)throw new Error(m.message);f("第二審査の申請が完了しました！管理者による審査をお待ちください。"),setTimeout((()=>{r("/owner-dashboard")}),2e3)}catch(o){b("審査申請に失敗しました: "+o.message)}finally{u(!1)}},isLoading:p,disabled:"second_stage_review"===i.status,className:"bg-blue-600 hover:bg-blue-700",children:"second_stage_review"===i.status?"審査中です":"第二審査を申請する"})}),s.jsx(oe,{className:"bg-gray-50",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(z,{className:"w-6 h-6 text-gray-600 mt-1"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"審査プロセスについて"}),s.jsxs("div",{className:"text-sm text-gray-700 space-y-1",children:[s.jsx("p",{children:"• 第二審査では、施設の詳細画像と振込先情報を確認します"}),s.jsx("p",{children:"• 審査期間は通常3-5営業日です"}),s.jsx("p",{children:"• 画像に問題がある場合は再提出を求められることがあります"}),s.jsx("p",{children:"• 審査通過後、QRコード実証検査の日程調整を行います"}),s.jsx("p",{children:"• 実証検査完了後、一般公開となります"})]})]})]})})]}):s.jsxs("div",{className:"max-w-4xl mx-auto text-center py-12",children:[s.jsx(a,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),s.jsx("h2",{className:"text-2xl font-bold mb-2",children:"ドッグランが見つかりません"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"指定されたドッグランが見つからないか、アクセス権限がありません。"}),s.jsx(h,{to:"/owner-dashboard",children:s.jsx(xe,{children:"ダッシュボードに戻る"})})]})}},Symbol.toStringTag,{value:"Module"})),Ze=Object.freeze(Object.defineProperty({__proto__:null,ParkPublishingSetup:function(){const{parkId:t}=_(),l=k(),{user:r}=me(),[i,c]=e.useState(null),[n,o]=e.useState([]),[x,h]=e.useState(!0),[p,j]=e.useState(""),[g,b]=e.useState(""),[f,y]=e.useState({smartLockTest:!1,pageEditing:!1,readyToPublish:!1}),[v,w]=e.useState(!1),[C,D]=e.useState({name:"",description:"",facility_details:"",price:0}),[T,P]=e.useState([]),[I,$]=e.useState([]),[E,O]=e.useState(!1),[q,L]=e.useState(!1);e.useEffect((()=>{r&&t?F():l("/owner-dashboard")}),[r,t,l]);const F=async()=>{try{h(!0);const{data:e,error:s}=await ue.from("dog_parks").select("*").eq("id",t).eq("owner_id",null==r?void 0:r.id).single();if(s)throw s;if(!e)return void j("ドッグランが見つかりません。");if("qr_testing_ready"!==e.status&&"editing"!==e.status&&"ready_to_publish"!==e.status)return void j("このドッグランは公開準備の段階ではありません。");c(e),D({name:e.name||"",description:e.description||"",facility_details:e.facility_details||"",price:e.price||0});const{data:a,error:l}=await ue.from("smart_locks").select("*").eq("park_id",t);if(l)throw l;o(a||[]),R(e)}catch(e){j("データの取得に失敗しました。")}finally{h(!1)}},R=e=>{const s={smartLockTest:"qr_testing_ready"!==e.status,pageEditing:"ready_to_publish"===e.status,readyToPublish:"ready_to_publish"===e.status};y(s)},M=async()=>{try{const{error:e}=await ue.from("dog_parks").update({status:"editing"}).eq("id",t);if(e)throw e;y((e=>({...e,smartLockTest:!0}))),b("スマートロックのテストが完了しました。"),await F()}catch(e){j("スマートロックテストの完了記録に失敗しました。")}};return x?s.jsx("div",{className:"flex justify-center items-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):i?s.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[s.jsx("div",{className:"flex items-center justify-between mb-6",children:s.jsxs("div",{children:[s.jsxs(xe,{variant:"secondary",onClick:()=>l("/owner-dashboard"),className:"mb-4",children:[s.jsx(Q,{className:"w-4 h-4 mr-2"}),"ダッシュボードに戻る"]}),s.jsxs("h1",{className:"text-2xl font-bold",children:[i.name," - 公開準備"]}),s.jsx("p",{className:"text-gray-600",children:"二次審査が承認されました。公開前に以下の作業を完了してください。"})]})}),p&&s.jsx("div",{className:"mb-6 p-4 bg-red-50 border-l-4 border-red-400 text-red-700",children:s.jsxs("div",{className:"flex",children:[s.jsx(a,{className:"w-5 h-5 mr-2 mt-0.5"}),p]})}),g&&s.jsx("div",{className:"mb-6 p-4 bg-green-50 border-l-4 border-green-400 text-green-700",children:s.jsxs("div",{className:"flex",children:[s.jsx(m,{className:"w-5 h-5 mr-2 mt-0.5"}),g]})}),s.jsxs(oe,{className:"mb-6 p-6",children:[s.jsx("h2",{className:"text-lg font-semibold mb-4",children:"公開準備の進捗"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center p-4 rounded-lg "+(f.smartLockTest?"bg-green-50":"bg-yellow-50"),children:[s.jsx("div",{className:"w-6 h-6 rounded-full mr-4 flex items-center justify-center "+(f.smartLockTest?"bg-green-500":"bg-yellow-500"),children:f.smartLockTest?s.jsx(ce,{className:"w-4 h-4 text-white"}):s.jsx("span",{className:"text-white text-sm",children:"1"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-medium",children:"スマートロックの動作確認"}),s.jsx("p",{className:"text-sm text-gray-600",children:f.smartLockTest?"動作確認が完了しました":"スマートロックの動作を確認してください"})]})]}),s.jsxs("div",{className:"flex items-center p-4 rounded-lg "+(f.pageEditing?"bg-green-50":"bg-yellow-50"),children:[s.jsx("div",{className:"w-6 h-6 rounded-full mr-4 flex items-center justify-center "+(f.pageEditing?"bg-green-500":"bg-yellow-500"),children:f.pageEditing?s.jsx(ce,{className:"w-4 h-4 text-white"}):s.jsx("span",{className:"text-white text-sm",children:"2"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-medium",children:"掲載ページの編集"}),s.jsx("p",{className:"text-sm text-gray-600",children:f.pageEditing?"掲載ページの編集が完了しました":"掲載ページの内容を編集してください"})]})]}),s.jsxs("div",{className:"flex items-center p-4 rounded-lg "+(f.readyToPublish?"bg-green-50":"bg-gray-50"),children:[s.jsx("div",{className:"w-6 h-6 rounded-full mr-4 flex items-center justify-center "+(f.readyToPublish?"bg-green-500":"bg-gray-400"),children:f.readyToPublish?s.jsx(ce,{className:"w-4 h-4 text-white"}):s.jsx("span",{className:"text-white text-sm",children:"3"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-medium",children:"公開準備完了"}),s.jsx("p",{className:"text-sm text-gray-600",children:f.readyToPublish?"公開準備が完了しました":"上記の作業を完了してから公開してください"})]})]})]})]}),!f.smartLockTest&&s.jsxs(oe,{className:"mb-6 p-6",children:[s.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center",children:[s.jsx(u,{className:"w-5 h-5 mr-2"}),"1. スマートロックの動作確認"]}),s.jsx("p",{className:"text-gray-600 mb-4",children:"実際にスマートロックを開錠して動作を確認してください。"}),n.length>0?s.jsx("div",{className:"space-y-4",children:n.map((e=>s.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[s.jsx("h3",{className:"font-medium mb-2",children:e.lock_name}),s.jsx("p",{className:"text-sm text-gray-600 mb-3",children:e.location}),s.jsx(_e,{lockId:e.lock_id,label:"PINコードを生成してテスト",onSuccess:()=>{b(`${e.lock_name}のテストが完了しました。`),setTimeout((()=>{M()}),1e3)},onError:e=>j(`スマートロックのテストに失敗しました: ${e}`)})]},e.id)))}):s.jsxs("div",{className:"text-center py-8",children:[s.jsx(le,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"このドッグランにはスマートロックが設定されていません。"}),s.jsx(xe,{onClick:M,className:"mt-4",children:"スマートロックテストを完了として進む"})]})]}),f.smartLockTest&&!f.pageEditing&&s.jsxs(oe,{className:"mb-6 p-6",children:[s.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center",children:[s.jsx(N,{className:"w-5 h-5 mr-2"}),"2. 掲載ページの編集"]}),s.jsx("p",{className:"text-gray-600 mb-4",children:"ドッグランの掲載ページを編集してください。"}),v?s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(pe,{label:"施設名",value:C.name,onChange:e=>D((s=>({...s,name:e.target.value}))),required:!0}),s.jsx(pe,{label:"料金（円）",type:"number",value:C.price,onChange:e=>D((s=>({...s,price:Number(e.target.value)}))),required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"施設の説明"}),s.jsx("textarea",{value:C.description,onChange:e=>D((s=>({...s,description:e.target.value}))),rows:4,className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"お客様に向けた施設の魅力を説明してください..."})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"施設詳細・利用規約"}),s.jsx("textarea",{value:C.facility_details,onChange:e=>D((s=>({...s,facility_details:e.target.value}))),rows:6,className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"施設の詳細情報や利用規約を記入してください..."})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"施設画像を追加"}),s.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[s.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>{const s=Array.from(e.target.files||[]);P(s);const a=s.map((e=>URL.createObjectURL(e)));$(a)},className:"hidden",id:"park-images"}),s.jsxs("label",{htmlFor:"park-images",className:"cursor-pointer",children:[s.jsx(X,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),s.jsx("span",{className:"text-sm text-gray-600",children:"クリックして画像を選択"})]})]}),I.length>0&&s.jsx("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-3 gap-4",children:I.map(((e,a)=>s.jsx("img",{src:e,alt:`プレビュー ${a+1}`,className:"w-full h-24 object-cover rounded-lg border"},a)))})]}),s.jsxs("div",{className:"flex space-x-3",children:[s.jsxs(xe,{onClick:async()=>{try{O(!0);const{error:e}=await ue.from("dog_parks").update({name:C.name,description:C.description,facility_details:C.facility_details,price:C.price,status:"ready_to_publish"}).eq("id",t);if(e)throw e;T.length>0&&await(async()=>{for(const e of T){const s=`${Date.now()}_${e.name}`,a=`${t}/${s}`,{error:l}=await ue.storage.from("dog-park-images").upload(a,e);if(l)throw l;const r=ue.storage.from("dog-park-images").getPublicUrl(a).data.publicUrl;await ue.from("dog_parks").update({image_url:r}).eq("id",t)}})(),y((e=>({...e,pageEditing:!0,readyToPublish:!0}))),b("掲載ページの編集が完了しました。"),w(!1),await F()}catch(e){j("掲載ページの保存に失敗しました。")}finally{O(!1)}},disabled:E,className:"flex-1",children:[s.jsx(ne,{className:"w-4 h-4 mr-2"}),E?"保存中...":"編集を保存"]}),s.jsxs(xe,{variant:"secondary",onClick:()=>{w(!1),P([]),$([])},children:[s.jsx(S,{className:"w-4 h-4 mr-2"}),"キャンセル"]})]})]}):s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[s.jsx("h3",{className:"font-medium mb-2",children:"現在の掲載内容"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("p",{children:[s.jsx("strong",{children:"施設名:"})," ",i.name]}),s.jsxs("p",{children:[s.jsx("strong",{children:"説明:"})," ",i.description||"未設定"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"施設詳細:"})," ",i.facility_details||"未設定"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"料金:"})," ¥",i.price]})]})]}),s.jsxs(xe,{onClick:()=>w(!0),children:[s.jsx(N,{className:"w-4 h-4 mr-2"}),"編集を開始"]})]})]}),f.readyToPublish&&s.jsxs(oe,{className:"mb-6 p-6",children:[s.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center",children:[s.jsx(B,{className:"w-5 h-5 mr-2"}),"3. ドッグランを公開"]}),s.jsx("p",{className:"text-gray-600 mb-4",children:"すべての準備が完了しました。ドッグランを一般公開してください。"}),s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg mb-4",children:[s.jsx("h3",{className:"font-medium text-blue-900 mb-2",children:"公開後の流れ"}),s.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[s.jsx("li",{children:"• ドッグランが一般のユーザーに公開されます"}),s.jsx("li",{children:"• 予約の受付が開始されます"}),s.jsx("li",{children:"• 収益の発生が開始されます"}),s.jsx("li",{children:"• 管理画面で予約状況や収益を確認できます"})]})]}),s.jsxs(xe,{onClick:async()=>{if(f.smartLockTest&&f.pageEditing)try{L(!0);const{error:e}=await ue.from("dog_parks").update({status:"approved"}).eq("id",t);if(e)throw e;await ue.from("admin_notifications").insert([{type:"park_published",title:"ドッグラン公開",message:`${null==i?void 0:i.name}が公開されました。`,data:{park_id:t}}]),b("ドッグランが公開されました！"),setTimeout((()=>{l(`/parks/${t}/manage`)}),2e3)}catch(e){j("ドッグランの公開に失敗しました。")}finally{L(!1)}else j("すべてのタスクを完了してから公開してください。")},disabled:q,className:"w-full bg-green-600 hover:bg-green-700",children:[s.jsx(d,{className:"w-4 h-4 mr-2"}),q?"公開中...":"ドッグランを公開する"]})]})]}):s.jsx("div",{className:"max-w-4xl mx-auto p-6",children:s.jsxs(oe,{className:"p-8 text-center",children:[s.jsx(a,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),s.jsx("h2",{className:"text-xl font-bold mb-2",children:"ドッグランが見つかりません"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"指定されたドッグランが見つからないか、アクセス権限がありません。"}),s.jsx(xe,{onClick:()=>l("/owner-dashboard"),children:"ダッシュボードに戻る"})]})})}},Symbol.toStringTag,{value:"Module"}));export{we as D,qe as P,Ie as a,Ae as b,We as c,Qe as d,Be as e,Ge as f,Ke as g,Ze as h,$e as p};

import{j as e}from"./motion-CuO0nkIV.js";import{r as t}from"./react-vendor-cniURDpR.js";import{s}from"./index-qwdJeTcH.js";import{X as a,G as r}from"./ui-basic-icnN6BOT.js";function n({userCoupon:n,onClose:l,onUse:i}){const[c,d]=t.useState(""),[o,x]=t.useState(!1),[m,u]=t.useState(""),[h,p]=t.useState(!1),f=t.useRef(null),{coupon:g}=n;t.useEffect(()=>{if(u((new Date).toLocaleString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),"once"!==g.usage_limit_type||n.is_used||h||j(),x(!0),f.current){f.current.style.userSelect="none",f.current.style.webkitUserSelect="none",f.current.style.pointerEvents="none";const e=e=>"PrintScreen"===e.key?(e.preventDefault(),alert("スクリーンショットは禁止されています。店員にこの画面を直接お見せください。"),!1):e.ctrlKey&&e.shiftKey&&"I"===e.key||"F12"===e.key||e.ctrlKey&&"s"===e.key?(e.preventDefault(),!1):void 0;document.addEventListener("keydown",e);const t=e=>(e.preventDefault(),!1);return document.addEventListener("contextmenu",t),()=>{document.removeEventListener("keydown",e),document.removeEventListener("contextmenu",t)}}},[]),t.useEffect(()=>{const e=()=>{const e=(new Date).getTime(),t=new Date(g.end_date).getTime()-e;if(t>0){const e=Math.floor(t/864e5),s=Math.floor(t%864e5/36e5),a=Math.floor(t%36e5/6e4);d(e>0?`${e}日${s}時間${a}分`:s>0?`${s}時間${a}分`:`${a}分`)}else d("有効期限切れ")};e();const t=setInterval(e,6e4);return()=>clearInterval(t)},[g.end_date]);const j=async()=>{if(!h){p(!0);try{const{error:e}=await s.from("user_coupons").update({is_used:!0,used_at:(new Date).toISOString()}).eq("qr_code_token",n.qr_code_token);if(e)return;i&&i(n.qr_code_token)}catch(e){}finally{p(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{ref:f,className:"bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden",style:{filter:o?"none":"blur(5px)",WebkitFilter:o?"none":"blur(5px)"},children:[e.jsxs("div",{className:"bg-gradient-to-r from-red-500 to-red-600 text-white p-6 relative",children:[e.jsx("button",{onClick:l,className:"absolute top-4 right-4 text-white hover:text-gray-200 pointer-events-auto",children:e.jsx(a,{className:"w-6 h-6"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"ドッグパークJP"}),e.jsx("h2",{className:"text-xl font-medium",children:"クーポン"})]}),e.jsx("div",{className:"flex items-center justify-center mt-4 bg-black bg-opacity-20 rounded-lg p-2",children:e.jsxs("span",{className:"text-sm",children:["表示: ",m]})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"w-full max-w-sm mx-auto",children:[g.coupon_image_url?e.jsx("div",{className:"aspect-square w-full border-2 border-gray-300 rounded-lg overflow-hidden",children:e.jsx("img",{src:g.coupon_image_url,alt:"クーポン画像",className:"w-full h-full object-cover",style:{userSelect:"none",pointerEvents:"none"}})}):e.jsx("div",{className:"aspect-square w-full border-2 border-gray-300 rounded-lg relative overflow-hidden",children:e.jsxs("div",{className:"w-full h-full bg-gradient-to-br from-red-500 to-red-600 relative",children:[e.jsx("div",{className:"absolute top-1/2 -left-3 w-6 h-6 bg-white rounded-full transform -translate-y-1/2"}),e.jsx("div",{className:"absolute top-1/2 -right-3 w-6 h-6 bg-white rounded-full transform -translate-y-1/2"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-10",children:e.jsx("span",{className:"text-6xl font-bold text-white transform rotate-12",children:"COUPON"})}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-center h-full p-4 text-center space-y-3",children:[e.jsx("div",{className:"bg-white/95 px-3 py-1 rounded-full shadow-sm",children:e.jsx("span",{className:"text-xs font-medium text-red-600",children:"ドッグパークJPクーポン"})}),e.jsx("div",{className:"text-white",children:e.jsx("h2",{className:"text-lg font-bold leading-tight",children:g.facility?.name||"店舗名"})}),e.jsx("div",{className:"text-white",children:e.jsx("h3",{className:"text-xl font-bold leading-tight",children:g.title})}),e.jsx("div",{className:"text-white/90",children:e.jsx("p",{className:"text-base leading-tight",children:g.service_content})}),g.discount_value&&g.discount_type&&e.jsxs("div",{className:"bg-white text-red-600 px-6 py-3 rounded-lg shadow-md",children:[e.jsxs("span",{className:"text-4xl font-bold",children:[g.discount_value,"amount"===g.discount_type?"円":"%"]}),e.jsx("span",{className:"text-lg ml-2 font-medium",children:"OFF"})]}),g.description&&e.jsx("div",{className:"border-t border-white/30 pt-2",children:e.jsx("p",{className:"text-sm text-white/80",children:g.description})}),g.start_date&&g.end_date&&e.jsxs("div",{className:"border-t border-white/30 pt-2 mt-2",children:[e.jsxs("p",{className:"text-xs text-white/90 font-medium",children:["有効期限: ",new Date(g.start_date).toLocaleDateString()," 〜 ",new Date(g.end_date).toLocaleDateString()]}),c&&e.jsxs("p",{className:"text-xs text-white/70 mt-1",children:["(残り",c,")"]})]})]})]})}),e.jsx("div",{className:"mt-2 text-xs text-gray-500 text-center",children:g.coupon_image_url?"画像クーポン":"テキストクーポン"})]}),e.jsx("div",{className:"mt-4 space-y-2",children:e.jsx("div",{className:"flex items-center justify-center space-x-4 text-sm text-gray-600",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(r,{className:"w-4 h-4 mr-1"}),e.jsxs("span",{children:["使用制限: ","once"===g.usage_limit_type?"1回限り":"何回でも"]})]})})}),e.jsx("div",{className:"mt-6 text-center",children:n.is_used?e.jsxs("div",{className:"bg-gray-100 text-gray-600 py-3 px-4 rounded-lg",children:[e.jsx("p",{className:"font-semibold",children:"使用済み"}),e.jsx("p",{className:"text-sm",children:n.used_at&&new Date(n.used_at).toLocaleString("ja-JP")})]}):e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-green-800 font-semibold mb-2",children:"使用可能"}),e.jsx("p",{className:"text-green-700 text-sm mb-3",children:"この画面を店員さんにお見せください"}),"once"===g.usage_limit_type&&e.jsx("p",{className:"text-red-600 text-xs",children:"※このクーポンは1回限りです。使用後は表示できなくなります。"})]})}),e.jsxs("div",{className:"text-center text-xs text-gray-500 mt-4",children:["ID: ",n.qr_code_token.substring(0,8),"..."]})]}),e.jsxs("div",{className:"bg-gray-50 px-6 py-4 text-center",children:[e.jsxs("p",{className:"text-xs text-gray-500",children:["※このクーポンは","once"===g.usage_limit_type?"一度":"何度でも","ご利用いただけます"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"※有効期限をお確かめの上ご利用ください"})]})]})})}export{n as C};

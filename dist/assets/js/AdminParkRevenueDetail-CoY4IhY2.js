import{j as e}from"./motion-CuO0nkIV.js";import{r as t}from"./react-vendor-cniURDpR.js";import{a as s,d as a,c as r,L as n}from"./router-Cg6wfOY4.js";import{u as i,s as c,C as l}from"./index-qwdJeTcH.js";import{af as x,bj as o,aW as d}from"./ui-basic-icnN6BOT.js";import"./heavy-features-BIdEME4r.js";import"./supabase-B0bqaRGb.js";function m(){const{isAdmin:m}=i(),h=s(),{parkId:p}=a(),[u,j]=r(),[g,y]=t.useState(""),f=Number(u.get("year"))||(new Date).getFullYear(),N=Number(u.get("month"))||(new Date).getMonth(),[v,b]=t.useState([]),[w,_]=t.useState(!0),[D,S]=t.useState("");t.useEffect(()=>{m?M():h("/")},[m,p,f,N,h]);const M=async()=>{try{if(_(!0),S(""),!p)return;const{data:e}=await c.from("dog_parks").select("name").eq("id",p).single();y(e?.name||"");const t=new Date(f,N,1),s=new Date(f,N+1,0),{data:a,error:r}=await c.from("reservations").select("*").eq("park_id",p).gte("created_at",t.toISOString()).lt("created_at",new Date(s.getFullYear(),s.getMonth(),s.getDate()+1).toISOString()).not("total_amount","is",null);if(r)throw r;const n={};for(let c=1;c<=s.getDate();c++){const e=new Date(f,N,c).toISOString().slice(0,10);n[e]={total:0,daypass_count:0,private_hours:0,subscription_count:0}}(a||[]).forEach(e=>{const t=new Date(e.created_at).toISOString().slice(0,10);if(void 0!==n[t]){n[t].total+=e.total_amount||0;const s=String(e.reservation_type||"").toLowerCase();"daypass"===s||"1day"===s||"day_pass"===s?n[t].daypass_count+=Number(e.guest_count||1):"whole_facility"===s||"private"===s||"rental"===s?n[t].private_hours+=Number(e.duration||1):"subscription"===s&&(n[t].subscription_count+=1)}});const i=Object.entries(n).map(([e,t])=>({date:e,...t}));b(i)}catch(e){S("データの取得に失敗しました")}finally{_(!1)}},I=t.useMemo(()=>v.reduce((e,t)=>e+t.total,0),[v]),O=t.useMemo(()=>v.reduce((e,t)=>e+t.daypass_count,0),[v]),C=t.useMemo(()=>v.reduce((e,t)=>e+t.private_hours,0),[v]),L=t.useMemo(()=>v.reduce((e,t)=>e+t.subscription_count,0),[v]);return e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center space-x-4 mb-2",children:e.jsxs(n,{to:`/admin/revenue?year=${f}&month=${N}`,className:"flex items-center text-gray-600 hover:text-gray-800",children:[e.jsx(x,{className:"w-4 h-4 mr-2"})," 売上レポートに戻る"]})}),e.jsx("h1",{className:"text-2xl font-bold",children:"ドッグラン売上詳細"}),e.jsxs("div",{className:"text-sm text-gray-600",children:["ドッグラン: ",g,"（ID: ",p,"）"]}),e.jsx(l,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"対象月"}),e.jsxs("div",{className:"text-lg font-semibold",children:[f,"年",N+1,"月"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("select",{value:f,onChange:e=>j(t=>(t.set("year",e.target.value),t)),className:"px-2 py-1 border rounded",children:[0,1,2,3].map(t=>{const s=(new Date).getFullYear()-t;return e.jsxs("option",{value:s,children:[s,"年"]},s)})}),e.jsx("select",{value:N,onChange:e=>j(t=>(t.set("month",e.target.value),t)),className:"px-2 py-1 border rounded",children:Array.from({length:12},(e,t)=>t).map(t=>e.jsxs("option",{value:t,children:[t+1,"月"]},t))})]})]})}),e.jsxs(l,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center",children:[e.jsx(o,{className:"w-5 h-5 mr-2"}),"日別売上"]}),e.jsxs("div",{className:"text-sm text-gray-600 flex items-center gap-4",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(d,{className:"w-4 h-4 mr-1"}),"月合計: ¥",I.toLocaleString()]}),e.jsxs("span",{children:["1Dayパス: ",O,"人"]}),e.jsxs("span",{children:["貸し切り: ",C,"時間"]}),e.jsxs("span",{children:["サブスク: ",L,"人"]})]})]}),D&&e.jsx("div",{className:"text-sm text-red-600 mb-2",children:D}),w?e.jsx("div",{className:"text-sm text-gray-500",children:"読み込み中..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"日付"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase",children:"売上"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase",children:"1Day"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase",children:"貸切(h)"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase",children:"サブスク"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:v.map(t=>e.jsxs("tr",{children:[e.jsxs("td",{className:"px-4 py-2 text-sm text-gray-800",children:[new Date(t.date).getMonth()+1,"/",new Date(t.date).getDate()]}),e.jsxs("td",{className:"px-4 py-2 text-sm text-right",children:["¥",(t.total||0).toLocaleString()]}),e.jsx("td",{className:"px-4 py-2 text-sm text-right",children:t.daypass_count||0}),e.jsx("td",{className:"px-4 py-2 text-sm text-right",children:t.private_hours||0}),e.jsx("td",{className:"px-4 py-2 text-sm text-right",children:t.subscription_count||0})]},t.date))})]})})]})]})}export{m as default};

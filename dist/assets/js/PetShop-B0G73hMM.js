import{j as e}from"./motion-BHsL7Azw.js";import{r as s}from"./react-vendor-CMvmJHsS.js";import{L as a,a as t}from"./router-DXQOdrLL.js";import{B as r,u as i,b as l,s as c}from"./index-DbimBzz0.js";import{C as n}from"./Card-DqVnP9TA.js";import{I as o}from"./Input-2E2l4WcX.js";import{u as d}from"./useStripe-BRxSaZ-J.js";import{p as m}from"./stripe-config-03sBkt-B.js";import{o as x,k as h,c as u,S as p,G as g,a3 as j,i as f,J as b,j as v,a4 as N,a5 as w}from"./ui-basic-C77EGLVg.js";import"./heavy-features-Dlg1c9Yc.js";import"./supabase-D2tiogv8.js";import"./external-api-CcgPsVUa.js";function y({hasSubscription:t=!1,className:i="",variant:l="primary",size:c="md"}){const{createCheckoutSession:n,loading:o,error:h}=d(),[u,p]=s.useState(!1);return t?e.jsx(a,{to:"/subscription-intro",children:e.jsxs(r,{variant:l,size:c,className:`flex items-center ${i}`,children:[e.jsx(x,{className:("sm"===c?"w-3 h-3":"w-4 h-4")+" mr-1"}),"ã‚µãƒ–ã‚¹ã‚¯ç®¡ç†"]})}):e.jsxs("div",{children:[e.jsxs(r,{onClick:()=>{(async()=>{p(!1);const e=m.find(e=>"subscription"===e.mode);if(e)try{await n({priceId:e.priceId,mode:"subscription",successUrl:`${window.location.origin}/dashboard?success=true`,cancelUrl:`${window.location.origin}/dashboard?canceled=true`})}catch{p(!0)}})()},isLoading:o,variant:"primary",size:c,className:`flex items-center bg-purple-600 hover:bg-purple-700 text-white ${i}`,children:[e.jsx(x,{className:("sm"===c?"w-3 h-3":"w-4 h-4")+" mr-1"}),"ã‚µãƒ–ã‚¹ã‚¯ã«åŠ å…¥"]}),u&&h&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:h})]})}function _(){const{user:d}=i(),m=t(),[_,C]=s.useState([]),[S,q]=s.useState([]),[k,L]=s.useState(!0),[z,F]=s.useState(""),[T,A]=s.useState("all"),[D,O]=s.useState("name"),{isActive:$}=l(),I=s.useDeferredValue(z),J=s.useDeferredValue(T),V=s.useDeferredValue(D),E=[{value:"all",label:"ã™ã¹ã¦",icon:h},{value:"food",label:"ãƒ‰ãƒƒã‚°ãƒ•ãƒ¼ãƒ‰",icon:j},{value:"treats",label:"ãŠã‚„ã¤",icon:f},{value:"toys",label:"ãŠã‚‚ã¡ã‚ƒ",icon:b},{value:"accessories",label:"ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼",icon:x},{value:"health",label:"ãƒ˜ãƒ«ã‚¹ã‚±ã‚¢",icon:v},{value:"sheets",label:"ãƒšãƒƒãƒˆã‚·ãƒ¼ãƒ„",icon:j}];s.useEffect(()=>{M()},[d]);const M=async()=>{L(!0);try{await Promise.all([P(),d?U():Promise.resolve()])}catch(e){}finally{L(!1)}},P=async()=>{const{data:e,error:s}=await c.from("products").select("*").eq("is_active",!0).order("created_at",{ascending:!1});if(s)throw s;C(e||[])},U=async()=>{const{data:e,error:s}=await c.from("cart_items").select("*, product:products(*)").eq("user_id",d.id);if(s)throw s;q(e||[])},B=async(e,s)=>{if(s<=0)try{const{error:s}=await c.from("cart_items").delete().eq("id",e);if(s)throw s;await M()}catch(a){}else try{const{error:a}=await c.from("cart_items").update({quantity:s}).eq("id",e);if(a)throw a;await M()}catch(a){}},G=e=>$?Math.round(.9*e):e,H=s.useMemo(()=>_.filter(e=>{const s=e.name.toLowerCase().includes(I.toLowerCase())||e.description.toLowerCase().includes(I.toLowerCase())||e.brand&&e.brand.toLowerCase().includes(I.toLowerCase()),a="all"===J||e.category===J;return s&&a}).sort((e,s)=>{switch(V){case"name":return e.name.localeCompare(s.name);case"price":return G(e.price)-G(s.price);case"category":return e.category.localeCompare(s.category);default:return new Date(s.created_at).getTime()-new Date(e.created_at).getTime()}}),[_,I,J,V]),K=e=>{if(!e)return"";try{const s=JSON.parse(e);if(Array.isArray(s)&&s.length>0)return s[0]}catch(s){}return e},Q=e=>{if(!e)return[];try{const s=JSON.parse(e);if(Array.isArray(s))return s}catch(s){}return[e]},R=e=>{s.startTransition(()=>{A(e)})};return k?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center",children:[e.jsx(h,{className:"w-8 h-8 text-green-600 mr-3"}),"ãƒšãƒƒãƒˆã‚·ãƒ§ãƒƒãƒ—"]}),e.jsx("p",{className:"text-gray-600",children:"æ„›çŠ¬ã®ãŸã‚ã®å³é¸å•†å“ã‚’ãŠå±Šã‘"})]}),e.jsx(a,{to:"/cart",children:e.jsxs(r,{className:"bg-green-600 hover:bg-green-700",children:[e.jsx(u,{className:"w-4 h-4 mr-2"}),"ã‚«ãƒ¼ãƒˆ (",S.reduce((e,s)=>e+s.quantity,0),")"]})})]}),e.jsx("div",{className:"relative overflow-hidden",children:$?e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 via-pink-600 to-purple-700 text-white p-8 rounded-xl shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-full",children:e.jsx(x,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold mb-2 flex items-center",children:[e.jsx(p,{className:"w-6 h-6 mr-2"}),"ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ä¼šå“¡ç‰¹å…¸é©ç”¨ä¸­ï¼"]}),e.jsx("p",{className:"text-lg opacity-90",children:"å…¨å•†å“10%OFF + é€æ–™ç„¡æ–™ã§ãŠè²·ã„ç‰©ã‚’ãŠæ¥½ã—ã¿ãã ã•ã„"})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"bg-white/20 px-6 py-3 rounded-lg",children:[e.jsx("p",{className:"text-sm opacity-80",children:"ä»Šæœˆã®ç¯€ç´„é¡"}),e.jsx("p",{className:"text-2xl font-bold",children:"Â¥1,200+"})]})})]}),e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-16 -mt-16"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white/10 rounded-full -ml-12 -mb-12"})]}):e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 text-white p-8 rounded-xl shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-full",children:e.jsx(g,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold mb-2 flex items-center",children:[e.jsx(x,{className:"w-6 h-6 mr-2"}),"ã‚µãƒ–ã‚¹ã‚¯ä¼šå“¡ã¯å…¨å“10ï¼…OFF & é€æ–™ç„¡æ–™ï¼"]}),e.jsx("p",{className:"text-lg opacity-90",children:"æœˆé¡3,800å††ã§ã©ã“ã§ã‚‚ä½¿ã„æ”¾é¡Œ + ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ä½¿ã„æ”¾é¡Œ"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(y,{hasSubscription:$,className:"bg-white text-purple-600 hover:bg-gray-100 font-bold px-6 py-3 text-lg"}),e.jsx("p",{className:"text-sm opacity-80 mt-2",children:"åˆæœˆç„¡æ–™ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ä¸­"})]})]}),e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-16 -mt-16"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white/10 rounded-full -ml-12 -mb-12"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(o,{label:"",value:z,onChange:e=>{return a=e.target.value,F(a),void s.startTransition(()=>{});var a},placeholder:"å•†å“åã€ãƒ–ãƒ©ãƒ³ãƒ‰åã§æ¤œç´¢..."})}),e.jsx("div",{children:e.jsx("select",{value:T,onChange:e=>R(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",children:E.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})}),e.jsx("div",{children:e.jsxs("select",{value:D,onChange:e=>{return a=e.target.value,void s.startTransition(()=>{O(a)});var a},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",children:[e.jsx("option",{value:"popular",children:"äººæ°—é †"}),e.jsx("option",{value:"name",children:"åå‰é †"}),e.jsx("option",{value:"price",children:"ä¾¡æ ¼ã®å®‰ã„é †"}),e.jsx("option",{value:"category",children:"ã‚«ãƒ†ã‚´ãƒªãƒ¼é †"})]})})]}),e.jsx("div",{className:"flex space-x-2 overflow-x-auto pb-2",children:E.map(s=>{const a=s.icon;return e.jsxs("button",{onClick:()=>R(s.value),className:"flex items-center space-x-2 px-4 py-2 rounded-lg whitespace-nowrap transition-colors "+(T===s.value?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[e.jsx(a,{className:"w-4 h-4"}),e.jsx("span",{children:s.label})]},s.value)})}),0===H.length?e.jsxs(n,{className:"text-center py-12",children:[e.jsx(h,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"è©²å½“ã™ã‚‹å•†å“ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:H.map(s=>{const t=(e=>{const s=S.find(s=>s.product_id===e);return s?s.quantity:0})(s.id),i=s.price,l=G(i),o=$&&l<i;return e.jsxs(n,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"relative h-48 mb-4 -m-6 mb-4",children:[e.jsx("img",{src:K(s.image_url),alt:s.name,className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://images.pexels.com/photos/1108099/pexels-photo-1108099.jpeg"}}),Q(s.image_url).length>1&&e.jsxs("div",{className:"absolute top-3 right-3 bg-black bg-opacity-70 text-white text-xs px-2 py-1 rounded",children:["ğŸ“¸ ",Q(s.image_url).length,"æš"]}),o&&e.jsx("div",{className:"absolute top-3 left-3",children:e.jsxs("span",{className:"bg-purple-500 text-white px-2 py-1 rounded-full text-xs font-medium flex items-center",children:[e.jsx(x,{className:"w-3 h-3 mr-1"}),"10%OFF"]})}),s.stock_quantity<=5&&e.jsx("div",{className:"absolute top-3 right-3",children:e.jsxs("span",{className:"bg-red-500 text-white px-2 py-1 rounded-full text-xs font-medium",children:["æ®‹ã‚Š",s.stock_quantity,"å€‹"]})})]}),e.jsxs("div",{className:"px-6 pb-6",children:[e.jsxs("div",{className:"mb-2",children:[s.brand&&e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:s.brand}),e.jsx("h3",{className:"text-lg font-semibold line-clamp-2",children:s.name})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:s.description}),e.jsxs("div",{className:"space-y-1 text-xs text-gray-500 mb-3",children:[s.weight&&e.jsxs("p",{children:["å†…å®¹é‡: ",s.weight,"g"]}),s.size&&e.jsxs("p",{children:["ã‚µã‚¤ã‚º: ",s.size]}),s.age_group&&"all"!==s.age_group&&e.jsxs("p",{children:["å¯¾è±¡å¹´é½¢: ","puppy"===s.age_group?"å­çŠ¬":"adult"===s.age_group?"æˆçŠ¬":"ã‚·ãƒ‹ã‚¢çŠ¬"]}),s.dog_size&&"all"!==s.dog_size&&e.jsxs("p",{children:["å¯¾è±¡ã‚µã‚¤ã‚º: ","small"===s.dog_size?"å°å‹çŠ¬":"medium"===s.dog_size?"ä¸­å‹çŠ¬":"å¤§å‹çŠ¬"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-xl font-bold text-green-600",children:["Â¥",l.toLocaleString()]}),o&&e.jsxs("span",{className:"text-sm text-gray-500 line-through",children:["Â¥",i.toLocaleString()]})]}),$&&e.jsxs("p",{className:"text-xs text-purple-600 flex items-center",children:[e.jsx(x,{className:"w-3 h-3 mr-1"}),"ã‚µãƒ–ã‚¹ã‚¯ä¼šå“¡ä¾¡æ ¼"]})]}),e.jsxs("div",{className:"space-y-2",children:[t>0?e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 rounded-lg p-2",children:[e.jsx("button",{onClick:()=>{const e=S.find(e=>e.product_id===s.id);e&&B(e.id,t-1)},className:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center hover:bg-gray-300 transition-colors",children:e.jsx(N,{className:"w-4 h-4"})}),e.jsx("span",{className:"font-medium",children:t}),e.jsx("button",{onClick:()=>{const e=S.find(e=>e.product_id===s.id);e&&B(e.id,t+1)},className:"w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center hover:bg-green-700 transition-colors",children:e.jsx(v,{className:"w-4 h-4"})})]}):e.jsx(r,{onClick:()=>(async(e,s=1)=>{if(d)try{const a=S.find(s=>s.product_id===e);if(a){const{error:e}=await c.from("cart_items").update({quantity:a.quantity+s}).eq("id",a.id);if(e)throw e}else{const{error:a}=await c.from("cart_items").insert([{user_id:d?.id,product_id:e,quantity:s}]);if(a)throw a}await M()}catch(a){}else m("/login")})(s.id),className:"w-full bg-green-600 hover:bg-green-700",disabled:0===s.stock_quantity,children:0===s.stock_quantity?"åœ¨åº«åˆ‡ã‚Œ":e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"w-4 h-4 mr-2"}),"ã‚«ãƒ¼ãƒˆã«è¿½åŠ "]})}),e.jsx(a,{to:`/products/${s.id}`,children:e.jsx(r,{variant:"secondary",className:"w-full",children:"è©³ç´°ã‚’è¦‹ã‚‹"})})]})]})]},s.id)})}),e.jsx(n,{className:"bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(w,{className:"w-6 h-6 text-blue-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"é…é€ã«ã¤ã„ã¦"}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("p",{children:"â€¢ é€æ–™ï¼šå…¨å›½ä¸€å¾‹Â¥690"}),e.jsxs("p",{children:["â€¢ Â¥5,000ä»¥ä¸Šã®ã”æ³¨æ–‡ã§",e.jsx("span",{className:"font-medium",children:"é€æ–™ç„¡æ–™"})]}),e.jsxs("p",{children:["â€¢ ã‚µãƒ–ã‚¹ã‚¯ä¼šå“¡ã¯",e.jsx("span",{className:"font-medium",children:"å¸¸ã«é€æ–™ç„¡æ–™"})]}),e.jsx("p",{children:"â€¢ å¹³æ—¥14æ™‚ã¾ã§ã®ã”æ³¨æ–‡ã§ç¿Œæ—¥ãŠå±Šã‘"}),e.jsx("p",{children:"â€¢ åœŸæ—¥ç¥æ—¥ã‚‚é…é€ã„ãŸã—ã¾ã™"})]})]})]})})]})}export{_ as PetShop};

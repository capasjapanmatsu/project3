import{j as e}from"./motion-CuO0nkIV.js";import{r as s}from"./react-vendor-cniURDpR.js";import{L as a}from"./router-CiK0M--J.js";import{C as t}from"./Card-roTxPFVC.js";import{u as r,s as i}from"./index-C8-ZovGr.js";import{Z as c,b as l,u as n,av as d}from"./ui-basic-DtvVsAeD.js";import"./heavy-features-BIdEME4r.js";import"./supabase-DJQiR77k.js";function m(){const{user:m}=r(),[x,o]=s.useState([]),[h,j]=s.useState(!0);s.useEffect(()=>{m&&b()},[m]);const b=async()=>{if(m)try{j(!0);const{data:e,error:s}=await i.from("dogs").select("\n          id,\n          name,\n          breed,\n          image_url,\n          vaccine_certifications (\n            id,\n            dog_id,\n            rabies_vaccine_image,\n            combo_vaccine_image,\n            rabies_expiry_date,\n            combo_expiry_date,\n            status,\n            created_at\n          )\n        ").eq("owner_id",m.id).order("name");s||o(e||[])}catch(e){}finally{j(!1)}},p=e=>!!e&&new Date(e)>new Date,N=e=>{const s=(e=>{if(!e)return-1;const s=new Date(e),a=new Date,t=s.getTime()-a.getTime();return Math.ceil(t/864e5)})(e);return s<0?"text-red-600":s<=30?"text-yellow-600":"text-green-600"},g=(e,s)=>e.filter(e=>"approved"===e.status).sort((e,s)=>new Date(s.created_at).getTime()-new Date(e.created_at).getTime()).find(e=>"rabies"===s?e.rabies_expiry_date:e.combo_expiry_date);return h?e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"container mx-auto px-4 max-w-2xl",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsxs(a,{to:"/dashboard",className:"flex items-center text-blue-600 hover:text-blue-800 mr-4",children:[e.jsx(c,{className:"w-5 h-5 mr-1"}),"マイページに戻る"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(l,{className:"w-8 h-8 text-emerald-600 mr-3"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"JPパスポート"})]})]}),e.jsx(t,{className:"mb-6",children:e.jsxs("div",{className:"p-4 bg-gradient-to-r from-emerald-50 to-green-50 border border-emerald-200 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-emerald-800 mb-2",children:"🆔 ドッグパークJP公式パスポート"}),e.jsxs("p",{className:"text-emerald-700 text-sm",children:["ワンちゃんのワクチン接種状況を証明する公式デジタルパスポートです。",e.jsx("br",{}),"施設利用時にこの画面を提示してください。"]})]})}),0===x.length?e.jsxs(t,{className:"text-center py-12",children:[e.jsx(l,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"登録されたワンちゃんがいません"}),e.jsx(a,{to:"/dog-registration",className:"text-blue-600 hover:text-blue-800 font-medium",children:"ワンちゃんを登録する"})]}):e.jsx("div",{className:"space-y-6",children:x.map((s,a)=>{const r=g(s.vaccine_certifications,"rabies"),i=g(s.vaccine_certifications,"combo");return e.jsxs(t,{className:"relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:e.jsx("img",{src:"/images/passport-watermark.png",alt:"",className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 opacity-20 scale-75 "+(a%3==0?"rotate-12":a%3==1?"rotate-6":"-rotate-6"),style:{maxWidth:"280px",height:"auto"}})}),e.jsxs("div",{className:"p-6 relative z-10",children:[e.jsxs("div",{className:"flex items-start mb-6",children:[e.jsx("div",{className:"flex-shrink-0 mr-4",children:s.image_url?e.jsx("img",{src:s.image_url,alt:s.name,className:"w-20 h-20 object-cover rounded-lg border-2 border-gray-200"}):e.jsx("div",{className:"w-20 h-20 bg-gray-200 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-gray-400 text-xs",children:"画像なし"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-1",children:s.name}),e.jsx("p",{className:"text-gray-600 mb-2",children:s.breed}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(l,{className:"w-4 h-4 text-emerald-600 mr-1"}),e.jsx("span",{className:"text-sm text-emerald-600 font-medium",children:"公式認証済み"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900 flex items-center",children:"💉 狂犬病ワクチン"}),p(r?.rabies_expiry_date)?e.jsx(n,{className:"w-6 h-6 text-green-500"}):e.jsx(d,{className:"w-6 h-6 text-red-500"})]}),r&&r.rabies_expiry_date?e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{className:`font-medium ${N(r.rabies_expiry_date)}`,children:["有効期限: ",new Date(r.rabies_expiry_date).toLocaleDateString(),p(r.rabies_expiry_date)&&e.jsx("span",{className:"ml-2 text-green-600",children:"✓ 有効"}),!p(r.rabies_expiry_date)&&e.jsx("span",{className:"ml-2 text-red-600",children:"✗ 期限切れ"})]}),e.jsxs("p",{className:"text-gray-600 text-xs",children:["承認日: ",new Date(r.created_at).toLocaleDateString()]})]}):e.jsx("p",{className:"text-red-500 text-sm",children:"ワクチン情報が未登録または未承認です"})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900 flex items-center",children:"💊 混合ワクチン"}),p(i?.combo_expiry_date)?e.jsx(n,{className:"w-6 h-6 text-green-500"}):e.jsx(d,{className:"w-6 h-6 text-red-500"})]}),i&&i.combo_expiry_date?e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{className:`font-medium ${N(i.combo_expiry_date)}`,children:["有効期限: ",new Date(i.combo_expiry_date).toLocaleDateString(),p(i.combo_expiry_date)&&e.jsx("span",{className:"ml-2 text-green-600",children:"✓ 有効"}),!p(i.combo_expiry_date)&&e.jsx("span",{className:"ml-2 text-red-600",children:"✗ 期限切れ"})]}),e.jsxs("p",{className:"text-gray-600 text-xs",children:["承認日: ",new Date(i.created_at).toLocaleDateString()]})]}):e.jsx("p",{className:"text-red-500 text-sm",children:"ワクチン情報が未登録または未承認です"})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"ドッグパークJP公式認証"}),e.jsxs("span",{children:["ID: ",s.id.substring(0,8).toUpperCase()]})]})})]})]},s.id)})}),e.jsxs("div",{className:"mt-8 text-center text-sm text-gray-500",children:[e.jsx("p",{children:"📱 この画面を施設スタッフに提示してください"}),e.jsx("p",{className:"mt-1",children:"ドッグパークJP公式認証済みパスポート"})]})]})})}export{m as JPPassport,m as default};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/css/index-BHS2ZDIu.css"])))=>i.map(i=>d[i]);
import{c as e,_ as s}from"./supabase-B0bqaRGb.js";import{j as a}from"./motion-CuO0nkIV.js";import{r as t}from"./react-vendor-cniURDpR.js";import{B as r}from"./Button-D7FFKgkK.js";import{u as l,C as i}from"./index-qwdJeTcH.js";import{I as c}from"./Input-D7pb8xRh.js";import{S as n}from"./Select-Dd_IZFKg.js";import{a as d}from"./router-Cg6wfOY4.js";import{i as m,aC as o,J as x,N as h,_ as p,b9 as g,ba as j,b as u,y as b,M as f,V as N,j as y,ae as v,aM as w,X as _}from"./ui-basic-icnN6BOT.js";import"./heavy-features-BIdEME4r.js";const k=e("https://onmcivwxtzqajcovptgf.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9ubWNpdnd4dHpxYWpjb3ZwdGdmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkxODk3OTUsImV4cCI6MjA2NDc2NTc5NX0.AqFCz3GQUVeGaG2988LCzsE4aJpeio3xScoxv5T0-OU"),C={pet_hotel:"ペットホテル",pet_salon:"ペットサロン",veterinary:"動物病院",pet_cafe:"ペットカフェ",pet_restaurant:"ペット同伴レストラン",pet_shop:"ペットショップ",pet_accommodation:"ペット同伴宿泊",dog_training:"しつけ教室",pet_friendly_other:"その他ワンちゃん同伴可能施設"};function S(){const{user:e,isAdmin:S}=l(),I=d(),[L,E]=t.useState("applications"),[A,z]=t.useState([]),[J,$]=t.useState([]),[M,O]=t.useState([]),[D,F]=t.useState([]),[T,U]=t.useState(!0),[q,B]=t.useState(""),[G,V]=t.useState(""),[X,Z]=t.useState(null),[Y,H]=t.useState(null),[P,Q]=t.useState(null),[R,W]=t.useState(""),[K,ee]=t.useState("all"),[se,ae]=t.useState("created_at"),[te,re]=t.useState("desc"),[le,ie]=t.useState(null);t.useEffect(()=>{S?de():I("/")},[S,I,e]);const ce=e=>{V(e),B(""),setTimeout(()=>V(""),5e3)},ne=e=>{B(e),V(""),setTimeout(()=>B(""),8e3)},de=async()=>{try{U(!0),B("");const{data:e,error:s}=await k.from("pet_facilities").select("\n          *,\n          profiles!pet_facilities_owner_id_fkey (\n            id,\n            name,\n            email\n          )\n        ").eq("status","pending").order("created_at",{ascending:!1});if(s)throw s;const{data:a,error:t}=await k.from("pet_facilities").select("\n          *,\n          profiles!pet_facilities_owner_id_fkey (\n            id,\n            name,\n            email\n          )\n        ").eq("status","approved").order("created_at",{ascending:!1});if(t)throw t;const r=e=>e&&Array.isArray(e)?e.map(e=>({id:e.id,name:e.name,category_id:e.category_id,address:e.address,phone:e.phone,website:e.website,description:e.description,status:e.status,created_at:e.created_at,owner_id:e.owner_id,owner_name:e.profiles?.name||"不明",owner_email:e.profiles?.email||"不明",category_name:C[e.category_id]||e.category_id})):[],l=r(e||[]),i=r(a||[]),c=[...l,...i].map(e=>e.id),n=await(async e=>{if(0===e.length)return new Map;try{const{data:s,error:a}=await k.from("pet_facility_images").select("*").in("facility_id",e).order("display_order",{ascending:!0});if(a)return new Map;const t=new Map;return s&&s.forEach(e=>{const s=e.facility_id;t.has(s)||t.set(s,[]),t.get(s).push({id:e.id,image_url:e.image_url,image_type:e.image_type,display_order:e.display_order,alt_text:e.alt_text})}),t}catch(s){return new Map}})(c),d=[...l,...i].map(e=>({...e,images:n.get(e.id)||[]}));z(d.filter(e=>"pending"===e.status)),$(d.filter(e=>"approved"===e.status)),O(d.filter(e=>"pending"===e.status)),F(d.filter(e=>"approved"===e.status))}catch(e){const s=e instanceof Error?e.message:"申請データの取得に失敗しました";ne(s)}finally{U(!1)}},me=async(e,a)=>{try{H(e),B("");const{error:t}=await k.from("pet_facilities").update({status:a?"approved":"rejected",updated_at:(new Date).toISOString()}).eq("id",e);if(t)throw t;if(ce(`施設申請を${a?"承認":"拒否"}しました`),Z(null),await de(),a)try{const{data:a}=await k.from("pet_facilities").select("id, owner_id, name").eq("id",e).maybeSingle();if(a?.owner_id){const e=`${window.location.origin}/facilities/${a.id}/edit`,{notifyAppAndLineBoth:t}=await s(async()=>{const{notifyAppAndLineBoth:e}=await import("./notifyAll-DvkW0YpH.js");return{notifyAppAndLineBoth:e}},__vite__mapDeps([0]));await t({userId:a.owner_id,type:"facility_apply_approved",title:"施設が承認されました",message:"画像を登録し、公開設定を公開にしてください。",linkUrl:e})}}catch{}}catch(t){ne(t instanceof Error?t.message:"申請の処理に失敗しました")}finally{H(null)}},oe=async(e,s)=>{if(window.confirm(`「${s}」を完全に削除してもよろしいですか？\n\nこの操作は取り消せません。関連する以下のデータも削除されます：\n• 施設画像\n• 関連通知\n• その他の関連データ`))try{Q(e),B(""),V("");const{data:a,error:t}=await k.rpc("admin_delete_facility",{facility_id_param:e});if(t)throw new Error(`削除処理エラー: ${t.message}`);if(!a)throw new Error("削除処理の応答がありません");if(!a.success)throw new Error(a.error||"削除に失敗しました");ce(a.message||`施設「${s}」を削除しました`),Z(null),await de()}catch(a){const e=a instanceof Error?a.message:"施設の削除に失敗しました";ne(`削除エラー: ${e}`)}finally{Q(null)}};t.useEffect(()=>{ee("all")},[L]);const xe=t.useCallback(e=>{let s=e.filter(e=>{const s=!R||e.name.toLowerCase().includes(R.toLowerCase())||e.address.toLowerCase().includes(R.toLowerCase())||e.owner_name?.toLowerCase().includes(R.toLowerCase())||e.category_name?.toLowerCase().includes(R.toLowerCase()),a="all"===K||e.status===K;return s&&a});return s=s.sort((e,s)=>{let a,t;switch(se){case"name":a=e.name,t=s.name;break;case"category_id":a=e.category_name||"",t=s.category_name||"";break;default:a=e.created_at,t=s.created_at}return"asc"===te?a>t?1:-1:a<t?1:-1}),s},[R,K,se,te]);t.useEffect(()=>{"applications"===L?O(xe(A)):F(xe(J))},[R,K,se,te,A,J,L]);const he=e=>new Date(e).toLocaleDateString("ja-JP",{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"}),pe=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},ge=e=>{switch(e){case"pending":return"承認待ち";case"approved":return"承認済み";case"rejected":return"却下";default:return"不明"}};return S?T?a.jsx("div",{className:"min-h-screen flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"申請データを読み込み中..."})]})}):a.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[q&&a.jsx("div",{className:"mb-6 px-6 py-4 bg-red-50 border-l-4 border-red-400 rounded-lg",children:a.jsxs("div",{className:"flex",children:[a.jsx(m,{className:"h-5 w-5 text-red-400 mr-2"}),a.jsx("p",{className:"text-sm text-red-700",children:q})]})}),G&&a.jsx("div",{className:"mb-6 px-6 py-4 bg-green-50 border-l-4 border-green-400 rounded-lg",children:a.jsxs("div",{className:"flex",children:[a.jsx(o,{className:"h-5 w-5 text-green-400 mr-2"}),a.jsx("p",{className:"text-sm text-green-700",children:G})]})}),a.jsx("div",{className:"bg-white shadow rounded-lg mb-8",children:a.jsx("div",{className:"px-6",children:a.jsxs("nav",{className:"flex space-x-8","aria-label":"Tabs",children:[a.jsxs("button",{onClick:()=>E("applications"),className:"whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm "+("applications"===L?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[a.jsx(x,{className:"w-5 h-5 inline mr-2"}),"施設申請",a.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:A.length})]}),a.jsxs("button",{onClick:()=>E("facilities"),className:"whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm "+("facilities"===L?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[a.jsx(h,{className:"w-5 h-5 inline mr-2"}),"施設一覧",a.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:J.length})]})]})})}),a.jsxs("div",{className:"space-y-6",children:[a.jsx(i,{className:"p-6",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsxs("div",{className:"relative",children:[a.jsx(p,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(c,{label:"",placeholder:"施設名、住所、オーナー名で検索...",value:R,onChange:e=>W(e.target.value),className:"pl-10"})]}),a.jsx(n,{label:"",options:[{value:"all",label:"全ステータス"},..."applications"===L?[{value:"pending",label:"承認待ち"}]:[{value:"approved",label:"承認済み"}]],value:K,onChange:e=>ee(e.target.value)}),a.jsx(n,{label:"",options:[{value:"created_at",label:"作成日時"},{value:"name",label:"施設名"},{value:"category_id",label:"カテゴリ"}],value:se,onChange:e=>ae(e.target.value)}),a.jsxs(r,{variant:"secondary",onClick:()=>re("asc"===te?"desc":"asc"),className:"flex items-center justify-center",children:["asc"===te?a.jsx(g,{className:"w-4 h-4 mr-2"}):a.jsx(j,{className:"w-4 h-4 mr-2"}),"asc"===te?"昇順":"降順"]})]})}),"applications"===L&&a.jsx(a.Fragment,{children:0===M.length?a.jsxs(i,{className:"text-center py-12",children:[a.jsx(x,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:R||"all"!==K?"条件に一致する申請が見つかりません":"承認待ちの申請がありません"})]}):a.jsx("div",{className:"grid grid-cols-1 gap-6",children:M.map(e=>a.jsx(i,{className:"p-6",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),a.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${pe(e.status)}`,children:ge(e.status)})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-4",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"申請者情報"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(u,{className:"w-4 h-4 mr-2"}),e.owner_name]}),a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(b,{className:"w-4 h-4 mr-2"}),"申請日: ",he(e.created_at)]})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"施設情報"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(h,{className:"w-4 h-4 mr-2"}),e.category_name]}),a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(f,{className:"w-4 h-4 mr-2"}),e.address]}),e.phone&&a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(N,{className:"w-4 h-4 mr-2"}),e.phone]})]})]})]}),e.description&&a.jsxs("div",{className:"mb-4",children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"施設説明"}),a.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:e.description})]})]}),a.jsxs("div",{className:"flex flex-col space-y-2 ml-4",children:[a.jsxs(r,{size:"sm",variant:"secondary",onClick:()=>Z(e),className:"flex items-center",children:[a.jsx(y,{className:"w-4 h-4 mr-2"}),"詳細確認"]}),a.jsxs(r,{size:"sm",variant:"secondary",onClick:()=>oe(e.id,e.name),disabled:P===e.id,className:"flex items-center bg-red-100 hover:bg-red-200 text-red-800 border-red-200",children:[a.jsx(v,{className:"w-4 h-4 mr-2"}),P===e.id?"削除中...":"削除"]})]})]})},e.id))})}),"facilities"===L&&a.jsx(a.Fragment,{children:0===D.length?a.jsxs(i,{className:"text-center py-12",children:[a.jsx(h,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:R||"all"!==K?"条件に一致する施設が見つかりません":"承認済みの施設がありません"})]}):a.jsx("div",{className:"grid grid-cols-1 gap-6",children:D.map(e=>a.jsx(i,{className:"p-6",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),a.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${pe(e.status)}`,children:ge(e.status)})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[a.jsx(h,{className:"w-4 h-4 mr-1"}),e.category_name]}),a.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[a.jsx(f,{className:"w-4 h-4 mr-1"}),e.address]}),e.phone&&a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(N,{className:"w-4 h-4 mr-1"}),e.phone]})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[a.jsx(u,{className:"w-4 h-4 mr-1"}),e.owner_name]}),a.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[a.jsx(b,{className:"w-4 h-4 mr-1"}),he(e.created_at)]}),e.website&&a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(w,{className:"w-4 h-4 mr-1"}),a.jsx("a",{href:e.website,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline",children:"ウェブサイト"})]})]})]}),e.description&&a.jsx("div",{className:"mb-4",children:a.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:e.description})})]}),a.jsxs("div",{className:"flex flex-col space-y-2 ml-4",children:[a.jsxs(r,{size:"sm",variant:"secondary",onClick:()=>Z(e),className:"flex items-center",children:[a.jsx(y,{className:"w-4 h-4 mr-2"}),"詳細確認"]}),a.jsxs(r,{size:"sm",variant:"secondary",onClick:()=>oe(e.id,e.name),disabled:P===e.id,className:"flex items-center bg-red-100 hover:bg-red-200 text-red-800 border-red-200",children:[a.jsx(v,{className:"w-4 h-4 mr-2"}),P===e.id?"削除中...":"削除"]})]})]})},e.id))})})]}),X&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white rounded-lg max-w-4xl max-h-[90vh] w-full overflow-y-auto",children:[a.jsxs("div",{className:"sticky top-0 bg-white border-b p-6 flex justify-between items-center",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:X.name}),a.jsx("button",{onClick:()=>Z(null),className:"p-2 hover:bg-gray-100 rounded-full",children:a.jsx(_,{className:"w-6 h-6 text-gray-500"})})]}),a.jsxs("div",{className:"p-6 space-y-6",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"基本情報"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"施設名"}),a.jsx("p",{className:"text-gray-900",children:X.name})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"カテゴリ"}),a.jsx("p",{className:"text-gray-900",children:X.category_name})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"住所"}),a.jsx("p",{className:"text-gray-900",children:X.address})]}),X.phone&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"電話番号"}),a.jsx("p",{className:"text-gray-900",children:X.phone})]}),X.website&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ウェブサイト"}),a.jsx("a",{href:X.website,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline",children:X.website})]})]}),X.description&&a.jsxs("div",{className:"mt-4",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"施設の説明"}),a.jsx("p",{className:"text-gray-900 whitespace-pre-wrap",children:X.description})]})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"申請者情報"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"申請者名"}),a.jsx("p",{className:"text-gray-900",children:X.owner_name||"Unknown"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"メールアドレス"}),a.jsx("p",{className:"text-gray-900",children:X.owner_email||"Unknown"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"申請日時"}),a.jsx("p",{className:"text-gray-900",children:he(X.created_at)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ステータス"}),a.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${pe(X.status)}`,children:ge(X.status)})]})]})]}),X.images&&X.images.length>0&&a.jsxs("div",{className:"mt-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"施設画像"}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:X.images.map((e,s)=>a.jsxs("div",{className:"relative group cursor-pointer",onClick:()=>ie(e.image_url),children:[a.jsx("img",{src:e.image_url,alt:e.alt_text||"施設画像",className:"w-full h-32 object-cover rounded-md"}),a.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:a.jsx(y,{className:"w-8 h-8 text-white"})})]},e.id))})]}),a.jsxs("div",{className:"flex space-x-4 pt-6 border-t",children:[a.jsxs(r,{onClick:()=>oe(X.id,X.name),disabled:P===X.id,variant:"secondary",className:"bg-red-100 hover:bg-red-200 text-red-800 border-red-200",children:[a.jsx(v,{className:"w-4 h-4 mr-2"}),P===X.id?"削除中...":"削除"]}),"pending"===X.status&&a.jsxs(a.Fragment,{children:[a.jsxs(r,{onClick:()=>me(X.id,!1),disabled:Y===X.id,variant:"secondary",className:"bg-orange-100 hover:bg-orange-200 text-orange-800 border-orange-200",children:[a.jsx(_,{className:"w-4 h-4 mr-2"}),Y===X.id?"処理中...":"拒否"]}),a.jsxs(r,{onClick:()=>me(X.id,!0),disabled:Y===X.id,className:"bg-green-600 hover:bg-green-700",children:[a.jsx(o,{className:"w-4 h-4 mr-2"}),Y===X.id?"処理中...":"承認"]})]})]})]})]})}),le&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4",children:a.jsx("div",{className:"max-w-4xl max-h-[90vh] w-full overflow-y-auto",children:a.jsxs("div",{className:"relative",children:[a.jsx("img",{src:le,alt:"拡大画像",className:"w-full h-auto"}),a.jsx("button",{onClick:()=>ie(null),className:"absolute top-4 right-4 p-2 bg-white rounded-full hover:bg-gray-200",children:a.jsx(_,{className:"w-6 h-6 text-gray-700"})})]})})})]})}):a.jsx("div",{className:"max-w-4xl mx-auto p-4",children:a.jsx(i,{className:"p-6",children:a.jsxs("div",{className:"flex items-center justify-center",children:[a.jsx(m,{className:"w-12 h-12 text-red-500 mr-4"}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold text-red-700",children:"アクセス権限がありません"}),a.jsx("p",{className:"text-red-600",children:"このページは管理者のみアクセス可能です。"})]})]})})})}export{S as default,k as supabase};

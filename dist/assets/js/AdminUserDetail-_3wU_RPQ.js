import{j as e}from"./motion-CuO0nkIV.js";import{r as s}from"./react-vendor-cniURDpR.js";import{u as a,s as t,C as l}from"./index-hxb5tPha.js";import{B as r}from"./Button-6ascT97E.js";import{a as i,d as n}from"./router-Cg6wfOY4.js";import{af as c,O as d,a4 as m,aE as x,b as o,h,V as g,M as j,y as p,ac as u,ao as N,f as y}from"./ui-basic-icnN6BOT.js";import"./heavy-features-BIdEME4r.js";import"./supabase-B0bqaRGb.js";function f(){const{isAdmin:f}=a(),v=i(),{userId:b}=n(),[w,_]=s.useState(null),[k,S]=s.useState(!0),[P,D]=s.useState("");s.useEffect(()=>{f?b&&L(b):v("/")},[f,v,b]);const L=async e=>{try{S(!0),D("");const{data:s,error:a}=await t.from("profiles").select("*").eq("id",e).single();if(a)throw new Error("ユーザー情報の取得に失敗しました");const{data:l,error:r}=await t.from("dogs").select("id, name, breed, age, gender, image_url").eq("owner_id",e),{data:i,error:n}=await t.from("reservations").select("\n          id,\n          date,\n          time_slot,\n          total_amount,\n          status,\n          dog_parks (\n            name\n          )\n        ").eq("user_id",e).order("date",{ascending:!1}).limit(20),c=(i||[]).reduce((e,s)=>e+(s.total_amount||0),0),d=s.email||s.line_email||s.contact_email||`未設定（ID: ${e.slice(0,8)}）`,[{data:m},{data:x}]=await Promise.all([t.from("dog_parks").select("id, name, status").eq("owner_id",e),t.from("pet_facilities").select("id, name, status").eq("owner_id",e)]),o={id:s.id,name:s.name||"Unknown",email:d,phone:s.phone_number||"",postal_code:s.postal_code||"",address:s.address||"",user_type:s.user_type||"user",created_at:s.created_at,is_active:!0,dogs:l||[],reservations:(i||[]).map(e=>({id:e.id,park_name:e.dog_parks?.name||"Unknown Park",date:e.date,time_slot:e.time_slot,total_amount:e.total_amount||0,status:e.status})),subscription_status:"inactive",total_spent:c,last_activity:i?.[0]?.date||""};o.managedParks=m||[],o.managedFacilities=x||[],_(o)}catch(s){D(s instanceof Error?s.message:"ユーザー詳細の取得に失敗しました")}finally{S(!1)}};return k?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):P?e.jsxs("div",{className:"max-w-4xl mx-auto p-4",children:[e.jsx("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4",children:P}),e.jsxs(r,{onClick:()=>v("/admin/users"),className:"mt-4",variant:"secondary",children:[e.jsx(c,{className:"w-4 h-4 mr-2"}),"ユーザー一覧に戻る"]})]}):w?e.jsxs("div",{className:"max-w-4xl mx-auto p-4 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(r,{onClick:()=>v("/admin/users"),variant:"secondary",size:"sm",children:[e.jsx(c,{className:"w-4 h-4 mr-2"}),"ユーザー一覧に戻る"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:["active"===w.subscription_status&&e.jsxs("span",{className:"bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-sm font-medium flex items-center",children:[e.jsx(d,{className:"w-4 h-4 mr-1"}),"サブスク会員"]}),w.is_active?e.jsxs("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded-full text-sm font-medium flex items-center",children:[e.jsx(m,{className:"w-4 h-4 mr-1"}),"アクティブ"]}):e.jsxs("span",{className:"bg-red-100 text-red-800 px-2 py-1 rounded-full text-sm font-medium flex items-center",children:[e.jsx(x,{className:"w-4 h-4 mr-1"}),"非アクティブ"]})]})]}),e.jsxs(l,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(o,{className:"w-8 h-8 text-blue-600 mr-3"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:w.name})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(h,{className:"w-5 h-5 mr-3 text-gray-400"}),e.jsx("span",{children:w.email})]}),w.phone&&e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(g,{className:"w-5 h-5 mr-3 text-gray-400"}),e.jsx("span",{children:w.phone})]}),e.jsx("div",{children:e.jsx("button",{className:"text-blue-600 hover:text-blue-800 underline text-sm",onClick:()=>{sessionStorage.setItem("communityActiveTab","messages"),sessionStorage.setItem("communityOpenPartnerId",w.id),v("/community")},children:"チャットを開始"})}),w.address&&e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(j,{className:"w-5 h-5 mr-3 text-gray-400"}),e.jsxs("span",{children:[w.postal_code," ",w.address]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(p,{className:"w-5 h-5 mr-3 text-gray-400"}),e.jsxs("span",{children:["登録日: ",new Date(w.created_at).toLocaleDateString("ja-JP")]})]}),w.last_activity&&e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(u,{className:"w-5 h-5 mr-3 text-gray-400"}),e.jsxs("span",{children:["最終活動: ",new Date(w.last_activity).toLocaleDateString("ja-JP")]})]}),e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(N,{className:"w-5 h-5 mr-3 text-gray-400"}),e.jsxs("span",{children:["総支払額: ¥",w.total_spent.toLocaleString()]})]})]})]})]}),e.jsxs(l,{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"管理中のコンテンツ"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-700 mb-2",children:"ドッグラン"}),0===(w.managedParks||[]).length?e.jsx("p",{className:"text-gray-500 text-sm",children:"管理中のドッグランはありません"}):e.jsx("ul",{className:"space-y-2",children:w.managedParks.map(s=>e.jsxs("li",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsx("span",{className:"text-sm text-gray-800",children:s.name}),e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs "+("approved"===s.status?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:s.status})]},s.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-700 mb-2",children:"その他施設"}),0===(w.managedFacilities||[]).length?e.jsx("p",{className:"text-gray-500 text-sm",children:"管理中の施設はありません"}):e.jsx("ul",{className:"space-y-2",children:w.managedFacilities.map(s=>e.jsxs("li",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsx("span",{className:"text-sm text-gray-800",children:s.name}),e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs "+("approved"===s.status?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:s.status})]},s.id))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(l,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"登録犬数"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:w.dogs.length})]}),e.jsx(y,{className:"w-8 h-8 text-blue-600"})]})}),e.jsx(l,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"予約数"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:w.reservations.length})]}),e.jsx(p,{className:"w-8 h-8 text-green-600"})]})}),e.jsx(l,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"総支払額"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:["¥",w.total_spent.toLocaleString()]})]}),e.jsx(N,{className:"w-8 h-8 text-purple-600"})]})})]}),e.jsxs(l,{className:"p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[e.jsx(y,{className:"w-5 h-5 mr-2"}),"登録犬一覧 (",w.dogs.length,"匹)"]}),0===w.dogs.length?e.jsx("p",{className:"text-gray-500",children:"登録された犬はありません"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:w.dogs.map(s=>e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[s.image_url?e.jsx("img",{src:s.image_url,alt:s.name,className:"w-12 h-12 rounded-full object-cover"}):e.jsx("div",{className:"w-12 h-12 bg-gray-300 rounded-full flex items-center justify-center",children:e.jsx(y,{className:"w-6 h-6 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-800",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.breed," • ",s.gender]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.age,"歳"]})]})]})},s.id))})]}),e.jsxs(l,{className:"p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[e.jsx(p,{className:"w-5 h-5 mr-2"}),"予約履歴 (",w.reservations.length,"件)"]}),0===w.reservations.length?e.jsx("p",{className:"text-gray-500",children:"予約履歴はありません"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"ドッグパーク"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"予約日"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"時間"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"金額"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"ステータス"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:w.reservations.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:s.park_name}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:new Date(s.date).toLocaleDateString("ja-JP")}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:s.time_slot}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-900",children:["¥",s.total_amount.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("confirmed"===s.status?"bg-green-100 text-green-800":"cancelled"===s.status?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:"confirmed"===s.status?"確定":"cancelled"===s.status?"キャンセル":"保留中"})})]},s.id))})]})})]})]}):e.jsx("div",{className:"max-w-4xl mx-auto p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600",children:"ユーザーが見つかりません"}),e.jsxs(r,{onClick:()=>v("/admin/users"),className:"mt-4",variant:"secondary",children:[e.jsx(c,{className:"w-4 h-4 mr-2"}),"ユーザー一覧に戻る"]})]})})}export{f as AdminUserDetail};

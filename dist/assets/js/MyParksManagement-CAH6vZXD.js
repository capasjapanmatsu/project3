import{j as e}from"./motion-CuO0nkIV.js";import{r as s}from"./react-vendor-cniURDpR.js";import{a,L as t}from"./router-Cg6wfOY4.js";import{B as l}from"./Button-D7FFKgkK.js";import{u as r,S as i,C as n,s as c}from"./index-qwdJeTcH.js";import{af as d,N as m,M as x,a1 as o,J as g,ad as h,j as b,i as j,e as u,ac as p,b2 as f,a4 as N}from"./ui-basic-icnN6BOT.js";import"./supabase-B0bqaRGb.js";import"./heavy-features-BIdEME4r.js";function v(){const{user:v}=r(),w=a(),[y,_]=s.useState([]),[k,S]=s.useState({}),[C,$]=s.useState(!0),[I,q]=s.useState(!1),[z,B]=s.useState(""),[D,F]=s.useState(!1);s.useEffect(()=>{if(!v)return;(async()=>{try{$(!0);const{data:e,error:s}=await c.from("dog_parks").select("\n            *,\n            profiles!dog_parks_owner_id_fkey(display_name, name)\n          ").eq("owner_id",v?.id).order("created_at",{ascending:!1});if(s)return;_(e||[])}catch(e){}finally{$(!1)}})()},[v]);const J=s=>{const a={approved:{bg:"bg-green-100",text:"text-green-800",label:"公開中",icon:N},pending:{bg:"bg-yellow-100",text:"text-yellow-800",label:"第一審査中",icon:p},first_stage_passed:{bg:"bg-blue-100",text:"text-blue-800",label:"第二審査申請可能",icon:g},second_stage_waiting:{bg:"bg-orange-100",text:"text-orange-800",label:"第二審査申請準備中",icon:f},second_stage_review:{bg:"bg-purple-100",text:"text-purple-800",label:"第二審査中",icon:p},smart_lock_testing:{bg:"bg-indigo-100",text:"text-indigo-800",label:"スマートロック実証検査中",icon:u},rejected:{bg:"bg-red-100",text:"text-red-800",label:"却下",icon:j}},t=a[s]||a.pending,l=t.icon;return e.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-medium flex items-center space-x-1 ${t.bg} ${t.text}`,children:[e.jsx(l,{className:"w-4 h-4"}),e.jsx("span",{children:t.label})]})};return C?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"})}):e.jsxs(e.Fragment,{children:[e.jsx(i,{title:"管理中ドッグラン一覧",description:"あなたが管理するドッグランの一覧と詳細管理ページです。"}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-4",children:e.jsx(t,{to:"/park-operation-guidelines",className:"inline-flex items-center text-blue-700 hover:text-blue-900 font-medium underline",children:"ドッグラン運営の注意事項（必ずお読みください）"})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"flex items-center mb-4",children:e.jsxs(l,{variant:"secondary",size:"sm",onClick:()=>w("/dashboard"),className:"mr-4",children:[e.jsx(d,{className:"w-4 h-4 mr-1"}),"マイページに戻る"]})}),e.jsx("div",{children:e.jsxs("h1",{className:"text-3xl font-bold flex items-center",children:[e.jsx(m,{className:"w-8 h-8 text-green-600 mr-3"}),"管理中ドッグラン一覧"]})})]}),0===y.length?e.jsxs(n,{className:"p-12 text-center",children:[e.jsx(m,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"管理中のドッグランがありません"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"まずはドッグランを登録して、運営を開始しましょう。"}),e.jsx(t,{to:"/park-registration",children:e.jsxs(l,{className:"bg-green-600 hover:bg-green-700",children:[e.jsx(m,{className:"w-4 h-4 mr-2"}),"ドッグラン登録を始める"]})})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:y.map(s=>e.jsx(n,{className:"hover:shadow-lg transition-all duration-200",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:s.name}),e.jsxs("div",{className:"flex items-center text-gray-600 mb-3",children:[e.jsx(x,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-sm",children:s.address})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(o,{className:"w-4 h-4 text-yellow-400 fill-current"}),e.jsx("span",{className:"text-sm font-medium",children:s.average_rating?.toFixed(1)||"0.0"})]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[s.review_count||0,"件のレビュー"]})]})]}),e.jsx("div",{className:"ml-4",children:J(s.status)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"ステータス"}),e.jsx("div",{children:J(s.status||"pending")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"作成日"}),e.jsx("div",{className:"font-semibold",children:new Date(s.created_at).toLocaleDateString("ja-JP")})]})]}),e.jsxs("div",{className:"flex gap-3",children:["second_stage_waiting"===s.status?e.jsx(t,{to:`/parks/${s.id}/second-stage`,className:"flex-1",children:e.jsxs(l,{className:"w-full bg-orange-600 hover:bg-orange-700",children:[e.jsx(g,{className:"w-4 h-4 mr-2"}),"ドッグランの運営準備が出来たらこちらから申請をしてください。"]})}):"pending"===s.status?e.jsxs(l,{disabled:!0,className:"flex-1 bg-gray-400 cursor-not-allowed",children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),"審査中（編集不可）"]}):e.jsx(t,{to:`/parks/${s.id}/manage`,className:"flex-1",children:e.jsxs(l,{className:"w-full bg-blue-600 hover:bg-blue-700",children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),"管理・修正"]})}),"approved"===s.status&&e.jsx(t,{to:`/parks/${s.id}`,children:e.jsxs(l,{variant:"secondary",className:"px-4",children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"公開ページ"]})})]})]})},s.id))}),e.jsxs("div",{className:"mt-8 space-y-6",children:[e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-blue-800",children:"不明な点がありましたらお気軽にお問合せください。"}),e.jsx(l,{className:"mt-3 w-full bg-blue-600 hover:bg-blue-700",onClick:()=>q(!0),children:"管理者に問い合わせ"})]}),e.jsx("div",{children:e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-green-800 mb-2",children:"🌟 新規ドッグラン募集中！"}),e.jsx("p",{className:"text-green-700 text-sm",children:"あなたの土地を活用してドッグラン事業を始めませんか？初期費用・運営サポート充実！"}),e.jsx(t,{to:"/park-registration",className:"block mt-3",children:e.jsxs(l,{className:"w-full bg-green-600 hover:bg-green-700 py-3 font-semibold",children:[e.jsx(m,{className:"w-5 h-5 mr-2"}),"新規ドッグラン募集詳細"]})})]})})]})]}),I&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-lg p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"管理者に問い合わせ"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"お問い合わせ内容をご記入ください。送信すると同時にメッセージスレッドが作成されます。"}),e.jsx("textarea",{className:"w-full border rounded-md p-3 h-32 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"お問い合わせ内容",value:z,onChange:e=>B(e.target.value)}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx(l,{variant:"secondary",onClick:()=>q(!1),children:"キャンセル"}),e.jsx(l,{className:"bg-blue-600 hover:bg-blue-700",disabled:D||!z.trim(),onClick:async()=>{if(v){F(!0);try{const{data:e}=await c.from("profiles").select("id").eq("user_type","admin").limit(1).single(),s=e?.id;if(!s)return alert("管理者に送信できませんでした"),void F(!1);await c.from("messages").insert({sender_id:v.id,receiver_id:s,content:`（管理中ドッグラン一覧からの問い合わせ）\n${z.trim()}`}),sessionStorage.setItem("communityActiveTab","messages"),sessionStorage.setItem("communityOpenPartnerId",s),w("/community")}catch(e){alert("送信に失敗しました")}finally{F(!1),q(!1),B("")}}else w("/liff/login")},children:D?"送信中...":"送信してメッセージを開く"})]})]})})]})}export{v as MyParksManagement};

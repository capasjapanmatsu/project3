import{j as e}from"./motion-CuO0nkIV.js";import{r as s}from"./react-vendor-cniURDpR.js";import{d as a,a as t,L as l}from"./router-Cg6wfOY4.js";import{B as r}from"./Button-CJFAG6V0.js";import{u as i,s as n,C as c,S as d}from"./index-CVZFmpsT.js";import{I as o}from"./ImageCropper-BqfqFQ-L.js";import{C as m}from"./CouponDisplay-0Bwc_BFO.js";import{af as x,N as h,M as g,V as u,a7 as j,ac as p,q as f,a1 as b,G as y,y as N,U as v,X as w,ag as _,ah as k}from"./ui-basic-CaMd9YQ-.js";import"./supabase-B0bqaRGb.js";import"./heavy-features-BIdEME4r.js";function S(){const{id:S}=a(),{user:$}=i(),q=t(),[D,z]=s.useState(null),[I,O]=s.useState(!0),[E,F]=s.useState(null),[U,L]=s.useState(!1),[P,T]=s.useState(0),[J,M]=s.useState([]),[R,B]=s.useState(!1),[G,A]=s.useState(null),[H,V]=s.useState(null),[W,K]=s.useState([]),[Q,X]=s.useState(null),[Y,Z]=s.useState(!1),[ee,se]=s.useState({rating:5,comment:"",visit_date:(new Date).toISOString().split("T")[0],image_url:""}),[ae,te]=s.useState([]),[le,re]=s.useState(""),[ie,ne]=s.useState(!1),[ce,de]=s.useState(!1),[oe,me]=s.useState(null),[xe,he]=s.useState(!1),[ge,ue]=s.useState(null),[je,pe]=s.useState(null),[fe,be]=s.useState(null);s.useEffect(()=>{S?ye():q("/dog-park-list")},[S,q]);const ye=async()=>{try{O(!0),F(null);const e=await n.from("pet_facilities").select("*").eq("id",S).eq("status","approved").single(),s=await n.from("pet_facility_images").select("id, facility_id, image_url, image_type, display_order, created_at, alt_text").eq("facility_id",S).order("display_order",{ascending:!0}).then(e=>e).catch(()=>({data:[],error:null})),a=(new Date).toISOString(),t=await n.from("facility_coupons").select("*").eq("facility_id",S).eq("is_active",!0).lte("start_date",a).gte("end_date",a).order("created_at",{ascending:!1}).then(e=>e).catch(()=>({data:[],error:null}));if(e.error)throw e.error;if(!e.data)throw new Error("æ–½è¨­ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");const l={...e.data,images:s.data||[],coupons:t.data||[]};z(l);const r=await n.from("facility_reviews").select("\n          id,\n          facility_id,\n          user_id,\n          dog_name,\n          rating,\n          comment,\n          visit_date,\n          created_at,\n          image_url\n        ").eq("facility_id",S).order("created_at",{ascending:!1}).then(e=>e).catch(()=>({data:[],error:null})),i=await n.from("facility_reviews").select("rating").eq("facility_id",S).then(e=>e).catch(()=>({data:[],error:null})),c=$?.id,d=c?await n.from("dogs").select("id, name, gender").eq("owner_id",c):{data:[]};if(r.data?K(r.data):K([]),i.data&&i.data.length>0){const e=i.data.map(e=>e.rating),s=e.reduce((e,s)=>e+s,0)/e.length;X({facility_id:S,average_rating:s,review_count:e.length,rating_distribution:{5:e.filter(e=>5===e).length,4:e.filter(e=>4===e).length,3:e.filter(e=>3===e).length,2:e.filter(e=>2===e).length,1:e.filter(e=>1===e).length}})}if(d.data&&te(d.data),c&&t.data&&t.data.length>0){const e=t.data.map(e=>e.id),{data:s}=await n.from("user_coupons").select("*").eq("user_id",c).in("coupon_id",e);M(s||[])}}catch(e){F(e instanceof Error?e.message:"æ–½è¨­æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{O(!1)}},Ne=async e=>{if($){V(e);try{const{data:s,error:a}=await n.rpc("obtain_coupon",{p_coupon_id:e,p_user_id:$.id});if(a)throw new Error(`ã‚¯ãƒ¼ãƒãƒ³å–å¾—ã‚¨ãƒ©ãƒ¼: ${a.message}`);if("success"===s){await(async()=>{if($)try{const e=(new Date).toISOString(),{data:s}=await n.from("facility_coupons").select("id").eq("facility_id",S).eq("is_active",!0).lte("start_date",e).gte("end_date",e),a=(s||[]).map(e=>e.id);if(0===a.length)return void M([]);const{data:t,error:l}=await n.from("user_coupons").select("*").eq("user_id",$?.id).in("coupon_id",a);l||M(t||[])}catch(a){}})();const s=J.find(s=>s.coupon_id===e);s&&(A(s),B(!0))}else{F({coupon_not_found:"ã‚¯ãƒ¼ãƒãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“",coupon_expired:"ã‚¯ãƒ¼ãƒãƒ³ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¦ã„ã¾ã™",coupon_inactive:"ã‚¯ãƒ¼ãƒãƒ³ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“",already_obtained:"ã™ã§ã«å–å¾—æ¸ˆã¿ã®ã‚¯ãƒ¼ãƒãƒ³ã§ã™"}[s]||`ä¸æ˜ãªã‚¨ãƒ©ãƒ¼: ${s}`)}}catch(s){const e=s instanceof Error?s.message:"ã‚¯ãƒ¼ãƒãƒ³ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ";F(e)}finally{V(null)}}else q("/liff/login")},ve=()=>{if(!D?.weekly_closed_days)return null;try{const e=JSON.parse(D.weekly_closed_days);return!e[(new Date).getDay()]}catch{return null}},we=({rating:s,size:a="sm"})=>{const t={sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6"};return e.jsx("div",{className:"flex items-center space-x-1",children:[1,2,3,4,5].map(l=>e.jsx(b,{className:`${t[a]} ${l<=s?"text-yellow-400 fill-current":"text-gray-300"}`},l))})};return I?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-500 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"æ–½è¨­æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­..."})]})}):E?e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsx(c,{className:"max-w-md w-full",children:e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"âš ï¸"}),e.jsx("h1",{className:"text-xl font-bold text-gray-900 mb-2",children:"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ"}),e.jsx("p",{className:"text-gray-600 mb-4",children:E}),e.jsxs(r,{onClick:()=>q("/parks"),variant:"outline",children:[e.jsx(x,{className:"mr-2 h-4 w-4"}),"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ãƒ»æ–½è¨­ä¸€è¦§ã«æˆ»ã‚‹"]})]})})}):D?e.jsxs(e.Fragment,{children:[e.jsx(d,{title:`${D.name} - ãƒšãƒƒãƒˆé–¢é€£æ–½è¨­`,description:D.description||`${D.category_info?.name||""}ã®${D.name}ã®è©³ç´°æƒ…å ±ã‚’ã”è¦§ãã ã•ã„ã€‚`}),e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"relative bg-white",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex items-center justify-between h-16",children:e.jsxs("button",{onClick:()=>{window.history.length>1?window.history.back():q("/parks")},className:"flex items-center text-gray-600 hover:text-blue-600 transition-colors",children:[e.jsx(x,{className:"w-5 h-5 mr-2"}),"æˆ»ã‚‹"]})})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[D.images&&D.images.length>0&&e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-4 scrollbar-hide",style:{scrollSnapType:"x mandatory"},children:D.images.map((s,a)=>e.jsx("div",{className:"flex-shrink-0 w-[calc(50%-8px)] aspect-[4/3] rounded-2xl overflow-hidden shadow-lg cursor-pointer hover:shadow-xl transition-shadow",style:{scrollSnapAlign:"start"},onClick:()=>{T(a),L(!0)},children:e.jsx("img",{src:s.image_url,alt:s.alt_text||`${D.name}ã®ç”»åƒ${a+1}`,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-300",onError:e=>{e.target.style.display="none"}})},a))}),e.jsx("div",{className:"flex justify-center mt-4 space-x-2",children:D.images.map((s,a)=>e.jsx("button",{className:"w-2 h-2 rounded-full transition-colors "+(a===P?"bg-blue-500":"bg-gray-300 hover:bg-gray-400"),onClick:()=>{T(a),L(!0)}},a))})]})}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 items-start",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"inline-flex items-center px-4 py-2 rounded-full text-sm font-medium bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-lg",children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),{pet_hotel:"ãƒšãƒƒãƒˆãƒ›ãƒ†ãƒ«",pet_salon:"ãƒšãƒƒãƒˆã‚µãƒ­ãƒ³",veterinary:"å‹•ç‰©ç—…é™¢",pet_cafe:"ãƒšãƒƒãƒˆã‚«ãƒ•ã‚§",pet_restaurant:"ãƒšãƒƒãƒˆåŒä¼´ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³",pet_shop:"ãƒšãƒƒãƒˆã‚·ãƒ§ãƒƒãƒ—",pet_accommodation:"ãƒšãƒƒãƒˆåŒä¼´å®¿æ³Š",dog_training:"ã—ã¤ã‘æ•™å®¤",pet_friendly_other:"ãã®ä»–ãƒ¯ãƒ³ã¡ã‚ƒã‚“åŒä¼´å¯èƒ½æ–½è¨­"}[D.category_info?.name||""]||D.category_info?.name||"ãƒšãƒƒãƒˆé–¢é€£æ–½è¨­"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h1",{className:"text-4xl lg:text-5xl font-bold text-gray-900 leading-tight",children:D.name}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start text-gray-600",children:[e.jsx(g,{className:"w-5 h-5 mr-2 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-lg",children:D.address})]}),e.jsx(r,{variant:"secondary",size:"sm",className:"w-full sm:w-auto",onClick:()=>{const e=encodeURIComponent(D.address);window.open(`https://maps.google.com/maps?q=${e}`,"_blank")},children:"Google Mapsã§é–‹ã"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[D.phone&&e.jsxs("div",{className:"flex items-center bg-white p-4 rounded-xl border border-gray-200 shadow-sm",children:[e.jsx(u,{className:"w-5 h-5 text-blue-500 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"é›»è©±ç•ªå·"}),e.jsx("p",{className:"font-medium text-gray-900",children:D.phone})]})]}),D.website&&e.jsxs("a",{href:D.website,target:"_blank",rel:"noopener noreferrer",className:"flex items-center bg-white p-4 rounded-xl border border-gray-200 shadow-sm hover:border-blue-300 hover:shadow-md transition-all group",children:[e.jsx(j,{className:"w-5 h-5 text-blue-500 mr-3 group-hover:text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆ"}),e.jsx("p",{className:"font-medium text-gray-900 group-hover:text-blue-600",children:"å…¬å¼ã‚µã‚¤ãƒˆã‚’è¦‹ã‚‹"})]})]})]}),D.description&&e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"æ–½è¨­ã«ã¤ã„ã¦"}),e.jsx("p",{className:"text-gray-700 leading-relaxed whitespace-pre-wrap",children:D.description})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(p,{className:"w-5 h-5 text-blue-500 mr-2"}),"å–¶æ¥­æ™‚é–“ãƒ»å®šä¼‘æ—¥"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"font-medium text-gray-900",children:"å–¶æ¥­æ™‚é–“"}),e.jsx("span",{className:"text-gray-700",children:D?.opening_time&&D?.closing_time?`${D.opening_time.slice(0,5)} ã€œ ${D.closing_time.slice(0,5)}`:"å–¶æ¥­æ™‚é–“ã®æƒ…å ±ãŒã‚ã‚Šã¾ã›ã‚“"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"font-medium text-gray-900",children:"å®šä¼‘æ—¥"}),e.jsx("span",{className:"text-gray-700",children:(()=>{if(!D?.weekly_closed_days)return"å®šä¼‘æ—¥ã®æƒ…å ±ãŒã‚ã‚Šã¾ã›ã‚“";try{const e=JSON.parse(D.weekly_closed_days),s=["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"],a=e.map((e,a)=>e?s[a]:null).filter(e=>null!==e);return 0===a.length?"å¹´ä¸­ç„¡ä¼‘":`${a.join("ãƒ»")}æ›œæ—¥`}catch{return"å®šä¼‘æ—¥ã®æƒ…å ±ãŒã‚ã‚Šã¾ã›ã‚“"}})()})]}),null!==ve()&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"font-medium text-gray-900",children:"æœ¬æ—¥ã®å–¶æ¥­"}),e.jsx("span",{className:"font-semibold "+(ve()?"text-green-600":"text-red-600"),children:ve()?"å–¶æ¥­ä¸­":"å®šä¼‘æ—¥"})]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(C,{facilityId:S})}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"ã‚¢ã‚¯ã‚»ã‚¹"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start text-gray-600",children:[e.jsx(g,{className:"w-5 h-5 mr-2 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:D.address})]}),e.jsx("div",{className:"mt-3",children:e.jsx(r,{variant:"secondary",size:"sm",className:"w-full",onClick:()=>{const e=encodeURIComponent(D.address);window.open(`https://maps.google.com/maps?q=${e}`,"_blank")},children:"Google Mapsã§é–‹ã"})})]})]}),e.jsx("div",{className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm",children:e.jsxs(r,{onClick:async()=>{if($)try{const{data:e}=await n.from("pet_facilities").select("owner_id").eq("id",S).single(),s=e?.owner_id;if(!s)return void alert("ã‚ªãƒ¼ãƒŠãƒ¼æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");await n.from("messages").insert({sender_id:$.id,receiver_id:s,content:`ï¼ˆæ–½è¨­ã€${D.name}ã€ã®è©³ç´°ãƒšãƒ¼ã‚¸ã‹ã‚‰ã®å•ã„åˆã‚ã›ï¼‰`}),sessionStorage.setItem("communityActiveTab","messages"),sessionStorage.setItem("communityOpenPartnerId",s),q("/community")}catch{}else q("/liff/login")},className:"w-full bg-green-600 hover:bg-green-700 text-lg py-3 flex items-center justify-center",children:[e.jsx(f,{className:"w-5 h-5 mr-2"}),"æ–½è¨­ã‚ªãƒ¼ãƒŠãƒ¼ã«å•ã„åˆã‚ã›ã‚‹"]})}),Q&&e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(b,{className:"w-5 h-5 text-yellow-400 mr-2"}),"ãƒ¬ãƒ“ãƒ¥ãƒ¼"]}),e.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(we,{rating:Math.round(Q.average_rating),size:"lg"}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:Q.average_rating})]}),e.jsxs("span",{className:"text-gray-600",children:["(",Q.review_count,"ä»¶ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼)"]})]}),e.jsx("div",{className:"space-y-2",children:[5,4,3,2,1].map(s=>{const a=Q[`rating_${s}_count`],t=Q.review_count>0?a/Q.review_count*100:0;return e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("span",{className:"w-3 text-gray-600",children:s}),e.jsx(b,{className:"w-3 h-3 text-yellow-400 fill-current"}),e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-yellow-400 h-2 rounded-full",style:{width:`${t}%`}})}),e.jsx("span",{className:"w-8 text-gray-600 text-right",children:a})]},s)})})]})]})})]})]}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[D.coupons&&D.coupons.length>0&&e.jsxs("div",{className:"mb-12",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:[e.jsx(y,{className:"w-8 h-8 inline mr-3 text-red-500"}),"åˆ©ç”¨å¯èƒ½ãªã‚¯ãƒ¼ãƒãƒ³"]}),e.jsx("p",{className:"text-gray-600",children:"ãŠå¾—ãªã‚¯ãƒ¼ãƒãƒ³ã‚’ã”åˆ©ç”¨ãã ã•ã„"})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:D.coupons.map(s=>{const a=J.find(e=>e.coupon_id===s.id),t=new Date(s.end_date||s.validity_end)<new Date,i=!t&&!a&&s.is_active;return e.jsx(c,{className:"overflow-hidden shadow-lg hover:shadow-xl transition-shadow",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"w-full max-w-sm mx-auto",children:s.coupon_image_url?e.jsx("div",{className:"aspect-square w-full border-2 border-gray-300 rounded-xl overflow-hidden shadow-md",children:e.jsx("img",{src:s.coupon_image_url,alt:"ã‚¯ãƒ¼ãƒãƒ³ç”»åƒ",className:"w-full h-full object-cover"})}):e.jsx("div",{className:"aspect-square w-full border-2 border-gray-300 rounded-xl relative overflow-hidden shadow-md",children:e.jsxs("div",{className:"w-full h-full bg-gradient-to-br from-red-500 to-red-600 relative",children:[e.jsx("div",{className:"absolute top-1/2 -left-3 w-6 h-6 bg-gray-50 rounded-full transform -translate-y-1/2"}),e.jsx("div",{className:"absolute top-1/2 -right-3 w-6 h-6 bg-gray-50 rounded-full transform -translate-y-1/2"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-20",children:e.jsx("span",{className:"text-6xl font-bold text-white transform rotate-12",children:"COUPON"})}),e.jsxs("div",{className:"relative z-10 h-full flex flex-col items-center justify-center p-4 text-center space-y-3",children:[e.jsx("div",{className:"bg-white/95 px-3 py-1 rounded-full shadow-sm",children:e.jsx("span",{className:"text-xs font-medium text-red-600",children:"ãƒ‰ãƒƒã‚°ãƒ‘ãƒ¼ã‚¯JPã‚¯ãƒ¼ãƒãƒ³"})}),e.jsx("div",{className:"text-white font-bold text-sm",children:D.name}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-base font-bold text-white leading-tight",children:s.title}),e.jsx("p",{className:"text-sm text-white/90 leading-tight",children:s.service_content})]}),s.discount_value&&e.jsxs("div",{className:"bg-white text-red-600 px-4 py-2 rounded-full shadow-md",children:[e.jsxs("span",{className:"text-xl font-bold",children:[s.discount_value,"amount"===s.discount_type?"å††":"%"]}),e.jsx("span",{className:"text-xs ml-1",children:"OFF"})]}),e.jsx("div",{className:"pt-2 border-t border-white/30",children:e.jsx("p",{className:"text-xs text-white/80 leading-tight",children:s.description})})]})]})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:s.title}),e.jsx("p",{className:"text-gray-600 mt-2 leading-relaxed",children:s.service_content})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(N,{className:"w-4 h-4 text-blue-500"}),e.jsxs("span",{className:"text-gray-700",children:["æœ‰åŠ¹æœŸé™: ",(()=>{const e=s.end_date||s.validity_end,a=e?new Date(e):null;return a&&!isNaN(a.getTime())?a.toLocaleDateString("ja-JP"):"æœªè¨­å®š"})()]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(v,{className:"w-4 h-4 text-green-500"}),e.jsxs("span",{className:"text-gray-700",children:["åˆ©ç”¨åˆ¶é™: ","once"===s.usage_limit_type?"1å›é™ã‚Š":"ä½•å›ã§ã‚‚"]})]})]}),e.jsx("div",{className:"pt-4",children:$?a?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-full py-3 text-base text-center bg-gray-50 border rounded-lg",children:"å–å¾—æ¸ˆã¿ã®ã‚¯ãƒ¼ãƒãƒ³ã§ã™ã€‚è¡¨ç¤ºã¯ãƒã‚¤ãƒšãƒ¼ã‚¸ã®ã€Œãƒã‚¤ã‚¯ãƒ¼ãƒãƒ³ã€ã‹ã‚‰è¡Œãˆã¾ã™ã€‚"}),a.is_used&&e.jsxs("p",{className:"text-sm text-gray-500 text-center",children:[new Date(a.used_at).toLocaleDateString("ja-JP")," ã«ä½¿ç”¨"]})]}):i?e.jsx(r,{onClick:()=>Ne(s.id),disabled:H===s.id,className:"w-full py-3 text-base bg-red-600 hover:bg-red-700 shadow-lg",children:H===s.id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"å–å¾—ä¸­..."]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-5 h-5 mr-2"}),"ã‚¯ãƒ¼ãƒãƒ³ã‚’å–å¾—"]})}):e.jsx(r,{disabled:!0,className:"w-full py-3 text-base",variant:"outline",children:t?"ã‚¯ãƒ¼ãƒãƒ³ã®æœ‰åŠ¹æœŸé™åˆ‡ã‚Œ":"ã‚¯ãƒ¼ãƒãƒ³åˆ©ç”¨ä¸å¯"}):e.jsx(l,{to:"/liff/login",children:e.jsx(r,{className:"w-full py-3 text-base",variant:"outline",children:"ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã‚¯ãƒ¼ãƒãƒ³ã‚’å–å¾—"})})})]})]})})},s.id)})})]}),e.jsxs("div",{className:"mb-12",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:[e.jsx(b,{className:"w-8 h-8 inline mr-3 text-yellow-400"}),"ãƒ¬ãƒ“ãƒ¥ãƒ¼"]}),e.jsx("p",{className:"text-gray-600",children:"ä»–ã®é£¼ã„ä¸»ã•ã‚“ã®ä½“é¨“è«‡ã‚’ã”è¦§ãã ã•ã„"})]}),$&&ae.length>0&&e.jsx("div",{className:"text-center mb-8",children:e.jsxs(r,{onClick:()=>Z(!0),className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æŠ•ç¨¿ã™ã‚‹"]})}),$&&0===ae.length&&e.jsxs("div",{className:"text-center mb-8 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("p",{className:"text-yellow-800 mb-2",children:"ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æŠ•ç¨¿ã™ã‚‹ã«ã¯ã€ãƒ¯ãƒ³ã¡ã‚ƒã‚“ã®ç™»éŒ²ãŒå¿…è¦ã§ã™"}),e.jsx(l,{to:"/dog-registration",children:e.jsx(r,{variant:"secondary",size:"sm",children:"ãƒ¯ãƒ³ã¡ã‚ƒã‚“ã‚’ç™»éŒ²ã™ã‚‹"})})]}),Y&&e.jsxs(c,{className:"p-6 mb-8 border-blue-200 bg-blue-50",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æŠ•ç¨¿"}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),$&&le){ne(!0);try{const e=ae.find(e=>e.id===le),a=e?`${e.name}${"male"===e.gender?"ãã‚“":"ã¡ã‚ƒã‚“"}ã®é£¼ã„ä¸»ã•ã‚“`:"ãƒ¯ãƒ³ã¡ã‚ƒã‚“ã®é£¼ã„ä¸»ã•ã‚“";let t="";if(fe){de(!0);try{const e=`facility-reviews/${`review_${$.id}_${S}_${Date.now()}.jpg`}`,{data:s,error:a}=await n.storage.from("dog-images").upload(e,fe,{cacheControl:"3600",upsert:!1,contentType:"image/jpeg"});if(a)throw a;const{data:l}=n.storage.from("dog-images").getPublicUrl(e);t=l.publicUrl}catch(s){throw new Error("ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{de(!1)}}const{error:l}=await n.from("facility_reviews").insert({facility_id:S,user_id:$.id,dog_name:a,rating:ee.rating,comment:ee.comment,visit_date:ee.visit_date,image_url:t||null});if(l)throw l;se({rating:5,comment:"",visit_date:(new Date).toISOString().split("T")[0],image_url:""}),ue(null),pe(null),be(null),re(""),Z(!1),await ye(),alert("ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æŠ•ç¨¿ã—ã¾ã—ãŸï¼")}catch(a){alert(a instanceof Error?a.message:"ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®æŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{ne(!1)}}},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ãƒ¬ãƒ“ãƒ¥ãƒ¼æŠ•ç¨¿ã™ã‚‹ãƒ¯ãƒ³ã¡ã‚ƒã‚“"}),e.jsxs("select",{value:le,onChange:e=>re(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"ãƒ¯ãƒ³ã¡ã‚ƒã‚“ã‚’é¸æŠã—ã¦ãã ã•ã„"}),ae.map(s=>e.jsxs("option",{value:s.id,children:[s.name,"male"===s.gender?"ãã‚“":"ã¡ã‚ƒã‚“"]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"è©•ä¾¡"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[[1,2,3,4,5].map(s=>e.jsx("button",{type:"button",onClick:()=>se(e=>({...e,rating:s})),className:"p-1",children:e.jsx(b,{className:"w-8 h-8 "+(s<=ee.rating?"text-yellow-400 fill-current":"text-gray-300")})},s)),e.jsxs("span",{className:"ml-2 text-sm text-gray-600",children:["(",ee.rating,"ç‚¹)"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"è¨ªå•æ—¥"}),e.jsx("input",{type:"date",value:ee.visit_date,onChange:e=>se(s=>({...s,visit_date:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ã‚³ãƒ¡ãƒ³ãƒˆ"}),e.jsx("textarea",{value:ee.comment,onChange:e=>se(s=>({...s,comment:e.target.value})),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"æ–½è¨­ã®æ„Ÿæƒ³ã‚’ãŠèã‹ã›ãã ã•ã„...",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"review-image",className:"block text-sm font-medium text-gray-700 mb-2",children:"ç”»åƒã‚’è¿½åŠ ï¼ˆä»»æ„ï¼‰"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("input",{type:"file",id:"review-image",accept:"image/*",onChange:e=>{const s=e.target.files?.[0];if(s){if(s.size>10485760)return void alert("ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã¯10MBä»¥ä¸‹ã«ã—ã¦ãã ã•ã„");ue(s),he(!0)}},className:"block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),(ge||fe)&&e.jsx(r,{type:"button",variant:"outline",size:"sm",onClick:()=>{ue(null),pe(null),be(null)},children:"å‰Šé™¤"})]}),ce&&e.jsxs("div",{className:"mt-2 text-sm text-gray-500 flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),"ç”»åƒã‚’å‡¦ç†ä¸­..."]}),je&&e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"flex items-center space-x-3",children:e.jsx("img",{src:je,alt:"ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼",className:"w-20 h-20 rounded-lg object-cover border border-gray-200 shadow-sm"})})})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(r,{type:"submit",disabled:ie,className:"bg-blue-600 hover:bg-blue-700",children:ie?"æŠ•ç¨¿ä¸­...":"æŠ•ç¨¿ã™ã‚‹"}),e.jsx(r,{type:"button",onClick:()=>Z(!1),className:"bg-gray-300 hover:bg-gray-400 text-gray-700",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[void 0,W.length>0?W.map(s=>e.jsxs(c,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full flex items-center justify-center",children:e.jsx(v,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.dog_name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["è¨ªå•æ—¥: ",new Date(s.visit_date).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(we,{rating:s.rating,size:"sm"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["(",s.rating,"ç‚¹)"]})]})]}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:s.comment}),s.image_url&&e.jsxs("div",{className:"mt-3",children:[e.jsx("img",{src:s.image_url,alt:"ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒ",className:"w-20 h-20 object-cover rounded-lg cursor-pointer hover:opacity-90 transition-opacity shadow-md border border-gray-200",onClick:()=>me(s.image_url||null)}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"ç”»åƒã‚’ã‚¿ãƒƒãƒ—ã§æ‹¡å¤§"})]}),oe&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"relative max-w-4xl max-h-full",children:[e.jsx("button",{onClick:()=>me(null),className:"absolute top-4 right-4 text-white hover:text-gray-300 z-10",children:e.jsx(w,{className:"w-8 h-8"})}),e.jsx("img",{src:oe,alt:"ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒï¼ˆæ‹¡å¤§ï¼‰",className:"max-w-full max-h-full object-contain rounded-lg"})]})}),e.jsxs("p",{className:"text-xs text-gray-400 mt-3",children:["æŠ•ç¨¿æ—¥: ",new Date(s.created_at).toLocaleDateString()]})]},s.id)):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(b,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-xl text-gray-500 mb-2",children:"ã¾ã ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒã‚ã‚Šã¾ã›ã‚“"}),e.jsx("p",{className:"text-gray-400",children:"æœ€åˆã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æŠ•ç¨¿ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ"})]})]})]})]}),U&&D.images&&D.images.length>0&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"relative max-w-4xl w-full",children:[e.jsx("button",{onClick:()=>L(!1),className:"absolute top-4 right-4 text-white hover:text-gray-300 z-10",children:e.jsx(w,{className:"w-8 h-8"})}),e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:D.images[P].image_url,alt:D.images[P].alt_text||"æ–½è¨­ç”»åƒ",className:"w-full h-auto max-h-[80vh] object-contain rounded-lg"}),D.images.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{D?.images&&D.images.length>0&&T(e=>0===e?D.images.length-1:e-1)},className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-gray-300",children:e.jsx(_,{className:"w-8 h-8"})}),e.jsx("button",{onClick:()=>{D?.images&&D.images.length>0&&T(e=>e===D.images.length-1?0:e+1)},className:"absolute right-4 top-1/2 transform -translate-y-1/2 text-white hover:text-gray-300",children:e.jsx(k,{className:"w-8 h-8"})})]})]}),e.jsxs("div",{className:"text-center mt-4 text-white",children:[e.jsxs("p",{children:[P+1," / ",D.images.length]}),D.images[P].alt_text&&e.jsx("p",{className:"text-sm text-gray-300 mt-2",children:D.images[P].alt_text})]})]})}),R&&G&&e.jsx(m,{userCoupon:G,onClose:()=>{B(!1),A(null)}}),oe&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"relative max-w-2xl w-full",children:[e.jsx("button",{onClick:()=>me(null),className:"absolute top-4 right-4 text-white hover:text-gray-300 z-10 bg-black bg-opacity-50 rounded-full p-2",children:e.jsx(w,{className:"w-6 h-6"})}),e.jsx("img",{src:oe,alt:"ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒæ‹¡å¤§",className:"w-full h-auto max-h-[80vh] object-contain rounded-lg"})]})}),xe&&ge&&e.jsx(o,{imageFile:ge,onCropComplete:e=>{be(e),pe(URL.createObjectURL(e)),he(!1)},onCancel:()=>{ue(null),he(!1)},aspectRatio:1,maxWidth:600,maxHeight:600})]})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsx(c,{className:"max-w-md w-full",children:e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:"ğŸ¢"}),e.jsx("h1",{className:"text-xl font-bold text-gray-900 mb-2",children:"æ–½è¨­ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"æŒ‡å®šã•ã‚ŒãŸæ–½è¨­ã¯å­˜åœ¨ã—ãªã„ã‹ã€ç¾åœ¨åˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚"}),e.jsxs(r,{onClick:()=>q("/parks"),variant:"outline",children:[e.jsx(x,{className:"mr-2 h-4 w-4"}),"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ãƒ»æ–½è¨­ä¸€è¦§ã«æˆ»ã‚‹"]})]})})})}function C({facilityId:a}){const[l,i]=s.useState(!1),c=t();return s.useEffect(()=>{(async()=>{const{data:e}=await n.from("facility_reservation_settings").select("enabled").eq("facility_id",a).maybeSingle();i(Boolean(e?.enabled))})()},[a]),l?e.jsx("div",{className:"mt-3",children:e.jsx(r,{className:"w-full bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>c(`/facilities/${a}/reserve`),children:"äºˆç´„ã™ã‚‹"})}):null}export{S as FacilityDetail};

import{j as e}from"./motion-BHsL7Azw.js";import{c as s}from"./supabase--qivnNSU.js";import{r as t}from"./react-vendor-CMvmJHsS.js";import{a as r}from"./router-DXQOdrLL.js";const a=s("https://onmcivwxtzqajcovptgf.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9ubWNpdnd4dHpxYWpjb3ZwdGdmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkxODk3OTUsImV4cCI6MjA2NDc2NTc5NX0.AqFCz3GQUVeGaG2988LCzsE4aJpeio3xScoxv5T0-OU",{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1}}),o=()=>{const s=r(),[o,n]=t.useState(""),[i,l]=t.useState(""),[c,d]=t.useState(""),[u,m]=t.useState(!1),[b,h]=t.useState(!1),[x,g]=t.useState(!0),[p,f]=t.useState(null);t.useEffect(()=>{(()=>{try{g(!0);const e=new URLSearchParams(window.location.hash.substring(1)),s=e.get("access_token"),t=e.get("refresh_token");if("recovery"===e.get("type")&&s&&t)f(s),h(!0),d("✅ 認証が完了しました。新しいパスワードを設定してください。"),window.history.replaceState({},document.title,window.location.pathname);else{const e=new URLSearchParams(window.location.search),s=e.get("token");"recovery"===e.get("type")&&s?(f(s),h(!0),d("✅ 新しいパスワードを設定してください。")):(d("❌ 無効なパスワードリセットリンクです。再度パスワードリセットを行ってください。"),h(!1))}}catch(e){d("❌ 認証処理中にエラーが発生しました。再度お試しください。"),h(!1)}finally{g(!1)}})()},[]);return x?e.jsx("div",{className:"max-w-md mx-auto mt-10 p-6 bg-white rounded shadow",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"認証情報を確認中..."})]})}):e.jsxs("div",{className:"max-w-md mx-auto mt-10 p-6 bg-white rounded shadow",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-center",children:"パスワード再設定"}),c&&e.jsx("div",{className:"mb-4 p-4 rounded-lg border "+(c.includes("✅")||c.includes("設定してください")?"text-green-700 bg-green-100 border-green-300":c.includes("❌")?"text-red-700 bg-red-100 border-red-300":c.includes("🔄")?"text-blue-700 bg-blue-100 border-blue-300":"text-gray-700 bg-gray-100 border-gray-300"),children:e.jsx("p",{className:"text-sm",children:c})}),b?e.jsxs("form",{onSubmit:e=>{(async e=>{if(e.preventDefault(),o===i)if(o.length<6)d("❌ パスワードは6文字以上で入力してください。");else if(p){m(!0),d("🔄 パスワードを更新中...");try{const{error:e}=await a.auth.setSession({access_token:p,refresh_token:p});if(e)throw e;const{error:t}=await a.auth.updateUser({password:o});if(t)throw t;await a.auth.signOut(),d("✅ パスワードが正常に変更されました！ログイン画面に移動します..."),"Notification"in window&&"granted"===Notification.permission&&new Notification("パスワード変更完了",{body:"パスワードが正常に変更されました。新しいパスワードでログインしてください。",icon:"/favicon.svg"}),setTimeout(()=>{s("/login")},3e3)}catch(t){const e=t instanceof Error?t.message:"不明なエラー";e.includes("session_not_found")?d("❌ セッションが見つかりません。パスワードリセットを最初からやり直してください。"):e.includes("invalid_token")?d("❌ 無効なトークンです。パスワードリセットを最初からやり直してください。"):e.includes("Token has expired")?d("❌ リセットリンクの有効期限が切れています。新しいパスワードリセットを行ってください。"):d(`❌ パスワードの更新に失敗しました: ${e}`)}finally{m(!1)}}else d("❌ リセットトークンが見つかりません。再度パスワードリセットを行ってください。");else d("❌ パスワードが一致しません。")})(e)},children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"新しいパスワード *"}),e.jsx("input",{type:"password",className:"w-full border border-gray-300 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:o,onChange:e=>n(e.target.value),required:!0,minLength:6,placeholder:"6文字以上で入力してください"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"パスワード確認 *"}),e.jsx("input",{type:"password",className:"w-full border border-gray-300 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:i,onChange:e=>l(e.target.value),required:!0,minLength:6,placeholder:"パスワードを再入力してください"})]}),e.jsx("button",{type:"submit",className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",disabled:u,children:u?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"更新中..."]}):"パスワードを変更"})]}):e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"⚠️"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"パスワードリセットリンクが無効または期限切れです。"})]}),e.jsx("button",{onClick:()=>s("/forgot-password"),className:"w-full bg-gray-600 text-white py-3 px-4 rounded-lg hover:bg-gray-700 transition-colors",children:"パスワードリセットを再実行"})]})]})};export{o as default};

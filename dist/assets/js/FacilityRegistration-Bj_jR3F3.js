import{j as e}from"./motion-CuO0nkIV.js";import{r as s}from"./react-vendor-cniURDpR.js";import{u as a,B as d,s as l}from"./index-C8-ZovGr.js";import{C as r}from"./Card-roTxPFVC.js";import{I as i}from"./Input-pnFPNpa9.js";import{g as t}from"./geocoding-C2oaRnzC.js";import{a as n}from"./router-CiK0M--J.js";import{p as m,u as c,r as o,aJ as x}from"./ui-basic-DtvVsAeD.js";import"./heavy-features-BIdEME4r.js";import"./supabase-DJQiR77k.js";const h=[{id:"pet_hotel",name:"ペットホテル",monthly_fee:5e3,is_free:!0},{id:"pet_salon",name:"ペットサロン",monthly_fee:3e3,is_free:!0},{id:"veterinary",name:"動物病院",monthly_fee:8e3,is_free:!0},{id:"pet_cafe",name:"ペットカフェ",monthly_fee:4e3,is_free:!0},{id:"pet_restaurant",name:"ペット同伴レストラン",monthly_fee:6e3,is_free:!0},{id:"pet_shop",name:"ペットショップ",monthly_fee:7e3,is_free:!0},{id:"pet_accommodation",name:"ペット同伴宿泊",monthly_fee:1e4,is_free:!0},{id:"dog_training",name:"しつけ教室",monthly_fee:4500,is_free:!0},{id:"pet_friendly_other",name:"その他ワンちゃん同伴可能施設",monthly_fee:3500,is_free:!0}];function u(){const{user:u,isAuthenticated:b,userProfile:f}=a(),p=n(),[j,g]=s.useState(!1),[y,N]=s.useState(""),[_,v]=s.useState(""),[w,E]=s.useState({name:"",address:"",isEditing:!1}),[k,C]=s.useState({name:"",category_id:"",address:"",phone:"",website:"",description:""});s.useEffect(()=>{b||p("/login")},[b,p]),s.useEffect(()=>{(async()=>{if(f){const e=f.name||f.display_name||f.full_name||"",s=f.address||f.location||f.postal_address||"";E({name:e,address:s,isEditing:!1})}else if(u)try{const{data:e,error:s}=await l.from("profiles").select("*").eq("id",u.id).single();if(e&&!s){const s=e.name||e.display_name||e.full_name||"",a=e.address||e.location||e.postal_address||"";E({name:s,address:a,isEditing:!s||!a})}else{const e=u.user_metadata||{},s=e.name||e.full_name||e.display_name||e.given_name||e.nickname||(e.given_name&&e.family_name?`${e.family_name} ${e.given_name}`:"")||"",a=e.address||e.location||e.postal_address||e.street_address||e.formatted_address||"";E({name:s,address:a,isEditing:!s||!a})}}catch(e){E({name:"",address:"",isEditing:!0})}else E({name:"",address:"",isEditing:!0})})()},[f,u]);const q=e=>{const{name:s,value:a}=e.target;C(e=>({...e,[s]:a}))},S=e=>{const{name:s,value:a}=e.target;E(e=>({...e,[s]:a}))};return b?e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"ペット関連施設登録"}),e.jsx("p",{className:"text-gray-600",children:"ペット関連施設の掲載申請を行います。管理者の承認後、地図に表示されます。"})]}),y&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(m,{className:"w-5 h-5 text-red-500 mr-2"}),e.jsx("span",{className:"text-red-700",children:y})]})}),_&&e.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(c,{className:"w-5 h-5 text-green-500 mr-2"}),e.jsx("span",{className:"text-green-700",children:_})]})}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),b&&u)if(k.name&&k.category_id&&k.address)try{g(!0),N("");const e=formatAddressForGeocoding(k.address),s=await t(e);let a=null,d=null;s&&(a=s.latitude,d=s.longitude);const{data:r,error:i}=await l.from("pet_facilities").insert({name:k.name,category_id:k.category_id,address:k.address,latitude:a,longitude:d,phone:k.phone||null,website:k.website||null,description:k.description||null,owner_id:u.id,status:"pending"}).select().single();if(i)throw i;v(s?"施設の申請が正常に送信されました。地図上での正確な位置も設定されています。承認をお待ちください。":"施設の申請が正常に送信されました。（位置情報は後ほど設定されます）承認をお待ちください。"),C({name:"",category_id:"",address:"",phone:"",website:"",description:""})}catch(s){N("申請の送信に失敗しました。再度お試しください。")}finally{g(!1)}else N("施設名、カテゴリ、住所は必須項目です");else N("認証が必要です")},className:"space-y-6",children:[e.jsx(r,{children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center",children:[e.jsx(o,{className:"w-6 h-6 mr-2"}),"基本情報"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["施設名 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(i,{label:"施設名",name:"name",value:k.name,onChange:q,placeholder:"施設名を入力してください",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["施設カテゴリ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"category_id",value:k.category_id,onChange:q,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"カテゴリを選択してください"}),h.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["住所 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(i,{label:"住所",name:"address",value:k.address,onChange:q,placeholder:"住所を入力してください",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"電話番号"}),e.jsx(i,{label:"電話番号",name:"phone",value:k.phone,onChange:q,placeholder:"電話番号を入力してください"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ウェブサイト"}),e.jsx(i,{label:"ウェブサイト",name:"website",value:k.website,onChange:q,placeholder:"https://example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"施設説明"}),e.jsx("textarea",{name:"description",value:k.description,onChange:q,rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"施設の特徴やサービス内容を説明してください"})]})]})]})}),e.jsx(r,{children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center",children:[e.jsx(x,{className:"w-6 h-6 mr-2"}),"施設画像について"]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(m,{className:"w-5 h-5 text-blue-600 mt-1 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800 mb-1",children:"画像のアップロードについて"}),e.jsx("p",{className:"text-sm text-blue-700",children:"掲載画像は承認後にマイページ内で添付することができます。"})]})]})})]})}),e.jsx(r,{children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center",children:[e.jsx(c,{className:"w-6 h-6 mr-2"}),"登録者情報の確認"]}),e.jsx("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(m,{className:"w-5 h-5 text-blue-500 mr-2 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"登録者情報の確認"}),e.jsx("p",{className:"text-xs mb-2",children:"アカウント情報から自動取得されました。変更が必要な場合は編集できます。"}),e.jsx("p",{className:"text-xs font-medium text-blue-600",children:"⚠️ この情報は公開されません"})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"氏名"}),w.isEditing?e.jsx(i,{label:"",name:"name",value:w.name,onChange:S,placeholder:"氏名を入力してください",required:!0}):e.jsx("div",{className:"px-3 py-2 bg-gray-50 border border-gray-200 rounded-md",children:e.jsx("p",{className:"text-gray-900",children:w.name||"未設定"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"住所"}),w.isEditing?e.jsx(i,{name:"address",value:w.address,onChange:S,placeholder:"住所を入力してください"}):e.jsx("div",{className:"px-3 py-2 bg-gray-50 border border-gray-200 rounded-md",children:e.jsx("p",{className:"text-gray-900",children:w.address||"未設定"})})]})]}),e.jsx("div",{className:"flex justify-end mt-4",children:w.isEditing?e.jsxs("div",{className:"space-x-2",children:[e.jsx(d,{type:"button",onClick:()=>{(async()=>{if(u)try{g(!0);const{error:e}=await l.from("profiles").update({name:w.name,address:w.address}).eq("id",u.id);if(e)throw e;E(e=>({...e,isEditing:!1})),v("ユーザー情報を更新しました")}catch(e){N("ユーザー情報の更新に失敗しました")}finally{g(!1)}})()},disabled:j,children:j?"保存中...":"保存"}),e.jsx(d,{type:"button",variant:"secondary",onClick:()=>{E(e=>({...e,isEditing:!1}))},disabled:j,children:"キャンセル"})]}):e.jsx(d,{type:"button",variant:"secondary",onClick:()=>E(e=>({...e,isEditing:!0})),children:"編集"})})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(d,{type:"submit",disabled:j,className:"px-8 py-3 text-lg",children:j?"申請中...":"申請を送信"})})]})]}):null}export{u as default};

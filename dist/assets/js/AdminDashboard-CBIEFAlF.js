import{j as e}from"./motion-CuO0nkIV.js";import{r as s}from"./react-vendor-cniURDpR.js";import{a as t,L as a}from"./router-CiK0M--J.js";import{k as l,B as r,s as i,u as n}from"./index-C8-ZovGr.js";import{C as c}from"./Card-roTxPFVC.js";import{I as d}from"./Input-pnFPNpa9.js";import{aQ as x,i as m,u as o,au as h,O as j,P as p,b as g,d as u,aL as b,w as N,aM as v,r as y,aD as f,j as w,aP as _,U as k,aR as S,aF as C,aS as P,o as R}from"./ui-basic-DtvVsAeD.js";import{S as I}from"./Select-Dd_IZFKg.js";import{g as D,a as U}from"./adminFraudDetection-BJ2I65Yg.js";import F from"./AdminFacilityApproval-D0nq7FUg.js";import{AdminParkManagement as L}from"./AdminParkManagement-BesKlbIT.js";import M from"./AdminVaccineApproval-Dn84ILaa.js";import"./heavy-features-BIdEME4r.js";import"./supabase-DJQiR77k.js";const q=({onError:t,onSuccess:a})=>{const{isMaintenanceActive:n,maintenanceInfo:u,loading:b,refreshMaintenanceStatus:N,clientIP:v,isIPWhitelisted:y}=l(),[f,w]=s.useState([]),[_,k]=s.useState([]),[S,C]=s.useState(!0),[P,R]=s.useState(!1),[I,D]=s.useState(!1),[U,F]=s.useState({title:"",message:"",start_time:"",end_time:"",is_emergency:!1}),[L,M]=s.useState({ip_address:"",description:""}),q=async()=>{try{C(!0);const{data:e,error:s}=await i.from("maintenance_schedules").select("*").order("created_at",{ascending:!1});s&&"PGRST116"!==s.code||w(e||[]);const{data:t,error:a}=await i.from("ip_whitelist").select("*").order("created_at",{ascending:!1});a&&"PGRST116"!==a.code||k(t||[])}catch(e){t("メンテナンスデータの取得でエラーが発生しました")}finally{C(!1)}};s.useEffect(()=>{q()},[]);const A=async e=>{try{const{error:s}=await i.from("maintenance_schedules").update({is_active:!1,end_time:(new Date).toISOString()}).eq("id",e);if(s)throw s;a("メンテナンスを終了しました"),await q(),await N()}catch(s){t("メンテナンス終了でエラーが発生しました")}};return b||S?e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"メンテナンス設定を読み込み中..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(c,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(x,{className:"w-5 h-5 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold",children:"現在の状態"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex items-center px-3 py-2 rounded-lg "+(n?"bg-red-100 text-red-800":"bg-green-100 text-green-800"),children:n?e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:"メンテナンス中"})]}):e.jsxs(e.Fragment,{children:[e.jsx(o,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:"正常稼働中"})]})}),v&&e.jsxs("div",{className:"flex items-center px-3 py-2 rounded-lg "+(y?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"),children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),e.jsxs("span",{children:["IP: ",v]}),y&&e.jsx("span",{className:"ml-1",children:"(ホワイトリスト)"})]})]}),u&&e.jsxs("div",{className:"mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-yellow-800",children:u.title}),e.jsx("p",{className:"text-yellow-700 mt-1",children:u.message}),e.jsx("div",{className:"flex justify-end mt-3",children:e.jsx(r,{size:"sm",onClick:()=>{A(u.id)},className:"bg-red-600 hover:bg-red-700 text-white",children:"メンテナンス終了"})})]})]}),e.jsxs(c,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(j,{className:"w-5 h-5 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold",children:"メンテナンススケジュール"})]}),e.jsxs(r,{onClick:()=>R(!P),className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"新規作成"]})]}),P&&e.jsxs("div",{className:"mb-6 p-4 border border-gray-200 rounded-lg bg-gray-50",children:[e.jsx("h4",{className:"font-semibold mb-3",children:"新しいメンテナンススケジュール"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(d,{label:"タイトル",value:U.title,onChange:e=>F({...U,title:e.target.value}),placeholder:"メンテナンスのタイトル"}),e.jsx(d,{label:"開始時刻",type:"datetime-local",value:U.start_time,onChange:e=>F({...U,start_time:e.target.value})})]}),e.jsx("div",{className:"mt-4",children:e.jsx(d,{label:"メッセージ",value:U.message,onChange:e=>F({...U,message:e.target.value}),placeholder:"メンテナンス内容の説明"})}),e.jsx("div",{className:"mt-4",children:e.jsx(d,{label:"終了時刻（オプション）",type:"datetime-local",value:U.end_time,onChange:e=>F({...U,end_time:e.target.value})})}),e.jsx("div",{className:"mt-4",children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:U.is_emergency,onChange:e=>F({...U,is_emergency:e.target.checked}),className:"mr-2"}),"緊急メンテナンス"]})}),e.jsxs("div",{className:"flex space-x-2 mt-4",children:[e.jsx(r,{onClick:()=>{(async()=>{try{if(!U.title||!U.message)return void t("タイトルとメッセージは必須です");const{error:e}=await i.from("maintenance_schedules").insert([{...U,start_time:U.start_time||(new Date).toISOString(),end_time:U.end_time||null,is_active:!0}]);if(e)throw e;a("メンテナンススケジュールを作成しました"),R(!1),F({title:"",message:"",start_time:"",end_time:"",is_emergency:!1}),await q(),await N()}catch(e){t("スケジュール作成でエラーが発生しました")}})()},className:"bg-green-600 hover:bg-green-700",children:"作成"}),e.jsx(r,{variant:"secondary",onClick:()=>R(!1),children:"キャンセル"})]})]}),e.jsx("div",{className:"space-y-3",children:0===f.length?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"スケジュールがありません"}):f.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:s.title}),e.jsx("p",{className:"text-sm text-gray-600",children:s.message}),e.jsxs("div",{className:"flex items-center space-x-4 mt-1 text-xs text-gray-500",children:[e.jsxs("span",{children:["開始: ",s.start_time?new Date(s.start_time).toLocaleString():"未設定"]}),s.end_time&&e.jsxs("span",{children:["終了: ",new Date(s.end_time).toLocaleString()]}),s.is_emergency&&e.jsx("span",{className:"text-red-600 font-semibold",children:"緊急"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"px-2 py-1 rounded-full text-xs "+(s.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:s.is_active?"アクティブ":"終了"}),s.is_active&&e.jsx(r,{size:"sm",onClick:()=>{A(s.id)},className:"bg-red-600 hover:bg-red-700 text-white",children:"終了"})]})]},s.id))})]}),e.jsxs(c,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(g,{className:"w-5 h-5 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold",children:"IPホワイトリスト管理"})]}),e.jsxs(r,{onClick:()=>D(!I),className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"IP追加"]})]}),I&&e.jsxs("div",{className:"mb-6 p-4 border border-gray-200 rounded-lg bg-gray-50",children:[e.jsx("h4",{className:"font-semibold mb-3",children:"新しいIP追加"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(d,{label:"IPアドレス",value:L.ip_address,onChange:e=>M({...L,ip_address:e.target.value}),placeholder:"例: 192.168.1.1"}),e.jsx(d,{label:"説明",value:L.description,onChange:e=>M({...L,description:e.target.value}),placeholder:"このIPの説明"})]}),e.jsxs("div",{className:"flex space-x-2 mt-4",children:[e.jsx(r,{onClick:()=>{(async()=>{try{if(!L.ip_address)return void t("IPアドレスは必須です");const{error:e}=await i.from("ip_whitelist").insert([L]);if(e)throw e;a("IPをホワイトリストに追加しました"),D(!1),M({ip_address:"",description:""}),await q()}catch(e){t("IP追加でエラーが発生しました")}})()},className:"bg-green-600 hover:bg-green-700",children:"追加"}),e.jsx(r,{variant:"secondary",onClick:()=>D(!1),children:"キャンセル"})]})]}),e.jsx("div",{className:"space-y-3",children:0===_.length?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"ホワイトリストにIPがありません"}):_.map(s=>e.jsx("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:s.ip_address}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description}),e.jsxs("p",{className:"text-xs text-gray-500",children:["追加日: ",new Date(s.created_at).toLocaleString()]})]})},s.id))})]})]})},A=()=>{const[t,a]=s.useState([]),[l,n]=s.useState(!0);s.useEffect(()=>{d()},[]);const d=async()=>{try{const{data:e,error:s}=await i.from("sponsor_inquiries").select("*").order("created_at",{ascending:!1});if(s)throw s;a(e||[])}catch(e){}finally{n(!1)}},x=async(e,s)=>{try{const{error:t}=await i.from("sponsor_inquiries").update({status:s,updated_at:(new Date).toISOString()}).eq("id",e);if(t)throw t;await d()}catch(t){alert("ステータスの更新に失敗しました")}};return l?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"スポンサー広告お問い合わせ管理"}),e.jsx(r,{onClick:d,variant:"outline",children:"更新"})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(u,{className:"h-5 w-5 text-yellow-400"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"メール送信手順"}),e.jsxs("div",{className:"mt-2 text-sm text-yellow-700",children:[e.jsx("p",{children:"1. 「メール送信」ボタンをクリックしてメールクライアントを開く"}),e.jsx("p",{children:"2. 事前に作成された文面を確認して送信"}),e.jsx("p",{children:"3. 送信後、ステータスを「連絡済み」に更新"})]})]})]})}),0===t.length?e.jsx(c,{className:"p-8 text-center",children:e.jsx("p",{className:"text-gray-500",children:"お問い合わせはありません"})}):e.jsx("div",{className:"space-y-4",children:t.map(s=>e.jsxs(c,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.company_name}),e.jsxs("p",{className:"text-gray-600",children:["担当者: ",s.contact_person]}),e.jsxs("p",{className:"text-gray-600",children:["メール: ",s.email]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["申込日: ",new Date(s.created_at).toLocaleDateString("ja-JP")]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-medium "+("pending"===s.status?"bg-yellow-100 text-yellow-800":"contacted"===s.status?"bg-blue-100 text-blue-800":"completed"===s.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:"pending"===s.status?"未対応":"contacted"===s.status?"連絡済み":"completed"===s.status?"成約":"辞退"})})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"スポンサー申し込みURL"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("code",{className:"flex-1 bg-white p-2 rounded border text-sm",children:s.sponsor_url}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>{return e=s.sponsor_url,navigator.clipboard.writeText(e),void alert("クリップボードにコピーしました");var e},children:e.jsx(b,{className:"w-4 h-4"})}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>window.open(s.sponsor_url,"_blank"),children:e.jsx(N,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(r,{onClick:()=>(e=>{const s=encodeURIComponent("【ドッグパークJP】スポンサー広告資料のご案内"),t=encodeURIComponent(`${e.company_name}\n${e.contact_person} 様\n\nこの度は、ドッグパークJPのスポンサー広告にご興味をお持ちいただき、誠にありがとうございます。\n\n詳細な広告プランと料金につきましては、以下のURLよりご確認いただけます：\n${e.sponsor_url}\n\nドッグパークJPの実績：\n• 月間アクティブユーザー：10,000人以上\n• 登録施設数：500施設以上\n• 主要ユーザー層：30-50代の犬の飼い主\n• 平均滞在時間：5分以上\n\nご不明な点がございましたら、お気軽にお問い合わせください。\n担当者より詳しくご説明させていただきます。\n\nドッグパークJP運営チーム\nお問い合わせ：info@dogparkjp.com\n\n※このメールは送信専用です。返信はできませんのでご了承ください。`),a=`mailto:${e.email}?subject=${s}&body=${t}`;window.open(a,"_blank")})(s),className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(u,{className:"w-4 h-4 mr-2"}),"メール送信"]}),"pending"===s.status&&e.jsx(r,{onClick:()=>x(s.id,"contacted"),variant:"outline",children:"連絡済みにする"}),"contacted"===s.status&&e.jsxs(e.Fragment,{children:[e.jsx(r,{onClick:()=>x(s.id,"completed"),className:"bg-green-600 hover:bg-green-700",children:"成約"}),e.jsx(r,{onClick:()=>x(s.id,"declined"),className:"bg-red-600 hover:bg-red-700",children:"辞退"})]}),("completed"===s.status||"declined"===s.status)&&e.jsx(r,{onClick:()=>x(s.id,"pending"),variant:"outline",children:"未対応に戻す"})]})]},s.id))})]})},T={title:"",description:"",image_url:"",website_url:"",banner_type:"top",is_active:!0,display_order:0,start_date:"",end_date:""},z=()=>{const[t,a]=s.useState([]),[l,n]=s.useState(!0),[x,m]=s.useState(!1),[o,h]=s.useState(!1),[j,p]=s.useState(null),[g,u]=s.useState(T),[b,N]=s.useState(null),[v,y]=s.useState(null),f=s.useCallback(async()=>{try{const{data:e,error:s}=await i.from("sponsor_banners").select("*").order("display_order",{ascending:!0});if(s)throw s;a(e||[])}catch(e){N("バナーの取得に失敗しました")}finally{n(!1)}},[]);s.useEffect(()=>{f()},[f]);const w=(e,s)=>{u(t=>({...t,[e]:s}))};return l?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"スポンサーバナー管理"}),e.jsx(r,{onClick:()=>h(!0),className:"bg-blue-600 hover:bg-blue-700",children:"新規バナー作成"})]}),b&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:b}),v&&e.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded",children:v}),o&&e.jsxs(c,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:j?"バナー編集":"新規バナー作成"}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),m(!0),N(null);try{const e={...g,start_date:g.start_date||null,end_date:g.end_date||null};if(j){const{error:s}=await i.from("sponsor_banners").update(e).eq("id",j.id);if(s)throw s;y("バナーを更新しました")}else{const{error:s}=await i.from("sponsor_banners").insert([e]);if(s)throw s;y("バナーを作成しました")}h(!1),p(null),u(T),await f()}catch(s){N("バナーの保存に失敗しました")}finally{m(!1)}},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(d,{label:"タイトル",value:g.title,onChange:e=>w("title",e.target.value),required:!0}),e.jsx(d,{label:"Webサイト URL",type:"url",value:g.website_url,onChange:e=>w("website_url",e.target.value),required:!0})]}),e.jsx(I,{label:"バナータイプ",value:g.banner_type,onChange:e=>w("banner_type",e.target.value),options:[{value:"top",label:"トップ"},{value:"footer",label:"フッター"}]}),e.jsx(d,{label:"説明",value:g.description,onChange:e=>w("description",e.target.value),multiline:!0,rows:3}),e.jsx(d,{label:"画像 URL",type:"url",value:g.image_url,onChange:e=>w("image_url",e.target.value)}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(d,{label:"表示順序",type:"number",value:g.display_order,onChange:e=>w("display_order",parseInt(e.target.value)||0),min:"0"}),e.jsx(d,{label:"開始日",type:"date",value:g.start_date,onChange:e=>w("start_date",e.target.value)}),e.jsx(d,{label:"終了日",type:"date",value:g.end_date,onChange:e=>w("end_date",e.target.value)})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:g.is_active,onChange:e=>w("is_active",e.target.checked),className:"rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200"}),e.jsx("label",{htmlFor:"is_active",className:"ml-2 text-sm text-gray-700",children:"アクティブ（表示する）"})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(r,{type:"submit",disabled:x,className:"bg-blue-600 hover:bg-blue-700",children:x?"保存中...":"保存"}),e.jsx(r,{type:"button",onClick:()=>{h(!1),p(null),u(T),N(null)},variant:"outline",children:"キャンセル"})]})]})]}),e.jsx("div",{className:"grid gap-4",children:0===t.length?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"バナーが登録されていません"}):t.map(s=>e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:s.title}),e.jsx("span",{className:"px-2 py-1 rounded-full text-xs "+("top"===s.banner_type?"bg-blue-100 text-blue-800":"footer"===s.banner_type?"bg-teal-100 text-teal-800":""),children:"top"===s.banner_type?"トップ":"footer"===s.banner_type?"フッター":""}),e.jsx("span",{className:"px-2 py-1 rounded-full text-xs "+(s.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:s.is_active?"アクティブ":"非アクティブ"})]}),e.jsx("p",{className:"text-gray-600 mb-2",children:s.description}),e.jsxs("div",{className:"text-sm text-gray-500 space-y-1",children:[e.jsxs("p",{children:["URL: ",e.jsx("a",{href:s.website_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:s.website_url})]}),e.jsxs("p",{children:["表示順: ",s.display_order]}),e.jsxs("p",{children:["クリック数: ",s.click_count," | 表示数: ",s.impression_count]}),s.start_date&&e.jsxs("p",{children:["開始日: ",new Date(s.start_date).toLocaleDateString()]}),s.end_date&&e.jsxs("p",{children:["終了日: ",new Date(s.end_date).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex space-x-2 ml-4",children:[e.jsx(r,{onClick:()=>(async(e,s)=>{try{const{error:t}=await i.from("sponsor_banners").update({is_active:!s}).eq("id",e);if(t)throw t;await f()}catch(t){N("ステータスの更新に失敗しました")}})(s.id,s.is_active),variant:"outline",size:"sm",children:s.is_active?"非アクティブ":"アクティブ"}),e.jsx(r,{onClick:()=>(e=>{p(e),u({title:e.title,description:e.description,image_url:e.image_url,website_url:e.website_url,banner_type:e.banner_type,is_active:e.is_active,display_order:e.display_order,start_date:e.start_date?e.start_date.split("T")[0]:"",end_date:e.end_date?e.end_date.split("T")[0]:""}),h(!0)})(s),variant:"outline",size:"sm",children:"編集"}),e.jsx(r,{onClick:()=>(async e=>{if(confirm("このバナーを削除しますか？"))try{const{error:s}=await i.from("sponsor_banners").delete().eq("id",e);if(s)throw s;y("バナーを削除しました"),await f()}catch(s){N("バナーの削除に失敗しました")}})(s.id),variant:"outline",size:"sm",className:"text-red-600 border-red-600 hover:bg-red-50",children:"削除"})]})]})},s.id))})]})};function J(){const{user:l,isAdmin:d}=n(),x=t(),[h,j]=s.useState("overview"),[p,u]=s.useState({totalUsers:0,totalParks:0,pendingParks:0,pendingVaccines:0,pendingFacilities:0,totalReservations:0,monthlyRevenue:0,lastMonthRevenue:0,totalSubscriptions:0,activeSubscriptions:0,newUsersThisMonth:0,unreadMessages:0}),[b,N]=s.useState(!0),[I,T]=s.useState(""),[J,V]=s.useState(""),[E,$]=s.useState(null),[H,O]=s.useState([]);s.useEffect(()=>{d?(G(),W(),B()):x("/")},[d,x]);const G=async()=>{try{N(!0),T(""),V("");const{data:e,error:s}=await i.rpc("get_admin_stats");if(s)throw s;const t=e;t&&u({totalUsers:t.total_users||0,totalParks:t.total_parks||0,pendingParks:t.pending_parks||0,pendingVaccines:t.pending_vaccines||0,pendingFacilities:t.pending_facilities||0,totalReservations:t.total_reservations||0,monthlyRevenue:t.monthly_revenue||0,lastMonthRevenue:t.last_month_revenue||0,totalSubscriptions:t.total_subscriptions||0,activeSubscriptions:t.active_subscriptions||0,newUsersThisMonth:t.new_users_this_month||0,unreadMessages:t.unread_messages||0})}catch(e){T("管理者データの取得に失敗しました。")}finally{N(!1)}},W=async()=>{try{const{data:e,error:s}=await i.from("information_schema.tables").select("table_name").eq("table_schema","public").eq("table_name","fraud_detection_logs");if(s||!e||0===e.length)return void O([]);const[t]=await Promise.all([D()]);O(t)}catch(e){O([])}},B=async()=>{try{const{data:e,error:s}=await i.from("information_schema.tables").select("table_name").eq("table_schema","public").eq("table_name","fraud_detection_logs");if(s||!e||0===e.length)return void $(null);const t=await U();$(t)}catch(e){$(null)}},Q=()=>0===p.lastMonthRevenue?0:(p.monthlyRevenue-p.lastMonthRevenue)/p.lastMonthRevenue*100;return d?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx(v,{className:"w-8 h-8 text-blue-600 mr-3"}),"管理者ダッシュボード"]}),e.jsx("p",{className:"text-gray-600",children:"システム全体の監視と管理"})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("span",{className:"text-sm text-gray-600",children:["管理者: ",l?.email]})})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[I&&e.jsxs("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4 mb-6",children:[e.jsx(m,{className:"w-5 h-5 inline mr-2"}),I]}),J&&e.jsxs("div",{className:"bg-green-100 border border-green-300 text-green-800 rounded-lg p-4 mb-6",children:[e.jsx(o,{className:"w-5 h-5 inline mr-2"}),J]}),(p.pendingParks>0||p.pendingVaccines>0||p.pendingFacilities>0||(E?.totalHighRiskUsers||0)>0)&&e.jsxs(c,{className:"p-6 mb-6 border-red-200 bg-red-50",children:[e.jsxs("h2",{className:"text-lg font-semibold text-red-900 mb-4 flex items-center",children:[e.jsx(m,{className:"w-6 h-6 text-red-600 mr-2"}),"緊急対応が必要な項目"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[p.pendingParks>0&&e.jsx(a,{to:"/admin/parks",className:"block",children:e.jsx("div",{className:"bg-white rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"承認待ちドッグラン"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:p.pendingParks})]}),e.jsx(y,{className:"w-8 h-8 text-red-500"})]})})}),p.pendingVaccines>0&&e.jsx(a,{to:"/admin/vaccine-approval",className:"block",children:e.jsx("div",{className:"bg-white rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ワクチン証明書承認待ち"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:p.pendingVaccines})]}),e.jsx(g,{className:"w-8 h-8 text-red-500"})]})})}),e.jsx(a,{to:"/admin/facility-approval",className:"block",children:e.jsx("div",{className:"bg-white rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"施設承認管理"}),e.jsx("p",{className:"text-2xl font-bold "+(p.pendingFacilities>0?"text-red-600":"text-green-600"),children:p.pendingFacilities>0?p.pendingFacilities:"0"}),e.jsx("p",{className:"text-xs text-gray-500",children:p.pendingFacilities>0?"件の承認待ち":"承認待ちなし"})]}),e.jsx(y,{className:"w-8 h-8 "+(p.pendingFacilities>0?"text-red-500":"text-green-500")})]})})}),(E?.totalHighRiskUsers||0)>0&&e.jsx(a,{to:"/admin/users?filter=high_risk",className:"block",children:e.jsx("div",{className:"bg-white rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"高リスクユーザー"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:E?.totalHighRiskUsers||0})]}),e.jsx(f,{className:"w-8 h-8 text-red-500"})]})})})]}),H.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-md font-semibold text-red-900 mb-3",children:"最新の高リスクユーザー"}),e.jsx("div",{className:"bg-white rounded-lg overflow-hidden",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"ユーザー"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"リスクスコア"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"検知タイプ"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"最終検知"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"アクション"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:H.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.userName}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("span",{className:"inline-flex items-center px-2 py-1 text-xs font-medium rounded-full "+("high"===s.riskLevel?"bg-red-100 text-red-800":"medium"===s.riskLevel?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:s.riskScore})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"text-sm text-gray-900",children:s.detectionTypes.join(", ")})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"text-sm text-gray-900",children:new Date(s.lastDetection).toLocaleDateString("ja-JP")})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx(a,{to:"/admin/users?filter=high_risk",children:e.jsxs(r,{variant:"secondary",size:"sm",children:[e.jsx(w,{className:"w-4 h-4 mr-1"}),"詳細"]})})})]},s.userId))})]})})]})]}),e.jsx("div",{className:"flex space-x-1 mb-6",children:[{id:"overview",label:"概要",icon:_},{id:"parks",label:"ドッグラン",icon:y,badge:p.pendingParks},{id:"facilities",label:"その他施設",icon:y,badge:p.pendingFacilities},{id:"users",label:"ユーザー",icon:k},{id:"vaccine-approval",label:"ワクチン証明書",icon:g,badge:p.pendingVaccines},{id:"fraud",label:"不正検知",icon:f},{id:"maintenance",label:"メンテナンス",icon:v},{id:"sponsors",label:"スポンサー",icon:S},{id:"inquiries",label:"お問い合わせ",icon:Mail}].map(s=>{const t=s.icon,a=s.badge&&s.badge>0;return e.jsxs("button",{onClick:()=>j(s.id),className:"relative flex items-center px-4 py-2 text-sm font-medium rounded-lg transition-colors "+(h===s.id?"bg-blue-100 text-blue-700":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"),children:[e.jsx(t,{className:"w-4 h-4 mr-2"}),s.label,a&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center shadow-lg border-2 border-white",children:s.badge})]},s.id)})}),"overview"===h&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"総ユーザー数"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:p.totalUsers}),e.jsxs("p",{className:"text-sm text-green-600",children:["今月 +",p.newUsersThisMonth,"人"]})]}),e.jsx(k,{className:"w-8 h-8 text-blue-500"})]})}),e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"総ドッグラン数"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:p.totalParks}),p.pendingParks>0&&e.jsxs("p",{className:"text-sm text-orange-600",children:["承認待ち ",p.pendingParks,"件"]})]}),e.jsx(y,{className:"w-8 h-8 text-green-500"})]})}),e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"月間売上"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:(Y=p.monthlyRevenue,new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY"}).format(Y))}),e.jsxs("p",{className:"text-sm "+(Q()>=0?"text-green-600":"text-red-600"),children:["前月比 ",Q()>=0?"+":"",Q().toFixed(1),"%"]})]}),e.jsx(C,{className:"w-8 h-8 text-yellow-500"})]})}),e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"アクティブサブスクリプション"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:p.activeSubscriptions}),e.jsxs("p",{className:"text-sm text-gray-600",children:["総数 ",p.totalSubscriptions,"件"]})]}),e.jsx(P,{className:"w-8 h-8 text-purple-500"})]})})]}),e.jsxs(c,{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"クイックアクション"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(a,{to:"/admin/users",children:e.jsxs(r,{className:"w-full justify-start",children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"ユーザー管理"]})}),e.jsx(a,{to:"/admin/parks",children:e.jsxs(r,{className:"w-full justify-start",children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"ドッグラン管理"]})}),e.jsx(a,{to:"/admin/sales",children:e.jsxs(r,{className:"w-full justify-start",children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"売上レポート"]})}),e.jsx(a,{to:"/admin/shop",children:e.jsxs(r,{className:"w-full justify-start",children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"ショップ管理"]})})]})]})]}),"fraud"===h&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:[e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"高リスクユーザー"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:E?.totalHighRiskUsers||0})]}),e.jsx(f,{className:"w-8 h-8 text-red-500"})]})}),e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"中リスクユーザー"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:E?.totalMediumRiskUsers||0})]}),e.jsx(m,{className:"w-8 h-8 text-yellow-500"})]})}),e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"最近の検知"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:E?.recentDetections||0}),e.jsx("p",{className:"text-xs text-gray-500",children:"過去30日"})]}),e.jsx(w,{className:"w-8 h-8 text-blue-500"})]})}),e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ブロック済み"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:E?.blockedAttempts||0})]}),e.jsx(g,{className:"w-8 h-8 text-green-500"})]})}),e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"トライアル悪用"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:E?.trialAbuseCount||0})]}),e.jsx(m,{className:"w-8 h-8 text-purple-500"})]})})]}),e.jsxs(c,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"不正検知管理"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 bg-red-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-red-900",children:"高リスクユーザーの監視"}),e.jsx("p",{className:"text-sm text-red-700",children:"リスクスコア70以上のユーザーを定期的に確認し、必要に応じて制限措置を実施してください。"})]}),e.jsx(a,{to:"/admin/users?filter=high_risk",children:e.jsxs(r,{className:"bg-red-600 hover:bg-red-700",children:[e.jsx(f,{className:"w-4 h-4 mr-2"}),"確認する"]})})]}),e.jsxs("div",{className:"flex justify-between items-center p-4 bg-yellow-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-yellow-900",children:"中リスクユーザーの監視"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"リスクスコア50-69のユーザーの動向を監視し、パターンを分析してください。"})]}),e.jsx(a,{to:"/admin/users?filter=medium_risk",children:e.jsxs(r,{variant:"secondary",children:[e.jsx(m,{className:"w-4 h-4 mr-2"}),"確認する"]})})]}),e.jsxs("div",{className:"flex justify-between items-center p-4 bg-blue-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900",children:"全ユーザー管理"}),e.jsx("p",{className:"text-sm text-blue-700",children:"すべてのユーザーの不正検知状況を確認し、総合的な監視を行います。"})]}),e.jsx(a,{to:"/admin/users",children:e.jsxs(r,{variant:"secondary",children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"ユーザー一覧"]})})]})]})]})]}),"sponsors"===h&&e.jsx(z,{}),"inquiries"===h&&e.jsx(A,{}),"facilities"===h&&e.jsx(F,{}),"parks"===h&&e.jsx(L,{}),"vaccine-approval"===h&&e.jsx(M,{}),"users"===h&&e.jsxs(c,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"ユーザー管理"}),e.jsxs("p",{className:"text-gray-600",children:["詳細なユーザー管理は",e.jsx(a,{to:"/admin/users",className:"text-blue-600 hover:text-blue-800 mx-1",children:"ユーザー管理ページ"}),"で行えます。"]})]}),"maintenance"===h&&e.jsx(q,{onError:T,onSuccess:V})]})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs(c,{className:"p-8 text-center",children:[e.jsx(g,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"アクセス拒否"}),e.jsx("p",{className:"text-gray-600",children:"管理者権限が必要です。"})]})});var Y}export{J as AdminDashboard};

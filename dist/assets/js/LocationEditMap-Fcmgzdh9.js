import{j as e}from"./motion-BHsL7Azw.js";import{L as t}from"./external-api-DuTtfpce.js";import{r as s}from"./react-vendor-CMvmJHsS.js";import{g as r}from"./geocoding-C1hQLe8V.js";import{B as a}from"./index-CSTJwaVF.js";import{I as n}from"./Input-524E3-F-.js";import{M as l,x as i}from"./ui-basic-B0S5JnE3.js";const c=({initialAddress:c="",initialLatitude:o,initialLongitude:d,onLocationChange:m,className:u=""})=>{const g=s.useRef(null),x=s.useRef(null),f=s.useRef(null),[p,h]=s.useState(c),[j,y]=s.useState(o||35.6762),[b,v]=s.useState(d||139.6503),[w,N]=s.useState(!0),[C,$]=s.useState(!1),[k,S]=s.useState(""),L=s.useCallback(async()=>{if(g.current)try{const e=new t({apiKey:"AIzaSyC9sxGamDZmdKIz3vP1CWLJORl-QkoWgHg",version:"weekly",libraries:["places","geometry"]});await e.load();const s=new google.maps.Map(g.current,{center:{lat:j,lng:b},zoom:16,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1});x.current=s;const r=new google.maps.Marker({position:{lat:j,lng:b},map:s,draggable:!0,title:"施設の位置（ドラッグして調整可能）",icon:{url:`data:image/svg+xml;charset=UTF-8,${encodeURIComponent('\n            <svg width="32" height="40" viewBox="0 0 32 40" xmlns="http://www.w3.org/2000/svg">\n              <path d="M16 0C7.163 0 0 7.163 0 16c0 16 16 24 16 24s16-8 16-24C32 7.163 24.837 0 16 0z" fill="#EF4444"/>\n              <circle cx="16" cy="16" r="8" fill="white"/>\n              <circle cx="16" cy="16" r="4" fill="#EF4444"/>\n            </svg>\n          ')}`,scaledSize:new google.maps.Size(32,40),anchor:new google.maps.Point(16,40)}});f.current=r,r.addListener("dragend",()=>{const e=r.getPosition();if(e){const t=e.lat(),s=e.lng();y(t),v(s),m(t,s)}}),N(!1)}catch(e){S("地図の読み込みに失敗しました。"),N(!1)}},[j,b,m]),z=s.useCallback(async()=>{if(p.trim()&&x.current&&f.current){$(!0);try{const t=[p.trim(),`〒861-8006 ${p.trim()}`,p.trim().replace(/[－]/g,"-"),p.trim().replace(/(\d+)丁目(\d+)-(\d+)/g,"$1-$2-$3"),p.trim().replace(/(\d+)丁目(\d+)－(\d+)/g,"$1-$2-$3")];let s=null,a=null;for(const n of t)try{if(s=await r(n),s)break}catch(e){a=e}if(s){const e=s.latitude,t=s.longitude,r={lat:e,lng:t};x.current.setCenter(r),x.current.setZoom(16),f.current.setPosition(r),y(e),v(t),m(e,t,s.formatted_address)}else alert(`住所が見つかりませんでした。\n\n入力された住所: ${p}\n\n以下をご確認ください：\n・住所が正確に入力されているか\n・郵便番号が含まれているか\n・全角文字が使用されていないか\n\nもしくは、マーカーを直接ドラッグして位置を調整してください。`)}catch(e){alert(`住所の検索中にエラーが発生しました。\n\nエラー詳細: ${e}\n\nマーカーを直接ドラッグして位置を調整してください。`)}finally{$(!1)}}},[p,m]);s.useEffect(()=>{L()},[L]),s.useEffect(()=>{const e=setTimeout(()=>{(async()=>{if(c&&!o&&!d&&!C&&x.current&&f.current)try{$(!0);const e=await r(c);if(e){const t=e.latitude,s=e.longitude,r={lat:t,lng:s};x.current.setCenter(r),x.current.setZoom(16),f.current.setPosition(r),y(t),v(s),m(t,s,e.formatted_address)}}catch(e){}finally{$(!1)}})()},1e3);return()=>clearTimeout(e)},[c,o,d,C,m]);return k?e.jsx("div",{className:`bg-red-50 border border-red-200 rounded-lg p-4 ${u}`,children:e.jsxs("div",{className:"flex items-center text-red-800",children:[e.jsx(l,{className:"w-5 h-5 mr-2"}),k]})}):e.jsxs("div",{className:`space-y-4 ${u}`,children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"住所で検索"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(n,{value:p,onChange:e=>h(e.target.value),onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),z())},placeholder:"住所を入力してください",className:"flex-1"}),e.jsx(a,{type:"button",onClick:z,disabled:C||!p.trim(),className:"px-4",children:C?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(i,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{ref:g,className:"w-full h-80 rounded-lg border border-gray-300",style:{minHeight:"320px"}}),w&&e.jsx("div",{className:"absolute inset-0 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"地図を読み込み中..."})]})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"現在の座標:"}),e.jsxs("span",{className:"text-gray-600",children:[j.toFixed(6),", ",b.toFixed(6)]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"※ 赤いマーカーをドラッグして位置を調整できます"})]})]})};export{c as L};

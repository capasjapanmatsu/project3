import{j as e}from"./motion-BHsL7Azw.js";import{r as s}from"./react-vendor-CMvmJHsS.js";import{c as t,a,L as r}from"./router-DXQOdrLL.js";import{s as l,B as i,u as d,S as n}from"./index-4WslulxM.js";import{C as c}from"./Card-DqVnP9TA.js";import{I as o}from"./ImageCropper-BVbr3Tw5.js";import{I as m}from"./Input-DXp8CaFq.js";import{L as x}from"./LocationEditMap-pWwzufKD.js";import{G as h,P as u,aJ as g,ax as p,C as b,U as j,j as f,Y as y,a9 as N,Z as v,p as w,u as _,r as S,M as C,aO as k,O as D,_ as q,$ as F}from"./ui-basic-BVqAzqVO.js";import"./heavy-features-Dlg1c9Yc.js";import"./supabase--qivnNSU.js";import"./external-api-DuTtfpce.js";function $({facilityId:t,facilityName:a}){const[r,d]=s.useState([]),[n,m]=s.useState({}),[x,v]=s.useState(!0),[w,_]=s.useState(!1),[S,C]=s.useState(null),[k,D]=s.useState(""),[q,F]=s.useState(""),[$,E]=s.useState({title:"",description:"",service_content:"",discount_type:"amount",start_date:"",end_date:"",usage_limit_type:"once"}),[O,L]=s.useState(!1),[I,T]=s.useState(null),[M,Y]=s.useState(!1),[U,P]=s.useState("");s.useEffect(()=>{z()},[t]);const z=async()=>{try{v(!0);const{data:e,error:s}=await l.from("facility_coupons").select("*").eq("facility_id",t).eq("is_active",!0).order("created_at",{ascending:!1});if(s)throw s;d(e||[]);for(const t of e||[]){const{data:e}=await l.rpc("get_coupon_stats",{coupon_id:t.id});e&&m(s=>({...s,[t.id]:e}))}}catch(e){D("ã‚¯ãƒ¼ãƒãƒ³ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}finally{v(!1)}},J=()=>{E({title:"",description:"",service_content:"",discount_type:"amount",start_date:"",end_date:"",usage_limit_type:"once"}),T(null),P(""),C(null),_(!1)};return x?e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4 mb-4"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-3/4"})]})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center",children:[e.jsx(h,{className:"w-5 h-5 mr-2 text-pink-500"}),"ã‚¯ãƒ¼ãƒãƒ³ç®¡ç†"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"ãŠå®¢æ§˜å‘ã‘ã®ã‚¯ãƒ¼ãƒãƒ³ã‚’ä½œæˆãƒ»ç®¡ç†ã§ãã¾ã™"})]}),e.jsxs(i,{onClick:()=>{_(!0),setTimeout(()=>{window.scrollTo({top:0,behavior:"smooth"})},100)},className:"flex items-center",children:[e.jsx(u,{className:"w-4 h-4 mr-2"}),"ã‚¯ãƒ¼ãƒãƒ³ä½œæˆ"]})]}),k&&e.jsx("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4",children:k}),q&&e.jsx("div",{className:"bg-green-100 border border-green-300 text-green-800 rounded-lg p-4",children:q}),w&&e.jsxs(c,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:S?"ã‚¯ãƒ¼ãƒãƒ³ç·¨é›†":"ã‚¯ãƒ¼ãƒãƒ³ä½œæˆ"}),e.jsx(i,{variant:"secondary",onClick:J,className:"text-sm",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"})]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),L(!0),D("");try{if(!$.title.trim())throw new Error("ã‚¯ãƒ¼ãƒãƒ³ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");if(!$.service_content.trim())throw new Error("ã‚µãƒ¼ãƒ“ã‚¹å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");if(!$.start_date)throw new Error("é–‹å§‹æ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");if(!$.end_date)throw new Error("çµ‚äº†æ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");if("free_gift"!==$.discount_type&&(!$.discount_value||$.discount_value<=0))throw new Error(("amount"===$.discount_type?"å‰²å¼•é‡‘é¡":"å‰²å¼•ç‡")+"ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");const e=new Date($.start_date);if(new Date($.end_date)<=e)throw new Error("çµ‚äº†æ—¥ã¯é–‹å§‹æ—¥ã‚ˆã‚Šå¾Œã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚");let s=S?.coupon_image_url||"";if(I){const e=Date.now(),a=`${t}/${`coupon_${t}_${e}.jpg`}`,{error:r}=await l.storage.from("pet-facility-images").upload(a,I,{contentType:"image/jpeg",upsert:!0});if(r)throw r;const{data:i}=l.storage.from("pet-facility-images").getPublicUrl(a);s=i.publicUrl}const a={facility_id:t,title:$.title.trim(),description:$.description.trim(),service_content:$.service_content.trim(),coupon_image_url:s||null,discount_value:$.discount_value||null,discount_type:$.discount_type,start_date:$.start_date,end_date:$.end_date,usage_limit_type:$.usage_limit_type,max_uses:"once"===$.usage_limit_type?1:null,updated_at:(new Date).toISOString()};if(S){const{error:e}=await l.from("facility_coupons").update(a).eq("id",S.id);if(e)throw e;F("ã‚¯ãƒ¼ãƒãƒ³ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸï¼")}else{const{error:e}=await l.from("facility_coupons").insert(a);if(e)throw e;F("ã‚¯ãƒ¼ãƒãƒ³ãŒä½œæˆã•ã‚Œã¾ã—ãŸï¼")}J(),z()}catch(s){D(s instanceof Error?s.message:"ã‚¯ãƒ¼ãƒãƒ³ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}finally{L(!1)}},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ã‚¯ãƒ¼ãƒãƒ³ã‚¿ã‚¤ãƒˆãƒ« *"}),e.jsx("input",{value:$.title,onChange:e=>E({...$,title:e.target.value}),placeholder:"ä¾‹ï¼šåˆå›åˆ©ç”¨10%OFF",maxLength:100,required:!0,className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"å‰²å¼•è¨­å®š"}),e.jsxs("div",{className:"flex space-x-2 items-center",children:[e.jsxs("select",{value:$.discount_type,onChange:e=>E({...$,discount_type:e.target.value}),className:"border border-gray-300 rounded-md px-3 py-2 text-sm",children:[e.jsx("option",{value:"amount",children:"é‡‘é¡"}),e.jsx("option",{value:"percentage",children:"å‰²å¼•ç‡"}),e.jsx("option",{value:"free_gift",children:"ç„¡æ–™ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ"})]}),"free_gift"!==$.discount_type&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",value:$.discount_value||"",onChange:e=>E({...$,discount_value:e.target.value?parseInt(e.target.value):void 0}),placeholder:"amount"===$.discount_type?"500":"10",className:"w-24 text-lg font-medium text-center border border-gray-300 rounded-md px-3 py-2"}),e.jsx("span",{className:"flex items-center text-lg text-gray-700 font-medium",children:"amount"===$.discount_type?"å††":"%"})]}),"free_gift"===$.discount_type&&e.jsx("span",{className:"text-lg text-green-600 font-medium",children:"ğŸ ç„¡æ–™ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ã‚µãƒ¼ãƒ“ã‚¹å†…å®¹ *"}),e.jsx("textarea",{value:$.service_content,onChange:e=>E({...$,service_content:e.target.value}),placeholder:"ãƒˆãƒªãƒŸãƒ³ã‚°10%OFF",rows:3,className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"è©³ç´°èª¬æ˜"}),e.jsx("textarea",{value:$.description,onChange:e=>E({...$,description:e.target.value}),placeholder:"ãŠã²ã¨ã‚Šæ§˜åˆå›1å›é™å®šã§ã™",rows:3,className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"é–‹å§‹æ—¥æ™‚ *"}),e.jsx("input",{type:"date",value:$.start_date,onChange:e=>E({...$,start_date:e.target.value}),required:!0,className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"çµ‚äº†æ—¥æ™‚ *"}),e.jsx("input",{type:"date",value:$.end_date,onChange:e=>E({...$,end_date:e.target.value}),required:!0,className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ä½¿ç”¨åˆ¶é™"}),e.jsxs("select",{value:$.usage_limit_type,onChange:e=>E({...$,usage_limit_type:e.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",children:[e.jsx("option",{value:"unlimited",children:"ä½•å›ã§ã‚‚"}),e.jsx("option",{value:"once",children:"1å›é™ã‚Š"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ã”ç”¨æ„é ‚ã„ãŸç”»åƒã«ã™ã‚‹å ´åˆã¯ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(i,{type:"button",variant:"secondary",onClick:()=>document.getElementById("coupon-image-input")?.click(),className:"flex items-center",children:[e.jsx(g,{className:"w-4 h-4 mr-2"}),"ç”»åƒã‚’é¸æŠ"]}),U&&e.jsx(i,{type:"button",variant:"outline",onClick:()=>{P(""),T(null);const e={...$};delete e.coupon_image,E(e)},className:"text-red-600 hover:text-red-700",children:"ç”»åƒã‚’å‰Šé™¤"})]}),e.jsx("input",{id:"coupon-image-input",type:"file",accept:"image/*",onChange:e=>{const s=e.target.files?.[0];s&&(e=>{T(e),Y(!0)})(s)},className:"hidden"})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ã‚¯ãƒ¼ãƒãƒ³ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼"}),e.jsx("div",{className:"w-full max-w-sm mx-auto",children:U?e.jsx("div",{className:"aspect-square w-full border-2 border-gray-300 rounded-lg overflow-hidden",children:e.jsx("img",{src:U,alt:"ã‚¯ãƒ¼ãƒãƒ³ç”»åƒ",className:"w-full h-full object-cover"})}):e.jsx("div",{className:"aspect-square w-full border-2 border-gray-300 rounded-lg relative overflow-hidden",children:e.jsxs("div",{className:"w-full h-full bg-gradient-to-br from-red-500 to-red-600 relative",children:[e.jsx("div",{className:"absolute top-1/2 -left-3 w-6 h-6 bg-white rounded-full transform -translate-y-1/2"}),e.jsx("div",{className:"absolute top-1/2 -right-3 w-6 h-6 bg-white rounded-full transform -translate-y-1/2"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-10",children:e.jsx("span",{className:"text-6xl font-bold text-white transform rotate-12",children:"COUPON"})}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-center h-full p-4 text-center space-y-3",children:[e.jsx("div",{className:"bg-white/95 px-3 py-1 rounded-full shadow-sm",children:e.jsx("span",{className:"text-xs font-medium text-red-600",children:"ãƒ‰ãƒƒã‚°ãƒ‘ãƒ¼ã‚¯JPã‚¯ãƒ¼ãƒãƒ³"})}),e.jsx("div",{className:"text-white",children:e.jsx("h2",{className:"text-lg font-bold leading-tight",children:a})}),e.jsx("div",{className:"text-white",children:e.jsx("h3",{className:"text-xl font-bold leading-tight",children:$.title||"ã‚¯ãƒ¼ãƒãƒ³ã‚¿ã‚¤ãƒˆãƒ«"})}),e.jsx("div",{className:"text-white/90",children:e.jsx("p",{className:"text-base leading-tight",children:$.service_content||"ã‚µãƒ¼ãƒ“ã‚¹å†…å®¹"})}),"free_gift"===$.discount_type?e.jsxs("div",{className:"bg-white text-green-600 px-6 py-3 rounded-lg shadow-md",children:[e.jsx("span",{className:"text-4xl font-bold",children:"ğŸ"}),e.jsx("span",{className:"text-lg ml-2 font-medium",children:"ç„¡æ–™ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ"})]}):$.discount_value&&$.discount_type&&e.jsxs("div",{className:"bg-white text-red-600 px-6 py-3 rounded-lg shadow-md",children:[e.jsxs("span",{className:"text-4xl font-bold",children:[$.discount_value,"amount"===$.discount_type?"å††":"%"]}),e.jsx("span",{className:"text-lg ml-2 font-medium",children:"OFF"})]}),e.jsx("div",{className:"border-t border-white/30 pt-2",children:e.jsx("p",{className:"text-sm text-white/80",children:$.description||"è©³ç´°èª¬æ˜"})}),$.start_date&&$.end_date&&e.jsx("div",{className:"border-t border-white/30 pt-2 mt-2",children:e.jsxs("p",{className:"text-xs text-white/90 font-medium",children:["æœ‰åŠ¹æœŸé™: ",new Date($.start_date).toLocaleDateString()," ã€œ ",new Date($.end_date).toLocaleDateString()]})})]})]})})}),e.jsx("div",{className:"mt-2 text-xs text-gray-500 text-center",children:U?"ç”»åƒã‚¯ãƒ¼ãƒãƒ³":"ã‚¯ãƒ¼ãƒãƒ³"})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(i,{type:"button",variant:"secondary",onClick:J,disabled:O,children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),e.jsxs(i,{type:"submit",disabled:O,className:"flex items-center",children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),S?"æ›´æ–°":"ä½œæˆ"]})]})]})]}),e.jsx("div",{className:"space-y-4",children:0===r.length?e.jsxs(c,{className:"p-8 text-center",children:[e.jsx(h,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"ã‚¯ãƒ¼ãƒãƒ³ãŒã‚ã‚Šã¾ã›ã‚“"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"æœ€åˆã®ã‚¯ãƒ¼ãƒãƒ³ã‚’ä½œæˆã—ã¦ãŠå®¢æ§˜ã«ãŠå¾—ãªã‚µãƒ¼ãƒ“ã‚¹ã‚’æä¾›ã—ã¾ã—ã‚‡ã†"}),e.jsxs(i,{onClick:()=>_(!0),children:[e.jsx(u,{className:"w-4 h-4 mr-2"}),"ã‚¯ãƒ¼ãƒãƒ³ä½œæˆ"]})]}):r.map(s=>e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"w-full max-w-sm mx-auto",children:[s.coupon_image_url?e.jsx("div",{className:"aspect-square w-full border-2 border-gray-300 rounded-lg overflow-hidden",children:e.jsx("img",{src:s.coupon_image_url,alt:"ã‚¯ãƒ¼ãƒãƒ³ç”»åƒ",className:"w-full h-full object-cover"})}):e.jsx("div",{className:"aspect-square w-full border-2 border-gray-300 rounded-lg relative overflow-hidden",children:e.jsxs("div",{className:"w-full h-full bg-gradient-to-br from-red-500 to-red-600 relative",children:[e.jsx("div",{className:"absolute top-1/2 -left-3 w-6 h-6 bg-white rounded-full transform -translate-y-1/2"}),e.jsx("div",{className:"absolute top-1/2 -right-3 w-6 h-6 bg-white rounded-full transform -translate-y-1/2"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-10",children:e.jsx("span",{className:"text-6xl font-bold text-white transform rotate-12",children:"COUPON"})}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-center h-full p-4 text-center space-y-3",children:[e.jsx("div",{className:"bg-white/95 px-3 py-1 rounded-full shadow-sm",children:e.jsx("span",{className:"text-xs font-medium text-red-600",children:"ãƒ‰ãƒƒã‚°ãƒ‘ãƒ¼ã‚¯JPã‚¯ãƒ¼ãƒãƒ³"})}),e.jsx("div",{className:"text-white",children:e.jsx("h2",{className:"text-lg font-bold leading-tight",children:a})}),e.jsx("div",{className:"text-white",children:e.jsx("h3",{className:"text-xl font-bold leading-tight",children:s.title})}),e.jsx("div",{className:"text-white/90",children:e.jsx("p",{className:"text-base leading-tight",children:s.service_content})}),s.discount_value&&s.discount_type&&e.jsxs("div",{className:"bg-white text-red-600 px-6 py-3 rounded-lg shadow-md",children:[e.jsxs("span",{className:"text-4xl font-bold",children:[s.discount_value,"amount"===s.discount_type?"å††":"%"]}),e.jsx("span",{className:"text-lg ml-2 font-medium",children:"OFF"})]}),s.description&&e.jsx("div",{className:"border-t border-white/30 pt-2",children:e.jsx("p",{className:"text-sm text-white/80",children:s.description})}),s.start_date&&s.end_date&&e.jsx("div",{className:"border-t border-white/30 pt-2 mt-2",children:e.jsxs("p",{className:"text-xs text-white/90 font-medium",children:["æœ‰åŠ¹æœŸé™: ",new Date(s.start_date).toLocaleDateString()," ã€œ ",new Date(s.end_date).toLocaleDateString()]})})]})]})}),e.jsx("div",{className:"mt-2 text-xs text-gray-500 text-center",children:s.coupon_image_url?"ç”»åƒã‚¯ãƒ¼ãƒãƒ³":"ã‚¯ãƒ¼ãƒãƒ³"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"px-3 py-1 text-sm font-medium rounded-full "+(s.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:s.is_active?"æœ‰åŠ¹":"ç„¡åŠ¹"}),e.jsx("span",{className:"px-3 py-1 text-sm font-medium rounded-full bg-blue-100 text-blue-800",children:"once"===s.usage_limit_type?"1å›é™ã‚Š":"ä½•å›ã§ã‚‚"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"æœŸé–“ï¼š"}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(b,{className:"w-4 h-4 mr-1 text-gray-400"}),new Date(s.start_date).toLocaleDateString()," ã€œ",new Date(s.end_date).toLocaleDateString()]})]}),n[s.id]&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"å–å¾—æ•°ï¼š"}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(j,{className:"w-4 h-4 mr-1 text-gray-400"}),n[s.id].total_obtained,"äºº"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"ä½¿ç”¨æ•°ï¼š"}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(h,{className:"w-4 h-4 mr-1 text-gray-400"}),n[s.id].total_used,"å›"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"ä½¿ç”¨ç‡ï¼š"}),e.jsxs("div",{className:"font-medium text-sm",children:[n[s.id].usage_rate,"%"]})]})]})]}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs(i,{variant:"secondary",onClick:()=>(e=>{C(e),E({title:e.title||"",description:e.description||"",service_content:e.service_content||"",discount_value:e.discount_value||0,discount_type:e.discount_type||"percentage",start_date:e.start_date?e.start_date.split("T")[0]:"",end_date:e.end_date?e.end_date.split("T")[0]:"",usage_limit_type:e.usage_limit_type||"unlimited"}),P(e.coupon_image_url||""),_(!0),setTimeout(()=>{window.scrollTo({top:0,behavior:"smooth"})},100)})(s),className:"w-full",children:[e.jsx(f,{className:"w-4 h-4 mr-2"}),"ç·¨é›†"]}),e.jsx(i,{variant:s.is_active?"secondary":"primary",onClick:()=>(async e=>{try{const{error:s}=await l.from("facility_coupons").update({is_active:!e.is_active}).eq("id",e.id);if(s)throw s;F(e.is_active?"ã‚¯ãƒ¼ãƒãƒ³ã‚’ç„¡åŠ¹åŒ–ã—ã¾ã—ãŸã€‚":"ã‚¯ãƒ¼ãƒãƒ³ã‚’æœ‰åŠ¹åŒ–ã—ã¾ã—ãŸã€‚"),z()}catch(s){D("ã‚¯ãƒ¼ãƒãƒ³ã®çŠ¶æ…‹å¤‰æ›´ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}})(s),className:"w-full",children:s.is_active?"ç„¡åŠ¹åŒ–":"æœ‰åŠ¹åŒ–"}),e.jsxs(i,{variant:"danger",onClick:()=>(async e=>{if(window.confirm("ã“ã®ã‚¯ãƒ¼ãƒãƒ³ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚"))try{const{error:s}=await l.from("facility_coupons").delete().eq("id",e);if(s)throw s;F("ã‚¯ãƒ¼ãƒãƒ³ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚"),z()}catch(s){D("ã‚¯ãƒ¼ãƒãƒ³ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}})(s.id),className:"w-full",children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"å‰Šé™¤"]})]})]})]})},s.id))}),e.jsx(c,{className:"mt-6",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(N,{className:"w-5 h-5 mr-2 text-blue-600"}),"ã‚¯ãƒ¼ãƒãƒ³ã«ã¤ã„ã¦"]}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-700",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-2",children:"ğŸ“± ã‚¯ãƒ¼ãƒãƒ³ã®è¡¨ç¤ºæ–¹æ³•"}),e.jsx("p",{className:"text-blue-700",children:"ã‚¯ãƒ¼ãƒãƒ³ã¯ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã€ãŠå®¢æ§˜ãŒåº—èˆ—ã§æç¤ºã—ã¾ã™ã€‚"})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-yellow-800 mb-2",children:"ğŸ”’ 1å›é™ã‚Šã‚¯ãƒ¼ãƒãƒ³ã®ä»•çµ„ã¿"}),e.jsx("p",{className:"text-yellow-700 mb-2",children:"ã€ŒãŠã²ã¨ã‚Šæ§˜1å›é™ã‚Šã€ã®ã‚¯ãƒ¼ãƒãƒ³ã¯ã€1ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¤ã1å›ã®ã¿å–å¾—å¯èƒ½ã§ã™ã€‚"}),e.jsx("p",{className:"text-yellow-700 mb-2",children:"â€¢ ãŠå®¢æ§˜ãŒã‚¯ãƒ¼ãƒãƒ³ã‚’è¡¨ç¤ºã—ãŸæ®µéšã§è‡ªå‹•å‰Šé™¤ã•ã‚Œã¾ã™"}),e.jsx("p",{className:"text-yellow-700",children:"â€¢ 2å›ç›®ä»¥é™ã¯ä½¿ç”¨ã§ããªããªã‚Šã€å†è¡¨ç¤ºã‚‚ã§ãã¾ã›ã‚“"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-green-800 mb-2",children:"â™»ï¸ ä½•å›ã§ã‚‚ã‚¯ãƒ¼ãƒãƒ³ã®ä»•çµ„ã¿"}),e.jsx("p",{className:"text-green-700 mb-2",children:"ã€Œä½•å›ã§ã‚‚ã€ã®ã‚¯ãƒ¼ãƒãƒ³ã¯ã€æœ‰åŠ¹æœŸé™å†…ã§ã‚ã‚Œã°ä½•åº¦ã§ã‚‚ä½¿ç”¨å¯èƒ½ã§ã™ã€‚"}),e.jsx("p",{className:"text-green-700",children:"â€¢ åŒã˜ãŠå®¢æ§˜ãŒè¤‡æ•°å›åˆ©ç”¨ã§ãã¾ã™ï¼ˆæœŸé™å†…ï¼‰"})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"â° æœ‰åŠ¹æœŸé™ã«ã¤ã„ã¦"}),e.jsx("p",{className:"text-gray-700",children:"è¨­å®šã—ãŸæœ‰åŠ¹æœŸé™ã‚’éãã‚‹ã¨ã€ã‚¯ãƒ¼ãƒãƒ³ã¯è‡ªå‹•çš„ã«ç„¡åŠ¹ã«ãªã‚Šã¾ã™ã€‚"})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-purple-800 mb-2",children:"ğŸ”„ ã‚¯ãƒ¼ãƒãƒ³ç·¨é›†æ™‚ã®å†å–å¾—æ©Ÿèƒ½"}),e.jsx("p",{className:"text-purple-700 mb-2",children:"åº—èˆ—ãŒã‚¯ãƒ¼ãƒãƒ³ã‚’ç·¨é›†ï¼ˆæœ‰åŠ¹æœŸé™å»¶é•·ãªã©ï¼‰ã—ãŸå ´åˆã€æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ã—ã¦ä½œæˆã•ã‚Œã¾ã™ã€‚"}),e.jsxs("p",{className:"text-purple-700 mb-2",children:["â€¢ ",e.jsx("strong",{children:"1å›é™ã‚Šã‚¯ãƒ¼ãƒãƒ³ã‚’ä½¿ç”¨æ¸ˆã¿"}),"ã®ãŠå®¢æ§˜ã‚‚ã€ç·¨é›†å¾Œã¯",e.jsx("strong",{children:"æ–°ã—ã„ã‚¯ãƒ¼ãƒãƒ³ã¨ã—ã¦å†å–å¾—å¯èƒ½"}),"ã«ãªã‚Šã¾ã™"]}),e.jsx("p",{className:"text-purple-700 mb-2",children:"â€¢ ç·¨é›†å‰ã®å¤ã„ã‚¯ãƒ¼ãƒãƒ³ã¯è‡ªå‹•çš„ã«ç„¡åŠ¹åŒ–ã•ã‚Œã€æ–°ã—ã„ã‚¯ãƒ¼ãƒãƒ³IDãŒç”Ÿæˆã•ã‚Œã¾ã™"}),e.jsx("p",{className:"text-purple-700",children:"â€¢ ã“ã‚Œã«ã‚ˆã‚Šã€æœ‰åŠ¹æœŸé™å»¶é•·ãªã©ã®éš›ã«ãŠå®¢æ§˜ãŒä¸åˆ©ç›Šã‚’è¢«ã‚‹ã“ã¨ãªãã€ç¶™ç¶šã—ã¦ã‚¯ãƒ¼ãƒãƒ³ã‚’ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™"})]})]})]})}),M&&I&&e.jsx(o,{imageFile:I,onCropComplete:e=>{const s=URL.createObjectURL(e);P(s),E({...$,coupon_image:e}),T(e),Y(!1)},onCancel:()=>Y(!1),aspectRatio:1})]})}const E={pet_hotel:"ãƒšãƒƒãƒˆãƒ›ãƒ†ãƒ«",pet_salon:"ãƒšãƒƒãƒˆã‚µãƒ­ãƒ³",veterinary:"å‹•ç‰©ç—…é™¢",pet_cafe:"ãƒšãƒƒãƒˆã‚«ãƒ•ã‚§",pet_restaurant:"ãƒšãƒƒãƒˆåŒä¼´ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³",pet_shop:"ãƒšãƒƒãƒˆã‚·ãƒ§ãƒƒãƒ—",pet_accommodation:"ãƒšãƒƒãƒˆåŒä¼´å®¿æ³Š",dog_training:"ã—ã¤ã‘æ•™å®¤",pet_friendly_other:"ãã®ä»–ãƒ¯ãƒ³ã¡ã‚ƒã‚“åŒä¼´å¯èƒ½æ–½è¨­"};function O(){const{id:j}=t(),{user:N}=d(),O=a(),[L,I]=s.useState(null),[T,M]=s.useState([]),[Y,U]=s.useState(!0),[P,z]=s.useState(!1),[J,R]=s.useState(""),[A,B]=s.useState(""),[G,H]=s.useState(!1),[W,Z]=s.useState(""),[K,Q]=s.useState(!1),[V,X]=s.useState([]),[ee,se]=s.useState(!1),[te,ae]=s.useState(null),[re,le]=s.useState(null),[ie,de]=s.useState(!1),[ne,ce]=s.useState({name:"",category_id:"",address:"",phone:"",website:"",description:"",latitude:null,longitude:null}),[oe,me]=s.useState("info"),[xe,he]=s.useState([!1,!1,!1,!1,!1,!1,!1]),[ue,ge]=s.useState("09:00"),[pe,be]=s.useState("18:00"),[je,fe]=s.useState([]),[ye,Ne]=s.useState(new Date);s.useEffect(()=>{N&&j?ve():O("/my-facilities-management")},[N,j,O]);const ve=async()=>{try{U(!0);const{data:s,error:t}=await l.from("pet_facilities").select("*").eq("id",j).eq("owner_id",N?.id).single();if(t)throw t;if(!s)return void O("/my-facilities-management");if(I(s),ce({name:s.name||"",category_id:s.category_id||"",address:s.address||"",phone:s.phone||"",website:s.website||"",description:s.description||"",latitude:s.latitude||null,longitude:s.longitude||null}),s.opening_time&&ge(s.opening_time),s.closing_time&&be(s.closing_time),s.weekly_closed_days)try{const e=JSON.parse(s.weekly_closed_days);Array.isArray(e)&&7===e.length&&he(e)}catch(e){}if(s.specific_closed_dates)try{const e=JSON.parse(s.specific_closed_dates);Array.isArray(e)&&fe(e)}catch(e){}s.identity_document_url;const{data:a,error:r}=await l.from("pet_facility_images").select("*").eq("facility_id",j).order("display_order",{ascending:!0});if(r)throw r;X(a||[]);const{data:i,error:d}=await l.from("facility_categories").select("*").order("name");if(d)throw d;M(i||[]),U(!1)}catch(s){R("æ–½è¨­ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚"),U(!1)}},we=(e,s)=>{const t=e.target.files?.[0];t&&(t.type.startsWith("image/")?t.size>10485760?R("ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã¯10MBæœªæº€ã«ã—ã¦ãã ã•ã„ã€‚"):(ae(t),le(s??null),se(!0)):R("ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚"))},_e=async e=>{if(window.confirm("ã“ã®ç”»åƒã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ"))try{R("");const{error:s}=await l.from("pet_facility_images").delete().eq("id",e);if(s)throw s;X(s=>s.filter(s=>s.id!==e));const t=V.filter(s=>s.id!==e);for(let e=0;e<t.length;e++){const s=0===e?"main":"additional";t[e].display_order===e&&t[e].image_type===s||await l.from("pet_facility_images").update({display_order:e,image_type:s}).eq("id",t[e].id)}B("ç”»åƒãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚"),ve(),setTimeout(()=>B(""),3e3)}catch(s){R("ç”»åƒã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}},Se=e=>{const{name:s,value:t}=e.target;ce(e=>({...e,[s]:t}))},Ce=async e=>{if(e.preventDefault(),L&&N){z(!0),R(""),B("");try{if(!ne.name.trim())throw new Error("æ–½è¨­åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");if(!ne.category_id)throw new Error("ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");if(!ne.address.trim())throw new Error("ä½æ‰€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");if(!ne.phone.trim())throw new Error("é›»è©±ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");const{error:e}=await l.from("pet_facilities").update({name:ne.name.trim(),category_id:ne.category_id,address:ne.address.trim(),phone:ne.phone.trim(),website:ne.website.trim()||null,description:ne.description.trim()||null,latitude:ne.latitude,longitude:ne.longitude,updated_at:(new Date).toISOString()}).eq("id",L.id);if(e)throw e;B("æ–½è¨­æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚"),await ve(),setTimeout(()=>{B("")},3e3)}catch(s){R(s instanceof Error?s.message:"æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}finally{z(!1)}}};if(Y)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(!L)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"æ–½è¨­ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"}),e.jsx(r,{to:"/my-facilities-management",children:e.jsx(i,{children:"ç®¡ç†ç”»é¢ã«æˆ»ã‚‹"})})]})});return e.jsxs(e.Fragment,{children:[e.jsx(n,{title:`${L.name} - æ–½è¨­ç·¨é›†`,description:"ãƒšãƒƒãƒˆé–¢é€£æ–½è¨­ã®æƒ…å ±ã‚’ç·¨é›†ãƒ»ç®¡ç†ã—ã¾ã™ã€‚"}),e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-4",children:e.jsxs(r,{to:"/my-facilities-management",className:"flex items-center text-blue-600 hover:text-blue-800",children:[e.jsx(v,{className:"w-4 h-4 mr-2"}),"æ–½è¨­ç®¡ç†ä¸€è¦§ã«æˆ»ã‚‹"]})})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"bg-white rounded-lg border p-6 mb-6",children:e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:L.name}),e.jsx("p",{className:"text-gray-600 mt-1",children:L.address}),e.jsx("div",{className:"flex items-center mt-2",children:(s=>{switch(s){case"approved":return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold bg-green-100 text-green-800 rounded-full",children:"æ‰¿èªæ¸ˆã¿"});case"pending":return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold bg-yellow-100 text-yellow-800 rounded-full",children:"å¯©æŸ»ä¸­"});case"rejected":return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold bg-red-100 text-red-800 rounded-full",children:"å´ä¸‹"});default:return e.jsx("span",{className:"px-2 py-1 text-xs font-semibold bg-gray-100 text-gray-800 rounded-full",children:"ä¸æ˜"})}})(L.status)})]}),e.jsx("div",{className:"flex space-x-3",children:"approved"===L.status&&e.jsx(r,{to:`/parks?view=facilities&facility=${L.id}`,children:e.jsxs(i,{variant:"secondary",className:"min-w-[100px]",children:[e.jsx(f,{className:"w-4 h-4 mr-2"}),"å…¬é–‹ãƒšãƒ¼ã‚¸"]})})})]})}),J&&e.jsxs("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4 mb-6",children:[e.jsx(w,{className:"w-5 h-5 inline mr-2"}),J]}),A&&e.jsxs("div",{className:"bg-green-100 border border-green-300 text-green-800 rounded-lg p-4 mb-6",children:[e.jsx(_,{className:"w-5 h-5 inline mr-2"}),A]}),e.jsxs("div",{className:"bg-white rounded-lg border mb-6",children:[e.jsx("div",{className:"border-b",children:e.jsxs("nav",{className:"flex space-x-8 px-6",children:[e.jsxs("button",{onClick:()=>me("info"),className:"py-4 px-2 border-b-2 font-medium text-sm "+("info"===oe?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx(S,{className:"w-4 h-4 inline mr-2"}),"åŸºæœ¬æƒ…å ±"]}),e.jsxs("button",{onClick:()=>me("images"),className:"py-4 px-2 border-b-2 font-medium text-sm "+("images"===oe?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx(g,{className:"w-4 h-4 inline mr-2"}),"ç”»åƒç®¡ç†"]}),e.jsxs("button",{onClick:()=>me("coupons"),className:"py-4 px-2 border-b-2 font-medium text-sm "+("coupons"===oe?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx(h,{className:"w-4 h-4 inline mr-2"}),"ã‚¯ãƒ¼ãƒãƒ³ç®¡ç†"]}),e.jsxs("button",{onClick:()=>me("schedule"),className:"py-4 px-2 border-b-2 font-medium text-sm "+("schedule"===oe?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx(b,{className:"w-4 h-4 inline mr-2"}),"å–¶æ¥­æ—¥ç®¡ç†"]}),e.jsxs("button",{onClick:()=>me("location"),className:"py-4 px-2 border-b-2 font-medium text-sm "+("location"===oe?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx(C,{className:"w-4 h-4 inline mr-2"}),"ä½ç½®èª¿æ•´"]})]})}),e.jsxs("div",{className:"p-6",children:["info"===oe&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[e.jsx(S,{className:"w-6 h-6 text-blue-600 mr-2"}),"æ–½è¨­æƒ…å ±ã®ç·¨é›†"]}),e.jsxs("form",{onSubmit:Ce,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"æ–½è¨­å *"}),e.jsx(m,{name:"name",value:ne.name,onChange:Se,placeholder:"æ–½è¨­åã‚’å…¥åŠ›",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ã‚«ãƒ†ã‚´ãƒª *"}),e.jsxs("select",{name:"category_id",value:ne.category_id,onChange:Se,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠ"}),T.map(s=>e.jsx("option",{value:s.id,children:E[s.name]||s.name},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ä½æ‰€ *"}),e.jsx(m,{name:"address",value:ne.address,onChange:Se,placeholder:"ä½æ‰€ã‚’å…¥åŠ›",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"é›»è©±ç•ªå·"}),e.jsx(m,{name:"phone",value:ne.phone,onChange:Se,placeholder:"é›»è©±ç•ªå·ã‚’å…¥åŠ›",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆ"}),e.jsx(m,{name:"website",value:ne.website,onChange:Se,placeholder:"https://example.com"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"æ–½è¨­èª¬æ˜"}),e.jsx("textarea",{name:"description",value:ne.description,onChange:Se,rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"æ–½è¨­ã®ç‰¹å¾´ã‚„ã‚µãƒ¼ãƒ“ã‚¹å†…å®¹ã‚’å…¥åŠ›"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"æ–½è¨­ç”»åƒ (æœ€å¤§5æš)"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"1æšç›®ãŒãƒ¡ã‚¤ãƒ³ç”»åƒã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚æ–½è¨­ã®é›°å›²æ°—ãŒã‚ã‹ã‚‹ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 mb-4",children:[V.map((s,t)=>e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"aspect-square bg-gray-100 rounded-lg overflow-hidden border-2 border-gray-200",children:e.jsx("img",{src:s.image_url,alt:`æ–½è¨­ç”»åƒ ${t+1}`,className:"w-full h-full object-cover"})}),e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx("span",{className:"bg-blue-600 text-white text-xs font-medium px-2 py-1 rounded",children:0===t?"ãƒ¡ã‚¤ãƒ³":t+1})}),e.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:e=>we(e,t),className:"hidden",id:`image-replace-${t}`}),e.jsx("label",{htmlFor:`image-replace-${t}`,className:"bg-white text-gray-600 p-1 rounded shadow hover:bg-gray-50 cursor-pointer",title:"ç”»åƒã‚’å¤‰æ›´",children:e.jsx(g,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:()=>_e(s.id),className:"bg-red-500 text-white p-1 rounded shadow hover:bg-red-600",title:"ç”»åƒã‚’å‰Šé™¤",children:e.jsx(y,{className:"w-4 h-4"})})]})})]},s.id)),V.length<5&&e.jsxs("div",{className:"aspect-square bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center hover:border-blue-400 hover:bg-blue-50 transition-colors",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:e=>we(e),className:"hidden",id:"image-add"}),e.jsxs("label",{htmlFor:"image-add",className:"flex flex-col items-center cursor-pointer text-gray-500 hover:text-blue-600",children:[e.jsx(u,{className:"w-8 h-8 mb-2"}),e.jsx("span",{className:"text-sm font-medium",children:"ç”»åƒã‚’è¿½åŠ "})]})]})]}),0===V.length&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(k,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),e.jsx("p",{className:"text-sm",children:"ã¾ã ç”»åƒãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“"}),e.jsx("p",{className:"text-xs mt-1",children:"æœ€åˆã®ç”»åƒãŒãƒ¡ã‚¤ãƒ³ç”»åƒã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¾ã™"})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(i,{type:"submit",isLoading:P,children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"æ›´æ–°"]})})]})]}),"images"===oe&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[e.jsx(g,{className:"w-6 h-6 text-blue-600 mr-2"}),"æ–½è¨­ç”»åƒã®ç®¡ç†"]}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"æ–½è¨­ã®ç”»åƒã‚’ç®¡ç†ã—ã¾ã™ã€‚æœ€å¤§5æšã¾ã§ç™»éŒ²ã§ãã€æœ€åˆã®ç”»åƒãŒãƒ¡ã‚¤ãƒ³ç”»åƒã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 mb-4",children:[V.map((s,t)=>e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"aspect-square bg-gray-100 rounded-lg overflow-hidden border-2 border-gray-200",children:e.jsx("img",{src:s.image_url,alt:`æ–½è¨­ç”»åƒ ${t+1}`,className:"w-full h-full object-cover"})}),e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx("span",{className:"bg-blue-600 text-white text-xs font-medium px-2 py-1 rounded",children:0===t?"ãƒ¡ã‚¤ãƒ³":t+1})}),e.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:e=>we(e,t),className:"hidden",id:`image-replace-${t}`}),e.jsx("label",{htmlFor:`image-replace-${t}`,className:"bg-white text-gray-600 p-1 rounded shadow hover:bg-gray-50 cursor-pointer",title:"ç”»åƒã‚’å¤‰æ›´",children:e.jsx(g,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:()=>_e(s.id),className:"bg-red-500 text-white p-1 rounded shadow hover:bg-red-600",title:"ç”»åƒã‚’å‰Šé™¤",children:e.jsx(y,{className:"w-4 h-4"})})]})})]},s.id)),V.length<5&&e.jsxs("div",{className:"aspect-square bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center hover:border-blue-400 hover:bg-blue-50 transition-colors",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:e=>we(e),className:"hidden",id:"image-add"}),e.jsxs("label",{htmlFor:"image-add",className:"flex flex-col items-center cursor-pointer text-gray-500 hover:text-blue-600",children:[e.jsx(u,{className:"w-8 h-8 mb-2"}),e.jsx("span",{className:"text-sm font-medium",children:"ç”»åƒã‚’è¿½åŠ "})]})]})]}),0===V.length&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(k,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),e.jsx("p",{className:"text-sm",children:"ã¾ã ç”»åƒãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“"}),e.jsx("p",{className:"text-xs mt-1",children:"æœ€åˆã®ç”»åƒãŒãƒ¡ã‚¤ãƒ³ç”»åƒã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¾ã™"})]})]}),"coupons"===oe&&L&&e.jsx("div",{children:e.jsx($,{facilityId:L.id,facilityName:L.name})}),"schedule"===oe&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[e.jsx(b,{className:"w-6 h-6 text-blue-600 mr-2"}),"å–¶æ¥­æ—¥ç®¡ç†"]}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"æ–½è¨­ã®å–¶æ¥­æ™‚é–“ã¨ä¼‘æ¥­æ—¥ã‚’è¨­å®šã§ãã¾ã™ã€‚"})]}),e.jsxs(c,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(D,{className:"w-5 h-5 text-green-600 mr-2"}),"å–¶æ¥­æ™‚é–“"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"é–‹åº—æ™‚é–“"}),e.jsx("input",{type:"time",value:ue,onChange:e=>ge(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"é–‰åº—æ™‚é–“"}),e.jsx("input",{type:"time",value:pe,onChange:e=>be(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs(c,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(b,{className:"w-5 h-5 text-red-600 mr-2"}),"å®šä¼‘æ—¥è¨­å®š"]}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"æ¯é€±ã®å®šä¼‘æ—¥ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚é¸æŠã—ãŸæ›œæ—¥ã¯è‡ªå‹•çš„ã«ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã§ã‚‚ä¼‘æ¥­æ—¥ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚"}),e.jsx("div",{className:"grid grid-cols-7 gap-2",children:["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"].map((s,t)=>e.jsxs("button",{onClick:()=>{const e=[...xe];e[t]=!e[t],he(e)},className:"py-3 px-2 text-sm font-medium rounded-lg border-2 transition-colors "+(xe[t]?"bg-red-100 border-red-300 text-red-700":"bg-gray-50 border-gray-200 text-gray-700 hover:bg-gray-100"),children:[s,xe[t]&&e.jsx("div",{className:"text-xs mt-1",children:"å®šä¼‘æ—¥"})]},t))})]}),e.jsxs(c,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(b,{className:"w-5 h-5 text-blue-600 mr-2"}),"ä¼‘æ¥­æ—¥ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼"]}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"ç‰¹å®šã®æ—¥ä»˜ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è‡¨æ™‚ä¼‘æ¥­æ—¥ã‚’è¨­å®šã§ãã¾ã™ã€‚å®šä¼‘æ—¥è¨­å®šã§é¸æŠã—ãŸæ›œæ—¥ã¯è‡ªå‹•çš„ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚"}),(()=>{const s=[];for(let e=0;e<3;e++){const t=new Date(ye.getFullYear(),ye.getMonth()+e,1),a=new Date(t.getFullYear(),t.getMonth(),1),r=new Date(t.getFullYear(),t.getMonth()+1,0).getDate(),l=a.getDay(),i=[];for(let e=0;e<l;e++)i.push(null);for(let e=1;e<=r;e++)i.push(new Date(t.getFullYear(),t.getMonth(),e));const d=[];for(let e=0;e<i.length;e+=7)d.push(i.slice(e,e+7));s.push({month:t,rows:d})}return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(i,{onClick:()=>Ne(new Date(ye.getFullYear(),ye.getMonth()-1,1)),variant:"outline",size:"sm",children:[e.jsx(q,{className:"w-4 h-4"}),"å‰æœˆ"]}),e.jsxs("span",{className:"text-lg font-semibold",children:[ye.getFullYear(),"å¹´",ye.getMonth()+1,"æœˆã‹ã‚‰",3,"ã‹æœˆåˆ†"]}),e.jsxs(i,{onClick:()=>Ne(new Date(ye.getFullYear(),ye.getMonth()+1,1)),variant:"outline",size:"sm",children:["æ¬¡æœˆ",e.jsx(F,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:s.map((s,t)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-center font-semibold mb-4",children:[s.month.getFullYear(),"å¹´",s.month.getMonth()+1,"æœˆ"]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 mb-2",children:["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"].map((s,t)=>e.jsx("div",{className:"text-center text-xs font-medium py-1 "+(0===t?"text-red-500":6===t?"text-blue-500":"text-gray-600"),children:s},s))}),e.jsx("div",{className:"space-y-1",children:s.rows.map((s,a)=>e.jsx("div",{className:"grid grid-cols-7 gap-1",children:s.map((s,r)=>{if(!s)return e.jsx("div",{className:"h-8"},`empty-${t}-${a}-${r}`);const l=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`,i=s.getDay(),d=xe[i],n=je.includes(l),c=(new Date).toDateString()===s.toDateString(),o=s<new Date((new Date).setHours(0,0,0,0));return e.jsx("button",{onClick:()=>{o||fe(n?e=>e.filter(e=>e!==l):e=>[...e,l])},disabled:o,className:"h-8 text-xs rounded transition-colors "+(o?"text-gray-300 cursor-not-allowed":d&&n?"bg-purple-100 border-purple-300 text-purple-700 border":d?"bg-red-100 border-red-300 text-red-700 border":n?"bg-orange-100 border-orange-300 text-orange-700 border":c?"bg-blue-100 border-blue-300 text-blue-700 border font-bold":"bg-gray-50 border-gray-200 text-gray-700 hover:bg-gray-100 border"),children:s.getDate()},l)})},a))})]},t))}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-red-100 border border-red-300 rounded"}),e.jsx("span",{children:"å®šä¼‘æ—¥"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-orange-100 border border-orange-300 rounded"}),e.jsx("span",{children:"ç‰¹å®šä¼‘æ¥­æ—¥"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-purple-100 border border-purple-300 rounded"}),e.jsx("span",{children:"å®šä¼‘æ—¥+ç‰¹å®šä¼‘æ¥­æ—¥"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-blue-100 border border-blue-300 rounded"}),e.jsx("span",{children:"ä»Šæ—¥"})]})]})]})})()]}),e.jsx("div",{className:"flex justify-end space-x-3",children:e.jsxs(i,{onClick:async()=>{if(L)try{z(!0),R(""),B("");const{error:e}=await l.from("pet_facilities").update({opening_time:ue,closing_time:pe,updated_at:(new Date).toISOString()}).eq("id",L.id);if(e)throw e;const{error:s}=await l.from("pet_facilities").update({weekly_closed_days:JSON.stringify(xe),specific_closed_dates:JSON.stringify(je),updated_at:(new Date).toISOString()}).eq("id",L.id);if(s)throw s;B("å–¶æ¥­æ—¥è¨­å®šãŒä¿å­˜ã•ã‚Œã¾ã—ãŸã€‚"),setTimeout(()=>B(""),3e3)}catch(e){R(e instanceof Error?e.message:"å–¶æ¥­æ—¥è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}finally{z(!1)}},className:"bg-green-600 hover:bg-green-700",children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"å–¶æ¥­æ—¥è¨­å®šã‚’ä¿å­˜"]})})]}),"location"===oe&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[e.jsx(C,{className:"w-6 h-6 text-blue-600 mr-2"}),"æ–½è¨­ã®ä½ç½®èª¿æ•´"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-blue-800 text-sm",children:[e.jsx("strong",{children:"ä½ç½®èª¿æ•´ã«ã¤ã„ã¦:"}),e.jsx("br",{}),"ä½æ‰€ã‹ã‚‰è‡ªå‹•çš„ã«ãƒãƒƒãƒ—ä¸Šã®ä½ç½®ã‚’ç‰¹å®šã—ã¾ã™ãŒã€æ­£ç¢ºã§ãªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚",e.jsx("br",{}),"èµ¤ã„ãƒãƒ¼ã‚«ãƒ¼ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã€å®Ÿéš›ã®æ–½è¨­ä½ç½®ã«èª¿æ•´ã—ã¦ãã ã•ã„ã€‚"]})}),e.jsx(x,{initialAddress:ne.address,initialLatitude:ne.latitude||void 0,initialLongitude:ne.longitude||void 0,onLocationChange:(e,s,t)=>{ce(a=>({...a,latitude:e,longitude:s,...t&&t!==a.address?{address:t}:{}}))}}),e.jsx("div",{className:"flex justify-end",children:e.jsx(i,{type:"button",onClick:Ce,disabled:P||!ne.latitude||!ne.longitude,className:"min-w-[120px]",children:P?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"ä¿å­˜ä¸­..."]}):"ä½ç½®ã‚’ä¿å­˜"})})]})]})]})]}),"info"===oe&&e.jsx(c,{className:"p-6 border-red-200 bg-red-50",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(y,{className:"w-6 h-6 text-red-600 mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-red-900 mb-2",children:"å±é™ºãªæ“ä½œ"}),e.jsxs("p",{className:"text-sm text-red-800 mb-4",children:["ã“ã®æ–½è¨­ã‚’å®Œå…¨ã«å‰Šé™¤ã—ã¾ã™ã€‚å‰Šé™¤å¾Œã¯ãƒ‡ãƒ¼ã‚¿ã®å¾©æ—§ã¯ã§ãã¾ã›ã‚“ã€‚","approved"===L.status&&e.jsx("span",{className:"block mt-1 font-medium",children:"â€» æ‰¿èªæ¸ˆã¿ã®æ–½è¨­ã‚’å‰Šé™¤ã™ã‚‹ã¨ã€å…¬é–‹ãƒšãƒ¼ã‚¸ã‹ã‚‰ã‚‚å‰Šé™¤ã•ã‚Œã¾ã™ã€‚"})]}),e.jsxs(i,{onClick:()=>H(!0),className:"bg-red-600 hover:bg-red-700 text-white",size:"sm",children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"æ–½è¨­ã‚’å‰Šé™¤"]})]})]})}),G&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(y,{className:"w-6 h-6 text-red-600 mr-3"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"æ–½è¨­ã®å‰Šé™¤ç¢ºèª"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[e.jsx("span",{className:"font-medium text-red-600",children:"è­¦å‘Š:"})," ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚"]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["å‰Šé™¤ã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯ã€æ–½è¨­åã€Œ",e.jsx("span",{className:"font-medium",children:L.name}),"ã€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"]}),e.jsx("input",{type:"text",value:W,onChange:e=>Z(e.target.value),placeholder:"æ–½è¨­åã‚’å…¥åŠ›",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500"})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(i,{onClick:()=>{H(!1),Z("")},variant:"secondary",disabled:K,children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),e.jsxs(i,{onClick:async()=>{if(L&&W===L.name){if(window.confirm("æœ¬å½“ã«ã“ã®æ–½è¨­ã‚’å®Œå…¨ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚"))try{Q(!0),R("");const{data:s}=await l.from("profiles").select("role").eq("id",N?.id).single();try{await l.from("pet_facility_images").delete().eq("facility_id",L.id)}catch(e){}let t=l.from("pet_facilities").delete();t="admin"===s?.role?t.eq("id",L.id):t.eq("id",L.id).eq("owner_id",N?.id);const{error:a}=await t;if(a){if(a.message?.includes("RLS"))throw new Error("æ¨©é™ã‚¨ãƒ©ãƒ¼: ã“ã®æ–½è¨­ã‚’å‰Šé™¤ã™ã‚‹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚");throw new Error(`å‰Šé™¤å‡¦ç†ã‚¨ãƒ©ãƒ¼: ${a.message}`)}const{data:r,error:i}=await l.from("pet_facilities").select("id").eq("id",L.id).single();if(r){if("admin"!==s?.role)throw new Error("å‰Šé™¤ã™ã‚‹æ–½è¨­ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã€ã¾ãŸã¯å‰Šé™¤æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚");{const{error:e}=await l.rpc("force_delete_facility",{target_facility_id:L.id});if(e)throw new Error(`å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚ã‚¨ãƒ©ãƒ¼: ${e.message}`);const{data:s}=await l.from("pet_facilities").select("id").eq("id",L.id).single();if(s)throw new Error("æ–½è¨­ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚")}}else if(i&&"PGRST116"!==i.code)throw new Error(`å‰Šé™¤æ¤œè¨¼ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${i.message}`);B("æ–½è¨­ãŒæ­£å¸¸ã«å‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚"),setTimeout(()=>{O("/my-facilities-management")},3e3)}catch(s){R(`å‰Šé™¤å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${s.message}`)}finally{Q(!1),H(!1),Z("")}}else R("æ–½è¨­åãŒæ­£ã—ãå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚")},className:"bg-red-600 hover:bg-red-700 text-white",disabled:K||W!==L.name,isLoading:K,children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"å‰Šé™¤å®Ÿè¡Œ"]})]})]})}),ee&&te&&e.jsx(o,{imageFile:te,onCropComplete:async e=>{if(L)try{de(!0),R("");const s=Date.now(),t=`facility_${L.id}_${s}.jpg`,{data:a,error:r}=await l.storage.from("vaccine-certs").upload(t,e,{contentType:"image/jpeg",upsert:!0});if(r)throw r;const{data:i}=l.storage.from("vaccine-certs").getPublicUrl(t),d=i.publicUrl;if(null===re){const{data:e,error:s}=await l.from("pet_facility_images").select("display_order").eq("facility_id",L.id).order("display_order",{ascending:!1}).limit(1);if(s)throw s;const t=e.length>0?e[0].display_order+1:0,a=0===t?"main":"additional",{data:r,error:i}=await l.from("pet_facility_images").insert({facility_id:L.id,image_url:d,image_type:a,display_order:t}).select().single();if(i)throw i;X(e=>[...e,r].sort((e,s)=>e.display_order-s.display_order))}else{const e=V[re],{data:s,error:t}=await l.from("pet_facility_images").update({image_url:d,updated_at:(new Date).toISOString()}).eq("id",e.id).select().single();if(t)throw t;X(e=>e.map(e=>e.id===s.id?s:e))}B("ç”»åƒãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã—ãŸã€‚"),setTimeout(()=>B(""),3e3)}catch(s){R("ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}finally{de(!1),se(!1),ae(null),le(null)}},onCancel:()=>{se(!1),ae(null),le(null)},aspectRatio:1,maxWidth:400,maxHeight:400})]})]})]})}export{O as default};

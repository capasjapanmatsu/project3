import{s as e}from"./index-qwdJeTcH.js";async function t(t,a,r,i={}){try{let l=a;if(!a.type||"application/octet-stream"===a.type){const e=(a.name.split(".").pop()||"").toLowerCase(),t="png"===e?"image/png":"webp"===e?"image/webp":"image/jpeg";l=new File([a],a.name,{type:t})}const{error:c}=await e.storage.from(t).upload(r,l,{upsert:i.upsert??!0,cacheControl:i.cacheControl??"3600"});if(c)throw new Error(`ファイルのアップロードに失敗しました: ${c.message}`);let s;try{const a=await e.functions.invoke("convert-to-webp",{body:{bucket:t,path:r,quality:i.quality??80,generateThumbnail:i.generateThumbnail??!0,thumbnailSize:i.thumbnailSize??300,keepOriginal:i.keepOriginal??!1}});if(a.error)throw a.error;s=a.data}catch(n){try{const e=await fetch("/.netlify/functions/convert-to-webp-proxy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bucket:t,path:r,quality:i.quality??80,generateThumbnail:i.generateThumbnail??!0,thumbnailSize:i.thumbnailSize??300,keepOriginal:i.keepOriginal??!1})});if(!e.ok)throw new Error(await e.text());s=await e.json()}catch(o){const{data:a}=e.storage.from(t).getPublicUrl(r);return{success:!0,originalUrl:a.publicUrl,originalPath:r}}}if(!s.success){const{data:a}=e.storage.from(t).getPublicUrl(r);return{success:!0,originalUrl:a.publicUrl,originalPath:r}}return{success:!0,webpUrl:s.webpUrl,thumbnailUrl:s.thumbnailUrl,originalUrl:s.originalUrl,webpPath:s.webpPath,thumbnailPath:s.thumbnailPath,originalPath:s.originalPath}}catch(l){try{const{data:a}=e.storage.from(t).getPublicUrl(r);return{success:!0,originalUrl:a.publicUrl,originalPath:r}}catch(c){return{success:!1,error:l instanceof Error?l.message:"画像の変換に失敗しました"}}}}function a(e,t){return"undefined"!=typeof window&&5===window.document?.createElement("canvas")?.toDataURL("image/webp")?.indexOf("image/webp")&&t?t:e||""}export{a as g,t as u};

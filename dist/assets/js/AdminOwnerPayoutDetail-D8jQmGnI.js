import{j as e}from"./motion-CuO0nkIV.js";import{r as t}from"./react-vendor-cniURDpR.js";import{a as s,d as a,c as r,L as l}from"./router-Cg6wfOY4.js";import{u as i,s as n,C as c}from"./index-qwdJeTcH.js";import{af as x,b as m,aW as d,bi as o,N as h}from"./ui-basic-icnN6BOT.js";import"./heavy-features-BIdEME4r.js";import"./supabase-B0bqaRGb.js";function p(){const{isAdmin:p}=i(),u=s(),{ownerId:j}=a(),[f]=r(),[g,y]=t.useState(""),[N,v]=t.useState([]),[_,b]=t.useState(!0),[w,S]=t.useState(""),k=Number(f.get("year"))||(new Date).getFullYear(),L=Number(f.get("month"))||(new Date).getMonth();t.useEffect(()=>{p?D():u("/")},[p,j,k,L,u]);const D=async()=>{try{if(b(!0),S(""),!j)return;const{data:e}=await n.from("profiles").select("name").eq("id",j).single();y(e?.name||"");const t=new Date(k,L,1),s=new Date(k,L+1,0),{data:a,error:r}=await n.rpc("get_monthly_revenue_by_park",{start_date_param:t.toISOString().split("T")[0],end_date_param:s.toISOString().split("T")[0]});if(r)throw r;const l=(a||[]).filter(e=>e.owner_id===j).map(e=>({park_id:e.park_id,park_name:e.park_name,total_revenue:e.total_revenue,platform_fee:Math.round(.2*e.total_revenue),owner_payout:Math.round(.8*e.total_revenue)}));v(l)}catch(e){S("明細の取得に失敗しました")}finally{b(!1)}},I=t.useMemo(()=>N.reduce((e,t)=>(e.revenue+=t.total_revenue,e.fee+=t.platform_fee,e.payout+=t.owner_payout,e),{revenue:0,fee:0,payout:0}),[N]);return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center space-x-4 mb-2",children:e.jsxs(l,{to:"/admin/revenue",className:"flex items-center text-gray-600 hover:text-gray-800",children:[e.jsx(x,{className:"w-4 h-4 mr-2"})," 売上レポートに戻る"]})}),e.jsxs("h1",{className:"text-2xl font-bold flex items-center",children:[e.jsx(m,{className:"w-6 h-6 mr-2"}),"オーナー振込明細"]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["オーナー: ",g,"（ID: ",j,"） / 対象: ",k,"年",L+1,"月"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"売上合計"}),e.jsxs("div",{className:"text-xl font-bold",children:["¥",I.revenue.toLocaleString()]})]}),e.jsx(d,{className:"w-6 h-6 text-green-600"})]})}),e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"プラットフォーム手数料（20%）"}),e.jsxs("div",{className:"text-xl font-bold",children:["¥",I.fee.toLocaleString()]})]}),e.jsx(o,{className:"w-6 h-6 text-blue-600"})]})}),e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"振込金額（80%）"}),e.jsxs("div",{className:"text-xl font-bold",children:["¥",I.payout.toLocaleString()]})]}),e.jsx(h,{className:"w-6 h-6 text-purple-600"})]})})]}),e.jsxs(c,{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"ドッグラン別内訳"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"ドッグラン"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase",children:"売上"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase",children:"手数料"}),e.jsx("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase",children:"振込金額"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:N.map(t=>e.jsx(e.Fragment,{children:e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 text-sm text-gray-800",children:e.jsx(l,{to:`/admin/revenue/park/${t.park_id}?year=${k}&month=${L}`,target:"_blank",className:"text-blue-600 hover:text-blue-800",children:t.park_name})}),e.jsxs("td",{className:"px-4 py-2 text-sm text-right",children:["¥",t.total_revenue.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-2 text-sm text-right",children:["¥",t.platform_fee.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-2 text-sm text-right font-medium",children:["¥",t.owner_payout.toLocaleString()]})]},t.park_id)}))})]})})]})]})}export{p as default};

import{j as e}from"./motion-CuO0nkIV.js";import{r as a}from"./react-vendor-cniURDpR.js";import{a as s,L as t}from"./router-9ZtQ8-Nn.js";import{B as r}from"./Button--TH9Y01K.js";import{C as i}from"./Card-roTxPFVC.js";import{I as n}from"./Input-DhGYLHzs.js";import{S as d}from"./Select-Dd_IZFKg.js";import{s as l,l as c,c as o,b as m,u as x}from"./index-CtlD7uSd.js";import{o as g,an as p,F as _,l as u,v as h,aS as f,aT as v,M as y,aD as w,C as j,a as b,U as N,G as k,p as C,O as S,X as L}from"./ui-basic-DTukwD8S.js";import"./supabase-hyP6cfTu.js";import"./heavy-features-BIdEME4r.js";const $=e=>{const[s,t]=a.useState([]),[r,i]=a.useState([]),[n,d]=a.useState(!0),[x,g]=a.useState(""),[p,_]=a.useState(""),u=async()=>{try{d(!0),g(""),"parks"===e&&await(async()=>{try{c("info","🔍 Fetching pending parks...");const e=await m(()=>l.from("dog_parks").select("\n            id,\n            name,\n            address,\n            status,\n            created_at,\n            owner_id\n          ").in("status",["pending","first_stage_passed","second_stage_waiting","second_stage_review","smart_lock_testing"]).order("created_at",{ascending:!1}));if(e.error)throw c("error","❌ Parks fetch error:",e.error),e.error;const a=e.data||[];if(0===a.length)return c("info","ℹ️ No pending parks found"),void t([]);c("info",`✅ Found ${a.length} pending parks`);const s=[...new Set(a.map(e=>e.owner_id))],r=a.map(e=>e.id),[i,n,d,o]=await Promise.allSettled([s.length>0?l.from("profiles").select("id, name, postal_code, address, phone_number, email").in("id",s):Promise.resolve({data:[],error:null}),r.length>0?l.from("dog_park_review_stages").select("park_id, second_stage_submitted_at").in("park_id",r):Promise.resolve({data:[],error:null}),r.length>0?l.from("dog_park_facility_images").select("park_id, is_approved").in("park_id",r):Promise.resolve({data:[],error:null}),s.length>0?l.from("owner_verifications").select("user_id, verification_id, status, verification_data, created_at").in("user_id",s):Promise.resolve({data:[],error:null})]),x="fulfilled"===i.status&&i.value.data||[],g=new Map(x.map(e=>[e.id,e])),p="fulfilled"===n.status&&n.value.data||[],_=new Map(p.map(e=>[e.park_id,e])),u="fulfilled"===d.status&&d.value.data||[],h=new Map;u.forEach(e=>{h.has(e.park_id)||h.set(e.park_id,[]),h.get(e.park_id).push(e)});const f="fulfilled"===o.status&&o.value.data||[],v=new Map(f.map(e=>[e.user_id,e])),y=a.map(e=>{const a=g.get(e.owner_id),s=_.get(e.id),t=h.get(e.id)||[],r=v.get(e.owner_id),i=t.length,n=t.filter(e=>!0===e.is_approved).length,d=t.filter(e=>!1===e.is_approved).length,l=t.filter(e=>null===e.is_approved).length;let c="",o="";return r&&r.verification_data&&"object"==typeof r.verification_data&&(c=r.verification_data.document_url||r.verification_data.file_path||"",o=r.verification_data.file_name||r.verification_data.filename||""),!c&&r?.verification_id&&(c=r.verification_id),!o&&c&&(o=c.split("/").pop()||"identity_document"),{id:e.id,name:e.name,address:e.address,status:e.status,created_at:e.created_at,owner_id:e.owner_id,owner_name:a?.name||"Unknown Owner",second_stage_submitted_at:s?.second_stage_submitted_at||null,total_images:i,approved_images:n,rejected_images:d,pending_images:l,owner_postal_code:a?.postal_code||"",owner_address:a?.address||"",owner_phone_number:a?.phone_number||"",owner_email:a?.email||"",identity_document_url:c,identity_document_filename:o,identity_status:r?.status||"not_submitted",identity_created_at:r?.created_at||""}});c("info",`✅ Transformed ${y.length} parks with image data`),t(y)}catch(e){c("error","❌ Error fetching parks:",{error:o(e)}),g(`ドッグラン申請データの取得に失敗しました: ${o(e)}`)}})()}catch(a){c("error","❌ Error in fetchData:",{error:o(a)}),g(`データの取得に失敗しました: ${o(a)}`)}finally{d(!1)}};return a.useEffect(()=>{u()},[e]),{pendingParks:s,pendingVaccines:r,isLoading:n,error:x,success:p,refetch:u}};function E(){const{isAdmin:c}=x(),o=s(),[m,E]=a.useState("applications"),[P,q]=a.useState([]),[T,M]=a.useState([]),[A,U]=a.useState([]),[D,I]=a.useState([]),[F,O]=a.useState([]),[z,R]=a.useState(!0),[B,K]=a.useState(""),[Q,G]=a.useState(""),[H,J]=a.useState(""),[V,X]=a.useState("all"),[W,Y]=a.useState("created_at"),[Z,ee]=a.useState("desc"),[ae,se]=a.useState(null),te=$("parks"),re=async e=>{if(0===e.length)return new Map;try{const{data:a,error:s}=await l.from("dog_parks").select("\n          id,\n          description,\n          price,\n          max_capacity,\n          large_dog_area,\n          small_dog_area,\n          private_booths,\n          facilities,\n          facility_details,\n          private_booth_count,\n          image_url,\n          cover_image_url,\n          average_rating,\n          review_count\n        ").in("id",e);if(s)return new Map;const t=new Map;return(a||[]).forEach(e=>{t.set(e.id,e)}),t}catch(a){return new Map}},ie=async e=>{if(0===e.length)return new Map;try{const{data:a,error:s}=await l.from("dog_park_facility_images").select("\n          id,\n          park_id,\n          image_type,\n          image_url,\n          is_approved,\n          admin_notes,\n          created_at\n        ").in("park_id",e);if(s)return new Map;const t=new Map;return(a||[]).forEach(e=>{t.has(e.park_id)||t.set(e.park_id,[]),t.get(e.park_id).push(e)}),t}catch(a){return new Map}},ne=async()=>{try{const{data:e,error:a}=await l.from("dog_parks").select("\n          *,\n          profiles:owner_id (\n            name,\n            address,\n            phone_number,\n            email,\n            postal_code\n          )\n        ").eq("status","approved").order("created_at",{ascending:!1});if(a)return[];return e.map(e=>{const a=Array.isArray(e.profiles)?e.profiles[0]:e.profiles;return xe({id:e.id,name:e.name,address:e.address,status:e.status,created_at:e.created_at,owner_id:e.owner_id,owner_name:a?.name||"Unknown",owner_email:a?.email||"Unknown",owner_phone_number:a?.phone_number||"",owner_address:a?.address||"",identity_document_url:"",identity_document_filename:"",identity_status:"approved",identity_created_at:""},e,[])})}catch(e){return[]}},de=(e,a,s)=>{se({url:e,type:a,parkName:s})},le=()=>{se(null)},ce=e=>{G(e),K(""),setTimeout(()=>G(""),5e3)},oe=e=>{K(e),G(""),setTimeout(()=>K(""),8e3)},me=async e=>{if(window.confirm("このドッグラン申請を削除してもよろしいですか？この操作は取り消せません。"))try{K(""),G("");try{const{error:a}=await l.from("news_announcements").delete().eq("park_id",e);if(a)return void oe(`ニュースの削除に失敗しました: ${a.message}`)}catch(a){return void oe("ニュース削除処理でエラーが発生しました。")}try{const{error:a}=await l.from("new_park_openings").delete().eq("park_id",e);if(a)return void oe(`新規開園情報の削除に失敗しました: ${a.message}`)}catch(a){return void oe("新規開園情報削除処理でエラーが発生しました。")}try{const{data:a}=await l.from("smart_locks").select("lock_id").eq("park_id",e);if(a&&a.length>0){const e=a.map(e=>e.lock_id),{error:s}=await l.from("lock_access_logs").delete().in("lock_id",e);if(s)return void oe(`ロックアクセスログの削除に失敗しました: ${s.message}`)}}catch(a){return void oe("ロックアクセスログ削除処理でエラーが発生しました。")}try{const{error:a}=await l.from("smart_locks").delete().eq("park_id",e);if(a)return void oe(`スマートロックの削除に失敗しました: ${a.message}`)}catch(a){return void oe("スマートロック削除処理でエラーが発生しました。")}try{const{error:a}=await l.from("user_entry_status").delete().eq("park_id",e);if(a)return void oe(`エントリーステータスの削除に失敗しました: ${a.message}`)}catch(a){return void oe("エントリーステータス削除処理でエラーが発生しました。")}try{const{error:a}=await l.from("reservations").delete().eq("park_id",e);if(a)return void oe(`予約の削除に失敗しました: ${a.message}`)}catch(a){return void oe("予約削除処理でエラーが発生しました。")}try{const{error:a}=await l.from("dog_encounters").delete().eq("park_id",e);if(a)return void oe(`出会い記録の削除に失敗しました: ${a.message}`)}catch(a){return void oe("出会い記録削除処理でエラーが発生しました。")}try{const{data:a}=await l.from("dog_park_reviews").select("id").eq("park_id",e);if(a&&a.length>0){const e=a.map(e=>e.id),{error:s}=await l.from("dog_park_review_images").delete().in("review_id",e);if(s)return void oe(`レビュー画像の削除に失敗しました: ${s.message}`)}}catch(a){return void oe("レビュー画像削除処理でエラーが発生しました。")}try{const{error:a}=await l.from("dog_park_reviews").delete().eq("park_id",e);if(a)return void oe(`レビューの削除に失敗しました: ${a.message}`)}catch(a){return void oe("レビュー削除処理でエラーが発生しました。")}try{const{error:a}=await l.from("dog_park_facility_images").delete().eq("park_id",e);if(a)return void oe(`施設画像の削除に失敗しました: ${a.message}`)}catch(a){return void oe("施設画像削除処理でエラーが発生しました。")}try{const{error:a}=await l.from("dog_park_images").delete().eq("park_id",e);if(a)return void oe(`パーク画像の削除に失敗しました: ${a.message}`)}catch(a){return void oe("パーク画像削除処理でエラーが発生しました。")}try{const{error:a}=await l.from("dog_park_review_stages").delete().eq("park_id",e);if(a)return void oe(`レビューステージの削除に失敗しました: ${a.message}`)}catch(a){return void oe("レビューステージ削除処理でエラーが発生しました。")}try{const{error:a}=await l.from("dog_parks").delete().eq("id",e);if(a)return void oe(`ドッグランの削除に失敗しました: ${a.message}`)}catch(a){return void oe("ドッグラン削除処理でエラーが発生しました。")}ce("ドッグラン申請を削除しました。"),q(a=>a.filter(a=>a.id!==e))}catch(a){oe("ドッグランの削除に失敗しました。")}},xe=(e,a,s)=>{const t=a||{};return{id:e.id,name:e.name,description:t.description||"",address:e.address,price:t.price||0,status:e.status,owner_id:e.owner_id,created_at:e.created_at,max_capacity:t.max_capacity||0,large_dog_area:t.large_dog_area||!1,small_dog_area:t.small_dog_area||!1,private_booths:t.private_booths||!1,facilities:t.facilities||{parking:!1,shower:!1,restroom:!1,agility:!1,rest_area:!1,water_station:!1},average_rating:t.average_rating||0,review_count:t.review_count||0,facility_details:t.facility_details||"",private_booth_count:t.private_booth_count||0,image_url:t.image_url||"",cover_image_url:t.cover_image_url||"",owner_name:e.owner_name||"Unknown",owner_email:e.owner_email||"Unknown",owner_phone:e.owner_phone_number||"",owner_address:e.owner_address||"",facility_images:s||[],identity_document_url:e.identity_document_url||"",identity_document_filename:e.identity_document_filename||"",identity_status:e.identity_status||"not_submitted",identity_created_at:e.identity_created_at||""}};a.useEffect(()=>{c||o("/admin-dashboard")},[c,o]),a.useEffect(()=>{if(!te.isLoading&&te.pendingParks.length>0){(async()=>{const e=te.pendingParks.map(e=>e.id),[a,s]=await Promise.all([re(e),ie(e)]),t=te.pendingParks.map(e=>{const t=a.get(e.id),r=s.get(e.id)||[];return xe(e,t,r)});q(t),R(!1),pe(),ne().then(e=>{I(e),ge(e)})})()}else te.isLoading?R(!0):(q([]),R(!1),pe(),ne().then(e=>{I(e),ge(e)}))},[te.pendingParks,te.isLoading]);const ge=e=>{let a=e.filter(e=>(!H||e.name.toLowerCase().includes(H.toLowerCase())||e.address.toLowerCase().includes(H.toLowerCase())||e.owner_name.toLowerCase().includes(H.toLowerCase()))&&("all"===V||"approved"===V));a=a.sort((e,a)=>{let s,t;switch(W){case"name":s=e.name,t=a.name;break;case"average_rating":s=e.average_rating||0,t=a.average_rating||0;break;default:s=e.created_at,t=a.created_at}return"asc"===Z?s>t?1:-1:s<t?1:-1}),U(a)};a.useEffect(()=>{D.length>0&&ge(D)},[H,V,W,Z,D]),a.useEffect(()=>{P.length>0&&pe()},[H,V,W,Z,P]);const pe=()=>{const e=["pending","first_stage_passed","second_stage_waiting","second_stage_review","smart_lock_testing"],a=["approved"];let s=P.filter(e=>{const a=!H||e.name.toLowerCase().includes(H.toLowerCase())||e.address.toLowerCase().includes(H.toLowerCase())||e.owner_name.toLowerCase().includes(H.toLowerCase()),s="all"===V||e.status===V;return a&&s});s=s.sort((e,a)=>{let s,t;switch(W){case"name":s=e.name,t=a.name;break;case"average_rating":s=e.average_rating||0,t=a.average_rating||0;break;default:s=e.created_at,t=a.created_at}return"asc"===Z?s>t?1:-1:s<t?1:-1}),M(s);const t=s.filter(a=>e.includes(a.status));s.filter(e=>a.includes(e.status));O(t)},_e=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"first_stage_passed":return"bg-blue-100 text-blue-800";case"second_stage_waiting":return"bg-orange-100 text-orange-800";case"second_stage_review":return"bg-purple-100 text-purple-800";case"smart_lock_testing":return"bg-indigo-100 text-indigo-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},ue=e=>{switch(e){case"pending":return"第一審査中";case"first_stage_passed":return"第一審査通過（旧）";case"second_stage_waiting":return"第二審査提出待ち";case"second_stage_review":return"第二審査中";case"smart_lock_testing":return"スマートロック認証待ち";case"approved":return"承認済み・公開可能";case"rejected":return"却下";default:return"不明"}},he=e=>`¥${e.toLocaleString()}`,fe=e=>new Date(e).toLocaleDateString("ja-JP",{year:"numeric",month:"short",day:"numeric"});return z?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"データを読み込み中..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 py-8",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"bg-white shadow rounded-lg mb-8",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"ドッグラン管理"}),e.jsx("p",{className:"text-gray-600",children:"ドッグラン施設の詳細情報と申請管理"})]}),B&&e.jsx("div",{className:"px-6 py-4 bg-red-50 border-l-4 border-red-400",children:e.jsxs("div",{className:"flex",children:[e.jsx(g,{className:"h-5 w-5 text-red-400 mr-2"}),e.jsx("p",{className:"text-sm text-red-700",children:B})]})}),Q&&e.jsx("div",{className:"px-6 py-4 bg-green-50 border-l-4 border-green-400",children:e.jsxs("div",{className:"flex",children:[e.jsx(p,{className:"h-5 w-5 text-green-400 mr-2"}),e.jsx("p",{className:"text-sm text-green-700",children:Q})]})}),e.jsx("div",{className:"px-6",children:e.jsxs("nav",{className:"flex space-x-8","aria-label":"Tabs",children:[e.jsxs("button",{onClick:()=>E("applications"),className:"whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm "+("applications"===m?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx(_,{className:"w-5 h-5 inline mr-2"}),"ドッグラン申請",e.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:F.length})]}),e.jsxs("button",{onClick:()=>E("parks"),className:"whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm "+("parks"===m?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx(u,{className:"w-5 h-5 inline mr-2"}),"ドッグラン一覧",e.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:A.length})]})]})})]}),"parks"===m&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(h,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(n,{label:"",placeholder:"施設名、住所、オーナー名で検索...",value:H,onChange:e=>J(e.target.value),className:"pl-10"})]}),e.jsx(d,{label:"",options:[{value:"all",label:"全ステータス"},{value:"approved",label:"承認済み"}],value:V,onChange:e=>X(e.target.value)}),e.jsx(d,{label:"",options:[{value:"created_at",label:"作成日時"},{value:"name",label:"施設名"},{value:"average_rating",label:"平均評価"}],value:W,onChange:e=>Y(e.target.value)}),e.jsxs(r,{variant:"secondary",onClick:()=>ee("asc"===Z?"desc":"asc"),className:"flex items-center justify-center",children:["asc"===Z?e.jsx(f,{className:"w-4 h-4 mr-2"}):e.jsx(v,{className:"w-4 h-4 mr-2"}),"asc"===Z?"昇順":"降順"]})]})}),0===A.length?e.jsxs(i,{className:"text-center py-12",children:[e.jsx(u,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:H||"all"!==V?"条件に一致するドッグランが見つかりません":"承認済みのドッグランがありません"})]}):e.jsx("div",{className:"grid grid-cols-1 gap-6",children:A.map(a=>e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a.name}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${_e(a.status)}`,children:ue(a.status)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[e.jsx(y,{className:"w-4 h-4 mr-1"}),a.address]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[e.jsx(w,{className:"w-4 h-4 mr-1"}),he(a.price)]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(j,{className:"w-4 h-4 mr-1"}),fe(a.created_at)]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[e.jsx(b,{className:"w-4 h-4 mr-1"}),a.owner_name]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[e.jsx(N,{className:"w-4 h-4 mr-1"}),"定員: ",a.max_capacity,"頭"]}),a.average_rating&&a.average_rating>0&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(k,{className:"w-4 h-4 mr-1"}),a.average_rating.toFixed(1)," (",a.review_count||0,"件)"]})]})]}),a.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:a.description}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.large_dog_area&&e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:"大型犬エリア"}),a.small_dog_area&&e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded",children:"小型犬エリア"}),a.private_booths&&e.jsx("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded",children:"個室あり"}),a.facilities.parking&&e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"駐車場"}),a.facilities.shower&&e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"シャワー"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(t,{to:`/parks/${a.id}`,className:"flex items-center px-3 py-1 text-sm bg-blue-100 text-blue-800 rounded-md hover:bg-blue-200",children:[e.jsx(C,{className:"w-4 h-4 mr-1"}),"詳細"]}),e.jsxs(r,{size:"sm",variant:"secondary",onClick:()=>me(a.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[e.jsx(S,{className:"w-4 h-4 mr-1"}),"削除"]})]})]})},a.id))})]}),"applications"===m&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(h,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(n,{label:"",placeholder:"施設名、住所、オーナー名で検索...",value:H,onChange:e=>J(e.target.value),className:"pl-10"})]}),e.jsx(d,{label:"",options:[{value:"all",label:"全ステータス"},{value:"pending",label:"第一審査中"},{value:"first_stage_passed",label:"第一審査通過（旧）"},{value:"second_stage_waiting",label:"第二審査提出待ち"},{value:"second_stage_review",label:"第二審査中"},{value:"smart_lock_testing",label:"スマートロック認証待ち"},{value:"rejected",label:"却下"}],value:V,onChange:e=>X(e.target.value)}),e.jsx(d,{label:"",options:[{value:"created_at",label:"作成日時"},{value:"name",label:"施設名"},{value:"average_rating",label:"平均評価"}],value:W,onChange:e=>Y(e.target.value)}),e.jsxs(r,{variant:"secondary",onClick:()=>ee("asc"===Z?"desc":"asc"),className:"flex items-center justify-center",children:["asc"===Z?e.jsx(f,{className:"w-4 h-4 mr-2"}):e.jsx(v,{className:"w-4 h-4 mr-2"}),"asc"===Z?"昇順":"降順"]})]})}),0===F.length?e.jsxs(i,{className:"text-center py-12",children:[e.jsx(_,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:H||"all"!==V?"条件に一致する申請が見つかりません":"審査中の申請がありません"})]}):e.jsx("div",{className:"grid grid-cols-1 gap-6",children:F.map(a=>e.jsxs(i,{className:"p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a.name}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${_e(a.status)}`,children:ue(a.status)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"申請者情報"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),a.owner_name]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),a.owner_address||"住所未登録"]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"申請日: ",fe(a.created_at)]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"施設情報"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),a.address]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),he(a.price)]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),"定員: ",a.max_capacity,"頭"]})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center",children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"本人確認書類"]}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:a.identity_document_url&&""!==a.identity_document_url?e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"relative",children:e.jsx("img",{src:`${l.storage.from("vaccine-certs").getPublicUrl(a.identity_document_url||"").data.publicUrl}`,alt:"本人確認書類",className:"w-32 h-32 object-cover rounded border shadow-sm cursor-pointer hover:shadow-md transition-shadow",onClick:()=>de(`${l.storage.from("vaccine-certs").getPublicUrl(a.identity_document_url||"").data.publicUrl}`,"本人確認書類",a.name)})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"ファイル名:"}),e.jsx("span",{className:"text-sm text-gray-600 ml-2",children:a.identity_document_filename||"identity_document"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"審査状況:"}),e.jsx("span",{className:"text-sm ml-2 px-2 py-1 rounded-full "+("approved"===a.identity_status?"bg-green-100 text-green-800":"rejected"===a.identity_status?"bg-red-100 text-red-800":"submitted"===a.identity_status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:"approved"===a.identity_status?"承認済み":"rejected"===a.identity_status?"却下":"submitted"===a.identity_status?"審査中":"未提出"})]}),a.identity_created_at&&e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"提出日:"}),e.jsx("span",{className:"text-sm text-gray-600 ml-2",children:fe(a.identity_created_at)})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:"クリックして拡大表示"})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"本人確認書類が提出されていません"})]})})]}),a.description&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"施設説明"}),e.jsx("p",{className:"text-sm text-gray-600",children:a.description})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"設備・サービス"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.large_dog_area&&e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:"大型犬エリア"}),a.small_dog_area&&e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded",children:"小型犬エリア"}),a.private_booths&&e.jsx("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded",children:"個室あり"}),a.facilities.parking&&e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"駐車場"}),a.facilities.shower&&e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"シャワー"}),a.facilities.restroom&&e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"トイレ"}),a.facilities.agility&&e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"アジリティ"}),a.facilities.rest_area&&e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"休憩エリア"}),a.facilities.water_station&&e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"給水設備"})]})]}),"second_stage_review"===a.status&&a.facility_images&&a.facility_images.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-2",children:["設備画像 (",a.facility_images.length,"枚)"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:a.facility_images.map((s,t)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s.image_url,alt:`設備画像 ${t+1}`,className:"w-full h-24 object-cover rounded-md border cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>de(s.image_url,s.image_type,a.name)}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded-b-md",children:s.image_type})]},s.id))})]})]})}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[("pending"===a.status||"first_stage_passed"===a.status||"second_stage_review"===a.status)&&e.jsxs(e.Fragment,{children:[e.jsxs(r,{size:"sm",onClick:()=>(async e=>{const a=P.find(a=>a.id===e);if(!a)return;let s,t,r;if(window.confirm("⚠️ 一時的な回避策を使用しますか？\n\n「はい」を選択すると、第一審査から直接「承認済み」に変更されます。\n「いいえ」を選択すると、通常の承認処理を実行します（データベース制約の修正が必要）。"))s="second_stage_waiting",t="⚠️ 一時的な回避策として、このドッグランを「第二審査提出待ち」にしてもよろしいですか？\n\n※ 申請タブに残り、後で再度承認処理ができます。",r="⚠️ 一時的な回避策により、ドッグランのステータスが「第二審査提出待ち」に変更されました。",a.name;else switch(a.status){case"pending":s="second_stage_waiting",t="このドッグランの第一審査を承認してもよろしいですか？",r="ドッグランの第一審査を承認しました。",a.name;break;case"second_stage_waiting":s="second_stage_review",t="このドッグランを第二審査中に変更しますか？",r="ドッグランが第二審査中に変更されました。",a.name;break;case"second_stage_review":s="smart_lock_testing",t="このドッグランの第二審査を承認してもよろしいですか？",r="ドッグランの第二審査を承認しました。",a.name;break;case"smart_lock_testing":s="approved",t="このドッグランの承認を完了してもよろしいですか？",r="ドッグランが承認されました。",a.name;break;default:return void oe("このドッグランの現在のステータスでは承認できません。")}if(window.confirm(t))try{K(""),G("");const{error:a}=await l.from("dog_parks").update({status:s}).eq("id",e);if(a)return void("23514"===a.code?oe(`承認処理に失敗しました: ステータス "${s}" が許可されていません。\n\n📋 データベースの制約を更新してください：\n\n1. https://app.supabase.com にアクセス\n2. プロジェクトを選択\n3. 左側メニューから「SQL Editor」を選択\n4. 以下のSQLを実行：\n\nALTER TABLE dog_parks DROP CONSTRAINT IF EXISTS dog_parks_status_check;\nALTER TABLE dog_parks ADD CONSTRAINT dog_parks_status_check CHECK (status IN ('pending', 'first_stage_passed', 'second_stage_waiting', 'second_stage_review', 'smart_lock_testing', 'approved', 'rejected'));\n\n5. ページを再読み込み`):oe(`承認処理に失敗しました: ${a.message||"不明なエラー"}`));ce(r);const t=P.map(a=>a.id===e?{...a,status:s}:a);q(t),setTimeout(()=>{const e=["pending","first_stage_passed","second_stage_waiting","second_stage_review","smart_lock_testing"],a=t.filter(e=>{const a=!H||e.name.toLowerCase().includes(H.toLowerCase())||e.address.toLowerCase().includes(H.toLowerCase())||e.owner_name.toLowerCase().includes(H.toLowerCase()),s="all"===V||e.status===V;return a&&s}).filter(a=>e.includes(a.status));O(a)},100)}catch(i){oe(`承認処理に失敗しました: ${i instanceof Error?i.message:"不明なエラー"}`)}})(a.id),className:"bg-green-600 hover:bg-green-700",children:[e.jsx(p,{className:"w-4 h-4 mr-1"}),"pending"===a.status?"第一審査承認":"second_stage_review"===a.status?"第二審査承認":"承認"]}),e.jsxs(r,{size:"sm",variant:"secondary",onClick:()=>(async e=>{if(window.confirm("このドッグラン申請を却下してもよろしいですか？"))try{K(""),G("");const{error:a}=await l.from("dog_parks").update({status:"rejected"}).eq("id",e);if(a)return void oe("却下の処理に失敗しました。");const s=P.find(a=>a.id===e);s&&await l.from("notifications").insert([{user_id:s.owner_id,title:"ドッグラン申請却下",message:`${s.name}の申請が却下されました。詳細については管理者までお問い合わせください。`,type:"park_rejected",created_at:(new Date).toISOString(),read:!1}]),ce("ドッグラン申請を却下しました。"),q(a=>a.map(a=>a.id===e?{...a,status:"rejected"}:a))}catch(a){oe("却下の処理に失敗しました。")}})(a.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[e.jsx(L,{className:"w-4 h-4 mr-1"}),"却下"]})]}),e.jsxs(r,{size:"sm",variant:"secondary",onClick:()=>me(a.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[e.jsx(S,{className:"w-4 h-4 mr-1"}),"削除"]})]})]},a.id))})]})]}),ae&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",onClick:le,onKeyDown:e=>{"Escape"===e.key&&le()},tabIndex:0,children:e.jsxs("div",{className:"relative max-w-4xl max-h-full",children:[e.jsx("img",{src:ae.url,alt:`${ae.parkName} - ${ae.type}`,className:"max-w-full max-h-full object-contain rounded-lg",onClick:e=>e.stopPropagation()}),e.jsxs("div",{className:"absolute bottom-4 left-4 right-4 bg-black bg-opacity-50 text-white p-3 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-lg",children:ae.parkName}),e.jsx("p",{className:"text-sm text-gray-300",children:ae.type})]}),e.jsx("button",{onClick:le,className:"absolute top-4 right-4 text-white hover:text-gray-300 bg-black bg-opacity-50 rounded-full p-2",children:e.jsx(L,{className:"w-6 h-6"})})]})})]})}export{E as AdminParkManagement};

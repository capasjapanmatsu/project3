import{j as e}from"./data-vendor-BmFUkYzE.js";import{i as s,r as a,L as t}from"./core-vendor-DBEP70vW.js";import{s as r,l as i,C as n,B as c}from"./index-CDzr2Gkx.js";import{O as l,A as d,i as x,aR as m,s as o,av as h,d as j,C as g,v as p,X as N}from"./ui-vendor-B3gor5_P.js";import"./heavy-vendor-Bb5jGJvT.js";function v(){const[v]=s(),[f,u]=a.useState({pendingVaccines:0,pendingParks:0,unreadMessages:0,pendingUsers:0}),[b,w]=a.useState([]),[y,_]=a.useState([]),[k,S]=a.useState(!0),[P,C]=a.useState(""),[D,$]=a.useState(""),[M,V]=a.useState("overview"),[z,E]=a.useState(!1);a.useEffect(()=>{const e=v.get("tab");e&&["overview","vaccines","parks","messages"].includes(e)&&V(e),L()},[v]);const L=async()=>{try{S(!0);const{data:e,error:s}=await r.from("vaccine_certifications").select("\n          *,\n          dog:dogs(\n            *,\n            owner:profiles(*)\n          )\n        ").eq("status","pending").order("created_at",{ascending:!0});if(s)throw s;const{data:a,error:t}=await r.from("dog_parks").select("*").in("status",["pending","second_stage_review"]).order("created_at",{ascending:!0});if(t)throw t;w(e||[]),_(a||[]),u({pendingVaccines:e?.length||0,pendingParks:a?.length||0,unreadMessages:0,pendingUsers:0})}catch(e){i("error","Error fetching task data",{error:e}),C("タスクデータの取得に失敗しました")}finally{S(!1)}},q=async(e,s)=>{E(!0),C(""),$("");try{const a=b.find(s=>s.id===e);if(!a)throw new Error("ワクチン証明書が見つかりません");const{error:t}=await r.from("vaccine_certifications").update({status:s?"approved":"rejected",reviewed_at:(new Date).toISOString()}).eq("id",e);if(t)throw t;const{error:i}=await r.from("notifications").insert([{user_id:a.dog.owner.id,type:"vaccine_review",title:s?"ワクチン証明書が承認されました":"ワクチン証明書について",message:s?`${a.dog.name}のワクチン証明書が承認されました。ドッグランのご利用が可能になりました。`:`${a.dog.name}のワクチン証明書の確認が必要です。マイページから再度アップロードしてください。`,data:{vaccine_id:e,dog_id:a.dog_id}}]);if(i)throw i;$(`ワクチン証明書を${s?"承認":"却下"}しました`),await L()}catch(a){i("error","Error processing vaccine",{error:a}),C("ワクチン証明書の処理に失敗しました")}finally{E(!1)}},J=async(e,s)=>{E(!0),C(""),$("");try{const a=y.find(s=>s.id===e);if(!a)throw new Error("ドッグランが見つかりません");let t="";t=s?"pending"===a.status?"first_stage_passed":"qr_testing":"rejected";const{error:i}=await r.from("dog_parks").update({status:t,reviewed_at:(new Date).toISOString()}).eq("id",e);if(i)throw i;const{error:n}=await r.from("notifications").insert([{user_id:a.owner_id,type:"park_review",title:s?"審査結果のお知らせ":"審査結果について",message:s?`${a.name}の審査が通過しました。${"pending"===a.status?"詳細情報の入力にお進みください。":"QRコード実証検査の準備に入ります。"}`:`${a.name}の審査が不通過となりました。詳細はダッシュボードをご確認ください。`,data:{park_id:e}}]);if(n)throw n;$(`ドッグランを${s?"承認":"却下"}しました`),await L()}catch(a){i("error","Error processing park",{error:a}),C("ドッグランの処理に失敗しました")}finally{E(!1)}},O=()=>f.pendingVaccines+f.pendingParks+f.unreadMessages+f.pendingUsers;return k?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center space-x-4 mb-6",children:e.jsxs(t,{to:"/admin",className:"flex items-center text-blue-600 hover:text-blue-800",children:[e.jsx(l,{className:"w-4 h-4 mr-2"}),"管理者ダッシュボードに戻る"]})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center",children:[e.jsx(d,{className:"w-8 h-8 text-red-600 mr-3"}),"緊急対応タスク"]}),e.jsx("p",{className:"text-gray-600",children:"承認待ちの項目を確認・処理してください"})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["合計タスク数: ",O(),"件"]})]}),P&&e.jsxs("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4 flex items-start",children:[e.jsx(d,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsx("p",{children:P})]}),D&&e.jsxs("div",{className:"bg-green-100 border border-green-300 text-green-800 rounded-lg p-4 flex items-start",children:[e.jsx(x,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsx("p",{children:D})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(n,{className:"p-6 cursor-pointer transition-all "+("vaccines"===M?"ring-2 ring-blue-500 bg-blue-50":"hover:shadow-lg"),onClick:()=>V("vaccines"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"ワクチン証明書"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:f.pendingVaccines}),e.jsx("p",{className:"text-xs text-gray-500",children:"承認待ち"})]}),e.jsx(m,{className:"w-8 h-8 text-red-600"})]})}),e.jsx(n,{className:"p-6 cursor-pointer transition-all "+("parks"===M?"ring-2 ring-blue-500 bg-blue-50":"hover:shadow-lg"),onClick:()=>V("parks"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"ドッグラン審査"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:f.pendingParks}),e.jsx("p",{className:"text-xs text-gray-500",children:"審査待ち"})]}),e.jsx(o,{className:"w-8 h-8 text-orange-600"})]})}),e.jsx(n,{className:"p-6 cursor-pointer transition-all "+("messages"===M?"ring-2 ring-blue-500 bg-blue-50":"hover:shadow-lg"),onClick:()=>V("messages"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"お問い合わせ"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:f.unreadMessages}),e.jsx("p",{className:"text-xs text-gray-500",children:"未読"})]}),e.jsx(h,{className:"w-8 h-8 text-purple-600"})]})}),e.jsx(n,{className:"p-6 cursor-pointer transition-all "+("overview"===M?"ring-2 ring-blue-500 bg-blue-50":"hover:shadow-lg"),onClick:()=>V("overview"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"全体概要"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:O()}),e.jsx("p",{className:"text-xs text-gray-500",children:"総タスク数"})]}),e.jsx(j,{className:"w-8 h-8 text-blue-600"})]})})]}),"overview"===M&&e.jsx("div",{className:"space-y-6",children:e.jsxs(n,{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"タスク概要"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-3",children:"優先度の高いタスク"}),e.jsxs("div",{className:"space-y-2",children:[f.pendingVaccines>0&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(m,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"text-sm",children:"ワクチン証明書承認"})]}),e.jsxs("span",{className:"text-sm font-medium text-red-600",children:[f.pendingVaccines,"件"]})]}),f.pendingParks>0&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-orange-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{className:"w-4 h-4 text-orange-600"}),e.jsx("span",{className:"text-sm",children:"ドッグラン審査"})]}),e.jsxs("span",{className:"text-sm font-medium text-orange-600",children:[f.pendingParks,"件"]})]}),f.unreadMessages>0&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-purple-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-sm",children:"お問い合わせ対応"})]}),e.jsxs("span",{className:"text-sm font-medium text-purple-600",children:[f.unreadMessages,"件"]})]}),0===O()&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(x,{className:"w-12 h-12 text-green-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"すべてのタスクが完了しています"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-3",children:"処理時間の目安"}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{className:"w-4 h-4"}),e.jsx("span",{children:"ワクチン証明書: 2-3分/件"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{className:"w-4 h-4"}),e.jsx("span",{children:"ドッグラン審査: 5-10分/件"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{className:"w-4 h-4"}),e.jsx("span",{children:"お問い合わせ: 3-5分/件"})]})]})]})]})]})}),"vaccines"===M&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"ワクチン証明書承認待ち"}),e.jsxs("div",{className:"text-sm text-gray-500",children:[f.pendingVaccines,"件の承認待ち"]})]}),0===b.length?e.jsxs(n,{className:"text-center py-12",children:[e.jsx(x,{className:"w-12 h-12 text-green-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"承認待ちのワクチン証明書はありません"})]}):e.jsx("div",{className:"space-y-4",children:b.map(s=>e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("h3",{className:"font-semibold",children:s.dog.name}),e.jsxs("span",{className:"text-sm text-gray-500",children:["飼い主: ",s.dog.owner.name]}),e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full",children:"承認待ち"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-600",children:["犬種: ",s.dog.breed]}),e.jsxs("p",{className:"text-gray-600",children:["性別: ",s.dog.gender]}),e.jsxs("p",{className:"text-gray-600",children:["申請日: ",new Date(s.created_at).toLocaleDateString("ja-JP")]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-600",children:["狂犬病ワクチン期限: ",s.rabies_expiry_date?new Date(s.rabies_expiry_date).toLocaleDateString("ja-JP"):"未設定"]}),e.jsxs("p",{className:"text-gray-600",children:["混合ワクチン期限: ",s.combo_expiry_date?new Date(s.combo_expiry_date).toLocaleDateString("ja-JP"):"未設定"]})]})]})]}),e.jsxs("div",{className:"flex space-x-2 ml-4",children:[e.jsx(t,{to:`/admin/management?tab=vaccines&vaccine=${s.id}`,children:e.jsxs(c,{size:"sm",variant:"secondary",children:[e.jsx(p,{className:"w-4 h-4 mr-1"}),"詳細"]})}),e.jsxs(c,{size:"sm",onClick:()=>q(s.id,!0),className:"bg-green-600 hover:bg-green-700",disabled:z,children:[e.jsx(x,{className:"w-4 h-4 mr-1"}),"承認"]}),e.jsxs(c,{size:"sm",onClick:()=>q(s.id,!1),className:"bg-red-600 hover:bg-red-700",disabled:z,children:[e.jsx(N,{className:"w-4 h-4 mr-1"}),"却下"]})]})]})},s.id))})]}),"parks"===M&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"ドッグラン審査待ち"}),e.jsxs("div",{className:"text-sm text-gray-500",children:[f.pendingParks,"件の審査待ち"]})]}),0===y.length?e.jsxs(n,{className:"text-center py-12",children:[e.jsx(x,{className:"w-12 h-12 text-green-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"審査待ちのドッグランはありません"})]}):e.jsx("div",{className:"space-y-4",children:y.map(s=>e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("h3",{className:"font-semibold",children:s.name}),e.jsx("span",{className:"text-xs bg-orange-100 text-orange-800 px-2 py-1 rounded-full",children:"pending"===s.status?"第一審査待ち":"第二審査待ち"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-600",children:["住所: ",s.address]}),e.jsxs("p",{className:"text-gray-600",children:["料金: ¥",s.price,"/時間"]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-600",children:["申請日: ",new Date(s.created_at).toLocaleDateString("ja-JP")]}),e.jsxs("p",{className:"text-gray-600",children:["審査段階: ","pending"===s.status?"第一審査":"第二審査"]})]})]})]}),e.jsxs("div",{className:"flex space-x-2 ml-4",children:[e.jsx(t,{to:`/admin/management?tab=parks&park=${s.id}`,children:e.jsxs(c,{size:"sm",variant:"secondary",children:[e.jsx(p,{className:"w-4 h-4 mr-1"}),"詳細"]})}),e.jsxs(c,{size:"sm",onClick:()=>J(s.id,!0),className:"bg-green-600 hover:bg-green-700",disabled:z,children:[e.jsx(x,{className:"w-4 h-4 mr-1"}),"承認"]}),e.jsxs(c,{size:"sm",onClick:()=>J(s.id,!1),className:"bg-red-600 hover:bg-red-700",disabled:z,children:[e.jsx(N,{className:"w-4 h-4 mr-1"}),"却下"]})]})]})},s.id))})]}),"messages"===M&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"お問い合わせ対応"}),e.jsxs("div",{className:"text-sm text-gray-500",children:[f.unreadMessages,"件の未読"]})]}),e.jsxs(n,{className:"text-center py-12",children:[e.jsx(h,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"お問い合わせ機能は準備中です"}),e.jsx("p",{className:"text-sm text-gray-500",children:"現在はメールでのお問い合わせ対応となります"})]})]})]})}export{v as AdminTasks};

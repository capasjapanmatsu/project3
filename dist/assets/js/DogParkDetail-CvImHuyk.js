import{j as e}from"./motion-BHsL7Azw.js";import{r as s}from"./react-vendor-CMvmJHsS.js";import{c as a,a as t,L as r}from"./router-DXQOdrLL.js";import{B as l,u as i,s as c}from"./index-BJKkH-_j.js";import{C as n}from"./Card-DqVnP9TA.js";import{D as d}from"./DoorLockButton-CmpYsaim.js";import{q as o,C as m,x,O as h,Q as g,j as p,J as u,V as j,P as b,R as N,M as f,U as v,u as y,d as w,i as _,t as k,K as S,X as D,Y as C,Z as I}from"./ui-basic-D1oJx_i8.js";import{I as $}from"./Input-BL9Dcu5J.js";import{S as q}from"./Select-YTmN6qyT.js";import"./heavy-features-Dlg1c9Yc.js";import"./supabase-D2tiogv8.js";function P({park:s,parkImages:a,todayRentals:t,onImageClick:r}){const l=function(e,s){const a=e/s*100;return a<25?{text:"空いています",color:"text-green-600 bg-green-100"}:a<50?{text:"やや空いています",color:"text-blue-600 bg-blue-100"}:a<75?{text:"やや混んでいます",color:"text-yellow-600 bg-yellow-100"}:{text:"混んでいます",color:"text-red-600 bg-red-100"}}(s.current_occupancy,s.max_capacity);return e.jsx(e.Fragment,{children:a.length>0&&e.jsxs("div",{className:"relative h-64 rounded-lg overflow-hidden",children:[e.jsx("img",{src:a[0].url,alt:s.name,className:"w-full h-full object-cover cursor-pointer",onClick:()=>r(0),onError:e=>{e.currentTarget.src="https://images.pexels.com/photos/1108099/pexels-photo-1108099.jpeg"}}),e.jsx("div",{className:"absolute top-4 right-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${l.color}`,children:l.text})}),t.length>0&&e.jsx("div",{className:"absolute top-4 left-4",children:e.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-orange-500 text-white",children:"本日貸し切りあり"})})]})})}function R({park:s}){return e.jsxs(n,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"設備・サービス"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:Object.entries({parking:"駐車場",shower:"シャワー設備",restroom:"トイレ",agility:"アジリティ設備",rest_area:"休憩スペース",water_station:"給水設備"}).map(([a,t])=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 rounded "+(s.facilities[a]?"bg-green-500":"bg-gray-300")}),e.jsx("span",{className:"text-sm",children:t})]},a))}),s.facility_details&&e.jsx("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-700",children:s.facility_details})})]})}function L({parkImages:s,onImageClick:a}){return s.length<=1?null:e.jsxs("div",{className:"grid grid-cols-5 gap-2",children:[s.slice(1,6).map((s,t)=>e.jsx("div",{className:"h-20 rounded-lg overflow-hidden cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>a(t+1),children:e.jsx("img",{src:s.url,alt:s.caption||`画像 ${t+2}`,className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://images.pexels.com/photos/1108099/pexels-photo-1108099.jpeg"}})},s.id)),s.length>6&&e.jsxs("div",{className:"h-20 rounded-lg overflow-hidden cursor-pointer relative bg-gray-200 flex items-center justify-center",onClick:()=>a(6),children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:e.jsxs("span",{className:"text-white font-medium",children:["+",s.length-6]})}),e.jsx("img",{src:s[6].url,alt:"その他の画像",className:"w-full h-full object-cover opacity-60"})]})]})}function F({rentalInfo:s}){return e.jsx(n,{className:"p-6 bg-orange-50 border-orange-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(o,{className:"w-6 h-6 text-orange-600 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-orange-900 mb-3",children:"施設貸し切り予約あり"}),e.jsx("p",{className:"text-sm text-orange-800 mb-4",children:"以下の日時は施設貸し切りのため、通常利用（1日券・サブスク）での入場はできません。"}),e.jsx("div",{className:"space-y-4",children:s.map((s,a)=>e.jsxs("div",{className:"bg-white p-3 rounded-lg border border-orange-200",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(m,{className:"w-5 h-5 text-orange-600"}),e.jsx("span",{className:"font-medium text-orange-900",children:new Date(s.date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric",weekday:"long"})})]}),e.jsx("div",{className:"space-y-1",children:s.slots.map((s,a)=>e.jsxs("div",{className:"flex items-center text-sm text-orange-800",children:[e.jsx(x,{className:"w-4 h-4 mr-2"}),e.jsxs("span",{children:[s.start," 〜 ",s.end]})]},a))})]},a))})]})]})})}function J({park:s,reviews:a,userReview:t,canReview:r,user:i,userDogs:c,showReviewForm:d,setShowReviewForm:o,reviewFormData:m,setReviewFormData:x,isSubmitting:N,handleReviewSubmit:f,handleDeleteReview:v}){return e.jsxs(n,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[e.jsx(h,{className:"w-6 h-6 mr-2"}),"レビュー (",s.review_count,")"]}),i&&r&&e.jsx(l,{onClick:()=>o(!d),variant:t?"secondary":"primary",size:"sm",children:t?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"w-4 h-4 mr-2"}),"レビューを編集"]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"レビューを書く"]})})]}),d&&e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-4",children:t?"レビューを編集":"レビューを投稿"}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"評価 *"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[[1,2,3,4,5].map(s=>e.jsx("button",{type:"button",onClick:()=>x({...m,rating:s}),className:"focus:outline-none",children:e.jsx(u,{className:`w-8 h-8 ${s<=m.rating?"text-yellow-400 fill-current":"text-gray-300 hover:text-yellow-300"} transition-colors`})},s)),e.jsxs("span",{className:"ml-2 text-sm text-gray-600",children:[m.rating,"つ星"]})]})]}),e.jsx(q,{label:"レビューするワンちゃん *",options:c.map(e=>({value:e.id,label:e.name})),value:m.dog_id,onChange:e=>x({...m,dog_id:e.target.value}),required:!0}),e.jsx($,{label:"訪問日 *",type:"date",value:m.visit_date,onChange:e=>x({...m,visit_date:e.target.value}),max:(new Date).toISOString().split("T")[0],required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"レビュー内容"}),e.jsx("textarea",{value:m.review_text,onChange:e=>x({...m,review_text:e.target.value}),placeholder:"ドッグランの感想をお聞かせください...",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(l,{type:"button",variant:"secondary",onClick:()=>o(!1),children:"キャンセル"}),t&&e.jsxs(l,{type:"button",onClick:v,className:"bg-red-600 hover:bg-red-700",children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"削除"]})]}),e.jsx(l,{type:"submit",isLoading:N,disabled:!m.dog_id||!m.visit_date,children:t?"更新する":"投稿する"})]})]})]}),0===a.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(h,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"まだレビューがありません"}),i&&r&&e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"最初のレビューを投稿してみませんか？"})]}):e.jsx("div",{className:"space-y-6",children:a.map(s=>e.jsx("div",{className:"border-b border-gray-200 pb-6 last:border-b-0",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center overflow-hidden",children:s.dog_image_url?e.jsx("img",{src:s.dog_image_url,alt:s.dog_name,className:"w-full h-full object-cover"}):e.jsx(b,{className:"w-6 h-6 text-gray-500"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.user_name}),e.jsx("span",{className:"text-sm text-gray-500",children:"と"}),e.jsxs("span",{className:"font-medium text-blue-600",children:[s.dog_name,"ちゃん"]}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",s.dog_breed,")"]})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("div",{className:"flex items-center space-x-1",children:[1,2,3,4,5].map(a=>e.jsx(u,{className:"w-4 h-4 "+(a<=s.rating?"text-yellow-400 fill-current":"text-gray-300")},a))}),e.jsxs("span",{className:"text-sm text-gray-600",children:[new Date(s.visit_date).toLocaleDateString("ja-JP")," に訪問"]})]})]}),e.jsx("span",{className:"text-xs text-gray-400",children:new Date(s.created_at).toLocaleDateString("ja-JP")})]}),s.review_text&&e.jsx("p",{className:"text-gray-700 leading-relaxed mb-3",children:s.review_text}),s.review_images&&s.review_images.length>0&&e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:s.review_images.map((s,a)=>e.jsxs("div",{className:"relative group cursor-pointer",children:[e.jsx("img",{src:s.url,alt:s.caption||`レビュー画像 ${a+1}`,className:"w-full h-24 object-cover rounded-lg border border-gray-200 hover:opacity-90 transition-opacity",onClick:()=>window.open(s.url,"_blank")}),s.caption&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white text-xs p-1 rounded-b-lg opacity-0 group-hover:opacity-100 transition-opacity",children:s.caption})]},a))})}),s.main_image_url&&(!s.review_images||0===s.review_images.length)&&e.jsx("div",{className:"mt-3",children:e.jsx("img",{src:s.main_image_url,alt:"レビュー画像",className:"w-full max-w-md h-48 object-cover rounded-lg border border-gray-200 cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>window.open(s.main_image_url,"_blank")})})]})]})},s.id))}),i&&!r&&e.jsx("div",{className:"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-yellow-800",children:"レビューを投稿するには、このドッグランを実際に利用する必要があります。"})})]})}function T(){const{id:m}=a(),{user:h}=i(),g=t(),[p,j]=s.useState(null),[b,$]=s.useState([]),[q,T]=s.useState(null),[E,z]=s.useState([]),[M,K]=s.useState(!1),[B,U]=s.useState(!0),[G,Q]=s.useState(!1),[V,Y]=s.useState(!1),[Z,A]=s.useState([]),[H,W]=s.useState([]),[X,ee]=s.useState(null),[se,ae]=s.useState({rating:5,review_text:"",visit_date:"",dog_id:""}),[te,re]=s.useState([]),[le,ie]=s.useState(!1),[ce,ne]=s.useState(0),[de,oe]=s.useState([]),[me,xe]=s.useState(!1),[he,ge]=s.useState(!1),[pe,ue]=s.useState(new Date),[je,be]=s.useState(null),[Ne,fe]=s.useState([]),[ve,ye]=s.useState(null);s.useEffect(()=>{m&&we()},[m,h]);const we=async()=>{try{const{data:e,error:s}=await c.from("dog_parks").select("*").eq("id",m).eq("status","approved").single();if(s)return void g("/parks");j(e);const{data:a,error:t}=await c.from("dog_park_images").select("*").eq("park_id",m).order("display_order",{ascending:!0});if(!t&&a){const s=[];e.image_url&&s.push({id:"main",url:e.image_url,caption:`${e.name} - メイン画像`}),e.cover_image_url&&s.push({id:"cover",url:e.cover_image_url,caption:`${e.name} - カバー画像`}),a.forEach(a=>{s.push({id:a.id,url:a.image_url,caption:a.caption||`${e.name} - 施設画像`})}),re(s)}const{data:r,error:l}=await c.rpc("get_park_reviews",{park_id_param:m});l||$(r||[]);const{data:i,error:n}=await c.from("reservations").select("*").eq("park_id",m).eq("reservation_type","whole_facility").eq("status","confirmed").gte("date",(new Date).toISOString().split("T")[0]);if(n);else{A(i||[]);const e=(new Date).toISOString().split("T")[0],s=i?.filter(s=>s.date===e)||[];W(s)}const{data:d,error:o}=await c.from("smart_locks").select("id, lock_id, lock_name, park_id").eq("park_id",m).eq("status","active");if(o||oe(d||[]),h){const{data:e,error:s}=await c.from("dogs").select("\n            *,\n            vaccine_certifications!inner(*)\n          ").eq("owner_id",h.id).eq("vaccine_certifications.status","approved");s||z(e||[]);const{data:a,error:t}=await c.rpc("can_user_review_park",{user_id_param:h.id,park_id_param:m});t||K(a);const{data:r,error:l}=await c.rpc("get_user_park_review",{user_id_param:h.id,park_id_param:m});if(!l&&r&&r.length>0&&(T(r[0]),ae({rating:r[0].rating,review_text:r[0].review_text||"",visit_date:r[0].visit_date,dog_id:r[0].dog_id})),de.length>0){const{data:e,error:s}=await c.rpc("check_user_park_access",{p_user_id:h.id,p_lock_id:de[0].lock_id});!s&&e&&e.has_access&&xe(!0)}const i=(new Date).toISOString().split("T")[0],{data:n,error:d}=await c.from("reservations").select("\n            *,\n            dog_park:dog_parks(*),\n            dog:dogs(*)\n          ").eq("park_id",m).eq("user_id",h.id).eq("status","confirmed").eq("date",i).order("start_time",{ascending:!0}).limit(1).single();!d&&n&&ee(n)}const{data:x,error:p}=await c.from("park_maintenance").select("*").eq("park_id",m).in("status",["scheduled","active"]).gte("end_date",(new Date).toISOString()).order("start_date",{ascending:!0});if(!p&&x){fe(x);const e=new Date,s=x.find(s=>{const a=new Date(s.start_date),t=new Date(s.end_date);return a<=e&&t>e});ye(s||null)}}catch(e){be(e.message||"エラーが発生しました"),g("/parks")}finally{U(!1)}},_e=e=>{ne(e),ie(!0)},ke=()=>{alert("PINコードを生成しました！")},Se=e=>{alert(`PINコードの生成に失敗しました: ${e}`)};if(B)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})});if(!p)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-600",children:"ドッグランが見つかりませんでした"}),e.jsx(l,{onClick:()=>g("/parks"),className:"mt-4",children:"ドッグラン一覧に戻る"})]});const De=(()=>{if(0===Z.length)return[];const e={};return Z.forEach(s=>{const a=s.date;e[a]||(e[a]={date:a,slots:[]});const t=parseInt(s.start_time),r=t+s.duration;e[a].slots.push({start:`${t.toString().padStart(2,"0")}:00`,end:`${r.toString().padStart(2,"0")}:00`})}),Object.values(e).sort((e,s)=>new Date(e.date).getTime()-new Date(s.date).getTime())})();return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[je&&e.jsx("div",{className:"mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:je}),p&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:p.name}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[e.jsx("span",{children:p.address}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["¥",p.price,"/日"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["最終更新: ",pe.toLocaleTimeString("ja-JP")]}),e.jsxs("button",{onClick:()=>{(async()=>{if(m)try{ge(!0);const{data:e,error:s}=await c.from("dog_parks").select("*").eq("id",m).single();if(s)return;j(e),ue(new Date)}catch(e){}finally{ge(!1)}})()},disabled:he,className:"flex items-center space-x-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors "+(he?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-100 text-blue-700 hover:bg-blue-200"),children:[e.jsx(N,{className:"w-4 h-4 "+(he?"animate-spin":"")}),e.jsx("span",{children:he?"更新中...":"更新"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(P,{park:p,parkImages:te,todayRentals:H,onImageClick:_e}),e.jsx(L,{parkImages:te,onImageClick:_e}),e.jsxs(n,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:p.name}),e.jsx("div",{className:"flex items-center space-x-4 mb-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"flex items-center space-x-1",children:[1,2,3,4,5].map(s=>e.jsx(u,{className:"w-5 h-5 "+(s<=Math.round(p.average_rating)?"text-yellow-400 fill-current":"text-gray-300")},s))}),e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:p.average_rating.toFixed(1)}),e.jsxs("span",{className:"text-sm text-gray-600",children:["(",p.review_count,"件のレビュー)"]})]})})]}),ve?e.jsx(l,{className:"bg-gray-400 cursor-not-allowed",disabled:!0,title:"メンテナンス中のため予約できません",children:"予約不可"}):e.jsx(r,{to:`/reservation/${p.id}`,children:e.jsx(l,{className:"bg-blue-600 hover:bg-blue-700",children:"予約する"})})]}),e.jsx("p",{className:"text-gray-700 mb-6",children:p.description}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(f,{className:"w-5 h-5 mr-3"}),e.jsx("span",{children:p.address})]}),e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(v,{className:"w-5 h-5 mr-3"}),e.jsxs("span",{children:["現在の利用者: ",p.current_occupancy,"/",p.max_capacity,"人"]})]}),e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(y,{className:"w-5 h-5 mr-3"}),e.jsxs("span",{children:["料金: ¥",p.price,"/日"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[p.large_dog_area&&e.jsxs("div",{className:"flex items-center text-blue-600",children:[e.jsx(w,{className:"w-5 h-5 mr-3"}),e.jsx("span",{children:"大型犬OK"})]}),p.small_dog_area&&e.jsxs("div",{className:"flex items-center text-pink-600",children:[e.jsx(_,{className:"w-5 h-5 mr-3"}),e.jsx("span",{children:"小型犬OK"})]}),p.private_booths&&e.jsxs("div",{className:"flex items-center text-purple-600",children:[e.jsx(k,{className:"w-5 h-5 mr-3"}),e.jsxs("span",{children:["プライベートブース ",p.private_booth_count,"室"]})]})]})]})]}),(ve||Ne.length>0)&&e.jsxs(n,{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(o,{className:"w-6 h-6 text-yellow-600 mr-2"}),"メンテナンス情報"]}),ve&&e.jsxs("div",{className:`mb-4 p-4 rounded-lg ${ve.is_emergency?"bg-red-50 border-red-200":"bg-yellow-50 border-yellow-200"} border`,children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(o,{className:"w-5 h-5 "+(ve.is_emergency?"text-red-600":"text-yellow-600")}),e.jsx("span",{className:"text-lg font-semibold "+(ve.is_emergency?"text-red-800":"text-yellow-800"),children:ve.is_emergency?"緊急メンテナンス中":"メンテナンス中"})]}),e.jsx("p",{className:`text-lg font-medium ${ve.is_emergency?"text-red-700":"text-yellow-700"} mb-2`,children:ve.title}),ve.description&&e.jsx("p",{className:`text-sm ${ve.is_emergency?"text-red-600":"text-yellow-600"} mb-3`,children:ve.description}),e.jsx("div",{className:"flex items-center space-x-4 text-sm",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(x,{className:"w-4 h-4 "+(ve.is_emergency?"text-red-600":"text-yellow-600")}),e.jsxs("span",{className:"font-medium "+(ve.is_emergency?"text-red-700":"text-yellow-700"),children:[new Date(ve.start_date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})," ",new Date(ve.start_date).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"}),"〜",new Date(ve.end_date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})," ",new Date(ve.end_date).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"})]})]})}),e.jsx("p",{className:`text-sm ${ve.is_emergency?"text-red-600":"text-yellow-600"} mt-3 font-medium`,children:"※メンテナンス期間中は休業となります"})]}),Ne.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"今後のメンテナンス予定"}),e.jsx("div",{className:"space-y-3",children:Ne.filter(e=>"scheduled"===e.status&&new Date(e.start_date)>new Date).slice(0,3).map((s,a)=>e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx(x,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"font-medium text-gray-900",children:s.title}),s.is_emergency&&e.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full",children:"緊急"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[new Date(s.start_date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})," ",new Date(s.start_date).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"}),"〜",new Date(s.end_date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})," ",new Date(s.end_date).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"})]}),s.description&&e.jsx("p",{className:"text-sm text-gray-500",children:s.description})]})})},a))})]})]}),de.length>0&&me&&e.jsxs(n,{className:"p-6 bg-blue-50 border-blue-200",children:[e.jsxs("div",{className:"flex items-start space-x-3 mb-4",children:[e.jsx(S,{className:"w-6 h-6 text-blue-600 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-blue-900 mb-2",children:"入口ドアの開錠"}),e.jsx("p",{className:"text-sm text-blue-800 mb-4",children:"PINコードを生成して入口のスマートロックを開錠できます。"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:de.map(s=>e.jsx(d,{lockId:s.lock_id,label:`${s.lock_name}のPINコードを生成`,className:"w-full",onSuccess:ke,onError:Se,reservationId:X?.id},s.id))})]}),H.length>0&&e.jsx(n,{className:"p-6 bg-orange-50 border-orange-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(o,{className:"w-6 h-6 text-orange-600 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-orange-900 mb-3",children:"本日の貸し切り時間"}),e.jsx("p",{className:"text-sm text-orange-800 mb-4",children:"以下の時間帯は施設貸し切りのため、通常利用（1日券・サブスク）での入場はできません。"}),e.jsx("div",{className:"space-y-3",children:H.map((s,a)=>{const t=parseInt(s.start_time),r=t+s.duration;return e.jsx("div",{className:"bg-white p-3 rounded-lg border border-orange-200",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(x,{className:"w-5 h-5 text-orange-600"}),e.jsxs("span",{className:"font-medium text-orange-900",children:[t,":00 〜 ",r,":00"]})]})},a)})})]})]})}),De.length>0&&e.jsx(F,{rentalInfo:De}),e.jsx(R,{park:p}),e.jsx(J,{park:p,reviews:b,userReview:q,canReview:M,user:h,userDogs:E,showReviewForm:G,setShowReviewForm:Q,reviewFormData:se,setReviewFormData:ae,isSubmitting:V,handleReviewSubmit:async e=>{if(e.preventDefault(),h&&p){Y(!0);try{if(q){const{error:e}=await c.from("dog_park_reviews").update({rating:se.rating,review_text:se.review_text,visit_date:se.visit_date,dog_id:se.dog_id,updated_at:(new Date).toISOString()}).eq("id",q.id);if(e)throw e}else{const{error:e}=await c.from("dog_park_reviews").insert([{park_id:m,user_id:h.id,dog_id:se.dog_id,rating:se.rating,review_text:se.review_text,visit_date:se.visit_date}]);if(e)throw e}await we(),Q(!1),alert(q?"レビューを更新しました！":"レビューを投稿しました！")}catch(s){alert("レビューの投稿に失敗しました。もう一度お試しください。")}finally{Y(!1)}}},handleDeleteReview:async()=>{if(q&&confirm("レビューを削除しますか？"))try{const{error:e}=await c.from("dog_park_reviews").delete().eq("id",q.id);if(e)throw e;await we(),T(null),ae({rating:5,review_text:"",visit_date:"",dog_id:""}),alert("レビューを削除しました。")}catch(e){alert("レビューの削除に失敗しました。")}}})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(n,{className:"p-4",children:e.jsx(r,{to:`/reservation/${p.id}`,children:e.jsx(l,{className:"w-full bg-blue-600 hover:bg-blue-700 text-lg py-3",children:"予約する"})})}),de.length>0&&me&&e.jsxs(n,{className:"p-4 bg-blue-50 border-blue-200",children:[e.jsxs("h3",{className:"font-semibold text-blue-900 mb-3 flex items-center",children:[e.jsx(S,{className:"w-5 h-5 text-blue-600 mr-2"}),"入口ドアを開ける"]}),e.jsx("div",{className:"space-y-3",children:de.map(s=>e.jsx(d,{lockId:s.lock_id,label:`${s.lock_name}のPINコードを生成`,className:"w-full",onSuccess:ke,onError:Se,reservationId:X?.id},s.id))})]}),e.jsxs(n,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"料金情報"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"通常利用"}),e.jsxs("span",{className:"font-medium",children:["¥",p.price,"/日"]})]}),p.private_booths&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"プライベートブース"}),e.jsx("span",{className:"font-medium text-green-600",children:"追加料金なし"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"施設貸し切り"}),e.jsx("span",{className:"font-medium",children:"¥4,400/時間"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"サブスクリプション"}),e.jsx("span",{className:"font-medium",children:"¥3,800/月"})]})]})]}),e.jsxs(n,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"現在の状況"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"利用者数"}),e.jsxs("span",{className:"font-medium",children:[p.current_occupancy,"/",p.max_capacity,"人"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-600",children:[e.jsxs("span",{children:[p.current_occupancy,"人"]}),e.jsxs("span",{children:[Math.round(p.current_occupancy/p.max_capacity*100),"%"]}),e.jsxs("span",{children:[p.max_capacity,"人"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:`h-3 rounded-full transition-all duration-300 ${O(p.current_occupancy,p.max_capacity).barColor}`,style:{width:p.current_occupancy/p.max_capacity*100+"%"}})})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-medium flex items-center justify-center space-x-1 ${O(p.current_occupancy,p.max_capacity).color}`,children:[e.jsx("span",{children:O(p.current_occupancy,p.max_capacity).emoji}),e.jsx("span",{children:O(p.current_occupancy,p.max_capacity).text})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:O(p.current_occupancy,p.max_capacity).description})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-xs text-gray-500",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{children:"リアルタイム更新中"})]})]})]}),e.jsxs(n,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"評価"}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"text-3xl font-bold text-gray-900 mb-1",children:p.average_rating.toFixed(1)}),e.jsx("div",{className:"flex items-center justify-center space-x-1",children:[1,2,3,4,5].map(s=>e.jsx(u,{className:"w-6 h-6 "+(s<=Math.round(p.average_rating)?"text-yellow-400 fill-current":"text-gray-300")},s))}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:[p.review_count,"件のレビュー"]})]}),p.review_count>0&&e.jsx("div",{className:"space-y-2",children:[5,4,3,2,1].map(s=>{const a=b.filter(e=>e.rating===s).length,t=p.review_count>0?a/p.review_count*100:0;return e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("span",{className:"w-3",children:s}),e.jsx(u,{className:"w-3 h-3 text-yellow-400 fill-current"}),e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-yellow-400 h-2 rounded-full",style:{width:`${t}%`}})}),e.jsx("span",{className:"w-8 text-right",children:a})]},s)})})]}),e.jsxs(n,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"アクセス"}),e.jsxs("div",{className:"text-sm text-gray-700 space-y-2",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(f,{className:"w-4 h-4 text-gray-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:p.address})]}),e.jsx("div",{className:"mt-3",children:e.jsx(l,{variant:"secondary",size:"sm",className:"w-full",onClick:()=>{const e=encodeURIComponent(p.address);window.open(`https://maps.google.com/maps?q=${e}`,"_blank")},children:"Google Mapsで開く"})})]})]})]})]}),le&&te.length>0&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"relative w-full max-w-4xl",children:[e.jsx("button",{onClick:()=>{ie(!1)},className:"absolute top-4 right-4 text-gray-800 bg-white bg-opacity-90 shadow-lg rounded-full p-2 hover:bg-opacity-100 transition-all z-10",children:e.jsx(D,{className:"w-6 h-6"})}),e.jsx("button",{onClick:()=>{ne(e=>(e-1+te.length)%te.length)},className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-800 bg-white bg-opacity-90 shadow-lg rounded-full p-2 hover:bg-opacity-100 transition-all z-10",children:e.jsx(C,{className:"w-6 h-6"})}),e.jsx("button",{onClick:()=>{ne(e=>(e+1)%te.length)},className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-800 bg-white bg-opacity-90 shadow-lg rounded-full p-2 hover:bg-opacity-100 transition-all z-10",children:e.jsx(I,{className:"w-6 h-6"})}),e.jsx("div",{className:"flex items-center justify-center h-[80vh]",children:e.jsx("img",{src:te[ce].url,alt:te[ce].caption||`${p.name} - 画像 ${ce+1}`,className:"max-h-full max-w-full object-contain"})}),e.jsxs("div",{className:"absolute bottom-4 left-0 right-0 text-center text-white",children:[e.jsx("p",{className:"text-sm mb-2",children:te[ce].caption}),e.jsxs("p",{className:"text-xs",children:[ce+1," / ",te.length]})]})]})})]})]})}const O=(e,s)=>{const a=e/s*100;return a<25?{text:"空いています",color:"text-green-600 bg-green-100",barColor:"bg-green-500",description:"快適に利用できます",emoji:"😊"}:a<50?{text:"やや空いています",color:"text-blue-600 bg-blue-100",barColor:"bg-blue-500",description:"適度な混雑です",emoji:"🙂"}:a<75?{text:"やや混んでいます",color:"text-yellow-600 bg-yellow-100",barColor:"bg-yellow-500",description:"少し混雑しています",emoji:"😐"}:{text:"混んでいます",color:"text-red-600 bg-red-100",barColor:"bg-red-500",description:"大変混雑しています",emoji:"😰"}};export{T as DogParkDetail};

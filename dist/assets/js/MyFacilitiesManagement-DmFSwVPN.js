import{j as e}from"./motion-CuO0nkIV.js";import{r as s}from"./react-vendor-cniURDpR.js";import{a,L as t}from"./router-Cg6wfOY4.js";import{B as l}from"./Button-CJFAG6V0.js";import{u as i,S as r,C as c,s as n}from"./index-CVZFmpsT.js";import{F as d}from"./facilities-CzfbiNCv.js";import{af as m,N as x,o,M as h,V as j,aL as g,ad as b,j as f,i as u,ac as p,a4 as N}from"./ui-basic-CaMd9YQ-.js";import"./supabase-B0bqaRGb.js";import"./heavy-features-BIdEME4r.js";function v(){const{user:v}=i(),y=a(),[w,_]=s.useState([]),[k,S]=s.useState(!0),[C,$]=s.useState(!1),[z,I]=s.useState(""),[L,q]=s.useState(!1);s.useEffect(()=>{(async()=>{if(v)try{const{data:e,error:s}=await n.from("pet_facilities").select("\n            id,\n            name,\n            description,\n            address,\n            latitude,\n            longitude,\n            phone,\n            website,\n            status,\n            category_id,\n            created_at,\n            updated_at\n          ").eq("owner_id",v?.id).order("created_at",{ascending:!1});if(s)return;const a=e?.map(e=>({...e,category:e.category_id,category_name:d[e.category_id]||"その他施設"}))||[];_(a)}catch(e){}finally{S(!1)}})()},[v]);const B=s=>{const a={approved:{bg:"bg-green-100",text:"text-green-800",label:"公開中",icon:N},pending:{bg:"bg-yellow-100",text:"text-yellow-800",label:"審査中",icon:p},rejected:{bg:"bg-red-100",text:"text-red-800",label:"却下",icon:u},suspended:{bg:"bg-gray-100",text:"text-gray-800",label:"停止中",icon:u}},t=a[s]||a.pending,l=t.icon;return e.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-medium flex items-center space-x-1 ${t.bg} ${t.text}`,children:[e.jsx(l,{className:"w-4 h-4"}),e.jsx("span",{children:t.label})]})};return k?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-teal-600"})}):e.jsxs(e.Fragment,{children:[e.jsx(r,{title:"管理中ペット関連施設一覧",description:"あなたが管理するペット関連施設の一覧と詳細管理ページです。"}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"flex items-center mb-4",children:e.jsxs(l,{variant:"secondary",size:"sm",onClick:()=>y("/dashboard"),className:"mr-4",children:[e.jsx(m,{className:"w-4 h-4 mr-1"}),"マイページに戻る"]})}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center",children:[e.jsx(x,{className:"w-8 h-8 text-teal-600 mr-3"}),"管理中ペット関連施設一覧"]}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["あなたが管理するペット関連施設 (",w.length,"施設) の詳細管理"]})]})})]}),0===w.length?e.jsxs(c,{className:"p-12 text-center",children:[e.jsx(x,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"管理中のペット関連施設がありません"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"ペットショップ、動物病院、トリミングサロンなどの施設を登録しましょう。"}),e.jsx(t,{to:"/facility-registration",children:e.jsxs(l,{className:"bg-teal-600 hover:bg-teal-700",children:[e.jsx(o,{className:"w-4 h-4 mr-2"}),"施設登録を始める"]})})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:w.map(s=>e.jsx(c,{className:"hover:shadow-lg transition-all duration-200",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:s.name}),e.jsxs("div",{className:"flex items-center text-gray-600 mb-2",children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-sm",children:s.address})]}),e.jsx("div",{className:"text-sm text-teal-600 font-medium mb-3",children:s.category_name})]}),e.jsx("div",{className:"ml-4",children:B(s.status)})]}),s.description&&e.jsx("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-700 line-clamp-3",children:s.description})}),e.jsxs("div",{className:"space-y-2 mb-6",children:[s.phone&&e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-sm",children:s.phone})]}),s.website&&e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(g,{className:"w-4 h-4 mr-2"}),e.jsx("a",{href:s.website,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-teal-600 hover:text-teal-800 underline",children:"公式サイト"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"登録日"}),e.jsx("div",{className:"font-semibold",children:s.created_at?new Date(s.created_at).toLocaleDateString():"不明"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"ステータス"}),e.jsx("div",{className:"mt-1",children:B(s.status)})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(l,{className:"flex-1 bg-teal-600 hover:bg-teal-700",onClick:()=>y(`/facilities/${s.id}/edit`),children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"管理・修正"]}),"approved"===s.status&&e.jsxs(l,{variant:"secondary",className:"px-4",onClick:()=>y(`/parks?view=facilities&facility=${s.id}`),children:[e.jsx(f,{className:"w-4 h-4 mr-2"}),"公開ページ"]})]})]})},s.id))}),e.jsxs("div",{className:"mt-8 space-y-6",children:[e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-blue-800",children:"不明な点がありましたらお気軽にお問合せください。"}),e.jsx(l,{className:"mt-3 w-full bg-blue-600 hover:bg-blue-700",onClick:()=>$(!0),children:"管理者に問い合わせ"})]}),e.jsx(t,{to:"/facility-registration",className:"block",children:e.jsxs(l,{className:"w-full bg-teal-600 hover:bg-teal-700",children:[e.jsx(o,{className:"w-4 h-4 mr-2"}),"新規施設登録"]})})]})]}),C&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-lg p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"管理者に問い合わせ"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"お問い合わせ内容をご記入ください。送信すると同時にメッセージスレッドが作成されます。"}),e.jsx("textarea",{className:"w-full border rounded-md p-3 h-32 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"お問い合わせ内容",value:z,onChange:e=>I(e.target.value)}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx(l,{variant:"secondary",onClick:()=>$(!1),children:"キャンセル"}),e.jsx(l,{className:"bg-blue-600 hover:bg-blue-700",disabled:L||!z.trim(),onClick:async()=>{if(v){q(!0);try{const{data:e}=await n.from("profiles").select("id").eq("user_type","admin").limit(1).single(),s=e?.id;if(!s)return alert("管理者に送信できませんでした"),void q(!1);await n.from("messages").insert({sender_id:v.id,receiver_id:s,content:`（管理中施設一覧からの問い合わせ）\n${z.trim()}`}),sessionStorage.setItem("communityActiveTab","messages"),sessionStorage.setItem("communityOpenPartnerId",s),y("/community")}catch(e){alert("送信に失敗しました")}finally{q(!1),$(!1),I("")}}else y("/liff/login")},children:L?"送信中...":"送信してメッセージを開く"})]})]})})]})}export{v as MyFacilitiesManagement};

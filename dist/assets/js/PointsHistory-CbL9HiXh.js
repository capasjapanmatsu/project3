import{j as e}from"./motion-CuO0nkIV.js";import{r as t}from"./react-vendor-cniURDpR.js";import{L as s}from"./router-Cg6wfOY4.js";import{u as a,C as r,s as c}from"./index-DN5wQuSm.js";import{B as l}from"./Button-CJFAG6V0.js";import{af as i,a6 as n}from"./ui-basic-CaMd9YQ-.js";import"./heavy-features-BIdEME4r.js";import"./supabase-B0bqaRGb.js";function x(){const{user:x,lineUser:o,isLineAuthenticated:d}=a(),[p,h]=t.useState(!0),[m,j]=t.useState(null),[u,y]=t.useState(0),[f,N]=t.useState([]);return t.useEffect(()=>{(async()=>{try{h(!0),j(null);const e=x?.id||o?.id;if(!e)return j("ログインが必要です"),void h(!1);const[{data:t},{data:s,error:a}]=await Promise.all([c.from("points_balances").select("balance").eq("user_id",e).maybeSingle(),c.from("points_ledger").select("*").eq("user_id",e).order("occurred_at",{ascending:!1})]);if(y(t?.balance||0),a)throw a;N(s||[])}catch(e){j(e.message||"読み込みに失敗しました")}finally{h(!1)}})()},[x?.id,o?.id,d]),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(s,{to:"/dashboard",className:"inline-flex items-center text-gray-600 hover:text-gray-800",children:[e.jsx(i,{className:"w-4 h-4 mr-2"}),"マイページへ戻る"]})}),e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx(n,{className:"w-6 h-6 text-amber-600 mr-2"}),"ポイント履歴"]}),e.jsxs(r,{className:"p-4",children:[e.jsx("div",{className:"text-gray-700",children:"保有ポイント"}),e.jsxs("div",{className:"text-3xl font-bold text-amber-600",children:[u.toLocaleString()," P"]}),e.jsx("div",{className:"mt-3",children:e.jsx(s,{to:"/petshop",children:e.jsx(l,{className:"bg-purple-600 hover:bg-purple-700 text-white",children:"ペットショップへ"})})})]}),e.jsx(r,{className:"p-0 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 text-xs uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-2 whitespace-nowrap",children:"取得日"}),e.jsx("th",{className:"text-left px-4 py-2 whitespace-nowrap",children:"項目"}),e.jsx("th",{className:"text-right px-4 py-2 whitespace-nowrap",children:"取得ポイント数"}),e.jsx("th",{className:"text-right px-4 py-2 whitespace-nowrap",children:"使用ポイント"})]})}),e.jsx("tbody",{children:p?e.jsx("tr",{children:e.jsx("td",{className:"px-4 py-6 text-center text-gray-500",colSpan:4,children:"読み込み中..."})}):m?e.jsx("tr",{children:e.jsx("td",{className:"px-4 py-6 text-center text-red-600",colSpan:4,children:m})}):0===f.length?e.jsx("tr",{children:e.jsx("td",{className:"px-4 py-6 text-center text-gray-500",colSpan:4,children:"履歴がありません"})}):f.map(t=>{const s=t.points>0?t.points:0,a=t.points<0?Math.abs(t.points):0;return e.jsxs("tr",{className:"border-t border-gray-100",children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:new Date(t.occurred_at).toLocaleString()}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:t.description}),e.jsx("td",{className:"px-4 py-2 text-right text-green-700",children:s?`+${s.toLocaleString()}`:"-"}),e.jsx("td",{className:"px-4 py-2 text-right text-red-700",children:a?`-${a.toLocaleString()}`:"-"})]},t.id)})})]})})})]})}export{x as default};

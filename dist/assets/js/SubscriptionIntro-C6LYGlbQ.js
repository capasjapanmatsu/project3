import{j as e}from"./motion-CuO0nkIV.js";import{r as s}from"./react-vendor-cniURDpR.js";import{a as t,c as a,L as r}from"./router-Cg6wfOY4.js";import{B as l}from"./Button-DiksLhRM.js";import{u as i,S as c,C as n,s as o}from"./index-DWDIgw5z.js";import{u as d}from"./useStripe-5gDQrRWD.js";import{p as m}from"./stripe-config-CouKGnnS.js";import{af as x,O as h,m as p,U as j,e as b,a4 as u,a1 as g}from"./ui-basic-icnN6BOT.js";import"./supabase-B0bqaRGb.js";import"./heavy-features-BIdEME4r.js";import"./external-api-CcgPsVUa.js";function N(){return function(){const e=new Date,s=e.getFullYear(),t=e.getMonth(),a=new Date(s,t+1,0),r=new Date(s,t,e.getDate()),l=a.getTime()-r.getTime(),i=Math.ceil(l/864e5)+1;return Math.max(1,i)}()}const f=[{Icon:j,iconColor:"text-blue-600",title:"全国どこでも使い放題",description:"登録済みドッグランが使い放題"},{Icon:h,iconColor:"text-yellow-600",title:"ペットショップ10%OFF",description:"対象ショップでのお買い物が常に10%オフ"},{Icon:b,iconColor:"text-green-600",title:"送料無料",description:"ペットショップでのご注文は送料無料"},{Icon:p,iconColor:"text-purple-600",title:"ドッグラン施設貸切20%OFF",description:"プライベート空間をお得に利用"}],y={price:3800,period:"月額"};function w(){const{user:j,lineUser:b,effectiveUserId:w}=i(),v=t(),{createCheckoutSession:_}=d(),[C]=a(),[D,I]=s.useState(!1),[S,F]=s.useState(!0),[U,L]=s.useState(""),M=m.find(e=>"subscription"===e.mode);s.useEffect(()=>{if(!(j?.id||b?.app_user_id||b?.id||w))return void F(!1);(async()=>{try{const{data:e,error:s}=await o.from("stripe_user_subscriptions").select("status").maybeSingle();I(!!("active"===e?.status||"trialing"===e?.status))}catch(e){}finally{F(!1)}})()},[j,b,w]);return S?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-blue-50 to-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"読み込み中..."})]})}):e.jsxs(e.Fragment,{children:[e.jsx(c,{title:"サブスクリプション紹介",description:"ドッグパークJPのサブスクリプションプランで、全国のドッグランが使い放題！"}),e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-blue-50 to-white",children:[e.jsx("div",{className:"bg-white shadow-sm",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 py-4",children:e.jsxs(r,{to:"/access-control",className:"inline-flex items-center text-blue-600 hover:text-blue-700",children:[e.jsx(x,{className:"w-4 h-4 mr-2"}),"戻る"]})})}),e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-12",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-r from-blue-600 to-purple-600 rounded-full mb-6",children:e.jsx(h,{className:"w-10 h-10 text-white"})}),e.jsxs("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-4",children:["サブスクリプションの",e.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600",children:"一時停止・退会"}),"は、"]}),e.jsx("p",{className:"text-xl text-gray-600 mb-2",children:"マイページよりいつでも簡単に行えます。"}),e.jsx("p",{className:"text-lg text-gray-500",children:"お客様のペースでサービスをご利用いただけます"})]}),e.jsxs("div",{className:"bg-gradient-to-r from-yellow-400 to-orange-500 rounded-2xl p-6 text-center mb-12 text-white",children:[e.jsxs("div",{className:"flex items-center justify-center mb-2",children:[e.jsx(p,{className:"w-6 h-6 mr-2"}),e.jsx("span",{className:"font-bold text-lg",children:"キャンペーン実施中"}),e.jsx(p,{className:"w-6 h-6 ml-2"})]}),e.jsx("h2",{className:"text-2xl md:text-3xl font-bold mb-2",children:"初月完全無料！今月登録すれば月末まで0円でお試し"}),e.jsx("p",{className:"text-lg opacity-90",children:"翌月1日から月額3,800円の統一料金で、いつでもキャンセル可能です"})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12",children:f.map((s,t)=>{const a=s.Icon;return e.jsxs(n,{className:"text-center p-6 hover:shadow-lg transition-shadow",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(a,{className:`w-8 h-8 ${s.iconColor}`})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:s.title}),e.jsx("p",{className:"text-gray-600 text-sm",children:s.description})]},t)})}),e.jsx("div",{className:"max-w-md mx-auto mb-8",children:e.jsxs(n,{className:"text-center p-8 border-2 border-blue-200 bg-gradient-to-b from-blue-50 to-white",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"text-5xl font-bold text-gray-900 mb-2",children:["¥",y.price.toLocaleString()]}),e.jsxs("div",{className:"text-gray-600",children:[y.period,"（税込）"]})]}),D?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center text-green-600 mb-4",children:[e.jsx(u,{className:"w-6 h-6 mr-2"}),e.jsx("span",{className:"font-semibold",children:"ご加入済み"})]}),e.jsx(l,{onClick:()=>v("/dashboard"),className:"w-full",children:"ダッシュボードに移動"})]}):e.jsx(l,{onClick:()=>{(async()=>{const e=j?.id||b?.app_user_id||b?.id||w;if(e)if(D)v("/dashboard");else try{L("");const{data:t,error:a}=await o.from("stripe_user_subscriptions").select("id, created_at").eq("user_id",e).order("created_at",{ascending:!1}),r=t&&t.length>0;let l=0;if(r)l=0;else try{l=N()}catch(s){l=30}const i=M?.priceId||"price_1RZpDjAHWLDQ7ynZP7zD3TQB";await _({priceId:i,mode:"subscription",trialPeriodDays:l,successUrl:`${window.location.origin}/dashboard?subscription=success`,cancelUrl:`${window.location.origin}/subscription-intro?canceled=true`})}catch(t){L("決済ページの作成に失敗しました。しばらく時間をおいてから再度お試しください。")}else v("/login?redirect=/subscription-intro&message=サブスクリプションにご加入いただくには、まずログインが必要です。")})()},className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-lg py-4",disabled:S,children:e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsx(g,{className:"w-5 h-5 mr-2"}),"今すぐ無料で始める（翌月から月額3,800円）"]})})]})}),U&&e.jsx("div",{className:"max-w-md mx-auto mb-8",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-center",children:e.jsx("p",{className:"text-red-600 text-sm",children:U})})}),"true"===C.get("canceled")&&e.jsx("div",{className:"max-w-md mx-auto mb-8",children:e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-center",children:e.jsx("p",{className:"text-yellow-700",children:"決済ページの作成に失敗しました。もう一度お試しください。"})})}),e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("h2",{className:"text-2xl font-bold text-center text-gray-900 mb-8",children:"よくある質問"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(n,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"初月無料はどのような仕組みですか？"}),e.jsx("p",{className:"text-gray-600",children:"新規登録の方は、登録月の月末まで無料でご利用いただけます。例えば1月15日に登録された場合、1月31日まで無料で、2月1日から月額3,800円の課金が開始されます。"})]}),e.jsxs(n,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"解約はいつでもできますか？"}),e.jsx("p",{className:"text-gray-600",children:"はい、マイページからいつでも解約・一時停止が可能です。解約手数料等は一切かかりません。"})]}),e.jsxs(n,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"ペットショップの割引はどこで利用できますか？"}),e.jsxs("p",{className:"text-gray-600",children:["詳細は",e.jsx(r,{to:"/petshop",className:"text-blue-600 hover:text-blue-700 underline ml-1",children:"ペットショップページ"}),"をご確認ください。対象店舗や商品の最新情報を掲載しています。"]})]}),e.jsxs(n,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"一度解約して再登録した場合も初月無料になりますか？"}),e.jsx("p",{className:"text-gray-600",children:"申し訳ございませんが、初月無料は新規登録時のみの特典です。再登録の場合は、何日からでも月額3,800円（月末まで）の満額請求となります。"})]})]})]})]})]})]})}export{w as SubscriptionIntro};

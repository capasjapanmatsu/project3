import{j as e,A as t,m as s}from"./motion-CuO0nkIV.js";import{r as a}from"./react-vendor-cniURDpR.js";import{u as i,s as r}from"./index-Cxr3hxlQ.js";import{B as o}from"./Button-BVIkPLCk.js";import{a as n}from"./router-Cg6wfOY4.js";import{n as l,e as d,G as c,X as x,o as h}from"./ui-basic-icnN6BOT.js";import"./heavy-features-BIdEME4r.js";import"./supabase-B0bqaRGb.js";function p(){const[t,s]=a.useState(""),[i,r]=a.useState(""),[n,l]=a.useState(!1);return e.jsxs("div",{className:"p-4 bg-white rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"お問い合わせ（AI）"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{className:"flex-1 border rounded px-3 py-2",value:t,onChange:e=>s(e.target.value),placeholder:"ご質問を入力してください"}),e.jsx(o,{onClick:async()=>{if(t.trim()){l(!0),r("");try{let e=await fetch("/api/assistant-chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:t})});404===e.status&&(e=await fetch("/.netlify/functions/assistant-chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:t})}));const s=await e.json().catch(()=>({}));r(s.reply||(e.ok?"":"エラーが発生しました。しばらくしてからお試しください。"))}catch(e){r("エラーが発生しました。しばらくしてからお試しください。")}finally{l(!1)}}},disabled:n,children:n?"送信中…":"送信"})]}),i&&e.jsx("div",{className:"mt-3 text-sm text-gray-800 whitespace-pre-wrap",children:i})]})}const m=()=>{const{user:o}=i(),m=n(),[b,u]=a.useState(!1),[f,w]=a.useState([]),[v,g]=a.useState(!1),[j,y]=a.useState(!1);a.useEffect(()=>{o&&N()},[o]);const N=async()=>{if(o)try{g(!0);const{data:e,error:t}=await r.from("user_coupons").select("\n          *,\n          facility_coupons (\n            id, facility_id, title, service_content, discount_value, discount_type, description, start_date, end_date, usage_limit_type, coupon_image_url,\n            pet_facilities (name)\n          )\n        ").eq("user_id",o?.id).is("used_at",null).gte("facility_coupons.end_date",(new Date).toISOString());t||w(e||[])}catch(e){}finally{g(!1)}};return a.useEffect(()=>{const e=()=>{o&&N()};return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[o]),o?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"fixed bottom-28 right-4 z-40",children:[e.jsx(t,{children:b&&e.jsxs(s.div,{initial:"hidden",animate:"visible",exit:"exit",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{when:"beforeChildren",staggerChildren:.05}},exit:{opacity:0,transition:{when:"afterChildren"}}},className:"absolute bottom-24 -right-28 flex flex-col space-y-3",children:[e.jsxs(s.button,{variants:{hidden:{x:40,opacity:0},visible:{x:0,opacity:1},exit:{x:40,opacity:0}},onClick:()=>{y(!0),u(!1)},"aria-label":"AIチャット",className:"flex items-center bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white rounded-full px-12 py-4 shadow-xl transform transition-all duration-300 hover:scale-105 hover:-translate-x-2 min-w-[300px] border-2 border-white/20",children:[e.jsx(l,{className:"w-5 h-5 mr-3 drop-shadow-sm"}),e.jsxs("div",{className:"text-left",children:[e.jsx("span",{className:"text-sm font-bold whitespace-nowrap block",children:"AIチャット"}),e.jsx("span",{className:"text-xs opacity-90 whitespace-nowrap block",children:"質問にすぐ回答します"})]})]}),e.jsxs(s.button,{variants:{hidden:{x:40,opacity:0},visible:{x:0,opacity:1},exit:{x:40,opacity:0}},onClick:()=>{u(!1),m("/jp-passport")},"aria-label":"JPパスポート - ワクチン証明書を表示",className:"flex items-center bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 text-white rounded-full px-12 py-4 shadow-xl transform transition-all duration-300 hover:scale-105 hover:-translate-x-2 min-w-[300px] border-2 border-white/20",children:[e.jsx(d,{className:"w-5 h-5 mr-3 drop-shadow-sm"}),e.jsxs("div",{className:"text-left",children:[e.jsx("span",{className:"text-sm font-bold whitespace-nowrap block",children:"JPパスポート"}),e.jsx("span",{className:"text-xs opacity-90 whitespace-nowrap block",children:"ワクチン証明書表示"})]})]}),e.jsx(s.div,{variants:{hidden:{x:40,opacity:0},visible:{x:0,opacity:1},exit:{x:40,opacity:0}},className:"w-full h-px bg-gradient-to-r from-transparent via-gray-300 to-transparent opacity-50"}),e.jsxs(s.button,{variants:{hidden:{x:40,opacity:0},visible:{x:0,opacity:1},exit:{x:40,opacity:0}},onClick:()=>{N().then(()=>{0===f.length?m("/parks?view=facilities"):m("/my-coupons")}),u(!1)},"aria-label":`クーポンを表示 - ${f.length}枚保有`,className:"flex items-center bg-gradient-to-r from-pink-500 to-rose-500 hover:from-pink-600 hover:to-rose-600 text-white rounded-full px-12 py-4 shadow-xl transform transition-all duration-300 hover:scale-105 hover:-translate-x-2 min-w-[300px] border-2 border-white/20",children:[e.jsx(c,{className:"w-5 h-5 mr-3 drop-shadow-sm"}),e.jsxs("div",{className:"text-left",children:[e.jsxs("span",{className:"text-sm font-bold whitespace-nowrap block",children:["クーポン (",f.length,")"]}),e.jsx("span",{className:"text-xs opacity-90 whitespace-nowrap block",children:"店舗利用時に表示"})]})]})]})}),e.jsx("button",{onClick:()=>{u(!b)},"aria-label":b?"メニューを閉じる":"メニューを開く","aria-expanded":b,"aria-haspopup":"menu",className:"w-16 h-16 rounded-full shadow-2xl flex items-center justify-center transform transition-all duration-300 border-4 border-white/30 backdrop-blur-sm "+(b?"bg-gradient-to-br from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 rotate-45 scale-95":"bg-blue-600 hover:bg-blue-700 hover:scale-110 hover:shadow-blue-500/25"),style:{boxShadow:b?"0 15px 30px rgba(239, 68, 68, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.2)":"0 15px 30px rgba(59, 130, 246, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.2)"},children:e.jsxs("div",{className:"relative",children:[b?e.jsx(x,{className:"w-6 h-6 text-white drop-shadow-lg"}):e.jsx(h,{className:"w-6 h-6 text-white drop-shadow-lg"}),!b&&f.length>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-pink-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center border-2 border-white shadow-lg",children:f.length})]})})]}),b&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25 z-30",onClick:()=>{u(!1)}}),j&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>y(!1)}),e.jsxs("div",{className:"relative z-10 w-[92vw] max-w-xl max-h-[80vh] overflow-auto bg-white rounded-xl shadow-2xl border",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b bg-gradient-to-r from-indigo-50 to-purple-50 rounded-t-xl",children:[e.jsxs("div",{className:"font-semibold text-gray-800 flex items-center",children:[e.jsx(l,{className:"w-4 h-4 mr-2 text-indigo-600"}),"AIチャット"]}),e.jsx("button",{onClick:()=>y(!1),className:"p-2 rounded hover:bg-gray-100","aria-label":"閉じる",children:e.jsx(x,{className:"w-5 h-5 text-gray-700"})})]}),e.jsx("div",{className:"p-4",children:e.jsx(p,{})})]})]})]}):null};export{m as FloatingActionButton,m as default};

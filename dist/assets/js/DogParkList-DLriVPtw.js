import{j as e}from"./motion-BHsL7Azw.js";import{r as t}from"./react-vendor-CMvmJHsS.js";import{L as s,a}from"./router-DXQOdrLL.js";import{B as r,a as i,u as l,s as n}from"./index-DXPL9L2a.js";import{i as c,t as o,M as d,N as m,u as x,U as h,v as u,w as g,x as p,s as f,h as b,y,H as j,k as N,z as v,I as w,J as _,q as k,R as M}from"./ui-basic-D1oJx_i8.js";import{C}from"./Card-DqVnP9TA.js";import"./heavy-features-Dlg1c9Yc.js";import"./supabase-D2tiogv8.js";const $=e=>e<1?`${Math.round(1e3*e)}m`:`${e.toFixed(1)}km`;function I({park:t,userLocation:a,distance:i}){const l=i||(a&&t.latitude&&t.longitude?((e,t,s,a)=>{const r=(s-e)*Math.PI/180,i=(a-t)*Math.PI/180,l=Math.sin(r/2)*Math.sin(r/2)+Math.cos(e*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(i/2)*Math.sin(i/2);return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371})(a.lat,a.lng,Number(t.latitude),Number(t.longitude)):null),n=(()=>{if(!t.current_occupancy||!t.max_capacity)return{label:"æƒ…å ±ãªã—",color:"text-gray-500",bgColor:"bg-gray-100"};const e=t.current_occupancy/t.max_capacity*100;return e>=90?{label:"æº€å“¡",color:"text-red-600",bgColor:"bg-red-100"}:e>=70?{label:"æ··é›‘",color:"text-orange-600",bgColor:"bg-orange-100"}:e>=40?{label:"æ™®é€š",color:"text-yellow-600",bgColor:"bg-yellow-100"}:{label:"ç©ºã„ã¦ã„ã‚‹",color:"text-green-600",bgColor:"bg-green-100"}})();return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:[t.image_url&&e.jsxs("div",{className:"aspect-square relative overflow-hidden rounded-t-lg",children:[e.jsx("img",{src:t.image_url,alt:t.name,className:"w-full h-full object-cover"}),e.jsx("button",{className:"absolute top-3 right-3 p-2 bg-white/80 backdrop-blur-sm rounded-full hover:bg-white transition-colors",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:e.jsx(c,{className:"w-4 h-4 text-gray-600 hover:text-red-500"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-900 flex-1",children:t.name}),e.jsx("div",{className:"flex items-center space-x-2 ml-2",children:e.jsxs("span",{className:"flex items-center text-green-600 text-sm",children:[e.jsx(o,{className:"w-4 h-4 mr-1"}),"å–¶æ¥­ä¸­"]})})]}),e.jsxs("div",{className:"space-y-2 mb-2",children:[t.address&&e.jsxs("div",{className:"flex items-center text-gray-600 text-sm",children:[e.jsx(d,{className:"w-4 h-4 mr-1 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:t.address})]}),l&&e.jsxs("div",{className:"flex items-center text-blue-600 text-sm font-medium",children:[e.jsx(m,{className:"w-4 h-4 mr-1"}),e.jsxs("span",{children:["ç¾åœ¨åœ°ã‹ã‚‰ ",$(l)]})]})]}),t.price&&e.jsxs("div",{className:"flex items-center text-gray-600 text-sm mb-3",children:[e.jsx(x,{className:"w-4 h-4 mr-1"}),e.jsxs("span",{children:["Â¥",t.price,"/æ™‚é–“"]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(h,{className:"w-4 h-4 mr-1 text-gray-600"}),e.jsx("span",{className:"text-sm text-gray-600",children:"æ··é›‘çŠ¶æ³:"})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${n.color} ${n.bgColor}`,children:n.label})]}),void 0!==t.current_occupancy&&t.max_capacity&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-1",children:[e.jsx("span",{children:"ç¾åœ¨ã®åˆ©ç”¨è€…"}),e.jsxs("span",{children:[t.current_occupancy," / ",t.max_capacity,"å"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"h-2 rounded-full transition-all duration-300 "+(t.current_occupancy/t.max_capacity>=.9?"bg-red-500":t.current_occupancy/t.max_capacity>=.7?"bg-orange-500":t.current_occupancy/t.max_capacity>=.4?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(t.current_occupancy/t.max_capacity*100,100)}%`}})})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(s,{to:`/parks/${t.id}`,className:"flex-1",children:e.jsxs(r,{variant:"outline",className:"w-full flex items-center justify-center",children:[e.jsx(u,{className:"w-4 h-4 mr-1"}),"è©³ç´°ã‚’è¦‹ã‚‹"]})}),t.current_occupancy<t.max_capacity&&e.jsx(s,{to:`/reservation/${t.id}`,className:"flex-1",children:e.jsx(r,{className:"w-full",children:"äºˆç´„ã™ã‚‹"})})]})]})]})}function P({icon:t,title:s,description:a,action:i,className:l=""}){return e.jsxs("div",{className:`flex flex-col items-center justify-center py-12 px-4 text-center ${l}`,children:[e.jsx("div",{className:"mb-4 text-gray-400",children:t||e.jsx(g,{className:"w-16 h-16"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:s}),a&&e.jsx("p",{className:"text-gray-600 max-w-md mb-6",children:a}),i&&e.jsx(r,{onClick:i.onClick,variant:"outline",children:i.label})]})}const S={veterinary_clinic:{icon:w,label:"å‹•ç‰©ç—…é™¢",color:"text-red-600"},pet_friendly_restaurant:{icon:v,label:"ãƒšãƒƒãƒˆåŒä¼´ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³",color:"text-orange-600"},pet_shop:{icon:N,label:"ãƒšãƒƒãƒˆã‚·ãƒ§ãƒƒãƒ—",color:"text-blue-600"},pet_friendly_hotel:{icon:j,label:"ãƒšãƒƒãƒˆåŒä¼´å®¿æ³Š",color:"text-green-600"},pet_salon:{icon:b,label:"ãƒšãƒƒãƒˆã‚µãƒ­ãƒ³",color:"text-purple-600"},pet_hotel:{icon:y,label:"ãƒšãƒƒãƒˆãƒ›ãƒ†ãƒ«",color:"text-indigo-600"},other:{icon:b,label:"ãã®ä»–",color:"text-gray-600"}};function z({facility:t,showDistance:a,distance:i}){const l=(n=t.category)&&n in S?S[n]:S.other;var n;const o=l.icon,x=(()=>{const e=new Date,s=100*e.getHours()+e.getMinutes();if(t.opening_hours&&t.closing_hours){const e=parseInt(t.opening_hours.replace(":",""),10),a=parseInt(t.closing_hours.replace(":",""),10);return s>=e&&s<=a}return!0})();return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:[t.image_url&&e.jsxs("div",{className:"aspect-square relative overflow-hidden rounded-t-lg",children:[e.jsx("img",{src:t.image_url,alt:t.name,className:"w-full h-full object-cover",loading:"lazy"}),e.jsx("button",{className:"absolute top-3 right-3 p-2 bg-white/80 backdrop-blur-sm rounded-full hover:bg-white transition-colors",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:e.jsx(c,{className:"w-4 h-4 text-gray-600 hover:text-red-500"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{className:`w-5 h-5 ${l.color}`}),e.jsx("span",{className:"text-sm text-gray-600",children:l.label})]}),x?e.jsx("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full",children:"å–¶æ¥­ä¸­"}):e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full",children:"å–¶æ¥­æ™‚é–“å¤–"})]}),e.jsx("h3",{className:"font-semibold text-lg text-gray-900 mb-2 line-clamp-2",children:t.name}),t.rating&&e.jsx("div",{className:"mb-2",children:(g=t.rating,g?e.jsxs("div",{className:"flex items-center space-x-1",children:[[1,2,3,4,5].map(t=>e.jsx(_,{className:"w-4 h-4 "+(t<=g?"text-yellow-400 fill-current":"text-gray-300")},t)),e.jsxs("span",{className:"text-sm text-gray-600 ml-1",children:["(",g,")"]})]}):null)}),t.address&&e.jsxs("div",{className:"flex items-start text-gray-600 text-sm mb-2",children:[e.jsx(d,{className:"w-4 h-4 mr-1 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"line-clamp-2",children:t.address})]}),a&&i&&e.jsxs("div",{className:"flex items-center text-gray-600 text-sm mb-2",children:[e.jsx(m,{className:"w-4 h-4 mr-1"}),e.jsxs("span",{children:["ç¾åœ¨åœ°ã‹ã‚‰ ",(h=i,h?h<1?`${Math.round(1e3*h)}m`:`${h.toFixed(1)}km`:"")]})]}),t.opening_hours&&t.closing_hours&&e.jsxs("div",{className:"flex items-center text-gray-600 text-sm mb-2",children:[e.jsx(p,{className:"w-4 h-4 mr-1"}),e.jsxs("span",{children:[t.opening_hours," - ",t.closing_hours]})]}),t.phone&&e.jsxs("div",{className:"flex items-center text-gray-600 text-sm mb-3",children:[e.jsx(f,{className:"w-4 h-4 mr-1"}),e.jsx("a",{href:`tel:${t.phone}`,className:"hover:text-blue-600 transition-colors",onClick:e=>e.stopPropagation(),children:t.phone})]}),t.description&&e.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-2",children:t.description}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(s,{to:`/facilities/${t.id}`,className:"flex-1",children:e.jsxs(r,{variant:"outline",className:"w-full flex items-center justify-center",children:[e.jsx(u,{className:"w-4 h-4 mr-1"}),"è©³ç´°ã‚’è¦‹ã‚‹"]})}),t.website_url&&e.jsx("a",{href:t.website_url,target:"_blank",rel:"noopener noreferrer",className:"flex-1",onClick:e=>e.stopPropagation(),children:e.jsx(r,{className:"w-full",children:"ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆ"})})]})]})]});var h,g}function L({message:t="ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­..."}){return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:t})]})})}function E({error:t,onRetry:s}){return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md mx-auto px-4",children:[e.jsx(k,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ"}),e.jsx("p",{className:"text-gray-600 mb-4",children:t}),e.jsxs(r,{onClick:s,className:"inline-flex items-center",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"å†è©¦è¡Œ"]})]})})}function T({parks:s=[],facilities:c=[],activeView:o="dogparks",onLocationSelect:x,center:h,userLocation:u,className:g=""}){const p=t.useRef(null),[f,b]=t.useState(u||null),[y,j]=t.useState(""),[N,v]=t.useState(!1),[w,_]=t.useState(null),[k,M]=t.useState(!1),{isLoaded:$,isLoading:I,error:P}=i(),{user:S}=l(),[z,L]=t.useState([]),E=a(),T='\n    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <circle cx="16" cy="16" r="15" fill="#EF4444" stroke="white" stroke-width="2"/>\n      <path d="M10 12c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zm8 0c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zM8 18c0-2.2 3.6-4 8-4s8 1.8 8 4c0 1.1-3.6 2-8 2s-8-.9-8-2z" fill="white"/>\n      <path d="M14 16h4v2h-4z" fill="#EF4444"/>\n    </svg>\n  ',q=t.useCallback((e,t,s,a)=>{const r=(s-e)*Math.PI/180,i=(a-t)*Math.PI/180,l=Math.sin(r/2)*Math.sin(r/2)+Math.cos(e*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(i/2)*Math.sin(i/2);return 6371*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))},[]),A=t.useCallback(e=>e<1?`${Math.round(1e3*e)}m`:`${e.toFixed(1)}km`,[]),F=t.useCallback((e,t)=>{const s=e.name||"åå‰æœªè¨­å®š",a="park"===t?`/parks/${e.id}`:`/facilities/${e.id}`;let r="";if(f&&e.latitude&&e.longitude){const t=q(f.lat,f.lng,e.latitude,e.longitude);r=`\n        <p style="\n          font-size: 12px;\n          color: #6b7280;\n          margin: 4px 0 8px 0;\n          display: flex;\n          align-items: center;\n        ">\n          <span style="margin-right: 4px;">ğŸ“</span>\n          ç¾åœ¨åœ°ã‹ã‚‰ ${A(t)}\n        </p>\n      `}return`\n      <div style="\n        min-width: 200px;\n        max-width: 240px;\n        padding: 12px;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      ">\n        <h3 style="\n          font-size: 14px;\n          font-weight: 600;\n          margin: 0 0 4px 0;\n          color: #1f2937;\n          line-height: 1.3;\n        ">${s}</h3>\n        \n        ${r}\n        \n        <button\n          onclick="window.infoWindowNavigate('${a}')"\n          style="\n            width: 100%;\n            background: #3b82f6;\n            color: white;\n            border: none;\n            padding: 8px 12px;\n            border-radius: 6px;\n            font-size: 12px;\n            font-weight: 500;\n            cursor: pointer;\n            transition: background-color 0.2s;\n          "\n          onmouseover="this.style.background='#2563eb'"\n          onmouseout="this.style.background='#3b82f6'"\n        >\n          è©³ç´°ã‚’è¦‹ã‚‹\n        </button>\n      </div>\n    `},[f,q,A]);t.useEffect(()=>(window.infoWindowNavigate=e=>{E(e)},()=>{delete window.infoWindowNavigate}),[E]);const R=t.useCallback(e=>{try{const t=window,a=new t.google.maps.InfoWindow;_(a),"dogparks"===o&&s&&s.forEach(s=>{if(s.latitude&&s.longitude){const r=new t.google.maps.Marker({position:{lat:s.latitude,lng:s.longitude},map:e,title:s.name,icon:{url:`data:image/svg+xml;charset=utf-8,${encodeURIComponent('\n                  <svg width="32" height="32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">\n                    <circle cx="16" cy="16" r="12" fill="#3B82F6" stroke="white" stroke-width="2"/>\n                    <path d="M12 10h8v2h-8zm0 4h8v2h-8zm0 4h6v2h-6z" fill="white"/>\n                  </svg>\n                ')}`}});r.addListener("click",()=>{const t=F(s,"park");a.setContent(t),a.open(e,r)})}}),"facilities"===o&&c&&c.forEach(s=>{if(s.latitude&&s.longitude){const r=new t.google.maps.Marker({position:{lat:s.latitude,lng:s.longitude},map:e,title:s.name,icon:{url:`data:image/svg+xml;charset=utf-8,${encodeURIComponent('\n                  <svg width="32" height="32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">\n                    <circle cx="16" cy="16" r="12" fill="#10B981" stroke="white" stroke-width="2"/>\n                    <path d="M10 14h12v2h-12zm2-4h8v2h-8zm-2 8h12v2h-12z" fill="white"/>\n                  </svg>\n                ')}`}});r.addListener("click",()=>{const t=F(s,"facility");a.setContent(t),a.open(e,r)})}}),f&&new t.google.maps.Marker({position:f,map:e,title:"ç¾åœ¨åœ°",icon:{url:`data:image/svg+xml;charset=utf-8,${encodeURIComponent(T)}`}})}catch(t){}},[o,s,c,f,T,F]),D=t.useCallback(e=>{try{const t=globalThis.window;if(!t.google?.maps||!$)return;const s={center:u||f||h||{lat:35.6762,lng:139.6503},zoom:13,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.business",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.attraction",stylers:[{visibility:"off"}]},{featureType:"poi.government",stylers:[{visibility:"off"}]},{featureType:"poi.medical",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",stylers:[{visibility:"off"}]},{featureType:"poi.school",stylers:[{visibility:"off"}]},{featureType:"poi.sports_complex",stylers:[{visibility:"off"}]}],mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1,zoomControl:!0,scrollwheel:!0,disableDoubleClickZoom:!1},a=new t.google.maps.Map(e,s);R(a),j(""),M(!0)}catch(t){j("åœ°å›³ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ")}},[u,f,h,R,$]);t.useEffect(()=>{p.current&&($&&!P?D(p.current):P&&j(P))},[$,P,D]);const B=t.useCallback(()=>{navigator.geolocation?(v(!0),navigator.geolocation.getCurrentPosition(e=>{const t={lat:e.coords.latitude,lng:e.coords.longitude};b(t),v(!1),x&&x(t)},e=>{v(!1)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e5})):j("ä½ç½®æƒ…å ±ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“")},[x]);if(t.useEffect(()=>{u||f||navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{const t={lat:e.coords.latitude,lng:e.coords.longitude};b(t),x&&x(t)},e=>{},{enableHighAccuracy:!1,timeout:8e3,maximumAge:3e5})},[u,f,x]),t.useEffect(()=>{(async()=>{if(S)try{const{data:e,error:t}=await n.from("dogs").select("id, name, image_url").eq("user_id",S.id).order("created_at",{ascending:!0});!t&&e&&e.length>0&&L(e)}catch(e){}})()},[S]),P)return e.jsxs(C,{className:`p-6 text-center ${g}`,children:[e.jsx(d,{className:"w-12 h-12 text-yellow-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"ãƒãƒƒãƒ—æ©Ÿèƒ½ã¯ç¾åœ¨åˆ©ç”¨ã§ãã¾ã›ã‚“"}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:P}),e.jsx("div",{className:"text-xs text-gray-500",children:e.jsxs("p",{children:["dogparks"===o?"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³":"ãƒšãƒƒãƒˆæ–½è¨­",": ","dogparks"===o?s.length:c.length,"ä»¶"]})})]});if(y&&y!==P)return e.jsxs(C,{className:`p-6 text-center ${g}`,children:[e.jsx(d,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"ãƒãƒƒãƒ—ã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸ"}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:y}),e.jsx(r,{onClick:()=>{j(""),M(!1),p.current&&D(p.current)},children:"å†èª­ã¿è¾¼ã¿"})]});const H=("dogparks"===o?s:c).length;return e.jsxs(C,{className:`overflow-hidden ${g}`,children:[e.jsxs("div",{className:"p-4 border-b bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(d,{className:"w-5 h-5 text-blue-600 mr-2"}),e.jsxs("h3",{className:"font-semibold",children:["dogparks"===o?"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³":"ãƒšãƒƒãƒˆæ–½è¨­","ãƒãƒƒãƒ—"]})]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[H,"ä»¶"]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("div",{className:"flex items-center space-x-4 text-xs",children:["dogparks"===o&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-600 rounded-full mr-2"}),e.jsx("span",{children:"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³"})]}),"facilities"===o&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-green-600 rounded-full mr-2"}),e.jsx("span",{children:"ãƒšãƒƒãƒˆæ–½è¨­"})]}),f&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full mr-2"}),e.jsx("span",{children:"ç¾åœ¨åœ°"})]})]}),e.jsxs(r,{size:"sm",variant:"secondary",onClick:B,className:"text-xs",disabled:N,children:[e.jsx(m,{className:"w-3 h-3 mr-1"}),N?"å–å¾—ä¸­...":"ç¾åœ¨åœ°"]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{ref:p,className:"w-full h-96",style:{minHeight:"400px"}}),(I||!k)&&!P&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:I?"Google Maps APIã‚’èª­ã¿è¾¼ã¿ä¸­...":"ãƒãƒƒãƒ—ã‚’åˆæœŸåŒ–ä¸­..."})]})})]}),e.jsx("div",{className:"p-3 border-t bg-gray-50 text-xs text-gray-500 text-center",children:P?"ãƒãƒƒãƒ—æ©Ÿèƒ½ã¯ç¾åœ¨åˆ©ç”¨ã§ãã¾ã›ã‚“":"ãƒãƒ¼ã‚«ãƒ¼ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨è©³ç´°æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™"})]})}const q={pet_hotel:"ãƒšãƒƒãƒˆãƒ›ãƒ†ãƒ«",pet_salon:"ãƒšãƒƒãƒˆã‚µãƒ­ãƒ³",veterinary:"å‹•ç‰©ç—…é™¢",pet_cafe:"ãƒšãƒƒãƒˆã‚«ãƒ•ã‚§",pet_restaurant:"ãƒšãƒƒãƒˆåŒä¼´ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³",pet_shop:"ãƒšãƒƒãƒˆã‚·ãƒ§ãƒƒãƒ—",pet_accommodation:"ãƒšãƒƒãƒˆåŒä¼´å®¿æ³Š",dog_training:"ã—ã¤ã‘æ•™å®¤",pet_friendly_other:"ãã®ä»–ãƒ¯ãƒ³ã¡ã‚ƒã‚“åŒä¼´å¯èƒ½æ–½è¨­"},A=(e,t,s,a)=>{const r=(s-e)*Math.PI/180,i=(a-t)*Math.PI/180,l=Math.sin(r/2)*Math.sin(r/2)+Math.cos(e*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(i/2)*Math.sin(i/2);return 6371*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))},F=e=>({pet_hotel:"ğŸ¨",pet_salon:"âœ‚ï¸",veterinary:"ğŸ¥",pet_cafe:"â˜•",pet_restaurant:"ğŸ½ï¸",pet_shop:"ğŸ›ï¸",pet_accommodation:"ğŸ ",dog_training:"ğŸ“",pet_friendly_other:"ğŸŒŸ"}[e]||"ğŸ¢");function R(){const[s,a]=t.useState("dogparks"),[r,i]=t.useState(null),[c,o]=t.useState(!1),[d,m]=t.useState(Object.keys(q)),[x,h]=t.useState(null),[u,g]=t.useState(!1),{user:p,isAuthenticated:f}=l(),{parks:b,isLoading:y,error:j,fetchParkData:N}=function(){const[e,s]=t.useState([]),[a,r]=t.useState(!1),[i,l]=t.useState(null);return{parks:e,isLoading:a,error:i,fetchParkData:t.useCallback(async()=>{try{r(!0),l(null);const{data:e,error:t}=await n.from("dog_parks").select("\n          *,\n          profiles:owner_id (\n            name,\n            address,\n            phone_number,\n            email,\n            postal_code\n          )\n        ").eq("status","approved").order("created_at",{ascending:!1});if(t)throw t;const a=(e||[]).map(e=>(Array.isArray(e.profiles)?e.profiles[0]:e.profiles,{id:e.id||"",name:e.name||"",description:e.description||e.facility_details||"",address:e.address||"",latitude:Number(e.latitude)||0,longitude:Number(e.longitude)||0,max_capacity:Number(e.max_capacity)||20,current_occupancy:Number(e.current_occupancy)||0,price:Number(e.price)||Number(e.hourly_rate)||0,status:e.status||"approved",facilities:e.facilities?"object"==typeof e.facilities?Object.entries(e.facilities).filter(([e,t])=>t).map(([e])=>e).join(","):e.facilities:e.facility_details||"",image_url:e.image_url||e.cover_image_url||"https://via.placeholder.com/400x300?text="+encodeURIComponent(e.name||"ãƒ‰ãƒƒã‚°ãƒ‘ãƒ¼ã‚¯"),average_rating:Number(e.average_rating)||4,review_count:Number(e.review_count)||Math.floor(50*Math.random())+5,created_at:e.created_at||""}));s(a)}catch(e){const t=e instanceof Error?e.message:"ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ";l(t)}finally{r(!1)}},[]),setError:l,setIsLoading:r}}(),{facilities:v,facilitiesLoading:w,error:_,fetchFacilities:k}=function(){const[e,s]=t.useState([]),[a,r]=t.useState(!1),[i,l]=t.useState(null);return{facilities:e,facilitiesLoading:a,error:i,fetchFacilities:t.useCallback(async()=>{try{r(!0),l(null);const{data:e,error:t}=await n.from("pet_facilities").select("*").eq("status","approved").order("name");if(t)throw t;const a=(e||[]).map(e=>({id:e.id||"",name:e.name||"",description:e.description||"",category:e.category_id||"other",address:e.address||"",latitude:Number(e.latitude)||0,longitude:Number(e.longitude)||0,phone:e.phone||"",website:e.website||"",status:e.status||"pending",created_at:e.created_at||"",category_name:e.facility_categories?.name_ja||""}));s(a)}catch(e){const t=e instanceof Error?e.message:"æ–½è¨­ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ";l(t),s([])}finally{r(!1)}},[]),setError:l,setFacilitiesLoading:r}}();t.useEffect(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{const t={lat:e.coords.latitude,lng:e.coords.longitude};h(t)},e=>{},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e5})},[]);const M=t.useMemo(()=>x&&0!==b.length?[...b].sort((e,t)=>A(x.lat,x.lng,Number(e.latitude)||0,Number(e.longitude)||0)-A(x.lat,x.lng,Number(t.latitude)||0,Number(t.longitude)||0)):b,[b,x]),C=t.useMemo(()=>{let e=v.filter(e=>d.includes(e.category));return x&&e.length>0&&(e=e.sort((e,t)=>A(x.lat,x.lng,e.latitude||0,e.longitude||0)-A(x.lat,x.lng,t.latitude||0,t.longitude||0))),e},[v,d,x]);t.useEffect(()=>{(async()=>{try{"dogparks"===s?await N():await k()}catch(e){}})()},[s,N,k]);const $="dogparks"===s?j:_,S=()=>{(async()=>{"dogparks"===s?await N():await k()})()};return("dogparks"===s?y:w)?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[!1,e.jsx(L,{})]}):$?e.jsx(E,{error:$,onRetry:S}):"dogparks"===s&&0===b.length?e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx(P,{title:"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“",description:"ã¾ã ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚"})}):"facilities"===s&&0===v.length?e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx(P,{title:"æ–½è¨­ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“",description:"ã¾ã æ–½è¨­ã®ãƒ‡ãƒ¼ã‚¿ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"ãƒ‰ãƒƒã‚°ãƒ‘ãƒ¼ã‚¯ä¸€è¦§"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"ãŠè¿‘ãã®ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã‚’è¦‹ã¤ã‘ã¾ã—ã‚‡ã†"})]})})}),!1,e.jsx("div",{className:"bg-white border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex justify-center py-4",children:e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>a("dogparks"),className:"px-6 py-3 rounded-md font-medium transition-all "+("dogparks"===s?"bg-blue-600 text-white shadow-md":"text-gray-600 hover:text-gray-900 hover:bg-gray-200"),children:"ğŸ• ãƒ‰ãƒƒã‚°ãƒ©ãƒ³"}),e.jsx("button",{onClick:()=>a("facilities"),className:"px-6 py-3 rounded-md font-medium transition-all "+("facilities"===s?"bg-green-600 text-white shadow-md":"text-gray-600 hover:text-gray-900 hover:bg-gray-200"),children:"ğŸ¢ ãƒ¯ãƒ³ã¡ã‚ƒã‚“ã¨è¡Œã‘ã‚‹æ–½è¨­"})]})})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:["facilities"===s&&e.jsxs("div",{className:"mb-4 bg-white rounded-lg shadow-sm border",children:[e.jsxs("button",{onClick:()=>g(!u),className:"w-full px-3 py-3 flex items-center justify-between text-left hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"ğŸ¢ ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿ãƒ¼"}),e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded-full",children:[d.length," / ",Object.keys(q).length]}),x&&e.jsx("span",{className:"text-xs text-green-600",children:"ğŸ“ è·é›¢é †"})]}),e.jsx("span",{className:"text-gray-400 transition-transform "+(u?"rotate-180":""),children:"â–¼"})]}),u&&e.jsxs("div",{className:"px-3 pb-3 border-t border-gray-100",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-3 pt-3",children:[e.jsx("button",{onClick:()=>{m(Object.keys(q))},className:"px-2 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",children:"å…¨é¸æŠ"}),e.jsx("button",{onClick:()=>{m([])},className:"px-2 py-1 text-xs bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"å…¨è§£é™¤"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(q).map(([t,s])=>e.jsxs("button",{onClick:()=>(e=>{m(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])})(t),className:"px-3 py-2 text-sm rounded-full border transition-all "+(d.includes(t)?"bg-blue-500 text-white border-blue-500 shadow-md":"bg-gray-100 text-gray-700 border-gray-300 hover:bg-gray-200"),children:[F(t)," ",s]},t))})]})]}),e.jsx("div",{className:"mb-8",children:e.jsx(T,{parks:M,facilities:"facilities"===s?C:v,activeView:s,userLocation:x})}),"dogparks"===s&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ä¸€è¦§"}),0===b.length?e.jsx(P,{title:"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“",description:"ç¾åœ¨ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ãŒã‚ã‚Šã¾ã›ã‚“ã€‚"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:M.map(t=>{const s=x&&t.latitude&&t.longitude?A(x.lat,x.lng,Number(t.latitude),Number(t.longitude)):void 0;return e.jsx(I,{park:t,userLocation:x,...void 0!==s&&{distance:s}},t.id)})})]}),"facilities"===s&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"ãƒ¯ãƒ³ã¡ã‚ƒã‚“ã¨è¡Œã‘ã‚‹æ–½è¨­"}),0===C.length?e.jsx(P,{title:"æ–½è¨­ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“",description:0===d.length?"ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚":"é¸æŠã—ãŸã‚«ãƒ†ã‚´ãƒªã®æ–½è¨­ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:C.map(t=>{const s=x&&t.latitude&&t.longitude?A(x.lat,x.lng,t.latitude,t.longitude):void 0;return e.jsx(z,{facility:t,showDistance:!!x,...void 0!==s&&{distance:s}},t.id)})})]})]})]})}export{R as DogParkList};

import{j as e}from"./motion-BHsL7Azw.js";import{r as s}from"./react-vendor-CMvmJHsS.js";import{a,L as t}from"./router-DXQOdrLL.js";import{u as r,b as i,s as l,B as n}from"./index-CCNZFy3M.js";import{C as c}from"./Card-DqVnP9TA.js";import{I as d}from"./Input-BA7ko280.js";import{l as o,f as m}from"./postalCodeLookup-BVBMVLy5.js";import{_ as x,a as h,a6 as p,au as u,a3 as j,q as b,t as g,b as N,H as w,M as f,L as v,s as y,av as _,p as I,K as C,o as k,aw as S,ax as z,ay as P,V as J,d as O,X as E}from"./ui-basic-DDpq4BmP.js";import"./heavy-features-Dlg1c9Yc.js";import"./supabase-D2tiogv8.js";function T(){const{user:T}=r(),q=a(),{subscription:L,loading:D,isActive:F}=i(),[G,U]=s.useState(!0),[A,X]=s.useState(!1),[Z,V]=s.useState(""),[Y,B]=s.useState(""),[M,W]=s.useState({name:"",nickname:"",postal_code:"",address:"",phone_number:"",email:""}),[Q,H]=s.useState({name:"",nickname:"",postal_code:"",address:"",phone_number:"",email:""}),[R,$]=s.useState(!1),[K,ee]=s.useState(!1),[se,ae]=s.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[te,re]=s.useState(""),[ie,le]=s.useState(!1),[ne,ce]=s.useState(!1),[de,oe]=s.useState(""),[me,xe]=s.useState(""),[he,pe]=s.useState(""),[ue,je]=s.useState(!1),[be,ge]=s.useState(""),[Ne,we]=s.useState(null),[fe,ve]=s.useState(!1),[ye,_e]=s.useState(""),[Ie,Ce]=s.useState("");s.useEffect(()=>{T?ke():q("/login")},[T,q]);const ke=async()=>{try{U(!0);const{data:e,error:s}=await l.from("profiles").select("*").eq("id",T?.id).single();if(s)throw s;const a={name:e.name||"",nickname:e.nickname||"",postal_code:e.postal_code||"",address:e.address||"",phone_number:e.phone_number||"",email:T?.email||""};W(a),H(a)}catch(e){V(e.message||"プロフィールの取得に失敗しました。")}finally{U(!1)}},Se=async e=>{const s=(e=>{const s=e.replace(/\D/g,"");return s.length<=7?s.length>3?s.slice(0,3)+"-"+s.slice(3):s:M.postal_code})(e);if(W({...M,postal_code:s}),7===s.replace(/-/g,"").length){je(!0),ge("");try{const e=await o(s);if(e.success&&e.results&&e.results.length>0&&e.results[0]){const s=m(e.results[0]);W(e=>({...e,address:s}))}else ge(e.message||"住所が見つかりませんでした")}catch(a){ge("住所の検索中にエラーが発生しました")}finally{je(!1)}}};return G?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"max-w-3xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center space-x-4 mb-6",children:e.jsxs(t,{to:"/dashboard",className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[e.jsx(x,{className:"w-4 h-4 mr-2"}),"ダッシュボードに戻る"]})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-4 flex items-center justify-center",children:[e.jsx(h,{className:"w-8 h-8 text-blue-600 mr-3"}),"プロフィール設定"]}),e.jsx("p",{className:"text-lg text-gray-600",children:"アカウント情報を管理します"})]}),e.jsxs("div",{className:"flex flex-wrap justify-center gap-4 mb-6",children:[e.jsx(t,{to:"/payment-method-settings",children:e.jsxs(n,{variant:"secondary",size:"sm",children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"支払い方法"]})}),e.jsx(t,{to:"/dogpark-history",children:e.jsxs(n,{variant:"secondary",size:"sm",children:[e.jsx(u,{className:"w-4 h-4 mr-2"}),"利用履歴"]})}),e.jsx(t,{to:"/order-history",children:e.jsxs(n,{variant:"secondary",size:"sm",children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"注文履歴"]})})]}),e.jsx(c,{className:"p-6",children:e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),X(!0),V(""),B("");try{if(!M.name.trim())throw new Error("お名前を入力してください");if(M.postal_code&&!M.postal_code.match(/^\d{3}-\d{4}$/))throw new Error("郵便番号は正しい形式で入力してください（例：123-4567）");if(M.phone_number&&!M.phone_number.match(/^0\d{2,3}-\d{1,4}-\d{4}$/))throw new Error("電話番号は正しい形式で入力してください（例：090-1234-5678）");const e=Q.postal_code!==M.postal_code||Q.address!==M.address;let s=!1;if(e){const{data:e,error:a}=await l.from("owner_verifications").select("id, status").eq("user_id",T?.id).eq("status","verified").single();a&&a.code,e&&(s=!0)}const{error:a}=await l.from("profiles").update({name:M.name,nickname:M.nickname,postal_code:M.postal_code,address:M.address,phone_number:M.phone_number}).eq("id",T?.id);if(a)throw a;if(s){const{error:e}=await l.from("owner_verifications").update({status:"pending",updated_at:(new Date).toISOString()}).eq("user_id",T?.id),{error:s}=await l.from("notifications").insert([{user_id:T?.id,type:"identity_verification",title:"住所変更により本人確認が必要です",message:"住所を変更されたため、本人確認書類を再度提出する必要があります。ドッグラン施設の登録を継続される場合は、本人確認書類をアップロードしてください。",data:{reason:"address_change"}}])}if(T?.email!==M.email){const{error:e}=await l.auth.updateUser({email:M.email});if(e)throw e}H(M);let t="プロフィールを更新しました";s&&(t+="\n\n住所変更により本人確認が必要になりました。ドッグラン施設の登録を継続される場合は、本人確認書類を再度アップロードしてください。"),B(t),setTimeout(()=>{B("")},3e3)}catch(s){V(s.message||"プロフィールの更新に失敗しました")}finally{X(!1)}},children:[Z&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 rounded-lg flex items-start",children:[e.jsx(b,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsx("p",{className:"text-red-800",children:Z})]}),Y&&e.jsxs("div",{className:"mb-6 p-4 bg-green-50 rounded-lg flex items-start",children:[e.jsx(g,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsx("p",{className:"text-green-800",children:Y})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx(h,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-semibold",children:"基本情報"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(d,{label:"お名前 *",value:M.name,onChange:e=>W({...M,name:e.target.value}),required:!0,icon:e.jsx(h,{className:"w-4 h-4 text-gray-500"})}),e.jsx(d,{label:"ニックネーム",value:M.nickname,onChange:e=>W({...M,nickname:e.target.value}),placeholder:"表示名やニックネームを入力（任意）",icon:e.jsx(h,{className:"w-4 h-4 text-gray-500"})}),e.jsx(d,{label:"メールアドレス *",type:"email",value:M.email,onChange:e=>W({...M,email:e.target.value}),required:!0,icon:e.jsx(N,{className:"w-4 h-4 text-gray-500"})})]}),e.jsxs("div",{className:"flex items-center space-x-3 mb-6 mt-8",children:[e.jsx(w,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-semibold",children:"住所情報"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"mb-4 relative",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["郵便番号 ",e.jsx("span",{className:"text-xs text-blue-600",children:"(入力すると住所が自動入力されます)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(f,{className:"h-4 w-4 text-gray-500"})}),e.jsx("input",{type:"text",value:M.postal_code,onChange:e=>Se(e.target.value),className:`w-full pl-10 pr-10 py-2 border ${be?"border-red-500":"border-gray-300"} rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500`,placeholder:"123-4567（数字のみ入力）",maxLength:8}),ue&&e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx(v,{className:"h-4 w-4 text-blue-500 animate-spin"})})]}),be&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:be})]}),e.jsx(d,{label:"電話番号",value:M.phone_number,onChange:e=>{const s=(e=>{const s=e.replace(/\D/g,"");return s.length<=11?s.length>7?s.slice(0,3)+"-"+s.slice(3,7)+"-"+s.slice(7):s.length>3?s.slice(0,3)+"-"+s.slice(3):s:M.phone_number})(e.target.value);W({...M,phone_number:s})},placeholder:"090-1234-5678",maxLength:13,icon:e.jsx(y,{className:"w-4 h-4 text-gray-500"})})]}),e.jsx("div",{className:"col-span-2",children:e.jsx(d,{label:"住所",value:M.address,onChange:e=>W({...M,address:e.target.value}),placeholder:"東京都渋谷区渋谷1-1-1",icon:e.jsx(w,{className:"w-4 h-4 text-gray-500"})})}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("span",{className:"font-medium",children:"※ 入力のヒント"}),e.jsx("br",{}),"• 郵便番号：数字のみ入力（例：1234567）",e.jsx("br",{}),"• 電話番号：数字のみ入力（例：09012345678）",e.jsx("br",{}),"ハイフンは自動で挿入されます。"]})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(n,{type:"submit",isLoading:A,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"保存する"]})})]})]})}),e.jsxs(c,{className:"p-6 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx(I,{className:"w-6 h-6 text-yellow-600"}),e.jsx("h2",{className:"text-xl font-semibold",children:"アカウント設定"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-white rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"パスワード変更"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"アカウントのセキュリティを保つため、定期的にパスワードを変更することをおすすめします。"}),e.jsxs(n,{variant:"secondary",size:"sm",onClick:()=>$(!0),children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"パスワードを変更"]})]}),e.jsxs("div",{className:"p-4 bg-white rounded-lg border border-purple-200",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(k,{className:"w-5 h-5 text-purple-600 mr-2"}),e.jsx("h3",{className:"font-semibold",children:"サブスクリプション管理"})]}),D?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(v,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm text-gray-600",children:"読み込み中..."})]}):F&&L?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("p",{children:["現在のプラン: ",e.jsx("span",{className:"font-medium text-purple-600",children:"月額サブスクリプション"})]}),e.jsxs("p",{children:["ステータス: ",e.jsx("span",{className:"font-medium "+("active"===L.subscription_status?"text-green-600":"paused"===L.subscription_status?"text-yellow-600":"text-red-600"),children:"active"===L.subscription_status?"利用中":"paused"===L.subscription_status?"一時停止中":"canceled"===L.subscription_status?"退会済み":L.subscription_status})]}),L.current_period_end&&e.jsxs("p",{children:["次回更新日: ",new Date(1e3*L.current_period_end).toLocaleDateString()]})]}),ye&&e.jsx("div",{className:"p-3 bg-red-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(b,{className:"w-4 h-4 text-red-600 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-800",children:ye})]})}),Ie&&e.jsx("div",{className:"p-3 bg-green-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(g,{className:"w-4 h-4 text-green-600 mt-0.5"}),e.jsx("p",{className:"text-sm text-green-800",children:Ie})]})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:["active"===L.subscription_status&&e.jsxs(e.Fragment,{children:[e.jsxs(n,{variant:"secondary",size:"sm",onClick:()=>we("pause"),disabled:fe,children:[e.jsx(S,{className:"w-4 h-4 mr-1"}),"利用を一時停止"]}),e.jsxs(n,{variant:"secondary",size:"sm",className:"text-red-600 hover:text-red-700 border-red-300 hover:border-red-400",onClick:()=>we("cancel"),disabled:fe,children:[e.jsx(z,{className:"w-4 h-4 mr-1"}),"退会する"]})]}),"paused"===L.subscription_status&&e.jsxs(n,{variant:"secondary",size:"sm",className:"text-green-600 hover:text-green-700 border-green-300 hover:border-green-400",onClick:()=>we("resume"),disabled:fe,children:[e.jsx(P,{className:"w-4 h-4 mr-1"}),"利用を再開"]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"現在サブスクリプションに加入していません。"}),e.jsxs(n,{variant:"secondary",size:"sm",className:"text-purple-600 hover:text-purple-700 border-purple-300 hover:border-purple-400",onClick:()=>q("/subscription-intro"),children:[e.jsx(k,{className:"w-4 h-4 mr-1"}),"サブスクリプションに加入"]})]})]}),e.jsxs("div",{className:"p-4 bg-white rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"アカウント削除"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"アカウントを削除すると、すべてのデータが完全に削除され、復元できなくなります。"}),e.jsxs(n,{variant:"secondary",size:"sm",className:"text-red-600 hover:text-red-700 border-red-300 hover:border-red-400",onClick:()=>ee(!0),children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"アカウントを削除"]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"font-semibold mb-2 text-gray-600",children:"2ファクタ認証（2FA）"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"2ファクタ認証機能は現在メンテナンス中です。しばらくお待ちください。"}),e.jsxs("div",{className:"flex items-center space-x-2 text-amber-600",children:[e.jsx(b,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"サービス準備中"})]}),e.jsxs(n,{variant:"secondary",size:"sm",disabled:!0,className:"mt-3 opacity-50 cursor-not-allowed",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"2FAを有効化（準備中）"]})]})]})]}),R&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold",children:"パスワード変更"}),e.jsx("button",{onClick:()=>{$(!1),oe(""),xe(""),ae({currentPassword:"",newPassword:"",confirmPassword:""})},className:"text-gray-500 hover:text-gray-700",children:e.jsx(E,{className:"w-6 h-6"})})]}),de&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(b,{className:"w-5 h-5 text-red-600 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-800",children:de})]})}),me&&e.jsx("div",{className:"mb-4 p-3 bg-green-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(g,{className:"w-5 h-5 text-green-600 mt-0.5"}),e.jsx("p",{className:"text-sm text-green-800",children:me})]})}),e.jsx("form",{onSubmit:async e=>{e.preventDefault(),le(!0),oe(""),xe("");try{if(!se.currentPassword)throw new Error("現在のパスワードを入力してください");if(!se.newPassword)throw new Error("新しいパスワードを入力してください");if(se.newPassword.length<6)throw new Error("パスワードは6文字以上で入力してください");if(se.newPassword!==se.confirmPassword)throw new Error("新しいパスワードと確認用パスワードが一致しません");const{error:e}=await l.auth.signInWithPassword({email:T?.email||"",password:se.currentPassword});if(e)throw new Error("現在のパスワードが正しくありません");const{error:s}=await l.auth.updateUser({password:se.newPassword});if(s)throw s;xe("パスワードを変更しました"),ae({currentPassword:"",newPassword:"",confirmPassword:""}),setTimeout(()=>{$(!1),xe("")},3e3)}catch(s){oe(s.message||"パスワードの変更に失敗しました")}finally{le(!1)}},children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(d,{label:"現在のパスワード *",type:"password",value:se.currentPassword,onChange:e=>ae({...se,currentPassword:e.target.value}),required:!0}),e.jsx(d,{label:"新しいパスワード *",type:"password",value:se.newPassword,onChange:e=>ae({...se,newPassword:e.target.value}),required:!0,minLength:6}),e.jsx(d,{label:"新しいパスワード（確認） *",type:"password",value:se.confirmPassword,onChange:e=>ae({...se,confirmPassword:e.target.value}),required:!0,minLength:6}),e.jsx("div",{className:"p-3 bg-blue-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("span",{className:"font-medium",children:"パスワードの要件"}),e.jsx("br",{}),"• 6文字以上",e.jsx("br",{}),"• 英数字を含めることをおすすめします",e.jsx("br",{}),"• 以前使用したパスワードと異なるものを使用してください"]})}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(n,{type:"button",variant:"secondary",onClick:()=>{$(!1),oe(""),xe(""),ae({currentPassword:"",newPassword:"",confirmPassword:""})},children:"キャンセル"}),e.jsx(n,{type:"submit",isLoading:ie,children:"パスワードを変更"})]})]})})]})}),K&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-red-600",children:"アカウント削除"}),e.jsx("button",{onClick:()=>{ee(!1),pe(""),re("")},className:"text-gray-500 hover:text-gray-700",children:e.jsx(E,{className:"w-6 h-6"})})]}),he&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(b,{className:"w-5 h-5 text-red-600 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-800",children:he})]})}),e.jsx("div",{className:"p-4 bg-red-50 rounded-lg mb-4",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(b,{className:"w-5 h-5 text-red-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-800 mb-1",children:"警告: この操作は取り消せません"}),e.jsx("p",{className:"text-sm text-red-700",children:"アカウントを削除すると、以下のデータがすべて完全に削除されます："}),e.jsxs("ul",{className:"text-sm text-red-700 list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"プロフィール情報"}),e.jsx("li",{children:"登録したワンちゃんの情報"}),e.jsx("li",{children:"予約履歴"}),e.jsx("li",{children:"支払い情報"}),e.jsx("li",{children:"友達リストとメッセージ"})]})]})]})}),e.jsx("form",{onSubmit:async e=>{e.preventDefault(),ce(!0),pe("");try{if("delete"!==te)throw new Error("確認のため「delete」と入力してください");const{error:e}=await l.auth.admin.deleteUser(T?.id||"");if(e)throw e;await l.auth.signOut(),q("/",{replace:!0})}catch(s){pe(s.message||"アカウントの削除に失敗しました")}finally{ce(!1)}},children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"確認のため「delete」と入力してください *"}),e.jsx("input",{type:"text",value:te,onChange:e=>re(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500",required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(n,{type:"button",variant:"secondary",onClick:()=>{ee(!1),pe(""),re("")},children:"キャンセル"}),e.jsx(n,{type:"submit",isLoading:ne,className:"bg-red-600 hover:bg-red-700",disabled:"delete"!==te,children:"アカウントを削除"})]})]})})]})}),Ne&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-xl font-bold text-purple-600",children:["pause"===Ne&&"サブスクリプション一時停止","resume"===Ne&&"サブスクリプション再開","cancel"===Ne&&"サブスクリプション退会"]}),e.jsx("button",{onClick:()=>{we(null),_e(""),Ce("")},className:"text-gray-500 hover:text-gray-700",children:e.jsx(E,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"space-y-4",children:["pause"===Ne&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 bg-yellow-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(S,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-yellow-800 mb-1",children:"一時停止について"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"サブスクリプションを一時停止すると、次回の請求が停止されます。 いつでも再開することができます。"})]})]})}),e.jsx("p",{className:"text-sm text-gray-600",children:"一時停止中も現在の期間終了まではサービスをご利用いただけます。"})]}),"resume"===Ne&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 bg-green-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(P,{className:"w-5 h-5 text-green-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-800 mb-1",children:"再開について"}),e.jsx("p",{className:"text-sm text-green-700",children:"サブスクリプションを再開すると、通常の請求サイクルが復活します。"})]})]})}),e.jsx("p",{className:"text-sm text-gray-600",children:"再開後は全ての機能をご利用いただけます。"})]}),"cancel"===Ne&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 bg-red-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(b,{className:"w-5 h-5 text-red-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-800 mb-1",children:"退会について"}),e.jsx("p",{className:"text-sm text-red-700",children:"退会すると、現在の期間終了後にサブスクリプションが終了します。 いつでも再度加入することができます。"})]})]})}),e.jsx("p",{className:"text-sm text-gray-600",children:"退会後も現在の期間終了まではサービスをご利用いただけます。"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(n,{type:"button",variant:"secondary",onClick:()=>{we(null),_e(""),Ce("")},disabled:fe,children:"キャンセル"}),e.jsxs(n,{type:"button",isLoading:fe,className:"cancel"===Ne?"bg-red-600 hover:bg-red-700":"resume"===Ne?"bg-green-600 hover:bg-green-700":"bg-yellow-600 hover:bg-yellow-700",onClick:()=>{"pause"===Ne?(async()=>{if(L?.subscription_id){ve(!0),_e(""),Ce("");try{const e=await fetch("https://onmcivwxtzqajcovptgf.supabase.co/functions/v1/stripe-pause-subscription",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9ubWNpdnd4dHpxYWpjb3ZwdGdmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkxODk3OTUsImV4cCI6MjA2NDc2NTc5NX0.AqFCz3GQUVeGaG2988LCzsE4aJpeio3xScoxv5T0-OU"},body:JSON.stringify({subscription_id:L.subscription_id})});if(!e.ok){const s=await e.json();throw new Error(s.error||"サブスクリプションの一時停止に失敗しました")}Ce("サブスクリプションを一時停止しました。再開はいつでも可能です。"),we(null),setTimeout(()=>{window.location.reload()},2e3)}catch(e){_e(e instanceof Error?e.message:"サブスクリプションの一時停止に失敗しました")}finally{ve(!1)}}})():"resume"===Ne?(async()=>{if(L?.subscription_id){ve(!0),_e(""),Ce("");try{const e=await fetch("https://onmcivwxtzqajcovptgf.supabase.co/functions/v1/stripe-resume-subscription",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9ubWNpdnd4dHpxYWpjb3ZwdGdmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkxODk3OTUsImV4cCI6MjA2NDc2NTc5NX0.AqFCz3GQUVeGaG2988LCzsE4aJpeio3xScoxv5T0-OU"},body:JSON.stringify({subscription_id:L.subscription_id})});if(!e.ok){const s=await e.json();throw new Error(s.error||"サブスクリプションの再開に失敗しました")}Ce("サブスクリプションを再開しました。"),we(null),setTimeout(()=>{window.location.reload()},2e3)}catch(e){_e(e instanceof Error?e.message:"サブスクリプションの再開に失敗しました")}finally{ve(!1)}}})():"cancel"===Ne&&(async()=>{if(L?.subscription_id){ve(!0),_e(""),Ce("");try{const e=await fetch("https://onmcivwxtzqajcovptgf.supabase.co/functions/v1/stripe-cancel-subscription",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9ubWNpdnd4dHpxYWpjb3ZwdGdmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkxODk3OTUsImV4cCI6MjA2NDc2NTc5NX0.AqFCz3GQUVeGaG2988LCzsE4aJpeio3xScoxv5T0-OU"},body:JSON.stringify({subscription_id:L.subscription_id})});if(!e.ok){const s=await e.json();throw new Error(s.error||"サブスクリプションの退会に失敗しました")}Ce("サブスクリプションを退会しました。現在の期間終了まで利用可能です。"),we(null),setTimeout(()=>{window.location.reload()},2e3)}catch(e){_e(e instanceof Error?e.message:"サブスクリプションの退会に失敗しました")}finally{ve(!1)}}})()},children:["pause"===Ne&&"一時停止する","resume"===Ne&&"再開する","cancel"===Ne&&"退会する"]})]})]})]})})]})}export{T as ProfileSettings};

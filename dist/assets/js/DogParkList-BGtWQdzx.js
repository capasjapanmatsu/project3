import{j as e}from"./motion-BHsL7Azw.js";import{r as s}from"./react-vendor-CMvmJHsS.js";import{L as t}from"./router-DXQOdrLL.js";import{B as a,u as r,s as l}from"./index-xaqGfu5h.js";import{i,t as n,M as c,N as o,u as d,U as m,v as x,w as h,x as g,s as u,h as p,y as f,H as b,k as j,z as y,I as N,J as v,q as w,R as _}from"./ui-basic-D1oJx_i8.js";import{C as k}from"./Card-DqVnP9TA.js";import"./heavy-features-Dlg1c9Yc.js";import"./supabase-D2tiogv8.js";const M=e=>e<1?`${Math.round(1e3*e)}m`:`${e.toFixed(1)}km`;function C({park:s,userLocation:r,distance:l}){const h=l||(r&&s.latitude&&s.longitude?((e,s,t,a)=>{const r=(t-e)*Math.PI/180,l=(a-s)*Math.PI/180,i=Math.sin(r/2)*Math.sin(r/2)+Math.cos(e*Math.PI/180)*Math.cos(t*Math.PI/180)*Math.sin(l/2)*Math.sin(l/2);return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371})(r.lat,r.lng,Number(s.latitude),Number(s.longitude)):null),g=(()=>{if(!s.current_occupancy||!s.max_capacity)return{label:"情報なし",color:"text-gray-500",bgColor:"bg-gray-100"};const e=s.current_occupancy/s.max_capacity*100;return e>=90?{label:"満員",color:"text-red-600",bgColor:"bg-red-100"}:e>=70?{label:"混雑",color:"text-orange-600",bgColor:"bg-orange-100"}:e>=40?{label:"普通",color:"text-yellow-600",bgColor:"bg-yellow-100"}:{label:"空いている",color:"text-green-600",bgColor:"bg-green-100"}})();return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:[s.image_url&&e.jsxs("div",{className:"aspect-square relative overflow-hidden rounded-t-lg",children:[e.jsx("img",{src:s.image_url,alt:s.name,className:"w-full h-full object-cover"}),e.jsx("button",{className:"absolute top-3 right-3 p-2 bg-white/80 backdrop-blur-sm rounded-full hover:bg-white transition-colors",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:e.jsx(i,{className:"w-4 h-4 text-gray-600 hover:text-red-500"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-900 flex-1",children:s.name}),e.jsx("div",{className:"flex items-center space-x-2 ml-2",children:e.jsxs("span",{className:"flex items-center text-green-600 text-sm",children:[e.jsx(n,{className:"w-4 h-4 mr-1"}),"営業中"]})})]}),e.jsxs("div",{className:"space-y-2 mb-2",children:[s.address&&e.jsxs("div",{className:"flex items-center text-gray-600 text-sm",children:[e.jsx(c,{className:"w-4 h-4 mr-1 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.address})]}),h&&e.jsxs("div",{className:"flex items-center text-blue-600 text-sm font-medium",children:[e.jsx(o,{className:"w-4 h-4 mr-1"}),e.jsxs("span",{children:["現在地から ",M(h)]})]})]}),s.price&&e.jsxs("div",{className:"flex items-center text-gray-600 text-sm mb-3",children:[e.jsx(d,{className:"w-4 h-4 mr-1"}),e.jsxs("span",{children:["¥",s.price,"/時間"]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(m,{className:"w-4 h-4 mr-1 text-gray-600"}),e.jsx("span",{className:"text-sm text-gray-600",children:"混雑状況:"})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${g.color} ${g.bgColor}`,children:g.label})]}),void 0!==s.current_occupancy&&s.max_capacity&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-1",children:[e.jsx("span",{children:"現在の利用者"}),e.jsxs("span",{children:[s.current_occupancy," / ",s.max_capacity,"名"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"h-2 rounded-full transition-all duration-300 "+(s.current_occupancy/s.max_capacity>=.9?"bg-red-500":s.current_occupancy/s.max_capacity>=.7?"bg-orange-500":s.current_occupancy/s.max_capacity>=.4?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(s.current_occupancy/s.max_capacity*100,100)}%`}})})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(t,{to:`/parks/${s.id}`,className:"flex-1",children:e.jsxs(a,{variant:"outline",className:"w-full flex items-center justify-center",children:[e.jsx(x,{className:"w-4 h-4 mr-1"}),"詳細を見る"]})}),s.current_occupancy<s.max_capacity&&e.jsx(t,{to:`/reservation/${s.id}`,className:"flex-1",children:e.jsx(a,{className:"w-full",children:"予約する"})})]})]})]})}function I({icon:s,title:t,description:r,action:l,className:i=""}){return e.jsxs("div",{className:`flex flex-col items-center justify-center py-12 px-4 text-center ${i}`,children:[e.jsx("div",{className:"mb-4 text-gray-400",children:s||e.jsx(h,{className:"w-16 h-16"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:t}),r&&e.jsx("p",{className:"text-gray-600 max-w-md mb-6",children:r}),l&&e.jsx(a,{onClick:l.onClick,variant:"outline",children:l.label})]})}const P={veterinary_clinic:{icon:N,label:"動物病院",color:"text-red-600"},pet_friendly_restaurant:{icon:y,label:"ペット同伴レストラン",color:"text-orange-600"},pet_shop:{icon:j,label:"ペットショップ",color:"text-blue-600"},pet_friendly_hotel:{icon:b,label:"ペット同伴宿泊",color:"text-green-600"},pet_salon:{icon:p,label:"ペットサロン",color:"text-purple-600"},pet_hotel:{icon:f,label:"ペットホテル",color:"text-indigo-600"},other:{icon:p,label:"その他",color:"text-gray-600"}};function S({facility:s,showDistance:r,distance:l}){const n=(d=s.category)&&d in P?P[d]:P.other;var d;const m=n.icon,h=(()=>{const e=new Date,t=100*e.getHours()+e.getMinutes();if(s.opening_hours&&s.closing_hours){const e=parseInt(s.opening_hours.replace(":",""),10),a=parseInt(s.closing_hours.replace(":",""),10);return t>=e&&t<=a}return!0})();return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:[s.image_url&&e.jsxs("div",{className:"aspect-square relative overflow-hidden rounded-t-lg",children:[e.jsx("img",{src:s.image_url,alt:s.name,className:"w-full h-full object-cover",loading:"lazy"}),e.jsx("button",{className:"absolute top-3 right-3 p-2 bg-white/80 backdrop-blur-sm rounded-full hover:bg-white transition-colors",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:e.jsx(i,{className:"w-4 h-4 text-gray-600 hover:text-red-500"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(m,{className:`w-5 h-5 ${n.color}`}),e.jsx("span",{className:"text-sm text-gray-600",children:n.label})]}),h?e.jsx("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full",children:"営業中"}):e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full",children:"営業時間外"})]}),e.jsx("h3",{className:"font-semibold text-lg text-gray-900 mb-2 line-clamp-2",children:s.name}),s.rating&&e.jsx("div",{className:"mb-2",children:(f=s.rating,f?e.jsxs("div",{className:"flex items-center space-x-1",children:[[1,2,3,4,5].map(s=>e.jsx(v,{className:"w-4 h-4 "+(s<=f?"text-yellow-400 fill-current":"text-gray-300")},s)),e.jsxs("span",{className:"text-sm text-gray-600 ml-1",children:["(",f,")"]})]}):null)}),s.address&&e.jsxs("div",{className:"flex items-start text-gray-600 text-sm mb-2",children:[e.jsx(c,{className:"w-4 h-4 mr-1 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"line-clamp-2",children:s.address})]}),r&&l&&e.jsxs("div",{className:"flex items-center text-gray-600 text-sm mb-2",children:[e.jsx(o,{className:"w-4 h-4 mr-1"}),e.jsxs("span",{children:["現在地から ",(p=l,p?p<1?`${Math.round(1e3*p)}m`:`${p.toFixed(1)}km`:"")]})]}),s.opening_hours&&s.closing_hours&&e.jsxs("div",{className:"flex items-center text-gray-600 text-sm mb-2",children:[e.jsx(g,{className:"w-4 h-4 mr-1"}),e.jsxs("span",{children:[s.opening_hours," - ",s.closing_hours]})]}),s.phone&&e.jsxs("div",{className:"flex items-center text-gray-600 text-sm mb-3",children:[e.jsx(u,{className:"w-4 h-4 mr-1"}),e.jsx("a",{href:`tel:${s.phone}`,className:"hover:text-blue-600 transition-colors",onClick:e=>e.stopPropagation(),children:s.phone})]}),s.description&&e.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(t,{to:`/facilities/${s.id}`,className:"flex-1",children:e.jsxs(a,{variant:"outline",className:"w-full flex items-center justify-center",children:[e.jsx(x,{className:"w-4 h-4 mr-1"}),"詳細を見る"]})}),s.website_url&&e.jsx("a",{href:s.website_url,target:"_blank",rel:"noopener noreferrer",className:"flex-1",onClick:e=>e.stopPropagation(),children:e.jsx(a,{className:"w-full",children:"ウェブサイト"})})]})]})]});var p,f}function $({message:s="データを読み込み中..."}){return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:s})]})})}function L({error:s,onRetry:t}){return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md mx-auto px-4",children:[e.jsx(w,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"エラーが発生しました"}),e.jsx("p",{className:"text-gray-600 mb-4",children:s}),e.jsxs(a,{onClick:t,className:"inline-flex items-center",children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"再試行"]})]})})}const z={lat:35.6762,lng:139.6503};function E({parks:t=[],facilities:i=[],activeView:n="dogparks",onLocationSelect:d,center:m,userLocation:x,className:h=""}){const g=s.useRef(null),[u,p]=s.useState(!1),[f,b]=s.useState(!0),[j,y]=s.useState(x||null),[N,v]=s.useState(""),[w,_]=s.useState(!1),{user:M}=r(),[C,I]=s.useState([]),[P,S]=s.useState(""),$=m||j||z,L='\n    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <circle cx="16" cy="16" r="15" fill="#EF4444" stroke="white" stroke-width="2"/>\n      <path d="M10 12c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zm8 0c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zM8 18c0-2.2 3.6-4 8-4s8 1.8 8 4c0 1.1-3.6 2-8 2s-8-.9-8-2z" fill="white"/>\n      <path d="M14 16h4v2h-4z" fill="#EF4444"/>\n    </svg>\n  ',E=s.useCallback(async()=>{const e=window;if(e.google?.maps)b(!1);else{if(e._googleMapsLoading){const s=setInterval(()=>{e.google?.maps&&(clearInterval(s),b(!1))},100);return}try{e._googleMapsLoading=!0;const s=document.createElement("script");s.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC9sxGamDZmdKIz3vP1CWLJORl-QkoWgHg&libraries=places",s.async=!0,s.defer=!0,await new Promise((t,a)=>{s.onload=()=>{e._googleMapsLoading=!1,e.google?.maps?t():a(new Error("Google Maps API読み込み後にAPIが利用できません"))},s.onerror=()=>{e._googleMapsLoading=!1,a(new Error("Google Maps APIの読み込みに失敗しました"))},document.head.appendChild(s)})}catch(s){v("Google Maps APIの読み込みに失敗しました")}finally{b(!1)}}},[]),A=s.useCallback(e=>{try{const s=window;"dogparks"===n&&t&&t.forEach(t=>{t.latitude&&t.longitude&&new s.google.maps.Marker({position:{lat:t.latitude,lng:t.longitude},map:e,title:t.name,icon:{url:`data:image/svg+xml;charset=utf-8,${encodeURIComponent('\n                  <svg width="32" height="32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">\n                    <circle cx="16" cy="16" r="12" fill="#3B82F6" stroke="white" stroke-width="2"/>\n                    <path d="M12 10h8v2h-8zm0 4h8v2h-8zm0 4h6v2h-6z" fill="white"/>\n                  </svg>\n                ')}`}})}),"facilities"===n&&i&&i.forEach(t=>{t.latitude&&t.longitude&&new s.google.maps.Marker({position:{lat:t.latitude,lng:t.longitude},map:e,title:t.name,icon:{url:`data:image/svg+xml;charset=utf-8,${encodeURIComponent('\n                  <svg width="32" height="32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">\n                    <circle cx="16" cy="16" r="12" fill="#10B981" stroke="white" stroke-width="2"/>\n                    <path d="M10 14h12v2h-12zm2-4h8v2h-8zm-2 8h12v2h-12z" fill="white"/>\n                  </svg>\n                ')}`}})}),j&&new s.google.maps.Marker({position:j,map:e,title:"現在地",icon:{url:`data:image/svg+xml;charset=utf-8,${encodeURIComponent(L)}`}})}catch(s){}},[n,t,i,j,L]),R=s.useCallback(()=>{if(!g.current)return;const e=window;if(e.google?.maps)try{const s=new e.google.maps.Map(g.current,{center:$,zoom:j?15:13,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1});A(s),p(!0),v("")}catch(s){v("地図の初期化に失敗しました")}},[$,j,A]);s.useEffect(()=>{E()},[E]),s.useEffect(()=>{f||N||R()},[f,N,R,t,i,n]);const q=s.useCallback(()=>{navigator.geolocation?(_(!0),navigator.geolocation.getCurrentPosition(e=>{const s={lat:e.coords.latitude,lng:e.coords.longitude};y(s),_(!1),d&&d(s)},e=>{_(!1)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e5})):v("位置情報がサポートされていません")},[d]);if(s.useEffect(()=>{(async()=>{if(M)try{const{data:e,error:s}=await l.from("dogs").select("id, name, image_url").eq("user_id",M.id).order("created_at",{ascending:!0});!s&&e&&e.length>0&&I(e),S("data:image/svg+xml;charset=utf-8,"+encodeURIComponent(L))}catch(e){S("data:image/svg+xml;charset=utf-8,"+encodeURIComponent(L))}else S("data:image/svg+xml;charset=utf-8,"+encodeURIComponent(L))})()},[M,L]),N)return e.jsxs(k,{className:`p-6 text-center ${h}`,children:[e.jsx(c,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"マップを読み込めませんでした"}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:N}),e.jsx(a,{onClick:()=>{v(""),b(!0),E()},children:"再読み込み"})]});const D=("dogparks"===n?t:i).length;return e.jsxs(k,{className:`overflow-hidden ${h}`,children:[e.jsxs("div",{className:"p-4 border-b bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(c,{className:"w-5 h-5 text-blue-600 mr-2"}),e.jsxs("h3",{className:"font-semibold",children:["dogparks"===n?"ドッグラン":"ペット施設","マップ"]})]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[D,"件"]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("div",{className:"flex items-center space-x-4 text-xs",children:["dogparks"===n&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-600 rounded-full mr-2"}),e.jsx("span",{children:"ドッグラン"})]}),"facilities"===n&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-green-600 rounded-full mr-2"}),e.jsx("span",{children:"ペット施設"})]}),j&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full mr-2"}),e.jsx("span",{children:"現在地"})]})]}),e.jsxs(a,{size:"sm",variant:"secondary",onClick:q,className:"text-xs",disabled:w,children:[e.jsx(o,{className:"w-3 h-3 mr-1"}),w?"取得中...":"現在地"]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{ref:g,className:"w-full h-96",style:{minHeight:"400px"}}),(f||!u)&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:f?"Google Maps APIを読み込み中...":"マップを初期化中..."})]})})]}),e.jsx("div",{className:"p-3 border-t bg-gray-50 text-xs text-gray-500 text-center",children:"マーカーをクリックすると詳細情報が表示されます"})]})}const A={pet_hotel:"ペットホテル",pet_salon:"ペットサロン",veterinary:"動物病院",pet_cafe:"ペットカフェ",pet_restaurant:"ペット同伴レストラン",pet_shop:"ペットショップ",pet_accommodation:"ペット同伴宿泊",dog_training:"しつけ教室",pet_friendly_other:"その他ワンちゃん同伴可能施設"},R=(e,s,t,a)=>{const r=(t-e)*Math.PI/180,l=(a-s)*Math.PI/180,i=Math.sin(r/2)*Math.sin(r/2)+Math.cos(e*Math.PI/180)*Math.cos(t*Math.PI/180)*Math.sin(l/2)*Math.sin(l/2);return 6371*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))},q=e=>({pet_hotel:"🏨",pet_salon:"✂️",veterinary:"🏥",pet_cafe:"☕",pet_restaurant:"🍽️",pet_shop:"🛍️",pet_accommodation:"🏠",dog_training:"🎓",pet_friendly_other:"🌟"}[e]||"🏢");function D(){const[t,a]=s.useState("dogparks"),[i,n]=s.useState(null),[c,o]=s.useState(!1),[d,m]=s.useState(Object.keys(A)),[x,h]=s.useState(null),[g,u]=s.useState(!1),{user:p,isAuthenticated:f}=r(),{parks:b,isLoading:j,error:y,fetchParkData:N}=function(){const[e,t]=s.useState([]),[a,r]=s.useState(!1),[i,n]=s.useState(null);return{parks:e,isLoading:a,error:i,fetchParkData:s.useCallback(async()=>{try{r(!0),n(null);const{data:e,error:s}=await l.from("dog_parks").select("\n          *,\n          profiles:owner_id (\n            name,\n            address,\n            phone_number,\n            email,\n            postal_code\n          )\n        ").eq("status","approved").order("created_at",{ascending:!1});if(s)throw s;const a=(e||[]).map(e=>(Array.isArray(e.profiles)?e.profiles[0]:e.profiles,{id:e.id||"",name:e.name||"",description:e.description||e.facility_details||"",address:e.address||"",latitude:Number(e.latitude)||0,longitude:Number(e.longitude)||0,max_capacity:Number(e.max_capacity)||20,current_occupancy:Number(e.current_occupancy)||0,price:Number(e.price)||Number(e.hourly_rate)||0,status:e.status||"approved",facilities:e.facilities?"object"==typeof e.facilities?Object.entries(e.facilities).filter(([e,s])=>s).map(([e])=>e).join(","):e.facilities:e.facility_details||"",image_url:e.image_url||e.cover_image_url||"https://via.placeholder.com/400x300?text="+encodeURIComponent(e.name||"ドッグパーク"),average_rating:Number(e.average_rating)||4,review_count:Number(e.review_count)||Math.floor(50*Math.random())+5,created_at:e.created_at||""}));t(a)}catch(e){const s=e instanceof Error?e.message:"データの取得に失敗しました";n(s)}finally{r(!1)}},[]),setError:n,setIsLoading:r}}(),{facilities:v,facilitiesLoading:w,error:_,fetchFacilities:k}=function(){const[e,t]=s.useState([]),[a,r]=s.useState(!1),[i,n]=s.useState(null);return{facilities:e,facilitiesLoading:a,error:i,fetchFacilities:s.useCallback(async()=>{try{r(!0),n(null);const{data:e,error:s}=await l.from("pet_facilities").select("*").eq("status","approved").order("name");if(s)throw s;const a=(e||[]).map(e=>({id:e.id||"",name:e.name||"",description:e.description||"",category:e.category_id||"other",address:e.address||"",latitude:Number(e.latitude)||0,longitude:Number(e.longitude)||0,phone:e.phone||"",website:e.website||"",status:e.status||"pending",created_at:e.created_at||"",category_name:e.facility_categories?.name_ja||""}));t(a)}catch(e){const s=e instanceof Error?e.message:"施設データの取得に失敗しました";n(s),t([])}finally{r(!1)}},[]),setError:n,setFacilitiesLoading:r}}();s.useEffect(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{const s={lat:e.coords.latitude,lng:e.coords.longitude};h(s)},e=>{},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e5})},[]);const M=s.useMemo(()=>x&&0!==b.length?[...b].sort((e,s)=>R(x.lat,x.lng,Number(e.latitude)||0,Number(e.longitude)||0)-R(x.lat,x.lng,Number(s.latitude)||0,Number(s.longitude)||0)):b,[b,x]),P=s.useMemo(()=>{let e=v.filter(e=>d.includes(e.category));return x&&e.length>0&&(e=e.sort((e,s)=>R(x.lat,x.lng,e.latitude||0,e.longitude||0)-R(x.lat,x.lng,s.latitude||0,s.longitude||0))),e},[v,d,x]);s.useEffect(()=>{(async()=>{try{"dogparks"===t?await N():await k()}catch(e){}})()},[t,N,k]);const z="dogparks"===t?y:_,D=()=>{(async()=>{"dogparks"===t?await N():await k()})()};return("dogparks"===t?j:w)?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[!1,e.jsx($,{})]}):z?e.jsx(L,{error:z,onRetry:D}):"dogparks"===t&&0===b.length?e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx(I,{title:"ドッグランが見つかりません",description:"まだドッグランのデータが登録されていません。"})}):"facilities"===t&&0===v.length?e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx(I,{title:"施設が見つかりません",description:"まだ施設のデータが登録されていません。"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"ドッグパーク一覧"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"お近くのドッグランを見つけましょう"})]})})}),!1,e.jsx("div",{className:"bg-white border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex justify-center py-4",children:e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>a("dogparks"),className:"px-6 py-3 rounded-md font-medium transition-all "+("dogparks"===t?"bg-blue-600 text-white shadow-md":"text-gray-600 hover:text-gray-900 hover:bg-gray-200"),children:"🐕 ドッグラン"}),e.jsx("button",{onClick:()=>a("facilities"),className:"px-6 py-3 rounded-md font-medium transition-all "+("facilities"===t?"bg-green-600 text-white shadow-md":"text-gray-600 hover:text-gray-900 hover:bg-gray-200"),children:"🏢 ワンちゃんと行ける施設"})]})})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:["facilities"===t&&e.jsxs("div",{className:"mb-4 bg-white rounded-lg shadow-sm border",children:[e.jsxs("button",{onClick:()=>u(!g),className:"w-full px-3 py-3 flex items-center justify-between text-left hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"🏢 カテゴリフィルター"}),e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded-full",children:[d.length," / ",Object.keys(A).length]}),x&&e.jsx("span",{className:"text-xs text-green-600",children:"📍 距離順"})]}),e.jsx("span",{className:"text-gray-400 transition-transform "+(g?"rotate-180":""),children:"▼"})]}),g&&e.jsxs("div",{className:"px-3 pb-3 border-t border-gray-100",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-3 pt-3",children:[e.jsx("button",{onClick:()=>{m(Object.keys(A))},className:"px-2 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",children:"全選択"}),e.jsx("button",{onClick:()=>{m([])},className:"px-2 py-1 text-xs bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"全解除"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(A).map(([s,t])=>e.jsxs("button",{onClick:()=>(e=>{m(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])})(s),className:"px-3 py-2 text-sm rounded-full border transition-all "+(d.includes(s)?"bg-blue-500 text-white border-blue-500 shadow-md":"bg-gray-100 text-gray-700 border-gray-300 hover:bg-gray-200"),children:[q(s)," ",t]},s))})]})]}),e.jsx("div",{className:"mb-8",children:e.jsx(E,{parks:M,facilities:"facilities"===t?P:v,activeView:t,userLocation:x})}),"dogparks"===t&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"ドッグラン一覧"}),0===b.length?e.jsx(I,{title:"ドッグランが見つかりません",description:"現在登録されているドッグランがありません。"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:M.map(s=>{const t=x&&s.latitude&&s.longitude?R(x.lat,x.lng,Number(s.latitude),Number(s.longitude)):void 0;return e.jsx(C,{park:s,userLocation:x,...void 0!==t&&{distance:t}},s.id)})})]}),"facilities"===t&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"ワンちゃんと行ける施設"}),0===P.length?e.jsx(I,{title:"施設が見つかりません",description:0===d.length?"カテゴリを選択してください。":"選択したカテゴリの施設が登録されていません。"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:P.map(s=>{const t=x&&s.latitude&&s.longitude?R(x.lat,x.lng,s.latitude,s.longitude):void 0;return e.jsx(S,{facility:s,showDistance:!!x,...void 0!==t&&{distance:t}},s.id)})})]})]})]})}export{D as DogParkList};

import{j as e}from"./motion-CuO0nkIV.js";import{r as s}from"./react-vendor-cniURDpR.js";import{B as a}from"./Button-DiksLhRM.js";import{u as r,C as t,s as i}from"./index-DWDIgw5z.js";import{d as l,a as n}from"./router-Cg6wfOY4.js";import{af as c,aO as o}from"./ui-basic-icnN6BOT.js";import"./supabase-B0bqaRGb.js";import"./heavy-features-BIdEME4r.js";const d=()=>{const{id:d}=l(),m=n(),{user:x}=r(),[u,p]=s.useState(null),[g,h]=s.useState(!0),[f,b]=s.useState(!1),[j,y]=s.useState(""),[N,_]=s.useState(""),[v,w]=s.useState({name:"",description:"",rules:"",operating_hours:"",contact_info:"",max_capacity:0,facilities:{parking:!1,restroom:!1,water_supply:!1,lighting:!1,shade:!1,agility_equipment:!1,small_dog_area:!1,large_dog_area:!1}});return s.useEffect(()=>{(async()=>{if(d)try{h(!0);const{data:e,error:s}=await i.from("dog_parks").select("*").eq("id",d).single();if(s)throw s;if(e.owner_id!==x?.id)return void y("このドッグランを編集する権限がありません。");p(e),w({name:e.name||"",description:e.description||"",rules:e.rules||"",operating_hours:e.operating_hours||"",contact_info:e.contact_info||"",max_capacity:e.max_capacity||0,facilities:e.facilities||{parking:!1,restroom:!1,water_supply:!1,lighting:!1,shade:!1,agility_equipment:!1,small_dog_area:!1,large_dog_area:!1}})}catch(e){y("ドッグラン情報の取得に失敗しました。")}finally{h(!1)}})()},[d,x]),g?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"読み込み中..."})]})}):j&&!u?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-600 mb-4",children:j}),e.jsxs(a,{onClick:()=>m(-1),children:[e.jsx(c,{className:"w-4 h-4 mr-2"}),"戻る"]})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs(a,{variant:"secondary",onClick:()=>m(`/parks/${d}/manage`),className:"mb-4",children:[e.jsx(c,{className:"w-4 h-4 mr-2"}),"管理画面に戻る"]}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"ドッグラン編集"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"基本情報や設備情報を編集できます。"})]}),j&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-800",children:j})}),N&&e.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsx("p",{className:"text-green-800",children:N})}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),d)try{b(!0),y("");const{error:e}=await i.from("dog_parks").update({name:v.name,description:v.description,rules:v.rules,operating_hours:v.operating_hours,contact_info:v.contact_info,max_capacity:v.max_capacity,facilities:v.facilities,updated_at:(new Date).toISOString()}).eq("id",d);if(e)throw e;_("ドッグラン情報を更新しました。"),setTimeout(()=>{m(`/parks/${d}/manage`)},2e3)}catch(s){y(`更新エラー: ${s?.message||s?.error_description||"更新に失敗しました。"}`)}finally{b(!1)}},className:"space-y-6",children:[e.jsxs(t,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-6",children:"基本情報"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ドッグラン名 *"}),e.jsx("input",{type:"text",value:v.name,onChange:e=>w(s=>({...s,name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"説明"}),e.jsx("textarea",{value:v.description,onChange:e=>w(s=>({...s,description:e.target.value})),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"営業時間"}),e.jsx("input",{type:"text",value:v.operating_hours,onChange:e=>w(s=>({...s,operating_hours:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例：9:00-18:00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"最大収容数"}),e.jsx("input",{type:"number",value:v.max_capacity,onChange:e=>w(s=>({...s,max_capacity:parseInt(e.target.value)||0})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0"})]})]})]}),e.jsxs(t,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-6",children:"設備情報"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries({parking:"駐車場",restroom:"トイレ",water_supply:"給水設備",lighting:"照明",shade:"日陰",agility_equipment:"アジリティ",small_dog_area:"小型犬エリア",large_dog_area:"大型犬エリア"}).map(([s,a])=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:v.facilities[s],onChange:e=>w(a=>({...a,facilities:{...a.facilities,[s]:e.target.checked}})),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:a})]},s))})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(a,{type:"submit",disabled:f,className:"min-w-[120px]",children:f?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"保存中..."]}):e.jsxs(e.Fragment,{children:[e.jsx(o,{className:"w-4 h-4 mr-2"}),"保存"]})})})]})]})})};export{d as default};

import{j as e}from"./motion-CuO0nkIV.js";import{r as t}from"./react-vendor-cniURDpR.js";import{g as s}from"./geocoding-C2oaRnzC.js";import{B as r}from"./Button-D7FFKgkK.js";import{a}from"./index-qwdJeTcH.js";import{I as n}from"./Input-D7pb8xRh.js";import{M as l,_ as i}from"./ui-basic-icnN6BOT.js";const c=({initialAddress:c="",initialLatitude:o,initialLongitude:d,onLocationChange:m,className:u=""})=>{const x=t.useRef(null),g=t.useRef(null),f=t.useRef(null),[p,h]=t.useState(c),[j,b]=t.useState(o||35.6762),[y,w]=t.useState(d||139.6503),[v,N]=t.useState(!0),[C,$]=t.useState(!1),[_,L]=t.useState(""),{isLoaded:S,google:k}=a(),E=t.useCallback(async()=>{if(x.current&&k)try{const e=k,t=new e.maps.Map(x.current,{center:{lat:j,lng:y},zoom:16,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1});g.current=t;const s=new e.maps.Marker({position:{lat:j,lng:y},map:t,draggable:!0,title:"施設の位置（ドラッグして調整可能）",icon:{url:`data:image/svg+xml;charset=UTF-8,${encodeURIComponent('\n            <svg width="32" height="40" viewBox="0 0 32 40" xmlns="http://www.w3.org/2000/svg">\n              <path d="M16 0C7.163 0 0 7.163 0 16c0 16 16 24 16 24s16-8 16-24C32 7.163 24.837 0 16 0z" fill="#EF4444"/>\n              <circle cx="16" cy="16" r="8" fill="white"/>\n              <circle cx="16" cy="16" r="4" fill="#EF4444"/>\n            </svg>\n          ')}`,scaledSize:new e.maps.Size(32,40),anchor:new e.maps.Point(16,40)}});f.current=s,s.addListener("dragend",()=>{const e=s.getPosition();if(e){const t=e.lat(),s=e.lng();b(t),w(s),m(t,s)}}),N(!1)}catch(e){L("地図の読み込みに失敗しました。"),N(!1)}},[j,y,m]),P=t.useCallback(async()=>{if(p.trim()&&g.current&&f.current){$(!0);try{const t=[p.trim(),`〒861-8006 ${p.trim()}`,p.trim().replace(/[－]/g,"-"),p.trim().replace(/(\d+)丁目(\d+)-(\d+)/g,"$1-$2-$3"),p.trim().replace(/(\d+)丁目(\d+)－(\d+)/g,"$1-$2-$3")];let r=null,a=null;for(const n of t)try{if(r=await s(n),r)break}catch(e){a=e}if(r){const e=r.latitude,t=r.longitude,s={lat:e,lng:t};g.current.setCenter(s),g.current.setZoom(16),f.current.setPosition(s),b(e),w(t),m(e,t,r.formatted_address)}else alert(`住所が見つかりませんでした。\n\n入力された住所: ${p}\n\n以下をご確認ください：\n・住所が正確に入力されているか\n・郵便番号が含まれているか\n・全角文字が使用されていないか\n\nもしくは、マーカーを直接ドラッグして位置を調整してください。`)}catch(e){alert(`住所の検索中にエラーが発生しました。\n\nエラー詳細: ${e}\n\nマーカーを直接ドラッグして位置を調整してください。`)}finally{$(!1)}}},[p,m]);t.useEffect(()=>{S&&k&&E()},[E,S,k]),t.useEffect(()=>{const e=setTimeout(()=>{(async()=>{if(!0!==window.__PARK_LOCATION_LOCKED__&&c&&!o&&!d&&!C&&g.current&&f.current)try{$(!0);const e=await s(c);if(e){const t=e.latitude,s=e.longitude,r={lat:t,lng:s};g.current.setCenter(r),g.current.setZoom(16),f.current.setPosition(r),b(t),w(s),m(t,s,e.formatted_address)}}catch(e){}finally{$(!1)}})()},1e3);return()=>clearTimeout(e)},[c,o,d,C,m]);return _?e.jsx("div",{className:`bg-red-50 border border-red-200 rounded-lg p-4 ${u}`,children:e.jsxs("div",{className:"flex items-center text-red-800",children:[e.jsx(l,{className:"w-5 h-5 mr-2"}),_]})}):e.jsxs("div",{className:`space-y-4 ${u}`,children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"住所で検索"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(n,{value:p,onChange:e=>h(e.target.value),onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),P())},placeholder:"住所を入力してください",className:"flex-1"}),e.jsx(r,{type:"button",onClick:P,disabled:C||!p.trim(),className:"px-4",children:C?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(i,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{ref:x,className:"w-full h-80 rounded-lg border border-gray-300",style:{minHeight:"320px"}}),v&&e.jsx("div",{className:"absolute inset-0 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"地図を読み込み中..."})]})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"現在の座標:"}),e.jsxs("span",{className:"text-gray-600",children:[j.toFixed(6),", ",y.toFixed(6)]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"※ 赤いマーカーをドラッグして位置を調整できます"})]})]})};export{c as L};

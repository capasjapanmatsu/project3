import{s as i}from"./index-DcAUXhuw.js";import"./motion-CuO0nkIV.js";import"./react-vendor-cniURDpR.js";import"./heavy-features-BIdEME4r.js";import"./router-Cg6wfOY4.js";import"./supabase-B0bqaRGb.js";import"./ui-basic-Kxp_U5Up.js";async function e(e){const{userId:t,title:n,message:s,linkUrl:r,kind:o="alert",sendLine:a=!0,sendApp:l=!0}=e;try{if(l){(await i.from("notifications").insert({user_id:t,title:n,message:s,link_url:r||null,read:!1,type:"reservation_reminder",data:{}})).error&&await fetch("/.netlify/functions/app-notify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t,title:n,message:s,linkUrl:r,kind:o,sendLine:a})})}if(a){const{data:e}=await i.from("profiles").select("id, line_user_id, notify_opt_in").eq("id",t).maybeSingle();if(!e?.notify_opt_in||!e?.line_user_id)return;await fetch("/.netlify/functions/line-notify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({kind:o,lineUserId:e.line_user_id,title:n,message:s,mapUrl:r,linkUrl:r})})}}catch(d){}}export{e as notifyAppAndLine};

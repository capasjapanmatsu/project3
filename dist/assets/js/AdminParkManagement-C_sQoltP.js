const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/css/index-BHS2ZDIu.css"])))=>i.map(i=>d[i]);
import{_ as e}from"./supabase-B0bqaRGb.js";import{j as a}from"./motion-CuO0nkIV.js";import{r as s}from"./react-vendor-cniURDpR.js";import{a as t,L as r}from"./router-Cg6wfOY4.js";import{B as i}from"./Button-D7FFKgkK.js";import{u as n,C as d,s as l,c,f as o,d as m}from"./index-qwdJeTcH.js";import{I as p}from"./Input-D7pb8xRh.js";import{S as _}from"./Select-Dd_IZFKg.js";import{i as u,aC as x,J as g,N as h,_ as f,b9 as v,ba as y,M as w,aW as b,y as j,b as N,U as k,a1 as C,j as S,ae as L,X as $}from"./ui-basic-icnN6BOT.js";import"./heavy-features-BIdEME4r.js";function E({parkId:e,parkName:t}){const{user:r}=n(),[c,o]=s.useState([{park_id:e,lock_id:`${e}-entry`,purpose:"entry",ttlock_lock_id:"",pin_enabled:!0},{park_id:e,lock_id:`${e}-exit`,purpose:"exit",ttlock_lock_id:"",pin_enabled:!0}]),[m,p]=s.useState(!1),[_,u]=s.useState(null),[x,g]=s.useState("");s.useEffect(()=>{(async()=>{const{data:a,error:s}=await l.from("smart_locks").select("*").eq("park_id",e).order("purpose",{ascending:!0});s||Array.isArray(a)&&a.length&&o(e=>e.map(e=>a.find(a=>a.purpose===e.purpose)?{...e,...a.find(a=>a.purpose===e.purpose)}:e))})()},[e]);const h=(e,a,s)=>{o(t=>t.map(t=>t.purpose===e?{...t,[a]:s}:t))};return a.jsxs(d,{className:"p-4 mt-4 border-indigo-200 bg-indigo-50",children:[a.jsxs("h4",{className:"font-medium text-indigo-900 mb-3",children:["ã‚¹ãƒžãƒ¼ãƒˆãƒ­ãƒƒã‚¯è¨­å®šï¼ˆ",t,"ï¼‰"]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:c.map(e=>a.jsxs("div",{className:"p-3 bg-white rounded border",children:[a.jsx("div",{className:"text-sm text-gray-700 mb-2 font-semibold",children:"entry"===e.purpose?"å…¥å ´ç”¨":"é€€å ´ç”¨"}),a.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"ã‚¢ãƒ—ãƒªå†…ãƒ­ãƒƒã‚¯IDï¼ˆä»»æ„ãƒ»è‹±æ•°å­—ï¼‰"}),a.jsx("input",{className:"w-full border rounded px-2 py-1 mb-2",value:e.lock_id,onChange:a=>h(e.purpose,"lock_id",a.target.value)}),a.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"TTLock ãƒ­ãƒƒã‚¯IDï¼ˆæ•°å€¤ï¼‰"}),a.jsx("input",{className:"w-full border rounded px-2 py-1 mb-3",value:e.ttlock_lock_id??"",onChange:a=>h(e.purpose,"ttlock_lock_id",a.target.value),placeholder:"ä¾‹: 163377"}),a.jsx("div",{className:"flex gap-2",children:a.jsx(i,{size:"sm",onClick:()=>(async e=>{u(e),g("");try{const a=c.find(a=>a.purpose===e);if(!a)throw new Error("ãƒ­ãƒƒã‚¯è¨­å®šãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");const{data:{session:s}}=await l.auth.getSession();if(!s?.access_token)throw new Error("èªè¨¼ãŒå¿…è¦ã§ã™");const t=await fetch("https://onmcivwxtzqajcovptgf.supabase.co/functions/v1/ttlock-unlock",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.access_token}`},body:JSON.stringify({lockId:a.lock_id,ttlockLockId:a.ttlock_lock_id||void 0,userId:r?.id,purpose:e})}),i=await t.json();if(!t.ok||!i?.success)throw new Error(i?.error||"è§£éŒ ã«å¤±æ•—ã—ã¾ã—ãŸ");g("è§£éŒ ã‚³ãƒžãƒ³ãƒ‰ã‚’é€ä¿¡ã—ã¾ã—ãŸ")}catch(a){g(`ãƒ†ã‚¹ãƒˆå¤±æ•—: ${a.message}`)}finally{u(null)}})(e.purpose),isLoading:_===e.purpose,children:"ãƒ†ã‚¹ãƒˆè§£éŒ "})})]},e.purpose))}),a.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[a.jsx(i,{onClick:async()=>{p(!0),g("");try{if(!(await(async()=>{const{data:e}=await l.auth.getUser();if(e?.user?.id)return!0;try{const e=await fetch("/line/exchange-supabase-session",{method:"POST",credentials:"include"});if(!e.ok)return!1;const{access_token:a,refresh_token:s}=await e.json(),t=await l.auth.setSession({access_token:a,refresh_token:s});return Boolean(t?.data?.session?.user?.id)}catch{return!1}})()))throw new Error("èªè¨¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ç¢ºç«‹ã§ãã¾ã›ã‚“ã§ã—ãŸ");for(const r of c){const a=`${t} - ${"entry"===r.purpose?"å…¥å ´ã‚²ãƒ¼ãƒˆ":"é€€å ´ã‚²ãƒ¼ãƒˆ"}`,s="ttlock_smart_lock",{data:i,error:n}=await l.from("smart_locks").select("id").eq("park_id",e).eq("purpose",r.purpose).maybeSingle();if(n)throw n;if(i?.id){const{error:e}=await l.from("smart_locks").update({lock_id:r.lock_id,ttlock_lock_id:r.ttlock_lock_id,pin_enabled:!0,lock_name:a,lock_type:s}).eq("id",i.id);if(e)throw e}else{const{error:t}=await l.from("smart_locks").insert({park_id:e,purpose:r.purpose,lock_id:r.lock_id,ttlock_lock_id:r.ttlock_lock_id,pin_enabled:!0,lock_name:a,lock_type:s});if(t)throw t}}const{data:a,error:s}=await l.from("smart_locks").select("*").eq("park_id",e).order("purpose",{ascending:!0});if(s)throw s;a&&a.length&&o(e=>e.map(e=>a.find(a=>a.purpose===e.purpose)?{...e,...a.find(a=>a.purpose===e.purpose)}:e)),g("ä¿å­˜ã—ã¾ã—ãŸ")}catch(a){g(`ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ${a.message}`)}finally{p(!1)}},isLoading:m,children:"ä¿å­˜"}),x&&a.jsx("span",{className:"text-sm text-gray-700",children:x})]})]})}const A=e=>{const[a,t]=s.useState([]),[r,i]=s.useState([]),[n,d]=s.useState(!0),[p,_]=s.useState(""),[u,x]=s.useState(""),g=async()=>{try{d(!0),_(""),"parks"===e&&await(async()=>{try{c("info","ðŸ” Fetching pending parks...");const e=await m(()=>l.from("dog_parks").select("\n            id,\n            name,\n            address,\n            status,\n            created_at,\n            owner_id\n          ").in("status",["pending","first_stage_passed","second_stage_waiting","second_stage_review","smart_lock_testing"]).order("created_at",{ascending:!1}));if(e.error)throw c("error","âŒ Parks fetch error:",e.error),e.error;const a=e.data||[];if(0===a.length)return c("info","â„¹ï¸ No pending parks found"),void t([]);c("info",`âœ… Found ${a.length} pending parks`);const s=[...new Set(a.map(e=>e.owner_id))],r=a.map(e=>e.id),[i,n,d,o]=await Promise.allSettled([s.length>0?l.from("profiles").select("id, name, postal_code, address, phone_number, email").in("id",s):Promise.resolve({data:[],error:null}),r.length>0?l.from("dog_park_review_stages").select("park_id, second_stage_submitted_at").in("park_id",r):Promise.resolve({data:[],error:null}),r.length>0?l.from("dog_park_facility_images").select("park_id, is_approved").in("park_id",r):Promise.resolve({data:[],error:null}),s.length>0?l.from("owner_verifications").select("user_id, verification_id, status, verification_data, created_at").in("user_id",s):Promise.resolve({data:[],error:null})]),p="fulfilled"===i.status&&i.value.data||[],_=new Map(p.map(e=>[e.id,e])),u="fulfilled"===n.status&&n.value.data||[],x=new Map(u.map(e=>[e.park_id,e])),g="fulfilled"===d.status&&d.value.data||[],h=new Map;g.forEach(e=>{h.has(e.park_id)||h.set(e.park_id,[]),h.get(e.park_id).push(e)});const f="fulfilled"===o.status&&o.value.data||[],v=new Map(f.map(e=>[e.user_id,e])),y=a.map(e=>{const a=_.get(e.owner_id),s=x.get(e.id),t=h.get(e.id)||[],r=v.get(e.owner_id),i=t.length,n=t.filter(e=>!0===e.is_approved).length,d=t.filter(e=>!1===e.is_approved).length,l=t.filter(e=>null===e.is_approved).length;let c="",o="",m=null;return r&&r.verification_data&&"object"==typeof r.verification_data&&(m=r.verification_data,r.verification_data.document_url_front?(c=r.verification_data.document_url_front,o=r.verification_data.file_name_front||""):(c=r.verification_data.document_url||r.verification_data.file_path||"",o=r.verification_data.file_name||r.verification_data.filename||"")),!c&&r?.verification_id&&(c=r.verification_id),!o&&c&&(o=c.split("/").pop()||"identity_document"),{id:e.id,name:e.name,address:e.address,status:e.status,created_at:e.created_at,owner_id:e.owner_id,owner_name:a?.name||"Unknown Owner",second_stage_submitted_at:s?.second_stage_submitted_at||null,total_images:i,approved_images:n,rejected_images:d,pending_images:l,owner_postal_code:a?.postal_code||"",owner_address:a?.address||"",owner_phone_number:a?.phone_number||"",owner_email:a?.email||"",identity_document_url:c,identity_document_filename:o,identity_status:r?.status||"not_submitted",identity_created_at:r?.created_at||""}});c("info",`âœ… Transformed ${y.length} parks with image data`),t(y)}catch(e){c("error","âŒ Error fetching parks:",{error:o(e)}),_(`ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ç”³è«‹ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ${o(e)}`)}})()}catch(a){c("error","âŒ Error in fetchData:",{error:o(a)}),_(`ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ${o(a)}`)}finally{d(!1)}};return s.useEffect(()=>{g()},[e]),{pendingParks:a,pendingVaccines:r,isLoading:n,error:p,success:u,refetch:g}};function P(){const{isAdmin:c,user:o}=n(),m=t(),[P,T]=s.useState("applications"),[U,I]=s.useState([]),[M,B]=s.useState([]),[D,O]=s.useState([]),[q,z]=s.useState([]),[R,F]=s.useState([]),[J,H]=s.useState(!0),[V,K]=s.useState(""),[Q,W]=s.useState(""),[X,G]=s.useState(""),[Y,Z]=s.useState("all"),[ee,ae]=s.useState("created_at"),[se,te]=s.useState("desc"),[re,ie]=s.useState(null),ne=A("parks"),de=async e=>{if(0===e.length)return new Map;try{const{data:a,error:s}=await l.from("dog_parks").select("\n          id,\n          description,\n          price,\n          max_capacity,\n          large_dog_area,\n          small_dog_area,\n          private_booths,\n          facilities,\n          facility_details,\n          private_booth_count,\n          image_url,\n          cover_image_url,\n          average_rating,\n          review_count\n        ").in("id",e);if(s)return new Map;const t=new Map;return(a||[]).forEach(e=>{t.set(e.id,e)}),t}catch(a){return new Map}},le=async e=>{if(0===e.length)return new Map;try{const{data:a,error:s}=await l.from("dog_park_facility_images").select("\n          id,\n          park_id,\n          image_type,\n          image_url,\n          is_approved,\n          admin_notes,\n          created_at\n        ").in("park_id",e);if(s)return new Map;const t=new Map;return(a||[]).forEach(e=>{t.has(e.park_id)||t.set(e.park_id,[]),t.get(e.park_id).push(e)}),t}catch(a){return new Map}},ce=async e=>{if(0===e.length)return new Map;try{const{data:a,error:s}=await l.from("owner_verifications").select("\n          user_id,\n          verification_id,\n          status,\n          verification_data,\n          created_at\n        ").in("user_id",e);if(s)return new Map;const t=new Map;return(a||[]).forEach(e=>{t.set(e.user_id,e)}),t}catch(a){return new Map}},oe=async()=>{try{const{data:e,error:a}=await l.from("dog_parks").select("*").eq("status","approved").order("created_at",{ascending:!1});if(a)return[];if(!e||0===e.length)return[];const s=[...new Set(e.map(e=>e.owner_id))],{data:t,error:r}=await l.from("profiles").select("id, name, address, phone_number, email, postal_code").in("id",s),i=new Map;t&&t.forEach(e=>{i.set(e.id,e)});return e.map(e=>{const a=i.get(e.owner_id);return ge({id:e.id,name:e.name,address:e.address,status:e.status,created_at:e.created_at,owner_id:e.owner_id,owner_name:a?.name||"Unknown",owner_email:a?.email||"Unknown",owner_phone_number:a?.phone_number||"",owner_address:a?.address||"",identity_document_url:"",identity_document_filename:"",identity_status:"approved",identity_created_at:""},e,[])})}catch(e){return[]}},me=(e,a,s)=>{ie({url:e,type:a,parkName:s})},pe=()=>{ie(null)},_e=e=>{W(e),K(""),setTimeout(()=>W(""),5e3)},ue=e=>{K(e),W(""),setTimeout(()=>K(""),8e3)},xe=async e=>{if(window.confirm("ã“ã®ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ç”³è«‹ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚"))try{K(""),W("");const a=U.find(a=>a.id===e)||D.find(a=>a.id===e);if(!a)return void ue("ãƒ‰ãƒƒã‚°ãƒ©ãƒ³æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚");const{data:s,error:t}=await l.rpc("reject_and_delete_park",{p_park_id:e,p_admin_id:o?.id});if(t)return void ue(`å‰Šé™¤å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ: ${t.message}`);s?.success?(_e(`${s.park_name||a.name}ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚`),I(a=>a.filter(a=>a.id!==e)),O(a=>a.filter(a=>a.id!==e))):ue(s?.message||"å‰Šé™¤å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}catch(a){ue("å‰Šé™¤å‡¦ç†ä¸­ã«äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚")}},ge=(e,a,s,t)=>{const r=a||{};return{id:e.id,name:e.name,description:r.description||"",address:e.address,price:r.price||0,status:e.status,owner_id:e.owner_id,created_at:e.created_at,max_capacity:r.max_capacity||0,large_dog_area:r.large_dog_area||!1,small_dog_area:r.small_dog_area||!1,private_booths:r.private_booths||!1,facilities:r.facilities||{parking:!1,shower:!1,restroom:!1,agility:!1,rest_area:!1,water_station:!1},average_rating:r.average_rating||0,review_count:r.review_count||0,facility_details:r.facility_details||"",private_booth_count:r.private_booth_count||0,image_url:r.image_url||"",cover_image_url:r.cover_image_url||"",owner_name:e.owner_name||"Unknown",owner_email:e.owner_email||"Unknown",owner_phone:e.owner_phone_number||"",owner_address:e.owner_address||"",facility_images:s||[],identity_document_url:t?JSON.stringify(t.verification_data):e.identity_document_url||"",identity_document_filename:t?.verification_data?.file_name_front||t?.verification_data?.file_name||e.identity_document_filename||"",identity_status:t?.status||e.identity_status||"not_submitted",identity_created_at:t?.created_at||e.identity_created_at||""}};s.useEffect(()=>{c||m("/admin-dashboard")},[c,m]),s.useEffect(()=>{if(!ne.isLoading&&ne.pendingParks.length>0){(async()=>{const e=ne.pendingParks.map(e=>e.id),[a,s,t]=await Promise.all([de(e),le(e),ce(ne.pendingParks.map(e=>e.owner_id))]),r=ne.pendingParks.map(e=>{const r=a.get(e.id),i=s.get(e.id)||[],n=t.get(e.owner_id);return ge(e,r,i,n)});I(r),H(!1),fe(),oe().then(e=>{z(e),he(e)})})()}else ne.isLoading?H(!0):(I([]),H(!1),fe(),oe().then(e=>{z(e),he(e)}))},[ne.pendingParks,ne.isLoading]);const he=e=>{let a=e.filter(e=>(!X||e.name.toLowerCase().includes(X.toLowerCase())||e.address.toLowerCase().includes(X.toLowerCase())||e.owner_name.toLowerCase().includes(X.toLowerCase()))&&("all"===Y||"approved"===Y));a=a.sort((e,a)=>{let s,t;switch(ee){case"name":s=e.name,t=a.name;break;case"average_rating":s=e.average_rating||0,t=a.average_rating||0;break;default:s=e.created_at,t=a.created_at}return"asc"===se?s>t?1:-1:s<t?1:-1}),O(a)};s.useEffect(()=>{q.length>0&&he(q)},[X,Y,ee,se,q]),s.useEffect(()=>{U.length>0&&fe()},[X,Y,ee,se,U]);const fe=()=>{const e=["pending","first_stage_passed","second_stage_waiting","second_stage_review","smart_lock_testing"],a=["approved"];let s=U.filter(e=>{const a=!X||e.name.toLowerCase().includes(X.toLowerCase())||e.address.toLowerCase().includes(X.toLowerCase())||e.owner_name.toLowerCase().includes(X.toLowerCase()),s="all"===Y||e.status===Y;return a&&s});s=s.sort((e,a)=>{let s,t;switch(ee){case"name":s=e.name,t=a.name;break;case"average_rating":s=e.average_rating||0,t=a.average_rating||0;break;default:s=e.created_at,t=a.created_at}return"asc"===se?s>t?1:-1:s<t?1:-1}),B(s);const t=s.filter(a=>e.includes(a.status));s.filter(e=>a.includes(e.status));F(t)},ve=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"first_stage_passed":return"bg-blue-100 text-blue-800";case"second_stage_waiting":return"bg-orange-100 text-orange-800";case"second_stage_review":return"bg-purple-100 text-purple-800";case"smart_lock_testing":return"bg-indigo-100 text-indigo-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},ye=e=>{switch(e){case"pending":return"ç¬¬ä¸€å¯©æŸ»ä¸­";case"first_stage_passed":return"ç¬¬ä¸€å¯©æŸ»é€šéŽï¼ˆæ—§ï¼‰";case"second_stage_waiting":return"ç¬¬äºŒå¯©æŸ»æå‡ºå¾…ã¡";case"second_stage_review":return"ç¬¬äºŒå¯©æŸ»ä¸­";case"smart_lock_testing":return"ã‚¹ãƒžãƒ¼ãƒˆãƒ­ãƒƒã‚¯èªè¨¼å¾…ã¡";case"approved":return"æ‰¿èªæ¸ˆã¿ãƒ»å…¬é–‹å¯èƒ½";case"rejected":return"å´ä¸‹";default:return"ä¸æ˜Ž"}},we=e=>`Â¥${e.toLocaleString()}`,be=e=>new Date(e).toLocaleDateString("ja-JP",{year:"numeric",month:"short",day:"numeric"});return J?a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­..."})]})}):a.jsxs("div",{className:"min-h-screen bg-gray-50 py-8",children:[a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[a.jsxs("div",{className:"bg-white shadow rounded-lg mb-8",children:[a.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ç®¡ç†"}),a.jsx("p",{className:"text-gray-600",children:"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³æ–½è¨­ã®è©³ç´°æƒ…å ±ã¨ç”³è«‹ç®¡ç†"})]}),V&&a.jsx("div",{className:"px-6 py-4 bg-red-50 border-l-4 border-red-400",children:a.jsxs("div",{className:"flex",children:[a.jsx(u,{className:"h-5 w-5 text-red-400 mr-2"}),a.jsx("p",{className:"text-sm text-red-700",children:V})]})}),Q&&a.jsx("div",{className:"px-6 py-4 bg-green-50 border-l-4 border-green-400",children:a.jsxs("div",{className:"flex",children:[a.jsx(x,{className:"h-5 w-5 text-green-400 mr-2"}),a.jsx("p",{className:"text-sm text-green-700",children:Q})]})}),a.jsx("div",{className:"px-6",children:a.jsxs("nav",{className:"flex space-x-8","aria-label":"Tabs",children:[a.jsxs("button",{onClick:()=>T("applications"),className:"whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm "+("applications"===P?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[a.jsx(g,{className:"w-5 h-5 inline mr-2"}),"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ç”³è«‹",a.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:R.length})]}),a.jsxs("button",{onClick:()=>T("parks"),className:"whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm "+("parks"===P?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[a.jsx(h,{className:"w-5 h-5 inline mr-2"}),"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ä¸€è¦§",a.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:D.length})]})]})})]}),"parks"===P&&a.jsxs("div",{className:"space-y-6",children:[a.jsx(d,{className:"p-6",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsxs("div",{className:"relative",children:[a.jsx(f,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(p,{label:"",placeholder:"æ–½è¨­åã€ä½æ‰€ã€ã‚ªãƒ¼ãƒŠãƒ¼åã§æ¤œç´¢...",value:X,onChange:e=>G(e.target.value),className:"pl-10"})]}),a.jsx(_,{label:"",options:[{value:"all",label:"å…¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹"},{value:"approved",label:"æ‰¿èªæ¸ˆã¿"}],value:Y,onChange:e=>Z(e.target.value)}),a.jsx(_,{label:"",options:[{value:"created_at",label:"ä½œæˆæ—¥æ™‚"},{value:"name",label:"æ–½è¨­å"},{value:"average_rating",label:"å¹³å‡è©•ä¾¡"}],value:ee,onChange:e=>ae(e.target.value)}),a.jsxs(i,{variant:"secondary",onClick:()=>te("asc"===se?"desc":"asc"),className:"flex items-center justify-center",children:["asc"===se?a.jsx(v,{className:"w-4 h-4 mr-2"}):a.jsx(y,{className:"w-4 h-4 mr-2"}),"asc"===se?"æ˜‡é †":"é™é †"]})]})}),0===D.length?a.jsxs(d,{className:"text-center py-12",children:[a.jsx(h,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:X||"all"!==Y?"æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“":"æ‰¿èªæ¸ˆã¿ã®ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ãŒã‚ã‚Šã¾ã›ã‚“"})]}):a.jsx("div",{className:"grid grid-cols-1 gap-6",children:D.map(e=>a.jsxs(d,{className:"p-6",children:[a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),a.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${ve(e.status)}`,children:ye(e.status)})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[a.jsx(w,{className:"w-4 h-4 mr-1"}),e.address]}),a.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[a.jsx(b,{className:"w-4 h-4 mr-1"}),we(e.price)]}),a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(j,{className:"w-4 h-4 mr-1"}),be(e.created_at)]})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[a.jsx(N,{className:"w-4 h-4 mr-1"}),e.owner_name]}),a.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[a.jsx(k,{className:"w-4 h-4 mr-1"}),"å®šå“¡: ",e.max_capacity,"é ­"]}),e.average_rating&&e.average_rating>0&&a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(C,{className:"w-4 h-4 mr-1"}),e.average_rating.toFixed(1)," (",e.review_count||0,"ä»¶)"]})]})]}),e.description&&a.jsx("p",{className:"text-sm text-gray-600 mb-3",children:e.description}),a.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.large_dog_area&&a.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:"å¤§åž‹çŠ¬ã‚¨ãƒªã‚¢"}),e.small_dog_area&&a.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded",children:"å°åž‹çŠ¬ã‚¨ãƒªã‚¢"}),e.private_booths&&a.jsx("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded",children:"å€‹å®¤ã‚ã‚Š"}),e.facilities.parking&&a.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"é§è»Šå ´"}),e.facilities.shower&&a.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"ã‚·ãƒ£ãƒ¯ãƒ¼"})]})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs(r,{to:`/parks/${e.id}`,className:"flex items-center px-3 py-1 text-sm bg-blue-100 text-blue-800 rounded-md hover:bg-blue-200",children:[a.jsx(S,{className:"w-4 h-4 mr-1"}),"è©³ç´°"]}),a.jsxs(i,{size:"sm",variant:"secondary",onClick:()=>xe(e.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[a.jsx(L,{className:"w-4 h-4 mr-1"}),"å‰Šé™¤"]})]})]}),a.jsx("div",{className:"mt-4",children:a.jsx(E,{parkId:e.id,parkName:e.name})})]},e.id))})]}),"applications"===P&&a.jsxs("div",{className:"space-y-6",children:[a.jsx(d,{className:"p-6",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsxs("div",{className:"relative",children:[a.jsx(f,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(p,{label:"",placeholder:"æ–½è¨­åã€ä½æ‰€ã€ã‚ªãƒ¼ãƒŠãƒ¼åã§æ¤œç´¢...",value:X,onChange:e=>G(e.target.value),className:"pl-10"})]}),a.jsx(_,{label:"",options:[{value:"all",label:"å…¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹"},{value:"pending",label:"ç¬¬ä¸€å¯©æŸ»ä¸­"},{value:"first_stage_passed",label:"ç¬¬ä¸€å¯©æŸ»é€šéŽï¼ˆæ—§ï¼‰"},{value:"second_stage_waiting",label:"ç¬¬äºŒå¯©æŸ»æå‡ºå¾…ã¡"},{value:"second_stage_review",label:"ç¬¬äºŒå¯©æŸ»ä¸­"},{value:"smart_lock_testing",label:"ã‚¹ãƒžãƒ¼ãƒˆãƒ­ãƒƒã‚¯èªè¨¼å¾…ã¡"},{value:"rejected",label:"å´ä¸‹"}],value:Y,onChange:e=>Z(e.target.value)}),a.jsx(_,{label:"",options:[{value:"created_at",label:"ä½œæˆæ—¥æ™‚"},{value:"name",label:"æ–½è¨­å"},{value:"average_rating",label:"å¹³å‡è©•ä¾¡"}],value:ee,onChange:e=>ae(e.target.value)}),a.jsxs(i,{variant:"secondary",onClick:()=>te("asc"===se?"desc":"asc"),className:"flex items-center justify-center",children:["asc"===se?a.jsx(v,{className:"w-4 h-4 mr-2"}):a.jsx(y,{className:"w-4 h-4 mr-2"}),"asc"===se?"æ˜‡é †":"é™é †"]})]})}),0===R.length?a.jsxs(d,{className:"text-center py-12",children:[a.jsx(g,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:X||"all"!==Y?"æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹ç”³è«‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“":"å¯©æŸ»ä¸­ã®ç”³è«‹ãŒã‚ã‚Šã¾ã›ã‚“"})]}):a.jsx("div",{className:"grid grid-cols-1 gap-6",children:R.map(s=>a.jsxs(d,{className:"p-6",children:[a.jsx("div",{className:"flex items-start justify-between mb-4",children:a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.name}),a.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${ve(s.status)}`,children:ye(s.status)})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-4",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"ç”³è«‹è€…æƒ…å ±"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(N,{className:"w-4 h-4 mr-2"}),s.owner_name]}),a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(w,{className:"w-4 h-4 mr-2"}),s.owner_address||"ä½æ‰€æœªç™»éŒ²"]}),a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(j,{className:"w-4 h-4 mr-2"}),"ç”³è«‹æ—¥: ",be(s.created_at)]})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"æ–½è¨­æƒ…å ±"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(w,{className:"w-4 h-4 mr-2"}),s.address]}),a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(b,{className:"w-4 h-4 mr-2"}),we(s.price)]}),a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(k,{className:"w-4 h-4 mr-2"}),"å®šå“¡: ",s.max_capacity,"é ­"]})]})]})]}),a.jsxs("div",{className:"mb-4",children:[a.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center",children:[a.jsx(g,{className:"w-4 h-4 mr-2"}),"æœ¬äººç¢ºèªæ›¸é¡ž"]}),a.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:s.identity_document_url&&""!==s.identity_document_url?a.jsxs("div",{className:"space-y-4",children:[(()=>{try{const e="string"==typeof s.identity_document_url&&s.identity_document_url.startsWith("{")?JSON.parse(s.identity_document_url):null;if(e&&(e.document_url_front||e.document_url_back))return a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.document_url_front&&a.jsxs("div",{className:"space-y-2",children:[a.jsx("h5",{className:"font-medium text-gray-800",children:"è¡¨é¢"}),a.jsx("div",{className:"relative",children:a.jsx("img",{src:`${l.storage.from("vaccine-certs").getPublicUrl(e.document_url_front).data.publicUrl}`,alt:"æœ¬äººç¢ºèªæ›¸é¡žï¼ˆè¡¨é¢ï¼‰",className:"w-full max-w-xs h-auto object-cover rounded border shadow-sm cursor-pointer hover:shadow-md transition-shadow",onClick:()=>me(`${l.storage.from("vaccine-certs").getPublicUrl(e.document_url_front).data.publicUrl}`,"æœ¬äººç¢ºèªæ›¸é¡žï¼ˆè¡¨é¢ï¼‰",s.name)})}),e.file_name_front&&a.jsxs("div",{className:"text-sm text-gray-600",children:["ãƒ•ã‚¡ã‚¤ãƒ«å: ",e.file_name_front]})]}),e.document_url_back&&a.jsxs("div",{className:"space-y-2",children:[a.jsx("h5",{className:"font-medium text-gray-800",children:"è£é¢"}),a.jsx("div",{className:"relative",children:a.jsx("img",{src:`${l.storage.from("vaccine-certs").getPublicUrl(e.document_url_back).data.publicUrl}`,alt:"æœ¬äººç¢ºèªæ›¸é¡žï¼ˆè£é¢ï¼‰",className:"w-full max-w-xs h-auto object-cover rounded border shadow-sm cursor-pointer hover:shadow-md transition-shadow",onClick:()=>me(`${l.storage.from("vaccine-certs").getPublicUrl(e.document_url_back).data.publicUrl}`,"æœ¬äººç¢ºèªæ›¸é¡žï¼ˆè£é¢ï¼‰",s.name)})}),e.file_name_back&&a.jsxs("div",{className:"text-sm text-gray-600",children:["ãƒ•ã‚¡ã‚¤ãƒ«å: ",e.file_name_back]})]})]})}catch(e){}return a.jsxs("div",{className:"flex items-start space-x-4",children:[a.jsx("div",{className:"relative",children:a.jsx("img",{src:`${l.storage.from("vaccine-certs").getPublicUrl(s.identity_document_url||"").data.publicUrl}`,alt:"æœ¬äººç¢ºèªæ›¸é¡ž",className:"w-32 h-32 object-cover rounded border shadow-sm cursor-pointer hover:shadow-md transition-shadow",onClick:()=>me(`${l.storage.from("vaccine-certs").getPublicUrl(s.identity_document_url||"").data.publicUrl}`,"æœ¬äººç¢ºèªæ›¸é¡ž",s.name)})}),a.jsx("div",{children:a.jsxs("div",{className:"mb-2",children:[a.jsx("span",{className:"text-sm font-medium text-gray-700",children:"ãƒ•ã‚¡ã‚¤ãƒ«å:"}),a.jsx("span",{className:"text-sm text-gray-600 ml-2",children:s.identity_document_filename||"identity_document"})]})})]})})(),a.jsxs("div",{className:"mt-4 pt-4 border-t border-blue-200",children:[a.jsxs("div",{className:"mb-2",children:[a.jsx("span",{className:"text-sm font-medium text-gray-700",children:"å¯©æŸ»çŠ¶æ³:"}),a.jsx("span",{className:"text-sm ml-2 px-2 py-1 rounded-full "+("approved"===s.identity_status?"bg-green-100 text-green-800":"rejected"===s.identity_status?"bg-red-100 text-red-800":"submitted"===s.identity_status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:"approved"===s.identity_status?"æ‰¿èªæ¸ˆã¿":"rejected"===s.identity_status?"å´ä¸‹":"submitted"===s.identity_status?"å¯©æŸ»ä¸­":"æœªæå‡º"})]}),s.identity_created_at&&a.jsxs("div",{className:"mb-2",children:[a.jsx("span",{className:"text-sm font-medium text-gray-700",children:"æå‡ºæ—¥:"}),a.jsx("span",{className:"text-sm text-gray-600 ml-2",children:be(s.identity_created_at)})]})]})]}):a.jsx("div",{className:"text-gray-500 text-sm",children:"æœ¬äººç¢ºèªæ›¸é¡žãŒæå‡ºã•ã‚Œã¦ã„ã¾ã›ã‚“"})})]}),s.description&&a.jsxs("div",{className:"mb-4",children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"æ–½è¨­èª¬æ˜Ž"}),a.jsx("p",{className:"text-sm text-gray-600",children:s.description})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"è¨­å‚™ãƒ»ã‚µãƒ¼ãƒ“ã‚¹"}),a.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.large_dog_area&&a.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:"å¤§åž‹çŠ¬ã‚¨ãƒªã‚¢"}),s.small_dog_area&&a.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded",children:"å°åž‹çŠ¬ã‚¨ãƒªã‚¢"}),s.private_booths&&a.jsx("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded",children:"å€‹å®¤ã‚ã‚Š"}),s.facilities.parking&&a.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"é§è»Šå ´"}),s.facilities.shower&&a.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"ã‚·ãƒ£ãƒ¯ãƒ¼"}),s.facilities.restroom&&a.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"ãƒˆã‚¤ãƒ¬"}),s.facilities.agility&&a.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"ã‚¢ã‚¸ãƒªãƒ†ã‚£"}),s.facilities.rest_area&&a.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"ä¼‘æ†©ã‚¨ãƒªã‚¢"}),s.facilities.water_station&&a.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"çµ¦æ°´è¨­å‚™"})]})]}),"second_stage_review"===s.status&&s.facility_images&&s.facility_images.length>0&&a.jsxs("div",{className:"mb-4",children:[a.jsxs("h4",{className:"font-medium text-gray-900 mb-2",children:["è¨­å‚™ç”»åƒ (",s.facility_images.length,"æžš)"]}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:s.facility_images.map((e,t)=>a.jsxs("div",{className:"relative",children:[a.jsx("img",{src:e.image_url,alt:`è¨­å‚™ç”»åƒ ${t+1}`,className:"w-full aspect-square object-cover rounded-md border cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>me(e.image_url,e.image_type,s.name)}),a.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded-b-md",children:e.image_type})]},e.id))})]}),a.jsx("div",{className:"mt-4",children:a.jsx(E,{parkId:s.id,parkName:s.name})})]})}),a.jsxs("div",{className:"flex justify-end space-x-2",children:[("pending"===s.status||"first_stage_passed"===s.status||"second_stage_review"===s.status||"second_stage_waiting"===s.status)&&a.jsxs(a.Fragment,{children:[a.jsxs(i,{size:"sm",onClick:()=>(async a=>{const s=U.find(e=>e.id===a);if(!s)return;let t,r,i;switch(s.status){case"pending":t="second_stage_waiting",r="ã“ã®ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã®ç¬¬ä¸€å¯©æŸ»ã‚’æ‰¿èªã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ",i="ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã®ç¬¬ä¸€å¯©æŸ»ã‚’æ‰¿èªã—ã¾ã—ãŸã€‚",s.name;break;case"second_stage_waiting":t="second_stage_review",r="ã“ã®ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã‚’ç¬¬äºŒå¯©æŸ»ä¸­ã«å¤‰æ›´ã—ã¾ã™ã‹ï¼Ÿ",i="ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ãŒç¬¬äºŒå¯©æŸ»ä¸­ã«å¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚",s.name;break;case"second_stage_review":t="approved",r="ã“ã®ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã®ç¬¬äºŒå¯©æŸ»ã‚’æ‰¿èªã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ\næ‰¿èªå¾Œã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§éžå…¬é–‹çŠ¶æ…‹ã«ãªã‚Šã€ã‚ªãƒ¼ãƒŠãƒ¼ãŒå…¬é–‹è¨­å®šã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚",i="ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã®ç¬¬äºŒå¯©æŸ»ã‚’æ‰¿èªã—ã¾ã—ãŸã€‚ã‚ªãƒ¼ãƒŠãƒ¼ãŒå…¬é–‹è¨­å®šã‚’è¡Œã†ã¾ã§éžå…¬é–‹çŠ¶æ…‹ã§ã™ã€‚",s.name;break;case"smart_lock_testing":t="approved",r="ã“ã®ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã®æ‰¿èªã‚’å®Œäº†ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ",i="ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ãŒæ‰¿èªã•ã‚Œã¾ã—ãŸã€‚",s.name;break;default:return void ue("ã“ã®ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã®ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§ã¯æ‰¿èªã§ãã¾ã›ã‚“ã€‚")}if(window.confirm(r))try{if(K(""),W(""),"second_stage_review"===s.status&&"approved"===t){const{error:e}=await l.rpc("approve_second_stage_review",{park_id_param:a});if(e)return void ue(`ç¬¬äºŒå¯©æŸ»æ‰¿èªã«å¤±æ•—ã—ã¾ã—ãŸ: ${e.message||"ä¸æ˜Žãªã‚¨ãƒ©ãƒ¼"}`)}else{const e={status:t};"approved"===t&&(e.is_public=!1);const{error:s}=await l.from("dog_parks").update(e).eq("id",a);if(s)return void("23514"===s.code?ue(`æ‰¿èªå‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ "${t}" ãŒè¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\n\nðŸ“‹ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®åˆ¶ç´„ã‚’æ›´æ–°ã—ã¦ãã ã•ã„ï¼š\n\n1. https://app.supabase.com ã«ã‚¢ã‚¯ã‚»ã‚¹\n2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠž\n3. å·¦å´ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€ŒSQL Editorã€ã‚’é¸æŠž\n4. ä»¥ä¸‹ã®SQLã‚’å®Ÿè¡Œï¼š\n\nALTER TABLE dog_parks DROP CONSTRAINT IF EXISTS dog_parks_status_check;\nALTER TABLE dog_parks ADD CONSTRAINT dog_parks_status_check CHECK (status IN ('pending', 'first_stage_passed', 'second_stage_waiting', 'second_stage_review', 'smart_lock_testing', 'approved', 'rejected'));\n\n5. ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿`):ue(`æ‰¿èªå‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ: ${s.message||"ä¸æ˜Žãªã‚¨ãƒ©ãƒ¼"}`))}try{if("pending"===s.status&&"second_stage_waiting"===t){const a="@https://dogparkjp.com/products/c9d47ff9-a6c1-4f09-97ec-ad4d2334cbe7\nã“ã¡ã‚‰ã‚ˆã‚Šã‚¹ãƒžãƒ¼ãƒˆãƒ‰ãƒƒã‚°ãƒ©ãƒ³ç”¨ã®ã‚¹ãƒžãƒ¼ãƒˆãƒ­ãƒƒã‚¯ã‚’ã”æ³¨æ–‡ãŠé¡˜ã„ã—ã¾ã™ã€‚é‹å–¶ç‚ºã«å¿…é ˆã¨ãªã‚Šã¾ã™ã€‚";await l.from("messages").insert({sender_id:o?.id||null,receiver_id:s.owner_id,content:a});const{notifyAppAndLineBoth:t}=await e(async()=>{const{notifyAppAndLineBoth:e}=await import("./notifyAll-DvkW0YpH.js");return{notifyAppAndLineBoth:e}},__vite__mapDeps([0]));await t({userId:s.owner_id,type:"park_apply_approved",title:"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ç¬¬ä¸€å¯©æŸ»æ‰¿èª",message:`${s.name}ã®ç¬¬ä¸€å¯©æŸ»ãŒæ‰¿èªã•ã‚Œã¾ã—ãŸã€‚`,linkUrl:`/parks/${s.id}`})}if(("second_stage_review"===s.status||"second_stage_waiting"===s.status)&&"approved"===t){const{notifyAppAndLineBoth:a}=await e(async()=>{const{notifyAppAndLineBoth:e}=await import("./notifyAll-DvkW0YpH.js");return{notifyAppAndLineBoth:e}},__vite__mapDeps([0]));await a({userId:s.owner_id,type:"park_apply_approved",title:"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ç¬¬äºŒå¯©æŸ»æ‰¿èª",message:`${s.name}ã®ç¬¬äºŒå¯©æŸ»ãŒæ‰¿èªã•ã‚Œã¾ã—ãŸã€‚å…¬é–‹è¨­å®šã‚’è¡Œã£ã¦ãã ã•ã„ã€‚`,linkUrl:`/parks/${s.id}`})}}catch(n){}await ne.refetch(),_e(i),setTimeout(()=>{window.location.reload()},1e3)}catch(d){ue(`æ‰¿èªå‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ: ${d instanceof Error?d.message:"ä¸æ˜Žãªã‚¨ãƒ©ãƒ¼"}`)}})(s.id),className:"bg-green-600 hover:bg-green-700",children:[a.jsx(x,{className:"w-4 h-4 mr-1"}),"pending"===s.status?"ç¬¬ä¸€å¯©æŸ»æ‰¿èª":"second_stage_review"===s.status||"second_stage_waiting"===s.status?"ç¬¬äºŒå¯©æŸ»æ‰¿èª":"æ‰¿èª"]}),a.jsxs(i,{size:"sm",variant:"secondary",onClick:()=>(async e=>{if(window.confirm("ã“ã®ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ç”³è«‹ã‚’å´ä¸‹ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ\nâ€» å´ä¸‹ã•ã‚ŒãŸãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å®Œå…¨ã«å‰Šé™¤ã•ã‚Œã€ã‚ªãƒ¼ãƒŠãƒ¼ã®ãƒžã‚¤ãƒšãƒ¼ã‚¸ã‹ã‚‰ã‚‚å‰Šé™¤ã•ã‚Œã¾ã™ã€‚"))try{K(""),W("");const a=U.find(a=>a.id===e);if(!a)return void ue("ãƒ‰ãƒƒã‚°ãƒ©ãƒ³æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚");const{data:s,error:t}=await l.rpc("reject_and_delete_park",{p_park_id:e,p_admin_id:o?.id});if(t)return void ue(`å‰Šé™¤å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ: ${t.message}`);s?.success?(_e(`${s.park_name||a.name}ã®ç”³è«‹ã‚’å´ä¸‹ã—ã€ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚ã‚ªãƒ¼ãƒŠãƒ¼ï¼ˆ${s.owner_email||a.owner_email}ï¼‰ã«é€šçŸ¥ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚`),I(a=>a.filter(a=>a.id!==e))):ue(s?.message||"å´ä¸‹å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}catch(a){ue("å´ä¸‹å‡¦ç†ä¸­ã«äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚")}})(s.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[a.jsx($,{className:"w-4 h-4 mr-1"}),"å´ä¸‹"]})]}),a.jsxs(i,{size:"sm",variant:"secondary",onClick:()=>xe(s.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[a.jsx(L,{className:"w-4 h-4 mr-1"}),"å‰Šé™¤"]})]})]},s.id))})]})]}),re&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",onClick:pe,onKeyDown:e=>{"Escape"===e.key&&pe()},tabIndex:0,children:a.jsxs("div",{className:"relative max-w-4xl max-h-full",children:[a.jsx("img",{src:re.url,alt:`${re.parkName} - ${re.type}`,className:"max-w-full max-h-full object-contain rounded-lg",onClick:e=>e.stopPropagation()}),a.jsxs("div",{className:"absolute bottom-4 left-4 right-4 bg-black bg-opacity-50 text-white p-3 rounded-lg",children:[a.jsx("h3",{className:"font-medium text-lg",children:re.parkName}),a.jsx("p",{className:"text-sm text-gray-300",children:re.type})]}),a.jsx("button",{onClick:pe,className:"absolute top-4 right-4 text-white hover:text-gray-300 bg-black bg-opacity-50 rounded-full p-2",children:a.jsx($,{className:"w-6 h-6"})})]})})]})}export{P as AdminParkManagement};

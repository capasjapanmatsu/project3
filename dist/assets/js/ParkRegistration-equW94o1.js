import{j as e}from"./motion-CuO0nkIV.js";import{r as s}from"./react-vendor-cniURDpR.js";import{B as a}from"./Button-DiksLhRM.js";import{C as t,s as r,h as l,u as i}from"./index-DWDIgw5z.js";import{X as n,i as c,ao as o,aU as d,aH as m,ac as x,aV as h,e as u,W as p,R as g,aK as j,a as b,a4 as y,N as f,aW as N,J as v,b as w,ad as k,F as C,aA as _,ae as D}from"./ui-basic-icnN6BOT.js";import{L as E,a as S}from"./router-Cg6wfOY4.js";import{I as T}from"./Input-D7pb8xRh.js";import{I as F}from"./ImageCropper-BCmStMBM.js";import{u as O,r as B}from"./useRetryWithRecovery-CuoS1EBo.js";import{f as A,g as P}from"./geocoding-C2oaRnzC.js";import"./supabase-B0bqaRGb.js";import"./heavy-features-BIdEME4r.js";const R=({type:s,className:a="w-6 h-6"})=>{switch(s){case"network":return e.jsx(p,{className:`${a} text-orange-600`});case"authentication":return e.jsx(u,{className:`${a} text-red-600`});case"authorization":return e.jsx(h,{className:`${a} text-red-600`});case"validation":return e.jsx(c,{className:`${a} text-yellow-600`});case"timeout":return e.jsx(x,{className:`${a} text-blue-600`});case"server":return e.jsx(m,{className:`${a} text-red-600`});case"not_found":return e.jsx(d,{className:`${a} text-gray-600`});case"storage":return e.jsx(d,{className:`${a} text-orange-600`});case"payment":return e.jsx(o,{className:`${a} text-purple-600`});default:return e.jsx(c,{className:`${a} text-gray-600`})}},$=({error:r,onClear:l,onRetry:i,className:c="",showAsModal:o=!1})=>{if(s.useEffect(()=>{if(r&&"low"===r.severity&&"validation"===r.type){const e=setTimeout(()=>{l()},5e3);return()=>clearTimeout(e)}},[r,l]),!r)return null;const d=(e=>{switch(e){case"low":return{bg:"bg-yellow-50",border:"border-yellow-200",text:"text-yellow-800",button:"bg-yellow-600 hover:bg-yellow-700"};case"medium":return{bg:"bg-orange-50",border:"border-orange-200",text:"text-orange-800",button:"bg-orange-600 hover:bg-orange-700"};case"high":return{bg:"bg-red-50",border:"border-red-200",text:"text-red-800",button:"bg-red-600 hover:bg-red-700"};case"critical":return{bg:"bg-red-100",border:"border-red-300",text:"text-red-900",button:"bg-red-700 hover:bg-red-800"};default:return{bg:"bg-gray-50",border:"border-gray-200",text:"text-gray-800",button:"bg-gray-600 hover:bg-gray-700"}}})(r.severity),m=e.jsx("div",{className:`${d.bg} ${d.border} border rounded-lg p-4 ${c}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(R,{type:r.type,className:"flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`text-sm font-medium ${d.text} mb-1`,children:"エラーが発生しました"}),e.jsx("p",{className:`text-sm ${d.text} mb-3`,children:r.userMessage}),!1]}),!o&&e.jsx("button",{onClick:l,className:`ml-2 ${d.text} hover:opacity-75`,"aria-label":"エラーを閉じる",children:e.jsx(n,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:(()=>{const s=[];return r.retryable&&i&&s.push(e.jsxs(a,{size:"sm",onClick:()=>{i()},className:d.button,children:[e.jsx(g,{className:"w-4 h-4 mr-1"}),"再試行"]},"retry")),"authentication"===r.type&&s.push(e.jsxs(a,{size:"sm",onClick:()=>window.location.href="/login",className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(j,{className:"w-4 h-4 mr-1"}),"ログイン"]},"login")),"high"!==r.severity&&"critical"!==r.severity||s.push(e.jsxs(a,{size:"sm",variant:"secondary",onClick:()=>window.location.href="/",children:[e.jsx(b,{className:"w-4 h-4 mr-1"}),"ホームに戻る"]},"home")),s.push(e.jsxs(a,{size:"sm",variant:"secondary",onClick:l,children:[e.jsx(n,{className:"w-4 h-4 mr-1"}),"閉じる"]},"close")),s})()})]})]})});return o?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx(t,{className:"max-w-md w-full",children:m})}):m};function L({formData:l,onFormDataChange:i,onSubmit:n,error:o,isLoading:d}){const[m,x]=s.useState(""),[h,u]=s.useState(!1),p=e=>{i(e)};return s.useEffect(()=>{const e=setTimeout(()=>{l.name.trim()?(async e=>{if(e.trim()){u(!0);try{const{data:s,error:a}=await r.from("dog_parks").select("id, name").eq("name",e.trim()).limit(1);if(a)return void x("");s&&s.length>0?x("このドッグラン名は既に使用されています。別の名前を選択してください。"):x("")}catch(s){x("")}finally{u(!1)}}else x("")})(l.name):x("")},500);return()=>clearTimeout(e)},[l.name]),e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(y,{className:"w-6 h-6 text-green-600"}),e.jsx("span",{className:"text-green-800 font-medium",children:"第一次審査/本人確認申請中"})]}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"ドッグラン登録 - 詳細情報入力"}),e.jsx("p",{className:"text-gray-600",children:"第一次審査/本人確認申請中です。詳細な施設情報を入力してください。"})]}),e.jsx(t,{className:"mb-6 bg-green-50 border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(y,{className:"w-6 h-6 text-green-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-green-900",children:"第一次審査/本人確認申請中"}),e.jsx("p",{className:"text-sm text-green-800",children:"基本条件と本人確認を申請中です"})]})]}),e.jsx("div",{className:"text-right text-sm text-green-700",children:e.jsx("p",{children:"次のステップ: 第二審査（書類審査）"})})]})}),o&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(c,{className:"w-5 h-5 text-red-600 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-800",children:o})]})}),e.jsx(t,{className:"p-6",children:e.jsxs("form",{onSubmit:n,className:"space-y-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(T,{label:"ドッグラン名 *",value:l.name,onChange:e=>p({name:e.target.value}),placeholder:"例: 渋谷中央ドッグラン",required:!0}),h&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"名前の重複を確認中..."}),m&&e.jsxs("p",{className:"text-xs text-red-600 mt-1 flex items-start space-x-1",children:[e.jsx(c,{className:"w-3 h-3 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:m})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"説明"}),e.jsx("textarea",{value:l.description,onChange:e=>p({description:e.target.value}),placeholder:"ドッグランの特徴や魅力をご紹介ください",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3})]}),e.jsx("div",{className:"mb-4",children:e.jsx(T,{label:"住所 *",value:l.address,onChange:e=>p({address:e.target.value}),placeholder:"例: 東京都渋谷区道玄坂1-1-1",required:!0})}),e.jsxs("div",{className:"mb-4",children:[e.jsx(T,{label:"最大収容頭数 *",type:"number",min:"1",value:l.maxCapacity,onChange:e=>p({maxCapacity:e.target.value}),placeholder:"例: 15",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"同時に利用できる犬の最大頭数を入力してください"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"対応犬種 *"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:l.largeDogArea,onChange:e=>p({largeDogArea:e.target.checked}),className:"rounded text-blue-600"}),e.jsx("span",{children:"大型犬エリア"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:l.smallDogArea,onChange:e=>p({smallDogArea:e.target.checked}),className:"rounded text-blue-600"}),e.jsx("span",{children:"小型犬エリア"})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("input",{type:"checkbox",checked:l.privateBooths,onChange:e=>p({privateBooths:e.target.checked}),className:"rounded text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"貸し切りブース"})]}),l.privateBooths&&e.jsx("div",{className:"ml-6",children:e.jsx(T,{label:"貸し切りブース数",type:"number",min:"1",value:l.privateBoothCount,onChange:e=>p({privateBoothCount:e.target.value}),placeholder:"例: 2"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"設備・サービス（第一審査で選択した内容を確認・修正できます）"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries({parking:"駐車場",shower:"シャワー設備",restroom:"トイレ",agility:"アジリティ設備",rest_area:"休憩スペース",water_station:"給水設備"}).map(([s,a])=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:l.facilities[s],onChange:e=>p({facilities:{...l.facilities,[s]:e.target.checked}}),className:"rounded text-blue-600"}),e.jsx("span",{children:a})]},s))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"設備の詳細情報"}),e.jsx("textarea",{value:l.facilityDetails,onChange:e=>p({facilityDetails:e.target.value}),placeholder:"設備やサービスについての詳細な情報を入力してください",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3})]}),e.jsx(t,{className:"bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(f,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"第二審査について"}),e.jsxs("ul",{className:"space-y-1 text-xs",children:[e.jsx("li",{children:"• 詳細な施設情報と必要書類の審査を行います"}),e.jsx("li",{children:"• 審査期間は通常3-5営業日です"}),e.jsx("li",{children:"• 通過後、スマートロックシステムの実証検査の日程調整を行います"}),e.jsx("li",{children:"• 実証検査完了後、一般公開となります"})]})]})]})}),e.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[e.jsxs(E,{to:"/owner-payment-system",className:"text-blue-600 hover:text-blue-800 flex items-center",children:[e.jsx(N,{className:"w-4 h-4 mr-1"}),e.jsx("span",{className:"text-sm",children:"収益システムについて"})]}),e.jsx(a,{type:"submit",isLoading:d,disabled:d||!!m||h,className:"bg-blue-600 hover:bg-blue-700",children:"第二審査に申し込む"})]}),m&&e.jsx("div",{className:"mt-2 p-3 bg-red-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-red-800 flex items-start space-x-2",children:[e.jsx(c,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"ドッグラン名に問題があります。名前を変更してから再度お試しください。"})]})})]})})]})}function q({formData:r,onFormDataChange:l,onSubmit:i,error:n,profileData:o,profileLoading:d,onProfileUpdate:m}){const[x,p]=s.useState(!1),[g,j]=s.useState(o),[b,y]=s.useState(!1),[f,D]=s.useState(null),[S,O]=s.useState("front"),B=e=>{l(e)},A=(e,s)=>{if(e.target.files&&e.target.files[0]){const a=e.target.files[0];if(a.size>10485760)return void alert("ファイルサイズは10MB以下にしてください");D(a),O(s),y(!0)}},P=()=>"license"===r.identityDocumentType;return e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold text-center mb-8",children:"ドッグラン登録 - 第一審査・本人確認"}),e.jsx(t,{className:"mb-6 bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(v,{className:"w-6 h-6 text-blue-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"新しい審査プロセスについて"}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"第一審査・本人確認:"})," 基本的な条件の確認と本人確認書類の審査"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"第二審査:"})," 詳細な施設情報"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"スマートロックシステムの実証検査:"})," 実際の施設での動作確認"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"掲載・運営開始:"})," 一般公開と予約受付開始"]})]}),e.jsx("div",{className:"mt-3 flex items-center",children:e.jsxs(E,{to:"/owner-payment-system",className:"text-blue-600 hover:text-blue-800 flex items-center",children:[e.jsx(N,{className:"w-4 h-4 mr-1"}),e.jsx("span",{className:"text-sm font-medium",children:"料金体系と収益システムについて詳しく見る"})]})})]})]})}),e.jsx(t,{className:"mb-6 bg-yellow-50 border-yellow-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(w,{className:"w-6 h-6 text-yellow-600 mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-yellow-900 mb-2",children:"登録情報の確認"}),e.jsxs("div",{className:"text-sm text-yellow-800 mb-4",children:[e.jsx("p",{children:"本人確認書類に記載された情報と一致するかご確認ください。"}),e.jsx("p",{children:"間違いがある場合は修正してから本人確認書類をアップロードしてください。"})]}),d?e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-yellow-600"}),e.jsx("span",{className:"ml-2 text-yellow-800",children:"プロフィール情報を読み込み中..."})]}):e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-yellow-200",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"氏名"}),e.jsx("p",{className:"font-medium text-gray-900",children:o.name||"未設定"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"郵便番号"}),e.jsx("p",{className:"font-medium text-gray-900",children:o.postal_code||"未設定"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"住所"}),e.jsx("p",{className:"font-medium text-gray-900",children:o.address||"未設定"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"電話番号"}),e.jsx("p",{className:"font-medium text-gray-900",children:o.phone_number||"未設定"})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsxs(a,{variant:"secondary",onClick:()=>{j(o),p(!0)},className:"flex items-center",children:[e.jsx(k,{className:"w-4 h-4 mr-1"}),"情報を修正"]})})]})]})]})}),e.jsx(t,{className:"mb-6 bg-green-50 border-green-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(u,{className:"w-6 h-6 text-green-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-green-900 mb-2",children:"本人確認書類について"}),e.jsxs("div",{className:"text-sm text-green-800 space-y-1",children:[e.jsx("p",{children:"安全なプラットフォーム運営のため、ドッグランオーナーには本人確認が必要です。"}),e.jsxs("p",{children:[e.jsx("strong",{children:"個人の場合："}),"運転免許証（表面・裏面）、マイナンバーカード、パスポートのいずれか"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"法人の場合："}),"登記簿謄本（過去6か月以内に取得したもの）"]}),e.jsx("p",{children:"住所と氏名が登録情報と一致することを確認させていただきます。"})]})]})]})}),e.jsx(t,{className:"mb-6 bg-orange-50 border-orange-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(C,{className:"w-6 h-6 text-orange-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-orange-900 mb-2",children:"重要な注意事項"}),e.jsxs("div",{className:"text-sm text-orange-800 space-y-1",children:[e.jsx("p",{children:e.jsx("strong",{children:"本人確認書類の住所・氏名と上記の登録情報が一致している必要があります。"})}),e.jsx("p",{children:"一致しない場合は審査が通らない場合があります。"}),e.jsx("p",{children:"引っ越しなどで住所が変わった場合は、必ず上記の「情報を修正」から最新の情報に更新してください。"})]})]})]})}),x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"登録情報の修正"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(T,{label:"氏名",value:g.name,onChange:e=>j({...g,name:e.target.value}),placeholder:"山田太郎"}),e.jsx(T,{label:"郵便番号",value:g.postal_code,onChange:e=>j({...g,postal_code:e.target.value}),placeholder:"123-4567"}),e.jsx(T,{label:"住所",value:g.address,onChange:e=>j({...g,address:e.target.value}),placeholder:"東京都新宿区西新宿1-1-1"}),e.jsx(T,{label:"電話番号",value:g.phone_number,onChange:e=>j({...g,phone_number:e.target.value}),placeholder:"090-1234-5678"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx(a,{variant:"secondary",onClick:()=>p(!1),children:"キャンセル"}),e.jsx(a,{onClick:()=>{m(g),p(!1)},disabled:d,children:"保存"})]})]})}),n&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(c,{className:"w-5 h-5 text-red-600 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-800",children:n})]})}),e.jsx(t,{className:"p-6",children:e.jsxs("form",{onSubmit:i,className:"space-y-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"現在ドッグランを運営していますか？ *"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"isCurrentlyOperating",value:"yes",checked:"yes"===r.isCurrentlyOperating,onChange:e=>B({isCurrentlyOperating:e.target.value}),className:"text-blue-600"}),e.jsx("span",{children:"はい（すでに運営中）"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"isCurrentlyOperating",value:"no",checked:"no"===r.isCurrentlyOperating,onChange:e=>B({isCurrentlyOperating:e.target.value}),className:"text-blue-600"}),e.jsx("span",{children:"いいえ（新規開設予定）"})]})]}),"no"===r.isCurrentlyOperating&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mt-4 pl-4 border-l-4 border-blue-200",children:[e.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"予定地はあなたの所有地ですか？ *"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"isOwnedLand",value:"yes",checked:"yes"===r.isOwnedLand,onChange:e=>B({isOwnedLand:e.target.value}),className:"text-blue-600"}),e.jsx("span",{children:"はい（所有地）"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"isOwnedLand",value:"no",checked:"no"===r.isOwnedLand,onChange:e=>B({isOwnedLand:e.target.value}),className:"text-blue-600"}),e.jsx("span",{children:"いいえ（借用地）"})]})]}),"no"===r.isOwnedLand&&e.jsxs("div",{className:"mt-4 pl-4 border-l-4 border-yellow-200",children:[e.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"土地所有者の許可は得ていますか？ *"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"hasOwnerPermission",value:"yes",checked:"yes"===r.hasOwnerPermission,onChange:e=>B({hasOwnerPermission:e.target.value}),className:"text-blue-600"}),e.jsx("span",{children:"はい"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"hasOwnerPermission",value:"no",checked:"no"===r.hasOwnerPermission,onChange:e=>B({hasOwnerPermission:e.target.value}),className:"text-blue-600"}),e.jsx("span",{children:"いいえ"})]})]})]}),e.jsxs("div",{className:"mt-4 pl-4 border-l-4 border-green-200",children:[e.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"近隣住民の理解は得ていますか？ *"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"hasNeighborConsent",value:"yes",checked:"yes"===r.hasNeighborConsent,onChange:e=>B({hasNeighborConsent:e.target.value}),className:"text-blue-600"}),e.jsx("span",{children:"はい"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"hasNeighborConsent",value:"no",checked:"no"===r.hasNeighborConsent,onChange:e=>B({hasNeighborConsent:e.target.value}),className:"text-blue-600"}),e.jsx("span",{children:"いいえ"})]})]})]})]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx(T,{label:e.jsx("span",{className:"text-lg font-bold text-gray-800",children:"広さ（㎡） *"}),type:"number",min:"1",value:r.landArea,onChange:e=>B({landArea:e.target.value}),placeholder:"例: 500",required:!0}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"ドッグランの運営には最低100㎡以上の広さが必要です"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"施設までは週に1度程度、状況の確認やメンテナンスに行くことができますか？ *"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"canVisitWeekly",value:"yes",checked:"yes"===r.canVisitWeekly,onChange:e=>B({canVisitWeekly:e.target.value}),className:"text-blue-600"}),e.jsx("span",{children:"はい"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"canVisitWeekly",value:"no",checked:"no"===r.canVisitWeekly,onChange:e=>B({canVisitWeekly:e.target.value}),className:"text-blue-600"}),e.jsx("span",{children:"いいえ"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"緊急時（怪我や事故など）に1時間以内に施設に到着できますか？ *"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"canReachQuickly",value:"yes",checked:"yes"===r.canReachQuickly,onChange:e=>B({canReachQuickly:e.target.value}),className:"text-blue-600"}),e.jsx("span",{children:"はい"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"canReachQuickly",value:"no",checked:"no"===r.canReachQuickly,onChange:e=>B({canReachQuickly:e.target.value}),className:"text-blue-600"}),e.jsx("span",{children:"いいえ"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"反社会的勢力との関係はありますか？ *"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"isAntiSocialForces",value:"no",checked:"no"===r.isAntiSocialForces,onChange:e=>B({isAntiSocialForces:e.target.value}),className:"text-blue-600"}),e.jsx("span",{children:"いいえ（関係なし）"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"isAntiSocialForces",value:"yes",checked:"yes"===r.isAntiSocialForces,onChange:e=>B({isAntiSocialForces:e.target.value}),className:"text-blue-600"}),e.jsx("span",{children:"はい（関係あり）"})]})]}),"yes"===r.isAntiSocialForces&&e.jsx("div",{className:"mt-2 p-3 bg-red-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(h,{className:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-red-800",children:"反社会的勢力との関係がある場合、ドッグランの登録はできません。当社は反社会的勢力との関係を一切認めておりません。"})]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"本人確認書類のアップロード *"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"申請者の種類 *"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"applicantType",value:"individual",checked:"individual"===r.applicantType,onChange:e=>B({applicantType:e.target.value,identityDocumentType:"",identityDocumentFront:null,identityDocumentBack:null}),className:"mr-2",required:!0}),e.jsx("span",{children:"個人"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"applicantType",value:"corporate",checked:"corporate"===r.applicantType,onChange:e=>B({applicantType:e.target.value,identityDocumentType:"",identityDocumentFront:null,identityDocumentBack:null}),className:"mr-2",required:!0}),e.jsx("span",{children:"法人"})]})]})]}),r.applicantType&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["individual"===r.applicantType?"提出する書類の種類":"提出書類"," *"]}),e.jsx("div",{className:"space-y-2",children:"individual"===r.applicantType?e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"identityDocumentType",value:"license",checked:"license"===r.identityDocumentType,onChange:e=>B({identityDocumentType:e.target.value,identityDocumentFront:null,identityDocumentBack:null}),className:"mr-2",required:!0}),e.jsx("span",{children:"運転免許証（表面・裏面の2枚）"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"identityDocumentType",value:"mynumber",checked:"mynumber"===r.identityDocumentType,onChange:e=>B({identityDocumentType:e.target.value,identityDocumentFront:null,identityDocumentBack:null}),className:"mr-2",required:!0}),e.jsx("span",{children:"マイナンバーカード"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"identityDocumentType",value:"passport",checked:"passport"===r.identityDocumentType,onChange:e=>B({identityDocumentType:e.target.value,identityDocumentFront:null,identityDocumentBack:null}),className:"mr-2",required:!0}),e.jsx("span",{children:"パスポート"})]})]}):e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"identityDocumentType",value:"registration",checked:"registration"===r.identityDocumentType,onChange:e=>B({identityDocumentType:e.target.value,identityDocumentFront:null,identityDocumentBack:null}),className:"mr-2",required:!0}),e.jsx("span",{children:"登記簿謄本（過去6か月以内のもの）"})]})})]}),r.identityDocumentType&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx(_,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("input",{type:"file",accept:"image/jpeg,image/png,image/jpg",onChange:e=>A(e,"front"),className:"hidden",id:"identity-upload-front",required:!0}),e.jsx("label",{htmlFor:"identity-upload-front",className:"cursor-pointer text-blue-600 hover:text-blue-800 font-medium",children:"ファイルを選択"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2 font-medium",children:["license"===r.identityDocumentType&&"運転免許証の表面","mynumber"===r.identityDocumentType&&"マイナンバーカード","passport"===r.identityDocumentType&&"パスポート","registration"===r.identityDocumentType&&"登記簿謄本"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"JPG・PNG形式のみ、最大ファイルサイズ: 10MB"}),r.identityDocumentFront&&e.jsxs("p",{className:"text-sm text-green-600 mt-2",children:["選択されたファイル: ",r.identityDocumentFront.name]})]}),P()&&e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx(_,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("input",{type:"file",accept:"image/jpeg,image/png,image/jpg",onChange:e=>A(e,"back"),className:"hidden",id:"identity-upload-back",required:!0}),e.jsx("label",{htmlFor:"identity-upload-back",className:"cursor-pointer text-blue-600 hover:text-blue-800 font-medium",children:"ファイルを選択"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2 font-medium",children:"運転免許証の裏面"}),e.jsx("p",{className:"text-sm text-gray-500",children:"JPG・PNG形式のみ、最大ファイルサイズ: 10MB"}),r.identityDocumentBack&&e.jsxs("p",{className:"text-sm text-green-600 mt-2",children:["選択されたファイル: ",r.identityDocumentBack.name]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(C,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-2",children:"アップロードする書類について"}),e.jsxs("ul",{className:"space-y-1 text-sm",children:[e.jsx("li",{children:"• 文字がはっきりと読める鮮明な画像をアップロードしてください"}),e.jsx("li",{children:"• 書類全体が画像に収まっていることを確認してください"}),e.jsx("li",{children:"• 画像は正面から撮影し、傾きがないようにしてください"}),"registration"===r.identityDocumentType&&e.jsx("li",{children:"• 登記簿謄本は取得から6か月以内のものが必要です"}),e.jsx("li",{children:"• 本人確認書類の住所・氏名が上記登録情報と一致している必要があります"})]})]})]})})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"予定設備 *"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Object.entries({parking:"駐車場",shower:"シャワー設備",restroom:"トイレ",agility:"アジリティ設備",rest_area:"休憩スペース",water_station:"給水設備"}).map(([s,a])=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:r.facilities[s],onChange:e=>B({facilities:{...r.facilities,[s]:e.target.checked}}),className:"rounded text-blue-600"}),e.jsx("span",{className:"text-sm",children:a})]},s))})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"スマートロックシステムの購入について *"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"当アプリ内ショップにてスマートロックシステムを購入し、設置いただく必要があります。"}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:!0===r.agreeSmartLockPurchase,onChange:e=>B({...r,agreeSmartLockPurchase:e.target.checked}),className:"rounded text-blue-600",required:!0}),e.jsx("span",{children:"はい（理解しました）"})]})]}),e.jsx(t,{className:"bg-yellow-50 border-yellow-200",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(c,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"第一審査・本人確認について"}),e.jsxs("ul",{className:"space-y-1 text-xs",children:[e.jsx("li",{children:"• 基本的な開設条件を満たしているかを確認します"}),e.jsx("li",{children:"• 本人確認書類の住所・氏名が登録情報と一致することを確認します"}),e.jsx("li",{children:"• 通過後、詳細な施設情報の入力に進みます"}),e.jsx("li",{children:"• 第二審査では書類審査を行います"}),e.jsx("li",{children:"• 最終的にスマートロックシステムの実証検査を経て掲載開始となります"})]})]})]})}),e.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[e.jsxs(E,{to:"/owner-payment-system",className:"text-blue-600 hover:text-blue-800 flex items-center",children:[e.jsx(N,{className:"w-4 h-4 mr-1"}),e.jsx("span",{className:"text-sm",children:"収益システムについて"})]}),e.jsxs(a,{type:"submit",className:"w-1/2 bg-blue-600 hover:bg-blue-700",disabled:!!(!r.identityDocumentFront||P()&&!r.identityDocumentBack)||d,children:[e.jsx(u,{className:"w-4 h-4 mr-2"}),"第一審査・本人確認を申し込む"]})]})]})}),b&&f&&e.jsx(F,{imageFile:f,onCropComplete:e=>{l("front"===S?{identityDocumentFront:e}:{identityDocumentBack:e}),y(!1),D(null)},onCancel:()=>{y(!1),D(null)},aspectRatio:85.6/54,maxWidth:600,maxHeight:400})]})}function M({rejectedParks:l,onUpdateRejectedParks:i,onResubmit:n,onError:o}){const[d,m]=s.useState(!1),[x,h]=s.useState(null);return 0===l.length?null:e.jsxs(e.Fragment,{children:[e.jsx(t,{className:"mb-6 bg-red-50 border-red-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(c,{className:"w-6 h-6 text-red-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-red-900 mb-2",children:"却下された申請"}),e.jsx("p",{className:"text-sm text-red-800 mb-4",children:"以下の申請は審査の結果、却下されました。申請内容を見直して再提出するか、削除することができます。"}),e.jsx("div",{className:"space-y-4",children:l.map(s=>e.jsx("div",{className:"bg-white p-4 rounded-lg border border-red-200",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.address}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["申請日: ",new Date(s.created_at).toLocaleDateString("ja-JP")]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(a,{size:"sm",variant:"secondary",onClick:()=>n(s),children:[e.jsx(g,{className:"w-4 h-4 mr-1"}),"再申請"]}),e.jsxs(a,{size:"sm",variant:"secondary",className:"text-red-600 hover:text-red-700",onClick:()=>h(s.id),children:[e.jsx(D,{className:"w-4 h-4 mr-1"}),"削除"]})]})]})},s.id))})]})]})}),x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"申請を削除しますか？"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"この操作は取り消せません。申請を削除してもよろしいですか？"}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(a,{variant:"secondary",onClick:()=>h(null),children:"キャンセル"}),e.jsxs(a,{className:"bg-red-600 hover:bg-red-700",isLoading:d,onClick:()=>(async e=>{try{m(!0);const{error:s}=await r.from("dog_parks").delete().eq("id",e);if(s)throw s;const a=l.filter(s=>s.id!==e);i(a),h(null)}catch(s){o(s.message||"ドッグランの削除に失敗しました")}finally{m(!1)}})(x),children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"削除する"]})]})]})})]})}function z(){const a=S(),{user:t}=i(),[n,c]=s.useState(!1),[o,d]=s.useState(1),[m,x]=s.useState([]),[h,u]=s.useState(null),[p,g]=s.useState({name:"",postal_code:"",address:"",phone_number:"",email:""}),[j,b]=s.useState(!1),[y,f]=s.useState(!1),{error:N,clearError:v,handleError:w,executeWithErrorHandling:k}=function(){const[e,a]=s.useState(null),[t,r]=s.useState(!1),[i,n]=s.useState(null),c=s.useCallback(()=>{a(null),n(null)},[]),o=s.useCallback(e=>{if(e instanceof Error){const s=e.message.toLowerCase();if(s.includes("network")||s.includes("fetch")||s.includes("connection"))return{type:"network",severity:"medium",message:e.message,originalError:e,userMessage:"ネットワーク接続に問題があります。インターネット接続を確認してください。",recoverable:!0,retryable:!0};if(s.includes("timeout")||s.includes("timed out")||"AbortError"===e.name)return{type:"timeout",severity:"medium",message:e.message,originalError:e,userMessage:"リクエストがタイムアウトしました。もう一度お試しください。",recoverable:!0,retryable:!0};if(s.includes("jwt")||s.includes("unauthorized")||s.includes("refresh_token"))return{type:"authentication",severity:"high",message:e.message,originalError:e,userMessage:"セッションが期限切れです。再度ログインしてください。",recoverable:!0,retryable:!1};if(s.includes("forbidden")||s.includes("permission")||s.includes("row-level security"))return{type:"authorization",severity:"high",message:e.message,originalError:e,userMessage:"この操作を実行する権限がありません。",recoverable:!1,retryable:!1};if(s.includes("validation")||s.includes("invalid")||s.includes("required"))return{type:"validation",severity:"low",message:e.message,originalError:e,userMessage:"入力内容に問題があります。確認してください。",recoverable:!0,retryable:!1};if(s.includes("storage")||s.includes("bucket")||s.includes("file"))return{type:"storage",severity:"medium",message:e.message,originalError:e,userMessage:"ファイルの処理中にエラーが発生しました。しばらく待ってから再度お試しください。",recoverable:!0,retryable:!0};if(s.includes("payment")||s.includes("stripe")||s.includes("subscription"))return{type:"payment",severity:"high",message:e.message,originalError:e,userMessage:"決済処理中にエラーが発生しました。カード情報を確認してください。",recoverable:!0,retryable:!0};if(s.includes("500")||s.includes("502")||s.includes("503")||s.includes("520"))return{type:"server",severity:"high",message:e.message,originalError:e,userMessage:"サーバーで一時的な問題が発生しています。しばらく待ってから再度お試しください。",recoverable:!0,retryable:!0};if(s.includes("404")||s.includes("not found"))return{type:"not_found",severity:"medium",message:e.message,originalError:e,userMessage:"要求されたリソースが見つかりません。",recoverable:!1,retryable:!1}}if("object"==typeof e&&null!==e&&"code"in e){const s=l(e);return{type:"server",severity:"medium",message:s,originalError:e,userMessage:s,recoverable:!0,retryable:!0}}return{type:"unknown",severity:"medium",message:e instanceof Error?e.message:String(e),originalError:e,userMessage:"予期しないエラーが発生しました。しばらく待ってから再度お試しください。",recoverable:!0,retryable:!0}},[]),d=s.useCallback(e=>{e.severity},[]),m=s.useCallback((e,s)=>{const t={...o(e),timestamp:new Date,...s&&{context:s}};d(t),a(t)},[o,d]),x=s.useCallback(async(e,s)=>{r(!0),c();try{const s=await e();return r(!1),s}catch(a){return m(a,s),r(!1),o(a).retryable&&n(()=>async()=>{await x(e,s)}),null}},[m,c,o]);return{error:e,isLoading:t,clearError:c,handleError:m,retryAction:i,executeWithErrorHandling:x}}(),C=O(B.api),[_,D]=s.useState({isCurrentlyOperating:"",isOwnedLand:"",hasOwnerPermission:"",hasNeighborConsent:"",landArea:"",isAntiSocialForces:"",canVisitWeekly:"",canReachQuickly:"",applicantType:"",identityDocumentType:"",identityDocumentFront:null,identityDocumentBack:null,name:"",description:"",address:"",maxCapacity:"10",largeDogArea:!0,smallDogArea:!0,privateBooths:!1,privateBoothCount:"0",facilities:{parking:!1,shower:!1,restroom:!1,agility:!1,rest_area:!1,water_station:!1},facilityDetails:""});s.useEffect(()=>{t?(E(),T(),F()):a("/login")},[t,a]);const E=async()=>{await k(async()=>{const{data:e,error:s}=await r.from("dog_parks").select("*").eq("owner_id",t?.id).eq("status","rejected");if(s)throw s;x(e||[])},{operation:"fetch_rejected_parks"})},T=async()=>{await k(async()=>{const{data:e,error:s}=await r.from("owner_verifications").select("status").eq("user_id",t?.id).single();if(s&&"PGRST116"!==s.code)throw s;u(e?.status||null)},{operation:"check_identity_verification"})},F=async()=>{await k(async()=>{b(!0);const{data:e,error:s}=await r.from("profiles").select("name, postal_code, address, phone_number, email").eq("id",t?.id).single();if(s)throw s;g(e||{name:"",postal_code:"",address:"",phone_number:"",email:""})},{operation:"fetch_profile_data"}),b(!1)},R=async e=>{await k(async()=>{b(!0);const{error:s}=await r.from("profiles").update(e).eq("id",t?.id);if(s)throw s;g(e),f(!1)},{operation:"update_profile_data"}),b(!1)},z=e=>{D(s=>({...s,...e}))},W=e=>{x(e)},I=e=>{D(s=>({...s,name:e.name,description:e.description||"",address:e.address,maxCapacity:e.max_capacity?.toString()||"10",largeDogArea:e.large_dog_area||!0,smallDogArea:e.small_dog_area||!0,privateBooths:e.private_booths||!1,privateBoothCount:e.private_booth_count?.toString()||"0",facilities:e.facilities||{parking:!1,shower:!1,restroom:!1,agility:!1,rest_area:!1,water_station:!1},facilityDetails:e.facility_details||""})),d(2)},Q=async e=>{e.preventDefault(),await k(async()=>{if((e=>{if(!e.isCurrentlyOperating||""===e.isCurrentlyOperating)throw new Error("現在のドッグラン運営状況について選択してください。");if("no"===e.isCurrentlyOperating){if(!e.isOwnedLand||""===e.isOwnedLand)throw new Error("土地の所有状況について選択してください。");if("no"===e.isOwnedLand&&(!e.hasOwnerPermission||""===e.hasOwnerPermission))throw new Error("土地所有者の許可について選択してください。");if(!e.hasNeighborConsent||""===e.hasNeighborConsent)throw new Error("近隣住民の理解について選択してください。")}if(!e.landArea||parseInt(e.landArea)<=0)throw new Error("広さを正しく入力してください。");if(!e.isAntiSocialForces||""===e.isAntiSocialForces)throw new Error("反社会勢力との関係について選択してください。");if("yes"===e.isAntiSocialForces)throw new Error("反社会勢力との関係がある場合、ドッグランの登録はできません。");if(!e.canVisitWeekly||""===e.canVisitWeekly)throw new Error("週1回の訪問可否について選択してください。");if(!e.canReachQuickly||""===e.canReachQuickly)throw new Error("緊急時の到着可否について選択してください。");if(!e.identityDocumentFront)throw new Error("本人確認書類をアップロードしてください。");if("no"===e.isCurrentlyOperating){if("no"===e.isOwnedLand&&"no"===e.hasOwnerPermission)throw new Error("土地所有者の許可を得てからお申し込みください。借用地でのドッグラン運営には所有者の同意が必要です。");if("no"===e.hasNeighborConsent)throw new Error("近隣住民の理解を得てからお申し込みください。地域との良好な関係は運営において重要です。")}if(parseInt(e.landArea)<100)throw new Error("ドッグランの運営には最低100㎡以上の広さが必要です。");if("no"===e.canVisitWeekly)throw new Error("週に1度程度の訪問が必要です。施設の状況確認やメンテナンスのため、定期的な訪問ができる方のみお申し込みください。");if("no"===e.canReachQuickly)throw new Error("緊急時に1時間以内に施設に到着できることが必要です。迅速な対応ができる方のみお申し込みください。")})(_),!t)throw new Error("ユーザー情報が取得できません。再度ログインしてください。");c(!0);try{if(_.identityDocumentFront){const e=[],s=`identity_front_${t.id}_${Date.now()}_${_.identityDocumentFront.name}`,a=r.storage.from("vaccine-certs").upload(s,_.identityDocumentFront,{upsert:!0});e.push(a);let l=null;if("license"===_.identityDocumentType&&_.identityDocumentBack){const s=`identity_back_${t.id}_${Date.now()}_${_.identityDocumentBack.name}`;l=r.storage.from("vaccine-certs").upload(s,_.identityDocumentBack,{upsert:!0}),e.push(l)}const i=await Promise.all(e),[n,c]=i;if(!n||n.error)throw new Error(`表面のアップロードに失敗しました: ${n?.error?.message||"アップロードエラー"}`);if(c&&c.error)throw new Error(`裏面のアップロードに失敗しました: ${c.error.message}`);const o={document_url_front:n.data.path,file_name_front:_.identityDocumentFront.name,file_size_front:_.identityDocumentFront.size,file_type_front:_.identityDocumentFront.type,document_type:_.identityDocumentType,uploaded_at:(new Date).toISOString(),application_stage:"first_stage"};c?.data&&_.identityDocumentBack&&Object.assign(o,{document_url_back:c.data.path,file_name_back:_.identityDocumentBack.name,file_size_back:_.identityDocumentBack.size,file_type_back:_.identityDocumentBack.type});const d={user_id:t.id,verification_id:n.data.path,status:"pending",verification_data:o},{error:m}=await r.from("owner_verifications").upsert(d,{onConflict:"user_id"});if(m)throw new Error(`データベース保存に失敗しました: ${m.message}`)}d(2),window.scrollTo({top:0,behavior:"smooth"})}catch(e){const s=e instanceof Error?e.message:"申込みに失敗しました。";throw new Error(s)}finally{c(!1)}})};return 1===o?e.jsxs("div",{children:[e.jsx($,{error:N,onClear:v,className:"mb-6"}),e.jsx(M,{rejectedParks:m,onUpdateRejectedParks:W,onResubmit:I,onError:w}),e.jsx(q,{formData:_,onFormDataChange:z,onSubmit:Q,error:N?.userMessage||"",profileData:p,profileLoading:j,onProfileUpdate:R})]}):e.jsxs("div",{children:[e.jsx($,{error:N,onClear:v,...C.state.isRetrying?{}:{onRetry:()=>C.execute(()=>Promise.resolve())},className:"mb-6"}),C.state.isRetrying&&e.jsx("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-800 font-medium",children:"自動リトライ中..."}),e.jsxs("p",{className:"text-blue-600 text-sm",children:["試行回数: ",C.state.attempts+1,"/",B.api.maxAttempts,C.state.nextRetryIn>0&&` | 次の試行まで: ${C.state.nextRetryIn}秒`]})]}),e.jsx("button",{onClick:C.cancelRetry,className:"text-blue-600 hover:text-blue-800 text-sm underline",children:"キャンセル"})]})}),2===o&&e.jsx(L,{formData:_,onFormDataChange:z,onSubmit:async e=>{e.preventDefault(),c(!0),v();try{await k(async()=>{const{data:{user:e},error:s}=await r.auth.getUser();if(s||!e)throw new Error("ユーザー認証に失敗しました。再度ログインしてください。");const t=A(_.address),l=await P(t);let i=null,n=null;l&&(i=l.latitude,n=l.longitude);const{error:c}=await r.from("profiles").update({user_type:"owner"}).eq("id",e.id);if(c)throw new Error("プロフィールの更新に失敗しました。");const o={owner_id:e.id,name:_.name,description:_.description,address:_.address,latitude:i,longitude:n,price:800,max_capacity:parseInt(_.maxCapacity,10),large_dog_area:_.largeDogArea,small_dog_area:_.smallDogArea,private_booths:_.privateBooths,private_booth_count:parseInt(_.privateBoothCount,10),private_booth_price:0,facilities:_.facilities,facility_details:_.facilityDetails,status:"pending"},{error:d}=await r.from("dog_parks").insert([o]);if(d)throw d;setTimeout(()=>{a("/dashboard")},100)})}catch(s){w(s instanceof Error?s:new Error("不明なエラーが発生しました。"))}finally{c(!1)}},error:N?.userMessage||"",isLoading:n})]})}export{z as default};

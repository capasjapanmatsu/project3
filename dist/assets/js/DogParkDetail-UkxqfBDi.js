import{j as e}from"./motion-CuO0nkIV.js";import{r as s}from"./react-vendor-cniURDpR.js";import{d as a,a as t,L as r}from"./router-Cg6wfOY4.js";import{B as l}from"./Button-CJFAG6V0.js";import{C as i,u as c,s as n}from"./index-CVZFmpsT.js";import{D as d}from"./DoorLockButton-BMQ6kDRD.js";import{P as o}from"./placeholders-CbXPOCvW.js";import{i as m,y as x,ac as h,n as g,ad as p,o as u,a1 as j,ae as b,P as N,af as f,R as v,M as y,U as w,a6 as _,e as k,t as S,a4 as D,K as C,q as $,X as I,ag as P,ah as q}from"./ui-basic-CaMd9YQ-.js";import{I as L}from"./Input-D3zjVn42.js";import{S as R}from"./Select-Dd_IZFKg.js";import"./supabase-B0bqaRGb.js";import"./heavy-features-BIdEME4r.js";function J({park:s,parkImages:a,todayRentals:t,onImageClick:r}){const l=function(e,s){const a=e/s*100;return a<25?{text:"ç©ºã„ã¦ã„ã¾ã™",color:"text-green-600 bg-green-100"}:a<50?{text:"ã‚„ã‚„ç©ºã„ã¦ã„ã¾ã™",color:"text-blue-600 bg-blue-100"}:a<75?{text:"ã‚„ã‚„æ··ã‚“ã§ã„ã¾ã™",color:"text-yellow-600 bg-yellow-100"}:{text:"æ··ã‚“ã§ã„ã¾ã™",color:"text-red-600 bg-red-100"}}(s.current_occupancy,s.max_capacity);return e.jsx(e.Fragment,{children:a.length>0&&e.jsxs("div",{className:"relative h-64 rounded-lg overflow-hidden",children:[e.jsx("img",{src:a[0].url||o,alt:s.name,className:"w-full h-full object-cover cursor-pointer",onClick:()=>r(0),onError:e=>{e.currentTarget.src=o}}),e.jsx("div",{className:"absolute top-4 right-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${l.color}`,children:l.text})}),t.length>0&&e.jsx("div",{className:"absolute top-4 left-4",children:e.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-orange-500 text-white",children:"æœ¬æ—¥è²¸ã—åˆ‡ã‚Šã‚ã‚Š"})})]})})}function F({park:s}){return e.jsxs(i,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"è¨­å‚™ãƒ»ã‚µãƒ¼ãƒ“ã‚¹"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:Object.entries({parking:"é§è»Šå ´",shower:"ã‚·ãƒ£ãƒ¯ãƒ¼è¨­å‚™",restroom:"ãƒˆã‚¤ãƒ¬",agility:"ã‚¢ã‚¸ãƒªãƒ†ã‚£è¨­å‚™",rest_area:"ä¼‘æ†©ã‚¹ãƒšãƒ¼ã‚¹",water_station:"çµ¦æ°´è¨­å‚™"}).map(([a,t])=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 rounded "+(s.facilities[a]?"bg-green-500":"bg-gray-300")}),e.jsx("span",{className:"text-sm",children:t})]},a))}),s.facility_details&&e.jsx("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-700",children:s.facility_details})})]})}function T({parkImages:s,onImageClick:a}){return s.length<=1?null:e.jsxs("div",{className:"grid grid-cols-5 gap-2",children:[s.slice(1,6).map((s,t)=>e.jsx("div",{className:"h-20 rounded-lg overflow-hidden cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>a(t+1),children:e.jsx("img",{src:s.url||o,alt:s.caption||`ç”»åƒ ${t+2}`,className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src=o}})},s.id)),s.length>6&&e.jsxs("div",{className:"h-20 rounded-lg overflow-hidden cursor-pointer relative bg-gray-200 flex items-center justify-center",onClick:()=>a(6),children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:e.jsxs("span",{className:"text-white font-medium",children:["+",s.length-6]})}),e.jsx("img",{src:s[6].url||o,alt:"ãã®ä»–ã®ç”»åƒ",className:"w-full h-full object-cover opacity-60",onError:e=>{e.currentTarget.src=o}})]})]})}function E({rentalInfo:s}){return e.jsx(i,{className:"p-6 bg-orange-50 border-orange-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(m,{className:"w-6 h-6 text-orange-600 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-orange-900 mb-3",children:"æ–½è¨­è²¸ã—åˆ‡ã‚Šäºˆç´„ã‚ã‚Š"}),e.jsx("p",{className:"text-sm text-orange-800 mb-4",children:"ä»¥ä¸‹ã®æ—¥æ™‚ã¯æ–½è¨­è²¸ã—åˆ‡ã‚Šã®ãŸã‚ã€é€šå¸¸åˆ©ç”¨ï¼ˆ1Dayãƒ‘ã‚¹ãƒ»ã‚µãƒ–ã‚¹ã‚¯ï¼‰ã§ã®å…¥å ´ã¯ã§ãã¾ã›ã‚“ã€‚"}),e.jsx("div",{className:"space-y-4",children:s.map((s,a)=>e.jsxs("div",{className:"bg-white p-3 rounded-lg border border-orange-200",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(x,{className:"w-5 h-5 text-orange-600"}),e.jsx("span",{className:"font-medium text-orange-900",children:new Date(s.date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric",weekday:"long"})})]}),e.jsx("div",{className:"space-y-1",children:s.slots.map((s,a)=>e.jsxs("div",{className:"flex items-center text-sm text-orange-800",children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),e.jsxs("span",{children:[s.start," ã€œ ",s.end]})]},a))})]},a))})]})]})})}function O({park:s,reviews:a,userReview:t,canReview:r,user:c,userDogs:n,showReviewForm:d,setShowReviewForm:o,reviewFormData:m,setReviewFormData:x,isSubmitting:h,handleReviewSubmit:f,handleDeleteReview:v}){return e.jsxs(i,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[e.jsx(g,{className:"w-6 h-6 mr-2"}),"ãƒ¬ãƒ“ãƒ¥ãƒ¼ (",s.review_count,")"]}),c&&r&&e.jsx(l,{onClick:()=>o(!d),variant:t?"secondary":"primary",size:"sm",children:t?e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ç·¨é›†"]}):e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"w-4 h-4 mr-2"}),"ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ›¸ã"]})})]}),d&&e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-4",children:t?"ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ç·¨é›†":"ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æŠ•ç¨¿"}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"è©•ä¾¡ *"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[[1,2,3,4,5].map(s=>e.jsx("button",{type:"button",onClick:()=>x({...m,rating:s}),className:"focus:outline-none",children:e.jsx(j,{className:`w-8 h-8 ${s<=m.rating?"text-yellow-400 fill-current":"text-gray-300 hover:text-yellow-300"} transition-colors`})},s)),e.jsxs("span",{className:"ml-2 text-sm text-gray-600",children:[m.rating,"ã¤æ˜Ÿ"]})]})]}),e.jsx(R,{label:"ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹ãƒ¯ãƒ³ã¡ã‚ƒã‚“ *",options:n.map(e=>({value:e.id,label:e.name})),value:m.dog_id,onChange:e=>x({...m,dog_id:e.target.value}),required:!0}),e.jsx(L,{label:"è¨ªå•æ—¥ *",type:"date",value:m.visit_date,onChange:e=>x({...m,visit_date:e.target.value}),max:(new Date).toISOString().split("T")[0],required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ãƒ¬ãƒ“ãƒ¥ãƒ¼å†…å®¹"}),e.jsx("textarea",{value:m.review_text,onChange:e=>x({...m,review_text:e.target.value}),placeholder:"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã®æ„Ÿæƒ³ã‚’ãŠèžã‹ã›ãã ã•ã„...",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(l,{type:"button",variant:"secondary",onClick:()=>o(!1),children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),t&&e.jsxs(l,{type:"button",onClick:v,className:"bg-red-600 hover:bg-red-700",children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"å‰Šé™¤"]})]}),e.jsx(l,{type:"submit",isLoading:h,disabled:!m.dog_id||!m.visit_date,children:t?"æ›´æ–°ã™ã‚‹":"æŠ•ç¨¿ã™ã‚‹"})]})]})]}),0===a.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(g,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"ã¾ã ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒã‚ã‚Šã¾ã›ã‚“"}),c&&r&&e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"æœ€åˆã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æŠ•ç¨¿ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ"})]}):e.jsx("div",{className:"space-y-6",children:a.map(s=>e.jsx("div",{className:"border-b border-gray-200 pb-6 last:border-b-0",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center overflow-hidden",children:s.dog_image_url?e.jsx("img",{src:s.dog_image_url,alt:s.dog_name,className:"w-full h-full object-cover"}):e.jsx(N,{className:"w-6 h-6 text-gray-500"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.user_name}),e.jsx("span",{className:"text-sm text-gray-500",children:"ã¨"}),e.jsxs("span",{className:"font-medium text-blue-600",children:[s.dog_name,"ã¡ã‚ƒã‚“"]}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",s.dog_breed,")"]})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("div",{className:"flex items-center space-x-1",children:[1,2,3,4,5].map(a=>e.jsx(j,{className:"w-4 h-4 "+(a<=s.rating?"text-yellow-400 fill-current":"text-gray-300")},a))}),e.jsxs("span",{className:"text-sm text-gray-600",children:[new Date(s.visit_date).toLocaleDateString("ja-JP")," ã«è¨ªå•"]})]})]}),e.jsx("span",{className:"text-xs text-gray-400",children:new Date(s.created_at).toLocaleDateString("ja-JP")})]}),s.review_text&&e.jsx("p",{className:"text-gray-700 leading-relaxed mb-3",children:s.review_text}),s.review_images&&s.review_images.length>0&&e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:s.review_images.map((s,a)=>e.jsxs("div",{className:"relative group cursor-pointer",children:[e.jsx("img",{src:s.url,alt:s.caption||`ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒ ${a+1}`,className:"w-full h-24 object-cover rounded-lg border border-gray-200 hover:opacity-90 transition-opacity",onClick:()=>window.open(s.url,"_blank")}),s.caption&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white text-xs p-1 rounded-b-lg opacity-0 group-hover:opacity-100 transition-opacity",children:s.caption})]},a))})}),s.main_image_url&&(!s.review_images||0===s.review_images.length)&&e.jsx("div",{className:"mt-3",children:e.jsx("img",{src:s.main_image_url,alt:"ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒ",className:"w-full max-w-md h-48 object-cover rounded-lg border border-gray-200 cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>window.open(s.main_image_url,"_blank")})})]})]})},s.id))}),c&&!r&&e.jsx("div",{className:"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-yellow-800",children:"ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æŠ•ç¨¿ã™ã‚‹ã«ã¯ã€ã“ã®ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã‚’å®Ÿéš›ã«åˆ©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚"})})]})}function z(){const{id:x}=a(),{user:g}=c(),p=t(),[u,b]=s.useState(null),[N,L]=s.useState([]),[R,z]=s.useState(null),[B,A]=s.useState([]),[K,U]=s.useState(!1),[G,H]=s.useState(!0),[Q,V]=s.useState(!1),[W,X]=s.useState(!1),[Y,Z]=s.useState([]),[ee,se]=s.useState([]),[ae,te]=s.useState(null),[re,le]=s.useState({rating:5,review_text:"",visit_date:"",dog_id:""}),[ie,ce]=s.useState([]),[ne,de]=s.useState(!1),[oe,me]=s.useState(0),[xe,he]=s.useState([]),[ge,pe]=s.useState(!1),[ue,je]=s.useState(!1),[be,Ne]=s.useState(new Date),[fe,ve]=s.useState(null),[ye,we]=s.useState([]),[_e,ke]=s.useState(null),[Se,De]=s.useState(!1),[Ce,$e]=s.useState(""),[Ie,Pe]=s.useState(!1);s.useEffect(()=>{x&&qe()},[x,g]);const qe=async()=>{try{const[e,s]=await Promise.all([n.from("dog_parks").select("*").eq("id",x).eq("status","approved").single(),n.from("dog_park_images").select("*").eq("park_id",x).order("display_order",{ascending:!0}).limit(3)]);if(e.error)return void p("/parks");const a=e.data;b(a);const t=[];a.image_url&&t.push({id:"main",url:a.image_url,caption:`${a.name} - ãƒ¡ã‚¤ãƒ³ç”»åƒ`}),a.cover_image_url&&t.push({id:"cover",url:a.cover_image_url,caption:`${a.name} - ã‚«ãƒãƒ¼ç”»åƒ`}),!s.error&&Array.isArray(s.data)&&s.data.forEach(e=>{t.push({id:e.id,url:e.image_url,caption:e.caption||`${a.name} - æ–½è¨­ç”»åƒ`})}),0===t.length&&t.push({id:"placeholder",url:o,caption:"ç”»åƒæœªè¨­å®š"}),ce(t),H(!1);const r=[n.rpc("get_park_reviews",{park_id_param:x}),n.from("smart_locks").select("*").eq("park_id",x).eq("is_active",!0),n.from("maintenance_schedules").select("*").eq("dog_park_id",x).in("status",["scheduled","active"]).gte("end_date",(new Date).toISOString()).order("start_date",{ascending:!0})];s.data&&s.data.length>=3&&r.push(n.from("dog_park_images").select("*").eq("park_id",x).order("display_order",{ascending:!0}).range(3,50));const[l,i,c,d]=await Promise.all(r);if(l.error||L(l.data||[]),i.error||he(i.data||[]),!c.error&&c.data){we(c.data);const e=new Date,s=c.data.find(s=>{const a=new Date(s.start_date),t=new Date(s.end_date);return a<=e&&t>e});ke(s||null)}d&&!d.error&&d.data&&ce(e=>[...e,...d.data.map(e=>({id:e.id,url:e.image_url,caption:e.caption||`${a.name} - æ–½è¨­ç”»åƒ`}))]),g&&Le(i.data||[])}catch(e){ve(e.message||"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ"),p("/parks")}},Le=async e=>{if(g&&x)try{const s=[n.from("dogs").select("\n            *,\n            vaccine_certifications!inner(*)\n          ").eq("owner_id",g?.id).eq("vaccine_certifications.status","approved"),n.rpc("can_user_review_park",{user_id_param:g.id,park_id_param:x}),n.rpc("get_user_park_review",{user_id_param:g.id,park_id_param:x}),n.from("reservations").select("\n            *,\n            dog_park:dog_parks(*),\n            dog:dogs(*)\n          ").eq("park_id",x).eq("user_id",g?.id).eq("status","confirmed").eq("date",(new Date).toISOString().split("T")[0]).order("start_time",{ascending:!0}).limit(1).single()],[a,t,r,l]=await Promise.all(s);if(a.error||A(a.data||[]),t.error||U(t.data),!r.error&&r.data&&r.data.length>0){const e=r.data[0];z(e),le({rating:e.rating,review_text:e.review_text||"",visit_date:e.visit_date,dog_id:e.dog_id})}if(!l.error&&l.data&&te(l.data),e.length>0){const{data:s,error:a}=await n.rpc("check_user_park_access",{p_user_id:g.id,p_lock_id:e[0].lock_id});!a&&s&&s.has_access&&pe(!0)}}catch(s){}},Re=e=>{me(e),de(!0)},Je=()=>{alert("ãƒªãƒ¢ãƒ¼ãƒˆè§£éŒ ã®æº–å‚™ãŒã§ãã¾ã—ãŸï¼")},Fe=e=>{alert(`ãƒªãƒ¢ãƒ¼ãƒˆè§£éŒ ã®æº–å‚™ã«å¤±æ•—ã—ã¾ã—ãŸ: ${e}`)};if(G)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})});if(!u)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-600",children:"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ"}),e.jsx(l,{onClick:()=>p("/parks"),className:"mt-4",children:"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ä¸€è¦§ã«æˆ»ã‚‹"})]});const Te=(()=>{if(0===Y.length)return[];const e={};return Y.forEach(s=>{const a=s.date;e[a]||(e[a]={date:a,slots:[]});const t=parseInt(s.start_time),r=t+s.duration;e[a].slots.push({start:`${t.toString().padStart(2,"0")}:00`,end:`${r.toString().padStart(2,"0")}:00`})}),Object.values(e).sort((e,s)=>new Date(e.date).getTime()-new Date(s.date).getTime())})();return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[fe&&e.jsx("div",{className:"mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:fe}),u&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:()=>{window.history.length>1?window.history.back():p("/parks")},className:"flex items-center text-gray-600 hover:text-blue-600 transition-colors mb-4",children:[e.jsx(f,{className:"w-5 h-5 mr-2"}),"æˆ»ã‚‹"]})}),e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:u.name}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[e.jsx("span",{children:u.address}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["Â¥",u.price,"/æ—¥"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["æœ€çµ‚æ›´æ–°: ",be.toLocaleTimeString("ja-JP")]}),e.jsxs("button",{onClick:()=>{(async()=>{if(x)try{je(!0);const{data:e,error:s}=await n.from("dog_parks").select("*").eq("id",x).single();if(s)return;b(e),Ne(new Date)}catch(e){}finally{je(!1)}})()},disabled:ue,className:"flex items-center space-x-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors "+(ue?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-100 text-blue-700 hover:bg-blue-200"),children:[e.jsx(v,{className:"w-4 h-4 "+(ue?"animate-spin":"")}),e.jsx("span",{children:ue?"æ›´æ–°ä¸­...":"æ›´æ–°"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(J,{park:u,parkImages:ie,todayRentals:ee,onImageClick:Re}),e.jsx(T,{parkImages:ie,onImageClick:Re}),e.jsxs(i,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:u.name}),e.jsx("div",{className:"mb-3",children:_e?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500 mr-2"}),e.jsx("span",{className:"text-red-600 font-medium",children:"ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä¸­"})]}),e.jsxs("p",{className:"text-red-600 text-sm font-medium ml-5",children:[_e.title,_e.is_emergency&&" (ç·Šæ€¥)"]}),e.jsxs("p",{className:"text-red-500 text-xs ml-5",children:[new Date(_e.start_date).toLocaleDateString("ja-JP")," ",new Date(_e.start_date).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"})," ã€œ ",new Date(_e.end_date).toLocaleDateString("ja-JP")," ",new Date(_e.end_date).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"})]}),_e.description&&e.jsx("p",{className:"text-red-500 text-xs ml-5",children:_e.description})]}):e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500 mr-2"}),e.jsx("span",{className:"text-green-600 font-medium",children:"å–¶æ¥­ä¸­"})]})}),e.jsx("div",{className:"flex items-center space-x-4 mb-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"flex items-center space-x-1",children:[1,2,3,4,5].map(s=>e.jsx(j,{className:"w-5 h-5 "+(s<=Math.round(u.average_rating)?"text-yellow-400 fill-current":"text-gray-300")},s))}),e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:u.average_rating.toFixed(1)}),e.jsxs("span",{className:"text-sm text-gray-600",children:["(",u.review_count,"ä»¶ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼)"]})]})})]}),_e?e.jsx(l,{className:"opacity-50 cursor-not-allowed",disabled:!0,title:"ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä¸­ã®ãŸã‚äºˆç´„ã§ãã¾ã›ã‚“",children:"äºˆç´„ä¸å¯"}):e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{to:`/access-control?park=${u.id}`,children:e.jsx(l,{className:"bg-blue-600 hover:bg-blue-700",children:"å…¥å ´ã™ã‚‹"})}),e.jsx(r,{to:`/parks/${u.id}/reserve`,children:e.jsx(l,{variant:"secondary",className:"bg-gray-600 hover:bg-gray-700",children:"äºˆç´„ã™ã‚‹"})})]})]}),e.jsx("p",{className:"text-gray-700 mb-6",children:u.description}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(y,{className:"w-5 h-5 mr-3"}),e.jsx("span",{children:u.address})]}),e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(w,{className:"w-5 h-5 mr-3"}),e.jsxs("span",{children:["ç¾åœ¨ã®åˆ©ç”¨è€…: ",u.current_occupancy,"/",u.max_capacity,"äºº"]})]}),e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(_,{className:"w-5 h-5 mr-3"}),e.jsxs("span",{children:["æ–™é‡‘: Â¥",u.price,"/æ—¥"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[u.large_dog_area&&e.jsxs("div",{className:"flex items-center text-blue-600",children:[e.jsx(k,{className:"w-5 h-5 mr-3"}),e.jsx("span",{children:"å¤§åž‹çŠ¬OK"})]}),u.small_dog_area&&e.jsxs("div",{className:"flex items-center text-pink-600",children:[e.jsx(S,{className:"w-5 h-5 mr-3"}),e.jsx("span",{children:"å°åž‹çŠ¬OK"})]}),u.private_booths&&e.jsxs("div",{className:"flex items-center text-purple-600",children:[e.jsx(D,{className:"w-5 h-5 mr-3"}),e.jsxs("span",{children:["ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ–ãƒ¼ã‚¹ ",u.private_booth_count,"å®¤"]})]})]})]})]}),(_e||ye.length>0)&&e.jsxs(i,{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(m,{className:"w-6 h-6 text-yellow-600 mr-2"}),"ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æƒ…å ±"]}),_e&&e.jsxs("div",{className:`mb-4 p-4 rounded-lg ${_e.is_emergency?"bg-red-50 border-red-200":"bg-yellow-50 border-yellow-200"} border`,children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(m,{className:"w-5 h-5 "+(_e.is_emergency?"text-red-600":"text-yellow-600")}),e.jsx("span",{className:"text-lg font-semibold "+(_e.is_emergency?"text-red-800":"text-yellow-800"),children:_e.is_emergency?"ç·Šæ€¥ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä¸­":"ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä¸­"})]}),e.jsx("p",{className:`text-lg font-medium ${_e.is_emergency?"text-red-700":"text-yellow-700"} mb-2`,children:_e.title}),_e.description&&e.jsx("p",{className:`text-sm ${_e.is_emergency?"text-red-600":"text-yellow-600"} mb-3`,children:_e.description}),e.jsx("div",{className:"flex items-center space-x-4 text-sm",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(h,{className:"w-4 h-4 "+(_e.is_emergency?"text-red-600":"text-yellow-600")}),e.jsxs("span",{className:"font-medium "+(_e.is_emergency?"text-red-700":"text-yellow-700"),children:[new Date(_e.start_date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})," ",new Date(_e.start_date).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"}),"ã€œ",new Date(_e.end_date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})," ",new Date(_e.end_date).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"})]})]})}),e.jsx("p",{className:`text-sm ${_e.is_emergency?"text-red-600":"text-yellow-600"} mt-3 font-medium`,children:"â€»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æœŸé–“ä¸­ã¯ä¼‘æ¥­ã¨ãªã‚Šã¾ã™"})]}),ye.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"ä»Šå¾Œã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹äºˆå®š"}),e.jsx("div",{className:"space-y-3",children:ye.filter(e=>"scheduled"===e.status&&new Date(e.start_date)>new Date).slice(0,3).map((s,a)=>e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx(h,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"font-medium text-gray-900",children:s.title}),s.is_emergency&&e.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full",children:"ç·Šæ€¥"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[new Date(s.start_date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})," ",new Date(s.start_date).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"}),"ã€œ",new Date(s.end_date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})," ",new Date(s.end_date).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"})]}),s.description&&e.jsx("p",{className:"text-sm text-gray-500",children:s.description})]})})},a))})]})]}),xe.length>0&&ge&&e.jsxs(i,{className:"p-6 bg-blue-50 border-blue-200",children:[e.jsxs("div",{className:"flex items-start space-x-3 mb-4",children:[e.jsx(C,{className:"w-6 h-6 text-blue-600 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-blue-900 mb-2",children:"å…¥å£ãƒ‰ã‚¢ã®é–‹éŒ "}),e.jsx("p",{className:"text-sm text-blue-800 mb-4",children:"ãƒªãƒ¢ãƒ¼ãƒˆè§£éŒ ã§å…¥å£ã®ã‚¹ãƒžãƒ¼ãƒˆãƒ­ãƒƒã‚¯ã‚’é–‹éŒ ã§ãã¾ã™ã€‚"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:xe.map(s=>e.jsx(d,{lockId:s.lock_id,label:`${s.lock_name}ã‚’ãƒªãƒ¢ãƒ¼ãƒˆè§£éŒ `,className:"w-full",onSuccess:Je,onError:Fe,reservationId:ae?.id},s.id))})]}),ee.length>0&&e.jsx(i,{className:"p-6 bg-orange-50 border-orange-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(m,{className:"w-6 h-6 text-orange-600 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-orange-900 mb-3",children:"æœ¬æ—¥ã®è²¸ã—åˆ‡ã‚Šæ™‚é–“"}),e.jsx("p",{className:"text-sm text-orange-800 mb-4",children:"ä»¥ä¸‹ã®æ™‚é–“å¸¯ã¯æ–½è¨­è²¸ã—åˆ‡ã‚Šã®ãŸã‚ã€é€šå¸¸åˆ©ç”¨ï¼ˆ1Dayãƒ‘ã‚¹ãƒ»ã‚µãƒ–ã‚¹ã‚¯ï¼‰ã§ã®å…¥å ´ã¯ã§ãã¾ã›ã‚“ã€‚"}),e.jsx("div",{className:"space-y-3",children:ee.map((s,a)=>{const t=parseInt(s.start_time),r=t+s.duration;return e.jsx("div",{className:"bg-white p-3 rounded-lg border border-orange-200",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{className:"w-5 h-5 text-orange-600"}),e.jsxs("span",{className:"font-medium text-orange-900",children:[t,":00 ã€œ ",r,":00"]})]})},a)})})]})]})}),Te.length>0&&e.jsx(E,{rentalInfo:Te}),e.jsx(F,{park:u}),e.jsx(O,{park:u,reviews:N,userReview:R,canReview:K,user:g,userDogs:B,showReviewForm:Q,setShowReviewForm:V,reviewFormData:re,setReviewFormData:le,isSubmitting:W,handleReviewSubmit:async e=>{if(e.preventDefault(),g&&u){X(!0);try{if(R){const{error:e}=await n.from("dog_park_reviews").update({rating:re.rating,review_text:re.review_text,visit_date:re.visit_date,dog_id:re.dog_id,updated_at:(new Date).toISOString()}).eq("id",R.id);if(e)throw e}else{const{error:e}=await n.from("dog_park_reviews").insert([{park_id:x,user_id:g.id,dog_id:re.dog_id,rating:re.rating,review_text:re.review_text,visit_date:re.visit_date}]);if(e)throw e}await qe(),V(!1),alert(R?"ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ›´æ–°ã—ã¾ã—ãŸï¼":"ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æŠ•ç¨¿ã—ã¾ã—ãŸï¼")}catch(s){alert("ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®æŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚")}finally{X(!1)}}},handleDeleteReview:async()=>{if(R&&confirm("ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ"))try{const{error:e}=await n.from("dog_park_reviews").delete().eq("id",R.id);if(e)throw e;await qe(),z(null),le({rating:5,review_text:"",visit_date:"",dog_id:""}),alert("ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚")}catch(e){alert("ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}}})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(i,{className:"p-4",children:_e?e.jsx(l,{className:"w-full text-lg py-3 opacity-50 cursor-not-allowed",disabled:!0,title:"ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä¸­ã®ãŸã‚äºˆç´„ã§ãã¾ã›ã‚“",children:"äºˆç´„ä¸å¯"}):e.jsx(r,{to:`/access-control?park=${u.id}`,children:e.jsx(l,{className:"w-full bg-blue-600 hover:bg-blue-700 text-lg py-3",children:"äºˆç´„ã™ã‚‹"})})}),xe.length>0&&ge&&e.jsxs(i,{className:"p-4 bg-blue-50 border-blue-200",children:[e.jsxs("h3",{className:"font-semibold text-blue-900 mb-3 flex items-center",children:[e.jsx(C,{className:"w-5 h-5 text-blue-600 mr-2"}),"å…¥å£ãƒ‰ã‚¢ã‚’é–‹ã‘ã‚‹"]}),e.jsx("div",{className:"space-y-3",children:xe.map(s=>e.jsx(d,{lockId:s.lock_id,label:`${s.lock_name}ã‚’ãƒªãƒ¢ãƒ¼ãƒˆè§£éŒ `,className:"w-full",onSuccess:Je,onError:Fe,reservationId:ae?.id},s.id))})]}),e.jsxs(i,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"æ–™é‡‘æƒ…å ±"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"é€šå¸¸åˆ©ç”¨"}),e.jsxs("span",{className:"font-medium",children:["Â¥",u.price,"/æ—¥"]})]}),u.private_booths&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ–ãƒ¼ã‚¹"}),e.jsx("span",{className:"font-medium text-green-600",children:"è¿½åŠ æ–™é‡‘ãªã—"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"æ–½è¨­è²¸ã—åˆ‡ã‚Š"}),e.jsx("span",{className:"font-medium",children:"Â¥4,400/æ™‚é–“"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³"}),e.jsx("span",{className:"font-medium",children:"Â¥3,800/æœˆ"})]})]})]}),e.jsxs(i,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"ç¾åœ¨ã®çŠ¶æ³"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"åˆ©ç”¨è€…æ•°"}),e.jsxs("span",{className:"font-medium",children:[u.current_occupancy,"/",u.max_capacity,"äºº"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-600",children:[e.jsxs("span",{children:[u.current_occupancy,"äºº"]}),e.jsxs("span",{children:[Math.round(u.current_occupancy/u.max_capacity*100),"%"]}),e.jsxs("span",{children:[u.max_capacity,"äºº"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:`h-3 rounded-full transition-all duration-300 ${M(u.current_occupancy,u.max_capacity).barColor}`,style:{width:u.current_occupancy/u.max_capacity*100+"%"}})})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-medium flex items-center justify-center space-x-1 ${M(u.current_occupancy,u.max_capacity).color}`,children:[e.jsx("span",{children:M(u.current_occupancy,u.max_capacity).emoji}),e.jsx("span",{children:M(u.current_occupancy,u.max_capacity).text})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:M(u.current_occupancy,u.max_capacity).description})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-xs text-gray-500",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{children:"ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ä¸­"})]})]})]}),e.jsxs(i,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"è©•ä¾¡"}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"text-3xl font-bold text-gray-900 mb-1",children:u.average_rating.toFixed(1)}),e.jsx("div",{className:"flex items-center justify-center space-x-1",children:[1,2,3,4,5].map(s=>e.jsx(j,{className:"w-6 h-6 "+(s<=Math.round(u.average_rating)?"text-yellow-400 fill-current":"text-gray-300")},s))}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:[u.review_count,"ä»¶ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼"]})]}),u.review_count>0&&e.jsx("div",{className:"space-y-2",children:[5,4,3,2,1].map(s=>{const a=N.filter(e=>e.rating===s).length,t=u.review_count>0?a/u.review_count*100:0;return e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("span",{className:"w-3",children:s}),e.jsx(j,{className:"w-3 h-3 text-yellow-400 fill-current"}),e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-yellow-400 h-2 rounded-full",style:{width:`${t}%`}})}),e.jsx("span",{className:"w-8 text-right",children:a})]},s)})})]}),e.jsxs(i,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"ã‚¢ã‚¯ã‚»ã‚¹"}),e.jsxs("div",{className:"text-sm text-gray-700 space-y-2",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(y,{className:"w-4 h-4 text-gray-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:u.address})]}),e.jsx("div",{className:"mt-3",children:e.jsx(l,{variant:"secondary",size:"sm",className:"w-full",onClick:()=>{const e=encodeURIComponent(u.address);window.open(`https://maps.google.com/maps?q=${e}`,"_blank")},children:"Google Mapsã§é–‹ã"})})]})]}),e.jsx(i,{className:"p-4",children:e.jsxs(l,{onClick:async()=>{De(!0)},className:"w-full bg-green-600 hover:bg-green-700 text-lg py-3 flex items-center justify-center",children:[e.jsx($,{className:"w-5 h-5 mr-2"}),"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã‚ªãƒ¼ãƒŠãƒ¼ã«å•ã„åˆã‚ã›ã‚‹"]})})]})]}),ne&&ie.length>0&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"relative w-full max-w-4xl",children:[e.jsx("button",{onClick:()=>{de(!1)},className:"absolute top-4 right-4 text-gray-800 bg-white bg-opacity-90 shadow-lg rounded-full p-2 hover:bg-opacity-100 transition-all z-10",children:e.jsx(I,{className:"w-6 h-6"})}),e.jsx("button",{onClick:()=>{me(e=>(e-1+ie.length)%ie.length)},className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-800 bg-white bg-opacity-90 shadow-lg rounded-full p-2 hover:bg-opacity-100 transition-all z-10",children:e.jsx(P,{className:"w-6 h-6"})}),e.jsx("button",{onClick:()=>{me(e=>(e+1)%ie.length)},className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-800 bg-white bg-opacity-90 shadow-lg rounded-full p-2 hover:bg-opacity-100 transition-all z-10",children:e.jsx(q,{className:"w-6 h-6"})}),e.jsx("div",{className:"flex items-center justify-center h-[80vh]",children:e.jsx("img",{src:ie[oe].url,alt:ie[oe].caption||`${u.name} - ç”»åƒ ${oe+1}`,className:"max-h-full max-w-full object-contain"})}),e.jsxs("div",{className:"absolute bottom-4 left-0 right-0 text-center text-white",children:[e.jsx("p",{className:"text-sm mb-2",children:ie[oe].caption}),e.jsxs("p",{className:"text-xs",children:[oe+1," / ",ie.length]})]})]})})]})]})}const M=(e,s)=>{const a=e/s*100;return a<25?{text:"ç©ºã„ã¦ã„ã¾ã™",color:"text-green-600 bg-green-100",barColor:"bg-green-500",description:"å¿«é©ã«åˆ©ç”¨ã§ãã¾ã™",emoji:"ðŸ˜Š"}:a<50?{text:"ã‚„ã‚„ç©ºã„ã¦ã„ã¾ã™",color:"text-blue-600 bg-blue-100",barColor:"bg-blue-500",description:"é©åº¦ãªæ··é›‘ã§ã™",emoji:"ðŸ™‚"}:a<75?{text:"ã‚„ã‚„æ··ã‚“ã§ã„ã¾ã™",color:"text-yellow-600 bg-yellow-100",barColor:"bg-yellow-500",description:"å°‘ã—æ··é›‘ã—ã¦ã„ã¾ã™",emoji:"ðŸ˜"}:{text:"æ··ã‚“ã§ã„ã¾ã™",color:"text-red-600 bg-red-100",barColor:"bg-red-500",description:"å¤§å¤‰æ··é›‘ã—ã¦ã„ã¾ã™",emoji:"ðŸ˜°"}};export{z as DogParkDetail};

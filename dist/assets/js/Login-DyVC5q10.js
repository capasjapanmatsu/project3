import{j as e}from"./motion-CuO0nkIV.js";import{r as s}from"./react-vendor-cniURDpR.js";import{B as a}from"./Button-BVIkPLCk.js";import{u as t,C as r,l}from"./index-Cxr3hxlQ.js";import{I as c}from"./Input-D7pb8xRh.js";import{n as o,A as i,g as n,i as m,h as d,E as x,j as h}from"./ui-basic-icnN6BOT.js";import{n as g}from"./notification-BEazPlEb.js";import{a as b,u as j}from"./router-Cg6wfOY4.js";import"./supabase-B0bqaRGb.js";import"./heavy-features-BIdEME4r.js";const u=({full:s=!1})=>e.jsxs(a,{onClick:()=>{window.location.assign("/liff/login")},className:(s?"w-full":"")+" bg-green-600 hover:bg-green-700",children:[e.jsx(o,{className:"w-4 h-4 mr-2"}),"LINEアカウントでログイン"]});function N(){const{signInWithMagicLink:o,signInWithPassword:N,signInWithGoogle:p,signInWithTwitter:f}=t(),[y,v]=s.useState(!1),[w,k]=s.useState(""),[C,A]=s.useState(""),[S,L]=s.useState(""),[I,E]=s.useState(!1),M=b(),P=j(),W=new URLSearchParams(P.search),q=W.get("method"),U=W.get("redirect")||"/dashboard",B=W.get("message"),[D,G]=s.useState("magic"!==q);s.useEffect(()=>{},[]);return e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold text-center mb-8",children:"ログイン"}),B&&e.jsx("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(i,{className:"w-4 h-4 text-blue-600"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-blue-800",children:decodeURIComponent(B)})})]})}),e.jsxs(r,{children:[e.jsxs("div",{className:"flex mb-6 bg-gray-100 p-1 rounded-lg",children:[e.jsx(a,{type:"button",onClick:()=>G(!0),variant:D?"primary":"secondary",style:D?{backgroundColor:"#2563eb",color:"white",borderColor:"#2563eb"}:{backgroundColor:"white",color:"#2563eb",borderColor:"#2563eb"},children:"パスワード"}),e.jsx(a,{type:"button",onClick:()=>G(!1),variant:D?"secondary":"primary",style:D?{backgroundColor:"white",color:"#2563eb",borderColor:"#2563eb"}:{backgroundColor:"#2563eb",color:"white",borderColor:"#2563eb"},children:"Magic Link"})]}),D?e.jsxs("form",{onSubmit:e=>{(async e=>{e.preventDefault(),v(!0),k("");try{const e=await N(C,S);e.success?(g.success("ログインしました。"),M(U)):k(e.error||"ログインに失敗しました。もう一度お試しください。")}catch(s){l.error("❌ Password login error:",s),k(s instanceof Error?s.message:"ログインに失敗しました。もう一度お試しください。")}finally{v(!1)}})(e)},className:"p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(n,{className:"w-12 h-12 text-blue-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"パスワードでログイン"}),e.jsx("p",{className:"text-gray-600",children:"メールアドレスとパスワードを入力してください。"})]}),w&&e.jsxs("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded-lg flex items-start",children:[e.jsx(m,{className:"w-5 h-5 mr-2 flex-shrink-0 mt-0.5"}),e.jsx("p",{children:w})]}),e.jsx(c,{label:"メールアドレス",type:"email",value:C,onChange:e=>A(e.target.value),required:!0,icon:e.jsx(d,{className:"w-4 h-4 text-gray-500"}),placeholder:"dog@dogparkjp.com"}),e.jsxs("div",{className:"relative",children:[e.jsx(c,{label:"パスワード",type:I?"text":"password",value:S,onChange:e=>L(e.target.value),required:!0,icon:e.jsx(n,{className:"w-4 h-4 text-gray-500"}),placeholder:"パスワードを入力"}),e.jsx("button",{type:"button",onClick:()=>E(!I),className:"absolute right-3 top-9 text-gray-500 hover:text-gray-700",children:I?e.jsx(x,{className:"w-4 h-4"}):e.jsx(h,{className:"w-4 h-4"})})]}),e.jsxs(a,{type:"submit",isLoading:y,className:"w-full mt-6",children:[e.jsx(n,{className:"w-4 h-4 mr-2"}),"ログイン",e.jsx(i,{className:"w-4 h-4 ml-2"})]}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{type:"button",onClick:()=>M("/forgot-password"),className:"text-sm text-blue-600 hover:text-blue-700",children:"パスワードをお忘れですか？"})})]}):e.jsxs("form",{onSubmit:e=>{(async e=>{e.preventDefault(),v(!0),k("");try{const e=await o(C);e.success?(localStorage.setItem("lastUsedEmail",C),g.success("ログインリンクを送信しました。メールをご確認ください。")):k(e.error||"Magic Linkの送信に失敗しました。もう一度お試しください。")}catch(s){l.error("❌ Magic link error:",s),k(s instanceof Error?s.message:"Magic Linkの送信に失敗しました。もう一度お試しください。")}finally{v(!1)}})(e)},className:"p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(d,{className:"w-12 h-12 text-blue-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Magic Linkでログイン"}),e.jsx("p",{className:"text-gray-600",children:"メールアドレスを入力するだけで、ドッグパークJPにログインできます。"})]}),w&&e.jsxs("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded-lg flex items-start",children:[e.jsx(m,{className:"w-5 h-5 mr-2 flex-shrink-0 mt-0.5"}),e.jsx("p",{children:w})]}),e.jsx(c,{label:"メールアドレス",type:"email",value:C,onChange:e=>A(e.target.value),required:!0,icon:e.jsx(d,{className:"w-4 h-4 text-gray-500"}),placeholder:"dog@dogparkjp.com"}),e.jsxs(a,{type:"submit",isLoading:y,className:"w-full mt-6",children:[e.jsx(d,{className:"w-4 h-4 mr-2"}),"ログインリンクを送信",e.jsx(i,{className:"w-4 h-4 ml-2"})]})]})]}),e.jsxs("div",{className:"relative flex items-center py-4",children:[e.jsx("div",{className:"flex-grow border-t border-gray-200"}),e.jsx("span",{className:"mx-3 text-gray-400 text-sm",children:"または"}),e.jsx("div",{className:"flex-grow border-t border-gray-200"})]}),e.jsx("div",{className:"mb-4",children:e.jsxs(a,{onClick:()=>{p()},className:"w-full bg-white text-gray-900 border border-gray-300 hover:bg-gray-50",children:[e.jsx("img",{src:"/icons/google.svg",alt:"",className:"w-5 h-5 mr-2"}),e.jsx("span",{className:"text-gray-900 font-semibold",children:"Googleアカウントでログイン"})]})}),e.jsx("div",{className:"mb-4",children:e.jsxs(a,{onClick:()=>{f()},className:"w-full bg-black text-white border border-gray-800 hover:bg-gray-900",children:[e.jsx("img",{src:"/icons/x.svg",alt:"",className:"w-5 h-5 mr-2"}),e.jsx("span",{className:"font-semibold",children:"X (Twitter) でログイン"})]})}),e.jsx(u,{full:!0}),e.jsx("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg border",children:e.jsxs("div",{className:"text-center",children:[e.jsx(m,{className:"w-6 h-6 text-orange-600 mx-auto mb-2"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-1",children:"ログインできない場合"}),e.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"管理者向けに不具合を報告できます"}),e.jsxs("button",{type:"button",onClick:()=>window.open("mailto:info@dogparkjp.com?subject=ドッグパークJP - ログイン不具合報告&body=ログインに関する不具合を報告いたします。%0A%0A【発生状況】%0A%0A【エラー内容】%0A%0A【ブラウザ情報】%0A"+navigator.userAgent,"_blank"),className:"inline-flex items-center px-4 py-2 bg-orange-600 text-white text-sm font-medium rounded-lg hover:bg-orange-700 transition-colors",children:[e.jsx(d,{className:"w-4 h-4 mr-2"}),"管理者に報告する"]})]})}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["アカウントをお持ちでない方は"," ",e.jsx("button",{onClick:()=>M("/register"),className:"text-blue-600 hover:text-blue-700 font-medium",children:"こちらから新規登録"})]})}),e.jsx("div",{className:"mt-8 text-center",children:e.jsx("button",{onClick:()=>M("/"),className:"text-sm text-blue-600 hover:text-blue-700 underline",children:"スキップ"})}),e.jsx("div",{className:"mt-4 pb-4 text-center",children:e.jsx("p",{className:"text-xs text-gray-500",children:"© 2025 CAPAS Co., Ltd. All rights reserved."})})]})}export{N as Login};

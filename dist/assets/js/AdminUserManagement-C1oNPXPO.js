import{j as e}from"./motion-BHsL7Azw.js";import{r as s}from"./react-vendor-CMvmJHsS.js";import{a,L as t}from"./router-DXQOdrLL.js";import{s as r,u as i,B as l}from"./index-uJd3UZbq.js";import{C as c}from"./Card-DqVnP9TA.js";import{I as n}from"./Input-BA7ko280.js";import{b as d}from"./adminFraudDetection-DNMshQKy.js";import{d as m,_ as x,U as o,q as u,w as h,C as j,s as g,aP as p,o as f,r as v,an as N,X as b,aQ as y,a6 as _,aR as w,aS as k,aT as S,aB as C}from"./ui-basic-DDpq4BmP.js";import"./heavy-features-Dlg1c9Yc.js";import"./supabase-D2tiogv8.js";function D(){const{isAdmin:D}=i(),U=a(),[L,I]=s.useState([]),[A,P]=s.useState([]),[E,q]=s.useState(!0),[R,T]=s.useState(""),[z,J]=s.useState(""),[F,B]=s.useState("all"),[M,H]=s.useState("created_at"),[O,Q]=s.useState("desc"),[$,G]=s.useState(!1),[K,V]=s.useState(null),[W,X]=s.useState(!1),[Y,Z]=s.useState(!1),[ee,se]=s.useState(null),[ae,te]=s.useState(""),[re,ie]=s.useState("fraud_abuse"),[le,ce]=s.useState(""),[ne,de]=s.useState(!1),[me,xe]=s.useState(null);s.useEffect(()=>{D?oe():U("/")},[D,U]),s.useEffect(()=>{ue()},[L,z,F,M,O]);const oe=async()=>{try{q(!0),T("");const{data:e,error:s}=await r.from("profiles").select("\n          id,\n          name,\n          user_type,\n          postal_code,\n          address,\n          phone_number,\n          created_at\n        ");if(s)throw new Error("プロファイル情報の取得に失敗しました");if(!e||0===e.length)return void I([]);const{data:a,error:t}=await r.from("fraud_detection_logs").select("\n          user_id,\n          risk_score,\n          detection_type,\n          created_at\n        ").order("created_at",{ascending:!1}),i=new Map;a&&!t&&a.forEach(e=>{const s=i.get(e.user_id);s?i.set(e.user_id,{maxRiskScore:Math.max(s.maxRiskScore,e.risk_score),detectionCount:s.detectionCount+1}):i.set(e.user_id,{maxRiskScore:e.risk_score,detectionCount:1})});const l=e.map(async e=>{try{const{count:s}=await r.from("dogs").select("id",{count:"exact"}).eq("owner_id",e.id),a=new Date;a.setDate(1),a.setHours(0,0,0,0);const{count:t}=await r.from("reservations").select("id",{count:"exact"}).eq("user_id",e.id).gte("created_at",a.toISOString()),{data:l}=await r.from("subscriptions").select("status").eq("user_id",e.id).eq("status","active").single(),{data:c}=await r.from("reservations").select("total_amount").eq("user_id",e.id).eq("status","confirmed"),n=c?.reduce((e,s)=>e+(s.total_amount||0),0)||0,d=i.get(e.id);let m="low";return d&&(d.maxRiskScore>=70?m="high":d.maxRiskScore>=50&&(m="medium")),{id:e.id,name:e.name||"Unknown",email:"N/A",phone:e.phone_number,created_at:e.created_at,last_sign_in_at:void 0,is_active:!0,subscription_status:l?"active":"inactive",dog_count:s||0,reservation_count:t||0,total_spent:n,fraud_risk_score:d?.maxRiskScore||0,fraud_risk_level:m,fraud_detection_count:d?.detectionCount||0}}catch(s){return null}}),c=(await Promise.allSettled(l)).filter(e=>"fulfilled"===e.status&&null!==e.value).map(e=>e.value);I(c)}catch(e){T(e instanceof Error?e.message:"ユーザー情報の取得に失敗しました")}finally{q(!1)}},ue=()=>{let e=L.filter(e=>{const s=e.name.toLowerCase().includes(z.toLowerCase())||e.email.toLowerCase().includes(z.toLowerCase()),a=(()=>{switch(F){case"active":return e.is_active;case"inactive":return!e.is_active;case"subscribers":return"active"===e.subscription_status;case"high_risk":return"high"===e.fraud_risk_level;case"medium_risk":return"medium"===e.fraud_risk_level;default:return!0}})();return s&&a});e.sort((e,s)=>{let a,t;switch(M){case"name":a=e.name,t=s.name;break;case"created_at":a=new Date(e.created_at),t=new Date(s.created_at);break;case"last_sign_in_at":a=e.last_sign_in_at?new Date(e.last_sign_in_at):new Date(0),t=s.last_sign_in_at?new Date(s.last_sign_in_at):new Date(0);break;case"total_spent":a=e.total_spent,t=s.total_spent;break;case"fraud_risk_score":a=e.fraud_risk_score||0,t=s.fraud_risk_score||0;break;default:a=e.created_at,t=s.created_at}return a<t?"asc"===O?-1:1:a>t?"asc"===O?1:-1:0}),P(e)},he=(s,a,t)=>{if(0===t)return null;switch(s){case"high":return e.jsxs("span",{className:"inline-flex items-center px-2 py-1 text-xs font-medium bg-red-100 text-red-800 rounded-full",children:[e.jsx(C,{className:"w-3 h-3 mr-1"}),"高リスク (",a,")"]});case"medium":return e.jsxs("span",{className:"inline-flex items-center px-2 py-1 text-xs font-medium bg-yellow-100 text-yellow-800 rounded-full",children:[e.jsx(u,{className:"w-3 h-3 mr-1"}),"中リスク (",a,")"]});default:return e.jsxs("span",{className:"inline-flex items-center px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full",children:[e.jsx(S,{className:"w-3 h-3 mr-1"}),"低リスク (",a,")"]})}};return D?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(t,{to:"/admin",children:e.jsxs(l,{variant:"secondary",size:"sm",children:[e.jsx(x,{className:"w-4 h-4 mr-2"}),"管理者ダッシュボード"]})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx(o,{className:"w-8 h-8 text-blue-600 mr-3"}),"ユーザー管理"]}),e.jsx("p",{className:"text-gray-600",children:"ユーザー情報と不正検知状況の管理"})]})]})})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[R&&e.jsxs("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4 mb-6",children:[e.jsx(u,{className:"w-5 h-5 inline mr-2"}),R]}),e.jsx(c,{className:"p-6 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"検索"}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{className:"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx(n,{type:"text",placeholder:"名前またはメールで検索",value:z,onChange:e=>J(e.target.value),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"フィルター"}),e.jsxs("select",{value:F,onChange:e=>B(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"すべて"}),e.jsx("option",{value:"active",children:"アクティブ"}),e.jsx("option",{value:"inactive",children:"非アクティブ"}),e.jsx("option",{value:"subscribers",children:"サブスクリプション"}),e.jsx("option",{value:"high_risk",children:"高リスクユーザー"}),e.jsx("option",{value:"medium_risk",children:"中リスクユーザー"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ソート"}),e.jsxs("select",{value:M,onChange:e=>H(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"created_at",children:"登録日"}),e.jsx("option",{value:"name",children:"名前"}),e.jsx("option",{value:"total_spent",children:"支払い合計"}),e.jsx("option",{value:"fraud_risk_score",children:"リスクスコア"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"順序"}),e.jsxs("select",{value:O,onChange:e=>Q(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"desc",children:"降順"}),e.jsx("option",{value:"asc",children:"昇順"})]})]})]})}),E?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsx(c,{children:e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ユーザー"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"登録情報"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"利用状況"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"不正検知"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"アクション"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:A.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(o,{className:"w-5 h-5 text-blue-600"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm text-gray-900",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(j,{className:"w-4 h-4 text-gray-400 mr-1"}),new Date(s.created_at).toLocaleDateString("ja-JP")]}),s.phone&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(g,{className:"w-4 h-4 text-gray-400 mr-1"}),s.phone]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm text-gray-900",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(p,{className:"w-4 h-4 text-gray-400 mr-1"}),s.dog_count,"匹"]}),e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(j,{className:"w-4 h-4 text-gray-400 mr-1"}),s.reservation_count,"件"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-gray-400 mr-1",children:"¥"}),s.total_spent.toLocaleString()]})]}),"active"===s.subscription_status&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full mt-1",children:[e.jsx(f,{className:"w-3 h-3 mr-1"}),"サブスクリプション"]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"space-y-1",children:[he(s.fraud_risk_level||"low",s.fraud_risk_score||0,s.fraud_detection_count||0),(s.fraud_detection_count||0)>0&&e.jsxs("div",{className:"text-xs text-gray-500",children:["検知回数: ",s.fraud_detection_count,"回"]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(t,{to:`/admin/users/${s.id}`,children:e.jsxs(l,{variant:"secondary",size:"sm",children:[e.jsx(v,{className:"w-4 h-4 mr-1"}),"詳細"]})}),(s.fraud_detection_count||0)>0&&e.jsxs(l,{variant:"secondary",size:"sm",onClick:()=>(async e=>{X(!0),G(!0);try{const s=await d(e);V(s)}catch(s){}finally{X(!1)}})(s.id),className:"text-red-600 hover:text-red-800",children:[e.jsx(m,{className:"w-4 h-4 mr-1"}),"不正検知"]}),"high"===s.fraud_risk_level&&e.jsxs(l,{size:"sm",onClick:()=>(e=>{se(e),te(""),ie("fraud_abuse"),ce(""),xe(null),Z(!0)})(s),className:"bg-red-600 hover:bg-red-700 text-white",children:[e.jsx(N,{className:"w-4 h-4 mr-1"}),"強制退会"]})]})})]},s.id))})]}),0===A.length&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(o,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"ユーザーが見つかりません"}),e.jsx("p",{className:"text-gray-600",children:"検索条件を変更してお試しください。"})]})]})}),$&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(m,{className:"w-6 h-6 text-red-600 mr-2"}),"不正検知詳細情報"]}),e.jsx("button",{onClick:()=>G(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(b,{className:"w-6 h-6"})})]}),W?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):K?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-md font-semibold text-gray-900 mb-3 flex items-center",children:[e.jsx(y,{className:"w-5 h-5 text-blue-600 mr-2"}),"デバイス情報"]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:K.deviceFingerprints.length>0?e.jsx("div",{className:"space-y-3",children:K.deviceFingerprints.slice(0,3).map((s,a)=>e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"font-medium",children:["フィンガープリント: ",s.fingerprint.substring(0,16),"..."]}),e.jsxs("div",{className:"text-gray-600",children:["IP: ",s.ipAddress]}),e.jsxs("div",{className:"text-gray-600",children:["ユーザーエージェント: ",s.userAgent.substring(0,50),"..."]}),e.jsxs("div",{className:"text-gray-600",children:["日時: ",new Date(s.createdAt).toLocaleString("ja-JP")]})]},a))}):e.jsx("p",{className:"text-gray-500",children:"デバイス情報がありません"})})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-md font-semibold text-gray-900 mb-3 flex items-center",children:[e.jsx(u,{className:"w-5 h-5 text-orange-600 mr-2"}),"不正検知ログ"]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:K.fraudLogs.length>0?e.jsx("div",{className:"space-y-3",children:K.fraudLogs.map((s,a)=>e.jsxs("div",{className:"text-sm border-b border-gray-200 pb-2 last:border-b-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-red-600",children:s.detectionType}),e.jsxs("span",{className:"text-gray-600",children:["リスクスコア: ",s.riskScore]})]}),e.jsxs("div",{className:"text-gray-600",children:["対応: ",s.actionTaken]}),e.jsxs("div",{className:"text-gray-600",children:["日時: ",new Date(s.createdAt).toLocaleString("ja-JP")]})]},a))}):e.jsx("p",{className:"text-gray-500",children:"不正検知ログがありません"})})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-md font-semibold text-gray-900 mb-3 flex items-center",children:[e.jsx(_,{className:"w-5 h-5 text-green-600 mr-2"}),"カード使用履歴"]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:K.cardUsage.length>0?e.jsx("div",{className:"space-y-3",children:K.cardUsage.map((s,a)=>e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"font-medium",children:["カード: ",s.cardFingerprint.substring(0,16),"..."]}),e.jsxs("div",{className:"text-gray-600",children:["トライアル利用: ",s.trialUsed?"あり":"なし",s.trialUsed&&s.trialUsedAt&&e.jsxs("span",{className:"ml-2",children:["(",new Date(s.trialUsedAt).toLocaleDateString("ja-JP"),")"]})]}),e.jsxs("div",{className:"text-gray-600",children:["登録日: ",new Date(s.createdAt).toLocaleString("ja-JP")]})]},a))}):e.jsx("p",{className:"text-gray-500",children:"カード使用履歴がありません"})})]}),(K.duplicateDeviceUsers.length>0||K.duplicateIpUsers.length>0)&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-md font-semibold text-gray-900 mb-3 flex items-center",children:[e.jsx(w,{className:"w-5 h-5 text-purple-600 mr-2"}),"重複検知"]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-4",children:[K.duplicateDeviceUsers.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"font-medium text-red-800",children:"同一デバイス使用者:"}),e.jsxs("div",{className:"text-sm text-red-700",children:[K.duplicateDeviceUsers.length,"人のユーザーが同じデバイスを使用"]})]}),K.duplicateIpUsers.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-red-800",children:"同一IP使用者:"}),e.jsxs("div",{className:"text-sm text-red-700",children:[K.duplicateIpUsers.length,"人のユーザーが同じIPアドレスを使用"]})]})]})]})]}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"不正検知情報の取得に失敗しました"})}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx(l,{onClick:()=>G(!1),children:"閉じる"})})]})}),Y&&ee&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(k,{className:"w-6 h-6 text-red-600 mr-3"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"悪質ユーザー強制退会"})]}),me?e.jsx("div",{className:"text-center py-4",children:me.success?e.jsxs("div",{className:"text-green-800",children:[e.jsx("div",{className:"text-lg font-semibold mb-2",children:"✅ 強制退会完了"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{children:me.message}),me.bannedEmail&&e.jsxs("p",{className:"mt-2",children:["対象: ",me.bannedEmail]})]})]}):e.jsxs("div",{className:"text-red-800",children:[e.jsx("div",{className:"text-lg font-semibold mb-2",children:"❌ 処理失敗"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{children:me.message}),me.error&&e.jsxs("p",{className:"mt-2 text-gray-600",children:["エラー: ",me.error]})]})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(u,{className:"w-5 h-5 text-red-600 mt-0.5 mr-2"}),e.jsxs("div",{className:"text-sm text-red-800",children:[e.jsx("p",{className:"font-medium",children:"警告: この操作は取り消せません"}),e.jsxs("p",{className:"mt-1",children:["ユーザー「",e.jsx("span",{className:"font-medium",children:ee.name}),"」を強制退会させます。 関連するすべてのデータが削除・無効化され、再登録も制限されます。"]})]})]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["退会理由 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:ae,onChange:e=>te(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500",rows:3,placeholder:"詳細な退会理由を記載してください"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"退会タイプ"}),e.jsxs("select",{value:re,onChange:e=>ie(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500",children:[e.jsx("option",{value:"fraud_abuse",children:"不正利用・悪用"}),e.jsx("option",{value:"subscription_abuse",children:"サブスクリプション悪用"}),e.jsx("option",{value:"policy_violation",children:"規約違反"}),e.jsx("option",{value:"other",children:"その他"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["確認のため、ユーザー名「",e.jsx("span",{className:"font-medium text-red-600",children:ee.name}),"」を入力してください"]}),e.jsx("input",{type:"text",value:le,onChange:e=>ce(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500",placeholder:"ユーザー名を入力"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(l,{onClick:()=>Z(!1),variant:"secondary",disabled:ne,children:"キャンセル"}),e.jsxs(l,{onClick:async()=>{if(ee&&le===ee.name)if(ae.trim()){if(window.confirm("本当に強制退会させますか？\nこの操作は取り消せません。"))try{de(!0),T("");const e={userId:ee.id,reason:ae,banType:re,evidence:{riskScore:ee.fraud_risk_score,detectionCount:ee.fraud_detection_count,adminAction:!0}},s=await async function(e){try{const{data:s,error:a}=await r.rpc("force_ban_user",{p_user_id:e.userId,p_admin_id:(await r.auth.getUser()).data.user?.id,p_reason:e.reason,p_ban_type:e.banType});return a?{success:!1,message:"強制退会の処理中にエラーが発生しました",error:a.message}:s&&s.success?{success:!0,message:s.message||"悪質ユーザーを強制退会させました",bannedEmail:s.banned_email,actionsTaken:s.actions_taken}:{success:!1,message:s?.error||"強制退会の処理に失敗しました",error:s?.error}}catch(R){return{success:!1,message:"予期しないエラーが発生しました",error:R instanceof Error?R.message:"Unknown error"}}}(e);xe(s),s.success&&(await oe(),setTimeout(()=>{Z(!1),se(null)},3e3))}catch(e){T("強制退会の処理中にエラーが発生しました。")}finally{de(!1)}}else T("退会理由を入力してください。");else T("ユーザー名が正しく入力されていません。")},className:"bg-red-600 hover:bg-red-700 text-white",disabled:ne||!ae.trim()||le!==ee.name,isLoading:ne,children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),"強制退会実行"]})]})]})]})})]})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs(c,{className:"p-8 text-center",children:[e.jsx(m,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"アクセス拒否"}),e.jsx("p",{className:"text-gray-600",children:"管理者権限が必要です。"})]})})}export{D as AdminUserManagement};

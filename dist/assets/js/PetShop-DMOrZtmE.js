import{j as e}from"./motion-CuO0nkIV.js";import{r as s}from"./react-vendor-cniURDpR.js";import{L as t,a}from"./router-Cg6wfOY4.js";import{B as i}from"./Button-Bq1kOCic.js";import{u as r,a as l,s as n,C as o}from"./index-DcAUXhuw.js";import{I as c}from"./Input-rtfXcnE2.js";import{u as d}from"./useStripe-AaYka8xN.js";import{p as m}from"./stripe-config-CouKGnnS.js";import{O as u,z as h,d as x,m as p,G as g,al as b,t as f,a1 as j,o as y,am as w,an as v}from"./ui-basic-Kxp_U5Up.js";import"./supabase-B0bqaRGb.js";import"./heavy-features-BIdEME4r.js";import"./external-api-CcgPsVUa.js";function N({hasSubscription:a=!1,className:r="",variant:l="primary",size:n="md"}){const{createCheckoutSession:o,loading:c,error:h}=d(),[x,p]=s.useState(!1);return a?e.jsx(t,{to:"/subscription-intro",children:e.jsxs(i,{variant:l,size:n,className:`flex items-center bg-blue-600 hover:bg-blue-700 text-white ${r}`,children:[e.jsx(u,{className:("sm"===n?"w-3 h-3":"w-4 h-4")+" mr-1"}),"サブスク管理"]})}):e.jsxs("div",{children:[e.jsxs(i,{onClick:()=>{(async()=>{p(!1);const e=m.find(e=>"subscription"===e.mode);if(e)try{await o({priceId:e.priceId,mode:"subscription",successUrl:`${window.location.origin}/dashboard?success=true`,cancelUrl:`${window.location.origin}/dashboard?canceled=true`})}catch{p(!0)}})()},isLoading:c,variant:"primary",size:n,className:`flex items-center bg-blue-600 hover:bg-blue-700 text-white ${r}`,children:[e.jsx(u,{className:("sm"===n?"w-3 h-3":"w-4 h-4")+" mr-1"}),"サブスクに加入"]}),x&&h&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:h})]})}function _(){const{user:d,lineUser:m,effectiveUserId:_}=r(),C=a(),[q,S]=s.useState([]),[$,k]=s.useState([]),[z,E]=s.useState(!0),[O,L]=s.useState(""),[T,R]=s.useState("all"),[F,I]=s.useState("name"),{isActive:D}=l(),P=s.useDeferredValue(O),W=s.useDeferredValue(T),A=s.useDeferredValue(F),V=[{value:"all",label:"すべて",icon:h},{value:"food",label:"ドッグフード",icon:b},{value:"treats",label:"おやつ",icon:f},{value:"toys",label:"おもちゃ",icon:j},{value:"accessories",label:"アクセサリー",icon:u},{value:"health",label:"ヘルスケア",icon:y},{value:"sheets",label:"ペットシーツ",icon:b},{value:"business",label:"業務用品",icon:b}];s.useEffect(()=>{B()},[d,m,_]);const B=async()=>{E(!0);try{await Promise.all([U(),d?J():Promise.resolve()])}catch(e){}finally{E(!1)}},U=async()=>{const{data:e,error:s}=await n.from("products").select("*").eq("is_active",!0).order("created_at",{ascending:!1});if(s)throw s;S(e||[])},J=async()=>{const e=d?.id||m?.app_user_id||m?.id||_,{data:s,error:t}=await n.from("cart_items").select("*, product:products(*)").eq("user_id",e);if(t)throw t;k(s||[])},M=async(e,s)=>{if(s<=0)try{const{error:s}=await n.from("cart_items").delete().eq("id",e);if(s)throw s;await B()}catch(t){}else try{const{error:t}=await n.from("cart_items").update({quantity:s}).eq("id",e);if(t)throw t;await B()}catch(t){}},Y=e=>D?Math.round(.9*e):e,G=s.useMemo(()=>q.filter(e=>{const s=e.name.toLowerCase().includes(P.toLowerCase())||e.description.toLowerCase().includes(P.toLowerCase())||e.brand&&e.brand.toLowerCase().includes(P.toLowerCase()),t="all"===W||e.category===W;return s&&t}).sort((e,s)=>{switch(A){case"name":return e.name.localeCompare(s.name);case"price":return Y(e.price)-Y(s.price);case"category":return e.category.localeCompare(s.category);default:return new Date(s.created_at).getTime()-new Date(e.created_at).getTime()}}),[q,P,W,A]),H=e=>{if(!e)return"";try{const s=JSON.parse(e);if(Array.isArray(s)&&s.length>0)return s[0]}catch(s){}return e},K=e=>{if(!e)return[];try{const s=JSON.parse(e);if(Array.isArray(s))return s}catch(s){}return[e]},Q=e=>{s.startTransition(()=>{R(e)})};return z?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center",children:[e.jsx(h,{className:"w-8 h-8 text-green-600 mr-3"}),"ペットショップ"]}),e.jsx("p",{className:"text-gray-600",children:"愛犬のための厳選商品をお届け"})]}),e.jsx(t,{to:"/cart",children:e.jsxs(i,{className:"bg-green-600 hover:bg-green-700",children:[e.jsx(x,{className:"w-4 h-4 mr-2"}),"カート (",$.reduce((e,s)=>e+s.quantity,0),")"]})})]}),e.jsx("div",{className:"relative overflow-hidden",children:D?e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 via-pink-600 to-purple-700 text-white p-8 rounded-xl shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-full",children:e.jsx(u,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold mb-2 flex items-center",children:[e.jsx(p,{className:"w-6 h-6 mr-2"}),"サブスクリプション会員特典適用中！"]}),e.jsx("p",{className:"text-lg opacity-90",children:"全商品10%OFF + 送料無料でお買い物をお楽しみください"})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"bg-white/20 px-6 py-3 rounded-lg",children:[e.jsx("p",{className:"text-sm opacity-80",children:"今月の節約額"}),e.jsx("p",{className:"text-2xl font-bold",children:"¥1,200+"})]})})]}),e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-16 -mt-16"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white/10 rounded-full -ml-12 -mb-12"})]}):e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 text-white p-8 rounded-xl shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-full",children:e.jsx(g,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold mb-2 flex items-center",children:[e.jsx(u,{className:"w-6 h-6 mr-2"}),"サブスク会員は全品10％OFF & 送料無料！"]}),e.jsx("p",{className:"text-lg opacity-90",children:"月額3,800円でどこでも使い放題 + ドッグラン使い放題"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(N,{hasSubscription:D,className:"font-bold px-6 py-3 text-lg"}),e.jsx("p",{className:"text-sm opacity-80 mt-2",children:"初月無料キャンペーン中"})]})]}),e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-16 -mt-16"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white/10 rounded-full -ml-12 -mb-12"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(c,{label:"",value:O,onChange:e=>{return t=e.target.value,L(t),void s.startTransition(()=>{});var t},placeholder:"商品名、ブランド名で検索..."})}),e.jsx("div",{children:e.jsx("select",{value:T,onChange:e=>Q(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",children:V.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})}),e.jsx("div",{children:e.jsxs("select",{value:F,onChange:e=>{return t=e.target.value,void s.startTransition(()=>{I(t)});var t},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",children:[e.jsx("option",{value:"popular",children:"人気順"}),e.jsx("option",{value:"name",children:"名前順"}),e.jsx("option",{value:"price",children:"価格の安い順"}),e.jsx("option",{value:"category",children:"カテゴリー順"})]})})]}),e.jsxs("details",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("summary",{className:"cursor-pointer select-none text-gray-800 font-semibold",children:"カテゴリを表示"}),e.jsx("div",{className:"mt-3 grid grid-cols-2 sm:grid-cols-4 gap-2",children:V.map(s=>{const t=s.icon;return e.jsxs("button",{onClick:()=>Q(s.value),className:"flex items-center justify-start space-x-2 px-3 py-2 rounded-lg transition-colors "+(T===s.value?"bg-green-600 text-white":"bg-white text-gray-700 hover:bg-gray-100 border"),children:[e.jsx(t,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:s.label})]},s.value)})})]}),0===G.length?e.jsxs(o,{className:"text-center py-12",children:[e.jsx(h,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"該当する商品が見つかりませんでした"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:G.filter(e=>"all"===W||e.category===W).map(s=>{const a=(e=>{const s=$.find(s=>s.product_id===e);return s?s.quantity:0})(s.id),r=s.price,l=Y(r),c=D&&l<r;return e.jsxs(o,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"relative -m-6 mb-4",children:[e.jsx("img",{"data-product-id":s.id,src:H(s.image_url),alt:s.name,className:"w-full aspect-square object-cover",onError:e=>{e.currentTarget.src="https://images.pexels.com/photos/1108099/pexels-photo-1108099.jpeg"}}),K(s.image_url).length>1&&e.jsxs("div",{className:"absolute top-3 right-3 bg-black bg-opacity-70 text-white text-xs px-2 py-1 rounded",children:["📸 ",K(s.image_url).length,"枚"]}),c&&e.jsx("div",{className:"absolute top-5 left-5",children:e.jsxs("span",{className:"bg-purple-500 text-white px-2 py-1 rounded-full text-xs font-medium flex items-center shadow-md",children:[e.jsx(u,{className:"w-3 h-3 mr-1"}),"10%OFF"]})}),s.stock_quantity<=5&&e.jsx("div",{className:"absolute top-5 right-5",children:e.jsxs("span",{className:"bg-red-500 text-white px-2 py-1 rounded-full text-xs font-medium shadow-md",children:["残り",s.stock_quantity,"個"]})})]}),e.jsxs("div",{className:"px-6 pb-6",children:[e.jsxs("div",{className:"mb-2",children:[s.brand&&e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:s.brand}),e.jsx("h3",{className:"text-lg font-semibold line-clamp-2",children:s.name})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:s.description}),e.jsxs("div",{className:"space-y-1 text-xs text-gray-500 mb-3",children:[s.weight&&e.jsxs("p",{children:["内容量: ",s.weight,"g"]}),s.size&&e.jsxs("p",{children:["サイズ: ",s.size]}),s.age_group&&"all"!==s.age_group&&e.jsxs("p",{children:["対象年齢: ","puppy"===s.age_group?"子犬":"adult"===s.age_group?"成犬":"シニア犬"]}),s.dog_size&&"all"!==s.dog_size&&e.jsxs("p",{children:["対象サイズ: ","small"===s.dog_size?"小型犬":"medium"===s.dog_size?"中型犬":"大型犬"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-xl font-bold text-green-600",children:["¥",l.toLocaleString()]}),c&&e.jsxs("span",{className:"text-sm text-gray-500 line-through",children:["¥",r.toLocaleString()]})]}),D&&e.jsxs("p",{className:"text-xs text-purple-600 flex items-center",children:[e.jsx(u,{className:"w-3 h-3 mr-1"}),"サブスク会員価格"]})]}),e.jsxs("div",{className:"space-y-2",children:[a>0?e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 rounded-lg p-2",children:[e.jsx("button",{onClick:()=>{const e=$.find(e=>e.product_id===s.id);e&&M(e.id,a-1)},className:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center hover:bg-gray-300 transition-colors",children:e.jsx(w,{className:"w-4 h-4"})}),e.jsx("span",{className:"font-medium",children:a}),e.jsx("button",{onClick:()=>{const e=$.find(e=>e.product_id===s.id);e&&M(e.id,a+1)},className:"w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center hover:bg-green-700 transition-colors",children:e.jsx(y,{className:"w-4 h-4"})})]}):e.jsx(i,{onClick:()=>{(async(e,s=1)=>{const t=d?.id||m?.app_user_id||m?.id||_;if(t)try{const a=$.find(s=>s.product_id===e);if(a){const{error:e}=await n.from("cart_items").update({quantity:a.quantity+s}).eq("id",a.id);if(e)throw e}else{const{error:a}=await n.from("cart_items").insert([{user_id:t,product_id:e,quantity:s}]);if(a)throw a}await B()}catch(a){}else C("/login")})(s.id),(e=>{const s=document.querySelector(`img[data-product-id="${e}"]`);if(!s)return;const t=s.getBoundingClientRect(),a=document.createElement("div");Object.assign(a.style,{position:"fixed",inset:"0",pointerEvents:"none",zIndex:"9999",contain:"paint",backfaceVisibility:"hidden"}),document.body.appendChild(a);const i=new Image;i.src=s.src;const r=window.scrollY||window.pageYOffset,l={htmlOverflow:document.documentElement.style.overflow,bodyPosition:document.body.style.position,bodyTop:document.body.style.top,bodyWidth:document.body.style.width,bodyPaddingRight:document.body.style.paddingRight},n=window.innerWidth-document.documentElement.clientWidth;document.documentElement.style.overflow="hidden",document.body.style.position="fixed",document.body.style.top=`-${r}px`,document.body.style.width="100%",n>0&&(document.body.style.paddingRight=`${n}px`);try{document.activeElement?.blur()}catch{}const o=.8;Object.assign(i.style,{position:"absolute",transformOrigin:"top left",opacity:"0.9",borderRadius:"8px",pointerEvents:"none",willChange:"transform, opacity",backfaceVisibility:"hidden",boxShadow:"0 12px 24px rgba(0,0,0,0.35)",transform:`translate3d(${t.left}px, ${t.top}px, 0) scale(0.8, 0.8)`}),a.appendChild(i);const c=document.querySelector('[data-cart-target="true"]'),d=c?c.getBoundingClientRect():{left:window.innerWidth-40,top:20,width:20,height:20},m=window.innerWidth/2-t.width*o/2,u=window.innerHeight/2-t.height*o/2,h=d.left+d.width/2-(t.left+t.width*o/2),x=d.top+d.height/2-(t.top+t.height*o/2),p=()=>{i.animate([{transform:`translate3d(${t.left}px, ${t.top}px, 0) scale(0.8, 0.8)`,opacity:.9},{transform:`translate3d(${m}px, ${u}px, 0) scale(0.8, 0.8)`,opacity:.85,offset:.5},{transform:`translate3d(${t.left+h}px, ${t.top+x}px, 0) scale(0.2, 0.2)`,opacity:0}],{duration:3e3,easing:"cubic-bezier(0.16, 0.84, 0.3, 1)",fill:"forwards"}).addEventListener("finish",()=>{a.remove(),document.documentElement.style.overflow=l.htmlOverflow,document.body.style.position=l.bodyPosition,document.body.style.top=l.bodyTop,document.body.style.width=l.bodyWidth,document.body.style.paddingRight=l.bodyPaddingRight,window.scrollTo(0,r)})};i.complete?p():i.onload=()=>p()})(s.id)},className:"w-full bg-green-600 hover:bg-green-700",disabled:0===s.stock_quantity,children:0===s.stock_quantity?"在庫切れ":e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"w-4 h-4 mr-2"}),"カートに追加"]})}),e.jsx(t,{to:`/products/${s.id}`,children:e.jsx(i,{variant:"secondary",className:"w-full",children:"詳細を見る"})})]})]})]},s.id)})}),e.jsx(o,{className:"bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(v,{className:"w-6 h-6 text-blue-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"配送について"}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("p",{children:"• 送料：全国一律¥690"}),e.jsxs("p",{children:["• ¥5,000以上のご注文で",e.jsx("span",{className:"font-medium",children:"送料無料"})]}),e.jsxs("p",{children:["• サブスク会員は",e.jsx("span",{className:"font-medium",children:"常に送料無料"})]}),e.jsx("p",{children:"• 平日14時までのご注文で翌日お届け"}),e.jsx("p",{children:"• 土日祝日も配送いたします"})]})]})]})})]})}export{_ as PetShop};

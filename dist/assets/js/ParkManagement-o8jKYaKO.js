import{j as e,m as s,A as t}from"./motion-CuO0nkIV.js";import{r as a}from"./react-vendor-cniURDpR.js";import{d as i,a as r,L as l}from"./router-Cg6wfOY4.js";import{B as n,a as c,b as o}from"./Button-6ascT97E.js";import{u as d,C as m,s as x}from"./index-hxb5tPha.js";import{I as u}from"./ImageCropper-C1jlYJ5u.js";import{L as h}from"./LocationEditMap-BU8uldZy.js";import{a$ as p,X as g,A as b,a4 as j,K as f,b0 as y,ac as N,R as w,i as v,ao as _,y as k,g as S,o as C,aO as I,b1 as T,ae as q,N as O,J as D,aY as z,aZ as E,e as B,M as P,af as $,j as M,a1 as R,b2 as A,aW as L,U as F,b3 as Y,ad as H,a_ as U,C as W,aA as X}from"./ui-basic-icnN6BOT.js";import"./supabase-B0bqaRGb.js";import"./heavy-features-BIdEME4r.js";import"./geocoding-C2oaRnzC.js";import"./Input-D7pb8xRh.js";function K({onComplete:s,onClose:t,onStepChange:i}){const{user:r}=d(),[l,c]=a.useState(0),[o,u]=a.useState(""),[h,f]=a.useState(!1),[y,N]=a.useState(null),[w,v]=a.useState(!1),[_,k]=a.useState(0),S=a.useRef(null),C=a.useRef();a.useRef(!1);const I=[{id:"welcome",title:"ğŸ‰ å¯©æŸ»é€šéãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼",message:"ã„ã‚ˆã„ã‚ˆã‚ªãƒ¼ãƒ—ãƒ³ã§ã™ã€‚æ¬¡ã«æ¡ˆå†…ã™ã‚‹è¨­å®šã‚’è¦‹ç›´ã—ã‚ªãƒ¼ãƒ—ãƒ³ã—ã¾ã—ã‚‡ã†ã€‚",targetSelector:"",position:"bottom"},{id:"location-tab",title:"ğŸ“ ä½ç½®èª¿æ•´ã‚’é–‹å§‹",message:"ã€Œä½ç½®èª¿æ•´ã€ã‚¿ãƒ–ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã€ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã®æ­£ç¢ºãªä½ç½®ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚",targetSelector:'[data-walkthrough="location-tab"]',position:"bottom",showArrow:!0,arrowBlinkCount:3,action:()=>{i?.("location"),setTimeout(()=>{q()},300)}},{id:"map-explanation",title:"ğŸ—ºï¸ ãƒãƒƒãƒ—ã§ä½ç½®ã‚’ç¢ºèª",message:"ãƒãƒƒãƒ—ä¸Šã®èµ¤ã„ãƒãƒ¼ã‚«ãƒ¼ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã€å®Ÿéš›ã®ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã®ä½ç½®ã«èª¿æ•´ã—ã¦ãã ã•ã„ã€‚æ­£ç¢ºãªä½ç½®ã¯åˆ©ç”¨è€…ãŒè¦‹ã¤ã‘ã‚„ã™ãã™ã‚‹ãŸã‚ã«é‡è¦ã§ã™ï¼",targetSelector:'[data-walkthrough="location-map"]',position:"top",action:()=>{setTimeout(()=>{const e=document.querySelector('[data-walkthrough="location-map"]');if(e){const s=e.getBoundingClientRect(),t=window.pageYOffset+s.top-420;window.scrollTo({top:Math.max(0,t),behavior:"smooth"})}else window.scrollTo({top:500,behavior:"smooth"})},400)}},{id:"save-location",title:"ğŸ’¾ ä½ç½®ã‚’ä¿å­˜",message:"ä½ç½®ã®èª¿æ•´ãŒå®Œäº†ã—ãŸã‚‰ã€ã€Œä½ç½®ã‚’ä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã—ã¦åº§æ¨™ã‚’ä¿å­˜ã—ã¦ãã ã•ã„ã€‚",targetSelector:'[data-walkthrough="save-location-button"]',position:"top",showArrow:!0,arrowBlinkCount:3},{id:"pins-tab",title:"ğŸ”‘ è§£éŒ ã‚­ãƒ¼ç®¡ç†ã¸",message:"æ¬¡ã«ã€ã‚¹ãƒãƒ¼ãƒˆãƒ­ãƒƒã‚¯ã®è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚ã€Œè§£éŒ ã‚­ãƒ¼ç®¡ç†ã€ã‚¿ãƒ–ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚",targetSelector:'[data-walkthrough="pins-tab"]',position:"bottom",showArrow:!0,arrowBlinkCount:3,action:()=>{i?.("pins"),setTimeout(()=>{q()},300)}},{id:"setup-smartlock",title:"ğŸ”’ ã‚¹ãƒãƒ¼ãƒˆãƒ­ãƒƒã‚¯è¨­å®š",message:"ã€Œã‚¹ãƒãƒ¼ãƒˆãƒ­ãƒƒã‚¯ã‚’è¨­å®šã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã€å…¥é€€å ´ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚",targetSelector:'[data-walkthrough="setup-smartlock-button"]',position:"top",showArrow:!0,arrowBlinkCount:3},{id:"overview-tab-final",title:"ğŸ¢ æ¦‚è¦ãƒ»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚¿ãƒ–ã¸",message:"æœ€å¾Œã«ã€å…¬é–‹è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚ã€Œæ¦‚è¦ãƒ»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã€ã‚¿ãƒ–ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚",targetSelector:'[data-walkthrough="overview-tab"]',position:"bottom",showArrow:!0,arrowBlinkCount:3,action:()=>{i?.("overview"),setTimeout(()=>{const e=document.querySelector('[data-walkthrough="public-toggle"]');if(e){const s=e.getBoundingClientRect(),t=window.pageYOffset+s.top-300;window.scrollTo({top:Math.max(0,t),behavior:"smooth"})}else window.scrollTo({top:document.body.scrollHeight/3,behavior:"smooth"})},500)}},{id:"public-setting",title:"ğŸŒ å…¬é–‹è¨­å®š",message:"ã™ã¹ã¦ã®æº–å‚™ãŒæ•´ã£ãŸã‚‰ã€ã€Œãƒ‰ãƒƒã‚°ãƒ©ãƒ¼ãƒ³ä¸€è¦§ã«è¡¨ç¤ºã€ã‚’ã‚ªãƒ³ã«ã—ã¦ãã ã•ã„ã€‚ã“ã‚Œã§ã‚ãªãŸã®ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ãŒå…¬é–‹ã•ã‚Œã¾ã™ï¼",targetSelector:'[data-walkthrough="public-toggle"]',position:"top",showArrow:!0,arrowBlinkCount:3,action:()=>{setTimeout(()=>{const e=document.querySelector('[data-walkthrough="public-toggle"]');e&&e.scrollIntoView({behavior:"smooth",block:"center"})},100)}}],T=I[l],q=()=>{window.scrollTo({top:0,behavior:"smooth"})};a.useCallback(e=>{const s=e.getBoundingClientRect(),t=window.pageYOffset+s.top-window.innerHeight/2+s.height/2;window.scrollTo({top:Math.max(0,t),behavior:"smooth"})},[]);const O=a.useCallback(e=>{if(!e||"string"!=typeof e||""===e.trim())return f(!1),void u("");if(h)return;C.current&&clearTimeout(C.current),f(!0),u("");const s=String(e).trim();let t=0;const a=()=>{if(t<s.length){const e=s[t];e&&"undefined"!==e&&u(s=>(s||"")+e),t++,C.current=setTimeout(a,50)}else f(!1)};a()},[h]),D=a.useCallback(()=>{if(!T?.targetSelector)return void N(null);const e=document.querySelector(T.targetSelector);e?(N(e),z(e,T.targetSelector),T.showArrow&&(v(!0),k(T.arrowBlinkCount||0))):N(null)},[T]),z=a.useCallback((e,s)=>{e.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),document.querySelectorAll("[data-walkthrough-spotlight]").forEach(e=>{e.__walkthroughCleanup&&e.__walkthroughCleanup()}),e.setAttribute("data-walkthrough-spotlight","true");const t=e.style.zIndex,a=e.style.position,i=e.style.boxShadow,r=e.style.transform,l=e.style.backgroundColor,n=s.includes("button")||"button"===e.tagName.toLowerCase()||"button"===e.getAttribute("role"),c=s.includes("tab");e.style.cssText+=c?"\n        position: relative !important;\n        z-index: 9999 !important;\n        background-color: #3B82F6 !important;\n        color: white !important;\n        box-shadow: 0 0 0 4px #3B82F6, 0 0 0 8px rgba(59, 130, 246, 0.5), 0 0 40px rgba(59, 130, 246, 1.0), 0 0 80px rgba(59, 130, 246, 0.6) !important;\n        transform: scale(1.1) !important;\n        transition: all 0.3s ease-in-out !important;\n        border-radius: 8px !important;\n        filter: brightness(1.2) contrast(1.1) !important;\n      ":n?"\n        position: relative !important;\n        z-index: 9999 !important;\n        box-shadow: 0 0 0 4px #3B82F6, 0 0 0 8px rgba(59, 130, 246, 0.5), 0 0 40px rgba(59, 130, 246, 1.0), 0 0 80px rgba(59, 130, 246, 0.6) !important;\n        transform: scale(1.05) !important;\n        transition: all 0.3s ease-in-out !important;\n        border-radius: 8px !important;\n        filter: brightness(1.1) contrast(1.1) !important;\n      ":"\n        position: relative !important;\n        z-index: 9999 !important;\n        box-shadow: 0 0 0 4px #3B82F6, 0 0 0 8px rgba(59, 130, 246, 0.3), 0 0 30px rgba(59, 130, 246, 0.8), 0 0 60px rgba(59, 130, 246, 0.4) !important;\n        transform: scale(1.02) !important;\n        transition: all 0.3s ease-in-out !important;\n        background-color: rgba(255, 255, 255, 0.95) !important;\n        border-radius: 8px !important;\n      ",e.__walkthroughCleanup=()=>{e.removeAttribute("data-walkthrough-spotlight"),e.style.zIndex=t,e.style.position=a,e.style.boxShadow=i,e.style.transform=r,e.style.backgroundColor=l,e.style.color="",e.style.borderRadius="",e.style.transition="",e.style.filter=""}},[]);a.useEffect(()=>{T&&(u(""),f(!1),setTimeout(()=>{T.message&&"string"==typeof T.message?O(T.message):(u("ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸã€‚"),f(!1))},100),T.action&&T.action(),setTimeout(()=>{D()},T.action?600:200))},[l]),a.useEffect(()=>()=>{C.current&&clearTimeout(C.current),document.querySelectorAll("[data-walkthrough-spotlight]").forEach(e=>{const s=e;s.__walkthroughCleanup&&s.__walkthroughCleanup()})},[]);const E=async()=>{document.querySelectorAll("[data-walkthrough-spotlight]").forEach(e=>{e.__walkthroughCleanup&&e.__walkthroughCleanup()});try{r&&await x.from("profiles").update({park_management_walkthrough_completed:!0}).eq("id",r.id),s()}catch(e){s()}};return T?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 "+("map-explanation"===T.id||"setup-smartlock"===T.id?"z-[10000]":"z-40")}),y&&e.jsx("div",{className:"fixed pointer-events-none z-50 rounded-lg shadow-2xl animate-pulse",style:{top:y.getBoundingClientRect().top+window.pageYOffset-8+"px",left:y.getBoundingClientRect().left+window.pageXOffset-8+"px",width:`${y.getBoundingClientRect().width+16}px`,height:`${y.getBoundingClientRect().height+16}px`,background:"rgba(59, 130, 246, 0.2)",border:"4px solid #3B82F6",boxShadow:"0 0 0 4px rgba(59, 130, 246, 0.3), 0 0 30px rgba(59, 130, 246, 0.6), 0 0 0 9999px rgba(0, 0, 0, 0.4)"}}),w&&y&&e.jsx("div",{className:"fixed z-50 text-blue-500 "+(_>0?"animate-pulse":""),style:{top:"top"===T.position?y.getBoundingClientRect().top+window.pageYOffset-40+"px":`${y.getBoundingClientRect().bottom+window.pageYOffset+10}px`,left:y.getBoundingClientRect().left+window.pageXOffset+y.getBoundingClientRect().width/2-12+"px"},children:"top"===T.position?e.jsx(p,{size:24,className:"animate-bounce"}):e.jsx(p,{size:24,className:"animate-bounce rotate-180"})}),e.jsx("div",{ref:S,className:"fixed transition-opacity duration-300 "+("map-explanation"===T.id?"w-96 max-w-lg animate-expand z-[10001]":"setup-smartlock"===T.id?"w-80 max-w-sm z-[10001]":"w-80 max-w-sm z-50"),style:{top:"map-explanation"===T.id?"80px":"save-location"===T.id?"200px":"setup-smartlock"===T.id?"120px":"public-setting"===T.id?(y?y.getBoundingClientRect().top-280:200)+"px":y&&"top"===T.position?y.getBoundingClientRect().top-200+"px":y&&"bottom"===T.position?`${y.getBoundingClientRect().bottom+60}px`:"50%",left:"map-explanation"===T.id||"save-location"===T.id||"setup-smartlock"===T.id?"50%":y?`${Math.max(16,Math.min(window.innerWidth-("map-explanation"===T.id?400:336),y.getBoundingClientRect().left+window.pageXOffset+y.getBoundingClientRect().width/2-("map-explanation"===T.id?200:160)))}px`:"50%",transform:"map-explanation"===T.id||"save-location"===T.id||"setup-smartlock"===T.id?"translateX(-50%)":y?"none":"translate(-50%, -50%)"},children:e.jsxs(m,{className:"relative shadow-2xl border-blue-200",children:[e.jsx("button",{onClick:()=>{document.querySelectorAll("[data-walkthrough-spotlight]").forEach(e=>{e.__walkthroughCleanup&&e.__walkthroughCleanup()}),t()},className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(g,{size:20})}),e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 pr-8",children:T.title}),e.jsxs("div",{className:"text-gray-600 mb-6 min-h-[3em] whitespace-pre-line",children:[o||"",h&&e.jsx("span",{className:"animate-pulse",children:"|"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(n,{variant:"outline",onClick:()=>{document.querySelectorAll("[data-walkthrough-spotlight]").forEach(e=>{e.__walkthroughCleanup&&e.__walkthroughCleanup()}),E()},children:"ã‚¹ã‚­ãƒƒãƒ—"}),e.jsxs("div",{className:"text-sm text-gray-500",children:[l+1," / ",I.length]}),e.jsx(n,{onClick:()=>{l<I.length-1?(c(l+1),v(!1)):E()},disabled:h,className:"flex items-center gap-2",children:l<I.length-1?e.jsxs(e.Fragment,{children:["æ¬¡ã¸",e.jsx(b,{size:16})]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{size:16}),"å®Œäº†"]})})]})]})]})})]}):null}const G=document.createElement("style");G.textContent="\n  @keyframes expand {\n    0% {\n      width: 320px;\n      height: 160px;\n      opacity: 0.8;\n    }\n    100% {\n      width: 384px;\n      height: auto;\n      opacity: 1;\n    }\n  }\n  \n  .animate-expand {\n    animation: expand 0.5s ease-out forwards;\n  }\n",document.head.querySelector("style[data-walkthrough]")||(G.setAttribute("data-walkthrough","true"),document.head.appendChild(G));const J={initial:{scale:1},hover:{scale:1.05,transition:{type:"spring",stiffness:400,damping:10}},tap:{scale:.95,transition:{type:"spring",stiffness:400,damping:10}}},Q={initial:{scale:.8,opacity:0,y:50},animate:{scale:[.8,1.1,1],opacity:[0,1,1],y:[50,-10,0],transition:{duration:.7,ease:"easeOut",times:[0,.5,1]}}},V={initial:{x:0},shake:{x:[-10,10,-10,10,0],transition:{duration:.6,ease:"easeInOut"}}},Z={initial:{scale:0,opacity:0},animate:{scale:1,opacity:1,transition:{type:"spring",stiffness:260,damping:20}}},ee={initial:{opacity:0,y:60},animate:{opacity:1,y:0,transition:{duration:.6,ease:"easeOut"}}},se={initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0,transition:{duration:.3,ease:"easeOut"}},exit:{opacity:0,scale:.9,y:-20,transition:{duration:.2}}};function te({lockId:i,parkName:r="ãƒ‰ãƒƒã‚°ãƒ‘ãƒ¼ã‚¯",purpose:l="entry",className:u="",onSuccess:h,onError:p,reservationId:g}){const{user:b}=d(),[S,C]=a.useState(null),[I,T]=a.useState(null),[q,O]=a.useState(null),[D,z]=a.useState(!1),[E,B]=a.useState(null),[P,$]=a.useState(!1),[M,R]=a.useState(!1),[A,L]=a.useState(!1),[F,Y]=a.useState(""),[H,U]=a.useState(!1);a.useEffect(()=>{if(S&&I){const e=setInterval(()=>{const s=new Date,t=I.getTime()-s.getTime();if(t<=0)O("æœŸé™åˆ‡ã‚Œ"),C(null),T(null),clearInterval(e);else{const e=Math.floor(t/6e4),s=Math.floor(t%6e4/1e3);O(`${e}:${s.toString().padStart(2,"0")}`)}},1e3);return()=>clearInterval(e)}},[S,I]);const W=async()=>{if(b){z(!0),B(null);try{const{data:{session:e}}=await x.auth.getSession();if(!e?.access_token)throw new Error("èªè¨¼ãŒå¿…è¦ã§ã™");let s=5,t=null;if(g){const e=await(async e=>{try{const{data:s,error:t}=await x.from("reservations").select("\n          *,\n          dog_park:dog_parks(*),\n          dog:dogs(*)\n        ").eq("id",e).single();return t?null:s}catch(s){return null}})(g);if(e&&"whole_facility"===e.reservation_type&&(t=(e=>{try{const s=new Date(e.date),t=e.start_time.split(":").map(Number),a=t[0]??0,i=t[1]??0;return s.setHours(a,i,0,0),new Date(s.getTime()+60*e.duration*60*1e3)}catch(s){return null}})(e),t)){const e=new Date,a=t.getTime()-e.getTime();s=Math.max(1,Math.ceil(a/6e4))}}const a=await fetch("https://onmcivwxtzqajcovptgf.supabase.co/functions/v1/generate-pin",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.access_token}`},body:JSON.stringify({lock_id:i,purpose:l,expiry_minutes:s,reservation_id:g||void 0})});if(!a.ok){const e=await a.json();throw new Error(e.error||"PINã‚³ãƒ¼ãƒ‰ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ")}const{pin:r,expires_at:n}=await a.json();C(r),T(new Date(n)),U(!0),R(!0),await o(),h&&h(r),setTimeout(()=>{R(!1),U(!1)},3e3)}catch(e){const s=e instanceof Error?e.message:"PINã‚³ãƒ¼ãƒ‰ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ";if(s.startsWith("PAYMENT_REQUIRED:")){const e=s.replace("PAYMENT_REQUIRED:","").trim();Y(e),L(!0),B(null)}else B(s),L(!1);p&&p(s)}finally{z(!1)}}};return e.jsx(s.div,{className:u,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs(s.h3,{className:"text-lg font-semibold mb-4 flex items-center justify-center",variants:ee,initial:"initial",animate:"animate",children:[e.jsx(s.div,{animate:H?{rotate:[0,15,-15,0]}:{},transition:{duration:.6,repeat:2},children:e.jsx(f,{className:"w-5 h-5 text-blue-600 mr-2"})}),r,"ã®","entry"===l?"å…¥å£":"å‡ºå£"]}),e.jsx(t,{mode:"wait",children:S?e.jsxs(s.div,{className:"space-y-4",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.3},children:[e.jsxs(s.div,{className:"bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg border-2 border-blue-200 mx-auto",variants:Q,initial:"initial",animate:H?"animate":"initial",children:[e.jsx("p",{className:"text-sm text-blue-800 mb-1",children:"PINã‚³ãƒ¼ãƒ‰:"}),e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(s.p,{className:"text-3xl font-bold tracking-widest text-blue-700",initial:{scale:1},animate:H?{scale:[1,1.1,1]}:{},transition:{duration:.6},children:S}),e.jsx(s.button,{onClick:async()=>{if(S)try{await navigator.clipboard.writeText(S),$(!0),await c(),setTimeout(()=>$(!1),2e3)}catch{}},className:"p-1 text-blue-600 hover:text-blue-800 transition-colors",title:"ã‚³ãƒ”ãƒ¼",variants:J,whileHover:"hover",whileTap:"tap",children:e.jsx(t,{mode:"wait",children:P?e.jsx(s.div,{variants:Z,initial:"initial",animate:"animate",exit:{scale:0,opacity:0},children:e.jsx(j,{className:"w-5 h-5 text-green-600"})},"copied"):e.jsx(s.div,{variants:Z,initial:"initial",animate:"animate",exit:{scale:0,opacity:0},children:e.jsx(y,{className:"w-5 h-5"})},"copy")})})]})]}),e.jsx(s.div,{className:"bg-yellow-50 p-2 rounded-lg",variants:ee,children:e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-yellow-800",children:[e.jsx(s.div,{animate:{rotate:[0,360]},transition:{duration:2,repeat:1/0,ease:"linear"},children:e.jsx(N,{className:"w-4 h-4"})}),e.jsxs("span",{className:"font-medium",children:["æœ‰åŠ¹æœŸé™: ",q]})]})}),e.jsx("div",{className:"flex justify-center space-x-3",children:e.jsx(s.div,{variants:J,whileHover:"hover",whileTap:"tap",children:e.jsxs(n,{onClick:()=>{W()},variant:"secondary",size:"sm",isLoading:D,children:[e.jsx(w,{className:"w-4 h-4 mr-1"}),"å†ç”Ÿæˆ"]})})}),e.jsxs(s.p,{className:"text-xs text-gray-500",variants:ee,children:["entry"===l?"å…¥å ´":"é€€å ´","æ™‚ã«ã‚¹ãƒãƒ¼ãƒˆãƒ­ãƒƒã‚¯ã®ã‚­ãƒ¼ãƒ‘ãƒƒãƒ‰ã«ä¸Šè¨˜ã®PINã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"]})]},"pin-display"):e.jsxs(s.div,{className:"space-y-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:[e.jsxs(s.p,{className:"text-gray-600 mb-4",variants:ee,children:["entry"===l?"å…¥å ´":"é€€å ´","ç”¨ã®PINã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã™ã€‚",e.jsx("br",{}),"ç”Ÿæˆã•ã‚ŒãŸPINã‚³ãƒ¼ãƒ‰ã¯5åˆ†é–“æœ‰åŠ¹ã§ã™ã€‚"]}),e.jsxs(t,{children:[E&&e.jsxs(s.div,{className:"bg-red-50 p-3 rounded-lg flex items-center justify-center text-red-600",variants:V,initial:"initial",animate:"shake",exit:{opacity:0,y:-10},children:[e.jsx(v,{className:"w-4 h-4 mr-1"}),e.jsx("span",{children:E})]}),A&&e.jsxs(s.div,{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",variants:se,initial:"initial",animate:"animate",exit:"exit",children:[e.jsxs("div",{className:"flex items-start space-x-3 mb-4",children:[e.jsx(_,{className:"w-6 h-6 text-blue-600 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"æ±ºæ¸ˆãŒå¿…è¦ã§ã™"}),e.jsx("p",{className:"text-sm text-blue-800 mb-4",children:F})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(s.div,{variants:J,whileHover:"hover",whileTap:"tap",children:e.jsxs(n,{onClick:()=>window.location.href="/subscription-intro",className:"w-full bg-purple-600 hover:bg-purple-700",children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã«åŠ å…¥ï¼ˆÂ¥3,800/æœˆï¼‰"]})}),e.jsx(s.div,{variants:J,whileHover:"hover",whileTap:"tap",children:e.jsxs(n,{onClick:()=>window.location.href="/parks",variant:"secondary",className:"w-full",children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"1Dayãƒ‘ã‚¹ã‚’è³¼å…¥ï¼ˆÂ¥800ï¼‰"]})})]}),e.jsxs("p",{className:"text-xs text-blue-700 mt-3",children:["â€¢ ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ï¼šå…¨å›½ã®ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ãŒä½¿ã„æ”¾é¡Œ",e.jsx("br",{}),"â€¢ 1Dayãƒ‘ã‚¹ï¼šé¸æŠã—ãŸãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã§24æ™‚é–“åˆ©ç”¨å¯èƒ½"]})]}),M&&e.jsxs(s.div,{className:"bg-green-50 p-3 rounded-lg flex items-center justify-center text-green-600",variants:Z,initial:"initial",animate:"animate",exit:{opacity:0,scale:.8},children:[e.jsx(j,{className:"w-4 h-4 mr-1"}),e.jsx("span",{children:"ğŸ‰ PINã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã—ãŸ"})]})]}),e.jsx(s.div,{variants:J,whileHover:"hover",whileTap:"tap",children:e.jsxs(n,{onClick:()=>{W()},isLoading:D,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700",children:[e.jsx(f,{className:"w-4 h-4 mr-2"}),"ğŸš€ ","entry"===l?"å…¥å ´":"é€€å ´","ç”¨PINã‚’ç”Ÿæˆ"]})})]},"pin-generate")})]})})})}function ae({parkId:s,parkName:t}){const[i,r]=a.useState([]),[l,c]=a.useState(!0),[o,d]=a.useState(""),[u,h]=a.useState(""),[p,b]=a.useState(!1),[j,y]=a.useState(null),[N,w]=a.useState({lock_id:"",lock_name:"",is_active:!0});a.useEffect(()=>{v()},[s]);const v=async()=>{try{c(!0),d("");let e=x.from("dog_run_locks").select("\n          *,\n          dog_parks!park_id (\n            name\n          )\n        ");s&&(e=e.eq("park_id",s));const{data:t,error:a}=await e.order("created_at",{ascending:!1});if(a)throw a;const i=t?.map(e=>({...e,park_name:e.dog_parks?.name||"Unknown"}))||[];r(i)}catch(e){d("ã‚¹ãƒãƒ¼ãƒˆãƒ­ãƒƒã‚¯ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{c(!1)}},_=(e,s,t)=>{r(a=>a.map(a=>a.id===e?{...a,[s]:t}:a))};return l?e.jsx(m,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})})}):e.jsx(m,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5 text-indigo-600"}),e.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["ã‚¹ãƒãƒ¼ãƒˆãƒ­ãƒƒã‚¯ç®¡ç†",t&&e.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["- ",t]})]})]}),s&&!p&&e.jsxs(n,{onClick:()=>b(!0),size:"sm",variant:"primary",className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-4 w-4"}),"ãƒ­ãƒƒã‚¯è¿½åŠ "]})]}),o&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:o}),u&&e.jsx("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded",children:u}),p&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"æ–°ã—ã„ã‚¹ãƒãƒ¼ãƒˆãƒ­ãƒƒã‚¯ã‚’è¿½åŠ "}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["ãƒ­ãƒƒã‚¯ID ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:N.lock_id,onChange:e=>w({...N,lock_id:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Sciener Lock ID"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["ãƒ­ãƒƒã‚¯å ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:N.lock_name,onChange:e=>w({...N,lock_name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"ä¾‹ï¼šæ­£é¢å…¥å£"})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:N.is_active,onChange:e=>w({...N,is_active:e.target.checked}),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"æœ‰åŠ¹ã«ã™ã‚‹"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{onClick:async()=>{if(s)if(N.lock_id&&N.lock_name)try{d("");const{error:e}=await x.from("dog_run_locks").insert({park_id:s,lock_id:N.lock_id,lock_name:N.lock_name,is_active:N.is_active});if(e)throw e;h("ã‚¹ãƒãƒ¼ãƒˆãƒ­ãƒƒã‚¯ã‚’è¿½åŠ ã—ã¾ã—ãŸ"),w({lock_id:"",lock_name:"",is_active:!0}),b(!1),await v(),setTimeout(()=>h(""),3e3)}catch(e){d("ã‚¹ãƒãƒ¼ãƒˆãƒ­ãƒƒã‚¯ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ")}else d("ã™ã¹ã¦ã®å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");else d("ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„")},size:"sm",variant:"primary",className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"}),"ä¿å­˜"]}),e.jsxs(n,{onClick:()=>{b(!1),w({lock_id:"",lock_name:"",is_active:!0})},size:"sm",variant:"secondary",className:"flex items-center gap-2",children:[e.jsx(g,{className:"h-4 w-4"}),"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"]})]})]}),s?0===i.length?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(f,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{children:"ã‚¹ãƒãƒ¼ãƒˆãƒ­ãƒƒã‚¯ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“"}),e.jsx("p",{className:"text-sm mt-1",children:"ã€Œãƒ­ãƒƒã‚¯è¿½åŠ ã€ãƒœã‚¿ãƒ³ã‹ã‚‰ç™»éŒ²ã—ã¦ãã ã•ã„"})]}):e.jsx("div",{className:"space-y-2",children:i.map(t=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50",children:j===t.id?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx("input",{type:"text",value:t.lock_id,onChange:e=>_(t.id,"lock_id",e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Lock ID"}),e.jsx("input",{type:"text",value:t.lock_name,onChange:e=>_(t.id,"lock_name",e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Lock Name"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.is_active,onChange:e=>_(t.id,"is_active",e.target.checked),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"æœ‰åŠ¹"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{onClick:()=>(async e=>{const s=i.find(s=>s.id===e);if(s)try{d("");const{error:t}=await x.from("dog_run_locks").update({lock_id:s.lock_id,lock_name:s.lock_name,is_active:s.is_active,updated_at:(new Date).toISOString()}).eq("id",e);if(t)throw t;h("ã‚¹ãƒãƒ¼ãƒˆãƒ­ãƒƒã‚¯ã‚’æ›´æ–°ã—ã¾ã—ãŸ"),y(null),await v(),setTimeout(()=>h(""),3e3)}catch(t){d("ã‚¹ãƒãƒ¼ãƒˆãƒ­ãƒƒã‚¯ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}})(t.id),size:"sm",variant:"primary",children:e.jsx(I,{className:"h-4 w-4"})}),e.jsx(n,{onClick:()=>y(null),size:"sm",variant:"secondary",children:e.jsx(g,{className:"h-4 w-4"})})]})]})]}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4 "+(t.is_active?"text-green-600":"text-gray-400")}),e.jsx("span",{className:"font-medium text-gray-900",children:t.lock_name}),!t.is_active&&e.jsx("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded",children:"ç„¡åŠ¹"})]}),e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["ID: ",t.lock_id,!s&&e.jsxs("span",{className:"ml-3",children:["å ´æ‰€: ",t.park_name]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{onClick:()=>y(t.id),size:"sm",variant:"secondary",children:e.jsx(T,{className:"h-4 w-4"})}),e.jsx(n,{onClick:()=>(async e=>{if(confirm("ã“ã®ã‚¹ãƒãƒ¼ãƒˆãƒ­ãƒƒã‚¯ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ"))try{d("");const{error:s}=await x.from("dog_run_locks").delete().eq("id",e);if(s)throw s;h("ã‚¹ãƒãƒ¼ãƒˆãƒ­ãƒƒã‚¯ã‚’å‰Šé™¤ã—ã¾ã—ãŸ"),await v(),setTimeout(()=>h(""),3e3)}catch(s){d("ã‚¹ãƒãƒ¼ãƒˆãƒ­ãƒƒã‚¯ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}})(t.id),size:"sm",variant:"danger",children:e.jsx(q,{className:"h-4 w-4"})})]})]})},t.id))}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã‚’é¸æŠã—ã¦ã‚¹ãƒãƒ¼ãƒˆãƒ­ãƒƒã‚¯ã‚’ç®¡ç†ã—ã¦ãã ã•ã„"})]})})}const ie={overview:{label:"æ–½è¨­å…¨æ™¯",description:"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã®å…¨ä½“ãŒè¦‹æ¸¡ã›ã‚‹å†™çœŸ",icon:O,required:!0},entrance:{label:"å…¥å£",description:"å…¥å£ã®æ§˜å­ãŒã‚ã‹ã‚‹å†™çœŸ",icon:P,required:!0},gate:{label:"ã‚¹ãƒãƒ¼ãƒˆãƒ­ãƒƒã‚¯",description:"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã®ã‚¹ãƒãƒ¼ãƒˆãƒ­ãƒƒã‚¯ï¼ˆå…¥é€€å ´ç®¡ç†ï¼‰ã®å†™çœŸ",icon:B,required:!0},large_dog_area:{label:"å¤§å‹çŠ¬ã‚¨ãƒªã‚¢",description:"å¤§å‹çŠ¬ç”¨ã®ã‚¨ãƒªã‚¢ã®å†™çœŸ",icon:O,required:!1,conditionalOn:"large_dog_area"},small_dog_area:{label:"å°å‹çŠ¬ã‚¨ãƒªã‚¢",description:"å°å‹çŠ¬ç”¨ã®ã‚¨ãƒªã‚¢ã®å†™çœŸ",icon:O,required:!1,conditionalOn:"small_dog_area"},private_booth:{label:"ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ–ãƒ¼ã‚¹",description:"ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ–ãƒ¼ã‚¹ã®å†…éƒ¨ã¨å¤–è¦³",icon:O,required:!1,conditionalOn:"private_booths"},parking:{label:"é§è»Šå ´",description:"é§è»Šå ´ã®æ§˜å­ãŒã‚ã‹ã‚‹å†™çœŸ",icon:E,required:!1,conditionalOn:"facilities.parking"},shower:{label:"ã‚·ãƒ£ãƒ¯ãƒ¼è¨­å‚™",description:"ã‚·ãƒ£ãƒ¯ãƒ¼è¨­å‚™ã®å†™çœŸ",icon:z,required:!1,conditionalOn:"facilities.shower"},restroom:{label:"ãƒˆã‚¤ãƒ¬",description:"ãƒˆã‚¤ãƒ¬è¨­å‚™ã®å†™çœŸ",icon:D,required:!1,conditionalOn:"facilities.restroom"},agility:{label:"ã‚¢ã‚¸ãƒªãƒ†ã‚£è¨­å‚™",description:"ã‚¢ã‚¸ãƒªãƒ†ã‚£è¨­å‚™ã®å†™çœŸ",icon:O,required:!1,conditionalOn:"facilities.agility"},rest_area:{label:"ä¼‘æ†©ã‚¹ãƒšãƒ¼ã‚¹",description:"ä¼‘æ†©ã‚¹ãƒšãƒ¼ã‚¹ã®å†™çœŸ",icon:O,required:!1,conditionalOn:"facilities.rest_area"},water_station:{label:"çµ¦æ°´è¨­å‚™",description:"çµ¦æ°´è¨­å‚™ã®å†™çœŸ",icon:O,required:!1,conditionalOn:"facilities.water_station"}},re=e=>{if(!e)return null;return new Date(e).toISOString()},le=e=>{if(!e)return"";const s=new Date(e);return new Date(s.getTime()-6e4*s.getTimezoneOffset()).toISOString().slice(0,16)};function ne(){const{id:s}=i(),{user:t}=d();r();const[c,o]=a.useState(null),[p,b]=a.useState(!0),[y,N]=a.useState(""),[w,_]=a.useState(""),[S,I]=a.useState("overview"),[T,z]=a.useState([]),[E,G]=a.useState(null),[J,Q]=a.useState("entry"),[V,Z]=a.useState([]),[ee,se]=a.useState(!1),[ne,ce]=a.useState(null),[oe,de]=a.useState({title:"",description:"",start_date:"",end_date:"",is_emergency:!1,notify_users:!0}),[me,xe]=a.useState(!1),[ue,he]=a.useState(!1),[pe,ge]=a.useState(!1),[be,je]=a.useState(!1),[fe,ye]=a.useState(!1),[Ne,we]=a.useState(""),[ve,_e]=a.useState(!1),[ke,Se]=a.useState({max_capacity:0,facilities:{parking:!1,shower:!1,restroom:!1,agility:!1,rest_area:!1,water_station:!1},large_dog_area:!1,small_dog_area:!1,private_booths:!1,private_booth_count:0,facility_details:"",description:"",address:"",latitude:null,longitude:null,geofence_radius_km:1,is_public:!1}),[Ce,Ie]=a.useState([]),[Te,qe]=a.useState(!1),[Oe,De]=a.useState(""),[ze,Ee]=a.useState(null),[Be,Pe]=a.useState(!1),[$e,Me]=a.useState(null),[Re,Ae]=a.useState(""),[Le,Fe]=a.useState(""),[Ye,He]=a.useState(null),[Ue,We]=a.useState(!1),[Xe,Ke]=a.useState({reservations:0,revenue:0,users:0,breakdown:{daypass:{count:0,amount:0},whole:{count:0,amount:0},subscription:{count:0,amount:0}}}),[Ge,Je]=a.useState([]),Qe=async()=>{if(s)try{const{data:e,error:t}=await x.from("maintenance_schedules").select("*").eq("dog_park_id",s).order("start_date",{ascending:!0});if(t)throw t;Z(e||[])}catch(e){}};a.useEffect(()=>{"true"===new URLSearchParams(window.location.search).get("test_walkthrough")&&We(!0)},[]);const Ve=a.useCallback(async()=>{if(s&&t&&c)try{const{data:e,error:s}=await x.from("profiles").select("park_management_walkthrough_completed").eq("id",t.id).single();if(s){if(!s.message.includes("column")||!s.message.includes("does not exist"))throw s}else if(e?.park_management_walkthrough_completed)return;"approved"===c.status&&We(!0)}catch(e){}},[s,t,c]),Ze=a.useCallback(async()=>{if(s)try{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1),a=new Date(e.getFullYear(),e.getMonth()+1,1),{data:i,error:r}=await x.from("reservations").select("*").eq("park_id",s).gte("created_at",t.toISOString()).lt("created_at",a.toISOString());if(r)throw r;const l=i||[],n=l.length,c=l.reduce((e,s)=>e+(s.total_amount||0),0),o=l.reduce((e,s)=>e+(s.guest_count||0),0),d=l.filter(e=>String(e.reservation_type||"").toLowerCase().includes("day")).reduce((e,s)=>({count:e.count+(s.guest_count||1),amount:e.amount+(s.total_amount||0)}),{count:0,amount:0}),m=l.filter(e=>["whole_facility","private","rental"].includes(String(e.reservation_type||"").toLowerCase())).reduce((e,s)=>({count:e.count+1,amount:e.amount+(s.total_amount||0)}),{count:0,amount:0}),u=l.filter(e=>"subscription"===String(e.reservation_type||"").toLowerCase()).reduce((e,s)=>({count:e.count+1,amount:e.amount+(s.total_amount||0)}),{count:0,amount:0});Ke({reservations:n,revenue:c,users:o,breakdown:{daypass:d,whole:m,subscription:u}})}catch(e){Ke({reservations:0,revenue:0,users:0,breakdown:{daypass:{count:0,amount:0},whole:{count:0,amount:0},subscription:{count:0,amount:0}}})}},[s]),es=a.useCallback(async()=>{if(s)try{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1),a=new Date(e.getFullYear(),e.getMonth()+1,1),{data:i,error:r}=await x.from("reservations").select("created_at, guest_count").eq("park_id",s).gte("created_at",t.toISOString()).lt("created_at",a.toISOString());if(r)throw r;const l=new Date(e.getFullYear(),e.getMonth()+1,0).getDate(),n={};for(let s=1;s<=l;s++){const t=new Date(e.getFullYear(),e.getMonth(),s).toISOString().slice(0,10);n[t]={reservations:0,users:0}}(i||[]).forEach(e=>{const s=new Date(e.created_at).toISOString().slice(0,10);n[s]&&(n[s].reservations+=1,n[s].users+=Number(e.guest_count||0))});const c=Object.entries(n).map(([e,s])=>({date:e,reservations:s.reservations,users:s.users}));Je(c)}catch(e){Je([])}},[s]),ss=a.useCallback(async()=>{if(t)try{await x.from("profiles").update({park_management_walkthrough_completed:!0}).eq("id",t.id),We(!1)}catch(e){}},[t]),ts=a.useCallback(e=>{"location"===e?I("location"):"pins"===e&&I("pins")},[]);a.useEffect(()=>{s&&t&&as()},[s,t]),a.useEffect(()=>{c&&(is(),Qe())},[c]),a.useEffect(()=>{Ve()},[s,t,c]),a.useEffect(()=>{"stats"===S&&(Ze(),es())},[S,Ze,es]);const as=async()=>{if(s&&t)try{b(!0),N("");const{data:e,error:a}=await x.from("dog_parks").select("*").eq("id",s).eq("owner_id",t?.id).single();if(a)throw new Error("ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");o(e),Se({max_capacity:e.max_capacity||0,facilities:{parking:e.facilities?.parking||!1,shower:e.facilities?.shower||!1,restroom:e.facilities?.restroom||!1,agility:e.facilities?.agility||!1,rest_area:e.facilities?.rest_area||!1,water_station:e.facilities?.water_station||!1},large_dog_area:e.large_dog_area||!1,small_dog_area:e.small_dog_area||!1,private_booths:e.private_booths||!1,private_booth_count:e.private_booth_count||0,facility_details:e.facility_details||"",description:e.description||"",address:e.address||"",latitude:e.latitude||null,longitude:e.longitude||null,geofence_radius_km:e.geofence_radius_km??1,is_public:e.is_public||!1});const{data:i,error:r}=await x.from("smart_locks").select("*").eq("park_id",s);!r&&i&&(z(i),i.length>0&&G(i[0]))}catch(e){N(e.message||"ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{b(!1)}},is=async()=>{if(c)try{const{data:e,error:s}=await x.from("dog_park_facility_images").select("*").eq("park_id",c.id);if(s&&"PGRST116"!==s.code)return;const t=Object.entries(ie).filter(([,e])=>{if(e.required)return!0;if(e.conditionalOn&&c){const s=e.conditionalOn.split(".");if(1===s.length)return c[s[0]]??!1;if(2===s.length){const e=c[s[0]];if(e&&"object"==typeof e)return e[s[1]]??!1}}return!1}).map(([e])=>e).map(s=>{const t=(e||[]).find(e=>e.image_type===s);return{id:t?.id,image_type:s,image_url:t?.image_url,is_approved:t?.is_approved??null,admin_notes:t?.admin_notes}});Ie(t)}catch(e){}},rs=(e,s)=>{Ae(e),Fe(s.name),He({image_type:e,file:s}),qe(!0)};return p?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):c?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-4",children:e.jsxs(l,{to:"/my-parks-management",className:"flex items-center text-blue-600 hover:text-blue-800",children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"ç®¡ç†ä¸­ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ä¸€è¦§ã«æˆ»ã‚‹"]})})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[p&&e.jsx("div",{className:"flex justify-center items-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),!p&&c&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white rounded-lg border p-6 mb-6",children:e.jsx("div",{className:"flex justify-between items-start mb-4",children:e.jsxs("div",{className:"w-full",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:c.name}),e.jsx("p",{className:"text-gray-600 mt-1",children:c.address}),e.jsx(l,{to:`/parks/${c.id}`,children:e.jsxs(n,{variant:"secondary",className:"w-full mt-3",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"å…¬é–‹ãƒšãƒ¼ã‚¸"]})}),e.jsxs("div",{className:"flex items-center mt-2",children:[e.jsx(R,{className:"w-4 h-4 text-yellow-400 fill-current mr-1"}),e.jsx("span",{className:"text-sm font-medium",children:c.average_rating.toFixed(1)}),e.jsxs("span",{className:"text-sm text-gray-500 ml-1",children:["(",c.review_count,"ä»¶)"]})]})]})})}),y&&e.jsxs("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4 flex items-start",children:[e.jsx(v,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsx("p",{children:y})]}),w&&e.jsxs("div",{className:"bg-green-100 border border-green-300 text-green-800 rounded-lg p-4 flex items-start",children:[e.jsx(j,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsx("p",{children:w})]}),e.jsx(m,{className:"mb-6 p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{className:"flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-colors "+("overview"===S?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"),onClick:()=>I("overview"),children:[e.jsx(O,{className:"w-4 h-4 mr-1.5"}),e.jsx("span",{className:"whitespace-nowrap",children:"æ¦‚è¦"})]}),e.jsxs("button",{className:"flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-colors "+("stats"===S?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"),onClick:()=>I("stats"),children:[e.jsx(R,{className:"w-4 h-4 mr-1.5"}),e.jsx("span",{className:"whitespace-nowrap",children:"çµ±è¨ˆ"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{className:"flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-colors "+("settings"===S?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"),onClick:()=>I("settings"),children:[e.jsx(A,{className:"w-4 h-4 mr-1.5"}),e.jsx("span",{className:"whitespace-nowrap",children:"è¨­å®š"})]}),e.jsxs("button",{className:"flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-colors "+("location"===S?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"),onClick:()=>I("location"),"data-walkthrough":"location-tab",children:[e.jsx(P,{className:"w-4 h-4 mr-1.5"}),e.jsx("span",{className:"whitespace-nowrap",children:"ä½ç½®"})]})]})]})}),"overview"===S&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(m,{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[e.jsx(D,{className:"w-6 h-6 text-blue-600 mr-2"}),"åŸºæœ¬æƒ…å ±"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"æ–½è¨­æƒ…å ±"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"ä½æ‰€:"})," ",c.address]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:"})," ","approved"===c.status?"é‹å–¶ä¸­":"å¯©æŸ»ä¸­"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"æ–™é‡‘:"})," Â¥",c.price||"800","/æ—¥"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"æœ€å¤§åå®¹äººæ•°:"})," ",c.max_capacity||"æœªè¨­å®š","äºº"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"ç¾åœ¨ã®åˆ©ç”¨è€…æ•°:"})," ",c.current_occupancy||0,"äºº"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"è©•ä¾¡:"})," â˜…",c.average_rating?.toFixed(1)||"0.0"," (",c.review_count||0,"ä»¶)"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"è¨­å‚™æƒ…å ±"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries({parking:"é§è»Šå ´",shower:"ã‚·ãƒ£ãƒ¯ãƒ¼è¨­å‚™",restroom:"ãƒˆã‚¤ãƒ¬",agility:"ã‚¢ã‚¸ãƒªãƒ†ã‚£è¨­å‚™",rest_area:"ä¼‘æ†©ã‚¹ãƒšãƒ¼ã‚¹",water_station:"çµ¦æ°´è¨­å‚™"}).map(([s,t])=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 rounded "+(c.facilities?.[s]?"bg-green-500":"bg-gray-300")}),e.jsx("span",{className:"text-sm",children:t})]},s))}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"å¤§å‹çŠ¬ã‚¨ãƒªã‚¢:"})," ",c.large_dog_area?"ã‚ã‚Š":"ãªã—"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"å°å‹çŠ¬ã‚¨ãƒªã‚¢:"})," ",c.small_dog_area?"ã‚ã‚Š":"ãªã—"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ–ãƒ¼ã‚¹:"})," ",c.private_booths?`${c.private_booth_count||1}å®¤`:"ãªã—"]})]})]})]})]}),"approved"===c?.status&&e.jsxs(m,{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[e.jsx(M,{className:"w-6 h-6 text-blue-600 mr-2"}),"å…¬é–‹è¨­å®š"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ä¸€è¦§ã«è¡¨ç¤º"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:ke.is_public?"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ä¸€è¦§ã‚„ãƒãƒƒãƒ—ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚åˆ©ç”¨è€…ãŒæ¤œç´¢ãƒ»äºˆç´„ã§ãã¾ã™ã€‚":"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ä¸€è¦§ã«è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚ç›´æ¥URLã‚’çŸ¥ã‚‹äººã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™ã€‚"})]}),e.jsx("div",{className:"ml-4",children:e.jsx("button",{type:"button",disabled:be,onClick:()=>(async e=>{if(s&&t)try{je(!0),N("");const{error:a}=await x.from("dog_parks").update({is_public:e,updated_at:(new Date).toISOString()}).eq("id",s).eq("owner_id",t?.id);if(a)throw a;Se(s=>({...s,is_public:e})),o(s=>s?{...s,is_public:e}:null),_(e?"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã‚’å…¬é–‹ã—ã¾ã—ãŸ":"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã‚’éå…¬é–‹ã«ã—ã¾ã—ãŸ"),setTimeout(()=>_(""),3e3)}catch(a){N("å…¬é–‹è¨­å®šã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: "+a.message)}finally{je(!1)}})(!ke.is_public),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 ${ke.is_public?"bg-blue-600":"bg-gray-200"} ${be?"opacity-50 cursor-not-allowed":""}`,children:e.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(ke.is_public?"translate-x-6":"translate-x-1")})})})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("div",{className:"w-3 h-3 rounded-full "+(ke.is_public?"bg-green-500":"bg-yellow-500")}),e.jsx("span",{className:"font-medium",children:ke.is_public?"å…¬é–‹ä¸­":"éå…¬é–‹"})]}),!ke.is_public&&e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(v,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-2"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"æ³¨æ„:"})," éå…¬é–‹è¨­å®šä¸­ã¯ã€ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ãŒä¸€è¦§ã«è¡¨ç¤ºã•ã‚Œãšã€æ–°ã—ã„åˆ©ç”¨è€…ã‹ã‚‰ã®äºˆç´„ã‚’å—ã‘ä»˜ã‘ã§ãã¾ã›ã‚“ã€‚"]})]})})]})]}),e.jsxs(m,{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[e.jsx(k,{className:"w-6 h-6 text-blue-600 mr-2"}),"ä»Šæ—¥ã®çµ±è¨ˆ"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(k,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-medium text-blue-900",children:"ä»Šæ—¥ã®äºˆç´„"})]}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:"5ä»¶"}),e.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"å‰æ—¥æ¯” +2ä»¶"})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(L,{className:"w-5 h-5 text-green-600"}),e.jsx("h4",{className:"font-medium text-green-900",children:"ä»Šæ—¥ã®åç›Š"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:"Â¥4,000"}),e.jsx("p",{className:"text-xs text-green-700 mt-1",children:"å‰æ—¥æ¯” +Â¥1,600"})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(F,{className:"w-5 h-5 text-purple-600"}),e.jsx("h4",{className:"font-medium text-purple-900",children:"åˆ©ç”¨è€…æ•°"})]}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:[c.current_occupancy,"äºº"]}),e.jsxs("p",{className:"text-xs text-purple-700 mt-1",children:["æœ€å¤§: ",c.max_capacity,"äºº"]})]})]})]}),e.jsxs(m,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[e.jsx(Y,{className:"w-6 h-6 text-blue-600 mr-2"}),"ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ç®¡ç†"]}),e.jsxs(n,{onClick:()=>se(!0),className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹äºˆå®šã‚’è¿½åŠ "]})]}),V.length>0?e.jsx("div",{className:"space-y-4",children:V.map(a=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:a.title}),e.jsxs("div",{className:"flex items-center space-x-2",children:[a.is_emergency&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[e.jsx(v,{className:"w-3 h-3 mr-1"}),"ç·Šæ€¥"]}),e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium "+("scheduled"===a.status?"bg-blue-100 text-blue-800":"active"===a.status?"bg-green-100 text-green-800":"completed"===a.status?"bg-gray-100 text-gray-800":"bg-red-100 text-red-800"),children:"scheduled"===a.status?"äºˆå®š":"active"===a.status?"å®Ÿè¡Œä¸­":"completed"===a.status?"å®Œäº†":"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"})]})]}),a.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:a.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"é–‹å§‹:"}),e.jsx("span",{className:"ml-2 text-gray-600",children:le(a.start_date).replace("T"," ")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"çµ‚äº†:"}),e.jsx("span",{className:"ml-2 text-gray-600",children:le(a.end_date).replace("T"," ")})]})]}),a.notify_users&&e.jsxs("div",{className:"mt-2 flex items-center text-xs text-blue-600",children:[e.jsx(j,{className:"w-3 h-3 mr-1"}),"ãƒ¦ãƒ¼ã‚¶ãƒ¼é€šçŸ¥æœ‰åŠ¹"]}),e.jsxs("div",{className:"mt-4 flex justify-end space-x-2",children:[e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>{return ce(e=a),de({title:e.title,description:e.description||"",start_date:le(e.start_date),end_date:le(e.end_date),is_emergency:e.is_emergency,notify_users:e.notify_users||!0}),void se(!0);var e},className:"text-blue-600 border-blue-600 hover:bg-blue-50",disabled:me,children:[e.jsx(H,{className:"w-4 h-4 mr-1"}),"ç·¨é›†"]}),e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>(async e=>{if(s&&t&&window.confirm("ã“ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹äºˆå®šã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚"))try{xe(!0),N("");const{error:t}=await x.from("maintenance_schedules").delete().eq("id",e).eq("dog_park_id",s);if(t)throw t;_("ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹äºˆå®šã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚"),setTimeout(()=>_(""),3e3),await Qe()}catch(a){N("ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹äºˆå®šã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚"),setTimeout(()=>N(""),5e3)}finally{xe(!1)}})(a.id),className:"text-red-600 border-red-600 hover:bg-red-50",disabled:me,children:[e.jsx(q,{className:"w-4 h-4 mr-1"}),"å‰Šé™¤"]})]})]},a.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Y,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹äºˆå®šãŒã‚ã‚Šã¾ã›ã‚“"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"æ–½è¨­ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹äºˆå®šã‚’è¿½åŠ ã—ã¦ãã ã•ã„"})]}),e.jsx("div",{className:"mt-6 p-4 bg-yellow-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(v,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ©Ÿèƒ½ã«ã¤ã„ã¦"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"â€¢ ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä¸­ã¯æ–°è¦äºˆç´„ã‚’å—ã‘ä»˜ã‘ã¾ã›ã‚“"}),e.jsx("li",{children:"â€¢ æ—¢å­˜ã®äºˆç´„ãŒã‚ã‚‹å ´åˆã¯äº‹å‰ã«åˆ©ç”¨è€…ã«é€£çµ¡ã—ã¦ãã ã•ã„"}),e.jsx("li",{children:"â€¢ ç·Šæ€¥ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®å ´åˆã¯å³åº§ã«æ–½è¨­ãŒåˆ©ç”¨åœæ­¢ã«ãªã‚Šã¾ã™"}),e.jsx("li",{children:"â€¢ ãƒ¦ãƒ¼ã‚¶ãƒ¼é€šçŸ¥ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ã€åˆ©ç”¨è€…ã«ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ãŒé€ä¿¡ã•ã‚Œã¾ã™"})]})]})]})})]})]}),"stats"===S&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(m,{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[e.jsx(R,{className:"w-6 h-6 text-blue-600 mr-2"}),"åˆ©ç”¨çµ±è¨ˆ"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(k,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-medium text-blue-900",children:"ä»Šæœˆã®äºˆç´„"})]}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[Xe.reservations,"ä»¶"]}),e.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"ä»Šæœˆ"})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(L,{className:"w-5 h-5 text-green-600"}),e.jsx("h4",{className:"font-medium text-green-900",children:"ä»Šæœˆã®åç›Š"})]}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["Â¥",Xe.revenue.toLocaleString()]}),e.jsx("p",{className:"text-xs text-green-700 mt-1",children:"ä»Šæœˆ"})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(F,{className:"w-5 h-5 text-purple-600"}),e.jsx("h4",{className:"font-medium text-purple-900",children:"åˆ©ç”¨è€…æ•°"})]}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:[Xe.users,"äºº"]}),e.jsx("p",{className:"text-xs text-purple-700 mt-1",children:"ä»Šæœˆ"})]})]}),e.jsx("div",{className:"h-64 bg-white rounded-lg border border-gray-200 p-3",children:0===Ge.length?e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-500 text-sm",children:"ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"}):e.jsxs("svg",{viewBox:"0 0 640 240",className:"w-full h-full",children:[e.jsx("line",{x1:"40",y1:"10",x2:"40",y2:"220",stroke:"#e5e7eb"}),e.jsx("line",{x1:"40",y1:"220",x2:"620",y2:"220",stroke:"#e5e7eb"}),(()=>{const s=Math.max(1,...Ge.map(e=>Math.max(e.reservations,e.users))),t=e=>40+e/Math.max(1,Ge.length-1)*580,a=e=>220-e/s*180,i=Ge.map((e,s)=>`${t(s)},${a(e.reservations)}`).join(" "),r=Ge.map((e,s)=>`${t(s)},${a(e.users)}`).join(" ");return e.jsxs(e.Fragment,{children:[e.jsx("polyline",{fill:"none",stroke:"#3b82f6",strokeWidth:"2",points:i}),Ge.map((s,i)=>e.jsx("circle",{cx:t(i),cy:a(s.reservations),r:"2",fill:"#3b82f6"},`r-${i}`)),e.jsx("polyline",{fill:"none",stroke:"#8b5cf6",strokeWidth:"2",points:r}),Ge.map((s,i)=>e.jsx("circle",{cx:t(i),cy:a(s.users),r:"2",fill:"#8b5cf6"},`u-${i}`)),Array.from({length:6},(t,i)=>{const r=Math.round(s/5*i),l=a(r);return e.jsxs("g",{children:[e.jsx("line",{x1:"40",y1:l,x2:"620",y2:l,stroke:"#f3f4f6"}),e.jsx("text",{x:"8",y:l+4,fontSize:"10",fill:"#6b7280",children:r})]},i)}),e.jsxs("g",{children:[e.jsx("rect",{x:"460",y:"16",width:"10",height:"10",fill:"#3b82f6"}),e.jsx("text",{x:"475",y:"25",fontSize:"12",fill:"#374151",children:"äºˆç´„ä»¶æ•°"}),e.jsx("rect",{x:"540",y:"16",width:"10",height:"10",fill:"#8b5cf6"}),e.jsx("text",{x:"555",y:"25",fontSize:"12",fill:"#374151",children:"åˆ©ç”¨è€…æ•°"})]})]})})()]})})]}),e.jsxs(m,{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[e.jsx(L,{className:"w-6 h-6 text-blue-600 mr-2"}),"åç›Šæƒ…å ±"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-3",children:"åç›Šé…åˆ†"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-800 mb-1",children:"åç›Šï¼ˆ80%ï¼‰"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["Â¥",Math.round(.8*Xe.revenue).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-800 mb-1",children:"ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ æ‰‹æ•°æ–™ï¼ˆ20%ï¼‰"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["Â¥",Math.round(.2*Xe.revenue).toLocaleString()]})]})]})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-green-900 mb-3",children:"åç›Šå†…è¨³"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-800 mb-1",children:"1Dayãƒ‘ã‚¹"}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["Â¥",Xe.breakdown.daypass.amount.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-green-700",children:[Xe.breakdown.daypass.count,"äºº"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-800 mb-1",children:"æ–½è¨­è²¸ã—åˆ‡ã‚Š"}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["Â¥",Xe.breakdown.whole.amount.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-green-700",children:[Xe.breakdown.whole.count,"ä»¶"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-800 mb-1",children:"ã‚µãƒ–ã‚¹ã‚¯"}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["Â¥",Xe.breakdown.subscription.amount.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-green-700",children:[Xe.breakdown.subscription.count,"äºº"]})]})]})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-purple-900 mb-3",children:"æŒ¯è¾¼æƒ…å ±"}),e.jsx("p",{className:"text-sm text-purple-800 mb-2",children:"æŒ¯è¾¼ã¯æ¯æœˆ15æ—¥ã«å‰æœˆåˆ†ã‚’ä¸€æ‹¬ã§è¡Œã„ã¾ã™ã€‚æŒ¯è¾¼æ‰‹æ•°æ–™ã¯å½“ç¤¾è² æ‹…ã§ã™ã€‚"}),e.jsx(l,{to:"/owner-payment-system",children:e.jsxs(n,{size:"sm",className:"bg-purple-600 hover:bg-purple-700",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"æŒ¯è¾¼æƒ…å ±ã‚’ç¢ºèª"]})})]})]})]})]}),"pins"===S&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(m,{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[e.jsx(f,{className:"w-6 h-6 text-blue-600 mr-2"}),"ã‚ªãƒ¼ãƒŠãƒ¼ç”¨PINã‚³ãƒ¼ãƒ‰ç™ºè¡Œ"]}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg mb-6",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(j,{className:"w-5 h-5 text-blue-600 mt-1 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"ã‚ªãƒ¼ãƒŠãƒ¼ç‰¹æ¨©"}),e.jsx("p",{children:"ã‚ªãƒ¼ãƒŠãƒ¼ã¯æ±ºæ¸ˆä¸è¦ã§PINã‚³ãƒ¼ãƒ‰ã‚’ç™ºè¡Œã§ãã¾ã™ã€‚æ–½è¨­ã®ç®¡ç†ã‚„ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã«ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"PINã‚³ãƒ¼ãƒ‰ã¯5åˆ†é–“æœ‰åŠ¹ã§ã™"}),e.jsx("li",{children:"å…¥å ´ãƒ»é€€å ´ãã‚Œãã‚Œã§PINã‚³ãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™"}),e.jsx("li",{children:"ã‚¹ã‚¿ãƒƒãƒ•ã¨å…±æœ‰ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™"}),e.jsx("li",{children:"ç®¡ç†ç”¨é€”ãªã®ã§æ±ºæ¸ˆã¯ä¸è¦ã§ã™"})]})]})]})}),e.jsxs("div",{className:"flex justify-center space-x-4 mb-4",children:[e.jsxs("button",{className:"px-6 py-3 rounded-lg flex items-center space-x-2 "+("entry"===J?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),onClick:()=>Q("entry"),children:[e.jsx($,{className:"w-5 h-5"}),e.jsx("span",{children:"å…¥å ´"})]}),e.jsxs("button",{className:"px-6 py-3 rounded-lg flex items-center space-x-2 "+("exit"===J?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),onClick:()=>Q("exit"),children:[e.jsx($,{className:"w-5 h-5 rotate-180"}),e.jsx("span",{children:"é€€å ´"})]})]}),T.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ã‚¹ãƒãƒ¼ãƒˆãƒ­ãƒƒã‚¯ã‚’é¸æŠ"}),e.jsx("select",{value:E?.id||"",onChange:e=>{const s=T.find(s=>s.id===e.target.value);G(s||null)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:T.map(s=>e.jsx("option",{value:s.id,children:s.lock_name},s.id))})]}),E?e.jsx("div",{className:"mt-6",children:e.jsx(te,{lockId:E.lock_id,parkName:c.name,purpose:J,onSuccess:e=>{_(`PINã‚³ãƒ¼ãƒ‰ã€Œ${e}ã€ã‚’ç™ºè¡Œã—ã¾ã—ãŸã€‚æœ‰åŠ¹æœŸé™ã¯5åˆ†é–“ã§ã™ã€‚`),setTimeout(()=>_(""),5e3)},onError:e=>{N(e),setTimeout(()=>N(""),5e3)}})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(f,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"ã‚¹ãƒãƒ¼ãƒˆãƒ­ãƒƒã‚¯ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"PINã‚³ãƒ¼ãƒ‰ã‚’ç™ºè¡Œã™ã‚‹ã«ã¯ã‚¹ãƒãƒ¼ãƒˆãƒ­ãƒƒã‚¯ã®ç™»éŒ²ãŒå¿…è¦ã§ã™"}),e.jsxs(n,{onClick:()=>I("locks"),"data-walkthrough":"setup-smartlock-button",className:"flex items-center gap-2 mx-auto",children:[e.jsx(B,{className:"w-4 h-4"}),"ã‚¹ãƒãƒ¼ãƒˆãƒ­ãƒƒã‚¯ã‚’è¨­å®šã™ã‚‹"]})]})]}),e.jsx(m,{className:"p-6 bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(f,{className:"w-6 h-6 text-blue-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"PINã‚³ãƒ¼ãƒ‰ã«ã¤ã„ã¦"}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-2",children:[e.jsx("p",{children:"â€¢ åˆ©ç”¨è€…ã¯PINã‚³ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¦å…¥é€€å ´ã—ã¾ã™"}),e.jsx("p",{children:"â€¢ PINã‚³ãƒ¼ãƒ‰ã¯5åˆ†é–“æœ‰åŠ¹ã§ã€åˆ©ç”¨è€…ãŒæ”¯æ‰•ã„å¾Œã«ç™ºè¡Œã•ã‚Œã¾ã™"}),e.jsx("p",{children:"â€¢ ã‚ªãƒ¼ãƒŠãƒ¼ã¯æ±ºæ¸ˆä¸è¦ã§PINã‚³ãƒ¼ãƒ‰ã‚’ç™ºè¡Œã§ãã¾ã™"}),e.jsx("p",{children:"â€¢ æ–½è¨­è²¸ã—åˆ‡ã‚Šã®å ´åˆã€åˆ©ç”¨è€…ã¯å‹é”ã«PINã‚³ãƒ¼ãƒ‰ã‚’å…±æœ‰ã§ãã¾ã™"})]})]})]})})]}),"locks"===S&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(m,{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"ã‚¹ãƒãƒ¼ãƒˆãƒ­ãƒƒã‚¯ç®¡ç†"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"ã“ã®ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã®ã‚¹ãƒãƒ¼ãƒˆãƒ­ãƒƒã‚¯ã‚’ç®¡ç†ã—ã¾ã™ã€‚Scienerç­‰ã®ã‚¹ãƒãƒ¼ãƒˆãƒ­ãƒƒã‚¯IDã‚’ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚"})]}),e.jsx(ae,{parkId:s,parkName:c.name})]}),e.jsx(m,{className:"p-6 bg-yellow-50 border-yellow-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(v,{className:"w-6 h-6 text-yellow-600 mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-yellow-900 mb-2",children:"é‡è¦ãªè¨­å®šé …ç›®"}),e.jsxs("div",{className:"text-sm text-yellow-800 space-y-2",children:[e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"ãƒ­ãƒƒã‚¯ID"}),": Scienerã¾ãŸã¯TTLockç­‰ã®APIã§æä¾›ã•ã‚Œã‚‹ã‚¹ãƒãƒ¼ãƒˆãƒ­ãƒƒã‚¯ã®ä¸€æ„ID"]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"ãƒ­ãƒƒã‚¯å"}),": åˆ©ç”¨è€…ã«è¡¨ç¤ºã•ã‚Œã‚‹åå‰ï¼ˆä¾‹ï¼šãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒˆã€å—å´å…¥å£ï¼‰"]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"æœ‰åŠ¹çŠ¶æ…‹"}),": ç„¡åŠ¹ã«ã™ã‚‹ã¨ã€ãã®ãƒ­ãƒƒã‚¯ã§ã¯PINã‚³ãƒ¼ãƒ‰ã‚’ç™ºè¡Œã§ãã¾ã›ã‚“"]}),e.jsx("p",{children:"â€¢ è¤‡æ•°ã®ã‚¹ãƒãƒ¼ãƒˆãƒ­ãƒƒã‚¯ã‚’ç™»éŒ²ã—ã¦ã€åˆ©ç”¨è€…ãŒé¸æŠã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™"})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-yellow-300",children:e.jsxs(n,{onClick:()=>I("pins"),variant:"secondary",className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-4 h-4"}),"PINã‚³ãƒ¼ãƒ‰ç®¡ç†ã«æˆ»ã‚‹"]})})]})]})})]}),"settings"===S&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(m,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(Y,{className:"w-5 h-5 text-blue-600 mr-2"}),"åŸºæœ¬è¨­å®š"]}),e.jsx("p",{className:"text-gray-600 mb-4",children:"æ–½è¨­ã®åŸºæœ¬æƒ…å ±ã‚„è¨­å‚™æƒ…å ±ã‚’ç·¨é›†ã§ãã¾ã™ã€‚ä½æ‰€ã¨æ–™é‡‘ã¯å¤‰æ›´ã§ãã¾ã›ã‚“ã€‚"}),e.jsx(l,{to:`/parks/${c.id}/edit`,children:e.jsxs(n,{children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"åŸºæœ¬æƒ…å ±ã‚’ç·¨é›†"]})})]}),e.jsxs(m,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(U,{className:"w-5 h-5 text-blue-600 mr-2"}),"æ–½è¨­ç”»åƒç®¡ç†"]}),e.jsx("p",{className:"text-gray-600 mb-6",children:"å„è¨­å‚™ã®ç”»åƒã‚’ç®¡ç†ã§ãã¾ã™ã€‚ç”»åƒã¯ã™ã¹ã¦1:1ã§ãƒˆãƒªãƒŸãƒ³ã‚°ã•ã‚Œã€æœ€é©åŒ–ã•ã‚Œã¾ã™ã€‚"}),y&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700",children:y}),w&&e.jsx("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-lg text-green-700",children:w}),e.jsx("div",{className:"space-y-6",children:Ce.map(s=>{const t=ie[s.image_type],a=t?.icon||O;return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-medium text-gray-900",children:t?.label||s.image_type})]}),!0===s.is_approved&&e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full",children:"æ‰¿èªæ¸ˆã¿"}),!1===s.is_approved&&e.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full",children:"å´ä¸‹"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:t?.description||"ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„"}),s.image_url?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"aspect-square w-48 bg-gray-100 rounded-lg overflow-hidden cursor-pointer",onClick:()=>Me(s.image_url||null),children:e.jsx("img",{src:s.image_url,alt:t?.label||s.image_type,className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://via.placeholder.com/400x400?text=Image+Not+Available"}})}),e.jsxs("div",{className:"absolute top-2 right-2 flex space-x-2",children:[e.jsx("button",{onClick:()=>Me(s.image_url||null),className:"p-1 bg-white rounded-full shadow hover:bg-gray-100",children:e.jsx(M,{className:"w-4 h-4 text-blue-600"})}),e.jsx("button",{onClick:()=>(async e=>{if(e)try{Pe(!0),N("");const{error:s}=await x.from("dog_park_facility_images").delete().eq("id",e);if(s)throw s;await is(),_("ç”»åƒã‚’å‰Šé™¤ã—ã¾ã—ãŸ"),setTimeout(()=>_(""),3e3)}catch(s){N("ç”»åƒã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ"),setTimeout(()=>N(""),3e3)}finally{Pe(!1)}})(s.id,s.image_type),className:"p-1 bg-white rounded-full shadow hover:bg-gray-100",disabled:Be,children:e.jsx(q,{className:"w-4 h-4 text-red-600"})})]})]}),!1===s.is_approved&&s.admin_notes&&e.jsxs("div",{className:"p-3 bg-red-50 rounded-lg text-sm text-red-800",children:[e.jsx("p",{className:"font-medium",children:"å´ä¸‹ç†ç”±:"}),e.jsx("p",{children:s.admin_notes})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"file",id:`replace-image-${s.image_type}`,accept:"image/*",className:"hidden",onChange:e=>{const t=e.target.files?.[0];t&&rs(s.image_type,t)}}),e.jsxs("label",{htmlFor:`replace-image-${s.image_type}`,className:"cursor-pointer inline-flex items-center px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"ç”»åƒã‚’å…¥ã‚Œæ›¿ãˆã‚‹"]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-500 transition-colors",children:[e.jsx("input",{type:"file",id:`upload-image-${s.image_type}`,accept:"image/*",className:"hidden",onChange:e=>{const t=e.target.files?.[0];t&&rs(s.image_type,t)}}),e.jsxs("label",{htmlFor:`upload-image-${s.image_type}`,className:"cursor-pointer flex flex-col items-center",children:[e.jsx(X,{className:"w-8 h-8 text-gray-400 mb-2"}),e.jsx("span",{className:"text-sm text-gray-600",children:"ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç”»åƒã‚’é¸æŠ"})]})]}),s.file&&e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-3 rounded",children:[e.jsx("span",{className:"text-sm truncate",children:s.file.name}),e.jsx(n,{size:"sm",onClick:()=>handleImageUpload(s.image_type),disabled:Be,children:Be?"ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...":"ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰"})]})]})]},s.image_type)})})]}),e.jsxs(m,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(L,{className:"w-5 h-5 text-blue-600 mr-2"}),"æ–™é‡‘è¨­å®š"]}),e.jsx("p",{className:"text-gray-600 mb-4",children:"æ–™é‡‘ä½“ç³»ã¯å…¨å›½çµ±ä¸€ã§ã™ã€‚å¤‰æ›´ã¯ã§ãã¾ã›ã‚“ã€‚"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-medium",children:"â€¢ é€šå¸¸åˆ©ç”¨:"}),e.jsx("span",{children:"Â¥800/æ—¥ (å›ºå®š)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-medium",children:"â€¢ æ–½è¨­è²¸ã—åˆ‡ã‚Š:"}),e.jsx("span",{children:"Â¥4,400/æ™‚é–“ (å›ºå®š)"})]})]})]})]}),e.jsx(m,{className:"p-6 bg-gray-50",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(D,{className:"w-6 h-6 text-gray-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"é‹å–¶ã‚µãƒãƒ¼ãƒˆ"}),e.jsxs("div",{className:"text-sm text-gray-700 space-y-1",children:[e.jsx("p",{children:"â€¢ è¨­å®šã«é–¢ã™ã‚‹ã”è³ªå•ã¯é‹å–¶äº‹å‹™å±€ã¾ã§ãŠå•ã„åˆã‚ã›ãã ã•ã„"}),e.jsx("p",{children:"â€¢ ã‚¹ãƒãƒ¼ãƒˆãƒ­ãƒƒã‚¯ã‚·ã‚¹ãƒ†ãƒ ã®è¨­ç½®ãƒ»è¨­å®šã‚µãƒãƒ¼ãƒˆã‚’æä¾›ã—ã¦ã„ã¾ã™"}),e.jsx("p",{children:"â€¢ é‹å–¶é–‹å§‹å¾Œã‚‚ç¶™ç¶šçš„ãªã‚µãƒãƒ¼ãƒˆã‚’è¡Œã„ã¾ã™"}),e.jsx("p",{children:"â€¢ ğŸ“§ ã‚µãƒãƒ¼ãƒˆçª“å£: info@dogparkjp.com"})]})]})]})})]}),"location"===S&&e.jsx("div",{className:"space-y-6",children:e.jsxs(m,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-6 flex items-center",children:[e.jsx(P,{className:"w-6 h-6 text-blue-600 mr-2"}),"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã®ä½ç½®èª¿æ•´"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-blue-800 text-sm",children:[e.jsx("strong",{children:"ä½ç½®èª¿æ•´ã«ã¤ã„ã¦:"}),e.jsx("br",{}),"ğŸ“ ",e.jsx("strong",{children:"ä½æ‰€ã§æ¤œç´¢"}),": ä½æ‰€ã‚’å…¥åŠ›ã—ã¦æ¤œç´¢ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€è‡ªå‹•çš„ã«ãƒãƒƒãƒ—ä¸Šã®ä½ç½®ãŒèª¿æ•´ã•ã‚Œã¾ã™ã€‚",e.jsx("br",{}),"ğŸ”´ ",e.jsx("strong",{children:"æ‰‹å‹•èª¿æ•´"}),": èµ¤ã„ãƒãƒ¼ã‚«ãƒ¼ã‚’ç›´æ¥ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã€ã‚ˆã‚Šæ­£ç¢ºãªä½ç½®ã«èª¿æ•´ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚",e.jsx("br",{}),"ğŸ’¾ ãƒãƒ¼ã‚«ãƒ¼ã‚’èª¿æ•´ã—ãŸå¾Œã€ã€Œä½ç½®ã‚’ä¿å­˜ã€ãƒœã‚¿ãƒ³ã§åº§æ¨™ã‚’ä¿å­˜ã—ã¦ãã ã•ã„ã€‚"]})}),c&&e.jsx("div",{"data-walkthrough":"location-map",children:e.jsx(h,{initialAddress:ke.address,initialLatitude:ke.latitude||void 0,initialLongitude:ke.longitude||void 0,onLocationChange:(e,s,t)=>{Se(t=>({...t,latitude:e,longitude:s}))}})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(n,{type:"button","data-walkthrough":"save-location-button",onClick:async()=>{if(c&&ke.latitude&&ke.longitude)try{ge(!0),N("");const e={latitude:ke.latitude,longitude:ke.longitude,updated_at:(new Date).toISOString()};let s=null;s=(await x.from("dog_parks").update({...e,geofence_radius_km:ke.geofence_radius_km,location_locked:!0}).eq("id",c.id)).error;if(s){const t=String(s?.message||s);if(!(t.includes("geofence_radius_km")||t.includes("location_locked")||t.includes("schema")))throw s;{const s=await x.from("dog_parks").update(e).eq("id",c.id);if(s.error)throw s.error}}window.__PARK_LOCATION_LOCKED__=!0,_("ä½ç½®æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚ä»¥å¾Œã¯ã“ã®åº§æ¨™ã‚’åŸºæº–ã«å›ºå®šã—ã¾ã™ã€‚"),await as(),setTimeout(()=>{_("")},3e3)}catch(e){const s=e instanceof Error?e.message:"object"==typeof e&&null!==e&&"message"in e?String(e.message):"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ";N(`ä½ç½®æƒ…å ±ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: ${s}`)}finally{ge(!1)}},disabled:pe||!ke.latitude||!ke.longitude,className:"min-w-[120px]",children:pe?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"ä¿å­˜ä¸­..."]}):"ä½ç½®ã‚’ä¿å­˜"})})]})]})})]}),Te&&Ye?.file&&e.jsx(u,{imageFile:Ye.file,onCropComplete:async e=>{if(s&&Re)try{Pe(!0),qe(!1),N("");const t=(Le||"image").replace(/[^a-zA-Z0-9_\-.]/g,"_"),a=`${Re}_${Date.now()}_${t.replace(/\.[^.]+$/,"")}.webp`,i=`${s}/${a}`,r=await async function(e,s=1200,t=.9){const a=await createImageBitmap(e),i=a.width,r=a.height,l=Math.max(i,r),n=Math.min(1,s/l),c=Math.max(1,Math.round(i*n)),o=Math.max(1,Math.round(r*n)),d=document.createElement("canvas");d.width=c,d.height=o;const m=d.getContext("2d");if(!m)throw new Error("CanvasãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“");return m.drawImage(a,0,0,c,o),new Promise((e,s)=>{d.toBlob(t=>{t?e(t):s(new Error("WebPå¤‰æ›ã«å¤±æ•—ã—ã¾ã—ãŸ"))},"image/webp",t)})}(e,1200,.9),{error:l}=await x.storage.from("dog-park-images").upload(i,r,{upsert:!0,contentType:"image/webp"});if(l)throw l;const{data:n}=x.storage.from("dog-park-images").getPublicUrl(i),c=n?.publicUrl||"",{data:o,error:d}=await x.from("dog_park_facility_images").select("id").eq("park_id",s).eq("image_type",Re).single();if(d&&"PGRST116"!==d.code)throw d;let m;if(o){const{error:e}=await x.from("dog_park_facility_images").update({image_url:c,is_approved:null,updated_at:(new Date).toISOString()}).eq("id",o.id);m=e}else{const{error:e}=await x.from("dog_park_facility_images").insert({park_id:s,image_type:Re,image_url:c,is_approved:null});m=e}if(m)throw m;await is(),_("ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ"),setTimeout(()=>_(""),3e3),Ae(""),Fe(""),He(null)}catch(t){N("ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ"),setTimeout(()=>N(""),3e3)}finally{Pe(!1)}},onCancel:()=>{qe(!1),Ae(""),Fe(""),He(null)},aspectRatio:1,maxWidth:400,maxHeight:400}),$e&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"relative max-w-4xl w-full",children:[e.jsx("button",{onClick:()=>Me(null),className:"absolute top-4 right-4 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-75 z-10",children:e.jsx(g,{className:"w-6 h-6"})}),e.jsx("div",{className:"flex items-center justify-center h-[80vh]",children:e.jsx("img",{src:$e,alt:"ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼",className:"max-h-full max-w-full object-contain"})})]})}),ee&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold",children:ne?"ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹äºˆå®šã‚’ç·¨é›†":"ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹äºˆå®šã‚’è¿½åŠ "}),e.jsx("button",{onClick:()=>{se(!1),ce(null),de({title:"",description:"",start_date:"",end_date:"",is_emergency:!1,notify_users:!0})},className:"text-gray-500 hover:text-gray-700 p-1 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(g,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:ne?async e=>{if(e.preventDefault(),s&&t&&ne)try{xe(!0),N("");const e=new Date(oe.start_date);if(new Date(oe.end_date)<=e)return void N("çµ‚äº†æ—¥æ™‚ã¯é–‹å§‹æ—¥æ™‚ã‚ˆã‚Šå¾Œã«è¨­å®šã—ã¦ãã ã•ã„ã€‚");const t=re(oe.start_date),a=re(oe.end_date);if(!t||!a)return void N("æ—¥æ™‚ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚");const{error:i}=await x.from("maintenance_schedules").update({title:oe.title,description:oe.description||null,start_date:t,end_date:a,is_emergency:oe.is_emergency,notify_users:oe.notify_users}).eq("id",ne.id).eq("dog_park_id",s);if(i)throw i;de({title:"",description:"",start_date:"",end_date:"",is_emergency:!1,notify_users:!0}),se(!1),ce(null),_("ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹äºˆå®šã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚"),setTimeout(()=>_(""),3e3),await Qe()}catch(a){N("ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹äºˆå®šã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸã€‚"),setTimeout(()=>N(""),5e3)}finally{xe(!1)}}:async e=>{if(e.preventDefault(),s&&t)try{xe(!0),N("");const e=new Date(oe.start_date);if(new Date(oe.end_date)<=e)return void N("çµ‚äº†æ—¥æ™‚ã¯é–‹å§‹æ—¥æ™‚ã‚ˆã‚Šå¾Œã«è¨­å®šã—ã¦ãã ã•ã„ã€‚");const t=re(oe.start_date),a=re(oe.end_date);if(!t||!a)return void N("æ—¥æ™‚ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚");const{error:i}=await x.from("maintenance_schedules").insert({dog_park_id:s,title:oe.title,description:oe.description||null,start_date:t,end_date:a,status:"scheduled",is_emergency:oe.is_emergency,notify_users:oe.notify_users});if(i)throw i;de({title:"",description:"",start_date:"",end_date:"",is_emergency:!1,notify_users:!0}),se(!1),_("ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹äºˆå®šã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚"),setTimeout(()=>_(""),3e3),await Qe()}catch(a){N("ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹äºˆå®šã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸã€‚"),setTimeout(()=>N(""),5e3)}finally{xe(!1)}},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:oe.title,onChange:e=>de(s=>({...s,title:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"ä¾‹: è¨­å‚™ç‚¹æ¤œã€æ¸…æƒä½œæ¥­",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"è©³ç´°èª¬æ˜"}),e.jsx("textarea",{value:oe.description,onChange:e=>de(s=>({...s,description:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3,placeholder:"ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å†…å®¹ã®è©³ç´°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["é–‹å§‹æ—¥æ™‚ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"datetime-local",value:oe.start_date,onChange:e=>de(s=>({...s,start_date:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["çµ‚äº†æ—¥æ™‚ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"datetime-local",value:oe.end_date,onChange:e=>de(s=>({...s,end_date:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"is_emergency",checked:oe.is_emergency,onChange:e=>de(s=>({...s,is_emergency:e.target.checked})),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"is_emergency",className:"ml-2 block text-sm text-gray-700",children:"ç·Šæ€¥ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ï¼ˆå³åº§ã«æ–½è¨­åˆ©ç”¨ã‚’åœæ­¢ï¼‰"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"notify_users",checked:oe.notify_users,onChange:e=>de(s=>({...s,notify_users:e.target.checked})),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"notify_users",className:"ml-2 block text-sm text-gray-700",children:"åˆ©ç”¨è€…ã«ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã‚’é€ä¿¡"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(n,{type:"button",variant:"secondary",onClick:()=>se(!1),children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),e.jsx(n,{type:"submit",disabled:me,className:"bg-blue-600 hover:bg-blue-700",children:me?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),ne?"æ›´æ–°ä¸­...":"è¿½åŠ ä¸­..."]}):ne?"ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹äºˆå®šã‚’æ›´æ–°":"ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹äºˆå®šã‚’è¿½åŠ "})]})]})]})})}),Ue&&e.jsx(K,{onComplete:ss,onClose:()=>We(!1),onStepChange:ts})]}):e.jsxs("div",{className:"max-w-4xl mx-auto text-center py-12",children:[e.jsx(v,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"æŒ‡å®šã•ã‚ŒãŸãƒ‰ãƒƒã‚°ãƒ©ãƒ³ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‹ã€ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚"}),e.jsx(l,{to:"/owner-dashboard",children:e.jsx(n,{children:"ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚‹"})})]})}export{ne as ParkManagement};

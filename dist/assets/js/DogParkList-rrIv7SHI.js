import{j as e}from"./motion-CuO0nkIV.js";import{r as t}from"./react-vendor-cniURDpR.js";import{L as s}from"./router-9ZtQ8-Nn.js";import{B as a}from"./Button-DPH1lBob.js";import{g as n,s as i,M as r,N as l,t as o,U as c,u as d,v as m,w as x,r as h,f as g,x as p,H as u,i as f,y as b,z as y,G as j,o as w,R as v}from"./ui-basic-y2lB0SIY.js";import{u as N,s as _}from"./index-DRdQ3V_A.js";import{C as k}from"./Card-roTxPFVC.js";import"./supabase-hyP6cfTu.js";import"./heavy-features-BIdEME4r.js";const C=e=>e<1?`${Math.round(1e3*e)}m`:`${e.toFixed(1)}km`;function M({park:t,userLocation:m,distance:x}){const h=x||(m&&t.latitude&&t.longitude?((e,t,s,a)=>{const n=(s-e)*Math.PI/180,i=(a-t)*Math.PI/180,r=Math.sin(n/2)*Math.sin(n/2)+Math.cos(e*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(i/2)*Math.sin(i/2);return 2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))*6371})(m.lat,m.lng,Number(t.latitude),Number(t.longitude)):null),g=(()=>{if(!t.current_occupancy||!t.max_capacity)return{label:"情報なし",color:"text-gray-500",bgColor:"bg-gray-100"};const e=t.current_occupancy/t.max_capacity*100;return e>=90?{label:"満員",color:"text-red-600",bgColor:"bg-red-100"}:e>=70?{label:"混雑",color:"text-orange-600",bgColor:"bg-orange-100"}:e>=40?{label:"普通",color:"text-yellow-600",bgColor:"bg-yellow-100"}:{label:"空いている",color:"text-green-600",bgColor:"bg-green-100"}})();return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:[t.image_url&&e.jsxs("div",{className:"aspect-video relative overflow-hidden rounded-t-lg",children:[e.jsx("img",{src:t.image_url,alt:t.name,className:"w-full h-full object-cover"}),e.jsx("button",{className:"absolute top-3 right-3 p-2 bg-white/80 backdrop-blur-sm rounded-full hover:bg-white transition-colors",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:e.jsx(n,{className:"w-4 h-4 text-gray-600 hover:text-red-500"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-900 flex-1",children:t.name}),e.jsx("div",{className:"flex items-center space-x-2 ml-2",children:e.jsxs("span",{className:"flex items-center text-green-600 text-sm",children:[e.jsx(i,{className:"w-4 h-4 mr-1"}),"営業中"]})})]}),e.jsxs("div",{className:"space-y-2 mb-2",children:[t.address&&e.jsxs("div",{className:"flex items-center text-gray-600 text-sm",children:[e.jsx(r,{className:"w-4 h-4 mr-1 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:t.address})]}),h&&e.jsxs("div",{className:"flex items-center text-blue-600 text-sm font-medium",children:[e.jsx(l,{className:"w-4 h-4 mr-1"}),e.jsxs("span",{children:["現在地から ",C(h)]})]})]}),t.price&&e.jsxs("div",{className:"flex items-center text-gray-600 text-sm mb-3",children:[e.jsx(o,{className:"w-4 h-4 mr-1"}),e.jsxs("span",{children:["¥",t.price,"/時間"]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(c,{className:"w-4 h-4 mr-1 text-gray-600"}),e.jsx("span",{className:"text-sm text-gray-600",children:"混雑状況:"})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${g.color} ${g.bgColor}`,children:g.label})]}),void 0!==t.current_occupancy&&t.max_capacity&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-1",children:[e.jsx("span",{children:"現在の利用者"}),e.jsxs("span",{children:[t.current_occupancy," / ",t.max_capacity,"名"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"h-2 rounded-full transition-all duration-300 "+(t.current_occupancy/t.max_capacity>=.9?"bg-red-500":t.current_occupancy/t.max_capacity>=.7?"bg-orange-500":t.current_occupancy/t.max_capacity>=.4?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(t.current_occupancy/t.max_capacity*100,100)}%`}})})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(s,{to:`/parks/${t.id}`,className:"flex-1",children:e.jsxs(a,{variant:"outline",className:"w-full flex items-center justify-center",children:[e.jsx(d,{className:"w-4 h-4 mr-1"}),"詳細を見る"]})}),t.current_occupancy<t.max_capacity&&e.jsx(s,{to:`/reservation/${t.id}`,className:"flex-1",children:e.jsx(a,{className:"w-full",children:"予約する"})})]})]})]})}function S({icon:t,title:s,description:n,action:i,className:r=""}){return e.jsxs("div",{className:`flex flex-col items-center justify-center py-12 px-4 text-center ${r}`,children:[e.jsx("div",{className:"mb-4 text-gray-400",children:t||e.jsx(m,{className:"w-16 h-16"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:s}),n&&e.jsx("p",{className:"text-gray-600 max-w-md mb-6",children:n}),i&&e.jsx(a,{onClick:i.onClick,variant:"outline",children:i.label})]})}const $={veterinary_clinic:{icon:y,label:"動物病院",color:"text-red-600"},pet_friendly_restaurant:{icon:b,label:"ペット同伴レストラン",color:"text-orange-600"},pet_shop:{icon:f,label:"ペットショップ",color:"text-blue-600"},pet_friendly_hotel:{icon:u,label:"ペット同伴宿泊",color:"text-green-600"},pet_salon:{icon:g,label:"ペットサロン",color:"text-purple-600"},pet_hotel:{icon:p,label:"ペットホテル",color:"text-indigo-600"},other:{icon:g,label:"その他",color:"text-gray-600"}};function I({facility:t,showDistance:i,distance:o}){const c=(m=t.category)&&m in $?$[m]:$.other;var m;const g=c.icon,p=(()=>{const e=new Date,s=100*e.getHours()+e.getMinutes();if(t.opening_hours&&t.closing_hours){const e=parseInt(t.opening_hours.replace(":",""),10),a=parseInt(t.closing_hours.replace(":",""),10);return s>=e&&s<=a}return!0})();return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:[t.image_url&&e.jsxs("div",{className:"aspect-video relative overflow-hidden rounded-t-lg",children:[e.jsx("img",{src:t.image_url,alt:t.name,className:"w-full h-full object-cover",loading:"lazy"}),e.jsx("button",{className:"absolute top-3 right-3 p-2 bg-white/80 backdrop-blur-sm rounded-full hover:bg-white transition-colors",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:e.jsx(n,{className:"w-4 h-4 text-gray-600 hover:text-red-500"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{className:`w-5 h-5 ${c.color}`}),e.jsx("span",{className:"text-sm text-gray-600",children:c.label})]}),p?e.jsx("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full",children:"営業中"}):e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full",children:"営業時間外"})]}),e.jsx("h3",{className:"font-semibold text-lg text-gray-900 mb-2 line-clamp-2",children:t.name}),t.rating&&e.jsx("div",{className:"mb-2",children:(f=t.rating,f?e.jsxs("div",{className:"flex items-center space-x-1",children:[[1,2,3,4,5].map(t=>e.jsx(j,{className:"w-4 h-4 "+(t<=f?"text-yellow-400 fill-current":"text-gray-300")},t)),e.jsxs("span",{className:"text-sm text-gray-600 ml-1",children:["(",f,")"]})]}):null)}),t.address&&e.jsxs("div",{className:"flex items-start text-gray-600 text-sm mb-2",children:[e.jsx(r,{className:"w-4 h-4 mr-1 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"line-clamp-2",children:t.address})]}),i&&o&&e.jsxs("div",{className:"flex items-center text-gray-600 text-sm mb-2",children:[e.jsx(l,{className:"w-4 h-4 mr-1"}),e.jsxs("span",{children:["現在地から ",(u=o,u?u<1?`${Math.round(1e3*u)}m`:`${u.toFixed(1)}km`:"")]})]}),t.opening_hours&&t.closing_hours&&e.jsxs("div",{className:"flex items-center text-gray-600 text-sm mb-2",children:[e.jsx(x,{className:"w-4 h-4 mr-1"}),e.jsxs("span",{children:[t.opening_hours," - ",t.closing_hours]})]}),t.phone&&e.jsxs("div",{className:"flex items-center text-gray-600 text-sm mb-3",children:[e.jsx(h,{className:"w-4 h-4 mr-1"}),e.jsx("a",{href:`tel:${t.phone}`,className:"hover:text-blue-600 transition-colors",onClick:e=>e.stopPropagation(),children:t.phone})]}),t.description&&e.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-2",children:t.description}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(s,{to:`/facilities/${t.id}`,className:"flex-1",children:e.jsxs(a,{variant:"outline",className:"w-full flex items-center justify-center",children:[e.jsx(d,{className:"w-4 h-4 mr-1"}),"詳細を見る"]})}),t.website_url&&e.jsx("a",{href:t.website_url,target:"_blank",rel:"noopener noreferrer",className:"flex-1",onClick:e=>e.stopPropagation(),children:e.jsx(a,{className:"w-full",children:"ウェブサイト"})})]})]})]});var u,f}function P({message:t="データを読み込み中..."}){return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:t})]})})}function z({error:t,onRetry:s}){return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md mx-auto px-4",children:[e.jsx(w,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"エラーが発生しました"}),e.jsx("p",{className:"text-gray-600 mb-4",children:t}),e.jsxs(a,{onClick:s,className:"inline-flex items-center",children:[e.jsx(v,{className:"w-4 h-4 mr-2"}),"再試行"]})]})})}const F={lat:35.6762,lng:139.6503};function B({parks:s=[],facilities:n=[],activeView:i="dogparks",onLocationSelect:o,center:c,userLocation:d,className:m=""}){const x=t.useRef(null),[h,g]=t.useState(!1),[p,u]=t.useState(d||null),[f,b]=t.useState(""),[y,j]=t.useState(!1),{user:w}=N(),[v,C]=t.useState([]),[M,S]=t.useState(""),$='\n    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <circle cx="16" cy="16" r="15" fill="#EF4444" stroke="white" stroke-width="2"/>\n      <path d="M10 12c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zm8 0c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zM8 18c0-2.2 3.6-4 8-4s8 1.8 8 4c0 1.1-3.6 2-8 2s-8-.9-8-2z" fill="white"/>\n      <path d="M14 16h4v2h-4z" fill="#EF4444"/>\n    </svg>\n  ';t.useEffect(()=>{(async()=>{if(w)try{const{data:e,error:t}=await _.from("dogs").select("id, name, image_url").eq("user_id",w.id).order("created_at",{ascending:!0});if(t)throw t;if(e&&e.length>0){C(e);const t=e[0];t.image_url?S(t.image_url):S("data:image/svg+xml;charset=utf-8,"+encodeURIComponent($))}else S("data:image/svg+xml;charset=utf-8,"+encodeURIComponent($))}catch(e){S("data:image/svg+xml;charset=utf-8,"+encodeURIComponent($))}})()},[w]);const I=p||c||F;t.useEffect(()=>{!p&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{const t={lat:e.coords.latitude,lng:e.coords.longitude};u(t),o&&o(t)},e=>{},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e5})},[p,o]);const P=t.useCallback(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{const t={lat:e.coords.latitude,lng:e.coords.longitude};u(t),o&&o(t)},e=>{},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e5})},[o]);t.useEffect(()=>{const e=e=>{if(("dogparks"===i||"facilities"===i)&&window.google?.maps&&s.length>0){const t="data:image/svg+xml;charset=utf-8,"+encodeURIComponent('\n            <svg width="24" height="24" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">\n              <circle cx="16" cy="16" r="16" fill="url(#paint0_linear)" />\n              <path d="M22.4 10.4C22.4 11.7255 21.3255 12.8 20 12.8C18.6745 12.8 17.6 11.7255 17.6 10.4C17.6 9.07452 18.6745 8 20 8C21.3255 8 22.4 9.07452 22.4 10.4Z" fill="white"/>\n              <path d="M14.4 10.4C14.4 11.7255 13.3255 12.8 12 12.8C10.6745 12.8 9.6 11.7255 9.6 10.4C9.6 9.07452 10.6745 8 12 8C13.3255 8 14.4 9.07452 14.4 10.4Z" fill="white"/>\n              <path d="M22.4 18.4C22.4 19.7255 21.3255 20.8 20 20.8C18.6745 20.8 17.6 19.7255 17.6 18.4C17.6 17.0745 18.6745 16 20 16C21.3255 16 22.4 17.0745 22.4 18.4Z" fill="white"/>\n              <path d="M14.4 18.4C14.4 19.7255 13.3255 20.8 12 20.8C10.6745 20.8 9.6 19.7255 9.6 18.4C9.6 17.0745 10.6745 16 12 16C13.3255 16 14.4 17.0745 14.4 18.4Z" fill="white"/>\n              <path d="M18.4 14.4C19.7255 14.4 20.8 13.3255 20.8 12C20.8 10.6745 19.7255 9.6 18.4 9.6C17.0745 9.6 16 10.6745 16 12C16 13.3255 17.0745 14.4 18.4 14.4Z" fill="white"/>\n              <path d="M18.4 22.4C19.7255 22.4 20.8 21.3255 20.8 20C20.8 18.6745 19.7255 17.6 18.4 17.6C17.0745 17.6 16 18.6745 16 20C16 21.3255 17.0745 22.4 18.4 22.4Z" fill="white"/>\n              <path d="M10.4 14.4C11.7255 14.4 12.8 13.3255 12.8 12C12.8 10.6745 11.7255 9.6 10.4 9.6C9.07452 9.6 8 10.6745 8 12C8 13.3255 9.07452 14.4 10.4 14.4Z" fill="white"/>\n              <path d="M10.4 22.4C11.7255 22.4 12.8 21.3255 12.8 20C12.8 18.6745 11.7255 17.6 10.4 17.6C9.07452 17.6 8 18.6745 8 20C8 21.3255 9.07452 22.4 10.4 22.4Z" fill="white"/>\n              <defs>\n                <linearGradient id="paint0_linear" x1="0" y1="0" x2="32" y2="32" gradientUnits="userSpaceOnUse">\n                  <stop stop-color="#3B82F6"/>\n                  <stop offset="1" stop-color="#10B981"/>\n                </linearGradient>\n              </defs>\n            </svg>\n          ');s.forEach(s=>{if(s.latitude&&s.longitude){const a=new window.google.maps.Marker({position:{lat:Number(s.latitude),lng:Number(s.longitude)},map:e,title:s.name,icon:{url:t,scaledSize:new window.google.maps.Size(32,32),anchor:new window.google.maps.Point(16,16)}}),n=new window.google.maps.InfoWindow({content:`\n                  <div style="padding: 12px; max-width: 250px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">\n                    <h3 style="font-weight: bold; margin-bottom: 8px; color: #1F2937; font-size: 16px;">${s.name}</h3>\n                    ${s.address?`<p style="font-size: 12px; color: #6B7280; margin-bottom: 6px; line-height: 1.4;">${s.address}</p>`:""}\n                    ${s.price?`<p style="font-size: 12px; color: #6B7280; margin-bottom: 12px;">料金: ¥${s.price}/時間</p>`:""}\n                    <div style="text-align: center; margin-top: 12px;">\n                      <a \n                        href="/parks/${s.id}" \n                        target="_blank"\n                        style="\n                          display: inline-block;\n                          background: linear-gradient(135deg, #3B82F6, #10B981);\n                          color: white;\n                          padding: 8px 16px;\n                          border-radius: 6px;\n                          text-decoration: none;\n                          font-size: 13px;\n                          font-weight: 500;\n                          transition: all 0.2s;\n                          box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n                        "\n                        onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.15)';"\n                        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.1)';"\n                      >\n                        🐾 詳細を見る\n                      </a>\n                    </div>\n                  </div>\n                `});a.addListener("click",()=>{n.open(e,a)})}})}if("facilities"!==i&&"dogparks"!==i||n.forEach(t=>{if(t.latitude&&t.longitude){const s=new window.google.maps.Marker({position:{lat:Number(t.latitude),lng:Number(t.longitude)},map:e,title:t.name,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:6,fillColor:"#10B981",fillOpacity:1,strokeWeight:2,strokeColor:"#FFFFFF"}}),a=new window.google.maps.InfoWindow({content:`\n                <div style="padding: 12px; max-width: 250px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">\n                  <h3 style="font-weight: bold; margin-bottom: 8px; color: #1F2937; font-size: 16px;">${t.name}</h3>\n                  ${t.address?`<p style="font-size: 12px; color: #6B7280; margin-bottom: 6px; line-height: 1.4;">${t.address}</p>`:""}\n                  ${t.phone?`<p style="font-size: 12px; color: #6B7280; margin-bottom: 12px;">📞 ${t.phone}</p>`:""}\n                  <div style="text-align: center; margin-top: 12px;">\n                    <a \n                      href="/facilities/${t.id}" \n                      target="_blank"\n                      style="\n                        display: inline-block;\n                        background: linear-gradient(135deg, #10B981, #3B82F6);\n                        color: white;\n                        padding: 8px 16px;\n                        border-radius: 6px;\n                        text-decoration: none;\n                        font-size: 13px;\n                        font-weight: 500;\n                        transition: all 0.2s;\n                        box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n                      "\n                      onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.15)';"\n                      onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.1)';"\n                    >\n                      🏢 詳細を見る\n                    </a>\n                  </div>\n                </div>\n              `});s.addListener("click",()=>{a.open(e,s)})}}),p&&M){const s=(t=M).startsWith("data:image/svg+xml")?t:`data:image/svg+xml;charset=utf-8,${encodeURIComponent(`\n      <svg width="40" height="40" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">\n        <defs>\n          <clipPath id="clip">\n            <circle cx="20" cy="20" r="18"/>\n          </clipPath>\n        </defs>\n        <circle cx="20" cy="20" r="19" fill="white" stroke="#EF4444" stroke-width="2"/>\n        <image href="${t}" x="2" y="2" width="36" height="36" clip-path="url(#clip)" preserveAspectRatio="xMidYMid slice"/>\n        <circle cx="20" cy="20" r="18" fill="none" stroke="rgba(239, 68, 68, 0.8)" stroke-width="3"/>\n      </svg>\n    `)}`;new window.google.maps.Marker({position:p,map:e,title:v.length>0?`現在地 (${v[0]?.name||"あなた"})`:"現在地",icon:{url:s,scaledSize:new window.google.maps.Size(40,40),anchor:new window.google.maps.Point(20,20)},zIndex:1e3})}var t};(async()=>{try{const t="AIzaSyC9sxGamDZmdKIz3vP1CWLJORl-QkoWgHg";if(!window.google){const e=document.createElement("script");e.src=`https://maps.googleapis.com/maps/api/js?key=${t}&libraries=places`,e.async=!0,e.defer=!0,await new Promise((t,s)=>{e.onload=()=>t(),e.onerror=()=>s(new Error("Google Maps API の読み込みに失敗しました")),document.head.appendChild(e)})}if(x.current&&window.google?.maps){const t=new window.google.maps.Map(x.current,{center:I,zoom:p?15:13,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1});e(t),g(!0)}}catch(t){g(!1)}})()},[s,n,i,c,p,I,M,v]);const z=("dogparks"===i?s:n).length;return e.jsxs(k,{className:`overflow-hidden ${m}`,children:[e.jsxs("div",{className:"p-4 border-b bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(r,{className:"w-5 h-5 text-blue-600 mr-2"}),e.jsxs("h3",{className:"font-semibold",children:["dogparks"===i?"ドッグパーク":"ペット施設","マップ"]})]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[z,"件"]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("div",{className:"flex items-center space-x-4 text-xs",children:["dogparks"===i&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-600 rounded-full mr-2"}),e.jsx("span",{children:"ドッグパーク"})]}),"facilities"===i&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-green-600 rounded-full mr-2"}),e.jsx("span",{children:"ペット施設"})]}),p&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full mr-2"}),e.jsx("span",{children:"現在地"})]})]}),e.jsxs(a,{size:"sm",variant:"secondary",onClick:P,className:"text-xs",children:[e.jsx(l,{className:"w-3 h-3 mr-1"}),"現在地"]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{ref:x,className:"w-full h-96",style:{minHeight:"400px"}}),!h&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"マップを読み込み中..."})]})})]}),e.jsx("div",{className:"p-3 border-t bg-gray-50 text-xs text-gray-500 text-center",children:"マーカーをクリックすると詳細情報が表示されます"})]})}const E={pet_hotel:"ペットホテル",pet_salon:"ペットサロン",veterinary:"動物病院",pet_cafe:"ペットカフェ",pet_restaurant:"ペット同伴レストラン",pet_shop:"ペットショップ",pet_accommodation:"ペット同伴宿泊",dog_training:"しつけ教室",pet_friendly_other:"その他ワンちゃん同伴可能施設"},L=(e,t,s,a)=>{const n=(s-e)*Math.PI/180,i=(a-t)*Math.PI/180,r=Math.sin(n/2)*Math.sin(n/2)+Math.cos(e*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(i/2)*Math.sin(i/2);return 6371*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))},R=e=>({pet_hotel:"🏨",pet_salon:"✂️",veterinary:"🏥",pet_cafe:"☕",pet_restaurant:"🍽️",pet_shop:"🛍️",pet_accommodation:"🏠",dog_training:"🎓",pet_friendly_other:"🌟"}[e]||"🏢");function A(){const[s,a]=t.useState("dogparks"),[n,i]=t.useState(null),[r,l]=t.useState(!1),[o,c]=t.useState(Object.keys(E)),[d,m]=t.useState(null),[x,h]=t.useState(!1),{user:g,isAuthenticated:p}=N(),{parks:u,isLoading:f,error:b,fetchParkData:y}=function(){const[e,s]=t.useState([]),[a,n]=t.useState(!1),[i,r]=t.useState(null);return{parks:e,isLoading:a,error:i,fetchParkData:t.useCallback(async()=>{try{n(!0),r(null);const{data:e,error:t}=await _.from("dog_parks").select("\n          *,\n          profiles:owner_id (\n            name,\n            address,\n            phone_number,\n            email,\n            postal_code\n          )\n        ").eq("status","approved").order("created_at",{ascending:!1});if(t)throw t;const a=(e||[]).map(e=>(Array.isArray(e.profiles)?e.profiles[0]:e.profiles,{id:e.id||"",name:e.name||"",description:e.description||e.facility_details||"",address:e.address||"",latitude:Number(e.latitude)||0,longitude:Number(e.longitude)||0,max_capacity:Number(e.max_capacity)||20,current_occupancy:Number(e.current_occupancy)||0,price:Number(e.price)||Number(e.hourly_rate)||0,status:e.status||"approved",facilities:e.facilities?"object"==typeof e.facilities?Object.entries(e.facilities).filter(([e,t])=>t).map(([e])=>e).join(","):e.facilities:e.facility_details||"",image_url:e.image_url||e.cover_image_url||"https://via.placeholder.com/400x300?text="+encodeURIComponent(e.name||"ドッグパーク"),average_rating:Number(e.average_rating)||4,review_count:Number(e.review_count)||Math.floor(50*Math.random())+5,created_at:e.created_at||""}));s(a)}catch(e){const t=e instanceof Error?e.message:"データの取得に失敗しました";r(t)}finally{n(!1)}},[]),setError:r,setIsLoading:n}}(),{facilities:j,facilitiesLoading:w,error:v,fetchFacilities:k}=function(){const[e,s]=t.useState([]),[a,n]=t.useState(!1),[i,r]=t.useState(null);return{facilities:e,facilitiesLoading:a,error:i,fetchFacilities:t.useCallback(async()=>{try{n(!0),r(null);const{data:e,error:t}=await _.from("pet_facilities").select("*").eq("status","approved").order("name");if(t)throw t;const a=(e||[]).map(e=>({id:e.id||"",name:e.name||"",description:e.description||"",category:e.category_id||"other",address:e.address||"",latitude:Number(e.latitude)||0,longitude:Number(e.longitude)||0,phone:e.phone||"",website:e.website||"",status:e.status||"pending",created_at:e.created_at||"",category_name:e.facility_categories?.name_ja||""}));s(a)}catch(e){const t=e instanceof Error?e.message:"施設データの取得に失敗しました";r(t),s([])}finally{n(!1)}},[]),setError:r,setFacilitiesLoading:n}}();t.useEffect(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{const t={lat:e.coords.latitude,lng:e.coords.longitude};m(t)},e=>{},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e5})},[]);const C=t.useMemo(()=>d&&0!==u.length?[...u].sort((e,t)=>L(d.lat,d.lng,Number(e.latitude)||0,Number(e.longitude)||0)-L(d.lat,d.lng,Number(t.latitude)||0,Number(t.longitude)||0)):u,[u,d]),$=t.useMemo(()=>{let e=j.filter(e=>o.includes(e.category));return d&&e.length>0&&(e=e.sort((e,t)=>L(d.lat,d.lng,e.latitude||0,e.longitude||0)-L(d.lat,d.lng,t.latitude||0,t.longitude||0))),e},[j,o,d]);t.useEffect(()=>{(async()=>{try{"dogparks"===s?await y():await k()}catch(e){}})()},[s,y,k]);const F="dogparks"===s?b:v,A=()=>{(async()=>{"dogparks"===s?await y():await k()})()};return("dogparks"===s?f:w)?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[!1,e.jsx(P,{})]}):F?e.jsx(z,{error:F,onRetry:A}):"dogparks"===s&&0===u.length?e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx(S,{title:"ドッグランが見つかりません",description:"まだドッグランのデータが登録されていません。"})}):"facilities"===s&&0===j.length?e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx(S,{title:"施設が見つかりません",description:"まだ施設のデータが登録されていません。"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"ドッグパーク一覧"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"お近くのドッグランを見つけましょう"})]})})}),!1,e.jsx("div",{className:"bg-white border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex justify-center py-4",children:e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>a("dogparks"),className:"px-6 py-3 rounded-md font-medium transition-all "+("dogparks"===s?"bg-blue-600 text-white shadow-md":"text-gray-600 hover:text-gray-900 hover:bg-gray-200"),children:"🐕 ドッグラン"}),e.jsx("button",{onClick:()=>a("facilities"),className:"px-6 py-3 rounded-md font-medium transition-all "+("facilities"===s?"bg-green-600 text-white shadow-md":"text-gray-600 hover:text-gray-900 hover:bg-gray-200"),children:"🏢 ワンちゃんと行ける施設"})]})})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:["facilities"===s&&e.jsxs("div",{className:"mb-4 bg-white rounded-lg shadow-sm border",children:[e.jsxs("button",{onClick:()=>h(!x),className:"w-full px-3 py-3 flex items-center justify-between text-left hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"🏢 カテゴリフィルター"}),e.jsxs("span",{className:"text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded-full",children:[o.length," / ",Object.keys(E).length]}),d&&e.jsx("span",{className:"text-xs text-green-600",children:"📍 距離順"})]}),e.jsx("span",{className:"text-gray-400 transition-transform "+(x?"rotate-180":""),children:"▼"})]}),x&&e.jsxs("div",{className:"px-3 pb-3 border-t border-gray-100",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-3 pt-3",children:[e.jsx("button",{onClick:()=>{c(Object.keys(E))},className:"px-2 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",children:"全選択"}),e.jsx("button",{onClick:()=>{c([])},className:"px-2 py-1 text-xs bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",children:"全解除"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(E).map(([t,s])=>e.jsxs("button",{onClick:()=>(e=>{c(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])})(t),className:"px-3 py-2 text-sm rounded-full border transition-all "+(o.includes(t)?"bg-blue-500 text-white border-blue-500 shadow-md":"bg-gray-100 text-gray-700 border-gray-300 hover:bg-gray-200"),children:[R(t)," ",s]},t))})]})]}),e.jsx("div",{className:"mb-8",children:e.jsx(B,{parks:C,facilities:"facilities"===s?$:j,activeView:s,userLocation:d})}),"dogparks"===s&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"ドッグラン一覧"}),0===u.length?e.jsx(S,{title:"ドッグランが見つかりません",description:"現在登録されているドッグランがありません。"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:C.map(t=>{const s=d&&t.latitude&&t.longitude?L(d.lat,d.lng,Number(t.latitude),Number(t.longitude)):void 0;return e.jsx(M,{park:t,userLocation:d,...void 0!==s&&{distance:s}},t.id)})})]}),"facilities"===s&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"ワンちゃんと行ける施設"}),0===$.length?e.jsx(S,{title:"施設が見つかりません",description:0===o.length?"カテゴリを選択してください。":"選択したカテゴリの施設が登録されていません。"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:$.map(t=>{const s=d&&t.latitude&&t.longitude?L(d.lat,d.lng,t.latitude,t.longitude):void 0;return e.jsx(I,{facility:t,showDistance:!!d,...void 0!==s&&{distance:s}},t.id)})})]})]})]})}export{A as DogParkList};

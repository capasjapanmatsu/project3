import{j as e}from"./motion-BHsL7Azw.js";import{r as s}from"./react-vendor-CMvmJHsS.js";import{u as a,s as r,B as t}from"./index-Dyn7RqS6.js";import{C as i}from"./Card-DqVnP9TA.js";import{a as d}from"./router-DXQOdrLL.js";import{q as n,t as l,F as c,aQ as m,a as x,b as o,s as h,M as g,r as j,b0 as p}from"./ui-basic-CJygcczc.js";import"./heavy-features-Dlg1c9Yc.js";import"./supabase-D2tiogv8.js";function b(){const{user:b,isAdmin:v}=a(),u=d(),[N,_]=s.useState([]),[f,y]=s.useState([]),[w,k]=s.useState([]),[S,C]=s.useState(!0),[D,z]=s.useState(""),[$,F]=s.useState(""),[M,T]=s.useState("pending"),[q,E]=s.useState(null),[I,O]=s.useState(!1),[Y,A]=s.useState(!1),[B,J]=s.useState(null);s.useEffect(()=>{v?Q():u("/")},[v,u]),s.useEffect(()=>{N.length>0&&P()},[N]);const L=e=>{z(e),F(""),setTimeout(()=>z(""),8e3)},P=()=>{const e=N.filter(e=>"pending"===e.status),s=N.filter(e=>"approved"===e.status);y(e),k(s)},Q=async()=>{try{C(!0),z("");const{data:e,error:s}=await r.from("vaccine_certifications").select("\n          *,\n          dog:dogs (\n            id,\n            name,\n            breed,\n            gender,\n            birth_date,\n            owner:profiles (\n              id,\n              name,\n              email,\n              phone_number,\n              address,\n              postal_code\n            )\n          )\n        ").order("created_at",{ascending:!1});if(s)throw s;const a=(e||[]).map(e=>({id:e.id,dog_id:e.dog_id,dog_name:e.dog?.name||"不明",dog_breed:e.dog?.breed||"不明",dog_gender:e.dog?.gender||"不明",dog_birth_date:e.dog?.birth_date||"",owner_id:e.owner_id,owner_name:e.dog?.owner?.name||"不明",owner_email:e.dog?.owner?.email||"不明",owner_phone:e.dog?.owner?.phone_number||"",owner_address:e.dog?.owner?.address||"",owner_postal_code:e.dog?.owner?.postal_code||"",rabies_vaccine_image:e.rabies_vaccine_image||"",combo_vaccine_image:e.combo_vaccine_image||"",rabies_expiry_date:e.rabies_expiry_date||"",combo_expiry_date:e.combo_expiry_date||"",status:e.status||"pending",created_at:e.created_at,admin_notes:e.admin_notes||""}));_(a)}catch(e){L("ワクチン証明書申請の取得に失敗しました。")}finally{C(!1)}},G=async e=>{if(window.confirm("このワクチン証明書申請を承認してもよろしいですか？"))try{A(!0),z(""),F("");const{error:s}=await r.from("vaccine_certifications").update({status:"approved",approved_at:(new Date).toISOString()}).eq("id",e);if(s)throw s;const a=N.find(s=>s.id===e);a&&await r.from("notifications").insert([{user_id:a.owner_id,title:"ワクチン証明書承認",message:`${a.dog_name}ちゃんのワクチン証明書が承認されました。`,type:"vaccine_approved",created_at:(new Date).toISOString(),read:!1}]),F("ワクチン証明書を承認しました。"),z(""),setTimeout(()=>F(""),5e3),_(s=>s.map(s=>s.id===e?{...s,status:"approved"}:s))}catch(s){L("承認処理に失敗しました。")}finally{A(!1)}},H=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},K=e=>{switch(e){case"pending":return"承認待ち";case"approved":return"承認済み";case"rejected":return"却下";default:return"不明"}},R=e=>new Date(e).toLocaleDateString("ja-JP"),U=e=>{if(!e)return"不明";const s=new Date,a=new Date(e),r=s.getFullYear()-a.getFullYear(),t=s.getMonth()-a.getMonth();return t<0||0===t&&s.getDate()<a.getDate()?r-1+"歳":`${r}歳`};return v?S?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"データを読み込み中..."})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"bg-white shadow rounded-lg mb-8",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"ワクチン証明書 承認管理"}),e.jsx("p",{className:"text-gray-600",children:"登録されたワクチン証明書の承認・却下を管理します。"})]}),D&&e.jsx("div",{className:"px-6 py-4 bg-red-50 border-l-4 border-red-400",children:e.jsxs("div",{className:"flex",children:[e.jsx(n,{className:"h-5 w-5 text-red-400 mr-2"}),e.jsx("p",{className:"text-sm text-red-700",children:D})]})}),$&&e.jsx("div",{className:"px-6 py-4 bg-green-50 border-l-4 border-green-400",children:e.jsxs("div",{className:"flex",children:[e.jsx(l,{className:"h-5 w-5 text-green-400 mr-2"}),e.jsx("p",{className:"text-sm text-green-700",children:$})]})}),e.jsx("div",{className:"px-6",children:e.jsxs("nav",{className:"flex space-x-8","aria-label":"Tabs",children:[e.jsxs("button",{onClick:()=>T("pending"),className:"whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm "+("pending"===M?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx(c,{className:"w-5 h-5 inline mr-2"}),"承認待ち",e.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:f.length})]}),e.jsxs("button",{onClick:()=>T("approved"),className:"whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm "+("approved"===M?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx(m,{className:"w-5 h-5 inline mr-2"}),"登録中のワンちゃん",e.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:w.length})]})]})})]}),"pending"===M&&e.jsx("div",{className:"space-y-6",children:0===f.length?e.jsxs(i,{className:"text-center py-12",children:[e.jsx(c,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"承認待ちのワクチン証明書申請がありません"})]}):e.jsx("div",{className:"space-y-4",children:f.map(s=>e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx(m,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.dog_name}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${H(s.status)}`,children:K(s.status)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"ワンちゃん情報"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{children:["犬種: ",s.dog_breed]}),e.jsxs("div",{children:["性別: ",s.dog_gender]}),e.jsxs("div",{children:["年齢: ",U(s.dog_birth_date)]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"飼い主情報"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(x,{className:"w-4 h-4 mr-1"}),s.owner_name]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(o,{className:"w-4 h-4 mr-1"}),s.owner_email]}),s.owner_phone&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(h,{className:"w-4 h-4 mr-1"}),s.owner_phone]}),s.owner_address&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(g,{className:"w-4 h-4 mr-1"}),"〒",s.owner_postal_code," ",s.owner_address]})]})]})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["申請日: ",R(s.created_at)]})]}),e.jsxs("div",{className:"flex space-x-2 ml-4",children:[e.jsxs(t,{size:"sm",variant:"secondary",onClick:()=>{E(s),O(!0)},children:[e.jsx(j,{className:"w-4 h-4 mr-1"}),"詳細"]}),e.jsxs(t,{size:"sm",onClick:()=>G(s.id),className:"bg-green-600 hover:bg-green-700",disabled:Y,children:[e.jsx(l,{className:"w-4 h-4 mr-1"}),"承認"]})]})]})},s.id))})}),"approved"===M&&e.jsx("div",{className:"space-y-6",children:0===w.length?e.jsxs(i,{className:"text-center py-12",children:[e.jsx(m,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"承認済みのワクチン証明書がありません"})]}):e.jsx("div",{className:"space-y-4",children:w.map(s=>e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx(m,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.dog_name}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${H(s.status)}`,children:K(s.status)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"ワンちゃん情報"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{children:["犬種: ",s.dog_breed]}),e.jsxs("div",{children:["性別: ",s.dog_gender]}),e.jsxs("div",{children:["年齢: ",U(s.dog_birth_date)]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"飼い主情報"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(x,{className:"w-4 h-4 mr-1"}),s.owner_name]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(o,{className:"w-4 h-4 mr-1"}),s.owner_email]}),s.owner_phone&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(h,{className:"w-4 h-4 mr-1"}),s.owner_phone]}),s.owner_address&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(g,{className:"w-4 h-4 mr-1"}),"〒",s.owner_postal_code," ",s.owner_address]})]})]})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["申請日: ",R(s.created_at)]})]}),e.jsx("div",{className:"flex space-x-2 ml-4",children:e.jsxs(t,{size:"sm",variant:"secondary",onClick:()=>{E(s),O(!0)},children:[e.jsx(j,{className:"w-4 h-4 mr-1"}),"詳細"]})})]})},s.id))})}),I&&q&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold",children:"ワクチン証明書詳細"}),e.jsx("button",{onClick:()=>{O(!1),E(null)},className:"text-gray-500 hover:text-gray-700",children:"×"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"ワンちゃん情報"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"名前:"})," ",q.dog_name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"犬種:"})," ",q.dog_breed]}),e.jsxs("div",{children:[e.jsx("strong",{children:"性別:"})," ",q.dog_gender]}),e.jsxs("div",{children:[e.jsx("strong",{children:"年齢:"})," ",U(q.dog_birth_date)]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"飼い主情報"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"名前:"})," ",q.owner_name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"メール:"})," ",q.owner_email]}),q.owner_phone&&e.jsxs("div",{children:[e.jsx("strong",{children:"電話:"})," ",q.owner_phone]}),q.owner_address&&e.jsxs("div",{children:[e.jsx("strong",{children:"住所:"})," 〒",q.owner_postal_code," ",q.owner_address]})]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"ワクチン証明書画像"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[q.rabies_vaccine_image&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:["狂犬病ワクチン",q.rabies_expiry_date&&e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(有効期限: ",R(q.rabies_expiry_date),")"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:q.rabies_vaccine_image,alt:"狂犬病ワクチン証明書",className:"w-full h-48 object-cover rounded-lg border cursor-pointer",onClick:()=>J(q.rabies_vaccine_image)}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("button",{onClick:()=>J(q.rabies_vaccine_image),className:"bg-black bg-opacity-50 text-white p-1 rounded-full hover:bg-opacity-70",children:e.jsx(p,{className:"w-4 h-4"})})})]})]}),q.combo_vaccine_image&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:["混合ワクチン",q.combo_expiry_date&&e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(有効期限: ",R(q.combo_expiry_date),")"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:q.combo_vaccine_image,alt:"混合ワクチン証明書",className:"w-full h-48 object-cover rounded-lg border cursor-pointer",onClick:()=>J(q.combo_vaccine_image)}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("button",{onClick:()=>J(q.combo_vaccine_image),className:"bg-black bg-opacity-50 text-white p-1 rounded-full hover:bg-opacity-70",children:e.jsx(p,{className:"w-4 h-4"})})})]})]})]})]}),e.jsxs("div",{className:"mt-6 text-sm text-gray-500",children:["申請日: ",R(q.created_at)]})]})})}),B&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"relative max-w-4xl max-h-full",children:[e.jsx("button",{onClick:()=>J(null),className:"absolute top-4 right-4 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70",children:"×"}),e.jsx("img",{src:B,alt:"拡大画像",className:"max-w-full max-h-full object-contain"})]})})]})}):e.jsx("div",{className:"max-w-4xl mx-auto p-4",children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(n,{className:"w-12 h-12 text-red-500 mr-4"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-red-700",children:"アクセス権限がありません"}),e.jsx("p",{className:"text-red-600",children:"このページは管理者のみアクセス可能です。"})]})]})})})}export{b as default};

import{j as e}from"./motion-BHsL7Azw.js";import{r as s}from"./react-vendor-CMvmJHsS.js";import{L as t}from"./router-DXQOdrLL.js";import{u as a,s as r,B as n,S as l}from"./index-4WslulxM.js";import{C as i}from"./Card-DqVnP9TA.js";import{C as d}from"./CouponDisplay-D-FcGo4D.js";import{a4 as o,Z as c,G as x,C as m,M as u,b as h}from"./ui-basic-BVqAzqVO.js";import"./heavy-features-Dlg1c9Yc.js";import"./supabase--qivnNSU.js";function p(){const{user:p}=a(),[g,b]=s.useState([]),[j,f]=s.useState(!0),[N,y]=s.useState("available"),[w,v]=s.useState(""),[_,k]=s.useState(!1),[D,C]=s.useState(null);s.useEffect(()=>{p&&S()},[p]);const S=async()=>{if(p)try{f(!0);const{data:e,error:s}=await r.from("user_coupons").select("\n          *,\n          coupon:facility_coupons!inner (\n            *,\n            facility:pet_facilities (\n              name,\n              address\n            )\n          )\n        ").eq("user_id",p.id).order("obtained_at",{ascending:!1});if(s)throw s;b(e||[])}catch(e){v("ã‚¯ãƒ¼ãƒãƒ³ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}finally{f(!1)}},F=e=>e.discount_value||"free_gift"===e.discount_type?"free_gift"===e.discount_type?"ğŸ ç„¡æ–™ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ":"percentage"===e.discount_type?`${e.discount_value}% OFF`:`${e.discount_value?.toLocaleString()}å†† OFF`:"",L=s=>{const t=new Date,a=new Date(s.coupon.end_date);return s.is_used?e.jsx("span",{className:"px-3 py-1 text-xs font-bold bg-gray-100 text-gray-700 rounded-full",children:"ä½¿ç”¨æ¸ˆã¿"}):a<t?e.jsx("span",{className:"px-3 py-1 text-xs font-bold bg-red-100 text-red-700 rounded-full",children:"æœŸé™åˆ‡ã‚Œ"}):e.jsx("span",{className:"px-3 py-1 text-xs font-bold bg-green-100 text-green-700 rounded-full",children:"åˆ©ç”¨å¯èƒ½"})},J=(()=>{const e=new Date;switch(N){case"available":return g.filter(s=>!s.is_used&&new Date(s.coupon.end_date)>=e);case"used":return g.filter(e=>e.is_used);case"expired":return g.filter(s=>!s.is_used&&new Date(s.coupon.end_date)<e);default:return g}})();return p?e.jsxs(e.Fragment,{children:[e.jsx(l,{title:"ãƒã‚¤ã‚¯ãƒ¼ãƒãƒ³ - ãƒ‰ãƒƒã‚°ãƒ‘ãƒ¼ã‚¯JP",description:"å–å¾—ã—ãŸã‚¯ãƒ¼ãƒãƒ³ã‚’ç®¡ç†ãƒ»åˆ©ç”¨ã§ãã¾ã™ã€‚"}),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100",children:[e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-6",children:e.jsxs(t,{to:"/dashboard",className:"inline-flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[e.jsx(c,{className:"w-4 h-4 mr-2"}),"ãƒã‚¤ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹"]})}),e.jsx("div",{className:"text-center mb-8",children:e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-4 flex items-center justify-center",children:[e.jsx(o,{className:"w-8 h-8 mr-3 text-pink-500"}),"ãƒã‚¤ã‚¯ãƒ¼ãƒãƒ³"]})}),w&&e.jsx("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-xl p-4 mb-6",children:w}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border mb-6 overflow-hidden",children:e.jsxs("nav",{className:"flex",children:[e.jsxs("button",{onClick:()=>y("available"),className:"flex-1 py-3 px-4 font-medium text-center transition-all duration-300 "+("available"===N?"bg-green-500 text-white shadow-md":"bg-white text-gray-600 hover:bg-gray-50"),children:[e.jsx(x,{className:"w-4 h-4 inline mr-2"}),"åˆ©ç”¨å¯èƒ½",e.jsx("span",{className:"ml-2 text-xs px-2 py-1 rounded-full font-medium "+("available"===N?"bg-white/20 text-white":"bg-green-100 text-green-700"),children:g.filter(e=>!e.is_used&&new Date(e.coupon.end_date)>=new Date).length})]}),e.jsxs("button",{onClick:()=>y("used"),className:"flex-1 py-3 px-4 font-medium text-center transition-all duration-300 "+("used"===N?"bg-gray-500 text-white shadow-md":"bg-white text-gray-600 hover:bg-gray-50"),children:[e.jsx(o,{className:"w-4 h-4 inline mr-2"}),"ä½¿ç”¨æ¸ˆã¿",e.jsx("span",{className:"ml-2 text-xs px-2 py-1 rounded-full font-medium "+("used"===N?"bg-white/20 text-white":"bg-gray-100 text-gray-700"),children:g.filter(e=>e.is_used).length})]}),e.jsxs("button",{onClick:()=>y("expired"),className:"flex-1 py-3 px-4 font-medium text-center transition-all duration-300 "+("expired"===N?"bg-red-500 text-white shadow-md":"bg-white text-gray-600 hover:bg-gray-50"),children:[e.jsx(m,{className:"w-4 h-4 inline mr-2"}),"æœŸé™åˆ‡ã‚Œ",e.jsx("span",{className:"ml-2 text-xs px-2 py-1 rounded-full font-medium "+("expired"===N?"bg-white/20 text-white":"bg-red-100 text-red-700"),children:g.filter(e=>!e.is_used&&new Date(e.coupon.end_date)<new Date).length})]})]})}),j?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"ã‚¯ãƒ¼ãƒãƒ³ã‚’èª­ã¿è¾¼ã¿ä¸­..."})]}):0===J.length?e.jsxs(i,{className:"text-center py-16",children:[e.jsx(o,{className:"w-20 h-20 text-gray-300 mx-auto mb-6"}),e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:["available"===N&&"ã¾ã åˆ©ç”¨å¯èƒ½ãªã‚¯ãƒ¼ãƒãƒ³ãŒã‚ã‚Šã¾ã›ã‚“","used"===N&&"ä½¿ç”¨æ¸ˆã¿ã‚¯ãƒ¼ãƒãƒ³ãŒã‚ã‚Šã¾ã›ã‚“","expired"===N&&"æœŸé™åˆ‡ã‚Œã‚¯ãƒ¼ãƒãƒ³ãŒã‚ã‚Šã¾ã›ã‚“"]}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["available"===N&&"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã‚„æ–½è¨­ã§ã‚¯ãƒ¼ãƒãƒ³ã‚’å–å¾—ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼","used"===N&&"ã‚¯ãƒ¼ãƒãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ã“ã“ã«å±¥æ­´ãŒè¡¨ç¤ºã•ã‚Œã¾ã™","expired"===N&&"æœŸé™åˆ‡ã‚Œã®ã‚¯ãƒ¼ãƒãƒ³ã¯ã‚ã‚Šã¾ã›ã‚“"]}),"available"===N&&e.jsx(t,{to:"/parks",children:e.jsx(n,{className:"bg-pink-500 hover:bg-pink-600",children:"æ–½è¨­ä¸€è¦§ã‚’è¦‹ã‚‹"})})]}):e.jsx("div",{className:"space-y-4",children:J.map(s=>e.jsxs(i,{className:"overflow-hidden shadow-md hover:shadow-lg transition-shadow duration-300",children:[e.jsx("div",{className:"bg-gradient-to-r from-pink-50 to-purple-50 px-4 py-3 border-b border-pink-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:s.coupon.title}),L(s)]}),F(s.coupon)&&e.jsx("div",{className:"bg-gradient-to-r from-red-500 to-red-600 text-white px-3 py-2 rounded-full shadow-md",children:e.jsx("span",{className:"text-sm font-bold",children:F(s.coupon)})})]})}),e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-gray-700 mb-3",children:s.coupon.service_content}),e.jsx("div",{className:"bg-gray-50 p-3 rounded-lg mb-3",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(u,{className:"w-4 h-4 mr-2 text-blue-500"}),e.jsx("span",{className:"font-medium text-gray-900 text-sm",children:s.coupon.facility?.name})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3 text-xs",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(m,{className:"w-3 h-3 mr-1 text-blue-500"}),e.jsxs("span",{className:"text-gray-600",children:["æœŸé™: ",new Date(s.coupon.end_date).toLocaleDateString("ja-JP")]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(o,{className:"w-3 h-3 mr-1 text-green-500"}),e.jsx("span",{className:"font-medium "+("once"===s.coupon.usage_limit_type?"text-red-600":"text-green-600"),children:"once"===s.coupon.usage_limit_type?"1å›é™å®š":"ä½•å›ã§ã‚‚"})]})]}),s.coupon.coupon_image_url&&e.jsx("div",{className:"mb-3",children:e.jsx("img",{src:s.coupon.coupon_image_url,alt:"ã‚¯ãƒ¼ãƒãƒ³ç”»åƒ",className:"w-full max-w-sm h-auto border rounded-lg shadow-sm mx-auto"})}),"available"===N&&"once"===s.coupon.usage_limit_type&&e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3 mb-3",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(h,{className:"w-4 h-4 text-amber-500 mr-2 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-amber-800 text-sm",children:"âš ï¸ 1å›é™å®š"}),e.jsx("div",{className:"text-xs text-amber-700",children:"è¡¨ç¤ºã™ã‚‹ã¨æ¶ˆãˆã¾ã™ã€‚åº—èˆ—ã§ã®ã¿ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚"})]})]})})]}),"available"===N&&e.jsx("div",{className:"bg-gray-50 px-4 py-3 border-t",children:e.jsxs(n,{onClick:()=>(e=>{C(e),k(!0)})(s),className:"w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-3 shadow-md hover:shadow-lg transition-all duration-300",size:"lg",children:[e.jsx(x,{className:"w-4 h-4 mr-2"}),"ã‚¯ãƒ¼ãƒãƒ³ã‚’è¡¨ç¤º"]})})]},s.id))})]}),_&&D&&e.jsx(d,{userCoupon:D,onClose:()=>{k(!1),C(null),S()}})]})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs(i,{className:"p-8 text-center max-w-md",children:[e.jsx(o,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"ã‚¯ãƒ¼ãƒãƒ³ã‚’ç¢ºèªã™ã‚‹ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚"}),e.jsx(t,{to:"/login",children:e.jsx(n,{className:"w-full",children:"ãƒ­ã‚°ã‚¤ãƒ³"})})]})})}export{p as MyCoupons};

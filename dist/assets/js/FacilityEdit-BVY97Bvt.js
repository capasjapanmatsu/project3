const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/css/index-BHS2ZDIu.css"])))=>i.map(i=>d[i]);
import{_ as e}from"./supabase-B0bqaRGb.js";import{j as s}from"./motion-CuO0nkIV.js";import{u as t}from"./usePremiumOwner-CJn8FLsu.js";import{r as a}from"./react-vendor-cniURDpR.js";import{d as r,a as i,L as l}from"./router-Cg6wfOY4.js";import{B as n}from"./Button-BVIkPLCk.js";import{s as d,C as c,u as o,S as m}from"./index-Cxr3hxlQ.js";import{I as x}from"./ImageCropper-CFqHywrA.js";import{I as h}from"./Input-D7pb8xRh.js";import{L as u}from"./LocationEditMap-BMTpWsOb.js";import{G as p,o as g,a_ as b,aO as f,y as j,U as y,j as N,ae as v,ap as w,af as _,F as S,a4 as k,N as C,M as q,b4 as D,ac as $,i as I,ag as O,ah as E}from"./ui-basic-icnN6BOT.js";import"./heavy-features-BIdEME4r.js";import"./geocoding-C2oaRnzC.js";function F({facilityId:e,facilityName:t}){const[r,i]=a.useState([]),[l,o]=a.useState({}),[m,h]=a.useState(!0),[u,_]=a.useState(!1),[S,k]=a.useState(null),[C,q]=a.useState(""),[D,$]=a.useState(""),[I,O]=a.useState({title:"",description:"",service_content:"",discount_type:"amount",start_date:"",end_date:"",usage_limit_type:"once"}),[E,F]=a.useState(!1),[L,T]=a.useState(null),[A,J]=a.useState(!1),[z,U]=a.useState("");a.useEffect(()=>{B()},[e]);const B=async()=>{try{h(!0);const{data:s,error:t}=await d.from("facility_coupons").select("*").eq("facility_id",e).eq("is_active",!0).order("created_at",{ascending:!1});if(t)throw t;i(s||[])}catch(s){q("ã‚¯ãƒ¼ãƒãƒ³ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}finally{h(!1)}},M=()=>{O({title:"",description:"",service_content:"",discount_type:"amount",start_date:"",end_date:"",usage_limit_type:"once"}),T(null),U(""),k(null),_(!1)};return m?s.jsx(c,{className:"p-6",children:s.jsxs("div",{className:"animate-pulse",children:[s.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4 mb-4"}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("div",{className:"h-3 bg-gray-200 rounded"}),s.jsx("div",{className:"h-3 bg-gray-200 rounded w-3/4"})]})]})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center",children:[s.jsx(p,{className:"w-5 h-5 mr-2 text-pink-500"}),"ã‚¯ãƒ¼ãƒãƒ³ç®¡ç†"]}),s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"ãŠå®¢æ§˜å‘ã‘ã®ã‚¯ãƒ¼ãƒãƒ³ã‚’ä½œæˆãƒ»ç®¡ç†ã§ãã¾ã™"})]}),s.jsxs(n,{onClick:()=>{_(!0),setTimeout(()=>{window.scrollTo({top:0,behavior:"smooth"})},100)},className:"flex items-center",children:[s.jsx(g,{className:"w-4 h-4 mr-2"}),"ã‚¯ãƒ¼ãƒãƒ³ä½œæˆ"]})]}),C&&s.jsx("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4",children:C}),D&&s.jsx("div",{className:"bg-green-100 border border-green-300 text-green-800 rounded-lg p-4",children:D}),u&&s.jsxs(c,{className:"p-6",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold",children:S?"ã‚¯ãƒ¼ãƒãƒ³ç·¨é›†":"ã‚¯ãƒ¼ãƒãƒ³ä½œæˆ"}),s.jsx(n,{variant:"secondary",onClick:M,className:"text-sm",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"})]}),s.jsxs("form",{onSubmit:async s=>{s.preventDefault(),F(!0),q("");try{if(!I.title.trim())throw new Error("ã‚¯ãƒ¼ãƒãƒ³ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");if(!I.service_content.trim())throw new Error("ã‚µãƒ¼ãƒ“ã‚¹å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");if(!I.start_date)throw new Error("é–‹å§‹æ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");if(!I.end_date)throw new Error("çµ‚äº†æ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");if("free_gift"!==I.discount_type&&(!I.discount_value||I.discount_value<=0))throw new Error(("amount"===I.discount_type?"å‰²å¼•é‡‘é¡":"å‰²å¼•ç‡")+"ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");const s=new Date(`${I.start_date}T00:00:00`),t=new Date(`${I.end_date}T23:59:59`);if(t<=s)throw new Error("çµ‚äº†æ—¥ã¯é–‹å§‹æ—¥ã‚ˆã‚Šå¾Œã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚");let a=S?.coupon_image_url||"";if(L){const s=Date.now(),t=`${e}/${`coupon_${e}_${s}.jpg`}`,{error:r}=await d.storage.from("pet-facility-images").upload(t,L,{contentType:"image/jpeg",upsert:!0});if(r)throw r;const{data:i}=d.storage.from("pet-facility-images").getPublicUrl(t);a=i.publicUrl}const r={facility_id:e,title:I.title.trim(),description:I.description.trim(),service_content:I.service_content.trim(),coupon_image_url:a||null,discount_value:I.discount_value||null,discount_type:I.discount_type,start_date:s.toISOString(),end_date:t.toISOString(),usage_limit_type:I.usage_limit_type,max_uses:"once"===I.usage_limit_type?1:null,updated_at:(new Date).toISOString()};if(S){const{error:e}=await d.from("facility_coupons").update(r).eq("id",S.id);if(e)throw e;$("ã‚¯ãƒ¼ãƒãƒ³ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸï¼")}else{const{error:e}=await d.from("facility_coupons").insert(r);if(e)throw e;$("ã‚¯ãƒ¼ãƒãƒ³ãŒä½œæˆã•ã‚Œã¾ã—ãŸï¼")}M(),B()}catch(t){q(t instanceof Error?t.message:"ã‚¯ãƒ¼ãƒãƒ³ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}finally{F(!1)}},className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ã‚¯ãƒ¼ãƒãƒ³ã‚¿ã‚¤ãƒˆãƒ« *"}),s.jsx("input",{value:I.title,onChange:e=>O({...I,title:e.target.value}),placeholder:"ä¾‹ï¼šåˆå›åˆ©ç”¨10%OFF",maxLength:100,required:!0,className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"å‰²å¼•è¨­å®š"}),s.jsxs("div",{className:"flex space-x-2 items-center",children:[s.jsxs("select",{value:I.discount_type,onChange:e=>O({...I,discount_type:e.target.value}),className:"border border-gray-300 rounded-md px-3 py-2 text-sm",children:[s.jsx("option",{value:"amount",children:"é‡‘é¡"}),s.jsx("option",{value:"percentage",children:"å‰²å¼•ç‡"}),s.jsx("option",{value:"free_gift",children:"ç„¡æ–™ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ"})]}),"free_gift"!==I.discount_type&&s.jsxs(s.Fragment,{children:[s.jsx("input",{type:"number",value:I.discount_value||"",onChange:e=>O({...I,discount_value:e.target.value?parseInt(e.target.value):void 0}),placeholder:"amount"===I.discount_type?"500":"10",className:"w-24 text-lg font-medium text-center border border-gray-300 rounded-md px-3 py-2"}),s.jsx("span",{className:"flex items-center text-lg text-gray-700 font-medium",children:"amount"===I.discount_type?"å††":"%"})]}),"free_gift"===I.discount_type&&s.jsx("span",{className:"text-lg text-green-600 font-medium",children:"ğŸ ç„¡æ–™ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ"})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ã‚µãƒ¼ãƒ“ã‚¹å†…å®¹ *"}),s.jsx("textarea",{value:I.service_content,onChange:e=>O({...I,service_content:e.target.value}),placeholder:"ãƒˆãƒªãƒŸãƒ³ã‚°10%OFF",rows:3,className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"è©³ç´°èª¬æ˜"}),s.jsx("textarea",{value:I.description,onChange:e=>O({...I,description:e.target.value}),placeholder:"ãŠã²ã¨ã‚Šæ§˜åˆå›1å›é™å®šã§ã™",rows:3,className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"é–‹å§‹æ—¥æ™‚ *"}),s.jsx("input",{type:"date",value:I.start_date,onChange:e=>O({...I,start_date:e.target.value}),required:!0,className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"çµ‚äº†æ—¥æ™‚ *"}),s.jsx("input",{type:"date",value:I.end_date,onChange:e=>O({...I,end_date:e.target.value}),required:!0,className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ä½¿ç”¨åˆ¶é™"}),s.jsxs("select",{value:I.usage_limit_type,onChange:e=>O({...I,usage_limit_type:e.target.value}),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm",children:[s.jsx("option",{value:"unlimited",children:"ä½•å›ã§ã‚‚"}),s.jsx("option",{value:"once",children:"1å›é™ã‚Š"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ã”ç”¨æ„é ‚ã„ãŸç”»åƒã«ã™ã‚‹å ´åˆã¯ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚"}),s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs(n,{type:"button",variant:"secondary",onClick:()=>document.getElementById("coupon-image-input")?.click(),className:"flex items-center",children:[s.jsx(b,{className:"w-4 h-4 mr-2"}),"ç”»åƒã‚’é¸æŠ"]}),z&&s.jsx(n,{type:"button",variant:"outline",onClick:()=>{U(""),T(null);const e={...I};delete e.coupon_image,O(e)},className:"text-red-600 hover:text-red-700",children:"ç”»åƒã‚’å‰Šé™¤"})]}),s.jsx("input",{id:"coupon-image-input",type:"file",accept:"image/*",onChange:e=>{const s=e.target.files?.[0];s&&(e=>{T(e),J(!0)})(s)},className:"hidden"})]})]}),s.jsx("div",{className:"space-y-4",children:s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ã‚¯ãƒ¼ãƒãƒ³ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼"}),s.jsx("div",{className:"w-full max-w-sm mx-auto",children:z?s.jsx("div",{className:"aspect-square w-full border-2 border-gray-300 rounded-lg overflow-hidden",children:s.jsx("img",{src:z,alt:"ã‚¯ãƒ¼ãƒãƒ³ç”»åƒ",className:"w-full h-full object-cover"})}):s.jsx("div",{className:"aspect-square w-full border-2 border-gray-300 rounded-lg relative overflow-hidden",children:s.jsxs("div",{className:"w-full h-full bg-gradient-to-br from-red-500 to-red-600 relative",children:[s.jsx("div",{className:"absolute top-1/2 -left-3 w-6 h-6 bg-white rounded-full transform -translate-y-1/2"}),s.jsx("div",{className:"absolute top-1/2 -right-3 w-6 h-6 bg-white rounded-full transform -translate-y-1/2"}),s.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-10",children:s.jsx("span",{className:"text-6xl font-bold text-white transform rotate-12",children:"COUPON"})}),s.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-center h-full p-4 text-center space-y-3",children:[s.jsx("div",{className:"bg-white/95 px-3 py-1 rounded-full shadow-sm",children:s.jsx("span",{className:"text-xs font-medium text-red-600",children:"ãƒ‰ãƒƒã‚°ãƒ‘ãƒ¼ã‚¯JPã‚¯ãƒ¼ãƒãƒ³"})}),s.jsx("div",{className:"text-white",children:s.jsx("h2",{className:"text-lg font-bold leading-tight",children:t})}),s.jsx("div",{className:"text-white",children:s.jsx("h3",{className:"text-xl font-bold leading-tight",children:I.title||"ã‚¯ãƒ¼ãƒãƒ³ã‚¿ã‚¤ãƒˆãƒ«"})}),s.jsx("div",{className:"text-white/90",children:s.jsx("p",{className:"text-base leading-tight",children:I.service_content||"ã‚µãƒ¼ãƒ“ã‚¹å†…å®¹"})}),"free_gift"===I.discount_type?s.jsxs("div",{className:"bg-white text-green-600 px-6 py-3 rounded-lg shadow-md",children:[s.jsx("span",{className:"text-4xl font-bold",children:"ğŸ"}),s.jsx("span",{className:"text-lg ml-2 font-medium",children:"ç„¡æ–™ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ"})]}):I.discount_value&&I.discount_type&&s.jsxs("div",{className:"bg-white text-red-600 px-6 py-3 rounded-lg shadow-md",children:[s.jsxs("span",{className:"text-4xl font-bold",children:[I.discount_value,"amount"===I.discount_type?"å††":"%"]}),s.jsx("span",{className:"text-lg ml-2 font-medium",children:"OFF"})]}),s.jsx("div",{className:"border-t border-white/30 pt-2",children:s.jsx("p",{className:"text-sm text-white/80",children:I.description||"è©³ç´°èª¬æ˜"})}),I.start_date&&I.end_date&&s.jsx("div",{className:"border-t border-white/30 pt-2 mt-2",children:s.jsxs("p",{className:"text-xs text-white/90 font-medium",children:["æœ‰åŠ¹æœŸé™: ",new Date(I.start_date).toLocaleDateString()," ã€œ ",new Date(I.end_date).toLocaleDateString()]})})]})]})})}),s.jsx("div",{className:"mt-2 text-xs text-gray-500 text-center",children:z?"ç”»åƒã‚¯ãƒ¼ãƒãƒ³":"ã‚¯ãƒ¼ãƒãƒ³"})]})})]}),s.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[s.jsx(n,{type:"button",variant:"secondary",onClick:M,disabled:E,children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),s.jsxs(n,{type:"submit",disabled:E,className:"flex items-center",children:[s.jsx(f,{className:"w-4 h-4 mr-2"}),S?"æ›´æ–°":"ä½œæˆ"]})]})]})]}),s.jsx("div",{className:"space-y-4",children:0===r.length?s.jsxs(c,{className:"p-8 text-center",children:[s.jsx(p,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"ã‚¯ãƒ¼ãƒãƒ³ãŒã‚ã‚Šã¾ã›ã‚“"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"æœ€åˆã®ã‚¯ãƒ¼ãƒãƒ³ã‚’ä½œæˆã—ã¦ãŠå®¢æ§˜ã«ãŠå¾—ãªã‚µãƒ¼ãƒ“ã‚¹ã‚’æä¾›ã—ã¾ã—ã‚‡ã†"}),s.jsxs(n,{onClick:()=>_(!0),children:[s.jsx(g,{className:"w-4 h-4 mr-2"}),"ã‚¯ãƒ¼ãƒãƒ³ä½œæˆ"]})]}):r.map(e=>s.jsx(c,{className:"p-6",children:s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"w-full max-w-sm mx-auto",children:[e.coupon_image_url?s.jsx("div",{className:"aspect-square w-full border-2 border-gray-300 rounded-lg overflow-hidden",children:s.jsx("img",{src:e.coupon_image_url,alt:"ã‚¯ãƒ¼ãƒãƒ³ç”»åƒ",className:"w-full h-full object-cover"})}):s.jsx("div",{className:"aspect-square w-full border-2 border-gray-300 rounded-lg relative overflow-hidden",children:s.jsxs("div",{className:"w-full h-full bg-gradient-to-br from-red-500 to-red-600 relative",children:[s.jsx("div",{className:"absolute top-1/2 -left-3 w-6 h-6 bg-white rounded-full transform -translate-y-1/2"}),s.jsx("div",{className:"absolute top-1/2 -right-3 w-6 h-6 bg-white rounded-full transform -translate-y-1/2"}),s.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-10",children:s.jsx("span",{className:"text-6xl font-bold text-white transform rotate-12",children:"COUPON"})}),s.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-center h-full p-4 text-center space-y-3",children:[s.jsx("div",{className:"bg-white/95 px-3 py-1 rounded-full shadow-sm",children:s.jsx("span",{className:"text-xs font-medium text-red-600",children:"ãƒ‰ãƒƒã‚°ãƒ‘ãƒ¼ã‚¯JPã‚¯ãƒ¼ãƒãƒ³"})}),s.jsx("div",{className:"text-white",children:s.jsx("h2",{className:"text-lg font-bold leading-tight",children:t})}),s.jsx("div",{className:"text-white",children:s.jsx("h3",{className:"text-xl font-bold leading-tight",children:e.title})}),s.jsx("div",{className:"text-white/90",children:s.jsx("p",{className:"text-base leading-tight",children:e.service_content})}),e.discount_value&&e.discount_type&&s.jsxs("div",{className:"bg-white text-red-600 px-6 py-3 rounded-lg shadow-md",children:[s.jsxs("span",{className:"text-4xl font-bold",children:[e.discount_value,"amount"===e.discount_type?"å††":"%"]}),s.jsx("span",{className:"text-lg ml-2 font-medium",children:"OFF"})]}),e.description&&s.jsx("div",{className:"border-t border-white/30 pt-2",children:s.jsx("p",{className:"text-sm text-white/80",children:e.description})}),e.start_date&&e.end_date&&s.jsx("div",{className:"border-t border-white/30 pt-2 mt-2",children:s.jsxs("p",{className:"text-xs text-white/90 font-medium",children:["æœ‰åŠ¹æœŸé™: ",new Date(e.start_date).toLocaleDateString()," ã€œ ",new Date(e.end_date).toLocaleDateString()]})})]})]})}),s.jsx("div",{className:"mt-2 text-xs text-gray-500 text-center",children:e.coupon_image_url?"ç”»åƒã‚¯ãƒ¼ãƒãƒ³":"ã‚¯ãƒ¼ãƒãƒ³"})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("span",{className:"px-3 py-1 text-sm font-medium rounded-full "+(e.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.is_active?"æœ‰åŠ¹":"ç„¡åŠ¹"}),s.jsx("span",{className:"px-3 py-1 text-sm font-medium rounded-full bg-blue-100 text-blue-800",children:"once"===e.usage_limit_type?"1å›é™ã‚Š":"ä½•å›ã§ã‚‚"})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"æœŸé–“ï¼š"}),s.jsxs("div",{className:"flex items-center text-sm",children:[s.jsx(j,{className:"w-4 h-4 mr-1 text-gray-400"}),new Date(e.start_date).toLocaleDateString()," ã€œ",new Date(e.end_date).toLocaleDateString()]})]}),l[e.id]&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"å–å¾—æ•°ï¼š"}),s.jsxs("div",{className:"flex items-center text-sm",children:[s.jsx(y,{className:"w-4 h-4 mr-1 text-gray-400"}),l[e.id].total_obtained,"äºº"]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"ä½¿ç”¨æ•°ï¼š"}),s.jsxs("div",{className:"flex items-center text-sm",children:[s.jsx(p,{className:"w-4 h-4 mr-1 text-gray-400"}),l[e.id].total_used,"å›"]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"ä½¿ç”¨ç‡ï¼š"}),s.jsxs("div",{className:"font-medium text-sm",children:[l[e.id].usage_rate,"%"]})]})]})]}),s.jsxs("div",{className:"flex flex-col space-y-2",children:[s.jsxs(n,{variant:"secondary",onClick:()=>(e=>{k(e),O({title:e.title||"",description:e.description||"",service_content:e.service_content||"",discount_value:e.discount_value||0,discount_type:e.discount_type||"percentage",start_date:e.start_date?e.start_date.split("T")[0]:"",end_date:e.end_date?e.end_date.split("T")[0]:"",usage_limit_type:e.usage_limit_type||"unlimited"}),U(e.coupon_image_url||""),_(!0),setTimeout(()=>{window.scrollTo({top:0,behavior:"smooth"})},100)})(e),className:"w-full",children:[s.jsx(N,{className:"w-4 h-4 mr-2"}),"ç·¨é›†"]}),s.jsx(n,{variant:e.is_active?"secondary":"primary",onClick:()=>(async e=>{try{const{error:s}=await d.from("facility_coupons").update({is_active:!e.is_active}).eq("id",e.id);if(s)throw s;$(e.is_active?"ã‚¯ãƒ¼ãƒãƒ³ã‚’ç„¡åŠ¹åŒ–ã—ã¾ã—ãŸã€‚":"ã‚¯ãƒ¼ãƒãƒ³ã‚’æœ‰åŠ¹åŒ–ã—ã¾ã—ãŸã€‚"),B()}catch(s){q("ã‚¯ãƒ¼ãƒãƒ³ã®çŠ¶æ…‹å¤‰æ›´ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}})(e),className:"w-full",children:e.is_active?"ç„¡åŠ¹åŒ–":"æœ‰åŠ¹åŒ–"}),s.jsxs(n,{variant:"danger",onClick:()=>(async e=>{if(window.confirm("ã“ã®ã‚¯ãƒ¼ãƒãƒ³ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚"))try{const{error:s}=await d.from("facility_coupons").delete().eq("id",e);if(s)throw s;$("ã‚¯ãƒ¼ãƒãƒ³ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚"),B()}catch(s){q("ã‚¯ãƒ¼ãƒãƒ³ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}})(e.id),className:"w-full",children:[s.jsx(v,{className:"w-4 h-4 mr-2"}),"å‰Šé™¤"]})]})]})]})},e.id))}),s.jsx(c,{className:"mt-6",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[s.jsx(w,{className:"w-5 h-5 mr-2 text-blue-600"}),"ã‚¯ãƒ¼ãƒãƒ³ã«ã¤ã„ã¦"]}),s.jsxs("div",{className:"space-y-3 text-sm text-gray-700",children:[s.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[s.jsx("h4",{className:"font-semibold text-blue-800 mb-2",children:"ğŸ“± ã‚¯ãƒ¼ãƒãƒ³ã®è¡¨ç¤ºæ–¹æ³•"}),s.jsx("p",{className:"text-blue-700",children:"ã‚¯ãƒ¼ãƒãƒ³ã¯ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã€ãŠå®¢æ§˜ãŒåº—èˆ—ã§æç¤ºã—ã¾ã™ã€‚"})]}),s.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[s.jsx("h4",{className:"font-semibold text-yellow-800 mb-2",children:"ğŸ”’ 1å›é™ã‚Šã‚¯ãƒ¼ãƒãƒ³ã®ä»•çµ„ã¿"}),s.jsx("p",{className:"text-yellow-700 mb-2",children:"ã€ŒãŠã²ã¨ã‚Šæ§˜1å›é™ã‚Šã€ã®ã‚¯ãƒ¼ãƒãƒ³ã¯ã€1ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¤ã1å›ã®ã¿å–å¾—å¯èƒ½ã§ã™ã€‚"}),s.jsx("p",{className:"text-yellow-700 mb-2",children:"â€¢ ãŠå®¢æ§˜ãŒã‚¯ãƒ¼ãƒãƒ³ã‚’è¡¨ç¤ºã—ãŸæ®µéšã§è‡ªå‹•å‰Šé™¤ã•ã‚Œã¾ã™"}),s.jsx("p",{className:"text-yellow-700",children:"â€¢ 2å›ç›®ä»¥é™ã¯ä½¿ç”¨ã§ããªããªã‚Šã€å†è¡¨ç¤ºã‚‚ã§ãã¾ã›ã‚“"})]}),s.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[s.jsx("h4",{className:"font-semibold text-green-800 mb-2",children:"â™»ï¸ ä½•å›ã§ã‚‚ã‚¯ãƒ¼ãƒãƒ³ã®ä»•çµ„ã¿"}),s.jsx("p",{className:"text-green-700 mb-2",children:"ã€Œä½•å›ã§ã‚‚ã€ã®ã‚¯ãƒ¼ãƒãƒ³ã¯ã€æœ‰åŠ¹æœŸé™å†…ã§ã‚ã‚Œã°ä½•åº¦ã§ã‚‚ä½¿ç”¨å¯èƒ½ã§ã™ã€‚"}),s.jsx("p",{className:"text-green-700",children:"â€¢ åŒã˜ãŠå®¢æ§˜ãŒè¤‡æ•°å›åˆ©ç”¨ã§ãã¾ã™ï¼ˆæœŸé™å†…ï¼‰"})]}),s.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[s.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"â° æœ‰åŠ¹æœŸé™ã«ã¤ã„ã¦"}),s.jsx("p",{className:"text-gray-700",children:"è¨­å®šã—ãŸæœ‰åŠ¹æœŸé™ã‚’éãã‚‹ã¨ã€ã‚¯ãƒ¼ãƒãƒ³ã¯è‡ªå‹•çš„ã«ç„¡åŠ¹ã«ãªã‚Šã¾ã™ã€‚"})]}),s.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[s.jsx("h4",{className:"font-semibold text-purple-800 mb-2",children:"ğŸ”„ ã‚¯ãƒ¼ãƒãƒ³ç·¨é›†æ™‚ã®å†å–å¾—æ©Ÿèƒ½"}),s.jsx("p",{className:"text-purple-700 mb-2",children:"åº—èˆ—ãŒã‚¯ãƒ¼ãƒãƒ³ã‚’ç·¨é›†ï¼ˆæœ‰åŠ¹æœŸé™å»¶é•·ãªã©ï¼‰ã—ãŸå ´åˆã€æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ã—ã¦ä½œæˆã•ã‚Œã¾ã™ã€‚"}),s.jsxs("p",{className:"text-purple-700 mb-2",children:["â€¢ ",s.jsx("strong",{children:"1å›é™ã‚Šã‚¯ãƒ¼ãƒãƒ³ã‚’ä½¿ç”¨æ¸ˆã¿"}),"ã®ãŠå®¢æ§˜ã‚‚ã€ç·¨é›†å¾Œã¯",s.jsx("strong",{children:"æ–°ã—ã„ã‚¯ãƒ¼ãƒãƒ³ã¨ã—ã¦å†å–å¾—å¯èƒ½"}),"ã«ãªã‚Šã¾ã™"]}),s.jsx("p",{className:"text-purple-700 mb-2",children:"â€¢ ç·¨é›†å‰ã®å¤ã„ã‚¯ãƒ¼ãƒãƒ³ã¯è‡ªå‹•çš„ã«ç„¡åŠ¹åŒ–ã•ã‚Œã€æ–°ã—ã„ã‚¯ãƒ¼ãƒãƒ³IDãŒç”Ÿæˆã•ã‚Œã¾ã™"}),s.jsx("p",{className:"text-purple-700",children:"â€¢ ã“ã‚Œã«ã‚ˆã‚Šã€æœ‰åŠ¹æœŸé™å»¶é•·ãªã©ã®éš›ã«ãŠå®¢æ§˜ãŒä¸åˆ©ç›Šã‚’è¢«ã‚‹ã“ã¨ãªãã€ç¶™ç¶šã—ã¦ã‚¯ãƒ¼ãƒãƒ³ã‚’ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™"})]})]})]})}),A&&L&&s.jsx(x,{imageFile:L,onCropComplete:e=>{const s=URL.createObjectURL(e);U(s),O({...I,coupon_image:e}),T(e),J(!1)},onCancel:()=>J(!1),aspectRatio:1})]})}const L={pet_hotel:"ãƒšãƒƒãƒˆãƒ›ãƒ†ãƒ«",pet_salon:"ãƒšãƒƒãƒˆã‚µãƒ­ãƒ³",veterinary:"å‹•ç‰©ç—…é™¢",pet_cafe:"ãƒšãƒƒãƒˆã‚«ãƒ•ã‚§",pet_restaurant:"ãƒšãƒƒãƒˆåŒä¼´ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³",pet_shop:"ãƒšãƒƒãƒˆã‚·ãƒ§ãƒƒãƒ—",pet_accommodation:"ãƒšãƒƒãƒˆåŒä¼´å®¿æ³Š",dog_training:"ã—ã¤ã‘æ•™å®¤",pet_friendly_other:"ãã®ä»–ãƒ¯ãƒ³ã¡ã‚ƒã‚“åŒä¼´å¯èƒ½æ–½è¨­"};function T(){const y=t(),{id:w}=r(),{user:T}=o(),A=i(),[J,z]=a.useState(null),[U,B]=a.useState([]),[M,P]=a.useState(!0),[Y,R]=a.useState(!1),[G,W]=a.useState(""),[H,V]=a.useState(""),[X,Z]=a.useState(!1),[Q,K]=a.useState(""),[ee,se]=a.useState(!1),[te,ae]=a.useState([]),[re,ie]=a.useState(!1),[le,ne]=a.useState(null),[de,ce]=a.useState(null),[oe,me]=a.useState(!1),[xe,he]=a.useState({name:"",category_id:"",address:"",phone:"",website:"",description:"",latitude:null,longitude:null,is_public:!1}),[ue,pe]=a.useState(!1),[ge,be]=a.useState("info"),[fe,je]=a.useState(!1),[ye,Ne]=a.useState(60),[ve,we]=a.useState(90),[_e,Se]=a.useState(10),[ke,Ce]=a.useState(!0),[qe,De]=a.useState(!1),[$e,Ie]=a.useState("ã”äºˆç´„ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸã€‚ãŠæ°—ã‚’ã¤ã‘ã¦ãŠè¶Šã—ãã ã•ã„ã€‚"),[Oe,Ee]=a.useState([]),[Fe,Le]=a.useState(""),[Te,Ae]=a.useState([!1,!1,!1,!1,!1,!1,!1]),[Je,ze]=a.useState("09:00"),[Ue,Be]=a.useState("18:00"),[Me,Pe]=a.useState([]),[Ye,Re]=a.useState([]),[Ge,We]=a.useState(new Date),[He,Ve]=a.useState(""),[Xe,Ze]=a.useState("all"),[Qe,Ke]=a.useState([]),[es,ss]=a.useState(!1),[ts,as]=a.useState(null),[rs,is]=a.useState(""),[ls,ns]=a.useState(!1);a.useEffect(()=>{(async()=>{if("reservation"===ge&&J)try{const e=e=>{let s=d.from("facility_reservations").select(e?"id,user_id,customer_name,seat_code,reserved_date,start_time,end_time,status":"id,user_id,seat_code,reserved_date,start_time,end_time,status").eq("facility_id",J.id).order("reserved_date",{ascending:!0}).order("start_time",{ascending:!0});return He&&(s=s.eq("reserved_date",He)),"all"!==Xe&&(s=s.eq("status",Xe)),s};let{data:s,error:t}=await e(!0);if(t&&/customer_name/i.test(String(t.message))){const t=await e(!1);s=(await t).data}Ke(s||[])}catch(e){Ke([])}})()},[ge,J,He,Xe]);const ds=e=>{switch(e){case"pending":return"äºˆç´„ç”³è«‹";case"confirmed":return"äºˆç´„å®Œäº†";case"cancelled":return"ã‚­ãƒ£ãƒ³ã‚»ãƒ«";default:return e}};a.useEffect(()=>{T&&w?cs():A("/my-facilities-management")},[T,w,A]);const cs=async()=>{try{P(!0);const{data:s,error:t}=await d.from("pet_facilities").select("*").eq("id",w).eq("owner_id",T?.id).single();if(t)throw t;if(!s)return void A("/my-facilities-management");if(z(s),he({name:s.name||"",category_id:s.category_id||"",address:s.address||"",phone:s.phone||"",website:s.website||"",description:s.description||"",latitude:s.latitude||null,longitude:s.longitude||null,is_public:s.is_public||!1}),s.opening_time&&ze(s.opening_time),s.closing_time&&Be(s.closing_time),s.weekly_closed_days)try{const e=JSON.parse(s.weekly_closed_days);Array.isArray(e)&&7===e.length&&Ae(e)}catch(e){}try{const{data:e}=await d.from("facility_reservation_settings").select("*").eq("facility_id",w).maybeSingle();e&&(je(Boolean(e.enabled)),Ne(e.slot_unit_minutes||60),we(e.allowed_days_ahead||90),Se(e.capacity_per_slot||10),Ce(Boolean(e.auto_confirm)),De(Boolean(e.auto_message_enabled)),e.auto_message_text&&Ie(e.auto_message_text));const{data:s}=await d.from("facility_seats").select("seat_code").eq("facility_id",w);Ee((s||[]).map(e=>e.seat_code))}catch(e){}if(s.specific_closed_dates)try{const e=JSON.parse(s.specific_closed_dates);Array.isArray(e)&&Pe(e)}catch(e){}if(s.specific_open_dates)try{const e=JSON.parse(s.specific_open_dates);Array.isArray(e)&&Re(e)}catch(e){}s.identity_document_url;const{data:a,error:r}=await d.from("pet_facility_images").select("*").eq("facility_id",w).order("display_order",{ascending:!0});if(r)throw r;ae(a||[]);const{data:i,error:l}=await d.from("facility_categories").select("*").order("name");if(l)throw l;B(i||[]),P(!1)}catch(s){W("æ–½è¨­ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚"),P(!1)}},os=(e,s)=>{const t=e.target.files?.[0];t&&(t.type.startsWith("image/")?t.size>10485760?W("ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã¯10MBæœªæº€ã«ã—ã¦ãã ã•ã„ã€‚"):(ne(t),ce(s??null),ie(!0)):W("ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚"))},ms=async e=>{if(window.confirm("ã“ã®ç”»åƒã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ"))try{W("");const{error:s}=await d.from("pet_facility_images").delete().eq("id",e);if(s)throw s;ae(s=>s.filter(s=>s.id!==e));const t=te.filter(s=>s.id!==e);for(let e=0;e<t.length;e++){const s=0===e?"main":"additional";t[e].display_order===e&&t[e].image_type===s||await d.from("pet_facility_images").update({display_order:e,image_type:s}).eq("id",t[e].id)}V("ç”»åƒãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚"),cs(),setTimeout(()=>V(""),3e3)}catch(s){W("ç”»åƒã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}},xs=e=>{const{name:s,value:t}=e.target;he(e=>({...e,[s]:t}))},hs=async e=>{if(e.preventDefault(),J&&T){R(!0),W(""),V("");try{if(!xe.name.trim())throw new Error("æ–½è¨­åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");if(!xe.category_id)throw new Error("ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");if(!xe.address.trim())throw new Error("ä½æ‰€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");if(!xe.phone.trim())throw new Error("é›»è©±ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");const{error:e}=await d.from("pet_facilities").update({name:xe.name.trim(),category_id:xe.category_id,address:xe.address.trim(),phone:xe.phone.trim(),website:xe.website.trim()||null,description:xe.description.trim()||null,latitude:xe.latitude,longitude:xe.longitude,updated_at:(new Date).toISOString()}).eq("id",J.id);if(e)throw e;V("æ–½è¨­æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚"),await cs(),setTimeout(()=>{V("")},3e3)}catch(s){W(s instanceof Error?s.message:"æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}finally{R(!1)}}};if(M)return s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(!J)return s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"æ–½è¨­ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"}),s.jsx(l,{to:"/my-facilities-management",children:s.jsx(n,{children:"ç®¡ç†ç”»é¢ã«æˆ»ã‚‹"})})]})});return s.jsxs(s.Fragment,{children:[s.jsx(m,{title:`${J.name} - æ–½è¨­ç·¨é›†`,description:"ãƒšãƒƒãƒˆé–¢é€£æ–½è¨­ã®æƒ…å ±ã‚’ç·¨é›†ãƒ»ç®¡ç†ã—ã¾ã™ã€‚"}),s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsx("div",{className:"bg-white border-b",children:s.jsx("div",{className:"max-w-4xl mx-auto px-4 py-4",children:s.jsxs(l,{to:"/my-facilities-management",className:"flex items-center text-blue-600 hover:text-blue-800",children:[s.jsx(_,{className:"w-4 h-4 mr-2"}),"æ–½è¨­ç®¡ç†ä¸€è¦§ã«æˆ»ã‚‹"]})})}),s.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[s.jsx("div",{className:"bg-white rounded-lg border p-6 mb-6",children:s.jsxs("div",{className:"mb-2",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:J.name}),s.jsx("p",{className:"text-gray-600 mt-1",children:J.address}),"approved"===J.status&&s.jsx("div",{className:"mt-3",children:s.jsx(l,{to:`/parks?view=facilities&facility=${J.id}`,children:s.jsxs(n,{variant:"secondary",className:"w-full",children:[s.jsx(N,{className:"w-4 h-4 mr-2"}),"å…¬é–‹ãƒšãƒ¼ã‚¸"]})})}),s.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[(e=>{switch(e){case"approved":return s.jsx("span",{className:"px-2 py-1 text-xs font-semibold bg-green-100 text-green-800 rounded-full",children:"æ‰¿èªæ¸ˆã¿"});case"pending":return s.jsx("span",{className:"px-2 py-1 text-xs font-semibold bg-yellow-100 text-yellow-800 rounded-full",children:"å¯©æŸ»ä¸­"});case"rejected":return s.jsx("span",{className:"px-2 py-1 text-xs font-semibold bg-red-100 text-red-800 rounded-full",children:"å´ä¸‹"});default:return s.jsx("span",{className:"px-2 py-1 text-xs font-semibold bg-gray-100 text-gray-800 rounded-full",children:"ä¸æ˜"})}})(J.status),s.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full "+(xe.is_public?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:xe.is_public?"å…¬é–‹":"éå…¬é–‹"})]})]})}),G&&s.jsxs("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4 mb-6",children:[s.jsx(S,{className:"w-5 h-5 inline mr-2"}),G]}),H&&s.jsxs("div",{className:"bg-green-100 border border-green-300 text-green-800 rounded-lg p-4 mb-6",children:[s.jsx(k,{className:"w-5 h-5 inline mr-2"}),H]}),s.jsxs("div",{className:"bg-white rounded-lg border mb-6",children:[s.jsx("div",{className:"border-b",children:s.jsxs("nav",{className:"flex flex-wrap gap-3 sm:gap-6 px-4",children:[s.jsxs("button",{onClick:()=>be("info"),className:"py-3 px-3 border-b-2 font-medium text-sm whitespace-nowrap w-1/3 sm:w-auto text-center "+("info"===ge?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[s.jsx(C,{className:"w-4 h-4 inline mr-2"}),"åŸºæœ¬æƒ…å ±"]}),s.jsxs("button",{onClick:()=>be("images"),className:"py-3 px-3 border-b-2 font-medium text-sm whitespace-nowrap w-1/3 sm:w-auto text-center "+("images"===ge?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[s.jsx(b,{className:"w-4 h-4 inline mr-2"}),"ç”»åƒç®¡ç†"]}),s.jsxs("button",{onClick:()=>be("location"),className:"py-3 px-3 border-b-2 font-medium text-sm whitespace-nowrap w-1/3 sm:w-auto text-center "+("location"===ge?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[s.jsx(q,{className:"w-4 h-4 inline mr-2"}),"ä½ç½®èª¿æ•´"]}),s.jsxs("button",{onClick:()=>be("schedule"),className:"py-3 px-3 border-b-2 font-medium text-sm whitespace-nowrap w-1/3 sm:w-auto text-center "+("schedule"===ge?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[s.jsx(j,{className:"w-4 h-4 inline mr-2"}),"å–¶æ¥­æ—¥ç®¡ç†"]}),s.jsxs("button",{onClick:()=>be("coupons"),className:"py-3 px-3 border-b-2 font-medium text-sm whitespace-nowrap w-1/3 sm:w-auto text-center "+("coupons"===ge?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[s.jsx(p,{className:"w-4 h-4 inline mr-2"}),"ã‚¯ãƒ¼ãƒãƒ³ç®¡ç†","active"!==y.state&&s.jsx("span",{className:"ml-1 text-yellow-600",title:"ãƒ—ãƒ¬ãƒŸã‚¢ãƒ é™å®š",children:"ğŸ”’"})]}),s.jsxs("button",{onClick:()=>be("reservation"),className:"py-3 px-3 border-b-2 font-medium text-sm whitespace-nowrap w-1/3 sm:w-auto text-center "+("reservation"===ge?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[s.jsx(j,{className:"w-4 h-4 inline mr-2"}),"äºˆç´„ç®¡ç†","active"!==y.state&&s.jsx("span",{className:"ml-1 text-yellow-600",title:"ãƒ—ãƒ¬ãƒŸã‚¢ãƒ é™å®š",children:"ğŸ”’"})]})]})}),s.jsxs("div",{className:"p-6",children:["info"===ge&&s.jsxs("div",{children:[s.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[s.jsx(C,{className:"w-6 h-6 text-blue-600 mr-2"}),"æ–½è¨­æƒ…å ±ã®ç·¨é›†"]}),s.jsxs("form",{onSubmit:hs,className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"æ–½è¨­å *"}),s.jsx(h,{name:"name",value:xe.name,onChange:xs,placeholder:"æ–½è¨­åã‚’å…¥åŠ›",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ã‚«ãƒ†ã‚´ãƒª *"}),s.jsxs("select",{name:"category_id",value:xe.category_id,onChange:xs,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[s.jsx("option",{value:"",children:"ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠ"}),U.map(e=>s.jsx("option",{value:e.id,children:L[e.name]||e.name},e.id))]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ä½æ‰€ *"}),s.jsx(h,{name:"address",value:xe.address,onChange:xs,placeholder:"ä½æ‰€ã‚’å…¥åŠ›",required:!0})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"é›»è©±ç•ªå·"}),s.jsx(h,{name:"phone",value:xe.phone,onChange:xs,placeholder:"é›»è©±ç•ªå·ã‚’å…¥åŠ›",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆ"}),s.jsx(h,{name:"website",value:xe.website,onChange:xs,placeholder:"https://example.com"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"æ–½è¨­èª¬æ˜"}),s.jsx("textarea",{name:"description",value:xe.description,onChange:xs,rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"æ–½è¨­ã®ç‰¹å¾´ã‚„ã‚µãƒ¼ãƒ“ã‚¹å†…å®¹ã‚’å…¥åŠ›"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"æ–½è¨­ç”»åƒ (æœ€å¤§5æš)"}),s.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"1æšç›®ãŒãƒ¡ã‚¤ãƒ³ç”»åƒã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚æ–½è¨­ã®é›°å›²æ°—ãŒã‚ã‹ã‚‹ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 mb-4",children:[te.map((e,t)=>s.jsxs("div",{className:"relative group",children:[s.jsx("div",{className:"aspect-square bg-gray-100 rounded-lg overflow-hidden border-2 border-gray-200",children:s.jsx("img",{src:e.image_url,alt:`æ–½è¨­ç”»åƒ ${t+1}`,className:"w-full h-full object-cover"})}),s.jsx("div",{className:"absolute top-2 left-2",children:s.jsx("span",{className:"bg-blue-600 text-white text-xs font-medium px-2 py-1 rounded",children:0===t?"ãƒ¡ã‚¤ãƒ³":t+1})}),s.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:s.jsxs("div",{className:"flex space-x-1",children:[s.jsx("input",{type:"file",accept:"image/*",onChange:e=>os(e,t),className:"hidden",id:`basic-image-replace-${t}`}),s.jsx("label",{htmlFor:`basic-image-replace-${t}`,className:"bg-white text-gray-600 p-1 rounded shadow hover:bg-gray-50 cursor-pointer",title:"ç”»åƒã‚’å¤‰æ›´",children:s.jsx(b,{className:"w-4 h-4"})}),s.jsx("button",{type:"button",onClick:()=>ms(e.id),className:"bg-red-500 text-white p-1 rounded shadow hover:bg-red-600",title:"ç”»åƒã‚’å‰Šé™¤",children:s.jsx(v,{className:"w-4 h-4"})})]})})]},e.id)),te.length<5&&s.jsxs("div",{className:"aspect-square bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center hover:border-blue-400 hover:bg-blue-50 transition-colors",children:[s.jsx("input",{type:"file",accept:"image/*",onChange:e=>os(e),className:"hidden",id:"basic-image-add"}),s.jsxs("label",{htmlFor:"basic-image-add",className:"flex flex-col items-center cursor-pointer text-gray-500 hover:text-blue-600",children:[s.jsx(g,{className:"w-8 h-8 mb-2"}),s.jsx("span",{className:"text-sm font-medium",children:"ç”»åƒã‚’è¿½åŠ "})]})]})]}),0===te.length&&s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx(D,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),s.jsx("p",{className:"text-sm",children:"ã¾ã ç”»åƒãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“"}),s.jsx("p",{className:"text-xs mt-1",children:"æœ€åˆã®ç”»åƒãŒãƒ¡ã‚¤ãƒ³ç”»åƒã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¾ã™"})]})]}),s.jsx("div",{className:"flex justify-end",children:s.jsxs(n,{type:"submit",isLoading:Y,children:[s.jsx(f,{className:"w-4 h-4 mr-2"}),"æ›´æ–°"]})})]})]}),"reservation"===ge&&s.jsxs("div",{children:[s.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[s.jsx(j,{className:"w-6 h-6 text-blue-600 mr-2"}),"äºˆç´„ç®¡ç†"]}),"active"!==y.state&&s.jsx("div",{className:"max-w-2xl mb-6",children:s.jsxs("div",{className:"p-4 border rounded bg-yellow-50",children:[s.jsx("div",{className:"font-semibold mb-1",children:"ã“ã®æ©Ÿèƒ½ã¯ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä¼šå“¡é™å®šã§ã™ï¼ˆåˆæœˆç„¡æ–™ï¼‰"}),s.jsxs("div",{className:"text-sm",children:["æœˆé¡Â¥500ã® ",s.jsx("strong",{children:"ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã‚ªãƒ¼ãƒŠãƒ¼ä¼šå“¡"})," ã«ã¯ã€",s.jsx("strong",{children:"äºˆç´„ç®¡ç†"}),"ï¼ˆå—ä»˜ãƒ»ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ»ä¸Šé™åˆ¶å¾¡ï¼‰ã«åŠ ãˆã¦",s.jsx("strong",{children:"ã‚¯ãƒ¼ãƒãƒ³ç®¡ç†"}),"ï¼ˆç™ºè¡Œãƒ»é…å¸ƒãƒ»ä½¿ç”¨å±¥æ­´ï¼‰ã‚‚å«ã¾ã‚Œã¾ã™ã€‚"]})]})}),s.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"æ™‚é–“å˜ä½ã®äºˆç´„ã€å®¢å¸­ã‚³ãƒ¼ãƒ‰ã€å—ä»˜æœŸé–“ã‚’è¨­å®šã—ã¾ã™ã€‚å…¬é–‹ãƒšãƒ¼ã‚¸ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒäºˆç´„ã§ãã¾ã™ã€‚"}),s.jsxs("div",{className:"bg-white rounded-lg border p-4 mb-6 space-y-3",children:[s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("label",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"checkbox",className:"h-4 w-4",checked:fe,onChange:e=>je(e.target.checked),disabled:"active"!==y.state}),s.jsx("span",{children:"äºˆç´„ã‚’å—ã‘ä»˜ã‘ã‚‹"})]})}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-gray-700",children:"äºˆç´„å˜ä½"}),s.jsx("select",{className:"border rounded px-2 py-1",value:ye,onChange:e=>Ne(Number(e.target.value)),disabled:"active"!==y.state,children:[15,30,45,60,90,120].map(e=>s.jsxs("option",{value:e,children:[e,"åˆ†"]},e))})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-gray-700",children:"å—ä»˜å¯èƒ½æ—¥æ•°"}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"number",min:1,max:365,className:"border rounded px-2 py-1 w-24 text-right",value:ve,onChange:e=>we(Number(e.target.value)),disabled:"active"!==y.state}),s.jsx("span",{className:"text-sm text-gray-600",children:"æ—¥å…ˆ"})]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-gray-700",children:"ä»®äºˆç´„ã®è‡ªå‹•æ‰¿èª"}),s.jsxs("label",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"checkbox",className:"h-4 w-4",checked:ke,onChange:e=>Ce(e.target.checked),disabled:"active"!==y.state}),s.jsx("span",{children:"è‡ªå‹•ã§äºˆç´„ç¢ºå®šã«ã™ã‚‹"})]})]}),s.jsxs("div",{className:"mt-2",children:[s.jsxs("label",{className:"flex items-center space-x-2 mb-2",children:[s.jsx("input",{type:"checkbox",className:"h-4 w-4",checked:qe,onChange:e=>De(e.target.checked),disabled:"active"!==y.state}),s.jsx("span",{className:"text-sm text-gray-700",children:"äºˆç´„ç¢ºå®šæ™‚ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è‡ªå‹•é€ä¿¡"})]}),s.jsx("textarea",{className:"w-full border rounded px-2 py-1 text-sm",rows:3,value:$e,onChange:e=>Ie(e.target.value),disabled:"active"!==y.state})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-gray-700",children:"åŒä¸€æ™‚é–“ã‚­ãƒ£ãƒ‘"}),s.jsx("input",{type:"number",min:1,max:1e3,className:"border rounded px-2 py-1 w-24 text-right",value:_e,onChange:e=>Se(Number(e.target.value)),disabled:"active"!==y.state})]}),s.jsx("div",{className:"flex justify-end pt-2",children:s.jsx(n,{onClick:async()=>{try{if(!J)return;const e=await d.from("facility_reservation_settings").upsert({facility_id:J.id,enabled:fe,slot_unit_minutes:ye,allowed_days_ahead:ve,auto_confirm:ke,auto_message_enabled:qe,auto_message_text:$e,capacity_per_slot:_e,updated_at:(new Date).toISOString()});if(e.error&&/auto_message_(enabled|text)/i.test(String(e.error.message))){const e=await d.from("facility_reservation_settings").upsert({facility_id:J.id,enabled:fe,slot_unit_minutes:ye,allowed_days_ahead:ve,auto_confirm:ke,capacity_per_slot:_e,updated_at:(new Date).toISOString()});if(e.error)throw e.error;V("äºˆç´„è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸï¼ˆè‡ªå‹•ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸åˆ—ãŒæœªé©ç”¨ã®ãŸã‚ä¸€éƒ¨è¨­å®šã¯ä¿ç•™ã•ã‚Œã¾ã—ãŸï¼‰ã€‚ç®¡ç†DBã§åˆ—ã‚’è¿½åŠ å¾Œã«å†ä¿å­˜ã—ã¦ãã ã•ã„ã€‚")}await d.from("facility_seats").delete().eq("facility_id",J.id),Oe.length>0&&await d.from("facility_seats").insert(Oe.map(e=>({facility_id:J.id,seat_code:e}))),/è‡ªå‹•ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸åˆ—ãŒæœªé©ç”¨/.test(H)||V("äºˆç´„è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚")}catch(e){W("äºˆç´„è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}},disabled:"active"!==y.state,children:"è¨­å®šã‚’ä¿å­˜"})})]}),s.jsxs("div",{className:"bg-white rounded-lg border p-4 mb-6",children:[s.jsx("h3",{className:"font-semibold mb-3",children:"å®¢å¸­ï¼ˆå¸­ã‚³ãƒ¼ãƒ‰ï¼‰"}),s.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"ä»»æ„ã§ã™ã€‚ç™»éŒ²ã™ã‚‹ã¨äºˆç´„æ™‚ã«ãŠå®¢ã•ã¾ãŒåº§å¸­ã‚’é¸æŠã—ã¦äºˆç´„ã§ãã¾ã™ã€‚æœªç™»éŒ²ã®å ´åˆã¯å…¬é–‹ãƒšãƒ¼ã‚¸ã®åº§å¸­æŒ‡å®šæ¬„ã¯éè¡¨ç¤ºã«ãªã‚Šã¾ã™ã€‚"}),s.jsxs("div",{className:"flex space-x-2 mb-3",children:[s.jsx("input",{className:"border rounded px-2 py-1 flex-1",placeholder:"ä¾‹: A1,B,4äººå¸­,å€‹å®¤ ãªã©",value:Fe,onChange:e=>Le(e.target.value)}),s.jsx(n,{onClick:()=>{const e=Fe.trim();e&&(Oe.includes(e)||(Ee(s=>[...s,e]),Le("")))},variant:"secondary",children:"è¿½åŠ "})]}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[Oe.map(e=>s.jsxs("div",{className:"px-3 py-1 bg-gray-100 rounded-full flex items-center space-x-2",children:[s.jsx("span",{children:e}),s.jsx("button",{className:"text-red-600",onClick:()=>{return s=e,Ee(e=>e.filter(e=>e!==s));var s},children:"Ã—"})]},e)),0===Oe.length&&s.jsx("p",{className:"text-sm text-gray-500",children:"ã¾ã å®¢å¸­ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“"})]})]}),s.jsxs("div",{className:"bg-white rounded-lg border p-4 mb-6",children:[s.jsx("h3",{className:"font-semibold mb-3",children:"äºˆç´„ä¸€è¦§"}),s.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"å¯¾è±¡æ—¥"}),s.jsx("input",{type:"date",className:"border rounded px-2 py-1",value:He,onChange:e=>Ve(e.target.value)}),He&&s.jsx("button",{className:"text-xs text-blue-600 underline",onClick:()=>Ve(""),children:"ã‚¯ãƒªã‚¢"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"çŠ¶æ…‹"}),s.jsxs("select",{className:"border rounded px-2 py-1",value:Xe,onChange:e=>Ze(e.target.value),children:[s.jsx("option",{value:"all",children:"ã™ã¹ã¦"}),s.jsx("option",{value:"pending",children:"æœªç¢ºå®š"}),s.jsx("option",{value:"confirmed",children:"ç¢ºå®šæ¸ˆã¿"})]})]})]}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"min-w-full text-sm",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"bg-gray-50",children:[s.jsx("th",{className:"text-left px-3 py-2 border",children:"æ—¥ä»˜"}),s.jsx("th",{className:"text-left px-3 py-2 border",children:"äºˆç´„è€…"}),s.jsx("th",{className:"text-left px-3 py-2 border",children:"å¸­"}),s.jsx("th",{className:"text-left px-3 py-2 border",children:"äºˆç´„æ™‚é–“"}),s.jsx("th",{className:"text-left px-3 py-2 border",children:"çŠ¶æ…‹"}),s.jsx("th",{className:"text-left px-3 py-2 border",children:"æ“ä½œ"})]})}),s.jsx("tbody",{children:0===Qe.length?s.jsx("tr",{children:s.jsx("td",{colSpan:4,className:"px-3 py-4 border text-center text-gray-500",children:"äºˆç´„ã¯ã‚ã‚Šã¾ã›ã‚“"})}):Qe.map((e,t)=>{return s.jsxs("tr",{className:"hover:bg-gray-50",children:[s.jsx("td",{className:"px-3 py-2 border",children:e.reserved_date}),s.jsx("td",{className:"px-3 py-2 border",children:e.customer_name||"â€”"}),s.jsx("td",{className:"px-3 py-2 border",children:e.seat_code}),s.jsx("td",{className:"px-3 py-2 border",children:(a=e.start_time,a?String(a).slice(0,5):"")}),s.jsx("td",{className:"px-3 py-2 border",children:ds(e.status)}),s.jsx("td",{className:"px-3 py-2 border",children:"pending"===e.status?s.jsx(n,{size:"sm",onClick:()=>(e=>{as(e),is(qe?$e||"ã”äºˆç´„ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸã€‚ãŠæ°—ã‚’ã¤ã‘ã¦ãŠè¶Šã—ãã ã•ã„ã€‚":""),ss(!0)})(e),children:"äºˆç´„ç¢ºå®š"}):s.jsx("span",{className:"text-gray-400",children:"â€”"})})]},t);var a})})]})})]}),s.jsx("div",{className:"text-xs text-gray-500",children:"å–¶æ¥­æ—¥ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã§ã€Œå–¶æ¥­æ—¥ã€ã®ã¿äºˆç´„å—ä»˜ã—ã¾ã™ã€‚å…¬é–‹ãƒšãƒ¼ã‚¸ã®æ–½è¨­è©³ç´°ã«äºˆç´„ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚"})]}),es&&s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:s.jsxs("div",{className:"bg-white rounded-lg w-full max-w-md p-4",children:[s.jsx("h4",{className:"font-semibold mb-3",children:"äºˆç´„ã‚’ç¢ºå®šã—ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡"}),s.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"äºˆç´„è€…ã¸ä»¥ä¸‹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¾ã™ã€‚"}),s.jsx("textarea",{className:"w-full border rounded px-2 py-1 text-sm",rows:4,value:rs,onChange:e=>is(e.target.value),placeholder:"ä¾‹: ã”äºˆç´„ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸã€‚ãŠæ°—ã‚’ã¤ã‘ã¦ãŠè¶Šã—ãã ã•ã„ã€‚"}),s.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[s.jsx(n,{variant:"secondary",onClick:()=>{ss(!1),is("")},children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),s.jsx(n,{onClick:async()=>{if(J&&ts)try{ns(!0);let s=!1;const t=await d.from("facility_reservations").update({status:"confirmed"}).eq("id",ts.id).select("id,status").maybeSingle();if(!t.error&&t.data)s=!0;else try{s=(await fetch("/.netlify/functions/owner-confirm-reservation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reservationId:ts.id})})).ok}catch{}if(!s)throw new Error("Failed to confirm reservation");Ke(e=>e.map(e=>e.id===ts.id?{...e,status:"confirmed"}:e));const a=rs&&rs.trim().length>0?rs.trim():qe?$e||"ã”äºˆç´„ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸã€‚ãŠæ°—ã‚’ã¤ã‘ã¦ãŠè¶Šã—ãã ã•ã„ã€‚":"";if(a){await d.from("community_messages").insert({user_id:T?.id,facility_id:J.id,content:a,context:"reservation"});try{(await d.from("notifications").insert({user_id:ts.user_id,title:"äºˆç´„å—ä»˜ãŒå®Œäº†ã—ã¾ã—ãŸ",message:`${J?.name||"åº—èˆ—"}: ${a}`,link_url:`${window.location.origin}/my-reservations`,read:!1,type:"reservation_reminder",data:{}})).error&&await fetch("/.netlify/functions/app-notify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:ts.user_id,title:"äºˆç´„å—ä»˜ãŒå®Œäº†ã—ã¾ã—ãŸ",message:`${J?.name||"åº—èˆ—"}: ${a}`,linkUrl:`${window.location.origin}/my-reservations`,kind:"reservation"})})}catch{}try{const{notifyAppAndLine:s}=await e(async()=>{const{notifyAppAndLine:e}=await import("./notify-C6OTkr81.js");return{notifyAppAndLine:e}},__vite__mapDeps([0]));await s({userId:ts.user_id,title:"äºˆç´„å—ä»˜ãŒå®Œäº†ã—ã¾ã—ãŸ",message:`${J?.name||"åº—èˆ—"}: ${a}`,linkUrl:`${window.location.origin}/my-reservations`,kind:"reservation"})}catch{}}const r=e=>{let s=d.from("facility_reservations").select(e?"id,user_id,customer_name,seat_code,reserved_date,start_time,end_time,status":"id,user_id,seat_code,reserved_date,start_time,end_time,status").eq("facility_id",J.id).order("reserved_date",{ascending:!0}).order("start_time",{ascending:!0});return He&&(s=s.eq("reserved_date",He)),"all"!==Xe&&(s=s.eq("status",Xe)),s};let i=await r(!0),l=i.data;if(i.error&&/customer_name/i.test(String(i.error.message))){l=(await r(!1)).data}Ke(l||[]),ss(!1),as(null),is(""),V("äºˆç´„ã‚’ç¢ºå®šã—ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚")}catch(s){W("äºˆç´„ç¢ºå®šã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}finally{ns(!1)}},isLoading:ls,children:"äºˆç´„ç¢ºå®šã—ã¦é€ä¿¡"})]})]})}),"images"===ge&&s.jsxs("div",{children:[s.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[s.jsx(b,{className:"w-6 h-6 text-blue-600 mr-2"}),"æ–½è¨­ç”»åƒã®ç®¡ç†"]}),s.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"æ–½è¨­ã®ç”»åƒã‚’ç®¡ç†ã—ã¾ã™ã€‚æœ€å¤§5æšã¾ã§ç™»éŒ²ã§ãã€æœ€åˆã®ç”»åƒãŒãƒ¡ã‚¤ãƒ³ç”»åƒã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 mb-4",children:[te.map((e,t)=>s.jsxs("div",{className:"relative group",children:[s.jsx("div",{className:"aspect-square bg-gray-100 rounded-lg overflow-hidden border-2 border-gray-200",children:s.jsx("img",{src:e.image_url,alt:`æ–½è¨­ç”»åƒ ${t+1}`,className:"w-full h-full object-cover"})}),s.jsx("div",{className:"absolute top-2 left-2",children:s.jsx("span",{className:"bg-blue-600 text-white text-xs font-medium px-2 py-1 rounded",children:0===t?"ãƒ¡ã‚¤ãƒ³":t+1})}),s.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:s.jsxs("div",{className:"flex space-x-1",children:[s.jsx("input",{type:"file",accept:"image/*",onChange:e=>os(e,t),className:"hidden",id:`images-tab-replace-${t}`}),s.jsx("label",{htmlFor:`images-tab-replace-${t}`,className:"bg-white text-gray-600 p-1 rounded shadow hover:bg-gray-50 cursor-pointer",title:"ç”»åƒã‚’å¤‰æ›´",children:s.jsx(b,{className:"w-4 h-4"})}),s.jsx("button",{type:"button",onClick:()=>ms(e.id),className:"bg-red-500 text-white p-1 rounded shadow hover:bg-red-600",title:"ç”»åƒã‚’å‰Šé™¤",children:s.jsx(v,{className:"w-4 h-4"})})]})})]},e.id)),te.length<5&&s.jsxs("div",{className:"aspect-square bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center hover:border-blue-400 hover:bg-blue-50 transition-colors",children:[s.jsx("input",{type:"file",accept:"image/*",onChange:e=>os(e),className:"hidden",id:"images-tab-add"}),s.jsxs("label",{htmlFor:"images-tab-add",className:"flex flex-col items-center cursor-pointer text-gray-500 hover:text-blue-600",children:[s.jsx(g,{className:"w-8 h-8 mb-2"}),s.jsx("span",{className:"text-sm font-medium",children:"ç”»åƒã‚’è¿½åŠ "})]})]})]}),0===te.length&&s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx(D,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),s.jsx("p",{className:"text-sm",children:"ã¾ã ç”»åƒãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“"}),s.jsx("p",{className:"text-xs mt-1",children:"æœ€åˆã®ç”»åƒãŒãƒ¡ã‚¤ãƒ³ç”»åƒã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¾ã™"})]})]}),"coupons"===ge&&J&&s.jsx("div",{children:"active"!==y.state?s.jsxs("div",{className:"max-w-2xl",children:[s.jsxs("div",{className:"mb-4 text-sm text-gray-700",children:["ã‚¯ãƒ¼ãƒãƒ³ç®¡ç†ã¯ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä¼šå“¡å‘ã‘æ©Ÿèƒ½ã§ã™ï¼ˆåˆæœˆç„¡æ–™ãƒ»æœˆé¡Â¥500ï¼‰ã€‚ ã“ã®ãƒ—ãƒ©ãƒ³ã«ã¯ ",s.jsx("strong",{children:"äºˆç´„ç®¡ç†"}),"ï¼ˆå—ä»˜ãƒ»ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ»ä¸Šé™åˆ¶å¾¡ï¼‰ã‚‚å«ã¾ã‚Œã¾ã™ã€‚"]}),s.jsx("div",{className:"mb-6",children:s.jsxs("div",{className:"p-4 border rounded bg-yellow-50",children:[s.jsx("div",{className:"font-semibold mb-1",children:"ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã‚ªãƒ¼ãƒŠãƒ¼ä¼šå“¡ï¼ˆæœˆé¡Â¥500ï¼åˆæœˆç„¡æ–™ï¼‰"}),s.jsx("div",{className:"text-sm mb-3",children:"ã‚¯ãƒ¼ãƒãƒ³ç™ºè¡Œãƒ»é…å¸ƒãƒ»ä½¿ç”¨å±¥æ­´ã«åŠ ãˆã¦ã€äºˆç´„ç®¡ç†ï¼ˆå—ä»˜ãƒ»ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ»ä¸Šé™åˆ¶å¾¡ï¼‰ã‚‚ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚"})]})})]}):s.jsx(F,{facilityId:J.id,facilityName:J.name})}),"schedule"===ge&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[s.jsx(j,{className:"w-6 h-6 text-blue-600 mr-2"}),"å–¶æ¥­æ—¥ç®¡ç†"]}),s.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"æ–½è¨­ã®å–¶æ¥­æ™‚é–“ã¨ä¼‘æ¥­æ—¥ã‚’è¨­å®šã§ãã¾ã™ã€‚"})]}),s.jsxs(c,{className:"p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[s.jsx($,{className:"w-5 h-5 text-green-600 mr-2"}),"å–¶æ¥­æ™‚é–“"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"é–‹åº—æ™‚é–“"}),s.jsx("input",{type:"time",value:Je,onChange:e=>ze(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"é–‰åº—æ™‚é–“"}),s.jsx("input",{type:"time",value:Ue,onChange:e=>Be(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),s.jsxs(c,{className:"p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[s.jsx(j,{className:"w-5 h-5 text-red-600 mr-2"}),"å®šä¼‘æ—¥è¨­å®š"]}),s.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"æ¯é€±ã®å®šä¼‘æ—¥ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚é¸æŠã—ãŸæ›œæ—¥ã¯è‡ªå‹•çš„ã«ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã§ã‚‚ä¼‘æ¥­æ—¥ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚"}),s.jsx("div",{className:"grid grid-cols-7 gap-2",children:["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"].map((e,t)=>s.jsxs("button",{onClick:()=>{const e=[...Te];e[t]=!e[t],Ae(e)},className:"py-3 px-2 text-sm font-medium rounded-lg border-2 transition-colors "+(Te[t]?"bg-red-100 border-red-300 text-red-700":"bg-gray-50 border-gray-200 text-gray-700 hover:bg-gray-100"),children:[e,Te[t]&&s.jsx("div",{className:"text-xs mt-1",children:"å®šä¼‘æ—¥"})]},t))})]}),s.jsxs(c,{className:"p-6",children:[s.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[s.jsx(j,{className:"w-5 h-5 text-blue-600 mr-2"}),"ä¼‘æ¥­æ—¥ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼"]}),s.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"ç‰¹å®šã®æ—¥ä»˜ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è‡¨æ™‚ä¼‘æ¥­æ—¥ã‚’è¨­å®šã§ãã¾ã™ã€‚å®šä¼‘æ—¥è¨­å®šã§é¸æŠã—ãŸæ›œæ—¥ã¯è‡ªå‹•çš„ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚"}),(()=>{const e=[];for(let s=0;s<3;s++){const t=new Date(Ge.getFullYear(),Ge.getMonth()+s,1),a=new Date(t.getFullYear(),t.getMonth(),1),r=new Date(t.getFullYear(),t.getMonth()+1,0).getDate(),i=a.getDay(),l=[];for(let e=0;e<i;e++)l.push(null);for(let e=1;e<=r;e++)l.push(new Date(t.getFullYear(),t.getMonth(),e));const n=[];for(let e=0;e<l.length;e+=7)n.push(l.slice(e,e+7));e.push({month:t,rows:n})}return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs(n,{onClick:()=>We(new Date(Ge.getFullYear(),Ge.getMonth()-1,1)),variant:"outline",size:"sm",children:[s.jsx(O,{className:"w-4 h-4"}),"å‰æœˆ"]}),s.jsxs("span",{className:"text-lg font-semibold",children:[Ge.getFullYear(),"å¹´",Ge.getMonth()+1,"æœˆã‹ã‚‰",3,"ã‹æœˆåˆ†"]}),s.jsxs(n,{onClick:()=>We(new Date(Ge.getFullYear(),Ge.getMonth()+1,1)),variant:"outline",size:"sm",children:["æ¬¡æœˆ",s.jsx(E,{className:"w-4 h-4"})]})]}),s.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:e.map((e,t)=>s.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[s.jsxs("h4",{className:"text-center font-semibold mb-4",children:[e.month.getFullYear(),"å¹´",e.month.getMonth()+1,"æœˆ"]}),s.jsx("div",{className:"grid grid-cols-7 gap-1 mb-2",children:["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"].map((e,t)=>s.jsx("div",{className:"text-center text-xs font-medium py-1 "+(0===t?"text-red-500":6===t?"text-blue-500":"text-gray-600"),children:e},e))}),s.jsx("div",{className:"space-y-1",children:e.rows.map((e,a)=>s.jsx("div",{className:"grid grid-cols-7 gap-1",children:e.map((e,r)=>{if(!e)return s.jsx("div",{className:"h-8"},`empty-${t}-${a}-${r}`);const i=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,l=e.getDay(),n=Te[l],d=Me.includes(i),c=Ye.includes(i),o=(new Date).toDateString()===e.toDateString(),m=e<new Date((new Date).setHours(0,0,0,0));return s.jsx("button",{onClick:()=>{m||(n?Re(c?e=>e.filter(e=>e!==i):e=>[...e,i]):Pe(d?e=>e.filter(e=>e!==i):e=>[...e,i]))},disabled:m,className:"h-8 text-xs rounded transition-colors "+(m?"text-gray-300 cursor-not-allowed":n&&!c?"bg-red-100 border-red-300 text-red-700 border":d?"bg-orange-100 border-orange-300 text-orange-700 border":o?"bg-blue-100 border-blue-300 text-blue-700 border font-bold":"bg-gray-50 border-gray-200 text-gray-700 hover:bg-gray-100 border"),children:e.getDate()},i)})},a))})]},t))}),s.jsxs("div",{className:"flex flex-wrap gap-4 text-xs",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-4 h-4 bg-red-100 border border-red-300 rounded"}),s.jsx("span",{children:"å®šä¼‘æ—¥"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-4 h-4 bg-orange-100 border border-orange-300 rounded"}),s.jsx("span",{children:"ç‰¹å®šä¼‘æ¥­æ—¥"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-4 h-4 bg-blue-100 border border-blue-300 rounded"}),s.jsx("span",{children:"ä»Šæ—¥"})]})]})]})})()]}),s.jsx("div",{className:"flex justify-end space-x-3",children:s.jsxs(n,{onClick:async()=>{if(J)try{R(!0),W(""),V("");const{error:e}=await d.from("pet_facilities").update({opening_time:Je,closing_time:Ue,weekly_closed_days:Te,specific_closed_dates:Me,specific_open_dates:Ye,updated_at:(new Date).toISOString()}).eq("id",J.id);if(e)throw e;V("å–¶æ¥­æ—¥è¨­å®šãŒä¿å­˜ã•ã‚Œã¾ã—ãŸã€‚"),setTimeout(()=>V(""),3e3)}catch(e){W(e instanceof Error?e.message:"å–¶æ¥­æ—¥è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}finally{R(!1)}},className:"bg-green-600 hover:bg-green-700",children:[s.jsx(f,{className:"w-4 h-4 mr-2"}),"å–¶æ¥­æ—¥è¨­å®šã‚’ä¿å­˜"]})})]}),"location"===ge&&s.jsxs("div",{children:[s.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[s.jsx(q,{className:"w-6 h-6 text-blue-600 mr-2"}),"æ–½è¨­ã®ä½ç½®èª¿æ•´"]}),s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:s.jsxs("p",{className:"text-blue-800 text-sm",children:[s.jsx("strong",{children:"ä½ç½®èª¿æ•´ã«ã¤ã„ã¦:"}),s.jsx("br",{}),"ä½æ‰€ã‹ã‚‰è‡ªå‹•çš„ã«ãƒãƒƒãƒ—ä¸Šã®ä½ç½®ã‚’ç‰¹å®šã—ã¾ã™ãŒã€æ­£ç¢ºã§ãªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚",s.jsx("br",{}),"èµ¤ã„ãƒãƒ¼ã‚«ãƒ¼ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã€å®Ÿéš›ã®æ–½è¨­ä½ç½®ã«èª¿æ•´ã—ã¦ãã ã•ã„ã€‚"]})}),s.jsx(u,{initialAddress:xe.address,initialLatitude:xe.latitude||void 0,initialLongitude:xe.longitude||void 0,onLocationChange:(e,s,t)=>{he(a=>({...a,latitude:e,longitude:s,...t&&t!==a.address?{address:t}:{}}))}}),s.jsx("div",{className:"flex justify-end",children:s.jsx(n,{type:"button",onClick:hs,disabled:Y||!xe.latitude||!xe.longitude,className:"min-w-[120px]",children:Y?s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"ä¿å­˜ä¸­..."]}):"ä½ç½®ã‚’ä¿å­˜"})})]})]})]})]}),"info"===ge&&"approved"===J?.status&&s.jsxs(c,{className:"p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[s.jsx(N,{className:"w-6 h-6 text-blue-600 mr-2"}),"å…¬é–‹è¨­å®š"]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-medium text-gray-900 mb-1",children:"æ–½è¨­ã®å…¬é–‹çŠ¶æ…‹"}),s.jsx("p",{className:"text-sm text-gray-600",children:"å…¬é–‹è¨­å®šã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ã§ã€æ–½è¨­ã‚’ä¸€è¦§ã«è¡¨ç¤ºã™ã‚‹ã‹ã©ã†ã‹ã‚’åˆ¶å¾¡ã§ãã¾ã™ã€‚"})]}),s.jsx("div",{className:"ml-4",children:s.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:xe.is_public,onChange:s=>(async t=>{if(w&&T)try{pe(!0),W("");const{error:a}=await d.from("pet_facilities").update({is_public:t,updated_at:(new Date).toISOString()}).eq("id",w).eq("owner_id",T?.id);if(a)throw a;if(he(e=>({...e,is_public:t})),z(e=>e?{...e,is_public:t}:null),V(t?"æ–½è¨­ã‚’å…¬é–‹ã—ã¾ã—ãŸ":"æ–½è¨­ã‚’éå…¬é–‹ã«ã—ã¾ã—ãŸ"),t||!t)try{const{notifyAppAndLineBoth:s}=await e(async()=>{const{notifyAppAndLineBoth:e}=await import("./notifyAll-Mk9ryJyc.js");return{notifyAppAndLineBoth:e}},__vite__mapDeps([0]));await s({userId:T.id,type:t?"facility_public_on":"facility_public_off",title:t?"æ–½è¨­ã‚’å…¬é–‹ã—ã¾ã—ãŸ":"æ–½è¨­ã‚’éå…¬é–‹ã«ã—ã¾ã—ãŸ",message:t?`${J?.name||"æ–½è¨­"}ãŒå…¬é–‹ã«ãªã‚Šã¾ã—ãŸã€‚å…¬é–‹ãƒšãƒ¼ã‚¸ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚`:`${J?.name||"æ–½è¨­"}ã‚’éå…¬é–‹ã«ã—ã¾ã—ãŸã€‚å¿…è¦ã«å¿œã˜ã¦å†åº¦å…¬é–‹ã—ã¦ãã ã•ã„ã€‚`,linkUrl:`${window.location.origin}/parks?view=facilities&facility=${w}`})}catch(s){}setTimeout(()=>V(""),3e3)}catch(a){W("å…¬é–‹è¨­å®šã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: "+a.message)}finally{pe(!1)}})(s.target.checked),disabled:ue,className:"sr-only peer"}),s.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})})]}),s.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[s.jsx("div",{className:"w-3 h-3 rounded-full "+(xe.is_public?"bg-green-500":"bg-yellow-500")}),s.jsx("span",{className:"font-medium",children:xe.is_public?"å…¬é–‹ä¸­":"éå…¬é–‹"})]}),!xe.is_public&&s.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(I,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-2"}),s.jsxs("div",{className:"text-sm text-yellow-800",children:[s.jsx("strong",{children:"æ³¨æ„:"})," éå…¬é–‹è¨­å®šä¸­ã¯ã€æ–½è¨­ãŒä¸€è¦§ã«è¡¨ç¤ºã•ã‚Œãšã€æ–°ã—ã„åˆ©ç”¨è€…ã‹ã‚‰ã®äºˆç´„ã‚’å—ã‘ä»˜ã‘ã§ãã¾ã›ã‚“ã€‚"]})]})})]})]}),"info"===ge&&s.jsx(c,{className:"p-6 border-red-200 bg-red-50",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(v,{className:"w-6 h-6 text-red-600 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-semibold text-red-900 mb-2",children:"å±é™ºãªæ“ä½œ"}),s.jsxs("p",{className:"text-sm text-red-800 mb-4",children:["ã“ã®æ–½è¨­ã‚’å®Œå…¨ã«å‰Šé™¤ã—ã¾ã™ã€‚å‰Šé™¤å¾Œã¯ãƒ‡ãƒ¼ã‚¿ã®å¾©æ—§ã¯ã§ãã¾ã›ã‚“ã€‚","approved"===J.status&&s.jsx("span",{className:"block mt-1 font-medium",children:"â€» æ‰¿èªæ¸ˆã¿ã®æ–½è¨­ã‚’å‰Šé™¤ã™ã‚‹ã¨ã€å…¬é–‹ãƒšãƒ¼ã‚¸ã‹ã‚‰ã‚‚å‰Šé™¤ã•ã‚Œã¾ã™ã€‚"})]}),s.jsxs(n,{onClick:()=>Z(!0),className:"bg-red-600 hover:bg-red-700 text-white",size:"sm",children:[s.jsx(v,{className:"w-4 h-4 mr-2"}),"æ–½è¨­ã‚’å‰Šé™¤"]})]})]})}),X&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx(v,{className:"w-6 h-6 text-red-600 mr-3"}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"æ–½è¨­ã®å‰Šé™¤ç¢ºèª"})]}),s.jsxs("div",{className:"mb-4",children:[s.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[s.jsx("span",{className:"font-medium text-red-600",children:"è­¦å‘Š:"})," ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚"]}),s.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["å‰Šé™¤ã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯ã€æ–½è¨­åã€Œ",s.jsx("span",{className:"font-medium",children:J.name}),"ã€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"]}),s.jsx("input",{type:"text",value:Q,onChange:e=>K(e.target.value),placeholder:"æ–½è¨­åã‚’å…¥åŠ›",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500"})]}),s.jsxs("div",{className:"flex justify-end space-x-3",children:[s.jsx(n,{onClick:()=>{Z(!1),K("")},variant:"secondary",disabled:ee,children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),s.jsxs(n,{onClick:async()=>{if(J&&Q===J.name){if(window.confirm("æœ¬å½“ã«ã“ã®æ–½è¨­ã‚’å®Œå…¨ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚"))try{se(!0),W("");const{data:s}=await d.from("profiles").select("role").eq("id",T?.id).single();try{await d.from("pet_facility_images").delete().eq("facility_id",J.id)}catch(e){}let t=d.from("pet_facilities").delete();t="admin"===s?.role?t.eq("id",J.id):t.eq("id",J.id).eq("owner_id",T?.id);const{error:a}=await t;if(a){if(a.message?.includes("RLS"))throw new Error("æ¨©é™ã‚¨ãƒ©ãƒ¼: ã“ã®æ–½è¨­ã‚’å‰Šé™¤ã™ã‚‹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚");throw new Error(`å‰Šé™¤å‡¦ç†ã‚¨ãƒ©ãƒ¼: ${a.message}`)}const{data:r,error:i}=await d.from("pet_facilities").select("id").eq("id",J.id).single();if(r){if("admin"!==s?.role)throw new Error("å‰Šé™¤ã™ã‚‹æ–½è¨­ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã€ã¾ãŸã¯å‰Šé™¤æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚");{const{error:e}=await d.rpc("force_delete_facility",{target_facility_id:J.id});if(e)throw new Error(`å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚ã‚¨ãƒ©ãƒ¼: ${e.message}`);const{data:s}=await d.from("pet_facilities").select("id").eq("id",J.id).single();if(s)throw new Error("æ–½è¨­ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚")}}else if(i&&"PGRST116"!==i.code)throw new Error(`å‰Šé™¤æ¤œè¨¼ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${i.message}`);V("æ–½è¨­ãŒæ­£å¸¸ã«å‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚"),setTimeout(()=>{A("/my-facilities-management")},3e3)}catch(s){W(`å‰Šé™¤å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${s.message}`)}finally{se(!1),Z(!1),K("")}}else W("æ–½è¨­åãŒæ­£ã—ãå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚")},className:"bg-red-600 hover:bg-red-700 text-white",disabled:ee||Q!==J.name,isLoading:ee,children:[s.jsx(v,{className:"w-4 h-4 mr-2"}),"å‰Šé™¤å®Ÿè¡Œ"]})]})]})}),re&&le&&s.jsx(x,{imageFile:le,onCropComplete:async e=>{if(J)try{me(!0),W("");const s=Date.now(),t=`facility_${J.id}_${s}.jpg`,{data:a,error:r}=await d.storage.from("vaccine-certs").upload(t,e,{contentType:"image/jpeg",upsert:!0});if(r)throw r;const{data:i}=d.storage.from("vaccine-certs").getPublicUrl(t),l=i.publicUrl;if(null===de){const{data:e,error:s}=await d.from("pet_facility_images").select("display_order").eq("facility_id",J.id).order("display_order",{ascending:!1}).limit(1);if(s)throw s;const t=e.length>0?e[0].display_order+1:0,a=0===t?"main":"additional",{data:r,error:i}=await d.from("pet_facility_images").insert({facility_id:J.id,image_url:l,image_type:a,display_order:t}).select().single();if(i)throw i;ae(e=>[...e,r].sort((e,s)=>e.display_order-s.display_order))}else{const e=te[de],{data:s,error:t}=await d.from("pet_facility_images").update({image_url:l,updated_at:(new Date).toISOString()}).eq("id",e.id).select().single();if(t)throw t;ae(e=>e.map(e=>e.id===s.id?s:e))}V("ç”»åƒãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã—ãŸã€‚"),setTimeout(()=>V(""),3e3)}catch(s){W("ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}finally{me(!1),ie(!1),ne(null),ce(null)}},onCancel:()=>{ie(!1),ne(null),ce(null)},aspectRatio:1,maxWidth:400,maxHeight:400}),"active"!==y.state&&s.jsx("div",{className:"max-w-4xl mx-auto px-4 py-6",children:s.jsx(n,{onClick:async()=>{try{const{data:e}=await d.auth.getSession(),s=e.session?.access_token,t="https://onmcivwxtzqajcovptgf.supabase.co/functions/v1/stripe-checkout",a=`${window.location.origin}/premium/success`,r=`${window.location.origin}/premium/cancel`,i=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json",apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9ubWNpdnd4dHpxYWpjb3ZwdGdmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkxODk3OTUsImV4cCI6MjA2NDc2NTc5NX0.AqFCz3GQUVeGaG2988LCzsE4aJpeio3xScoxv5T0-OU",Authorization:`Bearer ${s}`},body:JSON.stringify({mode:"subscription",price_id:"price_1S1xlxAHWLDQ7ynZEPzFnGJf",trial_period_days:30,success_url:a,cancel_url:r,notes:"premium_owner_subscription"})}),l=await i.json();if(!i.ok||!l?.url)throw new Error(l?.error||"checkout failed");window.location.href=l.url}catch(e){alert(`æ±ºæ¸ˆé–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸ: ${e?.message||e}`)}},className:"w-full bg-orange-500 hover:bg-orange-600",children:"ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä¼šå“¡åˆæœˆç„¡æ–™ã§è©¦ã™"})})]})]})]})}export{T as default};

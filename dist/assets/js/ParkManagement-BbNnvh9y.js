import{j as e,m as s,A as a}from"./motion-BHsL7Azw.js";import{r as t}from"./react-vendor-CMvmJHsS.js";import{c as l,a as i,L as r}from"./router-DXQOdrLL.js";import{u as n,f as c,p as d,d as x,e as m,B as o,g as h,m as p,t as j,s as u,i as b}from"./index-DP2YuyP4.js";import{C as g}from"./Card-DqVnP9TA.js";import{I as N}from"./ImageCropper-C46vhkR5.js";import{K as f,t as v,aI as y,x as w,R as _,q as k,a6 as S,C,n as I,F as q,aF as P,aG as T,d as E,M as O,_ as D,J as M,r as $,Q as z,aJ as F,aD as H,U as R,aK as A,aH as L,V as Q,a0 as U,as as J,j as B,X as G}from"./ui-basic-DDpq4BmP.js";import"./heavy-features-Dlg1c9Yc.js";import"./supabase-D2tiogv8.js";function K({lockId:l,parkName:i="ドッグパーク",purpose:r="entry",className:N="",onSuccess:I,onError:q,reservationId:P}){const{user:T}=n(),[E,O]=t.useState(null),[D,M]=t.useState(null),[$,z]=t.useState(null),[F,H]=t.useState(!1),[R,A]=t.useState(null),[L,Q]=t.useState(!1),[U,J]=t.useState(!1),[B,G]=t.useState(!1),[K,W]=t.useState(""),[Y,V]=t.useState(!1);t.useEffect(()=>{if(E&&D){const e=setInterval(()=>{const s=new Date,a=D.getTime()-s.getTime();if(a<=0)z("期限切れ"),O(null),M(null),clearInterval(e);else{const e=Math.floor(a/6e4),s=Math.floor(a%6e4/1e3);z(`${e}:${s.toString().padStart(2,"0")}`)}},1e3);return()=>clearInterval(e)}},[E,D]);const X=async()=>{if(T){H(!0),A(null);try{const{data:{session:e}}=await u.auth.getSession();if(!e?.access_token)throw new Error("認証が必要です");let s=5,a=null;if(P){const e=await(async e=>{try{const{data:s,error:a}=await u.from("reservations").select("\n          *,\n          dog_park:dog_parks(*),\n          dog:dogs(*)\n        ").eq("id",e).single();return a?null:s}catch(s){return null}})(P);if(e&&"whole_facility"===e.reservation_type&&(a=(e=>{try{const s=new Date(e.date),a=e.start_time.split(":").map(Number),t=a[0]??0,l=a[1]??0;return s.setHours(t,l,0,0),new Date(s.getTime()+60*e.duration*60*1e3)}catch(s){return null}})(e),a)){const e=new Date,t=a.getTime()-e.getTime();s=Math.max(1,Math.ceil(t/6e4))}}const t=await fetch("https://onmcivwxtzqajcovptgf.supabase.co/functions/v1/generate-pin",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.access_token}`},body:JSON.stringify({lock_id:l,purpose:r,expiry_minutes:s,reservation_id:P||void 0})});if(!t.ok){const e=await t.json();throw new Error(e.error||"PINコードの生成に失敗しました")}const{pin:i,expires_at:n}=await t.json();O(i),M(new Date(n)),V(!0),J(!0),await b(),I&&I(i),setTimeout(()=>{J(!1),V(!1)},3e3)}catch(e){const s=e instanceof Error?e.message:"PINコードの生成に失敗しました";if(s.startsWith("PAYMENT_REQUIRED:")){const e=s.replace("PAYMENT_REQUIRED:","").trim();W(e),G(!0),A(null)}else A(s),G(!1);q&&q(s)}finally{H(!1)}}};return e.jsx(s.div,{className:N,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},children:e.jsx(g,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs(s.h3,{className:"text-lg font-semibold mb-4 flex items-center justify-center",variants:c,initial:"initial",animate:"animate",children:[e.jsx(s.div,{animate:Y?{rotate:[0,15,-15,0]}:{},transition:{duration:.6,repeat:2},children:e.jsx(f,{className:"w-5 h-5 text-blue-600 mr-2"})}),i,"の","entry"===r?"入口":"出口"]}),e.jsx(a,{mode:"wait",children:E?e.jsxs(s.div,{className:"space-y-4",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.3},children:[e.jsxs(s.div,{className:"bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg border-2 border-blue-200 mx-auto",variants:d,initial:"initial",animate:Y?"animate":"initial",children:[e.jsx("p",{className:"text-sm text-blue-800 mb-1",children:"PINコード:"}),e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(s.p,{className:"text-3xl font-bold tracking-widest text-blue-700",initial:{scale:1},animate:Y?{scale:[1,1.1,1]}:{},transition:{duration:.6},children:E}),e.jsx(s.button,{onClick:async()=>{if(E)try{await navigator.clipboard.writeText(E),Q(!0),await j(),setTimeout(()=>Q(!1),2e3)}catch{}},className:"p-1 text-blue-600 hover:text-blue-800 transition-colors",title:"コピー",variants:x,whileHover:"hover",whileTap:"tap",children:e.jsx(a,{mode:"wait",children:L?e.jsx(s.div,{variants:m,initial:"initial",animate:"animate",exit:{scale:0,opacity:0},children:e.jsx(v,{className:"w-5 h-5 text-green-600"})},"copied"):e.jsx(s.div,{variants:m,initial:"initial",animate:"animate",exit:{scale:0,opacity:0},children:e.jsx(y,{className:"w-5 h-5"})},"copy")})})]})]}),e.jsx(s.div,{className:"bg-yellow-50 p-2 rounded-lg",variants:c,children:e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-yellow-800",children:[e.jsx(s.div,{animate:{rotate:[0,360]},transition:{duration:2,repeat:1/0,ease:"linear"},children:e.jsx(w,{className:"w-4 h-4"})}),e.jsxs("span",{className:"font-medium",children:["有効期限: ",$]})]})}),e.jsx("div",{className:"flex justify-center space-x-3",children:e.jsx(s.div,{variants:x,whileHover:"hover",whileTap:"tap",children:e.jsxs(o,{onClick:()=>{X()},variant:"secondary",size:"sm",isLoading:F,children:[e.jsx(_,{className:"w-4 h-4 mr-1"}),"再生成"]})})}),e.jsxs(s.p,{className:"text-xs text-gray-500",variants:c,children:["entry"===r?"入場":"退場","時にスマートロックのキーパッドに上記のPINコードを入力してください"]})]},"pin-display"):e.jsxs(s.div,{className:"space-y-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:[e.jsxs(s.p,{className:"text-gray-600 mb-4",variants:c,children:["entry"===r?"入場":"退場","用のPINコードを生成します。",e.jsx("br",{}),"生成されたPINコードは5分間有効です。"]}),e.jsxs(a,{children:[R&&e.jsxs(s.div,{className:"bg-red-50 p-3 rounded-lg flex items-center justify-center text-red-600",variants:h,initial:"initial",animate:"shake",exit:{opacity:0,y:-10},children:[e.jsx(k,{className:"w-4 h-4 mr-1"}),e.jsx("span",{children:R})]}),B&&e.jsxs(s.div,{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",variants:p,initial:"initial",animate:"animate",exit:"exit",children:[e.jsxs("div",{className:"flex items-start space-x-3 mb-4",children:[e.jsx(S,{className:"w-6 h-6 text-blue-600 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"決済が必要です"}),e.jsx("p",{className:"text-sm text-blue-800 mb-4",children:K})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(s.div,{variants:x,whileHover:"hover",whileTap:"tap",children:e.jsxs(o,{onClick:()=>window.location.href="/subscription-intro",className:"w-full bg-purple-600 hover:bg-purple-700",children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"サブスクリプションに加入（¥3,800/月）"]})}),e.jsx(s.div,{variants:x,whileHover:"hover",whileTap:"tap",children:e.jsxs(o,{onClick:()=>window.location.href="/parks",variant:"secondary",className:"w-full",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"1日券を購入（¥800）"]})})]}),e.jsxs("p",{className:"text-xs text-blue-700 mt-3",children:["• サブスクリプション：全国のドッグランが使い放題",e.jsx("br",{}),"• 1日券：選択したドッグランで24時間利用可能"]})]}),U&&e.jsxs(s.div,{className:"bg-green-50 p-3 rounded-lg flex items-center justify-center text-green-600",variants:m,initial:"initial",animate:"animate",exit:{opacity:0,scale:.8},children:[e.jsx(v,{className:"w-4 h-4 mr-1"}),e.jsx("span",{children:"🎉 PINコードを生成しました"})]})]}),e.jsx(s.div,{variants:x,whileHover:"hover",whileTap:"tap",children:e.jsxs(o,{onClick:()=>{X()},isLoading:F,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700",children:[e.jsx(f,{className:"w-4 h-4 mr-2"}),"🚀 ","entry"===r?"入場":"退場","用PINを生成"]})})]},"pin-generate")})]})})})}const W={overview:{label:"施設全景",description:"ドッグランの全体が見渡せる写真",icon:I,required:!0},entrance:{label:"入口",description:"入口の様子がわかる写真",icon:O,required:!0},gate:{label:"スマートロック",description:"ドッグランのスマートロック（入退場管理）の写真",icon:E,required:!0},large_dog_area:{label:"大型犬エリア",description:"大型犬用のエリアの写真",icon:I,required:!1,conditionalOn:"large_dog_area"},small_dog_area:{label:"小型犬エリア",description:"小型犬用のエリアの写真",icon:I,required:!1,conditionalOn:"small_dog_area"},private_booth:{label:"プライベートブース",description:"プライベートブースの内部と外観",icon:I,required:!1,conditionalOn:"private_booths"},parking:{label:"駐車場",description:"駐車場の様子がわかる写真",icon:T,required:!1,conditionalOn:"facilities.parking"},shower:{label:"シャワー設備",description:"シャワー設備の写真",icon:P,required:!1,conditionalOn:"facilities.shower"},restroom:{label:"トイレ",description:"トイレ設備の写真",icon:q,required:!1,conditionalOn:"facilities.restroom"},agility:{label:"アジリティ設備",description:"アジリティ設備の写真",icon:I,required:!1,conditionalOn:"facilities.agility"},rest_area:{label:"休憩スペース",description:"休憩スペースの写真",icon:I,required:!1,conditionalOn:"facilities.rest_area"},water_station:{label:"給水設備",description:"給水設備の写真",icon:I,required:!1,conditionalOn:"facilities.water_station"}};function Y(){const{id:s}=l(),{user:a}=n();i();const[c,d]=t.useState(null),[x,m]=t.useState(!0),[h,p]=t.useState(""),[j,b]=t.useState(""),[y,w]=t.useState("overview"),[_,S]=t.useState([]),[P,T]=t.useState(null),[E,O]=t.useState("entry"),[Y,V]=t.useState([]),[X,Z]=t.useState(!1),[ee,se]=t.useState({title:"",description:"",start_date:"",end_date:"",is_emergency:!1,notify_users:!0}),[ae,te]=t.useState(!1),[le,ie]=t.useState(!1),[re,ne]=t.useState(!1),[ce,de]=t.useState(!1),[xe,me]=t.useState(!1),[oe,he]=t.useState(""),[pe,je]=t.useState(!1),[ue,be]=t.useState({max_capacity:0,facilities:{parking:!1,shower:!1,restroom:!1,agility:!1,rest_area:!1,water_station:!1},large_dog_area:!1,small_dog_area:!1,private_booths:!1,private_booth_count:0,facility_details:"",description:""}),[ge,Ne]=t.useState([]),[fe,ve]=t.useState(!1),[ye,we]=t.useState(""),[_e,ke]=t.useState(null),[Se,Ce]=t.useState(!1),[Ie,qe]=t.useState(null);t.useEffect(()=>{s&&a&&Pe()},[s,a]),t.useEffect(()=>{c&&Te()},[c]);const Pe=async()=>{if(s&&a)try{m(!0),p("");const{data:e,error:t}=await u.from("dog_parks").select("*").eq("id",s).eq("owner_id",a.id).single();if(t)throw new Error("ドッグランが見つかりません");d(e);const{data:l,error:i}=await u.from("smart_locks").select("*").eq("park_id",s);!i&&l&&(S(l),l.length>0&&T(l[0]))}catch(e){p(e.message||"データの取得に失敗しました")}finally{m(!1)}},Te=async()=>{if(c)try{const{data:e,error:s}=await u.from("dog_park_facility_images").select("*").eq("park_id",c.id);if(s&&"PGRST116"!==s.code)return;const a=Object.entries(W).filter(([,e])=>{if(e.required)return!0;if(e.conditionalOn&&c){const s=e.conditionalOn.split(".");if(1===s.length)return c[s[0]]??!1;if(2===s.length){const e=c[s[0]];if(e&&"object"==typeof e)return e[s[1]]??!1}}return!1}).map(([e])=>e).map(s=>{const a=(e||[]).find(e=>e.image_type===s);return{id:a?.id,image_type:s,image_url:a?.image_url,is_approved:a?.is_approved??null,admin_notes:a?.admin_notes}});Ne(a)}catch(e){}};return x?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):c?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-4",children:e.jsxs(r,{to:"/my-parks-management",className:"flex items-center text-blue-600 hover:text-blue-800",children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"管理中ドッグラン一覧に戻る"]})})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[x&&e.jsx("div",{className:"flex justify-center items-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),!x&&c&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white rounded-lg border p-6 mb-6",children:e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:c.name}),e.jsx("p",{className:"text-gray-600 mt-1",children:c.address}),e.jsxs("div",{className:"flex items-center mt-2",children:[e.jsx(M,{className:"w-4 h-4 text-yellow-400 fill-current mr-1"}),e.jsx("span",{className:"text-sm font-medium",children:c.average_rating.toFixed(1)}),e.jsxs("span",{className:"text-sm text-gray-500 ml-1",children:["(",c.review_count,"件)"]})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(r,{to:`/parks/${c.id}`,children:e.jsxs(o,{variant:"secondary",className:"min-w-[100px]",children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"公開ページ"]})}),e.jsxs(o,{onClick:()=>ie(!0),className:"min-w-[100px]",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"設定編集"]})]})]})}),h&&e.jsxs("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4 flex items-start",children:[e.jsx(k,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsx("p",{children:h})]}),j&&e.jsxs("div",{className:"bg-green-100 border border-green-300 text-green-800 rounded-lg p-4 flex items-start",children:[e.jsx(v,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsx("p",{children:j})]}),e.jsx(g,{className:"mb-6",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("div",{className:"flex space-x-8 px-6",children:[e.jsxs("button",{className:"py-4 px-2 border-b-2 font-medium text-sm transition-colors "+("overview"===y?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),onClick:()=>w("overview"),children:[e.jsx(I,{className:"w-4 h-4 inline mr-2"}),"概要"]}),e.jsxs("button",{className:"py-4 px-2 border-b-2 font-medium text-sm transition-colors "+("stats"===y?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),onClick:()=>w("stats"),children:[e.jsx(M,{className:"w-4 h-4 inline mr-2"}),"統計・収益"]}),e.jsxs("button",{className:"py-4 px-2 border-b-2 font-medium text-sm transition-colors "+("pins"===y?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),onClick:()=>w("pins"),children:[e.jsx(f,{className:"w-4 h-4 inline mr-2"}),"PINコード管理"]}),e.jsxs("button",{className:"py-4 px-2 border-b-2 font-medium text-sm transition-colors "+("settings"===y?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),onClick:()=>w("settings"),children:[e.jsx(F,{className:"w-4 h-4 inline mr-2"}),"設定"]})]})})}),"overview"===y&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(g,{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[e.jsx(q,{className:"w-6 h-6 text-blue-600 mr-2"}),"基本情報"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"施設情報"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"住所:"})," ",c.address]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"ステータス:"})," ","approved"===c.status?"運営中":"審査中"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"料金:"})," ¥",c.price||"800","/日"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"最大収容人数:"})," ",c.max_capacity||"未設定","人"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"現在の利用者数:"})," ",c.current_occupancy||0,"人"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"評価:"})," ★",c.average_rating?.toFixed(1)||"0.0"," (",c.review_count||0,"件)"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"設備情報"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries({parking:"駐車場",shower:"シャワー設備",restroom:"トイレ",agility:"アジリティ設備",rest_area:"休憩スペース",water_station:"給水設備"}).map(([s,a])=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 rounded "+(c.facilities?.[s]?"bg-green-500":"bg-gray-300")}),e.jsx("span",{className:"text-sm",children:a})]},s))}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"大型犬エリア:"})," ",c.large_dog_area?"あり":"なし"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"小型犬エリア:"})," ",c.small_dog_area?"あり":"なし"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"プライベートブース:"})," ",c.private_booths?`${c.private_booth_count||1}室`:"なし"]})]})]})]})]}),e.jsxs(g,{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[e.jsx(C,{className:"w-6 h-6 text-blue-600 mr-2"}),"今日の統計"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(C,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-medium text-blue-900",children:"今日の予約"})]}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:"5件"}),e.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"前日比 +2件"})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(H,{className:"w-5 h-5 text-green-600"}),e.jsx("h4",{className:"font-medium text-green-900",children:"今日の収益"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:"¥4,000"}),e.jsx("p",{className:"text-xs text-green-700 mt-1",children:"前日比 +¥1,600"})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(R,{className:"w-5 h-5 text-purple-600"}),e.jsx("h4",{className:"font-medium text-purple-900",children:"利用者数"})]}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:[c.current_occupancy,"人"]}),e.jsxs("p",{className:"text-xs text-purple-700 mt-1",children:["最大: ",c.max_capacity,"人"]})]})]})]})]}),"stats"===y&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(g,{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[e.jsx(M,{className:"w-6 h-6 text-blue-600 mr-2"}),"利用統計"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(C,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-medium text-blue-900",children:"今月の予約"})]}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:"32件"}),e.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"前月比 +12%"})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(H,{className:"w-5 h-5 text-green-600"}),e.jsx("h4",{className:"font-medium text-green-900",children:"今月の収益"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:"¥25,600"}),e.jsx("p",{className:"text-xs text-green-700 mt-1",children:"前月比 +8%"})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(R,{className:"w-5 h-5 text-purple-600"}),e.jsx("h4",{className:"font-medium text-purple-900",children:"利用者数"})]}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:"128人"}),e.jsx("p",{className:"text-xs text-purple-700 mt-1",children:"前月比 +15%"})]})]}),e.jsx("div",{className:"h-64 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"利用統計グラフ（実装予定）"})})]}),e.jsxs(g,{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[e.jsx(H,{className:"w-6 h-6 text-blue-600 mr-2"}),"収益情報"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-3",children:"収益配分"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-800 mb-1",children:"オーナー取り分（80%）"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:"¥20,480"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-800 mb-1",children:"プラットフォーム手数料（20%）"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:"¥5,120"})]})]})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-green-900 mb-3",children:"収益内訳"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-800 mb-1",children:"通常利用"}),e.jsx("p",{className:"text-xl font-bold text-green-600",children:"¥12,800"}),e.jsx("p",{className:"text-xs text-green-700",children:"16件"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-800 mb-1",children:"施設貸し切り"}),e.jsx("p",{className:"text-xl font-bold text-green-600",children:"¥8,800"}),e.jsx("p",{className:"text-xs text-green-700",children:"2件"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-800 mb-1",children:"プライベートブース"}),e.jsx("p",{className:"text-xl font-bold text-green-600",children:"¥4,000"}),e.jsx("p",{className:"text-xs text-green-700",children:"2件"})]})]})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-purple-900 mb-3",children:"振込情報"}),e.jsx("p",{className:"text-sm text-purple-800 mb-2",children:"振込は毎月15日に前月分を一括で行います。振込手数料は当社負担です。"}),e.jsx(r,{to:"/owner-payment-system",children:e.jsxs(o,{size:"sm",className:"bg-purple-600 hover:bg-purple-700",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"振込情報を確認"]})})]})]})]})]}),"pins"===y&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(g,{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[e.jsx(f,{className:"w-6 h-6 text-blue-600 mr-2"}),"オーナー用PINコード発行"]}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg mb-6",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(v,{className:"w-5 h-5 text-blue-600 mt-1 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"オーナー特権"}),e.jsx("p",{children:"オーナーは決済不要でPINコードを発行できます。施設の管理やメンテナンスに使用してください。"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"PINコードは5分間有効です"}),e.jsx("li",{children:"入場・退場それぞれでPINコードが必要です"}),e.jsx("li",{children:"スタッフと共有することもできます"}),e.jsx("li",{children:"管理用途なので決済は不要です"})]})]})]})}),e.jsxs("div",{className:"flex justify-center space-x-4 mb-4",children:[e.jsxs("button",{className:"px-6 py-3 rounded-lg flex items-center space-x-2 "+("entry"===E?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),onClick:()=>O("entry"),children:[e.jsx(D,{className:"w-5 h-5"}),e.jsx("span",{children:"入場"})]}),e.jsxs("button",{className:"px-6 py-3 rounded-lg flex items-center space-x-2 "+("exit"===E?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),onClick:()=>O("exit"),children:[e.jsx(D,{className:"w-5 h-5 rotate-180"}),e.jsx("span",{children:"退場"})]})]}),_.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"スマートロックを選択"}),e.jsx("select",{value:P?.id||"",onChange:e=>{const s=_.find(s=>s.id===e.target.value);T(s||null)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:_.map(s=>e.jsx("option",{value:s.id,children:s.lock_name},s.id))})]}),P?e.jsx("div",{className:"mt-6",children:e.jsx(K,{lockId:P.lock_id,parkName:c.name,purpose:E,onSuccess:e=>{b(`PINコード「${e}」を発行しました。有効期限は5分間です。`),setTimeout(()=>b(""),5e3)},onError:e=>{p(e),setTimeout(()=>p(""),5e3)}})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(f,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"スマートロックが設定されていません"}),e.jsx(o,{onClick:()=>w("settings"),children:"スマートロックを設定する"})]})]}),e.jsx(g,{className:"p-6 bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(f,{className:"w-6 h-6 text-blue-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"PINコードについて"}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-2",children:[e.jsx("p",{children:"• 利用者はPINコードを使用して入退場します"}),e.jsx("p",{children:"• PINコードは5分間有効で、利用者が支払い後に発行されます"}),e.jsx("p",{children:"• オーナーは決済不要でPINコードを発行できます"}),e.jsx("p",{children:"• 施設貸し切りの場合、利用者は友達にPINコードを共有できます"})]})]})]})})]}),"settings"===y&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(g,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(A,{className:"w-5 h-5 text-blue-600 mr-2"}),"基本設定"]}),e.jsx("p",{className:"text-gray-600 mb-4",children:"施設の基本情報や設備情報を編集できます。住所と料金は変更できません。"}),e.jsx(r,{to:`/parks/${c.id}/edit`,children:e.jsxs(o,{children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"基本情報を編集"]})})]}),e.jsxs(g,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(L,{className:"w-5 h-5 text-blue-600 mr-2"}),"施設画像管理"]}),e.jsx("p",{className:"text-gray-600 mb-6",children:"各設備の画像を管理できます。画像はすべて1:1でトリミングされ、最適化されます。"}),h&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700",children:h}),j&&e.jsx("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-lg text-green-700",children:j}),e.jsx("div",{className:"space-y-6",children:ge.map(s=>{const a=W[s.image_type],t=a?.icon||I;return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(t,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-medium text-gray-900",children:a?.label||s.image_type})]}),!0===s.is_approved&&e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full",children:"承認済み"}),!1===s.is_approved&&e.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full",children:"却下"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:a?.description||"画像をアップロードしてください"}),s.image_url?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"aspect-square w-48 bg-gray-100 rounded-lg overflow-hidden cursor-pointer",onClick:()=>qe(s.image_url||null),children:e.jsx("img",{src:s.image_url,alt:a?.label||s.image_type,className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://via.placeholder.com/400x400?text=Image+Not+Available"}})}),e.jsxs("div",{className:"absolute top-2 right-2 flex space-x-2",children:[e.jsx("button",{onClick:()=>qe(s.image_url||null),className:"p-1 bg-white rounded-full shadow hover:bg-gray-100",children:e.jsx($,{className:"w-4 h-4 text-blue-600"})}),e.jsx("button",{onClick:()=>handleImageDelete(s.id,s.image_type),className:"p-1 bg-white rounded-full shadow hover:bg-gray-100",disabled:Se,children:e.jsx(Q,{className:"w-4 h-4 text-red-600"})})]})]}),!1===s.is_approved&&s.admin_notes&&e.jsxs("div",{className:"p-3 bg-red-50 rounded-lg text-sm text-red-800",children:[e.jsx("p",{className:"font-medium",children:"却下理由:"}),e.jsx("p",{children:s.admin_notes})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"file",id:`replace-image-${s.image_type}`,accept:"image/*",className:"hidden",onChange:e=>{const a=e.target.files?.[0];a&&handleImageSelect(s.image_type,a)}}),e.jsxs("label",{htmlFor:`replace-image-${s.image_type}`,className:"cursor-pointer inline-flex items-center px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"画像を入れ替える"]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-500 transition-colors",children:[e.jsx("input",{type:"file",id:`upload-image-${s.image_type}`,accept:"image/*",className:"hidden",onChange:e=>{const a=e.target.files?.[0];a&&handleImageSelect(s.image_type,a)}}),e.jsxs("label",{htmlFor:`upload-image-${s.image_type}`,className:"cursor-pointer flex flex-col items-center",children:[e.jsx(J,{className:"w-8 h-8 text-gray-400 mb-2"}),e.jsx("span",{className:"text-sm text-gray-600",children:"クリックして画像を選択"})]})]}),s.file&&e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-3 rounded",children:[e.jsx("span",{className:"text-sm truncate",children:s.file.name}),e.jsx(o,{size:"sm",onClick:()=>handleImageUpload(s.image_type),disabled:Se,children:Se?"アップロード中...":"アップロード"})]})]})]},s.image_type)})})]}),e.jsxs(g,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(H,{className:"w-5 h-5 text-blue-600 mr-2"}),"料金設定"]}),e.jsx("p",{className:"text-gray-600 mb-4",children:"料金体系は全国統一です。変更はできません。"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-medium",children:"• 通常利用:"}),e.jsx("span",{children:"¥800/日 (固定)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-medium",children:"• 施設貸し切り:"}),e.jsx("span",{children:"¥4,400/時間 (固定)"})]})]})]})]}),e.jsxs(g,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[e.jsx(A,{className:"w-6 h-6 text-blue-600 mr-2"}),"メンテナンス管理"]}),e.jsxs(o,{onClick:()=>Z(!0),className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"メンテナンス予定を追加"]})]}),X&&e.jsxs(g,{className:"p-4 mb-6 bg-blue-50 border-blue-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900",children:"新しいメンテナンス予定"}),e.jsx("button",{onClick:()=>Z(!1),className:"text-blue-600 hover:text-blue-800",children:e.jsx(G,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:handleCreateMaintenance,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"メンテナンス内容 *"}),e.jsx("input",{type:"text",value:ee.title,onChange:e=>se(s=>({...s,title:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例：設備点検・清掃作業",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"開始日時 * (日本時間)"}),e.jsx("input",{type:"datetime-local",value:ee.start_date,onChange:e=>se(s=>({...s,start_date:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"日本時間で入力してください"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"終了日時 * (日本時間)"}),e.jsx("input",{type:"datetime-local",value:ee.end_date,onChange:e=>se(s=>({...s,end_date:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"日本時間で入力してください"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"詳細説明"}),e.jsx("textarea",{value:ee.description,onChange:e=>se(s=>({...s,description:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:"メンテナンス内容の詳細説明（任意）"})]}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:ee.is_emergency,onChange:e=>se(s=>({...s,is_emergency:e.target.checked})),className:"rounded border-gray-300 text-red-600 focus:ring-red-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"緊急メンテナンス"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:ee.notify_users,onChange:e=>se(s=>({...s,notify_users:e.target.checked})),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"ユーザーに通知"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(o,{type:"button",variant:"secondary",onClick:()=>Z(!1),children:"キャンセル"}),e.jsx(o,{type:"submit",isLoading:ae,className:"bg-blue-600 hover:bg-blue-700",children:"作成"})]})]})]}),e.jsx("div",{className:"space-y-4",children:0===Y.length?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(A,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"メンテナンス予定がありません"}),e.jsx("p",{className:"text-sm",children:"施設のメンテナンス予定を追加してください"})]}):Y.map(s=>{const a=getMaintenanceStatus(s);return e.jsx(g,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.title}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium text-white ${a.color}`,children:a.label}),s.is_emergency&&e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:"緊急"})]}),s.description&&e.jsx("p",{className:"text-gray-600 mb-3",children:s.description}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"開始:"})," ",formatMaintenanceDate(s.start_date)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"終了:"})," ",formatMaintenanceDate(s.end_date)]})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:"scheduled"===s.status&&e.jsx(o,{size:"sm",variant:"secondary",onClick:()=>handleDeleteMaintenance(s.id),className:"text-red-600 hover:text-red-800",children:e.jsx(G,{className:"w-4 h-4"})})})]})},s.id)})}),e.jsx("div",{className:"mt-6 p-4 bg-yellow-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(k,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"メンテナンス機能について"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• メンテナンス中は新規予約を受け付けません"}),e.jsx("li",{children:"• 既存の予約がある場合は事前に利用者に連絡してください"}),e.jsx("li",{children:"• 緊急メンテナンスの場合は即座に施設が利用停止になります"}),e.jsx("li",{children:"• ユーザー通知を有効にすると、利用者にメール通知が送信されます"})]})]})]})})]}),e.jsx(g,{className:"p-6 bg-gray-50",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(q,{className:"w-6 h-6 text-gray-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"運営サポート"}),e.jsxs("div",{className:"text-sm text-gray-700 space-y-1",children:[e.jsx("p",{children:"• 設定に関するご質問は運営事務局までお問い合わせください"}),e.jsx("p",{children:"• QRコードシステムの設置・設定サポートを提供しています"}),e.jsx("p",{children:"• 運営開始後も継続的なサポートを行います"}),e.jsx("p",{children:"• 📧 サポート窓口: info@dogparkjp.com"})]})]})]})})]})]}),fe&&_e&&e.jsx(N,{imageFile:_e,onCropComplete:handleCropComplete,onCancel:handleCropCancel,aspectRatio:1,maxWidth:400,maxHeight:400}),Ie&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"relative max-w-4xl w-full",children:[e.jsx("button",{onClick:()=>qe(null),className:"absolute top-4 right-4 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-75 z-10",children:e.jsx(G,{className:"w-6 h-6"})}),e.jsx("div",{className:"flex items-center justify-center h-[80vh]",children:e.jsx("img",{src:Ie,alt:"プレビュー",className:"max-h-full max-w-full object-contain"})})]})})]}):e.jsxs("div",{className:"max-w-4xl mx-auto text-center py-12",children:[e.jsx(k,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"ドッグランが見つかりません"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"指定されたドッグランが見つからないか、アクセス権限がありません。"}),e.jsx(r,{to:"/owner-dashboard",children:e.jsx(o,{children:"ダッシュボードに戻る"})})]})}export{Y as ParkManagement};

import{j as e}from"./motion-CuO0nkIV.js";import{r as s}from"./react-vendor-cniURDpR.js";import{a as t,L as a}from"./router-9ZtQ8-Nn.js";import{B as i}from"./Button-D1CO6kO-.js";import{C as l}from"./Card-roTxPFVC.js";import{s as r,u as c}from"./index-DRDL9Ed3.js";import{I as n}from"./Input-C-0g4Mlj.js";import{as as d,h as x,E as m,p as h,aM as o,O as j,H as p,c as u,s as g,aJ as N,aN as v,aO as f,o as y,l as b,aB as w,aL as _,U as k,aD as P,aP as I}from"./ui-basic-BXsWFU4S.js";import{g as S,a as C}from"./adminFraudDetection-T9eJWJF6.js";import"./supabase-hyP6cfTu.js";import"./heavy-features-BIdEME4r.js";const R=s.createContext({isMaintenanceActive:!1,maintenanceInfo:null,loading:!0,error:null,clientIP:null,isIPWhitelisted:!1,refreshMaintenanceStatus:async()=>{}}),M=()=>{const e=s.useContext(R);if(!e)throw new Error("useMaintenance must be used within a MaintenanceProvider");return e},D=({onError:t,onSuccess:a})=>{const{clientIP:c}=M(),[g,N]=s.useState([]),[v,f]=s.useState(!0),[y,b]=s.useState(!1),[w,_]=s.useState(null),[k,P]=s.useState({ip_address:"",description:"",is_active:!0});s.useEffect(()=>{I()},[]);const I=async()=>{try{f(!0);const{data:e,error:s}=await r.from("ip_whitelist").select("*").order("created_at",{ascending:!1});if(s)return void t(`IPホワイトリストの取得に失敗しました: ${s.message}`);N(e||[])}catch(e){t("IPホワイトリストの取得中にエラーが発生しました")}finally{f(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(l,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(d,{className:"w-5 h-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"現在のIPアドレス"}),e.jsx("p",{className:"text-sm text-gray-600",children:c||"取得中..."})]})]}),e.jsxs(i,{variant:"secondary",size:"sm",onClick:()=>{c&&(P({ip_address:`${c}/32`,description:"現在のIPアドレス",is_active:!0}),b(!0))},disabled:!c,children:[e.jsx(x,{className:"w-4 h-4 mr-1"}),"ホワイトリストに追加"]})]})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"IPホワイトリスト管理"}),e.jsxs(i,{onClick:()=>b(!0),className:"flex items-center space-x-2",children:[e.jsx(x,{className:"w-4 h-4"}),e.jsx("span",{children:"新規作成"})]})]}),y&&e.jsxs(l,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:w?"IPホワイトリスト編集":"IPホワイトリスト作成"}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),k.ip_address&&k.description)try{const e={ip_address:k.ip_address,description:k.description,is_active:k.is_active};if(w){const{error:s}=await r.from("ip_whitelist").update(e).eq("id",w.id);if(s)return void t(`IPホワイトリストの更新に失敗しました: ${s.message}`);a("IPホワイトリストを更新しました")}else{const{error:s}=await r.from("ip_whitelist").insert([e]);if(s)return void t(`IPホワイトリストの作成に失敗しました: ${s.message}`);a("IPホワイトリストを作成しました")}P({ip_address:"",description:"",is_active:!0}),b(!1),_(null),await I()}catch(s){t("IPホワイトリストの保存中にエラーが発生しました")}else t("IPアドレスと説明は必須です")},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["IPアドレス/CIDR ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(n,{type:"text",value:k.ip_address,onChange:e=>P({...k,ip_address:e.target.value}),placeholder:"例: 192.168.1.0/24 または 192.168.1.100/32",label:"IPアドレス/CIDR",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"CIDR形式で入力してください。単一IPの場合は /32 を付けてください。"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["説明 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(n,{type:"text",value:k.description,onChange:e=>P({...k,description:e.target.value}),placeholder:"例: 本社オフィス",label:"説明",required:!0})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:k.is_active,onChange:e=>P({...k,is_active:e.target.checked}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"is_active",className:"text-sm font-medium",children:"有効"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(i,{type:"button",variant:"secondary",onClick:()=>{b(!1),_(null),P({ip_address:"",description:"",is_active:!0})},children:"キャンセル"}),e.jsx(i,{type:"submit",children:w?"更新":"作成"})]})]})]}),e.jsxs(l,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"IPホワイトリスト一覧"}),v?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"text-gray-600",children:"読み込み中..."})}):0===g.length?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"IPホワイトリストエントリがありません"}):e.jsx("div",{className:"space-y-4",children:g.map(s=>{return e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[(c=s.ip_address,c.includes("127.0.0.1")||c.includes("::1")?e.jsx(p,{className:"w-4 h-4 text-blue-500"}):c.includes("192.168.")||c.includes("10.")||c.includes("172.")?e.jsx(u,{className:"w-4 h-4 text-green-500"}):e.jsx(d,{className:"w-4 h-4 text-orange-500"})),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{className:"font-medium",children:s.ip_address}),s.is_active&&e.jsx("span",{className:"bg-green-100 text-green-800 text-xs px-2 py-1 rounded",children:"有効"}),!s.is_active&&e.jsx("span",{className:"bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded",children:"無効"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description}),e.jsxs("p",{className:"text-xs text-gray-500",children:["作成: ",(l=s.created_at,new Date(l).toLocaleString("ja-JP",{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"}))]})]})]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(i,{variant:s.is_active?"warning":"success",size:"sm",onClick:()=>(async e=>{try{const{error:s}=await r.from("ip_whitelist").update({is_active:!e.is_active}).eq("id",e.id);if(s)return void t(`IPホワイトリストの状態変更に失敗しました: ${s.message}`);a(`IPホワイトリストを${e.is_active?"無効":"有効"}にしました`),await I()}catch(s){t("IPホワイトリストの状態変更中にエラーが発生しました")}})(s),children:s.is_active?e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"w-4 h-4 mr-1"}),"無効化"]}):e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"w-4 h-4 mr-1"}),"有効化"]})}),e.jsx(i,{variant:"secondary",size:"sm",onClick:()=>(e=>{_(e),P({ip_address:e.ip_address,description:e.description,is_active:e.is_active}),b(!0)})(s),children:e.jsx(o,{className:"w-4 h-4"})}),e.jsx(i,{variant:"danger",size:"sm",onClick:()=>(async e=>{if(confirm("このIPホワイトリストエントリを削除しますか？"))try{const{error:s}=await r.from("ip_whitelist").delete().eq("id",e);if(s)return void t(`IPホワイトリストの削除に失敗しました: ${s.message}`);a("IPホワイトリストを削除しました"),await I()}catch(s){t("IPホワイトリストの削除中にエラーが発生しました")}})(s.id),children:e.jsx(j,{className:"w-4 h-4"})})]})]})},s.id);var l,c})})]})]})},F=e=>{if(!e)return null;return new Date(e).toISOString()},U=e=>{if(!e)return"";const s=new Date(e);return new Date(s.getTime()-6e4*s.getTimezoneOffset()).toISOString().slice(0,16)},$=({onError:t,onSuccess:a})=>{const{refreshMaintenanceStatus:c,isMaintenanceActive:d,maintenanceInfo:m}=M(),[h,p]=s.useState([]),[y,b]=s.useState(!0),[w,_]=s.useState(!1),[k,P]=s.useState(null),[I,S]=s.useState("schedules"),[C,R]=s.useState({title:"",message:"",start_time:"",end_time:"",is_emergency:!1});s.useEffect(()=>{$()},[]);const $=async()=>{try{b(!0);const{data:e,error:s}=await r.from("maintenance_schedules").select("*").order("created_at",{ascending:!1});if(s)return void t(`メンテナンス予定の取得に失敗しました: ${s.message}`);p(e||[])}catch(e){t("メンテナンス予定の取得中にエラーが発生しました")}finally{b(!1)}},q=e=>e?new Date(e).toLocaleString("ja-JP",{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit",timeZone:"Asia/Tokyo"}):"未設定";return e.jsxs("div",{className:"space-y-6",children:[e.jsx(l,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-4 h-4 rounded-full "+(d?"bg-red-500":"bg-green-500")}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:d?"メンテナンス中":"サービス稼働中"}),d&&m&&e.jsx("p",{className:"text-sm text-gray-600",children:m.title})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:d?e.jsx(g,{className:"w-5 h-5 text-red-500"}):e.jsx(g,{className:"w-5 h-5 text-green-500"})})]})}),e.jsxs("div",{className:"flex space-x-4 border-b",children:[e.jsxs("button",{className:"px-4 py-2 font-medium "+("schedules"===I?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>S("schedules"),children:[e.jsx(N,{className:"w-4 h-4 inline mr-2"}),"メンテナンス予定"]}),e.jsxs("button",{className:"px-4 py-2 font-medium "+("whitelist"===I?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>S("whitelist"),children:[e.jsx(u,{className:"w-4 h-4 inline mr-2"}),"IPホワイトリスト"]})]}),"schedules"===I?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"メンテナンス予定管理"}),e.jsxs(i,{onClick:()=>_(!0),className:"flex items-center space-x-2",children:[e.jsx(x,{className:"w-4 h-4"}),e.jsx("span",{children:"新規作成"})]})]}),w&&e.jsxs(l,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:k?"メンテナンス予定編集":"メンテナンス予定作成"}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),C.title&&C.message)try{const e={title:C.title,message:C.message,start_time:F(C.start_time),end_time:F(C.end_time),is_emergency:C.is_emergency};if(k){const{error:s}=await r.from("maintenance_schedules").update(e).eq("id",k.id);if(s)return void t(`メンテナンス予定の更新に失敗しました: ${s.message}`);a("メンテナンス予定を更新しました")}else{const{error:s}=await r.from("maintenance_schedules").insert([e]);if(s)return void t(`メンテナンス予定の作成に失敗しました: ${s.message}`);a("メンテナンス予定を作成しました")}R({title:"",message:"",start_time:"",end_time:"",is_emergency:!1}),_(!1),P(null),await $()}catch(s){t("メンテナンス予定の保存中にエラーが発生しました")}else t("タイトルとメッセージは必須です")},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["タイトル ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(n,{type:"text",value:C.title,onChange:e=>R({...C,title:e.target.value}),placeholder:"例: システムメンテナンス",label:"タイトル",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["メッセージ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:C.message,onChange:e=>R({...C,message:e.target.value}),placeholder:"メンテナンス中に表示されるメッセージ",className:"w-full p-2 border border-gray-300 rounded-lg",rows:3,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"開始時刻（日本時間）"}),e.jsx(n,{type:"datetime-local",value:C.start_time,onChange:e=>R({...C,start_time:e.target.value}),label:"開始時刻"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"日本時間で入力してください"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"終了時刻（日本時間）"}),e.jsx(n,{type:"datetime-local",value:C.end_time,onChange:e=>R({...C,end_time:e.target.value}),label:"終了時刻"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"日本時間で入力してください"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"is_emergency",checked:C.is_emergency,onChange:e=>R({...C,is_emergency:e.target.checked}),className:"w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500"}),e.jsx("label",{htmlFor:"is_emergency",className:"text-sm font-medium",children:"緊急メンテナンス"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(i,{type:"button",variant:"secondary",onClick:()=>{_(!1),P(null),R({title:"",message:"",start_time:"",end_time:"",is_emergency:!1})},children:"キャンセル"}),e.jsx(i,{type:"submit",children:k?"更新":"作成"})]})]})]}),e.jsxs(l,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"メンテナンス予定一覧"}),y?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"text-gray-600",children:"読み込み中..."})}):0===h.length?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"メンテナンス予定がありません"}):e.jsx("div",{className:"space-y-4",children:h.map(s=>e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{className:"font-medium",children:s.title}),s.is_active&&e.jsx("span",{className:"bg-red-100 text-red-800 text-xs px-2 py-1 rounded",children:"有効"}),s.is_emergency&&e.jsx("span",{className:"bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded",children:"緊急"})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.message}),e.jsxs("div",{className:"text-sm text-gray-500 mt-2",children:[e.jsxs("div",{children:["開始: ",q(s.start_time)]}),e.jsxs("div",{children:["終了: ",q(s.end_time)]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(i,{variant:s.is_active?"danger":"success",size:"sm",onClick:()=>(async e=>{try{const{error:s}=await r.from("maintenance_schedules").update({is_active:!e.is_active}).eq("id",e.id);if(s)return void t(`メンテナンス状態の変更に失敗しました: ${s.message}`);a(`メンテナンスを${e.is_active?"無効":"有効"}にしました`),await $(),await c()}catch(s){t("メンテナンス状態の変更中にエラーが発生しました")}})(s),children:s.is_active?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-4 h-4 mr-1"}),"無効化"]}):e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"w-4 h-4 mr-1"}),"有効化"]})}),e.jsx(i,{variant:"secondary",size:"sm",onClick:()=>(e=>{P(e),R({title:e.title,message:e.message,start_time:U(e.start_time||""),end_time:U(e.end_time||""),is_emergency:e.is_emergency}),_(!0)})(s),children:e.jsx(o,{className:"w-4 h-4"})}),e.jsx(i,{variant:"danger",size:"sm",onClick:()=>(async e=>{if(confirm("このメンテナンス予定を削除しますか？"))try{const{error:s}=await r.from("maintenance_schedules").delete().eq("id",e);if(s)return void t(`メンテナンス予定の削除に失敗しました: ${s.message}`);a("メンテナンス予定を削除しました"),await $(),await c()}catch(s){t("メンテナンス予定の削除中にエラーが発生しました")}})(s.id),children:e.jsx(j,{className:"w-4 h-4"})})]})]})},s.id))})]})]}):e.jsx(D,{onError:t,onSuccess:a})]})};function q(){const{user:n,isAdmin:d}=c(),x=t(),[m,o]=s.useState("overview"),[j,p]=s.useState({totalUsers:0,totalParks:0,pendingParks:0,pendingVaccines:0,pendingFacilities:0,totalReservations:0,monthlyRevenue:0,lastMonthRevenue:0,totalSubscriptions:0,activeSubscriptions:0,newUsersThisMonth:0,unreadMessages:0}),[v,f]=s.useState(!0),[R,M]=s.useState(""),[D,F]=s.useState(""),[U,q]=s.useState({totalHighRiskUsers:0,totalMediumRiskUsers:0,recentDetections:0,blockedAttempts:0,trialAbuseCount:0}),[z,E]=s.useState([]);s.useEffect(()=>{d?(A(),L()):x("/")},[d,x]);const A=async()=>{try{f(!0),M(""),F("");const{data:e,error:s}=await r.rpc("get_admin_stats");if(s)throw s;const t=e;t&&p({totalUsers:t.total_users||0,totalParks:t.total_parks||0,pendingParks:t.pending_parks||0,pendingVaccines:t.pending_vaccines||0,pendingFacilities:t.pending_facilities||0,totalReservations:t.total_reservations||0,monthlyRevenue:t.monthly_revenue||0,lastMonthRevenue:t.last_month_revenue||0,totalSubscriptions:t.total_subscriptions||0,activeSubscriptions:t.active_subscriptions||0,newUsersThisMonth:t.new_users_this_month||0,unreadMessages:t.unread_messages||0})}catch(e){M("管理者データの取得に失敗しました。")}finally{f(!1)}},L=async()=>{try{const e=await S();q(e);const s=await C();E(s.slice(0,5))}catch(e){}},T=()=>0===j.lastMonthRevenue?0:(j.monthlyRevenue-j.lastMonthRevenue)/j.lastMonthRevenue*100;return d?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx(N,{className:"w-8 h-8 text-blue-600 mr-3"}),"管理者ダッシュボード"]}),e.jsx("p",{className:"text-gray-600",children:"システム全体の監視と管理"})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("span",{className:"text-sm text-gray-600",children:["管理者: ",n?.email]})})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[R&&e.jsxs("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4 mb-6",children:[e.jsx(y,{className:"w-5 h-5 inline mr-2"}),R]}),D&&e.jsxs("div",{className:"bg-green-100 border border-green-300 text-green-800 rounded-lg p-4 mb-6",children:[e.jsx(g,{className:"w-5 h-5 inline mr-2"}),D]}),(j.pendingParks>0||j.pendingVaccines>0||j.pendingFacilities>0||U.totalHighRiskUsers>0)&&e.jsxs(l,{className:"p-6 mb-6 border-red-200 bg-red-50",children:[e.jsxs("h2",{className:"text-lg font-semibold text-red-900 mb-4 flex items-center",children:[e.jsx(y,{className:"w-6 h-6 text-red-600 mr-2"}),"緊急対応が必要な項目"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[j.pendingParks>0&&e.jsx(a,{to:"/admin/parks",className:"block",children:e.jsx("div",{className:"bg-white rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"承認待ちドッグラン"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:j.pendingParks})]}),e.jsx(b,{className:"w-8 h-8 text-red-500"})]})})}),j.pendingVaccines>0&&e.jsx(a,{to:"/admin/vaccine-approval",className:"block",children:e.jsx("div",{className:"bg-white rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ワクチン証明書承認待ち"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:j.pendingVaccines})]}),e.jsx(u,{className:"w-8 h-8 text-red-500"})]})})}),j.pendingFacilities>0&&e.jsx(a,{to:"/admin/facility-approval",className:"block",children:e.jsx("div",{className:"bg-white rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"施設承認待ち"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:j.pendingFacilities})]}),e.jsx(b,{className:"w-8 h-8 text-red-500"})]})})}),U.totalHighRiskUsers>0&&e.jsx(a,{to:"/admin/users?filter=high_risk",className:"block",children:e.jsx("div",{className:"bg-white rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"高リスクユーザー"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:U.totalHighRiskUsers})]}),e.jsx(w,{className:"w-8 h-8 text-red-500"})]})})})]}),z.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-md font-semibold text-red-900 mb-3",children:"最新の高リスクユーザー"}),e.jsx("div",{className:"bg-white rounded-lg overflow-hidden",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"ユーザー"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"リスクスコア"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"検知タイプ"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"最終検知"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"アクション"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:z.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.userName}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("span",{className:"inline-flex items-center px-2 py-1 text-xs font-medium rounded-full "+("high"===s.riskLevel?"bg-red-100 text-red-800":"medium"===s.riskLevel?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:s.riskScore})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"text-sm text-gray-900",children:s.detectionTypes.join(", ")})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"text-sm text-gray-900",children:new Date(s.lastDetection).toLocaleDateString("ja-JP")})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx(a,{to:"/admin/users?filter=high_risk",children:e.jsxs(i,{variant:"secondary",size:"sm",children:[e.jsx(h,{className:"w-4 h-4 mr-1"}),"詳細"]})})})]},s.userId))})]})})]})]}),e.jsx("div",{className:"flex space-x-1 mb-6",children:[{id:"overview",label:"概要",icon:_},{id:"parks",label:"ドッグラン",icon:b},{id:"users",label:"ユーザー",icon:k},{id:"fraud",label:"不正検知",icon:w},{id:"maintenance",label:"メンテナンス",icon:N}].map(s=>{const t=s.icon;return e.jsxs("button",{onClick:()=>o(s.id),className:"flex items-center px-4 py-2 text-sm font-medium rounded-lg transition-colors "+(m===s.id?"bg-blue-100 text-blue-700":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"),children:[e.jsx(t,{className:"w-4 h-4 mr-2"}),s.label]},s.id)})}),"overview"===m&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"総ユーザー数"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:j.totalUsers}),e.jsxs("p",{className:"text-sm text-green-600",children:["今月 +",j.newUsersThisMonth,"人"]})]}),e.jsx(k,{className:"w-8 h-8 text-blue-500"})]})}),e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"総ドッグラン数"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:j.totalParks}),j.pendingParks>0&&e.jsxs("p",{className:"text-sm text-orange-600",children:["承認待ち ",j.pendingParks,"件"]})]}),e.jsx(b,{className:"w-8 h-8 text-green-500"})]})}),e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"月間売上"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:(H=j.monthlyRevenue,new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY"}).format(H))}),e.jsxs("p",{className:"text-sm "+(T()>=0?"text-green-600":"text-red-600"),children:["前月比 ",T()>=0?"+":"",T().toFixed(1),"%"]})]}),e.jsx(P,{className:"w-8 h-8 text-yellow-500"})]})}),e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"アクティブサブスクリプション"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:j.activeSubscriptions}),e.jsxs("p",{className:"text-sm text-gray-600",children:["総数 ",j.totalSubscriptions,"件"]})]}),e.jsx(I,{className:"w-8 h-8 text-purple-500"})]})})]}),e.jsxs(l,{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"クイックアクション"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(a,{to:"/admin/users",children:e.jsxs(i,{className:"w-full justify-start",children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"ユーザー管理"]})}),e.jsx(a,{to:"/admin/parks",children:e.jsxs(i,{className:"w-full justify-start",children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"ドッグラン管理"]})}),e.jsx(a,{to:"/admin/sales",children:e.jsxs(i,{className:"w-full justify-start",children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"売上レポート"]})})]})]})]}),"fraud"===m&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:[e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"高リスクユーザー"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:U.totalHighRiskUsers})]}),e.jsx(w,{className:"w-8 h-8 text-red-500"})]})}),e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"中リスクユーザー"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:U.totalMediumRiskUsers})]}),e.jsx(y,{className:"w-8 h-8 text-yellow-500"})]})}),e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"最近の検知"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:U.recentDetections}),e.jsx("p",{className:"text-xs text-gray-500",children:"過去30日"})]}),e.jsx(h,{className:"w-8 h-8 text-blue-500"})]})}),e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ブロック済み"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:U.blockedAttempts})]}),e.jsx(u,{className:"w-8 h-8 text-green-500"})]})}),e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"トライアル悪用"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:U.trialAbuseCount})]}),e.jsx(y,{className:"w-8 h-8 text-purple-500"})]})})]}),e.jsxs(l,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"不正検知管理"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 bg-red-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-red-900",children:"高リスクユーザーの監視"}),e.jsx("p",{className:"text-sm text-red-700",children:"リスクスコア70以上のユーザーを定期的に確認し、必要に応じて制限措置を実施してください。"})]}),e.jsx(a,{to:"/admin/users?filter=high_risk",children:e.jsxs(i,{className:"bg-red-600 hover:bg-red-700",children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"確認する"]})})]}),e.jsxs("div",{className:"flex justify-between items-center p-4 bg-yellow-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-yellow-900",children:"中リスクユーザーの監視"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"リスクスコア50-69のユーザーの動向を監視し、パターンを分析してください。"})]}),e.jsx(a,{to:"/admin/users?filter=medium_risk",children:e.jsxs(i,{variant:"secondary",children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"確認する"]})})]}),e.jsxs("div",{className:"flex justify-between items-center p-4 bg-blue-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900",children:"全ユーザー管理"}),e.jsx("p",{className:"text-sm text-blue-700",children:"すべてのユーザーの不正検知状況を確認し、総合的な監視を行います。"})]}),e.jsx(a,{to:"/admin/users",children:e.jsxs(i,{variant:"secondary",children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"ユーザー一覧"]})})]})]})]})]}),"parks"===m&&e.jsxs(l,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"ドッグラン承認管理"}),e.jsxs("p",{className:"text-gray-600",children:["詳細なドッグラン管理は",e.jsx(a,{to:"/admin/parks",className:"text-blue-600 hover:text-blue-800 mx-1",children:"ドッグラン管理ページ"}),"で行えます。"]}),j.pendingParks>0&&e.jsxs("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("p",{className:"text-red-700",children:[e.jsxs("strong",{children:[j.pendingParks,"件"]}),"のドッグラン承認待ちがあります。"]}),e.jsx(a,{to:"/admin/parks",children:e.jsx(i,{size:"sm",className:"mt-2",children:"今すぐ確認する"})})]})]}),"users"===m&&e.jsxs(l,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"ユーザー管理"}),e.jsxs("p",{className:"text-gray-600",children:["詳細なユーザー管理は",e.jsx(a,{to:"/admin/users",className:"text-blue-600 hover:text-blue-800 mx-1",children:"ユーザー管理ページ"}),"で行えます。"]})]}),"maintenance"===m&&e.jsx($,{onError:M,onSuccess:F})]})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs(l,{className:"p-8 text-center",children:[e.jsx(u,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"アクセス拒否"}),e.jsx("p",{className:"text-gray-600",children:"管理者権限が必要です。"})]})});var H}export{q as AdminDashboard};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/css/index-DxZPnn_v.css"])))=>i.map(i=>d[i]);
import{_ as e}from"./supabase-B0bqaRGb.js";import{j as s}from"./motion-CuO0nkIV.js";import{r as a}from"./react-vendor-cniURDpR.js";import{B as i}from"./Button-CJFAG6V0.js";import{u as t,C as l,s as n}from"./index-DN5wQuSm.js";import{I as r}from"./Input-D3zjVn42.js";import{g as d}from"./geocoding-C2oaRnzC.js";import{a as m}from"./router-Cg6wfOY4.js";import{F as c,a4 as o,N as x,aY as h}from"./ui-basic-CaMd9YQ-.js";import"./heavy-features-BIdEME4r.js";const u=[{id:"pet_hotel",name:"ペットホテル",monthly_fee:5e3,is_free:!0},{id:"pet_salon",name:"ペットサロン",monthly_fee:3e3,is_free:!0},{id:"veterinary",name:"動物病院",monthly_fee:8e3,is_free:!0},{id:"pet_cafe",name:"ペットカフェ",monthly_fee:4e3,is_free:!0},{id:"pet_restaurant",name:"ペット同伴レストラン",monthly_fee:6e3,is_free:!0},{id:"pet_shop",name:"ペットショップ",monthly_fee:7e3,is_free:!0},{id:"pet_accommodation",name:"ペット同伴宿泊",monthly_fee:1e4,is_free:!0},{id:"dog_training",name:"しつけ教室",monthly_fee:4500,is_free:!0},{id:"pet_friendly_other",name:"その他ワンちゃん同伴可能施設",monthly_fee:3500,is_free:!0}];function p(){const{user:p,isAuthenticated:f,userProfile:b}=t(),j=m(),[g,y]=a.useState(!1),[_,N]=a.useState(""),[v,w]=a.useState(""),[E,k]=a.useState({name:"",address:"",isEditing:!1}),[C,A]=a.useState({name:"",category_id:"",address:"",phone:"",website:"",description:""});a.useEffect(()=>{f||j("/login")},[f,j]),a.useEffect(()=>{(async()=>{if(b){const e=b.name||b.display_name||b.full_name||"",s=b.address||b.location||b.postal_address||"";k({name:e,address:s,isEditing:!1})}else if(p)try{const{data:e,error:s}=await n.from("profiles").select("*").eq("id",p.id).single();if(e&&!s){const s=e.name||e.display_name||e.full_name||"",a=e.address||e.location||e.postal_address||"";k({name:s,address:a,isEditing:!s||!a})}else{const e=p.user_metadata||{},s=e.name||e.full_name||e.display_name||e.given_name||e.nickname||(e.given_name&&e.family_name?`${e.family_name} ${e.given_name}`:"")||"",a=e.address||e.location||e.postal_address||e.street_address||e.formatted_address||"";k({name:s,address:a,isEditing:!s||!a})}}catch(e){k({name:"",address:"",isEditing:!0})}else k({name:"",address:"",isEditing:!0})})()},[b,p]);const q=e=>{const{name:s,value:a}=e.target;A(e=>({...e,[s]:a}))},S=e=>{const{name:s,value:a}=e.target;k(e=>({...e,[s]:a}))};return f?s.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[s.jsxs("div",{className:"mb-8",children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"ペット関連施設登録"}),s.jsx("p",{className:"text-gray-600",children:"ペット関連施設の掲載申請を行います。管理者の承認後、地図に表示されます。"})]}),_&&s.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(c,{className:"w-5 h-5 text-red-500 mr-2"}),s.jsx("span",{className:"text-red-700",children:_})]})}),v&&s.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(o,{className:"w-5 h-5 text-green-500 mr-2"}),s.jsx("span",{className:"text-green-700",children:v})]})}),s.jsxs("form",{onSubmit:async s=>{if(s.preventDefault(),f&&p)if(C.name&&C.category_id&&C.address)try{y(!0),N("");const s=await d(C.address);let a=null,i=null;s&&(a=s.latitude,i=s.longitude);const{data:t,error:l}=await n.from("pet_facilities").insert({name:C.name,category_id:C.category_id,address:C.address,latitude:a,longitude:i,phone:C.phone||null,website:C.website||null,description:C.description||null,owner_id:p.id,status:"pending"}).select().single();if(l)throw l;w(s?"施設の申請が正常に送信されました。地図上での正確な位置も設定されています。承認をお待ちください。":"施設の申請が正常に送信されました。（位置情報は後ほど設定されます）承認をお待ちください。");try{const s=`${window.location.origin}/my-facilities-management`,{notifyAppAndLine:a}=await e(async()=>{const{notifyAppAndLine:e}=await import("./notify-przsH82t.js");return{notifyAppAndLine:e}},__vite__mapDeps([0]));await a({userId:p.id,title:"施設申請を受け付けました",message:"審査結果はアプリ内で通知します。",linkUrl:s,kind:"alert"})}catch{}A({name:"",category_id:"",address:"",phone:"",website:"",description:""})}catch(a){N("申請の送信に失敗しました。再度お試しください。")}finally{y(!1)}else N("施設名、カテゴリ、住所は必須項目です");else N("認証が必要です")},className:"space-y-6",children:[s.jsx(l,{children:s.jsxs("div",{className:"p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center",children:[s.jsx(x,{className:"w-6 h-6 mr-2"}),"基本情報"]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["施設名 ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx(r,{label:"施設名",name:"name",value:C.name,onChange:q,placeholder:"施設名を入力してください",required:!0})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["施設カテゴリ ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsxs("select",{name:"category_id",value:C.category_id,onChange:q,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"カテゴリを選択してください"}),u.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["住所 ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx(r,{label:"住所",name:"address",value:C.address,onChange:q,placeholder:"住所を入力してください",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"電話番号"}),s.jsx(r,{label:"電話番号",name:"phone",value:C.phone,onChange:q,placeholder:"電話番号を入力してください"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ウェブサイト"}),s.jsx(r,{label:"ウェブサイト",name:"website",value:C.website,onChange:q,placeholder:"https://example.com"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"施設説明"}),s.jsx("textarea",{name:"description",value:C.description,onChange:q,rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"施設の特徴やサービス内容を説明してください"})]})]})]})}),s.jsx(l,{children:s.jsxs("div",{className:"p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center",children:[s.jsx(h,{className:"w-6 h-6 mr-2"}),"施設画像について"]}),s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(c,{className:"w-5 h-5 text-blue-600 mt-1 mr-3 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-blue-800 mb-1",children:"画像のアップロードについて"}),s.jsx("p",{className:"text-sm text-blue-700",children:"掲載画像は承認後にマイページ内で添付することができます。"})]})]})})]})}),s.jsx(l,{children:s.jsxs("div",{className:"p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center",children:[s.jsx(o,{className:"w-6 h-6 mr-2"}),"登録者情報の確認"]}),s.jsx("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(c,{className:"w-5 h-5 text-blue-500 mr-2 mt-0.5"}),s.jsxs("div",{className:"text-sm text-blue-800",children:[s.jsx("p",{className:"font-medium mb-1",children:"登録者情報の確認"}),s.jsx("p",{className:"text-xs mb-2",children:"アカウント情報から自動取得されました。変更が必要な場合は編集できます。"}),s.jsx("p",{className:"text-xs font-medium text-blue-600",children:"⚠️ この情報は公開されません"})]})]})}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"氏名"}),E.isEditing?s.jsx(r,{label:"",name:"name",value:E.name,onChange:S,placeholder:"氏名を入力してください",required:!0}):s.jsx("div",{className:"px-3 py-2 bg-gray-50 border border-gray-200 rounded-md",children:s.jsx("p",{className:"text-gray-900",children:E.name||"未設定"})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"住所"}),E.isEditing?s.jsx(r,{name:"address",value:E.address,onChange:S,placeholder:"住所を入力してください"}):s.jsx("div",{className:"px-3 py-2 bg-gray-50 border border-gray-200 rounded-md",children:s.jsx("p",{className:"text-gray-900",children:E.address||"未設定"})})]})]}),s.jsx("div",{className:"flex justify-end mt-4",children:E.isEditing?s.jsxs("div",{className:"space-x-2",children:[s.jsx(i,{type:"button",onClick:()=>{(async()=>{if(p)try{y(!0);const{error:e}=await n.from("profiles").update({name:E.name,address:E.address}).eq("id",p.id);if(e)throw e;k(e=>({...e,isEditing:!1})),w("ユーザー情報を更新しました")}catch(e){N("ユーザー情報の更新に失敗しました")}finally{y(!1)}})()},disabled:g,children:g?"保存中...":"保存"}),s.jsx(i,{type:"button",variant:"secondary",onClick:()=>{k(e=>({...e,isEditing:!1}))},disabled:g,children:"キャンセル"})]}):s.jsx(i,{type:"button",variant:"secondary",onClick:()=>k(e=>({...e,isEditing:!0})),children:"編集"})})]})}),s.jsx("div",{className:"flex justify-end",children:s.jsx(i,{type:"submit",disabled:g,className:"px-8 py-3 text-lg",children:g?"申請中...":"申請を送信"})})]})]}):null}export{p as default};

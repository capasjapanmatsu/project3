import{j as e,A as F,g as I,F as P,aM as j,c as B,M as J,u as O,b as Y,t as q,aJ as R}from"./ui-vendor-FlUr4cJt.js";import{u as ee,r as c}from"./react-vendor-_GyjDmDn.js";import{u as se,s as w,C as m,B as y}from"./index-BSYT0262.js";import"./supabase-vendor-Df9iqQzW.js";function ie(){const{user:ae,isAdmin:u}=se(),A=ee(),[l,S]=c.useState([]),[b,U]=c.useState([]),[v,V]=c.useState([]),[Z,k]=c.useState(!0),[C,d]=c.useState(""),[D,h]=c.useState(""),[g,E]=c.useState("pending"),[r,p]=c.useState(null),[G,N]=c.useState(!1),[H,M]=c.useState(!1),[T,o]=c.useState(null);c.useEffect(()=>{if(!u){A("/");return}W()},[u,A]),c.useEffect(()=>{l.length>0&&Q()},[l]);const K=s=>{h(s),d(""),setTimeout(()=>h(""),5e3)},$=s=>{d(s),h(""),setTimeout(()=>d(""),8e3)},Q=()=>{const s=l.filter(t=>t.status==="pending"),n=l.filter(t=>t.status==="approved");U(s),V(n)},W=async()=>{try{k(!0),d("");const{data:s,error:n}=await w.from("vaccine_certifications").select(`
          *,
          dog:dogs (
            id,
            name,
            breed,
            gender,
            birth_date,
            owner:profiles (
              id,
              name,
              email,
              phone_number,
              address,
              postal_code
            )
          )
        `).order("created_at",{ascending:!1});if(n)throw n;const t=(s||[]).map(a=>({id:a.id,dog_id:a.dog_id,dog_name:a.dog?.name||"不明",dog_breed:a.dog?.breed||"不明",dog_gender:a.dog?.gender||"不明",dog_birth_date:a.dog?.birth_date||"",owner_id:a.owner_id,owner_name:a.dog?.owner?.name||"不明",owner_email:a.dog?.owner?.email||"不明",owner_phone:a.dog?.owner?.phone_number||"",owner_address:a.dog?.owner?.address||"",owner_postal_code:a.dog?.owner?.postal_code||"",rabies_vaccine_image:a.rabies_vaccine_image||"",combo_vaccine_image:a.combo_vaccine_image||"",rabies_expiry_date:a.rabies_expiry_date||"",combo_expiry_date:a.combo_expiry_date||"",status:a.status||"pending",created_at:a.created_at,admin_notes:a.admin_notes||""}));console.log("✅ ワクチン証明書申請を取得しました:",t.length,"件"),S(t)}catch(s){console.error("❌ ワクチン証明書申請の取得に失敗しました:",s),$("ワクチン証明書申請の取得に失敗しました。")}finally{k(!1)}},X=async s=>{if(window.confirm("このワクチン証明書申請を承認してもよろしいですか？"))try{M(!0),d(""),h("");const{error:t}=await w.from("vaccine_certifications").update({status:"approved",approved_at:new Date().toISOString()}).eq("id",s);if(t)throw t;const a=l.find(i=>i.id===s);a&&await w.from("notifications").insert([{user_id:a.owner_id,title:"ワクチン証明書承認",message:`${a.dog_name}ちゃんのワクチン証明書が承認されました。`,type:"vaccine_approved",created_at:new Date().toISOString(),read:!1}]),K("ワクチン証明書を承認しました。"),S(i=>i.map(_=>_.id===s?{..._,status:"approved"}:_))}catch(t){console.error("❌ 承認エラー:",t),$("承認処理に失敗しました。")}finally{M(!1)}},L=s=>{switch(s){case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},z=s=>{switch(s){case"pending":return"承認待ち";case"approved":return"承認済み";case"rejected":return"却下";default:return"不明"}},x=s=>new Date(s).toLocaleDateString("ja-JP"),f=s=>{if(!s)return"不明";const n=new Date,t=new Date(s),a=n.getFullYear()-t.getFullYear(),i=n.getMonth()-t.getMonth();return i<0||i===0&&n.getDate()<t.getDate()?`${a-1}歳`:`${a}歳`};return u?Z?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"データを読み込み中..."})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"bg-white shadow rounded-lg mb-8",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"ワクチン証明書 承認管理"}),e.jsx("p",{className:"text-gray-600",children:"登録されたワクチン証明書の承認・却下を管理します。"})]}),C&&e.jsx("div",{className:"px-6 py-4 bg-red-50 border-l-4 border-red-400",children:e.jsxs("div",{className:"flex",children:[e.jsx(F,{className:"h-5 w-5 text-red-400 mr-2"}),e.jsx("p",{className:"text-sm text-red-700",children:C})]})}),D&&e.jsx("div",{className:"px-6 py-4 bg-green-50 border-l-4 border-green-400",children:e.jsxs("div",{className:"flex",children:[e.jsx(I,{className:"h-5 w-5 text-green-400 mr-2"}),e.jsx("p",{className:"text-sm text-green-700",children:D})]})}),e.jsx("div",{className:"px-6",children:e.jsxs("nav",{className:"flex space-x-8","aria-label":"Tabs",children:[e.jsxs("button",{onClick:()=>E("pending"),className:`whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm ${g==="pending"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(P,{className:"w-5 h-5 inline mr-2"}),"承認待ち",e.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:b.length})]}),e.jsxs("button",{onClick:()=>E("approved"),className:`whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm ${g==="approved"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(j,{className:"w-5 h-5 inline mr-2"}),"登録中のワンちゃん",e.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:v.length})]})]})})]}),g==="pending"&&e.jsx("div",{className:"space-y-6",children:b.length===0?e.jsxs(m,{className:"text-center py-12",children:[e.jsx(P,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"承認待ちのワクチン証明書申請がありません"})]}):e.jsx("div",{className:"space-y-4",children:b.map(s=>e.jsx(m,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx(j,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.dog_name}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${L(s.status)}`,children:z(s.status)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"ワンちゃん情報"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{children:["犬種: ",s.dog_breed]}),e.jsxs("div",{children:["性別: ",s.dog_gender]}),e.jsxs("div",{children:["年齢: ",f(s.dog_birth_date)]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"飼い主情報"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(B,{className:"w-4 h-4 mr-1"}),s.owner_name]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(J,{className:"w-4 h-4 mr-1"}),s.owner_email]}),s.owner_phone&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(O,{className:"w-4 h-4 mr-1"}),s.owner_phone]}),s.owner_address&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(Y,{className:"w-4 h-4 mr-1"}),"〒",s.owner_postal_code," ",s.owner_address]})]})]})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["申請日: ",x(s.created_at)]})]}),e.jsxs("div",{className:"flex space-x-2 ml-4",children:[e.jsxs(y,{size:"sm",variant:"secondary",onClick:()=>{p(s),N(!0)},children:[e.jsx(q,{className:"w-4 h-4 mr-1"}),"詳細"]}),e.jsxs(y,{size:"sm",onClick:()=>X(s.id),className:"bg-green-600 hover:bg-green-700",disabled:H,children:[e.jsx(I,{className:"w-4 h-4 mr-1"}),"承認"]})]})]})},s.id))})}),g==="approved"&&e.jsx("div",{className:"space-y-6",children:v.length===0?e.jsxs(m,{className:"text-center py-12",children:[e.jsx(j,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"承認済みのワクチン証明書がありません"})]}):e.jsx("div",{className:"space-y-4",children:v.map(s=>e.jsx(m,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx(j,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.dog_name}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${L(s.status)}`,children:z(s.status)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"ワンちゃん情報"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{children:["犬種: ",s.dog_breed]}),e.jsxs("div",{children:["性別: ",s.dog_gender]}),e.jsxs("div",{children:["年齢: ",f(s.dog_birth_date)]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"飼い主情報"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(B,{className:"w-4 h-4 mr-1"}),s.owner_name]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(J,{className:"w-4 h-4 mr-1"}),s.owner_email]}),s.owner_phone&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(O,{className:"w-4 h-4 mr-1"}),s.owner_phone]}),s.owner_address&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(Y,{className:"w-4 h-4 mr-1"}),"〒",s.owner_postal_code," ",s.owner_address]})]})]})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["申請日: ",x(s.created_at)]})]}),e.jsx("div",{className:"flex space-x-2 ml-4",children:e.jsxs(y,{size:"sm",variant:"secondary",onClick:()=>{p(s),N(!0)},children:[e.jsx(q,{className:"w-4 h-4 mr-1"}),"詳細"]})})]})},s.id))})}),G&&r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold",children:"ワクチン証明書詳細"}),e.jsx("button",{onClick:()=>{N(!1),p(null)},className:"text-gray-500 hover:text-gray-700",children:"×"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"ワンちゃん情報"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"名前:"})," ",r.dog_name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"犬種:"})," ",r.dog_breed]}),e.jsxs("div",{children:[e.jsx("strong",{children:"性別:"})," ",r.dog_gender]}),e.jsxs("div",{children:[e.jsx("strong",{children:"年齢:"})," ",f(r.dog_birth_date)]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"飼い主情報"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"名前:"})," ",r.owner_name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"メール:"})," ",r.owner_email]}),r.owner_phone&&e.jsxs("div",{children:[e.jsx("strong",{children:"電話:"})," ",r.owner_phone]}),r.owner_address&&e.jsxs("div",{children:[e.jsx("strong",{children:"住所:"})," 〒",r.owner_postal_code," ",r.owner_address]})]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"ワクチン証明書画像"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.rabies_vaccine_image&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:["狂犬病ワクチン",r.rabies_expiry_date&&e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(有効期限: ",x(r.rabies_expiry_date),")"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:r.rabies_vaccine_image,alt:"狂犬病ワクチン証明書",className:"w-full h-48 object-cover rounded-lg border cursor-pointer",onClick:()=>o(r.rabies_vaccine_image)}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("button",{onClick:()=>o(r.rabies_vaccine_image),className:"bg-black bg-opacity-50 text-white p-1 rounded-full hover:bg-opacity-70",children:e.jsx(R,{className:"w-4 h-4"})})})]})]}),r.combo_vaccine_image&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:["混合ワクチン",r.combo_expiry_date&&e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(有効期限: ",x(r.combo_expiry_date),")"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:r.combo_vaccine_image,alt:"混合ワクチン証明書",className:"w-full h-48 object-cover rounded-lg border cursor-pointer",onClick:()=>o(r.combo_vaccine_image)}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("button",{onClick:()=>o(r.combo_vaccine_image),className:"bg-black bg-opacity-50 text-white p-1 rounded-full hover:bg-opacity-70",children:e.jsx(R,{className:"w-4 h-4"})})})]})]})]})]}),e.jsxs("div",{className:"mt-6 text-sm text-gray-500",children:["申請日: ",x(r.created_at)]})]})})}),T&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"relative max-w-4xl max-h-full",children:[e.jsx("button",{onClick:()=>o(null),className:"absolute top-4 right-4 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70",children:"×"}),e.jsx("img",{src:T,alt:"拡大画像",className:"max-w-full max-h-full object-contain"})]})})]})}):e.jsx("div",{className:"max-w-4xl mx-auto p-4",children:e.jsx(m,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(F,{className:"w-12 h-12 text-red-500 mr-4"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-red-700",children:"アクセス権限がありません"}),e.jsx("p",{className:"text-red-600",children:"このページは管理者のみアクセス可能です。"})]})]})})})}export{ie as default};

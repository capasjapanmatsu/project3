import{u as e,b as s,j as a,B as t}from"./index-rzoKNnex.js";import{u as r,r as i,L as l}from"./vendor-Cwmn0chA.js";import{C as c}from"./Card-CRM3w0N8.js";import{V as n,X as d,i as m,a as o,l as x,b as h,ae as g,n as p,d as j,D as u,s as N}from"./ui-CMSAjam7.js";import"./supabase-Dzr8oIt2.js";function f(){const{user:f,isAdmin:b}=e(),v=r(),[_,w]=i.useState("parks"),[y,k]=i.useState([]),[S,D]=i.useState([]),[C,q]=i.useState(!0),[L,P]=i.useState(""),[$,I]=i.useState(""),[J,O]=i.useState(null),[z,T]=i.useState(null),[A,E]=i.useState([]),[Q,R]=i.useState(null),[B,F]=i.useState(!1),[V,G]=i.useState(""),[H,K]=i.useState(!1),[M,U]=i.useState(!1);i.useEffect((()=>{b?W():v("/")}),[b,v,_]);const W=async()=>{try{if(q(!0),P(""),I(""),"parks"===_){const{data:e,error:a}=await s.from("admin_pending_parks_view").select("*").order("created_at",{ascending:!1});if(a)throw a;k(e||[])}else{const{data:e,error:a}=await s.from("vaccine_certifications").select("\n            *,\n            dog:dogs(*, owner:profiles(*))\n          ").eq("status","pending").order("created_at",{ascending:!1});if(a)throw a;D(e||[])}}catch(e){P(e.message||"エラーが発生しました")}finally{q(!1)}},X=async e=>{try{q(!0);const{data:a,error:t}=await s.from("dog_park_facility_images").select("*").eq("park_id",e).order("created_at",{ascending:!1});if(t)throw t;E(a||[]);const r=a&&a.length>0&&a.every((e=>!0===e.is_approved));U(r)}catch(a){P(a.message||"施設画像の取得に失敗しました")}finally{q(!1)}},Y=e=>{R(e),F(!0),G(e.admin_notes||"")},Z=async e=>{if(Q)try{K(!0);const a={is_approved:e};!e&&V.trim()?a.admin_notes=V.trim():a.admin_notes=null;const{error:t}=await s.from("dog_park_facility_images").update(a).eq("id",Q.id);if(t)throw t;J&&await X(J.id),I(`画像を${e?"承認":"却下"}しました`),setTimeout((()=>{I("")}),3e3),F(!1),R(null),G("")}catch{P("画像の承認/却下に失敗しました")}finally{K(!1)}},ee=async(e,a)=>{try{if(K(!0),a){if(A.filter((e=>null===e.is_approved||!1===e.is_approved)).length>0)return P("すべての画像を承認してから施設を承認してください"),void K(!1)}const t=a?"qr_testing":"rejected",{error:r}=await s.from("dog_parks").update({status:t}).eq("id",e);if(r)throw r;let i={};const{data:l,error:c}=await s.from("dog_park_review_stages").select("id").eq("park_id",e).maybeSingle();if(c)throw c;if(l){a?i.qr_testing_started_at=(new Date).toISOString():(i.rejected_at=(new Date).toISOString(),V.trim()&&(i.rejection_reason=V.trim()));const{error:t}=await s.from("dog_park_review_stages").update(i).eq("park_id",e);if(t)throw t}else{i={park_id:e,first_stage_passed_at:(new Date).toISOString()},a?i.qr_testing_started_at=(new Date).toISOString():(i.rejected_at=(new Date).toISOString(),V.trim()&&(i.rejection_reason=V.trim()));const{error:t}=await s.from("dog_park_review_stages").insert([i]);if(t)throw t}const{data:n,error:d}=await s.from("dog_parks").select("name, owner_id").eq("id",e).single();if(d)throw d;const{error:m}=await s.from("notifications").insert([{user_id:n.owner_id,type:"park_approval_required",title:a?"QRコード実証検査のお知らせ":"審査結果のお知らせ",message:a?`${n.name}の第二審査が通過しました。QRコード実証検査の日程調整のため、運営事務局からご連絡いたします。`:`${n.name}の審査が却下されました。${V?`理由: ${V}`:"詳細はダッシュボードをご確認ください。"}`,data:{park_id:e}}]);if(m)throw m;I("施設を"+(a?"QRコードテスト段階に進めました":"却下しました")),await W(),O(null),E([]),G("")}catch(t){P("施設の承認/却下に失敗しました: "+t.message)}finally{K(!1)}},se=async(e,a)=>{try{K(!0),P("");const t={status:a?"approved":"rejected"};a&&(t.approved_at=(new Date).toISOString());const{error:r}=await s.from("vaccine_certifications").update(t).eq("id",e);if(r)throw r;const{data:i,error:l}=await s.from("vaccine_certifications").select("*, dog:dogs(name, owner_id)").eq("id",e).single();if(l)throw l;const{error:c}=await s.from("notifications").insert([{user_id:i.dog.owner_id,type:"vaccine_approval_required",title:a?"ワクチン証明書承認のお知らせ":"ワクチン証明書却下のお知らせ",message:a?`${i.dog.name}ちゃんのワクチン証明書が承認されました。ドッグランを利用できるようになりました。`:`${i.dog.name}ちゃんのワクチン証明書が却下されました。${V?`理由: ${V}`:"詳細はマイページをご確認ください。"}`,data:{dog_id:i.dog_id}}]);if(c)throw c;I(`ワクチン証明書を${a?"承認":"却下"}しました`),await W(),T(null),G("")}catch{P("ワクチン証明書の承認/却下に失敗しました")}finally{K(!1)}},ae=e=>({overview:"施設全景",entrance:"入口",large_dog_area:"大型犬エリア",small_dog_area:"小型犬エリア",private_booth:"プライベートブース",parking:"駐車場",shower:"シャワー設備",restroom:"トイレ",agility:"アジリティ設備",rest_area:"休憩スペース",water_station:"給水設備"}[e]||e);return!C||J||z?B&&Q?a.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[a.jsx("div",{className:"flex items-center space-x-4 mb-6",children:a.jsxs("button",{onClick:()=>{F(!1),R(null),G("")},className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[a.jsx(n,{className:"w-4 h-4 mr-2"}),"画像一覧に戻る"]})}),a.jsxs(c,{className:"p-6",children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsxs("h2",{className:"text-xl font-bold",children:["画像レビュー: ",ae(Q.image_type)]}),a.jsx("div",{className:"flex space-x-2",children:a.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-medium "+(!0===Q.is_approved?"bg-green-100 text-green-800":!1===Q.is_approved?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:!0===Q.is_approved?"承認済み":!1===Q.is_approved?"却下":"審査待ち"})})]}),a.jsx("div",{className:"mb-6",children:a.jsx("div",{className:"w-full h-96 bg-gray-100 rounded-lg overflow-hidden",children:a.jsx("img",{src:Q.image_url,alt:ae(Q.image_type),className:"w-full h-full object-contain",onError:e=>{e.currentTarget.src="https://via.placeholder.com/800x600?text=Image+Not+Available"}})})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold mb-2",children:"画像情報"}),a.jsxs("div",{className:"space-y-1 text-sm",children:[a.jsxs("p",{children:[a.jsx("span",{className:"font-medium",children:"タイプ:"})," ",ae(Q.image_type)]}),a.jsxs("p",{children:[a.jsx("span",{className:"font-medium",children:"アップロード日時:"})," ",new Date(Q.created_at).toLocaleString("ja-JP")]}),a.jsxs("p",{children:[a.jsx("span",{className:"font-medium",children:"最終更新日時:"})," ",new Date(Q.updated_at).toLocaleString("ja-JP")]})]})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold mb-2",children:"施設情報"}),a.jsxs("div",{className:"space-y-1 text-sm",children:[a.jsxs("p",{children:[a.jsx("span",{className:"font-medium",children:"施設名:"})," ",null==J?void 0:J.name]}),a.jsxs("p",{children:[a.jsx("span",{className:"font-medium",children:"住所:"})," ",null==J?void 0:J.address]}),a.jsxs("p",{children:[a.jsx("span",{className:"font-medium",children:"オーナー:"})," ",null==J?void 0:J.owner_name]})]})]})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"却下理由（却下する場合のみ入力）"}),a.jsx("textarea",{value:V,onChange:e=>G(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,placeholder:"例: 画像が不鮮明です。より明るく鮮明な画像を再アップロードしてください。"})]}),a.jsxs("div",{className:"flex justify-end space-x-3",children:[a.jsx(t,{variant:"secondary",onClick:()=>{F(!1),R(null),G("")},children:"キャンセル"}),a.jsxs(t,{onClick:()=>Z(!1),isLoading:H,className:"bg-red-600 hover:bg-red-700",children:[a.jsx(d,{className:"w-4 h-4 mr-2"}),"却下"]}),a.jsxs(t,{onClick:()=>Z(!0),isLoading:H,className:"bg-green-600 hover:bg-green-700",children:[a.jsx(m,{className:"w-4 h-4 mr-2"}),"承認"]})]})]})]}):a.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[a.jsx("div",{className:"flex items-center space-x-4 mb-6",children:a.jsxs(l,{to:"/admin",className:"flex items-center text-blue-600 hover:text-blue-800",children:[a.jsx(n,{className:"w-4 h-4 mr-2"}),"管理者ダッシュボードに戻る"]})}),a.jsx("div",{className:"flex justify-between items-center",children:a.jsxs("h1",{className:"text-2xl font-bold flex items-center",children:[a.jsx(o,{className:"w-8 h-8 text-red-600 mr-3"}),"管理者審査ページ"]})}),L&&a.jsxs("div",{className:"mb-6 p-4 bg-red-50 rounded-lg flex items-start",children:[a.jsx(x,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),a.jsx("p",{className:"text-red-800",children:L})]}),$&&a.jsxs("div",{className:"mb-6 p-4 bg-green-50 rounded-lg flex items-start",children:[a.jsx(m,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),a.jsx("p",{className:"text-green-800",children:$})]}),a.jsxs("div",{className:"flex space-x-4 border-b",children:[a.jsxs("button",{className:"px-4 py-2 font-medium "+("parks"===_?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>w("parks"),children:[a.jsx(h,{className:"w-4 h-4 inline mr-2"}),"ドッグラン審査"]}),a.jsxs("button",{className:"px-4 py-2 font-medium "+("vaccines"===_?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>w("vaccines"),children:[a.jsx(g,{className:"w-4 h-4 inline mr-2"}),"ワクチン証明書審査"]})]}),"parks"===_&&!J&&a.jsxs("div",{className:"space-y-4",children:[a.jsx("h2",{className:"text-xl font-semibold",children:"審査待ちドッグラン"}),0===y.length?a.jsxs(c,{className:"text-center py-12",children:[a.jsx(m,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"審査待ちのドッグランはありません"})]}):a.jsx("div",{className:"space-y-4",children:y.map((e=>a.jsx(c,{className:"p-6 hover:shadow-lg transition-shadow",children:a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[a.jsx("h3",{className:"text-lg font-semibold",children:e.name}),a.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("first_stage_passed"===e.status?"bg-blue-100 text-blue-800":"second_stage_review"===e.status?"bg-purple-100 text-purple-800":"bg-yellow-100 text-yellow-800"),children:"first_stage_passed"===e.status?"第一審査通過":"second_stage_review"===e.status?"第二審査中":"審査待ち"})]}),a.jsx("p",{className:"text-gray-600 mb-2",children:e.address}),a.jsxs("div",{className:"text-sm text-gray-500",children:[a.jsxs("p",{children:["オーナー: ",e.owner_name]}),a.jsxs("p",{children:["申請日: ",new Date(e.created_at).toLocaleDateString("ja-JP")]}),e.second_stage_submitted_at&&a.jsxs("p",{children:["第二審査申請日: ",new Date(e.second_stage_submitted_at).toLocaleDateString("ja-JP")]})]}),"second_stage_review"===e.status&&a.jsxs("div",{className:"mt-3 grid grid-cols-4 gap-2 text-sm",children:[a.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[a.jsx("p",{className:"font-medium text-blue-800",children:"全画像"}),a.jsxs("p",{className:"text-blue-600",children:[e.total_images,"枚"]})]}),a.jsxs("div",{className:"bg-yellow-50 p-2 rounded text-center",children:[a.jsx("p",{className:"font-medium text-yellow-800",children:"審査待ち"}),a.jsxs("p",{className:"text-yellow-600",children:[e.pending_images,"枚"]})]}),a.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[a.jsx("p",{className:"font-medium text-green-800",children:"承認済み"}),a.jsxs("p",{className:"text-green-600",children:[e.approved_images,"枚"]})]}),a.jsxs("div",{className:"bg-red-50 p-2 rounded text-center",children:[a.jsx("p",{className:"font-medium text-red-800",children:"却下"}),a.jsxs("p",{className:"text-red-600",children:[e.rejected_images,"枚"]})]})]})]}),a.jsxs("div",{className:"flex flex-col space-y-2",children:[a.jsxs(t,{onClick:()=>(async e=>{O(e),await X(e.id)})(e),variant:"secondary",children:[a.jsx(p,{className:"w-4 h-4 mr-2"}),"詳細を見る"]}),a.jsxs(t,{onClick:()=>(async e=>{try{K(!0),P(""),I("");const{error:a}=await s.from("dog_parks").update({status:"first_stage_passed"}).eq("id",e);if(a)throw a;let t={};const{data:r,error:i}=await s.from("dog_park_review_stages").select("id").eq("park_id",e).maybeSingle();if(i)throw i;if(r){t.first_stage_passed_at=(new Date).toISOString();const{error:a}=await s.from("dog_park_review_stages").update(t).eq("park_id",e);if(a)throw a}else{t={park_id:e,first_stage_passed_at:(new Date).toISOString()};const{error:a}=await s.from("dog_park_review_stages").insert([t]);if(a)throw a}const{data:l,error:c}=await s.from("dog_parks").select("name, owner_id").eq("id",e).single();if(c)throw c;const{error:n}=await s.from("notifications").insert([{user_id:l.owner_id,type:"park_approval_required",title:"第一審査通過のお知らせ",message:`${l.name}の第一審査が通過しました。第二審査の詳細情報を入力してください。`,data:{park_id:e}}]);if(n)throw n;await W(),O(null),I("ドッグランを承認しました。"),setTimeout((()=>{I("")}),3e3)}catch{P("承認に失敗しました")}finally{K(!1)}})(e.id),className:"bg-green-600 hover:bg-green-700",disabled:H,children:[a.jsx(m,{className:"w-4 h-4 mr-1"}),"承認"]}),a.jsxs(t,{onClick:()=>(async e=>{try{K(!0),P(""),I("");const{error:a}=await s.from("dog_parks").update({status:"rejected"}).eq("id",e);if(a)throw a;const{data:t,error:r}=await s.from("dog_parks").select("name, owner_id").eq("id",e).single();if(r)throw r;const{error:i}=await s.from("notifications").insert([{user_id:t.owner_id,type:"park_approval_required",title:"ドッグラン審査結果のお知らせ",message:`${t.name}の審査が却下されました。詳細はダッシュボードをご確認ください。`,data:{park_id:e}}]);if(i)throw i;await W(),O(null),I("ドッグランを却下しました。"),setTimeout((()=>{I("")}),3e3)}catch{P("却下に失敗しました")}finally{K(!1)}})(e.id),className:"bg-red-600 hover:bg-red-700",disabled:H,children:[a.jsx(d,{className:"w-4 h-4 mr-1"}),"却下"]})]})]})},e.id)))})]}),"parks"===_&&J&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[a.jsx(j,{className:"w-6 h-6 text-blue-600 mr-2"}),J.name,"の審査"]}),a.jsxs(t,{variant:"secondary",onClick:()=>{O(null),E([])},children:[a.jsx(n,{className:"w-4 h-4 mr-2"}),"一覧に戻る"]})]}),a.jsxs(c,{className:"p-6",children:[a.jsx("h3",{className:"font-semibold mb-4",children:"基本情報"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"施設名"}),a.jsx("p",{className:"font-medium",children:J.name})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"住所"}),a.jsx("p",{className:"font-medium",children:J.address})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"オーナー"}),a.jsx("p",{className:"font-medium",children:J.owner_name})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"申請日"}),a.jsx("p",{className:"font-medium",children:new Date(J.created_at).toLocaleDateString("ja-JP")})]}),J.second_stage_submitted_at&&a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"第二審査申請日"}),a.jsx("p",{className:"font-medium",children:new Date(J.second_stage_submitted_at).toLocaleDateString("ja-JP")})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"ステータス"}),a.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("first_stage_passed"===J.status?"bg-blue-100 text-blue-800":"second_stage_review"===J.status?"bg-purple-100 text-purple-800":"bg-yellow-100 text-yellow-800"),children:"first_stage_passed"===J.status?"第一審査通過":"second_stage_review"===J.status?"第二審査中":"審査待ち"})]})]})]}),a.jsxs(c,{className:"p-6",children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsx("h3",{className:"font-semibold",children:"施設画像"}),a.jsxs("div",{className:"text-sm text-gray-600",children:["全",A.length,"枚中、",a.jsxs("span",{className:"text-yellow-600",children:[A.filter((e=>null===e.is_approved)).length,"枚審査待ち"]}),"、",a.jsxs("span",{className:"text-green-600",children:[A.filter((e=>!0===e.is_approved)).length,"枚承認済み"]}),"、",a.jsxs("span",{className:"text-red-600",children:[A.filter((e=>!1===e.is_approved)).length,"枚却下"]})]})]}),0===A.length?a.jsxs("div",{className:"text-center py-8",children:[a.jsx(u,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"施設画像がまだアップロードされていません"})]}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:A.map((e=>{const s=!0===(r=e.is_approved)?{icon:m,color:"text-green-600",label:"承認済み"}:!1===r?{icon:d,color:"text-red-600",label:"却下"}:{icon:N,color:"text-yellow-600",label:"審査中"};var r;const i=s.icon;return a.jsxs("div",{className:"border rounded-lg overflow-hidden cursor-pointer hover:shadow-md transition-shadow",onClick:()=>Y(e),children:[a.jsx("div",{className:"h-48 bg-gray-100",children:a.jsx("img",{src:e.image_url,alt:ae(e.image_type),className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://via.placeholder.com/400x300?text=Image+Not+Available"}})}),a.jsxs("div",{className:"p-3",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h4",{className:"font-medium",children:ae(e.image_type)}),a.jsxs("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+(!0===e.is_approved?"bg-green-100 text-green-800":!1===e.is_approved?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:[a.jsx(i,{className:"w-3 h-3 inline mr-1"}),s.label]})]}),!1===e.is_approved&&e.admin_notes&&a.jsxs("p",{className:"text-xs text-red-600 mt-2 line-clamp-2",children:["却下理由: ",e.admin_notes]}),a.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["アップロード: ",new Date(e.created_at).toLocaleDateString("ja-JP")]}),null===e.is_approved&&a.jsxs("div",{className:"flex space-x-2 mt-2",children:[a.jsxs(t,{size:"sm",className:"bg-green-600 hover:bg-green-700 w-1/2",onClick:s=>{s.stopPropagation(),R(e),Z(!0)},children:[a.jsx(m,{className:"w-3 h-3 mr-1"}),"承認"]}),a.jsxs(t,{size:"sm",className:"bg-red-600 hover:bg-red-700 w-1/2",onClick:s=>{s.stopPropagation(),Y(e)},children:[a.jsx(d,{className:"w-3 h-3 mr-1"}),"却下"]})]})]})]},e.id)}))})]}),a.jsxs(c,{className:"p-6",children:[a.jsx("h3",{className:"font-semibold mb-4",children:"審査結果"}),"second_stage_review"===J.status?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"却下理由（却下する場合のみ入力）"}),a.jsx("textarea",{value:V,onChange:e=>G(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,placeholder:"例: 施設の安全基準を満たしていません。フェンスの高さが不足しています。"})]}),a.jsxs("div",{className:"flex justify-end space-x-3",children:[a.jsxs(t,{onClick:()=>ee(J.id,!1),isLoading:H,className:"bg-red-600 hover:bg-red-700",children:[a.jsx(d,{className:"w-4 h-4 mr-2"}),"却下"]}),a.jsxs(t,{onClick:()=>ee(J.id,!0),isLoading:H,className:"bg-green-600 hover:bg-green-700",disabled:!M,children:[a.jsx(m,{className:"w-4 h-4 mr-2"}),"QRコードテストへ進める"]})]}),!M&&a.jsxs("p",{className:"text-sm text-yellow-600 mt-3",children:[a.jsx(x,{className:"w-4 h-4 inline mr-1"}),"すべての画像を承認してから施設を承認してください"]})]}):a.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(N,{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-blue-800",children:"オーナーによる第二審査の申請待ち"}),a.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"オーナーが施設画像をアップロードし、第二審査を申請するのを待っています。"})]})]})})]})]}),"vaccines"===_&&!z&&a.jsxs("div",{className:"space-y-4",children:[a.jsx("h2",{className:"text-xl font-semibold",children:"審査待ちワクチン証明書"}),0===S.length?a.jsxs(c,{className:"text-center py-12",children:[a.jsx(m,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"審査待ちのワクチン証明書はありません"})]}):a.jsx("div",{className:"space-y-4",children:S.map((e=>a.jsx(c,{className:"p-6 hover:shadow-lg transition-shadow",children:a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-2",children:[e.dog.name,"のワクチン証明書"]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-gray-600",children:"犬種"}),a.jsx("p",{className:"font-medium",children:e.dog.breed})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-gray-600",children:"性別"}),a.jsx("p",{className:"font-medium",children:e.dog.gender})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-gray-600",children:"飼い主"}),a.jsx("p",{className:"font-medium",children:e.dog.owner.name})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-gray-600",children:"申請日"}),a.jsx("p",{className:"font-medium",children:new Date(e.created_at).toLocaleDateString("ja-JP")})]})]})]}),a.jsxs("div",{className:"flex space-x-2 ml-4",children:[a.jsxs(t,{size:"sm",variant:"secondary",onClick:()=>T(e),children:[a.jsx(p,{className:"w-4 h-4 mr-1"}),"詳細"]}),a.jsxs(t,{size:"sm",onClick:()=>se(e.id,!0),className:"bg-green-600 hover:bg-green-700",disabled:H,children:[a.jsx(m,{className:"w-4 h-4 mr-1"}),"承認"]}),a.jsxs(t,{size:"sm",onClick:()=>se(e.id,!1),className:"bg-red-600 hover:bg-red-700",disabled:H,children:[a.jsx(d,{className:"w-4 h-4 mr-1"}),"却下"]})]})]})},e.id)))})]}),"vaccines"===_&&z&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[a.jsx(g,{className:"w-6 h-6 text-blue-600 mr-2"}),z.dog.name,"のワクチン証明書審査"]}),a.jsxs(t,{variant:"secondary",onClick:()=>T(null),children:[a.jsx(n,{className:"w-4 h-4 mr-2"}),"一覧に戻る"]})]}),a.jsxs(c,{className:"p-6",children:[a.jsx("h3",{className:"font-semibold mb-4",children:"基本情報"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"名前"}),a.jsx("p",{className:"font-medium",children:z.dog.name})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"犬種"}),a.jsx("p",{className:"font-medium",children:z.dog.breed})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"性別"}),a.jsx("p",{className:"font-medium",children:z.dog.gender})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"生年月日"}),a.jsx("p",{className:"font-medium",children:new Date(z.dog.birth_date).toLocaleDateString("ja-JP")})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"飼い主"}),a.jsx("p",{className:"font-medium",children:z.dog.owner.name})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"申請日"}),a.jsx("p",{className:"font-medium",children:new Date(z.created_at).toLocaleDateString("ja-JP")})]})]})]}),a.jsxs(c,{className:"p-6",children:[a.jsx("h3",{className:"font-semibold mb-4",children:"ワクチン証明書"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium mb-2",children:"狂犬病ワクチン"}),z.rabies_vaccine_image?a.jsx("div",{className:"border rounded-lg overflow-hidden",children:a.jsx("img",{src:`https://onmcivwxtzqajcovptgf.supabase.co/storage/v1/object/public/vaccine-certs/${z.rabies_vaccine_image}`,alt:"狂犬病ワクチン証明書",className:"w-full h-64 object-contain",onError:e=>{e.currentTarget.src="https://via.placeholder.com/400x300?text=Image+Not+Available"}})}):a.jsx("div",{className:"h-64 bg-gray-100 rounded-lg flex items-center justify-center",children:a.jsx("p",{className:"text-gray-500",children:"画像なし"})}),z.rabies_expiry_date&&a.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["有効期限: ",new Date(z.rabies_expiry_date).toLocaleDateString("ja-JP")]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium mb-2",children:"混合ワクチン"}),z.combo_vaccine_image?a.jsx("div",{className:"border rounded-lg overflow-hidden",children:a.jsx("img",{src:`https://onmcivwxtzqajcovptgf.supabase.co/storage/v1/object/public/vaccine-certs/${z.combo_vaccine_image}`,alt:"混合ワクチン証明書",className:"w-full h-64 object-contain",onError:e=>{e.currentTarget.src="https://via.placeholder.com/400x300?text=Image+Not+Available"}})}):a.jsx("div",{className:"h-64 bg-gray-100 rounded-lg flex items-center justify-center",children:a.jsx("p",{className:"text-gray-500",children:"画像なし"})}),z.combo_expiry_date&&a.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["有効期限: ",new Date(z.combo_expiry_date).toLocaleDateString("ja-JP")]})]})]})]}),a.jsxs(c,{className:"p-6",children:[a.jsx("h3",{className:"font-semibold mb-4",children:"審査結果"}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"却下理由（却下する場合のみ入力）"}),a.jsx("textarea",{value:V,onChange:e=>G(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,placeholder:"例: ワクチン証明書の有効期限が切れています。最新の証明書をアップロードしてください。"})]}),a.jsxs("div",{className:"flex justify-end space-x-3",children:[a.jsxs(t,{onClick:()=>se(z.id,!1),isLoading:H,className:"bg-red-600 hover:bg-red-700",children:[a.jsx(d,{className:"w-4 h-4 mr-2"}),"却下"]}),a.jsxs(t,{onClick:()=>se(z.id,!0),isLoading:H,className:"bg-green-600 hover:bg-green-700",children:[a.jsx(m,{className:"w-4 h-4 mr-2"}),"承認"]})]})]})]})]}):a.jsx("div",{className:"flex justify-center items-center h-64",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})}export{f as AdminManagement};

import{u as e,b as s,j as t,B as a}from"./index-Dp3tQatg.js";import{u as l,r,L as i}from"./vendor-Cwmn0chA.js";import{C as c}from"./Card-CPEZwr97.js";import{O as n,d as x,F as d,a as m,l as h,i as o,Z as j,a2 as p,q as g,a3 as N,m as f}from"./ui-BHmKMuva.js";import"./supabase-Dzr8oIt2.js";function b(){const b=l(),{user:u}=e(),[y,w]=r.useState(!1),[v,S]=r.useState(""),[k,_]=r.useState(!1),[C,E]=r.useState(!1),[O,$]=r.useState(!1),[q,z]=r.useState("");r.useEffect((()=>{u?T():b("/login")}),[u,b]);const T=async()=>{try{const{data:e,error:t}=await s.from("owner_verifications").select("status, verification_id").eq("user_id",null==u?void 0:u.id).maybeSingle();if(t)throw t;e&&"verified"===e.status?E(!0):e&&e.verification_id&&await B(e.verification_id)}catch(e){}},B=async e=>{try{w(!0),S("");const{data:{session:t}}=await s.auth.getSession();if(!(null==t?void 0:t.access_token))throw new Error("認証が必要です");const a=await fetch("https://onmcivwxtzqajcovptgf.supabase.co/functions/v1/check-identity-verification",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.access_token}`},body:JSON.stringify({verificationId:e})});if(!a.ok){const e=await a.json();throw new Error(e.error||"本人確認ステータスの取得に失敗しました")}const l=await a.json();"verified"===l.status?E(!0):"processing"===l.status?S("本人確認は処理中です。しばらく経ってから再度お試しください。"):S("本人確認に問題があります。もう一度お試しください。")}catch(t){S(t.message||"エラーが発生しました")}finally{w(!1)}};return t.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[t.jsx("div",{className:"flex items-center space-x-4 mb-6",children:t.jsxs(i,{to:"/dashboard",className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[t.jsx(n,{className:"w-4 h-4 mr-2"}),"ダッシュボードに戻る"]})}),t.jsxs("div",{className:"text-center mb-8",children:[t.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-4 flex items-center justify-center",children:[t.jsx(x,{className:"w-8 h-8 text-blue-600 mr-3"}),"ドッグランオーナー契約"]}),t.jsx("p",{className:"text-lg text-gray-600",children:"ドッグランオーナーとして登録する前に、契約内容をご確認ください"})]}),t.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("div",{className:"w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center",children:t.jsx(d,{className:"w-5 h-5"})}),t.jsx("span",{className:"text-sm mt-2",children:"契約同意"})]}),t.jsx("div",{className:"flex-1 h-1 mx-4 bg-gray-300",children:t.jsx("div",{className:"h-full "+(k?"bg-blue-600":"bg-gray-300"),style:{width:k?"100%":"0%"}})}),t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("div",{className:`w-10 h-10 ${C?"bg-green-600":k?"bg-blue-600":"bg-gray-400"} text-white rounded-full flex items-center justify-center`,children:t.jsx(m,{className:"w-5 h-5"})}),t.jsx("span",{className:"text-sm mt-2",children:"本人確認"})]}),t.jsx("div",{className:"flex-1 h-1 mx-4 bg-gray-300",children:t.jsx("div",{className:"h-full "+(C?"bg-green-600":"bg-gray-300"),style:{width:C?"100%":"0%"}})}),t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("div",{className:`w-10 h-10 ${C?"bg-blue-600":"bg-gray-400"} text-white rounded-full flex items-center justify-center`,children:t.jsx(x,{className:"w-5 h-5"})}),t.jsx("span",{className:"text-sm mt-2",children:"施設登録"})]})]})}),v&&t.jsxs("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4 flex items-start",children:[t.jsx(h,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),t.jsx("p",{children:v})]}),C&&t.jsxs("div",{className:"bg-green-100 border border-green-300 text-green-800 rounded-lg p-4 flex items-start",children:[t.jsx(o,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium",children:"本人確認が完了しました"}),t.jsx("p",{className:"text-sm mt-1",children:"ドッグラン施設の登録に進むことができます。"})]})]}),C?t.jsx(c,{className:"p-6",children:t.jsxs("div",{className:"text-center",children:[t.jsx(o,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),t.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"契約同意と本人確認が完了しました"}),t.jsx("p",{className:"text-gray-600 mb-6",children:"おめでとうございます！ドッグランオーナー契約への同意と本人確認が完了しました。 次はドッグラン施設の登録に進みましょう。"}),t.jsxs(a,{onClick:()=>{b("/register-park")},className:"bg-blue-600 hover:bg-blue-700",children:[t.jsx(x,{className:"w-4 h-4 mr-2"}),"ドッグラン施設の登録に進む"]})]})}):t.jsx(t.Fragment,{children:q?t.jsx(c,{className:"p-6",children:t.jsxs("div",{className:"text-center",children:[t.jsx(m,{className:"w-16 h-16 text-blue-600 mx-auto mb-4"}),t.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"本人確認"}),t.jsx("p",{className:"text-gray-600 mb-6",children:"安全なプラットフォーム運営のため、ドッグランオーナーには本人確認が必要です。 Stripeの安全な本人確認サービスを使用して、身分証明書と顔写真による本人確認を行います。"}),t.jsx("div",{className:"bg-yellow-50 p-4 rounded-lg mb-6 text-left",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(h,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),t.jsxs("div",{className:"text-sm text-yellow-800",children:[t.jsx("p",{className:"font-medium mb-1",children:"必要な書類"}),t.jsxs("ul",{className:"space-y-1",children:[t.jsx("li",{children:"• 運転免許証、パスポート、マイナンバーカードのいずれか"}),t.jsx("li",{children:"• ウェブカメラまたはスマートフォンのカメラ（顔写真撮影用）"}),t.jsx("li",{children:"• 本人確認は通常5分程度で完了します"})]})]})]})}),O?t.jsxs("div",{className:"flex flex-col items-center justify-center py-4",children:[t.jsx(f,{className:"w-8 h-8 text-blue-600 animate-spin mb-4"}),t.jsx("p",{className:"text-gray-600",children:"本人確認セッションを準備中..."})]}):t.jsxs(a,{onClick:()=>window.location.href=q,className:"bg-blue-600 hover:bg-blue-700",children:[t.jsx(m,{className:"w-4 h-4 mr-2"}),"本人確認を開始"]}),t.jsx("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg text-left",children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(N,{className:"w-5 h-5 text-gray-600 mt-1"}),t.jsxs("div",{className:"text-sm text-gray-700",children:[t.jsx("p",{className:"font-medium mb-1",children:"プライバシーと安全性"}),t.jsx("p",{children:"本人確認情報は暗号化され、Stripeのセキュアなサーバーで安全に保管されます。 当サービスでは、本人確認が完了したかどうかの情報のみを保持し、身分証明書や顔写真などの個人情報は保存しません。"})]})]})})]})}):t.jsxs(c,{className:"p-6",children:[t.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center",children:[t.jsx(d,{className:"w-6 h-6 text-blue-600 mr-2"}),"ドッグランオーナー契約内容"]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[t.jsxs("h3",{className:"font-semibold text-blue-900 mb-2 flex items-center",children:[t.jsx(x,{className:"w-5 h-5 text-blue-600 mr-2"}),"施設運営について"]}),t.jsxs("div",{className:"text-sm text-blue-800 space-y-2",children:[t.jsx("p",{children:"1. オーナーは、ドッグラン施設の安全性と清潔さを維持する責任があります。"}),t.jsx("p",{children:"2. 施設は24時間営業を基本とし、無人運営システムを導入します。"}),t.jsx("p",{children:"3. 週に1回以上の定期的な施設点検・清掃が必要です。"}),t.jsx("p",{children:"4. 緊急時には1時間以内に施設に到着できる体制を整えてください。"}),t.jsx("p",{children:"5. 施設内でのトラブルや事故に関しては、当社は一切の責任を負いません。"})]})]}),t.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[t.jsxs("h3",{className:"font-semibold text-green-900 mb-2 flex items-center",children:[t.jsx(j,{className:"w-5 h-5 text-green-600 mr-2"}),"料金と収益配分"]}),t.jsxs("div",{className:"text-sm text-green-800 space-y-2",children:[t.jsx("p",{children:"1. 利用料金は全国統一で以下の通りです："}),t.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[t.jsx("li",{children:"通常利用：800円/日（時間制限なし）"}),t.jsx("li",{children:"サブスクリプション：3,800円/月（全国共通）"}),t.jsx("li",{children:"施設貸し切り：4,400円/時間"})]}),t.jsxs("p",{children:["2. 売上の",t.jsx("span",{className:"font-bold",children:"80%"}),"がオーナーに支払われます。"]}),t.jsxs("p",{children:["3. 残りの",t.jsx("span",{className:"font-bold",children:"20%"}),"は当社の手数料となります。"]}),t.jsx("p",{children:"4. 振込は毎月15日に前月分を一括で行います。"}),t.jsx("p",{children:"5. 振込手数料は当社が負担します。"})]})]}),t.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[t.jsxs("h3",{className:"font-semibold text-yellow-900 mb-2 flex items-center",children:[t.jsx(p,{className:"w-5 h-5 text-yellow-600 mr-2"}),"税金と法的責任"]}),t.jsxs("div",{className:"text-sm text-yellow-800 space-y-2",children:[t.jsx("p",{children:"1. オーナーは収益に対する税金の申告・納税義務があります。"}),t.jsx("p",{children:"2. 施設運営に必要な許認可の取得はオーナーの責任で行ってください。"}),t.jsx("p",{children:"3. 施設内での事故・トラブルに関する法的責任はオーナーが負うものとします。"}),t.jsx("p",{children:"4. 施設賠償責任保険への加入を強く推奨します。"})]})]}),t.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[t.jsxs("h3",{className:"font-semibold text-purple-900 mb-2 flex items-center",children:[t.jsx(g,{className:"w-5 h-5 text-purple-600 mr-2"}),"契約期間と解約"]}),t.jsxs("div",{className:"text-sm text-purple-800 space-y-2",children:[t.jsx("p",{children:"1. 契約期間は1年間とし、自動更新されます。"}),t.jsx("p",{children:"2. 解約を希望する場合は、30日前までに書面で通知が必要です。"}),t.jsx("p",{children:"3. 以下の場合、当社は即時契約解除できるものとします："}),t.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[t.jsx("li",{children:"本契約に違反した場合"}),t.jsx("li",{children:"施設の安全性が確保できない場合"}),t.jsx("li",{children:"利用者からの苦情が著しく多い場合"}),t.jsx("li",{children:"当社の信用を著しく毀損する行為があった場合"})]})]})]}),t.jsxs("div",{className:"bg-red-50 p-4 rounded-lg",children:[t.jsxs("h3",{className:"font-semibold text-red-900 mb-2 flex items-center",children:[t.jsx(h,{className:"w-5 h-5 text-red-600 mr-2"}),"禁止事項"]}),t.jsxs("div",{className:"text-sm text-red-800 space-y-2",children:[t.jsx("p",{children:"1. 当社の許可なく料金体系を変更すること"}),t.jsx("p",{children:"2. 当社のシステムを迂回して予約・決済を受けること"}),t.jsx("p",{children:"3. 利用者の個人情報を不正に収集・利用すること"}),t.jsx("p",{children:"4. 当社や他のオーナーの信用を毀損する行為"}),t.jsx("p",{children:"5. 反社会的勢力との関係を持つこと"})]})]}),t.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[t.jsxs("h3",{className:"font-semibold text-gray-900 mb-2 flex items-center",children:[t.jsx(N,{className:"w-5 h-5 text-gray-600 mr-2"}),"個人情報と機密保持"]}),t.jsxs("div",{className:"text-sm text-gray-800 space-y-2",children:[t.jsx("p",{children:"1. オーナーは利用者の個人情報を適切に管理し、漏洩防止に努めること"}),t.jsx("p",{children:"2. 契約期間中および終了後も、当社の機密情報を第三者に開示しないこと"}),t.jsx("p",{children:"3. 当社は法令に基づき、オーナーの個人情報を適切に管理します"})]})]}),t.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),k)try{w(!0),S("");const{error:e}=await s.from("owner_agreements").upsert([{user_id:null==u?void 0:u.id,agreed_at:(new Date).toISOString(),agreement_version:"1.0",agreement_type:"park_owner"}]);if(e)throw e;await(async()=>{try{$(!0),S("");const{data:{session:e}}=await s.auth.getSession();if(!(null==e?void 0:e.access_token))throw new Error("認証が必要です");const t=await fetch("https://onmcivwxtzqajcovptgf.supabase.co/functions/v1/create-identity-verification",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.access_token}`},body:JSON.stringify({returnUrl:`${window.location.origin}/park-registration-agreement`})});if(!t.ok){const e=await t.json();throw new Error(e.error||"本人確認セッションの作成に失敗しました")}const{url:a}=await t.json();if(!a)throw new Error("本人確認セッションの作成に失敗しました");z(a)}catch(e){S(e.message||"エラーが発生しました")}finally{$(!1)}})()}catch(t){S(t.message||"契約同意の処理に失敗しました。")}finally{w(!1)}else S("契約内容に同意してください。")},children:[t.jsx("div",{className:"border-t pt-6 mt-6",children:t.jsxs("label",{className:"flex items-start space-x-3 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:k,onChange:e=>_(e.target.checked),className:"mt-1 rounded text-blue-600"}),t.jsx("span",{className:"text-gray-700",children:"上記の契約内容をすべて読み、理解し、同意します。この契約は法的拘束力を持ちます。"})]})}),t.jsx("div",{className:"mt-6 flex justify-end",children:t.jsx(a,{type:"submit",isLoading:y,disabled:!k,children:"同意して本人確認に進む"})})]})]})]})}),t.jsx(c,{className:"bg-gray-50",children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(d,{className:"w-6 h-6 text-gray-600 mt-1"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"審査プロセスについて"}),t.jsxs("div",{className:"text-sm text-gray-700 space-y-1",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"契約同意:"})," ドッグランオーナー契約への同意"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"本人確認:"})," 安全なプラットフォーム運営のための本人確認"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"第一審査:"})," 基本的な条件の確認"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"第二審査:"})," 詳細な施設情報と書類審査"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"QRコード実証検査:"})," 実際の施設での動作確認"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"掲載・運営開始:"})," 一般公開と予約受付開始"]})]}),t.jsx("div",{className:"mt-3 flex items-center",children:t.jsxs(i,{to:"/owner-payment-system",className:"text-blue-600 hover:text-blue-800 flex items-center",children:[t.jsx(j,{className:"w-4 h-4 mr-1"}),t.jsx("span",{className:"text-sm font-medium",children:"料金体系と収益システムについて詳しく見る"})]})})]})]})})]})}export{b as ParkRegistrationAgreement};

import{j as e,R as s,aW as t,g as a,e as i,D as n,l as r,b0 as c,h as l,f as o}from"./ui-vendor-B03FHkej.js";import{r as m}from"./react-vendor-BBLDtDmh.js";import{B as d,C as h}from"./index-CWMjoAp3.js";import"./query-vendor-Cy2yKKks.js";import"./supabase-vendor-BcfcqyaE.js";const x=()=>{const[x,p]=m.useState(null),[u,j]=m.useState([]),[g,y]=m.useState(!1),[w,N]=m.useState("overview"),f=async()=>{y(!0);try{const e=await v();p(e);const s=await $();j(s)}catch(e){}finally{y(!1)}},v=async()=>{await new Promise(e=>setTimeout(e,2e3));return{performance:await b(),accessibility:await S(),bestPractices:await k(),seo:await W(),pwa:await P()}},b=async()=>{if("performance"in window&&performance.timing){const e=performance.timing,s=e.loadEventEnd-e.navigationStart,t=Math.max(0,Math.min(100,100-s/100));return{score:Math.round(t),displayValue:`${s}ms`,description:"ページの読み込み時間とパフォーマンス指標"}}return{score:85,displayValue:"1.2s",description:"ページの読み込み時間とパフォーマンス指標"}},S=async()=>{let e=100,s=[];const t=document.querySelectorAll("img"),a=Array.from(t).filter(e=>!e.alt);a.length>0&&(e-=10,s.push(`${a.length}個の画像にalt属性がありません`));0===document.querySelectorAll("h1, h2, h3, h4, h5, h6").length&&(e-=15,s.push("見出し要素が見つかりません"));const i=document.querySelectorAll("a"),n=Array.from(i).filter(e=>!e.textContent?.trim());return n.length>0&&(e-=5,s.push(`${n.length}個のリンクにテキストがありません`)),{score:Math.max(0,e),displayValue:`${Math.max(0,e)}%`,description:s.length>0?s.join(", "):"アクセシビリティ要件を満たしています"}},k=async()=>{let e=100,s=[];"https:"!==location.protocol&&"localhost"!==location.hostname&&(e-=20,s.push("HTTPS接続を使用していません"));document.querySelector('meta[http-equiv="Content-Security-Policy"]')||(e-=10,s.push("Content Security Policyが設定されていません"));const t=console.errors||[];return t.length>0&&(e-=15,s.push(`${t.length}個のJavaScriptエラーが発生しています`)),{score:Math.max(0,e),displayValue:`${Math.max(0,e)}%`,description:s.length>0?s.join(", "):"ベストプラクティスに従っています"}},W=async()=>{let e=100,s=[];const t=document.querySelector("title");t&&t.textContent?.trim()||(e-=20,s.push("titleタグが設定されていません"));document.querySelector('meta[name="description"]')||(e-=15,s.push("meta descriptionが設定されていません"));document.querySelector('meta[name="viewport"]')||(e-=10,s.push("viewportが設定されていません"));return document.documentElement.lang||(e-=5,s.push("html要素にlang属性が設定されていません")),{score:Math.max(0,e),displayValue:`${Math.max(0,e)}%`,description:s.length>0?s.join(", "):"SEO要件を満たしています"}},P=async()=>{let e=0,s=[];try{(await fetch("/manifest.json")).ok&&(e+=20,s.push("マニフェストファイル"))}catch(t){}if("serviceWorker"in navigator){await navigator.serviceWorker.getRegistration()&&(e+=30,s.push("Service Worker"))}if("caches"in window){(await caches.keys()).length>0&&(e+=25,s.push("オフライン対応"))}return window.matchMedia("(display-mode: standalone)").matches?(e+=25,s.push("インストール可能")):e+=10,{score:e,displayValue:`${s.length}/4 機能`,description:`実装済み: ${s.join(", ")}`}},$=async()=>{const e=[];try{const s=await fetch("/manifest.json");if(s.ok){const t=await s.json();e.push({id:"manifest-exists",name:"Webアプリマニフェスト",description:"manifest.jsonファイルが存在し、適切に設定されている",status:"compliant",score:100,details:"✓ マニフェストファイルが正常に読み込まれました",recommendation:"引き続き適切に管理してください"});const a=["name","short_name","start_url","display","icons"].filter(e=>!t[e]);0===a.length?e.push({id:"manifest-complete",name:"マニフェスト完全性",description:"マニフェストに必要なフィールドがすべて設定されている",status:"compliant",score:100,details:"✓ すべての必須フィールドが設定されています"}):e.push({id:"manifest-incomplete",name:"マニフェスト完全性",description:"マニフェストに必要なフィールドがすべて設定されている",status:"non-compliant",score:60,details:`✗ 不足フィールド: ${a.join(", ")}`,recommendation:"不足しているフィールドを追加してください"})}else e.push({id:"manifest-missing",name:"Webアプリマニフェスト",description:"manifest.jsonファイルが存在し、適切に設定されている",status:"non-compliant",score:0,details:"✗ マニフェストファイルが見つかりません",recommendation:"manifest.jsonファイルを作成してください"})}catch(a){e.push({id:"manifest-error",name:"Webアプリマニフェスト",description:"manifest.jsonファイルが存在し、適切に設定されている",status:"non-compliant",score:0,details:"✗ マニフェストファイルの読み込みに失敗しました",recommendation:"マニフェストファイルの構文を確認してください"})}if("serviceWorker"in navigator)try{await navigator.serviceWorker.getRegistration()?e.push({id:"service-worker",name:"Service Worker",description:"Service Workerが登録され、オフライン機能を提供している",status:"compliant",score:100,details:"✓ Service Workerが正常に登録されています"}):e.push({id:"service-worker-missing",name:"Service Worker",description:"Service Workerが登録され、オフライン機能を提供している",status:"non-compliant",score:0,details:"✗ Service Workerが登録されていません",recommendation:"Service Workerを実装してください"})}catch(a){e.push({id:"service-worker-error",name:"Service Worker",description:"Service Workerが登録され、オフライン機能を提供している",status:"non-compliant",score:0,details:"✗ Service Workerの確認中にエラーが発生しました",recommendation:"Service Workerの実装を確認してください"})}else e.push({id:"service-worker-unsupported",name:"Service Worker",description:"Service Workerが登録され、オフライン機能を提供している",status:"non-compliant",score:0,details:"✗ このブラウザはService Workerをサポートしていません",recommendation:"モダンブラウザでアクセスしてください"});const s="https:"===location.protocol||"localhost"===location.hostname;e.push({id:"https",name:"セキュア接続 (HTTPS)",description:"PWAはHTTPS接続で提供されている必要がある",status:s?"compliant":"non-compliant",score:s?100:0,details:s?"✓ セキュアな接続を使用しています":"✗ HTTPSを使用していません",recommendation:s?void 0:"HTTPSでアプリを提供してください"});const t=document.querySelector('meta[name="viewport"]');if(e.push({id:"responsive",name:"レスポンシブデザイン",description:"アプリが複数のデバイスサイズに対応している",status:t?"compliant":"non-compliant",score:t?100:0,details:t?"✓ ビューポートが適切に設定されています":"✗ ビューポートが設定されていません",recommendation:t?void 0:"ビューポートメタタグを追加してください"}),"caches"in window)try{const s=await caches.keys();e.push({id:"offline",name:"オフライン機能",description:"アプリがオフラインでも動作する",status:s.length>0?"compliant":"non-compliant",score:s.length>0?100:0,details:s.length>0?`✓ ${s.length}個のキャッシュが設定されています`:"✗ キャッシュが設定されていません",recommendation:s.length>0?void 0:"キャッシュ戦略を実装してください"})}catch(a){e.push({id:"offline-error",name:"オフライン機能",description:"アプリがオフラインでも動作する",status:"unknown",score:0,details:"? キャッシュの確認中にエラーが発生しました",recommendation:"キャッシュ機能を確認してください"})}else e.push({id:"offline-unsupported",name:"オフライン機能",description:"アプリがオフラインでも動作する",status:"non-compliant",score:0,details:"✗ このブラウザはCache APIをサポートしていません",recommendation:"モダンブラウザでアクセスしてください"});return e},q=e=>e>=90?"text-green-600":e>=70?"text-yellow-600":"text-red-600",A=s=>{switch(s){case"compliant":return e.jsx(a,{className:"h-5 w-5 text-green-500"});case"non-compliant":return e.jsx(o,{className:"h-5 w-5 text-red-500"});case"unknown":return e.jsx(r,{className:"h-5 w-5 text-yellow-500"})}};return m.useEffect(()=>{f()},[]),e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"PWA Lighthouse 監査"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Google Lighthouseスタイルの包括的なPWA監査を実行し、改善点を特定します。"}),e.jsxs(d,{onClick:f,disabled:g,className:"flex items-center gap-2 mx-auto",children:[e.jsx(s,{className:"h-4 w-4 "+(g?"animate-spin":"")}),g?"監査実行中...":"監査を再実行"]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[{key:"overview",label:"概要",icon:e.jsx(t,{className:"h-4 w-4"})},{key:"requirements",label:"PWA要件",icon:e.jsx(a,{className:"h-4 w-4"})},{key:"suggestions",label:"改善提案",icon:e.jsx(i,{className:"h-4 w-4"})}].map(s=>e.jsxs("button",{onClick:()=>N(s.key),className:"flex items-center gap-2 px-4 py-2 rounded-md transition-colors "+(w===s.key?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"),children:[s.icon,s.label]},s.key))})}),"overview"===w&&x&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:Object.entries(x).map(([s,t])=>{return e.jsxs(h,{className:"p-6 text-center "+(a=t.score,a>=90?"bg-green-100":a>=70?"bg-yellow-100":"bg-red-100"),children:[e.jsx("div",{className:`text-3xl font-bold ${q(t.score)} mb-2`,children:t.score}),e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1 capitalize",children:"bestPractices"===s?"Best Practices":"seo"===s?"SEO":"pwa"===s?"PWA":s}),e.jsx("div",{className:"text-xs text-gray-600",children:t.displayValue})]},s);var a})}),"requirements"===w&&e.jsx("div",{className:"space-y-4",children:u.map(s=>e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[A(s.status),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.name}),void 0!==s.score&&e.jsxs("span",{className:`text-sm font-medium ${q(s.score)}`,children:[s.score,"/100"]})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-3",children:s.description}),e.jsx("p",{className:"text-sm text-gray-700 mb-2",children:s.details}),s.recommendation&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"推奨事項:"})," ",s.recommendation]})})]})]})},s.id))}),"suggestions"===w&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(h,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(n,{className:"h-5 w-5"}),"インストール最適化"]}),e.jsxs("ul",{className:"space-y-3 text-sm",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(a,{className:"h-4 w-4 text-green-500 mt-0.5"}),e.jsx("span",{children:"カスタムインストールプロンプトを実装"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(a,{className:"h-4 w-4 text-green-500 mt-0.5"}),e.jsx("span",{children:"アプリアイコンを複数サイズで提供"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(r,{className:"h-4 w-4 text-yellow-500 mt-0.5"}),e.jsx("span",{children:"スプラッシュスクリーン画像を追加"})]})]})]}),e.jsxs(h,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(c,{className:"h-5 w-5"}),"オフライン機能強化"]}),e.jsxs("ul",{className:"space-y-3 text-sm",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(a,{className:"h-4 w-4 text-green-500 mt-0.5"}),e.jsx("span",{children:"重要なページのプリキャッシュ"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(r,{className:"h-4 w-4 text-yellow-500 mt-0.5"}),e.jsx("span",{children:"オフライン状態の通知機能"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(r,{className:"h-4 w-4 text-yellow-500 mt-0.5"}),e.jsx("span",{children:"データ同期機能の実装"})]})]})]}),e.jsxs(h,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(s,{className:"h-5 w-5"}),"パフォーマンス向上"]}),e.jsxs("ul",{className:"space-y-3 text-sm",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(a,{className:"h-4 w-4 text-green-500 mt-0.5"}),e.jsx("span",{children:"リソースの圧縮とminify"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(r,{className:"h-4 w-4 text-yellow-500 mt-0.5"}),e.jsx("span",{children:"重要でないリソースの遅延読み込み"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(r,{className:"h-4 w-4 text-yellow-500 mt-0.5"}),e.jsx("span",{children:"CDNの活用"})]})]})]}),e.jsxs(h,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(l,{className:"h-5 w-5"}),"ユーザー体験向上"]}),e.jsxs("ul",{className:"space-y-3 text-sm",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(r,{className:"h-4 w-4 text-yellow-500 mt-0.5"}),e.jsx("span",{children:"プッシュ通知機能の実装"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(r,{className:"h-4 w-4 text-yellow-500 mt-0.5"}),e.jsx("span",{children:"バックグラウンド同期"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(r,{className:"h-4 w-4 text-yellow-500 mt-0.5"}),e.jsx("span",{children:"アプリ更新通知"})]})]})]})]}),g&&e.jsx(h,{className:"p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(s,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-blue-500"}),e.jsx("p",{className:"text-gray-600",children:"Lighthouse監査を実行中..."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"パフォーマンス、アクセシビリティ、PWA要件などを総合的に分析しています"})]})})]})};export{x as default};

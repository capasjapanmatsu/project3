var e=Object.defineProperty,s=Object.defineProperties,t=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,n=(s,t,r)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,i=(e,s)=>{for(var t in s||(s={}))l.call(s,t)&&n(e,t,s[t]);if(r)for(var t of r(s))a.call(s,t)&&n(e,t,s[t]);return e},c=(e,r)=>s(e,t(r)),d=(e,s,t)=>new Promise((r,l)=>{var a=e=>{try{i(t.next(e))}catch(s){l(s)}},n=e=>{try{i(t.throw(e))}catch(s){l(s)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,n);i((t=t.apply(e,s)).next())});import{s as o,G as m,a as u,j as x,C as y,B as h}from"./index.CQlxbczY.js";import{r as p}from"./vendor.CKEClKZl.js";import{u as f,L as j}from"./router.B_7Atevv.js";import{g as N}from"./deploymentStatus.DYNCI66r.js";import{z as g,aC as b,A as v,g as w,a0 as _,al as S,R as O,J as k,C as L}from"./ui.C72fRZ1L.js";import"./supabase.X3H3st79.js";function C(){return d(this,arguments,function*(e={}){try{const{data:{session:s}}=yield o.auth.getSession();if(!(null==s?void 0:s.access_token))throw new Error("認証が必要です");const t=yield fetch("/functions/v1/deploy-to-netlify",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.access_token}`},body:JSON.stringify({buildCommand:e.buildCommand||"npm run build",outputDir:e.outputDir||"dist",siteId:e.siteId,deployId:e.deployId,netlifyApiKey:"your_netlify_api_key"})});if(!t.ok){const e=yield t.json();throw new Error(e.error||"デプロイに失敗しました")}return yield t.json()}catch(s){throw s}})}function I(e,s){return d(this,null,function*(){try{return yield C({siteId:e,deployId:s})}catch(t){throw t}})}function J(){const e=f(),[s,t]=p.useState(!1),[r,l]=p.useState(!1),[a,n]=p.useState(null),[o,J]=p.useState(null),[D,R]=p.useState(null),[P,U]=p.useState(!1);p.useEffect(()=>{const e=m("lastDeployment");if(e)try{const s=JSON.parse(e);n(s),s.site_id&&s.deploy_id&&H(s.site_id,s.deploy_id)}catch(s){!function(e){try{"undefined"!=typeof window&&window.localStorage&&window.localStorage.removeItem(e)}catch(s){}}("lastDeployment")}},[]);const E=()=>d(this,null,function*(){try{t(!0),J(null),R(null);const e=yield C();n(e),R("デプロイが開始されました！ステータスを確認してください。"),u("lastDeployment",JSON.stringify(e)),T(e);const s=setInterval(()=>d(this,null,function*(){try{const t=yield I(e.site_id,e.deploy_id);n(t),["ready","error","failed"].includes(t.status)&&(clearInterval(s),"ready"===t.status?R("デプロイが完了しました！以下のURLでサイトを確認できます。"):J("デプロイに失敗しました。詳細はNetlifyダッシュボードで確認してください。")),u("lastDeployment",JSON.stringify(t)),q(t)}catch(t){}}),5e3);return()=>clearInterval(s)}catch(e){J(e.message||"デプロイに失敗しました")}finally{t(!1)}}),H=(e,s)=>d(this,null,function*(){try{l(!0),J(null);const t=yield I(e,s);n(t),u("lastDeployment",JSON.stringify(t)),q(t),"ready"===t.status?R("デプロイが完了しています！以下のURLでサイトを確認できます。"):["error","failed"].includes(t.status)?J("デプロイに失敗しました。詳細はNetlifyダッシュボードで確認してください。"):R("デプロイは進行中です。ステータスを確認してください。")}catch(t){J(t.message||"デプロイステータスの確認に失敗しました")}finally{l(!1)}}),T=e=>{try{const s=m("deploymentHistory");let t=s?JSON.parse(s):[];t.unshift(c(i({},e),{created_at:(new Date).toISOString()})),t.length>10&&(t=t.slice(0,10)),u("deploymentHistory",JSON.stringify(t))}catch(s){}},q=e=>{try{const s=m("deploymentHistory");if(!s)return;let t=JSON.parse(s);t=t.map(s=>s.deploy_id===e.deploy_id?c(i({},s),{status:e.status,deploy_url:e.deploy_url}):s),u("deploymentHistory",JSON.stringify(t))}catch(s){}};return x.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[x.jsx("div",{className:"flex items-center space-x-4 mb-6",children:x.jsxs(j,{to:"/dashboard",className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[x.jsx(g,{className:"w-4 h-4 mr-2"}),"ダッシュボードに戻る"]})}),x.jsxs("div",{className:"text-center mb-8",children:[x.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-4 flex items-center justify-center",children:[x.jsx(b,{className:"w-8 h-8 text-blue-600 mr-3"}),"サイトをデプロイ"]}),x.jsx("p",{className:"text-lg text-gray-600",children:"あなたのアプリケーションをNetlifyにデプロイします"})]}),o&&x.jsxs("div",{className:"mb-6 p-4 bg-red-50 rounded-lg flex items-start",children:[x.jsx(v,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),x.jsx("p",{className:"text-red-800",children:o})]}),D&&x.jsxs("div",{className:"mb-6 p-4 bg-green-50 rounded-lg flex items-start",children:[x.jsx(w,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),x.jsx("p",{className:"text-green-800",children:D})]}),x.jsxs(y,{className:"p-6",children:[x.jsx("h2",{className:"text-xl font-semibold mb-6",children:"デプロイ設定"}),x.jsxs("div",{className:"space-y-6",children:[x.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:x.jsxs("div",{className:"flex items-start space-x-3",children:[x.jsx(b,{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),x.jsxs("div",{className:"text-sm text-blue-800",children:[x.jsx("p",{className:"font-medium mb-1",children:"Netlifyデプロイについて"}),x.jsx("p",{children:"このツールを使用すると、現在のプロジェクトをNetlifyに自動的にデプロイできます。デプロイが完了すると、公開URLが提供されます。"})]})]})}),a?x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[x.jsx("h3",{className:"font-semibold mb-2",children:"最新のデプロイ情報"}),x.jsxs("div",{className:"space-y-2",children:[x.jsxs("div",{className:"flex justify-between items-center",children:[x.jsx("span",{className:"text-sm text-gray-600",children:"ステータス:"}),x.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${(e=>{switch(e){case"ready":return"text-green-600 bg-green-100";case"error":case"failed":return"text-red-600 bg-red-100";case"building":case"enqueued":case"processing":return"text-blue-600 bg-blue-100";default:return"text-gray-600 bg-gray-100"}})(a.status)}`,children:(e=>{switch(e){case"ready":return"完了";case"error":case"failed":return"失敗";case"building":return"ビルド中";case"enqueued":return"待機中";case"processing":return"処理中";default:return e}})(a.status)})]}),a.deploy_url&&x.jsxs("div",{className:"flex justify-between items-center",children:[x.jsx("span",{className:"text-sm text-gray-600",children:"公開URL:"}),x.jsxs("div",{className:"flex items-center space-x-2",children:[x.jsxs("a",{href:a.deploy_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-800 flex items-center",children:[a.deploy_url.replace(/^https?:\/\//,""),x.jsx(_,{className:"w-3 h-3 ml-1"})]}),x.jsx("button",{onClick:()=>{return e=a.deploy_url,void navigator.clipboard.writeText(e).then(()=>{U(!0),setTimeout(()=>U(!1),2e3)});var e},className:"text-gray-500 hover:text-gray-700",title:"URLをコピー",children:x.jsx(S,{className:"w-4 h-4"})})]})]}),a.claim_url&&!a.claimed&&x.jsx("div",{className:"mt-2",children:x.jsxs("a",{href:a.claim_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-800 flex items-center",children:["Netlifyでサイトを管理する",x.jsx(_,{className:"w-3 h-3 ml-1"})]})})]})]}),x.jsxs("div",{className:"flex space-x-3",children:[x.jsxs(h,{onClick:()=>{(null==a?void 0:a.site_id)&&(null==a?void 0:a.deploy_id)&&H(a.site_id,a.deploy_id)},variant:"secondary",isLoading:r,children:[x.jsx(O,{className:"w-4 h-4 mr-2"}),"ステータスを更新"]}),x.jsxs(h,{onClick:E,isLoading:s,disabled:["building","enqueued","processing"].includes(a.status),children:[x.jsx(b,{className:"w-4 h-4 mr-2"}),"再デプロイ"]}),x.jsxs(h,{onClick:()=>e("/deployment-history"),variant:"secondary",children:[x.jsx(k,{className:"w-4 h-4 mr-2"}),"デプロイ履歴"]})]})]}):x.jsxs("div",{className:"space-y-4",children:[x.jsxs(h,{onClick:E,isLoading:s,className:"w-full",children:[x.jsx(b,{className:"w-4 h-4 mr-2"}),"Netlifyにデプロイ"]}),x.jsxs(h,{onClick:()=>d(this,null,function*(){try{l(!0),J(null);"ready"===(yield N({})).status&&R("デプロイが完了しています！以下のURLでサイトを確認できます。")}catch(e){J(e.message||"デプロイステータスの確認に失敗しました")}finally{l(!1)}}),variant:"secondary",isLoading:r,className:"w-full",children:[x.jsx(L,{className:"w-4 h-4 mr-2"}),"デプロイステータスを確認"]})]}),P&&x.jsx("div",{className:"text-center text-sm text-green-600",children:"URLをコピーしました！"})]})]}),x.jsxs(y,{className:"p-6 bg-gray-50",children:[x.jsx("h3",{className:"font-semibold mb-4",children:"デプロイについての注意事項"}),x.jsxs("div",{className:"text-sm text-gray-700 space-y-2",children:[x.jsx("p",{children:"• デプロイには数分かかる場合があります"}),x.jsx("p",{children:"• デプロイが完了すると、公開URLが提供されます"}),x.jsx("p",{children:"• Netlifyアカウントをお持ちの場合は、サイトを自分のアカウントに移行できます"}),x.jsx("p",{children:"• 環境変数は自動的に設定されます"}),x.jsx("p",{children:"• 問題が発生した場合は、Netlifyダッシュボードで詳細を確認してください"})]})]})]})}export{J as Deploy};

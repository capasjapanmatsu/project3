/*! Build: 2025-07-17T07:59:15.523Z
Version: 0.0.0 */
import{u as e,r as s,j as a,a7 as t,C as l,B as r,at as i,X as n,F as d,am as m}from"./vendor-react.D8SVeCGP.js";import{u as c,C as o,I as x,B as h}from"./components-admin.GT3qRZg5.js";import{s as g}from"./utils.C9ZsMnW6.js";import"./vendor-misc.qnLj5toF.js";import"./hooks.CTtJlocA.js";import"./vendor-stripe.B5MJ2ewd.js";import"./pages-dog.BrfoFXaJ.js";import"./vendor-supabase.RBPF72ft.js";const b=[{id:"pet_hotel",name:"ペットホテル",monthly_fee:5e3,is_free:!0},{id:"pet_salon",name:"ペットサロン",monthly_fee:3e3,is_free:!0},{id:"veterinary",name:"動物病院",monthly_fee:8e3,is_free:!0},{id:"pet_cafe",name:"ペットカフェ",monthly_fee:4e3,is_free:!0},{id:"pet_restaurant",name:"ペット同伴レストラン",monthly_fee:6e3,is_free:!0},{id:"pet_shop",name:"ペットショップ",monthly_fee:7e3,is_free:!0},{id:"pet_accommodation",name:"ペット同伴宿泊",monthly_fee:1e4,is_free:!0}];function f(){const{user:f,isAuthenticated:p}=c(),j=e(),[u,N]=s.useState(!1),[y,v]=s.useState(""),[_,w]=s.useState(""),[S,C]=s.useState([]),[k,D]=s.useState([]),[I,E]=s.useState(""),[$,B]=s.useState({name:"",category_id:"",address:"",phone:"",website:"",description:"",images:[],identityDocument:null});s.useEffect((()=>{p||j("/login")}),[p,j]);const P=e=>{const{name:s,value:a}=e.target;B((e=>({...e,[s]:a})))};return p?a.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[a.jsxs("div",{className:"mb-8",children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"ペット関連施設登録"}),a.jsx("p",{className:"text-gray-600",children:"ペット関連施設の掲載申請を行います。管理者の承認後、地図に表示されます。"})]}),y&&a.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(t,{className:"w-5 h-5 text-red-500 mr-2"}),a.jsx("span",{className:"text-red-700",children:y})]})}),_&&a.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(l,{className:"w-5 h-5 text-green-500 mr-2"}),a.jsx("span",{className:"text-green-700",children:_})]})}),a.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),f)if($.name&&$.category_id&&$.address){N(!0),v("");try{const e={owner_id:f.id,name:$.name,category_id:$.category_id,address:$.address,phone:$.phone,website:$.website,description:$.description,status:"pending",created_at:(new Date).toISOString()},{data:s,error:a}=await g.from("pet_facilities").insert(e).select().single();if(a)throw a;if($.images.length>0&&s){const e=$.images.map(((e,a)=>{const t=`facility_${s.id}_image_${a+1}_${Date.now()}.jpg`;return{facility_id:s.id,image_data:e,file_name:t,file_type:"image/png",file_size:Math.round(.75*e.length),original_name:`facility_image_${a+1}.jpg`,is_primary:0===a,is_compressed:!0,created_at:(new Date).toISOString()}})),{error:a}=await g.from("facility_images").insert(e)}w("施設の掲載申請が完了しました！管理者の承認後、地図に掲載されます。"),setTimeout((()=>{j("/dashboard")}),2e3)}catch(s){v(s instanceof Error?s.message:"申請に失敗しました")}finally{N(!1)}}else v("必須項目を入力してください");else v("ログインが必要です")},className:"space-y-6",children:[a.jsx(o,{children:a.jsxs("div",{className:"p-6",children:[a.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center",children:[a.jsx(r,{className:"w-6 h-6 mr-2"}),"基本情報"]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["施設名 ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx(x,{label:"施設名",name:"name",value:$.name,onChange:P,placeholder:"施設名を入力してください",required:!0})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["施設カテゴリ ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("select",{name:"category_id",value:$.category_id,onChange:P,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[a.jsx("option",{value:"",children:"カテゴリを選択してください"}),b.map((e=>a.jsx("option",{value:e.id,children:e.name},e.id)))]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["住所 ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx(x,{label:"住所",name:"address",value:$.address,onChange:P,placeholder:"住所を入力してください",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"電話番号"}),a.jsx(x,{label:"電話番号",name:"phone",value:$.phone,onChange:P,placeholder:"電話番号を入力してください"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ウェブサイト"}),a.jsx(x,{label:"ウェブサイト",name:"website",value:$.website,onChange:P,placeholder:"https://example.com"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"施設の説明"}),a.jsx("textarea",{name:"description",value:$.description,onChange:P,rows:4,placeholder:"施設の特徴やサービス内容を入力してください",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})]})}),a.jsx(o,{className:"mb-6",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center",children:[a.jsx(i,{className:"w-6 h-6 mr-2"}),"施設画像 (最大5枚)"]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"画像をアップロード"}),a.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:async e=>{const s=Array.from(e.target.files||[]);if(0!==s.length)if(S.length+s.length>5)v("画像は最大5枚までアップロードできます");else{N(!0),v("");try{if(s.filter((e=>e.size>10485760)).length>0)return v("画像ファイルのサイズは10MB以下にしてください"),void N(!1);const e=await Promise.all(s.map((e=>(e=>new Promise(((s,a)=>{const t=document.createElement("canvas"),l=t.getContext("2d"),r=new window.Image;r.onload=()=>{let{width:e,height:a}=r;e>a?e>800&&(a=800*a/e,e=800):a>600&&(e=600*e/a,a=600),t.width=e,t.height=a,null==l||l.drawImage(r,0,0,e,a);const i=t.toDataURL("image/png",.8);s(i)},r.onerror=a,r.src=URL.createObjectURL(e)})))(e)))),a=s.slice(0,5-S.length);C((e=>[...e,...a])),D((s=>[...s,...e])),B((s=>({...s,images:[...s.images,...e]})))}catch(a){v(a instanceof Error?a.message:"画像の処理に失敗しました")}finally{N(!1)}}},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:u||S.length>=5}),a.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"JPG, PNG, GIF対応。1ファイル10MB以下。画像は自動的にリサイズ・圧縮されます。"})]}),k.length>0&&a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:k.map(((e,s)=>a.jsxs("div",{className:"relative",children:[a.jsx("img",{src:e,alt:`プレビュー ${s+1}`,className:"w-full h-32 object-cover rounded-lg border border-gray-200"}),a.jsx("button",{type:"button",onClick:()=>(e=>{C((s=>s.filter(((s,a)=>a!==e)))),D((s=>s.filter(((s,a)=>a!==e)))),B((s=>({...s,images:s.images.filter(((s,a)=>a!==e))})))})(s),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center hover:bg-red-600",children:a.jsx(n,{className:"w-4 h-4"})})]},s)))})]})}),a.jsx(o,{className:"mb-6",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center",children:[a.jsx(d,{className:"w-6 h-6 mr-2"}),"本人確認書類（システムメンテナンス中）"]}),a.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:[a.jsxs("div",{className:"flex items-center mb-2",children:[a.jsx(m,{className:"w-5 h-5 text-yellow-500 mr-2"}),a.jsx("span",{className:"font-medium text-yellow-800",children:"システムメンテナンス中"})]}),a.jsx("p",{className:"text-yellow-700 text-sm",children:"現在、本人確認書類のアップロード機能はシステムメンテナンス中です。 一時的に書類のアップロードなしで申請を行うことができます。 本機能は近日中に復旧予定です。"})]})]})}),a.jsx(o,{className:"mb-6",children:a.jsx("div",{className:"p-6",children:a.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center mb-2",children:[a.jsx(l,{className:"w-5 h-5 text-green-500 mr-2"}),a.jsx("span",{className:"font-medium text-green-800",children:"無料掲載キャンペーン実施中！"})]}),a.jsxs("p",{className:"text-green-700",children:["現在、すべてのペット関連施設が",a.jsx("strong",{className:"text-lg",children:"無料"}),"で掲載できます。"]}),a.jsx("p",{className:"text-sm text-green-600 mt-2",children:"申請後、管理者の承認を経て掲載開始となります。"})]})})}),a.jsx("div",{className:"flex justify-end",children:a.jsx(h,{type:"submit",disabled:u,children:u?"申請中...":"申請を送信する"})})]})]}):null}export{f as default};

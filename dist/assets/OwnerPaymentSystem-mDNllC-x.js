import{j as e,V as s,ah as a,A as t,f as r,o as n,aC as c,z as l,D as i,h as d,C as x,F as m}from"./ui-vendor-CTwuE44L.js";import{u as o,r as h,L as u}from"./react-vendor-BBLDtDmh.js";import{u as p,s as j,C as b,B as g}from"./index-BbveZyU8.js";import"./query-vendor-9fkSW1iq.js";import"./supabase-vendor-BcfcqyaE.js";function f(){const{user:f}=p(),N=o(),[_,w]=h.useState(!0),[v,k]=h.useState(""),[S,C]=h.useState(""),[L,E]=h.useState([]),[q,D]=h.useState(null),[z,$]=h.useState(!1),[V,B]=h.useState(!1),[F,M]=h.useState({bank_name:"",bank_code:"",branch_name:"",branch_code:"",account_type:"ordinary",account_number:"",account_holder_name:""}),[T,A]=h.useState(0),[G,H]=h.useState(0);h.useEffect(()=>{f?J():N("/login")},[f,N]);const J=async()=>{try{w(!0);const{data:e,error:s}=await j.from("monthly_payouts").select("*").order("year",{ascending:!1}).order("month",{ascending:!1});if(s)throw s;E(e||[]);const a=(e||[]).reduce((e,s)=>e+s.total_revenue,0),t=(e||[]).reduce((e,s)=>e+s.owner_payout,0);A(a),H(t);const{data:r,error:n}=await j.from("owner_bank_accounts").select("*").eq("owner_id",f?.id).maybeSingle();if(n&&"PGRST116"!==n.code)throw n;D(r),r&&M({id:r.id,bank_name:r.bank_name,bank_code:r.bank_code,branch_name:r.branch_name,branch_code:r.branch_code,account_type:r.account_type,account_number:r.account_number,account_holder_name:r.account_holder_name})}catch(e){k(e.message||"データの取得に失敗しました")}finally{w(!1)}},P=e=>({pending:"振込予定",processing:"振込処理中",completed:"振込完了"}[e]||e);return _?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center space-x-4 mb-6",children:e.jsxs(u,{to:"/owner-dashboard",className:"flex items-center text-blue-600 hover:text-blue-800",children:[e.jsx(s,{className:"w-4 h-4 mr-2"}),"オーナーダッシュボードに戻る"]})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-4 flex items-center justify-center",children:[e.jsx(a,{className:"w-8 h-8 text-green-600 mr-3"}),"収益管理システム"]}),e.jsx("p",{className:"text-lg text-gray-600",children:"ドッグラン施設の収益と振込情報を管理します"})]}),v&&e.jsxs("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4 flex items-start",children:[e.jsx(t,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsx("p",{children:v})]}),S&&e.jsxs("div",{className:"bg-green-100 border border-green-300 text-green-800 rounded-lg p-4 flex items-start",children:[e.jsx(r,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsx("p",{children:S})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"総売上"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["¥",T.toLocaleString()]})]}),e.jsx(a,{className:"w-8 h-8 text-green-600"})]})}),e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"プラットフォーム手数料"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["¥",(.2*T).toLocaleString()]}),e.jsx("p",{className:"text-xs text-blue-600",children:"売上の20%"})]}),e.jsx(n,{className:"w-8 h-8 text-blue-600"})]})}),e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"オーナー取り分"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:["¥",G.toLocaleString()]}),e.jsx("p",{className:"text-xs text-purple-600",children:"売上の80%"})]}),e.jsx(c,{className:"w-8 h-8 text-purple-600"})]})})]}),e.jsxs(b,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[e.jsx(c,{className:"w-6 h-6 text-blue-600 mr-2"}),"振込先情報"]}),q&&!z?e.jsxs(g,{onClick:()=>$(!0),size:"sm",children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"編集する"]}):null]}),z?e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),B(!0),k(""),C("");try{if(!F.bank_name)throw new Error("銀行名を入力してください");if(!F.bank_code)throw new Error("銀行コードを入力してください");if(!F.branch_name)throw new Error("支店名を入力してください");if(!F.branch_code)throw new Error("支店コードを入力してください");if(!F.account_number)throw new Error("口座番号を入力してください");if(!F.account_holder_name)throw new Error("口座名義を入力してください");if(!/^\d{4}$/.test(F.bank_code))throw new Error("銀行コードは4桁の数字で入力してください");if(!/^\d{3}$/.test(F.branch_code))throw new Error("支店コードは3桁の数字で入力してください");if(!/^\d{7}$/.test(F.account_number))throw new Error("口座番号は7桁の数字で入力してください");if(q){const{error:e}=await j.from("owner_bank_accounts").update({bank_name:F.bank_name,bank_code:F.bank_code,branch_name:F.branch_name,branch_code:F.branch_code,account_type:F.account_type,account_number:F.account_number,account_holder_name:F.account_holder_name}).eq("id",q.id);if(e)throw e}else{const{error:e}=await j.from("owner_bank_accounts").insert({owner_id:f?.id,bank_name:F.bank_name,bank_code:F.bank_code,branch_name:F.branch_name,branch_code:F.branch_code,account_type:F.account_type,account_number:F.account_number,account_holder_name:F.account_holder_name});if(e)throw e}C("振込先情報を保存しました"),$(!1),await J(),setTimeout(()=>{C("")},3e3)}catch(s){k(s.message||"振込先情報の保存に失敗しました")}finally{B(!1)}},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"銀行名 *"}),e.jsx("input",{type:"text",value:F.bank_name,onChange:e=>M({...F,bank_name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例：三菱UFJ銀行",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"銀行コード（4桁） *"}),e.jsx("input",{type:"text",value:F.bank_code,onChange:e=>{const s=e.target.value.replace(/\D/g,"");M({...F,bank_code:s})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例：0005",maxLength:4,required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"4桁の数字で入力してください"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"支店名 *"}),e.jsx("input",{type:"text",value:F.branch_name,onChange:e=>M({...F,branch_name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例：渋谷支店",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"支店コード（3桁） *"}),e.jsx("input",{type:"text",value:F.branch_code,onChange:e=>{const s=e.target.value.replace(/\D/g,"");M({...F,branch_code:s})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例：135",maxLength:3,required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"3桁の数字で入力してください"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"口座種別 *"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",checked:"ordinary"===F.account_type,onChange:()=>M({...F,account_type:"ordinary"}),className:"form-radio text-blue-600"}),e.jsx("span",{children:"普通"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",checked:"checking"===F.account_type,onChange:()=>M({...F,account_type:"checking"}),className:"form-radio text-blue-600"}),e.jsx("span",{children:"当座"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"口座番号（7桁） *"}),e.jsx("input",{type:"text",value:F.account_number,onChange:e=>{const s=e.target.value.replace(/\D/g,"");M({...F,account_number:s})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例：1234567",maxLength:7,required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"7桁の数字で入力してください"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"口座名義（カタカナ） *"}),e.jsx("input",{type:"text",value:F.account_holder_name,onChange:e=>M({...F,account_holder_name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例：ヤマダ タロウ",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"カタカナで入力してください（姓と名の間にスペース）"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[q&&e.jsx(g,{type:"button",variant:"secondary",onClick:()=>$(!1),children:"キャンセル"}),e.jsx(g,{type:"submit",isLoading:V,children:"保存する"})]})]}):q?e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"銀行名"}),e.jsx("p",{className:"font-medium",children:q.bank_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"銀行コード"}),e.jsx("p",{className:"font-medium",children:q.bank_code})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"支店名"}),e.jsx("p",{className:"font-medium",children:q.branch_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"支店コード"}),e.jsx("p",{className:"font-medium",children:q.branch_code})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"口座種別"}),e.jsx("p",{className:"font-medium",children:"ordinary"===q.account_type?"普通":"当座"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"口座番号"}),e.jsx("p",{className:"font-medium",children:q.account_number})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"口座名義"}),e.jsx("p",{className:"font-medium",children:q.account_holder_name})]})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(c,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"振込先情報が登録されていません"}),e.jsx(g,{onClick:()=>$(!0),children:"振込先情報を登録する"})]})]}),e.jsxs(b,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[e.jsx(l,{className:"w-6 h-6 text-blue-600 mr-2"}),"月別収益"]}),e.jsxs(g,{variant:"secondary",size:"sm",onClick:()=>{alert("CSVダウンロード機能は準備中です")},children:[e.jsx(i,{className:"w-4 h-4 mr-2"}),"CSV出力"]})]}),0===L.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(d,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"まだ収益データがありません"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"ドッグランの利用があると、ここに収益データが表示されます"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"年月"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"施設名"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"売上合計"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"手数料（20%）"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"振込金額（80%）"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ステータス"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:L.map(s=>{return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:[s.year,"年",(t=s.month,["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"][t-1])]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.park_name}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["¥",s.total_revenue.toLocaleString()]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:["¥",s.platform_fee.toLocaleString()]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-green-600",children:["¥",s.owner_payout.toLocaleString()]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("span",{className:`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${a=s.status,{pending:"bg-yellow-100 text-yellow-800",processing:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800"}[a]||"bg-gray-100 text-gray-800"}`,children:P(s.status)})})]},s.id);var a,t})})]})})]}),e.jsx(b,{className:"p-6 bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(x,{className:"w-6 h-6 text-blue-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"振込スケジュール"}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("p",{children:"• 振込は毎月15日に前月分を一括で行います"}),e.jsx("p",{children:"• 振込手数料は当社負担です"}),e.jsx("p",{children:"• 振込金額が5,000円未満の場合は翌月に繰り越されます"}),e.jsx("p",{children:"• 振込完了後、メールでお知らせします"}),e.jsx("p",{children:"• 振込先情報に変更がある場合は、前月末日までに更新してください"})]})]})]})}),e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(m,{className:"w-6 h-6 text-gray-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"収益システムについて"}),e.jsxs("div",{className:"text-sm text-gray-700 space-y-1",children:[e.jsxs("p",{children:["• 売上の",e.jsx("span",{className:"font-medium",children:"80%"}),"がオーナー様に支払われます"]}),e.jsxs("p",{children:["• 残りの",e.jsx("span",{className:"font-medium",children:"20%"}),"は当社の手数料となります"]}),e.jsx("p",{children:"• 手数料には、決済手数料、システム利用料、保険料などが含まれます"}),e.jsx("p",{children:"• 収益は以下の項目から発生します："}),e.jsxs("ul",{className:"list-disc pl-5 space-y-1 mt-1",children:[e.jsx("li",{children:"通常利用（1日券）：800円/日"}),e.jsx("li",{children:"施設貸し切り：4,400円/時間"}),e.jsx("li",{children:"プライベートブース：サブスク使い放題・1日券でも利用可能（追加料金なし）"})]}),e.jsx("p",{children:"• サブスクリプション収益は利用回数に応じて分配されます"})]})]})]})})]})}function y({className:s}){return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}export{f as OwnerPaymentSystem};

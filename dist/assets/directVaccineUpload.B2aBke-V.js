import{s as e}from"./admin-pages.BuCPNRRu.js";import"./ui-vendor.5lywbznV.js";import"./react-vendor.C7ykWfwV.js";import"./supabase-vendor.CX-WoPCS.js";const t=async(t,r,a="vaccine-certs")=>{var s;try{if(!(r&&r instanceof File))throw new Error("無効なファイルです");let o=r.type;if(!o||"application/octet-stream"===o){const e=null==(s=r.name.split(".").pop())?void 0:s.toLowerCase();switch(e){case"jpg":case"jpeg":o="image/jpeg";break;case"png":o="image/png";break;case"gif":o="image/gif";break;case"webp":o="image/webp";break;default:throw new Error(`サポートされていないファイル形式: ${e}`)}}if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(o))throw new Error(`サポートされていないMIMEタイプ: ${o}`);const{data:{session:i},error:n}=await e.auth.getSession();if(n)throw new Error("認証エラーが発生しました");if(!(null==i?void 0:i.access_token))throw new Error("認証されていません。ログインしてください。");const c=i.access_token,p=`${"https://onmcivwxtzqajcovptgf.supabase.co"}/storage/v1/object/${a}/${t}`,g=await fetch(p,{method:"PUT",headers:{Authorization:`Bearer ${c}`,"Content-Type":o,"Cache-Control":"3600","x-upsert":"true"},body:r});if(!g.ok){await g.text();throw 520===g.status?new Error("一時的なサーバーエラーが発生しました。しばらく待ってから再度お試しください。"):g.status>=500?new Error(`サーバーエラーが発生しました (${g.status})。しばらく待ってから再度お試しください。`):new Error(`アップロードに失敗しました: ${g.status} ${g.statusText}`)}await g.json();const{data:{publicUrl:w}}=e.storage.from(a).getPublicUrl(t);return{success:!0,url:w}}catch(o){return{success:!1,error:o.message}}};export{t as directVaccineUpload};

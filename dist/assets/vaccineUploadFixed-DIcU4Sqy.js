import{s as e}from"./index-BFgW40ku.js";const r=e=>{if(!e)return{isValid:!1,error:"ファイルが選択されていません"};if(e.size>10485760)return{isValid:!1,error:"ファイルサイズは10MB以下にしてください"};return["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(e.type)?{isValid:!0}:{isValid:!1,error:`サポートされていない画像形式です: ${e.type}`}},s=async(r,s,i)=>{try{const c=r.name.split(".").pop()||"jpg",t=`${s}/${i}_${Date.now()}.${c}`;if(!(r instanceof File))throw new Error("Invalid file object: expected File, got "+typeof r);const{data:a,error:o}=await e.storage.from("vaccine-certs").upload(t,r,{cacheControl:"3600",upsert:!0,contentType:r.type});if(o)return{success:!1,error:`アップロードに失敗しました: ${o.message}`};const{data:{publicUrl:n}}=e.storage.from("vaccine-certs").getPublicUrl(t);return{success:!0,filePath:t}}catch(c){return{success:!1,error:c.message}}},i=async(r,i,c,t,a)=>{try{let o,n;if(i){const e=await s(i,r,"rabies");if(!e.success)return{success:!1,error:`狂犬病ワクチン証明書: ${e.error}`};o=e.filePath}if(c){const e=await s(c,r,"combo");if(!e.success)return{success:!1,error:`混合ワクチン証明書: ${e.error}`};n=e.filePath}const{data:u,error:f}=await e.from("vaccine_certifications").select("id").eq("dog_id",r).maybeSingle();if(f&&"PGRST116"!==f.code)return{success:!1,error:`データベース確認エラー: ${f.message}`};const g={status:"pending"};if(o&&(g.rabies_vaccine_image=o),n&&(g.combo_vaccine_image=n),t&&(g.rabies_expiry_date=t),a&&(g.combo_expiry_date=a),u){const{error:r}=await e.from("vaccine_certifications").update(g).eq("id",u.id);if(r)return{success:!1,error:`証明書更新エラー: ${r.message}`}}else{const{error:s}=await e.from("vaccine_certifications").insert([{dog_id:r,...g}]);if(s)return{success:!1,error:`証明書作成エラー: ${s.message}`}}return{success:!0}}catch(o){return{success:!1,error:o.message}}};export{i as h,r as v};

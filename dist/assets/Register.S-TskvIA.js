/*! Build: 2025-07-17T07:59:15.523Z
Version: 0.0.0 */
import{u as e,r as s,j as a,N as l,f as r,U as t,M as n,L as i,O as d,S as c,az as m,n as o}from"./vendor-react.D8SVeCGP.js";import{C as x,B as u,I as h}from"./components-admin.GT3qRZg5.js";import{q as p,s as j,u as g,w as b}from"./utils.C9ZsMnW6.js";import"./vendor-misc.qnLj5toF.js";import"./hooks.CTtJlocA.js";import"./vendor-stripe.B5MJ2ewd.js";import"./pages-dog.BrfoFXaJ.js";import"./vendor-supabase.RBPF72ft.js";function N(){const N=e(),[v,y]=s.useState(!1),[f,w]=s.useState(""),[C,k]=s.useState(!1),[T,q]=s.useState(!1),[S,L]=s.useState(""),[$,U]=s.useState(!1),[_,P]=s.useState({email:"",password:"",confirmPassword:"",userType:"user",name:"",postalCode:"",address:"",phoneNumber:""}),D=e=>{const s=e.replace(/\D/g,"");return s.length<=11?s.length>7?s.slice(0,3)+"-"+s.slice(3,7)+"-"+s.slice(7):s.length>3?s.slice(0,3)+"-"+s.slice(3):s:_.phoneNumber},E=async e=>{const s=(e=>{const s=e.replace(/\D/g,"");return s.length<=7?s.length>3?s.slice(0,3)+"-"+s.slice(3):s:_.postalCode})(e);if(P({..._,postalCode:s}),7===s.replace(/-/g,"").length){q(!0),L("");try{const e=await g(s);if(e.success&&e.results&&e.results.length>0){const s=b(e.results[0]);P((e=>({...e,address:s})))}else L(e.message||"住所が見つかりませんでした")}catch(a){L("住所の検索中にエラーが発生しました")}finally{q(!1)}}};return C?a.jsx("div",{className:"max-w-md mx-auto",children:a.jsxs(x,{className:"text-center p-8",children:[a.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:a.jsx(l,{className:"w-8 h-8 text-green-600"})}),a.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"メールを確認してください"}),a.jsxs("p",{className:"text-gray-600 mb-4",children:[_.email,"にログインリンクを送信しました。メールを確認してリンクをクリックしてください。"]}),a.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"メールが届かない場合は、迷惑メールフォルダを確認するか、別のメールアドレスでお試しください。"}),a.jsx(u,{onClick:()=>N("/login"),children:"ログイン画面に戻る"})]})}):a.jsxs("div",{className:"max-w-md mx-auto",children:[a.jsx("h1",{className:"text-2xl font-bold text-center mb-8",children:"新規登録"}),a.jsxs(x,{children:[a.jsxs("div",{className:"flex justify-center mb-4 space-x-2",children:[a.jsx(u,{type:"button",onClick:()=>U(!1),variant:$?"secondary":"primary",children:"Magic Link"}),a.jsx(u,{type:"button",onClick:()=>U(!0),variant:$?"primary":"secondary",children:"パスワード"})]}),$?a.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),y(!0),w(""),!_.name.trim())return w("お名前を入力してください"),void y(!1);if(!_.postalCode.trim())return w("郵便番号を入力してください"),void y(!1);if(!_.address.trim())return w("住所を入力してください"),void y(!1);if(!_.phoneNumber.trim())return w("電話番号を入力してください"),void y(!1);if(!_.password)return w("パスワードを入力してください"),void y(!1);if(_.password.length<6)return w("パスワードは6文字以上で入力してください"),void y(!1);if(_.password!==_.confirmPassword)return w("パスワードが一致しません"),void y(!1);if(!/^\d{3}-\d{4}$/.test(_.postalCode))return w("郵便番号は7桁の数字で入力してください（例：1234567）"),void y(!1);if(!/^0\d{2,3}-\d{1,4}-\d{4}$/.test(_.phoneNumber))return w("電話番号は正しい形式で入力してください（例：09012345678）"),void y(!1);try{p("lastUsedEmail",_.email);const{data:e,error:s}=await j.auth.signUp({email:_.email,password:_.password,options:{data:{user_type:_.userType,name:_.name,postal_code:_.postalCode,address:_.address,phone_number:_.phoneNumber}}});if(s)throw s;N("/two-factor-setup")}catch(s){const e=s.message||"";e.includes("already registered")||e.includes("already exists")||e.includes("User already")||e.includes("duplicate key")?w("このメールアドレスは既に登録されています"):w(e||"登録に失敗しました")}finally{y(!1)}},className:"p-6",children:[f&&a.jsxs("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded-lg flex items-start",children:[a.jsx(r,{className:"w-5 h-5 mr-2 flex-shrink-0 mt-0.5"}),a.jsx("div",{children:a.jsx("p",{children:f})})]}),a.jsx(h,{label:"お名前 *",value:_.name,onChange:e=>P({..._,name:e.target.value}),required:!0,placeholder:"山田太郎",icon:a.jsx(t,{className:"w-4 h-4 text-gray-500"})}),a.jsxs("div",{className:"mb-4 relative",children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["郵便番号 * ",a.jsx("span",{className:"text-xs text-blue-600",children:"(入力すると住所が自動入力されます)"})]}),a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:a.jsx(n,{className:"h-4 w-4 text-gray-500"})}),a.jsx("input",{type:"text",value:_.postalCode,onChange:e=>E(e.target.value),className:`w-full pl-10 pr-10 py-2 border ${S?"border-red-500":"border-gray-300"} rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500`,placeholder:"123-4567（数字のみ入力）",maxLength:8,required:!0}),T&&a.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:a.jsx(i,{className:"h-4 w-4 text-blue-500 animate-spin"})})]}),S&&a.jsx("p",{className:"mt-1 text-sm text-red-600",children:S})]}),a.jsx(h,{label:"住所 *",value:_.address,onChange:e=>P({..._,address:e.target.value}),required:!0,placeholder:"東京都渋谷区渋谷1-1-1",icon:a.jsx(n,{className:"w-4 h-4 text-gray-500"})}),a.jsx(h,{label:"電話番号 *",type:"tel",value:_.phoneNumber,onChange:e=>{const s=D(e.target.value);P({..._,phoneNumber:s})},required:!0,placeholder:"09012345678（数字のみ入力）",maxLength:13,helperText:"認証に使用します。正確に入力してください。",icon:a.jsx(d,{className:"w-4 h-4 text-gray-500"})}),a.jsx(h,{label:"メールアドレス *",type:"email",value:_.email,onChange:e=>P({..._,email:e.target.value}),required:!0,placeholder:"example@email.com",icon:a.jsx(l,{className:"w-4 h-4 text-gray-500"})}),a.jsx(h,{label:"パスワード *",type:"password",value:_.password,onChange:e=>P({..._,password:e.target.value}),required:!0,placeholder:"6文字以上",helperText:"6文字以上で入力してください",icon:a.jsx(m,{className:"w-4 h-4 text-gray-500"})}),a.jsx(h,{label:"パスワード確認 *",type:"password",value:_.confirmPassword,onChange:e=>P({..._,confirmPassword:e.target.value}),required:!0,placeholder:"パスワードを再入力",helperText:"パスワードを再入力してください",icon:a.jsx(m,{className:"w-4 h-4 text-gray-500"})}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"アカウントタイプ *"}),a.jsxs("div",{className:"flex space-x-4",children:[a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"radio",value:"user",checked:"user"===_.userType,onChange:e=>P({..._,userType:e.target.value}),className:"mr-2"}),"利用者"]}),a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"radio",value:"owner",checked:"owner"===_.userType,onChange:e=>P({..._,userType:e.target.value}),className:"mr-2"}),"施設オーナー"]})]})]}),a.jsx("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg",children:a.jsxs("p",{className:"text-sm text-blue-800",children:[a.jsx("span",{className:"font-medium",children:"※ 入力のヒント"}),a.jsx("br",{}),"• 郵便番号：数字のみ入力（例：1234567）",a.jsx("br",{}),"• 電話番号：数字のみ入力（例：09012345678）",a.jsx("br",{}),"ハイフンは自動で挿入されます。"]})}),a.jsx("div",{className:"mb-4 p-3 bg-green-50 rounded-lg",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(c,{className:"w-5 h-5 text-green-600 mt-0.5 flex-shrink-0"}),a.jsxs("div",{className:"text-sm text-green-800",children:[a.jsx("p",{className:"font-medium mb-1",children:"セキュリティ強化"}),a.jsx("p",{children:"パスワード登録後、2ファクタ認証（TOTP）の設定をお勧めします。Google Authenticatorなどの認証アプリでQRコードをスキャンするだけで簡単に設定できます。"})]})]})}),a.jsxs(u,{type:"submit",isLoading:v,className:"w-full",children:[a.jsx(m,{className:"w-4 h-4 mr-2"}),"登録する"]})]}):a.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),y(!0),w(""),!_.name.trim())return w("お名前を入力してください"),void y(!1);if(!_.postalCode.trim())return w("郵便番号を入力してください"),void y(!1);if(!_.address.trim())return w("住所を入力してください"),void y(!1);if(!_.phoneNumber.trim())return w("電話番号を入力してください"),void y(!1);if(!/^\d{3}-\d{4}$/.test(_.postalCode))return w("郵便番号は7桁の数字で入力してください（例：1234567）"),void y(!1);if(!/^0\d{2,3}-\d{1,4}-\d{4}$/.test(_.phoneNumber))return w("電話番号は正しい形式で入力してください（例：09012345678）"),void y(!1);try{p("lastUsedEmail",_.email);const{error:e}=await j.auth.signInWithOtp({email:_.email,options:{emailRedirectTo:`${window.location.origin}/dashboard`,data:{user_type:_.userType,name:_.name,postal_code:_.postalCode,address:_.address,phone_number:_.phoneNumber}}});if(e)throw e;k(!0)}catch(s){const e=s.message||"";e.includes("already registered")||e.includes("already exists")||e.includes("User already")||e.includes("duplicate key")?w("このメールアドレスは既に登録されています"):w(e||"登録に失敗しました")}finally{y(!1)}},className:"p-6",children:[f&&a.jsxs("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded-lg flex items-start",children:[a.jsx(r,{className:"w-5 h-5 mr-2 flex-shrink-0 mt-0.5"}),a.jsx("div",{children:a.jsx("p",{children:f})})]}),a.jsx(h,{label:"お名前 *",value:_.name,onChange:e=>P({..._,name:e.target.value}),required:!0,placeholder:"山田太郎",icon:a.jsx(t,{className:"w-4 h-4 text-gray-500"})}),a.jsxs("div",{className:"mb-4 relative",children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["郵便番号 * ",a.jsx("span",{className:"text-xs text-blue-600",children:"(入力すると住所が自動入力されます)"})]}),a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:a.jsx(n,{className:"h-4 w-4 text-gray-500"})}),a.jsx("input",{type:"text",value:_.postalCode,onChange:e=>E(e.target.value),className:`w-full pl-10 pr-10 py-2 border ${S?"border-red-500":"border-gray-300"} rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500`,placeholder:"123-4567（数字のみ入力）",maxLength:8,required:!0}),T&&a.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:a.jsx(i,{className:"h-4 w-4 text-blue-500 animate-spin"})})]}),S&&a.jsx("p",{className:"mt-1 text-sm text-red-600",children:S})]}),a.jsx(h,{label:"住所 *",value:_.address,onChange:e=>P({..._,address:e.target.value}),required:!0,placeholder:"東京都渋谷区渋谷1-1-1",icon:a.jsx(n,{className:"w-4 h-4 text-gray-500"})}),a.jsx(h,{label:"電話番号 *",type:"tel",value:_.phoneNumber,onChange:e=>{const s=D(e.target.value);P({..._,phoneNumber:s})},required:!0,placeholder:"09012345678（数字のみ入力）",maxLength:13,helperText:"認証に使用します。正確に入力してください。",icon:a.jsx(d,{className:"w-4 h-4 text-gray-500"})}),a.jsx(h,{label:"メールアドレス *",type:"email",value:_.email,onChange:e=>P({..._,email:e.target.value}),required:!0,placeholder:"example@email.com",icon:a.jsx(l,{className:"w-4 h-4 text-gray-500"})}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"アカウントタイプ *"}),a.jsxs("div",{className:"flex space-x-4",children:[a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"radio",value:"user",checked:"user"===_.userType,onChange:e=>P({..._,userType:e.target.value}),className:"mr-2"}),"利用者"]}),a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"radio",value:"owner",checked:"owner"===_.userType,onChange:e=>P({..._,userType:e.target.value}),className:"mr-2"}),"施設オーナー"]})]})]}),a.jsx("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg",children:a.jsxs("p",{className:"text-sm text-blue-800",children:[a.jsx("span",{className:"font-medium",children:"※ 入力のヒント"}),a.jsx("br",{}),"• 郵便番号：数字のみ入力（例：1234567）",a.jsx("br",{}),"• 電話番号：数字のみ入力（例：09012345678）",a.jsx("br",{}),"ハイフンは自動で挿入されます。"]})}),a.jsx("div",{className:"mb-4 p-3 bg-yellow-50 rounded-lg",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(c,{className:"w-5 h-5 text-yellow-600 mt-0.5 flex-shrink-0"}),a.jsxs("div",{className:"text-sm text-yellow-800",children:[a.jsx("p",{className:"font-medium mb-1",children:"Magic Linkについて"}),a.jsx("p",{children:"登録後、入力したメールアドレスにログイン用のリンクが送信されます。リンクをクリックするだけで簡単にログインできます。"})]})]})}),a.jsxs(u,{type:"submit",isLoading:v,className:"w-full",children:[a.jsx(c,{className:"w-4 h-4 mr-2"}),"登録する"]})]}),a.jsx("div",{className:"mt-4 text-center p-6",children:a.jsxs("p",{className:"text-sm text-gray-600",children:["すでにアカウントをお持ちの方は",a.jsx(o,{to:"/login",className:"text-blue-600 hover:underline ml-1",children:"こちらからログイン"})]})})]})]})}export{N as Register};

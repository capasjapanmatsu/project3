var e=Object.defineProperty,s=Object.defineProperties,a=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,i=(s,a,t)=>a in s?e(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t,c=(e,s)=>{for(var a in s||(s={}))r.call(s,a)&&i(e,a,s[a]);if(t)for(var a of t(s))l.call(s,a)&&i(e,a,s[a]);return e},d=(e,t)=>s(e,a(t)),n=(e,s,a)=>new Promise(((t,r)=>{var l=e=>{try{c(a.next(e))}catch(s){r(s)}},i=e=>{try{c(a.throw(e))}catch(s){r(s)}},c=e=>e.done?t(e.value):Promise.resolve(e.value).then(l,i);c((a=a.apply(e,s)).next())}));import{u as m,s as x,j as o,C as h,B as u}from"./index.oOj2R_C7.js";import{r as j}from"./router.icJHpBzt.js";import{j as g,C as p,h as b,g as f,e as N,v as y,q as v,n as w,au as _}from"./ui.UnEvinBv.js";import"./vendor.D1SiiUJb.js";import"./supabase.CZ8ekJUM.js";const k={pet_hotel:"ペットホテル",pet_salon:"ペットサロン",veterinary:"動物病院",pet_cafe:"ペットカフェ",pet_restaurant:"ペット同伴レストラン",pet_shop:"ペットショップ",pet_accommodation:"ペット同伴宿泊"};function S(){const{user:e,isAdmin:s}=m(),[a,t]=j.useState([]),[r,l]=j.useState(!0),[i,S]=j.useState(""),[O,P]=j.useState("all"),[C,$]=j.useState(!1),[q,D]=j.useState(null),[E,z]=j.useState(""),[I,A]=j.useState(!1);j.useEffect((()=>{s?B():S("管理者権限が必要です")}),[s]);const B=()=>n(null,null,(function*(){try{l(!0),S("");const{data:e,error:s}=yield x.from("pet_facilities").select("*").order("created_at",{ascending:!1});if(s)throw s;const a=yield Promise.all((e||[]).map((e=>n(null,null,(function*(){const{data:s,error:a}=yield x.from("facility_images").select("*").eq("facility_id",e.id).order("is_primary",{ascending:!1});return d(c({},e),a?{images:[]}:{images:s||[]})})))));t(a)}catch(e){S(e instanceof Error?e.message:"データの取得に失敗しました")}finally{l(!1)}})),J=a.filter((e=>"all"===O||e.status===O)),L=e=>{switch(e){case"pending":return"text-yellow-600 bg-yellow-50";case"approved":return"text-green-600 bg-green-50";case"rejected":return"text-red-600 bg-red-50";default:return"text-gray-600 bg-gray-50"}},F=e=>{switch(e){case"pending":return"承認待ち";case"approved":return"承認済み";case"rejected":return"却下";default:return"不明"}};return s?o.jsxs("div",{className:"max-w-7xl mx-auto p-4",children:[o.jsxs("div",{className:"mb-8",children:[o.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"ペット関連施設 承認管理"}),o.jsx("p",{className:"text-gray-600",children:"登録されたペット関連施設の承認・却下を管理します。"})]}),i&&o.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:o.jsxs("div",{className:"flex items-center",children:[o.jsx(g,{className:"w-5 h-5 text-red-500 mr-2"}),o.jsx("span",{className:"text-red-700",children:i})]})}),o.jsx("div",{className:"mb-6",children:o.jsx("div",{className:"flex space-x-4",children:[{key:"all",label:"すべて",count:a.length},{key:"pending",label:"承認待ち",count:a.filter((e=>"pending"===e.status)).length},{key:"approved",label:"承認済み",count:a.filter((e=>"approved"===e.status)).length},{key:"rejected",label:"却下",count:a.filter((e=>"rejected"===e.status)).length}].map((({key:e,label:s,count:a})=>o.jsxs("button",{onClick:()=>P(e),className:"px-4 py-2 rounded-lg font-medium transition-colors "+(O===e?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:[s," (",a,")"]},e)))})}),r?o.jsx("div",{className:"flex items-center justify-center py-20",children:o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:J.map((e=>o.jsx(h,{className:"overflow-hidden",children:o.jsxs("div",{className:"p-6",children:[o.jsx("div",{className:"flex items-start justify-between mb-4",children:o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:e.name}),o.jsx("p",{className:"text-sm text-gray-600 mb-2",children:k[e.category_id]||e.category_id}),o.jsxs("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${L(e.status)}`,children:["pending"===e.status&&o.jsx(p,{className:"w-3 h-3 mr-1"}),"approved"===e.status&&o.jsx(b,{className:"w-3 h-3 mr-1"}),"rejected"===e.status&&o.jsx(f,{className:"w-3 h-3 mr-1"}),F(e.status)]})]})}),o.jsxs("div",{className:"space-y-2 mb-4",children:[o.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[o.jsx(N,{className:"w-4 h-4 mr-2"}),o.jsx("span",{className:"truncate",children:e.address})]}),e.phone&&o.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[o.jsx(y,{className:"w-4 h-4 mr-2"}),o.jsx("span",{children:e.phone})]}),o.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[o.jsx(v,{className:"w-4 h-4 mr-2"}),o.jsx("span",{children:new Date(e.created_at).toLocaleDateString("ja-JP")})]})]}),e.images.length>0&&o.jsxs("div",{className:"mb-4",children:[o.jsx("div",{className:"grid grid-cols-3 gap-2",children:e.images.slice(0,3).map(((e,s)=>o.jsx("img",{src:e.image_data,alt:`施設画像 ${s+1}`,className:"w-full h-16 object-cover rounded border"},e.id)))}),e.images.length>3&&o.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["+",e.images.length-3,"枚の画像"]})]}),o.jsx(u,{onClick:()=>{D(e),$(!0)},className:"w-full",size:"sm",children:"詳細を確認"})]})},e.id)))}),0===J.length&&!r&&o.jsxs("div",{className:"text-center py-20",children:[o.jsx(w,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),o.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"施設がありません"}),o.jsx("p",{className:"text-gray-600",children:"all"===O?"登録された施設がありません":`${F(O)}の施設がありません`})]}),C&&q&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:o.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:o.jsxs("div",{className:"p-6",children:[o.jsxs("div",{className:"flex items-start justify-between mb-6",children:[o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:q.name}),o.jsx("p",{className:"text-gray-600",children:k[q.category_id]||q.category_id})]}),o.jsx("button",{onClick:()=>$(!1),className:"text-gray-400 hover:text-gray-600",children:o.jsx(f,{className:"w-6 h-6"})})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold mb-3",children:"基本情報"}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"flex items-center",children:[o.jsx(N,{className:"w-5 h-5 text-gray-500 mr-3"}),o.jsx("span",{children:q.address})]}),q.phone&&o.jsxs("div",{className:"flex items-center",children:[o.jsx(y,{className:"w-5 h-5 text-gray-500 mr-3"}),o.jsx("span",{children:q.phone})]}),q.website&&o.jsxs("div",{className:"flex items-center",children:[o.jsx(_,{className:"w-5 h-5 text-gray-500 mr-3"}),o.jsx("a",{href:q.website,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800",children:q.website})]})]})]}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold mb-3",children:"ステータス"}),o.jsxs("div",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${L(q.status)}`,children:["pending"===q.status&&o.jsx(p,{className:"w-4 h-4 mr-2"}),"approved"===q.status&&o.jsx(b,{className:"w-4 h-4 mr-2"}),"rejected"===q.status&&o.jsx(f,{className:"w-4 h-4 mr-2"}),F(q.status)]}),q.rejection_reason&&o.jsx("div",{className:"mt-3 p-3 bg-red-50 border border-red-200 rounded-lg",children:o.jsxs("p",{className:"text-sm text-red-700",children:[o.jsx("strong",{children:"却下理由:"})," ",q.rejection_reason]})})]})]}),q.description&&o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold mb-3",children:"施設紹介"}),o.jsx("p",{className:"text-gray-700 whitespace-pre-line",children:q.description})]}),q.images.length>0&&o.jsxs("div",{className:"mb-6",children:[o.jsxs("h3",{className:"text-lg font-semibold mb-3",children:["施設画像 (",q.images.length,"枚)"]}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:q.images.map(((e,s)=>o.jsxs("div",{className:"relative",children:[o.jsx("img",{src:e.image_data,alt:`施設画像 ${s+1}`,className:"w-full h-32 object-cover rounded-lg border"}),e.is_primary&&o.jsx("div",{className:"absolute top-2 left-2 bg-blue-500 text-white text-xs px-2 py-1 rounded",children:"メイン"})]},e.id)))})]}),"pending"===q.status&&o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"却下理由（却下する場合のみ）"}),o.jsx("textarea",{value:E,onChange:e=>z(e.target.value),className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3,placeholder:"却下する理由を入力してください"})]}),o.jsxs("div",{className:"flex space-x-4",children:[o.jsxs(u,{onClick:()=>{return s=q.id,n(null,null,(function*(){try{A(!0),S("");const{error:a}=yield x.from("pet_facilities").update({status:"approved",approved_at:(new Date).toISOString(),approved_by:null==e?void 0:e.id}).eq("id",s);if(a)throw a;yield B(),$(!1),D(null)}catch(a){S("施設の承認に失敗しました")}finally{A(!1)}}));var s},disabled:I,className:"flex-1 bg-green-600 hover:bg-green-700",children:[o.jsx(b,{className:"w-4 h-4 mr-2"}),"承認する"]}),o.jsxs(u,{onClick:()=>{return e=q.id,n(null,null,(function*(){if(E.trim())try{A(!0),S("");const{error:s}=yield x.from("pet_facilities").update({status:"rejected",admin_notes:E,approved_at:null,approved_by:null}).eq("id",e);if(s)throw s;yield B(),$(!1),D(null),z("")}catch(s){S("施設の却下に失敗しました")}finally{A(!1)}else S("却下理由を入力してください")}));var e},disabled:I||!E.trim(),className:"flex-1 bg-red-600 hover:bg-red-700",children:[o.jsx(f,{className:"w-4 h-4 mr-2"}),"却下する"]})]})]})]})})})]}):o.jsx("div",{className:"max-w-4xl mx-auto p-4",children:o.jsx(h,{className:"p-6",children:o.jsxs("div",{className:"flex items-center justify-center",children:[o.jsx(g,{className:"w-12 h-12 text-red-500 mr-4"}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-xl font-semibold text-red-700",children:"アクセス権限がありません"}),o.jsx("p",{className:"text-red-600",children:"このページは管理者のみアクセス可能です。"})]})]})})})}export{S as default};

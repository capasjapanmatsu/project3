import{j as e,g as s,V as a,Y as r,A as l,a as t,s as c}from"./ui-vendor-B03FHkej.js";import{u as i,r as n}from"./react-vendor-BBLDtDmh.js";import{u as d,C as x,B as m,s as h}from"./index-CWMjoAp3.js";import{I as o}from"./Input-D52zIDZ_.js";import"./query-vendor-Cy2yKKks.js";import"./supabase-vendor-BcfcqyaE.js";function j(){const{user:j}=d(),p=i(),[u,g]=n.useState(!1),[N,b]=n.useState(""),[f,v]=n.useState(!1),[y,w]=n.useState({cardNumber:"",cardHolder:"",expiryMonth:"",expiryYear:"",cvv:"",isDefault:!0});return f?e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs(x,{className:"text-center p-8",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(s,{className:"w-8 h-8 text-green-600"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"クレジットカードを登録しました"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"入場QRページに戻ります..."}),e.jsx(m,{onClick:()=>p("/entrance-qr"),children:"入場QRページへ"})]})}):e.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center space-x-4 mb-6",children:e.jsxs("button",{onClick:()=>p("/entrance-qr"),className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[e.jsx(a,{className:"w-4 h-4 mr-2"}),"入場QRに戻る"]})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 mb-4 flex items-center justify-center",children:[e.jsx(r,{className:"w-8 h-8 text-blue-600 mr-3"}),"クレジットカード登録"]}),e.jsx("p",{className:"text-gray-600",children:"ドッグラン入場QRの発行にはクレジットカードの登録が必要です"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(x,{className:"p-6",children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),b(""),(()=>{if(16!==y.cardNumber.replace(/\s/g,"").length)return b("カード番号は16桁で入力してください。"),!1;if(!y.cardHolder.trim())return b("カード名義人を入力してください。"),!1;if(!y.expiryMonth||!y.expiryYear)return b("有効期限を選択してください。"),!1;if(y.cvv.length<3)return b("CVVを正しく入力してください。"),!1;const e=new Date,s=e.getFullYear()%100,a=e.getMonth()+1,r=parseInt(y.expiryYear),l=parseInt(y.expiryMonth);return!(r<s||r===s&&l<a)||(b("有効期限が過去の日付です。"),!1)})()){g(!0);try{const e=y.cardNumber.replace(/\s/g,""),s="**** **** **** "+e.slice(-4),a=(e=>{const s=e.replace(/\s/g,"");return s.startsWith("4")?"visa":s.startsWith("5")||s.startsWith("2")?"mastercard":s.startsWith("3")?"amex":s.startsWith("35")?"jcb":"visa"})(e),{error:r}=await h.from("payment_cards").insert([{user_id:j?.id,card_number_masked:s,card_holder_name:y.cardHolder,expiry_month:parseInt(y.expiryMonth),expiry_year:parseInt(y.expiryYear),card_brand:a,is_default:y.isDefault}]);if(r)throw r;v(!0),setTimeout(()=>{p("/entrance-qr")},3e3)}catch(s){b(s.message||"決済方法の設定に失敗しました")}finally{g(!1)}}},children:[N&&e.jsxs("div",{className:"mb-4 p-3 bg-red-100 border border-red-300 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(l,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-red-800 font-medium",children:"エラー"})]}),e.jsx("p",{className:"text-red-700 mt-1",children:N})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(o,{label:"カード番号 *",value:y.cardNumber,onChange:e=>{const s=e.target.value.replace(/\D/g,"").replace(/(.{4})/g,"$1 ").trim().slice(0,19);w({...y,cardNumber:s})},placeholder:"1234 5678 9012 3456",maxLength:19,required:!0}),e.jsx(o,{label:"カード名義人 *",value:y.cardHolder,onChange:e=>w({...y,cardHolder:e.target.value.toUpperCase()}),placeholder:"TARO YAMADA",required:!0}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"有効期限（月） *"}),e.jsxs("select",{value:y.expiryMonth,onChange:e=>w({...y,expiryMonth:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"月"}),Array.from({length:12},(s,a)=>e.jsx("option",{value:String(a+1).padStart(2,"0"),children:String(a+1).padStart(2,"0")},a+1))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"有効期限（年） *"}),e.jsxs("select",{value:y.expiryYear,onChange:e=>w({...y,expiryYear:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"年"}),Array.from({length:10},(s,a)=>{const r=(new Date).getFullYear()+a;return e.jsx("option",{value:String(r).slice(-2),children:r},r)})]})]}),e.jsx(o,{label:"CVV *",value:y.cvv,onChange:e=>w({...y,cvv:e.target.value.replace(/\D/g,"")}),placeholder:"123",maxLength:4,required:!0})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"isDefault",checked:y.isDefault,onChange:e=>w({...y,isDefault:e.target.checked}),className:"rounded text-blue-600"}),e.jsx("label",{htmlFor:"isDefault",className:"text-sm text-gray-700",children:"デフォルトの支払い方法として設定"})]}),e.jsx("div",{className:"bg-yellow-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(l,{className:"w-5 h-5 text-yellow-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"重要な注意事項"}),e.jsxs("ul",{className:"space-y-1 text-xs",children:[e.jsx("li",{children:"• カード情報は暗号化して安全に保存されます"}),e.jsx("li",{children:"• 実際のカード番号は保存されません"}),e.jsx("li",{children:"• 入場QR発行時に自動で課金されます"}),e.jsx("li",{children:"• 不正利用防止のため、本人確認が必要な場合があります"})]})]})]})}),e.jsxs(m,{type:"submit",isLoading:u,className:"w-full bg-blue-600 hover:bg-blue-700 text-lg py-3",children:[e.jsx(r,{className:"w-5 h-5 mr-2"}),"クレジットカードを登録"]})]})]})})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(x,{className:"p-4 bg-green-50 border-green-200",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(t,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"font-semibold text-green-900",children:"セキュリティ"})]}),e.jsxs("div",{className:"text-sm text-green-800 space-y-2",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(s,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"SSL暗号化通信"})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(s,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"PCI DSS準拠"})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(s,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"カード番号は保存されません"})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(s,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"不正利用監視システム"})]})]})]}),e.jsxs(x,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"対応カードブランド"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-gray-50 rounded",children:[e.jsx(r,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium",children:"VISA"})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-gray-50 rounded",children:[e.jsx(r,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Mastercard"})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-gray-50 rounded",children:[e.jsx(r,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-sm font-medium",children:"JCB"})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-gray-50 rounded",children:[e.jsx(r,{className:"w-5 h-5 text-blue-800"}),e.jsx("span",{className:"text-sm font-medium",children:"AMEX"})]})]})]}),e.jsxs(x,{className:"p-4 bg-blue-50 border-blue-200",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(c,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"font-semibold text-blue-900",children:"課金について"})]}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("p",{children:"• 入場QR発行時に自動課金"}),e.jsx("p",{children:"• 単発利用: ¥800/日"}),e.jsx("p",{children:"• サブスク会員は追加料金なし"}),e.jsx("p",{children:"• 利用明細はメールで送信"}),e.jsx("p",{children:"• 返金は利用前のみ可能"})]})]}),e.jsxs(x,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"サポート"}),e.jsxs("div",{className:"text-sm text-gray-700 space-y-2",children:[e.jsx("p",{children:"カード登録でお困りの場合は、カスタマーサポートまでお問い合わせください。"}),e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded",children:[e.jsx("p",{className:"font-medium",children:"カスタマーサポート"}),e.jsx("p",{children:"📞 0120-XXX-XXX"}),e.jsx("p",{children:"📧 info@dogparkjp.com"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"平日 9:00-18:00"})]})]})]})]})]})]})}export{j as PaymentSetup};

var e=(e,s,a)=>new Promise((t,l)=>{var r=e=>{try{c(a.next(e))}catch(s){l(s)}},i=e=>{try{c(a.throw(e))}catch(s){l(s)}},c=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,i);c((a=a.apply(e,s)).next())});import{u as s,b as a,s as t,j as l,B as r,C as i,n as c}from"./index.Drgpoyph.js";import{r as n}from"./vendor.CKEClKZl.js";import{c as d,u as x,L as m}from"./router.B_7Atevv.js";import{l as o}from"./logger.X2WpaG9g.js";import{z as h,N as p,o as u,a6 as j,a7 as g,y as N,a as f,ap as b,p as y,S as v,aq as w,X as _}from"./ui.C72fRZ1L.js";import"./supabase.X3H3st79.js";function k(){const{productId:k}=d(),{user:q}=s(),C=x(),[F,S]=n.useState(null),[z,E]=n.useState([]),[O,P]=n.useState(1),[L,M]=n.useState(!0),{isActive:$}=a(),[A,B]=n.useState([]),[I,T]=n.useState(0),[D,G]=n.useState(!1);n.useEffect(()=>{k&&H()},[k,q]);const H=()=>e(this,null,function*(){try{const[e,s,a]=yield Promise.all([t.from("products").select("*").eq("id",k).eq("is_active",!0).single(),q?t.from("cart_items").select("*, product:products(*)").eq("user_id",q.id):Promise.resolve({data:[]}),t.from("product_images").select("*").eq("product_id",k).order("display_order",{ascending:!0})]);if(e.error)return void C("/shop");S(e.data),E(s.data||[]);const l=[];e.data.image_url&&l.push({id:"main",url:e.data.image_url}),!a.error&&a.data&&a.data.forEach(e=>{l.push({id:e.id,url:e.image_url})}),B(l)}catch(e){C("/shop")}finally{M(!1)}}),J=()=>e(this,null,function*(){if(q)try{const e=z.find(e=>e.product_id===(null==F?void 0:F.id));if(e){const{error:s}=yield t.from("cart_items").update({quantity:e.quantity+O}).eq("id",e.id);if(s)throw s}else{const{error:e}=yield t.from("cart_items").insert([{user_id:q.id,product_id:F.id,quantity:O}]);if(e)throw e}yield H(),c.success("カートに追加しました！")}catch(e){o.error("Error adding to cart:",e),c.error("カートへの追加に失敗しました。")}else C("/login")}),K=()=>{T(e=>(e+1)%A.length)},Q=()=>{T(e=>(e-1+A.length)%A.length)};if(L)return l.jsx("div",{className:"flex justify-center items-center h-64",children:l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})});if(!F)return l.jsxs("div",{className:"text-center py-12",children:[l.jsx("p",{className:"text-gray-600",children:"商品が見つかりませんでした"}),l.jsx(r,{onClick:()=>C("/shop"),className:"mt-4",children:"ショップに戻る"})]});const R=F.price,U=(V=R,$?Math.round(.9*V):V);var V;const W=$&&U<R,X=(()=>{const e=z.find(e=>e.product_id===(null==F?void 0:F.id));return e?e.quantity:0})();return l.jsxs("div",{className:"max-w-6xl mx-auto",children:[l.jsx("div",{className:"mb-6",children:l.jsxs("button",{onClick:()=>C("/shop"),className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[l.jsx(h,{className:"w-4 h-4 mr-2"}),"ショップに戻る"]})}),l.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"relative",children:[A.length>0?l.jsx("img",{src:A[I].url,alt:F.name,className:"w-full h-96 object-cover rounded-lg shadow-lg cursor-pointer",onClick:()=>(T(I),void G(!0)),onError:e=>{e.currentTarget.src="https://images.pexels.com/photos/1108099/pexels-photo-1108099.jpeg"}}):l.jsx("div",{className:"w-full h-96 bg-gray-200 rounded-lg flex items-center justify-center",children:l.jsx(p,{className:"w-16 h-16 text-gray-400"})}),W&&l.jsx("div",{className:"absolute top-4 left-4",children:l.jsxs("span",{className:"bg-purple-500 text-white px-3 py-1 rounded-full text-sm font-medium flex items-center",children:[l.jsx(u,{className:"w-4 h-4 mr-1"}),"10%OFF"]})}),F.stock_quantity<=5&&l.jsx("div",{className:"absolute top-4 right-4",children:l.jsxs("span",{className:"bg-red-500 text-white px-3 py-1 rounded-full text-sm font-medium",children:["残り",F.stock_quantity,"個"]})}),A.length>1&&l.jsxs(l.Fragment,{children:[l.jsx("button",{onClick:Q,className:"absolute left-2 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-75 rounded-full p-2 hover:bg-opacity-100 transition-opacity",children:l.jsx(j,{className:"w-5 h-5 text-gray-800"})}),l.jsx("button",{onClick:K,className:"absolute right-2 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-75 rounded-full p-2 hover:bg-opacity-100 transition-opacity",children:l.jsx(g,{className:"w-5 h-5 text-gray-800"})})]})]}),A.length>1&&l.jsx("div",{className:"grid grid-cols-6 gap-2",children:A.map((e,s)=>l.jsx("div",{className:"h-16 rounded-lg overflow-hidden cursor-pointer border-2 "+(s===I?"border-green-500":"border-transparent"),onClick:()=>T(s),children:l.jsx("img",{src:e.url,alt:`${F.name} - サムネイル ${s+1}`,className:"w-full h-full object-cover"})},s))})]}),l.jsxs("div",{className:"space-y-6",children:[$&&l.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-pink-500 text-white p-4 rounded-lg",children:l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx(u,{className:"w-5 h-5"}),l.jsx("span",{className:"font-semibold",children:"サブスク会員特典: 10%OFF"})]})}),l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[l.jsx("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded text-sm",children:(ee=F.category,{food:"ドッグフード",treats:"おやつ",toys:"おもちゃ",accessories:"アクセサリー",health:"ヘルスケア",sheets:"ペットシーツ"}[ee]||ee)}),F.brand&&l.jsx("span",{className:"text-gray-500 text-sm",children:F.brand})]}),l.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:F.name}),l.jsxs("div",{className:"mb-4",children:[l.jsxs("div",{className:"flex items-center space-x-3",children:[l.jsxs("span",{className:"text-3xl font-bold text-green-600",children:["¥",U.toLocaleString()]}),W&&l.jsxs("span",{className:"text-xl text-gray-500 line-through",children:["¥",R.toLocaleString()]})]}),$&&l.jsx("p",{className:"text-sm text-purple-600 mt-1",children:"サブスク会員価格"})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[F.weight&&l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx(p,{className:"w-4 h-4 text-gray-500"}),l.jsxs("span",{className:"text-sm",children:["内容量: ",F.weight,"g"]})]}),F.size&&l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx(p,{className:"w-4 h-4 text-gray-500"}),l.jsxs("span",{className:"text-sm",children:["サイズ: ",F.size]})]}),F.age_group&&"all"!==F.age_group&&l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx(N,{className:"w-4 h-4 text-gray-500"}),l.jsxs("span",{className:"text-sm",children:["対象年齢: ",(Z=F.age_group,{puppy:"子犬",adult:"成犬",senior:"シニア犬",all:"全年齢"}[Z]||Z)]})]}),F.dog_size&&"all"!==F.dog_size&&l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx(f,{className:"w-4 h-4 text-gray-500"}),l.jsxs("span",{className:"text-sm",children:["対象サイズ: ",(Y=F.dog_size,{small:"小型犬",medium:"中型犬",large:"大型犬",all:"全サイズ"}[Y]||Y)]})]})]}),l.jsx("div",{className:"mb-6",children:F.stock_quantity>0?l.jsxs("div",{className:"flex items-center space-x-2 text-green-600",children:[l.jsx(p,{className:"w-4 h-4"}),l.jsx("span",{className:"text-sm font-medium",children:"在庫あり"})]}):l.jsxs("div",{className:"flex items-center space-x-2 text-red-600",children:[l.jsx(p,{className:"w-4 h-4"}),l.jsx("span",{className:"text-sm font-medium",children:"在庫切れ"})]})}),F.stock_quantity>0&&l.jsxs("div",{className:"mb-6",children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"数量"}),l.jsxs("div",{className:"flex items-center space-x-3",children:[l.jsx("button",{onClick:()=>P(Math.max(1,O-1)),className:"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center hover:bg-gray-300 transition-colors",children:l.jsx(b,{className:"w-4 h-4"})}),l.jsx("span",{className:"text-xl font-medium w-12 text-center",children:O}),l.jsx("button",{onClick:()=>P(Math.min(F.stock_quantity,O+1)),className:"w-10 h-10 bg-green-600 text-white rounded-full flex items-center justify-center hover:bg-green-700 transition-colors",children:l.jsx(y,{className:"w-4 h-4"})})]}),X>0&&l.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["カートに",X,"個入っています"]})]}),l.jsx("div",{className:"space-y-3",children:F.stock_quantity>0?l.jsxs(l.Fragment,{children:[l.jsx(r,{onClick:()=>e(this,null,function*(){yield J(),C("/cart")}),className:"w-full bg-green-600 hover:bg-green-700 text-lg py-3",children:"今すぐ購入"}),l.jsxs(r,{onClick:J,variant:"secondary",className:"w-full text-lg py-3",children:[l.jsx(v,{className:"w-5 h-5 mr-2"}),"カートに追加"]})]}):l.jsx(r,{disabled:!0,className:"w-full text-lg py-3",children:"在庫切れ"})})]})]})]}),l.jsxs("div",{className:"mt-12 grid grid-cols-1 lg:grid-cols-3 gap-8",children:[l.jsx("div",{className:"lg:col-span-2",children:l.jsxs(i,{className:"p-6",children:[l.jsx("h2",{className:"text-xl font-semibold mb-4",children:"商品説明"}),l.jsx("p",{className:"text-gray-700 leading-relaxed whitespace-pre-line",children:F.description}),F.ingredients&&l.jsxs("div",{className:"mt-6",children:[l.jsx("h3",{className:"font-semibold mb-2",children:"原材料"}),l.jsx("p",{className:"text-gray-700 text-sm",children:F.ingredients})]})]})}),l.jsxs("div",{className:"space-y-4",children:[l.jsx(i,{className:"p-4",children:l.jsxs("div",{className:"flex items-start space-x-3",children:[l.jsx(w,{className:"w-5 h-5 text-blue-600 mt-1"}),l.jsxs("div",{children:[l.jsx("h3",{className:"font-semibold text-blue-900 mb-1",children:"配送について"}),l.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[l.jsx("p",{children:"• 送料：全国一律¥690"}),l.jsxs("p",{children:["• ¥5,000以上のご注文で",l.jsx("span",{className:"font-medium",children:"送料無料"})]}),l.jsxs("p",{children:["• サブスク会員は",l.jsx("span",{className:"font-medium",children:"常に送料無料"})]}),l.jsx("p",{children:"• 平日14時までのご注文で翌日お届け"})]})]})]})}),l.jsx(i,{className:"p-4",children:l.jsxs("div",{className:"flex items-start space-x-3",children:[l.jsx(f,{className:"w-5 h-5 text-green-600 mt-1"}),l.jsxs("div",{children:[l.jsx("h3",{className:"font-semibold text-green-900 mb-1",children:"品質保証"}),l.jsxs("div",{className:"text-sm text-green-800 space-y-1",children:[l.jsx("p",{children:"• 厳選された安全な原材料のみ使用"}),l.jsx("p",{children:"• 品質に問題がある場合は返品・交換対応"}),l.jsx("p",{children:"• 愛犬の健康を第一に考えた商品選定"})]})]})]})}),$?l.jsx(i,{className:"p-4 bg-purple-50 border-purple-200",children:l.jsxs("div",{className:"flex items-start space-x-3",children:[l.jsx(u,{className:"w-5 h-5 text-purple-600 mt-1"}),l.jsxs("div",{children:[l.jsx("h3",{className:"font-semibold text-purple-900 mb-1",children:"会員特典"}),l.jsxs("div",{className:"text-sm text-purple-800 space-y-1",children:[l.jsx("p",{children:"• 全商品10%OFF"}),l.jsx("p",{children:"• 送料無料"}),l.jsx("p",{children:"• 優先カスタマーサポート"})]})]})]})}):l.jsx(i,{className:"p-4 bg-purple-50 border-purple-200",children:l.jsxs("div",{className:"flex items-start space-x-3",children:[l.jsx(u,{className:"w-5 h-5 text-purple-600 mt-1"}),l.jsxs("div",{children:[l.jsx("h3",{className:"font-semibold text-purple-900 mb-1",children:"サブスク会員になると"}),l.jsxs("div",{className:"text-sm text-purple-800 space-y-1 mb-3",children:[l.jsx("p",{children:"• 全商品10%OFF"}),l.jsx("p",{children:"• 送料無料"}),l.jsx("p",{children:"• ドッグラン使い放題"})]}),l.jsx(m,{to:"/subscription",children:l.jsxs(r,{size:"sm",className:"w-full bg-purple-600 hover:bg-purple-700",children:[l.jsx(u,{className:"w-3 h-3 mr-1"}),"詳細を見る"]})})]})]})})]})]}),D&&l.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",children:[l.jsx("button",{onClick:()=>G(!1),className:"absolute top-4 right-4 text-gray-800 bg-white bg-opacity-90 shadow-lg rounded-full p-2 hover:bg-opacity-100 transition-all",children:l.jsx(_,{className:"w-6 h-6"})}),l.jsx("button",{onClick:Q,className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-800 bg-white bg-opacity-90 shadow-lg rounded-full p-2 hover:bg-opacity-100 transition-all",children:l.jsx(j,{className:"w-6 h-6"})}),l.jsx("button",{onClick:K,className:"absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-800 bg-white bg-opacity-90 shadow-lg rounded-full p-2 hover:bg-opacity-100 transition-all",children:l.jsx(g,{className:"w-6 h-6"})}),l.jsx("img",{src:A[I].url,alt:F.name,className:"max-h-[80vh] max-w-full"}),l.jsx("div",{className:"absolute bottom-4 left-0 right-0 text-center",children:l.jsxs("p",{className:"text-white text-sm",children:[I+1," / ",A.length]})})]})]});var Y,Z,ee}export{k as ProductDetail};

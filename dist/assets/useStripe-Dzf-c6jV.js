import{r as e}from"./vendor-BHVjIt_u.js";import{s as r}from"./index-BFgW40ku.js";var t,n="https://js.stripe.com/v3",o=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,i=function(e){var r=document.createElement("script");r.src="".concat(n).concat("");var t=document.head||document.body;if(!t)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return t.appendChild(r),r},s=null,c=null,a=null,u=function(e){return null!==s?s:(s=new Promise((function(r,t){if("undefined"!=typeof window&&"undefined"!=typeof document)if(window.Stripe)r(window.Stripe);else try{var s=function(){for(var e=document.querySelectorAll('script[src^="'.concat(n,'"]')),r=0;r<e.length;r++){var t=e[r];if(o.test(t.src))return t}return null}();if(s&&e);else if(s){if(s&&null!==a&&null!==c){var u;s.removeEventListener("load",a),s.removeEventListener("error",c),null===(u=s.parentNode)||void 0===u||u.removeChild(s),s=i()}}else s=i();a=function(e,r){return function(){window.Stripe?e(window.Stripe):r(new Error("Stripe.js not available"))}}(r,t),c=function(e){return function(){e(new Error("Failed to load Stripe.js"))}}(t),s.addEventListener("load",a),s.addEventListener("error",c)}catch(l){return void t(l)}else r(null)}))).catch((function(e){return s=null,Promise.reject(e)}))},l=function(){return t||(t=u(null).catch((function(e){return t=null,Promise.reject(e)})))};Promise.resolve().then((function(){return l()})).catch((function(e){}));function d(){const[t,n]=e.useState(!1),[o,i]=e.useState(null),s=e.useCallback((async({priceId:e,mode:t,successUrl:o=`${window.location.origin}/dashboard?success=true`,cancelUrl:s=`${window.location.origin}/dashboard?canceled=true`,customAmount:c,customName:a,customParams:u,cartItems:d})=>{n(!0),i(null);try{const{data:{session:n}}=await r.auth.getSession();if(!n?.access_token)throw new Error("認証が必要です");const i={mode:t,success_url:o,cancel_url:s};e&&(i.price_id=e),c&&a&&(i.custom_amount=c,i.custom_name=a),d&&d.length>0&&(i.cart_items=d),u&&Object.entries(u).forEach((([e,r])=>{i[e]=r}));const f=await fetch("https://onmcivwxtzqajcovptgf.supabase.co/functions/v1/stripe-checkout",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.access_token}`},body:JSON.stringify(i)});if(!f.ok){const e=await f.json();throw new Error(e.error||"チェックアウトセッションの作成に失敗しました")}const{sessionId:p,url:w}=await f.json();if(w)return void(window.location.href=w);if(!p)throw new Error("チェックアウトURLが取得できませんでした");{const e="pk_live_51RYUXtAHWLDQ7ynZJ2Rse439JRUesTrISQjlUpQLJs4RKprLygju98sbPHbhXwSixvYxo2pyo1c5uo4j93pQieSt00z0re16rJ",r=await function(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];0;var n=Date.now();return l().then((function(e){return function(e,r,t){if(null===e)return null;var n=e.apply(void 0,r);return function(e,r){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"2.4.0",startTime:r})}(n,t),n}(e,r,n)}))}(e);if(!r)throw new Error("Stripeの読み込みに失敗しました");const{error:t}=await r.redirectToCheckout({sessionId:p});if(t)throw t}}catch(f){throw i(f.message||"チェックアウトに失敗しました"),f}finally{n(!1)}}),[]);return{createCheckoutSession:s,loading:t,error:o}}export{d as u};

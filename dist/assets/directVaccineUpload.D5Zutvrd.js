import{s as e}from"./index.oOj2R_C7.js";import"./vendor.D1SiiUJb.js";import"./router.icJHpBzt.js";import"./supabase.CZ8ekJUM.js";import"./ui.UnEvinBv.js";const r=(r,t,o="vaccine-certs")=>{return s=null,a=null,i=function*(){var s;try{if(!(t&&t instanceof File))throw new Error("無効なファイルです");let a=t.type;if(!a||"application/octet-stream"===a){const e=null==(s=t.name.split(".").pop())?void 0:s.toLowerCase();switch(e){case"jpg":case"jpeg":a="image/jpeg";break;case"png":a="image/png";break;case"gif":a="image/gif";break;case"webp":a="image/webp";break;default:throw new Error(`サポートされていないファイル形式: ${e}`)}}if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(a))throw new Error(`サポートされていないMIMEタイプ: ${a}`);const{data:{session:i},error:n}=yield e.auth.getSession();if(n)throw new Error("認証エラーが発生しました");if(!(null==i?void 0:i.access_token))throw new Error("認証されていません。ログインしてください。");const c=i.access_token,p=`/storage/v1/object/${o}/${r}`,u=yield fetch(p,{method:"PUT",headers:{Authorization:`Bearer ${c}`,"Content-Type":a,"Cache-Control":"3600","x-upsert":"true"},body:t});if(!u.ok)throw yield u.text(),520===u.status?new Error("一時的なサーバーエラーが発生しました。しばらく待ってから再度お試しください。"):u.status>=500?new Error(`サーバーエラーが発生しました (${u.status})。しばらく待ってから再度お試しください。`):new Error(`アップロードに失敗しました: ${u.status} ${u.statusText}`);yield u.json();const{data:{publicUrl:l}}=e.storage.from(o).getPublicUrl(r);return{success:!0,url:l}}catch(a){return{success:!1,error:a.message}}},new Promise(((e,r)=>{var t=e=>{try{n(i.next(e))}catch(t){r(t)}},o=e=>{try{n(i.throw(e))}catch(t){r(t)}},n=r=>r.done?e(r.value):Promise.resolve(r.value).then(t,o);n((i=i.apply(s,a)).next())}));var s,a,i};export{r as directVaccineUpload};

import{j as e,l as A,g as k,p as L,al as T,X as J}from"./ui-vendor-FlUr4cJt.js";import{u as X,r as g}from"./react-vendor-_GyjDmDn.js";import{u as Y,C as w,B as j,s as S}from"./index-BSYT0262.js";import{I as f}from"./Input-wBkmcJUR.js";import"./supabase-vendor-Df9iqQzW.js";const $=b=>new Promise((y,m)=>{const u=document.createElement("canvas"),x=u.getContext("2d"),n=document.createElement("img");n.onload=()=>{let o=n.naturalWidth,c=n.naturalHeight;o>c?o>800&&(c=c*800/o,o=800):c>600&&(o=o*600/c,c=600),u.width=o,u.height=c,x?.drawImage(n,0,0,o,c);const v=u.toDataURL("image/jpeg",.8);y(v)},n.onerror=m,n.src=URL.createObjectURL(b)}),K=[{id:"pet_hotel",name:"ãƒšãƒƒãƒˆãƒ›ãƒ†ãƒ«",monthly_fee:5e3,is_free:!0},{id:"pet_salon",name:"ãƒšãƒƒãƒˆã‚µãƒ­ãƒ³",monthly_fee:3e3,is_free:!0},{id:"veterinary",name:"å‹•ç‰©ç—…é™¢",monthly_fee:8e3,is_free:!0},{id:"pet_cafe",name:"ãƒšãƒƒãƒˆã‚«ãƒ•ã‚§",monthly_fee:4e3,is_free:!0},{id:"pet_restaurant",name:"ãƒšãƒƒãƒˆåŒä¼´ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³",monthly_fee:6e3,is_free:!0},{id:"pet_shop",name:"ãƒšãƒƒãƒˆã‚·ãƒ§ãƒƒãƒ—",monthly_fee:7e3,is_free:!0},{id:"pet_accommodation",name:"ãƒšãƒƒãƒˆåŒä¼´å®¿æ³Š",monthly_fee:1e4,is_free:!0}];function ae(){const{user:b,isAuthenticated:y,userProfile:m}=Y(),u=X(),[x,n]=g.useState(!1),[C,h]=g.useState(""),[o,c]=g.useState(""),[v,F]=g.useState([]),[U,D]=g.useState([]),[t,p]=g.useState({name:m?.name||"",address:m?.address||"",isEditing:!1}),[r,E]=g.useState({name:"",category_id:"",address:"",phone:"",website:"",description:"",images:[]});g.useEffect(()=>{y||u("/login")},[y,u]),g.useEffect(()=>{m&&p({name:m.name||"",address:m.address||"",isEditing:!1})},[m]);const N=s=>{const{name:a,value:i}=s.target;E(l=>({...l,[a]:i}))},R=async s=>{const a=Array.from(s.target.files||[]);if(a.length!==0){if(v.length+a.length>5){h("ç”»åƒã¯æœ€å¤§5æšã¾ã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™");return}n(!0),h("");try{if(a.filter(d=>d.size>10485760).length>0){h("ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚µã‚¤ã‚ºã¯10MBä»¥ä¸‹ã«ã—ã¦ãã ã•ã„"),n(!1);return}const l=await Promise.all(a.map(d=>$(d))),I=a.slice(0,5-v.length);F(d=>[...d,...I]),D(d=>[...d,...l]),E(d=>({...d,images:[...d.images,...l]}))}catch(i){h(i instanceof Error?i.message:"ç”»åƒã®å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{n(!1)}}},B=s=>{F(a=>a.filter((i,l)=>l!==s)),D(a=>a.filter((i,l)=>l!==s)),E(a=>({...a,images:a.images.filter((i,l)=>l!==s)}))},H=s=>{s.preventDefault(),O()},M=s=>{R(s)},O=async()=>{if(!b){h("ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™");return}if(!r.name||!r.category_id||!r.address){h("å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");return}n(!0),h("");try{const s={owner_id:b.id,name:r.name,category_id:r.category_id,address:r.address,phone:r.phone,website:r.website,description:r.description,status:"pending",created_at:new Date().toISOString()},a=await S.from("pet_facilities").insert(s).select().single(),{data:i,error:l}=a;if(l)throw console.error("Facility insertion error:",l),l;if(r.images.length>0&&i&&typeof i=="object"&&"id"in i){const I=r.images.map((z,G)=>({facility_id:i.id,image_data:z,is_primary:G===0,created_at:new Date().toISOString()})),{error:d}=await S.from("facility_images").insert(I);d&&(console.error("Image insertion error:",d),console.warn("ç”»åƒã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸãŒã€æ–½è¨­ç™»éŒ²ã¯å®Œäº†ã—ã¾ã—ãŸ"))}c("æ–½è¨­ã®æ²è¼‰ç”³è«‹ãŒå®Œäº†ã—ã¾ã—ãŸï¼ç®¡ç†è€…ã®æ‰¿èªå¾Œã€åœ°å›³ã«æ²è¼‰ã•ã‚Œã¾ã™ã€‚"),setTimeout(()=>{u("/dashboard")},2e3)}catch(s){console.error("âŒ Submission error:",s);const a=s instanceof Error?s.message:"ç”³è«‹ã«å¤±æ•—ã—ã¾ã—ãŸ";h(a),s instanceof Error&&s.message.includes("ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰")&&(console.error("ğŸ“‹ Storage upload troubleshooting:"),console.error("- Check if vaccine-certs bucket exists"),console.error("- Check storage policies"),console.error("- Check file size and format"),console.error("- User ID:",b?.id))}finally{n(!1)}},_=s=>{const{name:a,value:i}=s.target;p(l=>({...l,[a]:i}))},W=async()=>{if(b)try{n(!0);const{error:s}=await S.from("profiles").update({name:t.name,address:t.address,updated_at:new Date().toISOString()}).eq("id",b.id);if(s)throw console.error("User info update error:",s),new Error("ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ");p(a=>({...a,isEditing:!1})),c("ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸ"),setTimeout(()=>c(""),3e3)}catch(s){console.error("Save user info error:",s),h(s instanceof Error?s.message:"ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{n(!1)}},P=()=>{W()},q=()=>{p({name:m?.name||"",address:m?.address||"",isEditing:!1})};return y?e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"ãƒšãƒƒãƒˆé–¢é€£æ–½è¨­ç™»éŒ²"}),e.jsx("p",{className:"text-gray-600",children:"ãƒšãƒƒãƒˆé–¢é€£æ–½è¨­ã®æ²è¼‰ç”³è«‹ã‚’è¡Œã„ã¾ã™ã€‚ç®¡ç†è€…ã®æ‰¿èªå¾Œã€åœ°å›³ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚"})]}),C&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(A,{className:"w-5 h-5 text-red-500 mr-2"}),e.jsx("span",{className:"text-red-700",children:C})]})}),o&&e.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(k,{className:"w-5 h-5 text-green-500 mr-2"}),e.jsx("span",{className:"text-green-700",children:o})]})}),e.jsxs("form",{onSubmit:H,className:"space-y-6",children:[e.jsx(w,{children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center",children:[e.jsx(L,{className:"w-6 h-6 mr-2"}),"åŸºæœ¬æƒ…å ±"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["æ–½è¨­å ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(f,{label:"æ–½è¨­å",name:"name",value:r.name,onChange:N,placeholder:"æ–½è¨­åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["æ–½è¨­ã‚«ãƒ†ã‚´ãƒª ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"category_id",value:r.category_id,onChange:N,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠã—ã¦ãã ã•ã„"}),K.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["ä½æ‰€ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(f,{label:"ä½æ‰€",name:"address",value:r.address,onChange:N,placeholder:"ä½æ‰€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"é›»è©±ç•ªå·"}),e.jsx(f,{label:"é›»è©±ç•ªå·",name:"phone",value:r.phone,onChange:N,placeholder:"é›»è©±ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆ"}),e.jsx(f,{label:"ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆ",name:"website",value:r.website,onChange:N,placeholder:"https://example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"æ–½è¨­ã®èª¬æ˜"}),e.jsx("textarea",{name:"description",value:r.description,onChange:N,rows:4,placeholder:"æ–½è¨­ã®ç‰¹å¾´ã‚„ã‚µãƒ¼ãƒ“ã‚¹å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})]})}),e.jsx(w,{children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center",children:[e.jsx(L,{className:"w-6 h-6 mr-2"}),"ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"åå‰"}),t.isEditing?e.jsx(f,{label:"åå‰",name:"name",value:t.name,onChange:_,placeholder:"åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"}):e.jsx("p",{className:"text-gray-900",children:t.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ä½æ‰€"}),t.isEditing?e.jsx(f,{label:"ä½æ‰€",name:"address",value:t.address,onChange:_,placeholder:"ä½æ‰€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"}):e.jsx("p",{className:"text-gray-900",children:t.address})]})]}),e.jsx("div",{className:"flex justify-end mt-4",children:t.isEditing?e.jsxs(e.Fragment,{children:[e.jsx(j,{onClick:P,className:"mr-2",disabled:x,children:x?"ä¿å­˜ä¸­...":"ä¿å­˜"}),e.jsx(j,{onClick:q,disabled:x,children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"})]}):e.jsx(j,{onClick:()=>p(s=>({...s,isEditing:!0})),children:"ç·¨é›†"})})]})}),e.jsx(w,{children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center",children:[e.jsx(k,{className:"w-6 h-6 mr-2"}),"ç™»éŒ²è€…æƒ…å ±ã®ç¢ºèª"]}),e.jsx("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(A,{className:"w-5 h-5 text-blue-500 mr-2 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"ç™»éŒ²è€…æƒ…å ±ã®ç¢ºèª"}),e.jsx("p",{className:"text-xs",children:"ä»¥ä¸‹ã®æƒ…å ±ã‚’ã”ç¢ºèªãã ã•ã„ã€‚å¤‰æ›´ãŒå¿…è¦ãªå ´åˆã¯ç·¨é›†ã§ãã¾ã™ã€‚"})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"æ°å"}),t.isEditing?e.jsx(f,{label:"æ°å",name:"name",value:t.name,onChange:_,placeholder:"æ°åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",required:!0}):e.jsx("div",{className:"px-3 py-2 bg-gray-50 border border-gray-200 rounded-md",children:e.jsx("p",{className:"text-gray-900",children:t.name||"æœªè¨­å®š"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ä½æ‰€"}),t.isEditing?e.jsx(f,{label:"ä½æ‰€",name:"address",value:t.address,onChange:_,placeholder:"ä½æ‰€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",required:!0}):e.jsx("div",{className:"px-3 py-2 bg-gray-50 border border-gray-200 rounded-md",children:e.jsx("p",{className:"text-gray-900",children:t.address||"æœªè¨­å®š"})})]}),e.jsx("div",{className:"flex gap-2",children:t.isEditing?e.jsxs(e.Fragment,{children:[e.jsx(j,{type:"button",onClick:P,disabled:x,children:x?"ä¿å­˜ä¸­...":"ä¿å­˜"}),e.jsx(j,{type:"button",onClick:q,children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"})]}):e.jsx(j,{type:"button",onClick:()=>p(s=>({...s,isEditing:!0})),children:"ç·¨é›†"})})]})]})}),e.jsx(w,{className:"mb-6",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center",children:[e.jsx(T,{className:"w-6 h-6 mr-2"}),"æ–½è¨­ç”»åƒ (æœ€å¤§5æš)"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰"}),e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:M,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:x||v.length>=5}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"JPG, PNG, GIFå¯¾å¿œã€‚1ãƒ•ã‚¡ã‚¤ãƒ«10MBä»¥ä¸‹ã€‚ç”»åƒã¯è‡ªå‹•çš„ã«ãƒªã‚µã‚¤ã‚ºãƒ»åœ§ç¸®ã•ã‚Œã¾ã™ã€‚"})]}),U.length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4",children:U.map((s,a)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s,alt:`æ–½è¨­ç”»åƒ ${a+1}`,className:"w-full h-32 object-cover rounded-lg border border-gray-200"}),e.jsx("button",{type:"button",onClick:()=>B(a),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center hover:bg-red-600",children:e.jsx(J,{className:"w-4 h-4"})}),a===0&&e.jsx("div",{className:"absolute bottom-1 left-1 bg-blue-500 text-white text-xs px-2 py-1 rounded",children:"ãƒ¡ã‚¤ãƒ³"})]},a))})]})}),e.jsx(w,{className:"mb-6",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(k,{className:"w-5 h-5 text-green-500 mr-2"}),e.jsx("span",{className:"font-medium text-green-800",children:"ç„¡æ–™æ²è¼‰æœŸé–“å®Ÿæ–½ä¸­ï¼"})]}),e.jsxs("p",{className:"text-green-700 mb-2",children:["ç¾åœ¨ã€ã™ã¹ã¦ã®ãƒšãƒƒãƒˆé–¢é€£æ–½è¨­ãŒ",e.jsx("strong",{className:"text-lg",children:"ç„¡æ–™"}),"ã§æ²è¼‰ã§ãã¾ã™ã€‚"]}),e.jsxs("ul",{className:"text-sm text-green-600 space-y-1",children:[e.jsx("li",{children:"â€¢ æœ¬äººç¢ºèªæ‰‹ç¶šãã¯ä¸è¦ã§ã™"}),e.jsx("li",{children:"â€¢ æœˆé¡æ–™é‡‘ã¯ç™ºç”Ÿã—ã¾ã›ã‚“"}),e.jsx("li",{children:"â€¢ ç”³è«‹å¾Œã€ç®¡ç†è€…ã®æ‰¿èªã‚’çµŒã¦æ²è¼‰é–‹å§‹ã¨ãªã‚Šã¾ã™"}),e.jsx("li",{children:"â€¢ å°†æ¥çš„ã«æœ‰æ–™åŒ–ã™ã‚‹å ´åˆã¯äº‹å‰ã«ãŠçŸ¥ã‚‰ã›ã„ãŸã—ã¾ã™"})]})]})})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(j,{type:"submit",disabled:x,children:x?"ç”³è«‹ä¸­...":"ç”³è«‹ã‚’é€ä¿¡ã™ã‚‹"})})]})]}):null}export{ae as default};

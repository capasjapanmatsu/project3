var e=(e,s,a)=>new Promise((t,i)=>{var l=e=>{try{n(a.next(e))}catch(s){i(s)}},r=e=>{try{n(a.throw(e))}catch(s){i(s)}},n=e=>e.done?t(e.value):Promise.resolve(e.value).then(l,r);n((a=a.apply(e,s)).next())});import{u as s,j as a,m as t,v as i,f as l,c as r,B as n,C as c,w as o,x as m,y as d,g as x,z as h}from"./index.Drgpoyph.js";import{r as u}from"./vendor.CKEClKZl.js";import{u as v,d as p}from"./router.B_7Atevv.js";import{z as j,g as N,K as b,A as f,P as w}from"./ui.C72fRZ1L.js";import{A as g}from"./index.BrR2lFgt.js";import"./supabase.X3H3st79.js";function y(){const y=v(),[T]=p(),{user:P}=s(),[k,I]=u.useState(!1),[S,_]=u.useState("processing"),[C,H]=u.useState(5),[z,A]=u.useState(!1),[E,O]=u.useState(!1);u.useEffect(()=>{const s=setTimeout(()=>e(this,null,function*(){const s=T.get("status"),a=T.get("session_id"),t=T.get("canceled");"success"===s&&a?(_("success"),setTimeout(()=>e(this,null,function*(){O(!0),yield h(),A(!0),setTimeout(()=>{A(!1),O(!1)},3e3)}),500)):_("cancel"===s||"true"===t?"failed":"processing");const i=localStorage.getItem("pre_payment_auth_state");if(i)try{const e=JSON.parse(i);P&&P.id===e.user_id||"true"===t&&(_("failed"),setTimeout(()=>{y("/login")},5e3)),localStorage.removeItem("pre_payment_auth_state")}catch(l){}I(!1)}),100);return()=>clearTimeout(s)},[T,P,y]),u.useEffect(()=>{if("success"===S&&C>0){const e=setTimeout(()=>{H(C-1)},1e3);return()=>clearTimeout(e)}"success"===S&&0===C&&y("/access-control")},[S,C,y]);return k?a.jsx(t.div,{className:"flex justify-center items-center h-64",initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):a.jsxs(t.div,{className:"max-w-2xl mx-auto",initial:"initial",animate:"animate",exit:"exit",variants:i,children:[a.jsxs(t.div,{className:"flex items-center mb-6",variants:l,children:[a.jsx(t.div,{variants:r,whileHover:"hover",whileTap:"tap",children:a.jsxs(n,{variant:"primary",size:"sm",onClick:()=>y(-1),className:"mr-3",children:[a.jsx(j,{className:"w-4 h-4 mr-2"}),"æˆ»ã‚‹"]})}),a.jsx("h1",{className:"text-2xl font-bold",children:"æ±ºæ¸ˆç¢ºèª"})]}),a.jsxs(g,{children:["success"===S&&a.jsx(t.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.4,ease:"easeOut"},children:a.jsxs(c,{className:"text-center p-8 relative overflow-hidden",children:[a.jsx(g,{children:z&&a.jsx("div",{className:"absolute inset-0 pointer-events-none",children:Array.from({length:8}).map((e,s)=>a.jsx(t.div,{className:"absolute w-2 h-2 bg-yellow-400 rounded-full",style:{left:"50%",top:"50%"},variants:o,initial:"initial",animate:"animate",exit:{opacity:0}},s))})}),a.jsx(t.div,{variants:m,initial:"initial",animate:E?"animate":"initial",className:"relative",children:a.jsx(N,{className:"w-16 h-16 text-green-600 mx-auto mb-4"})}),a.jsx(t.h2,{className:"text-2xl font-bold text-green-800 mb-4",variants:l,children:"ğŸ‰ æ±ºæ¸ˆãŒå®Œäº†ã—ã¾ã—ãŸï¼"}),a.jsx(t.p,{className:"text-gray-600 mb-6",variants:l,children:"ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚æ±ºæ¸ˆãŒæ­£å¸¸ã«å‡¦ç†ã•ã‚Œã¾ã—ãŸã€‚"}),a.jsxs(t.div,{className:"bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg mb-6 border border-blue-200",variants:l,children:[a.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[a.jsx(t.div,{animate:{rotate:[0,15,-15,0]},transition:{duration:.6,repeat:2},children:a.jsx(b,{className:"w-5 h-5 text-blue-600"})}),a.jsx("span",{className:"font-semibold text-blue-900",children:"æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—"})]}),a.jsx("p",{className:"text-sm text-blue-800",children:"å…¥å ´ã«ã¯PINã‚³ãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™ã€‚ä¸‹ã®ãƒœã‚¿ãƒ³ã‹ã‚‰PINã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚"})]}),a.jsx(t.div,{variants:r,whileHover:"hover",whileTap:"tap",className:"mb-4",children:a.jsxs(n,{onClick:()=>{y("/access-control")},className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white shadow-lg",children:[a.jsx(b,{className:"w-5 h-5 mr-2"}),"ğŸš€ PINã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹"]})}),a.jsx(t.p,{className:"text-sm text-gray-500",variants:l,children:C>0&&a.jsxs(t.span,{animate:{scale:[1,1.1,1]},transition:{duration:1,repeat:1/0},children:["â° ",C,"ç§’å¾Œã«è‡ªå‹•çš„ã«PINã‚³ãƒ¼ãƒ‰ç”Ÿæˆç”»é¢ã«ç§»å‹•ã—ã¾ã™..."]})})]})}),"failed"===S&&a.jsx(t.div,{variants:d,initial:"initial",animate:"animate",exit:"exit",children:a.jsxs(c,{className:"text-center p-8",children:[a.jsx(t.div,{animate:{rotate:[-5,5,-5,0]},transition:{duration:.6},children:a.jsx(f,{className:"w-16 h-16 text-red-600 mx-auto mb-4"})}),a.jsx("h2",{className:"text-2xl font-bold text-red-800 mb-4",children:"æ±ºæ¸ˆãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ"}),a.jsxs("p",{className:"text-gray-600 mb-6",children:["æ±ºæ¸ˆãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã¾ãŸã¯å¤±æ•—ã—ã¾ã—ãŸã€‚",P?"":"èªè¨¼çŠ¶æ…‹ã‚’ç¢ºèªã—ã¦ã‹ã‚‰","å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚"]}),!P&&a.jsxs(t.div,{className:"bg-orange-50 p-4 rounded-lg mb-6",variants:x,children:[a.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[a.jsx(f,{className:"w-5 h-5 text-orange-600"}),a.jsx("span",{className:"font-semibold text-orange-900",children:"èªè¨¼çŠ¶æ…‹ãŒå¤±ã‚ã‚Œã¾ã—ãŸ"})]}),a.jsx("p",{className:"text-sm text-orange-800",children:"ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒåˆ‡æ–­ã•ã‚Œã¾ã—ãŸã€‚3ç§’å¾Œã«ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ç§»å‹•ã—ã¾ã™ã€‚"})]}),a.jsxs(t.div,{className:"bg-yellow-50 p-4 rounded-lg mb-6",variants:x,children:[a.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[a.jsx(w,{className:"w-5 h-5 text-yellow-600"}),a.jsx("span",{className:"font-semibold text-yellow-900",children:"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯"})]}),a.jsx("p",{className:"text-sm text-yellow-800",children:"å…¥å ´ã«ã¯PINã‚³ãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™ã€‚æ±ºæ¸ˆå®Œäº†å¾Œã«PINã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã§ãã¾ã™ã€‚"})]}),a.jsx("div",{className:"space-y-3",children:P?a.jsxs(a.Fragment,{children:[a.jsx(t.div,{variants:r,whileHover:"hover",whileTap:"tap",children:a.jsx(n,{onClick:()=>y("/parks"),className:"w-full",children:"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ä¸€è¦§ã«æˆ»ã‚‹"})}),a.jsx(t.div,{variants:r,whileHover:"hover",whileTap:"tap",children:a.jsx(n,{variant:"secondary",onClick:()=>y("/subscription"),className:"w-full",children:"ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’æ¤œè¨ã™ã‚‹"})}),a.jsx(t.div,{variants:r,whileHover:"hover",whileTap:"tap",children:a.jsx(n,{variant:"secondary",onClick:()=>y("/cart"),className:"w-full",children:"ã‚«ãƒ¼ãƒˆã‚’ç¢ºèªã™ã‚‹"})})]}):a.jsx(t.div,{variants:r,whileHover:"hover",whileTap:"tap",children:a.jsx(n,{onClick:()=>y("/login"),className:"w-full",children:"ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹"})})})]})}),"processing"===S&&a.jsx(t.div,{variants:x,initial:"initial",animate:"animate",children:a.jsxs(c,{className:"text-center p-8",children:[a.jsx(t.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"inline-block",children:a.jsx("div",{className:"rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"})}),a.jsx("h2",{className:"text-xl font-bold mb-4",children:"æ±ºæ¸ˆã‚’å‡¦ç†ä¸­..."}),a.jsx("p",{className:"text-gray-600",children:"ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ã€‚æ±ºæ¸ˆã®å‡¦ç†ãŒå®Œäº†ã™ã‚‹ã¾ã§ãŠæ™‚é–“ã‚’ã„ãŸã ãå ´åˆãŒã‚ã‚Šã¾ã™ã€‚"})]})})]})]})}export{y as PaymentConfirmation};

import{j as e,s as u,A as h,M as n,E as P,t as S,n as f}from"./ui-vendor-FlUr4cJt.js";import{r as a,u as M}from"./react-vendor-_GyjDmDn.js";import{u as I,C as q,B as m,n as w}from"./index-BSYT0262.js";import{I as g}from"./Input-wBkmcJUR.js";import{l as y}from"./logger-C8dD4C56.js";import"./supabase-vendor-Df9iqQzW.js";function T(){const{signInWithMagicLink:v,signInWithPassword:k}=I(),[b,c]=a.useState(!1),[i,r]=a.useState(""),[l,j]=a.useState(""),[p,C]=a.useState(""),[o,N]=a.useState(!0),[x,L]=a.useState(!1),d=M();a.useEffect(()=>{},[]);const A=async s=>{s.preventDefault(),c(!0),r("");try{const t=await v(l);t.success?(localStorage.setItem("lastUsedEmail",l),w.success("ログインリンクを送信しました。メールをご確認ください。")):r(t.error||"Magic Linkの送信に失敗しました。もう一度お試しください。")}catch(t){y.error("❌ Magic link error:",t),r(t instanceof Error?t.message:"メールの送信に失敗しました。もう一度お試しください。")}finally{c(!1)}},E=async s=>{s.preventDefault(),c(!0),r("");try{const t=await k(l,p);t.success?(w.success("ログインしました。"),d("/dashboard")):r(t.error||"ログインに失敗しました。もう一度お試しください。")}catch(t){y.error("❌ Password login error:",t),r(t instanceof Error?t.message:"ログインに失敗しました。もう一度お試しください。")}finally{c(!1)}};return e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold text-center mb-8",children:"ログイン"}),e.jsxs(q,{children:[e.jsxs("div",{className:"flex mb-6 bg-gray-100 p-1 rounded-lg",children:[e.jsx(m,{type:"button",onClick:()=>N(!0),variant:o?"primary":"secondary",style:o?{backgroundColor:"#2563eb",color:"white",borderColor:"#2563eb"}:{backgroundColor:"white",color:"#2563eb",borderColor:"#2563eb"},children:"パスワード"}),e.jsx(m,{type:"button",onClick:()=>N(!1),variant:o?"secondary":"primary",style:o?{backgroundColor:"white",color:"#2563eb",borderColor:"#2563eb"}:{backgroundColor:"#2563eb",color:"white",borderColor:"#2563eb"},children:"Magic Link"})]}),o?e.jsxs("form",{onSubmit:s=>void E(s),className:"p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(u,{className:"w-12 h-12 text-blue-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"パスワードでログイン"}),e.jsx("p",{className:"text-gray-600",children:"メールアドレスとパスワードを入力してください。"})]}),i&&e.jsxs("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded-lg flex items-start",children:[e.jsx(h,{className:"w-5 h-5 mr-2 flex-shrink-0 mt-0.5"}),e.jsx("p",{children:i})]}),e.jsx(g,{label:"メールアドレス",type:"email",value:l,onChange:s=>j(s.target.value),required:!0,icon:e.jsx(n,{className:"w-4 h-4 text-gray-500"}),placeholder:"capasjapan@gmail.com"}),e.jsxs("div",{className:"relative",children:[e.jsx(g,{label:"パスワード",type:x?"text":"password",value:p,onChange:s=>C(s.target.value),required:!0,icon:e.jsx(u,{className:"w-4 h-4 text-gray-500"}),placeholder:"パスワードを入力"}),e.jsx("button",{type:"button",onClick:()=>L(!x),className:"absolute right-3 top-9 text-gray-500 hover:text-gray-700",children:x?e.jsx(P,{className:"w-4 h-4"}):e.jsx(S,{className:"w-4 h-4"})})]}),e.jsxs(m,{type:"submit",isLoading:b,className:"w-full mt-6",children:[e.jsx(u,{className:"w-4 h-4 mr-2"}),"ログイン",e.jsx(f,{className:"w-4 h-4 ml-2"})]}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{type:"button",onClick:()=>d("/forgot-password"),className:"text-sm text-blue-600 hover:text-blue-700",children:"パスワードをお忘れですか？"})})]}):e.jsxs("form",{onSubmit:s=>void A(s),className:"p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(n,{className:"w-12 h-12 text-blue-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Magic Linkでログイン"}),e.jsx("p",{className:"text-gray-600",children:"メールアドレスを入力するだけで、ドッグパークJPにログインできます。"})]}),i&&e.jsxs("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded-lg flex items-start",children:[e.jsx(h,{className:"w-5 h-5 mr-2 flex-shrink-0 mt-0.5"}),e.jsx("p",{children:i})]}),e.jsx(g,{label:"メールアドレス",type:"email",value:l,onChange:s=>j(s.target.value),required:!0,icon:e.jsx(n,{className:"w-4 h-4 text-gray-500"}),placeholder:"example@example.com"}),e.jsxs(m,{type:"submit",isLoading:b,className:"w-full mt-6",children:[e.jsx(n,{className:"w-4 h-4 mr-2"}),"ログインリンクを送信",e.jsx(f,{className:"w-4 h-4 ml-2"})]})]})]}),e.jsx("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg border",children:e.jsxs("div",{className:"text-center",children:[e.jsx(h,{className:"w-6 h-6 text-orange-600 mx-auto mb-2"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-1",children:"ログインできない場合"}),e.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"管理者向けに不具合を報告できます"}),e.jsxs("button",{type:"button",onClick:()=>window.open("mailto:info@dogparkjp.com?subject=ドッグパークJP - ログイン不具合報告&body=ログインに関する不具合を報告いたします。%0A%0A【発生状況】%0A%0A【エラー内容】%0A%0A【ブラウザ情報】%0A"+navigator.userAgent,"_blank"),className:"inline-flex items-center px-4 py-2 bg-orange-600 text-white text-sm font-medium rounded-lg hover:bg-orange-700 transition-colors",children:[e.jsx(n,{className:"w-4 h-4 mr-2"}),"管理者に報告する"]})]})}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["アカウントをお持ちでない方は"," ",e.jsx("button",{onClick:()=>d("/register"),className:"text-blue-600 hover:text-blue-700 font-medium",children:"こちらから新規登録"})]})})]})}export{T as Login};

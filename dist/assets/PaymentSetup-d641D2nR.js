import{u as e,j as s,B as a,s as r}from"./index-T-nty6Ge.js";import{u as l,r as t}from"./vendor-BHVjIt_u.js";import{C as c}from"./Card-DW8Xk96S.js";import{I as i}from"./Input-B9o2mE6T.js";import{q as n,D as d,Y as x,k as m,a as h,l as o}from"./ui-srxHNTHo.js";import"./supabase-CKbzEL5D.js";function j(){const{user:j}=e(),p=l(),[u,g]=t.useState(!1),[N,f]=t.useState(""),[b,v]=t.useState(!1),[y,w]=t.useState({cardNumber:"",cardHolder:"",expiryMonth:"",expiryYear:"",cvv:"",isDefault:!0});return b?s.jsx("div",{className:"max-w-md mx-auto",children:s.jsxs(c,{className:"text-center p-8",children:[s.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx(n,{className:"w-8 h-8 text-green-600"})}),s.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"クレジットカードを登録しました"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"入場QRページに戻ります..."}),s.jsx(a,{onClick:()=>p("/entrance-qr"),children:"入場QRページへ"})]})}):s.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[s.jsx("div",{className:"flex items-center space-x-4 mb-6",children:s.jsxs("button",{onClick:()=>p("/entrance-qr"),className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[s.jsx(d,{className:"w-4 h-4 mr-2"}),"入場QRに戻る"]})}),s.jsxs("div",{className:"text-center mb-8",children:[s.jsxs("h1",{className:"text-2xl font-bold text-gray-900 mb-4 flex items-center justify-center",children:[s.jsx(x,{className:"w-8 h-8 text-blue-600 mr-3"}),"クレジットカード登録"]}),s.jsx("p",{className:"text-gray-600",children:"ドッグラン入場QRの発行にはクレジットカードの登録が必要です"})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[s.jsx("div",{className:"lg:col-span-2",children:s.jsx(c,{className:"p-6",children:s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),f(""),(()=>{if(16!==y.cardNumber.replace(/\s/g,"").length)return f("カード番号は16桁で入力してください。"),!1;if(!y.cardHolder.trim())return f("カード名義人を入力してください。"),!1;if(!y.expiryMonth||!y.expiryYear)return f("有効期限を選択してください。"),!1;if(y.cvv.length<3)return f("CVVを正しく入力してください。"),!1;const e=new Date,s=e.getFullYear()%100,a=e.getMonth()+1,r=parseInt(y.expiryYear),l=parseInt(y.expiryMonth);return!(r<s||r===s&&l<a)||(f("有効期限が過去の日付です。"),!1)})()){g(!0);try{const e=y.cardNumber.replace(/\s/g,""),s="**** **** **** "+e.slice(-4),a=(e=>{const s=e.replace(/\s/g,"");return s.startsWith("4")?"visa":s.startsWith("5")||s.startsWith("2")?"mastercard":s.startsWith("3")?"amex":s.startsWith("35")?"jcb":"visa"})(e),{error:l}=await r.from("payment_cards").insert([{user_id:j?.id,card_number_masked:s,card_holder_name:y.cardHolder,expiry_month:parseInt(y.expiryMonth),expiry_year:parseInt(y.expiryYear),card_brand:a,is_default:y.isDefault}]);if(l)throw l;v(!0),setTimeout((()=>{p("/entrance-qr")}),3e3)}catch(s){f(s.message||"決済方法の設定に失敗しました")}finally{g(!1)}}},children:[N&&s.jsxs("div",{className:"mb-4 p-3 bg-red-100 border border-red-300 rounded-lg",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(m,{className:"w-5 h-5 text-red-600"}),s.jsx("span",{className:"text-red-800 font-medium",children:"エラー"})]}),s.jsx("p",{className:"text-red-700 mt-1",children:N})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx(i,{label:"カード番号 *",value:y.cardNumber,onChange:e=>{const s=e.target.value.replace(/\D/g,"").replace(/(.{4})/g,"$1 ").trim().slice(0,19);w({...y,cardNumber:s})},placeholder:"1234 5678 9012 3456",maxLength:19,required:!0}),s.jsx(i,{label:"カード名義人 *",value:y.cardHolder,onChange:e=>w({...y,cardHolder:e.target.value.toUpperCase()}),placeholder:"TARO YAMADA",required:!0}),s.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"有効期限（月） *"}),s.jsxs("select",{value:y.expiryMonth,onChange:e=>w({...y,expiryMonth:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[s.jsx("option",{value:"",children:"月"}),Array.from({length:12},((e,a)=>s.jsx("option",{value:String(a+1).padStart(2,"0"),children:String(a+1).padStart(2,"0")},a+1)))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"有効期限（年） *"}),s.jsxs("select",{value:y.expiryYear,onChange:e=>w({...y,expiryYear:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[s.jsx("option",{value:"",children:"年"}),Array.from({length:10},((e,a)=>{const r=(new Date).getFullYear()+a;return s.jsx("option",{value:String(r).slice(-2),children:r},r)}))]})]}),s.jsx(i,{label:"CVV *",value:y.cvv,onChange:e=>w({...y,cvv:e.target.value.replace(/\D/g,"")}),placeholder:"123",maxLength:4,required:!0})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"checkbox",id:"isDefault",checked:y.isDefault,onChange:e=>w({...y,isDefault:e.target.checked}),className:"rounded text-blue-600"}),s.jsx("label",{htmlFor:"isDefault",className:"text-sm text-gray-700",children:"デフォルトの支払い方法として設定"})]}),s.jsx("div",{className:"bg-yellow-50 p-4 rounded-lg",children:s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx(m,{className:"w-5 h-5 text-yellow-600 mt-0.5 flex-shrink-0"}),s.jsxs("div",{className:"text-sm text-yellow-800",children:[s.jsx("p",{className:"font-medium mb-1",children:"重要な注意事項"}),s.jsxs("ul",{className:"space-y-1 text-xs",children:[s.jsx("li",{children:"• カード情報は暗号化して安全に保存されます"}),s.jsx("li",{children:"• 実際のカード番号は保存されません"}),s.jsx("li",{children:"• 入場QR発行時に自動で課金されます"}),s.jsx("li",{children:"• 不正利用防止のため、本人確認が必要な場合があります"})]})]})]})}),s.jsxs(a,{type:"submit",isLoading:u,className:"w-full bg-blue-600 hover:bg-blue-700 text-lg py-3",children:[s.jsx(x,{className:"w-5 h-5 mr-2"}),"クレジットカードを登録"]})]})]})})}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs(c,{className:"p-4 bg-green-50 border-green-200",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[s.jsx(h,{className:"w-5 h-5 text-green-600"}),s.jsx("h3",{className:"font-semibold text-green-900",children:"セキュリティ"})]}),s.jsxs("div",{className:"text-sm text-green-800 space-y-2",children:[s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx(n,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),s.jsx("span",{children:"SSL暗号化通信"})]}),s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx(n,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),s.jsx("span",{children:"PCI DSS準拠"})]}),s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx(n,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),s.jsx("span",{children:"カード番号は保存されません"})]}),s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx(n,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),s.jsx("span",{children:"不正利用監視システム"})]})]})]}),s.jsxs(c,{className:"p-4",children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"対応カードブランド"}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-gray-50 rounded",children:[s.jsx(x,{className:"w-5 h-5 text-blue-600"}),s.jsx("span",{className:"text-sm font-medium",children:"VISA"})]}),s.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-gray-50 rounded",children:[s.jsx(x,{className:"w-5 h-5 text-red-600"}),s.jsx("span",{className:"text-sm font-medium",children:"Mastercard"})]}),s.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-gray-50 rounded",children:[s.jsx(x,{className:"w-5 h-5 text-green-600"}),s.jsx("span",{className:"text-sm font-medium",children:"JCB"})]}),s.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-gray-50 rounded",children:[s.jsx(x,{className:"w-5 h-5 text-blue-800"}),s.jsx("span",{className:"text-sm font-medium",children:"AMEX"})]})]})]}),s.jsxs(c,{className:"p-4 bg-blue-50 border-blue-200",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[s.jsx(o,{className:"w-5 h-5 text-blue-600"}),s.jsx("h3",{className:"font-semibold text-blue-900",children:"課金について"})]}),s.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[s.jsx("p",{children:"• 入場QR発行時に自動課金"}),s.jsx("p",{children:"• 単発利用: ¥800/日"}),s.jsx("p",{children:"• サブスク会員は追加料金なし"}),s.jsx("p",{children:"• 利用明細はメールで送信"}),s.jsx("p",{children:"• 返金は利用前のみ可能"})]})]}),s.jsxs(c,{className:"p-4",children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"サポート"}),s.jsxs("div",{className:"text-sm text-gray-700 space-y-2",children:[s.jsx("p",{children:"カード登録でお困りの場合は、カスタマーサポートまでお問い合わせください。"}),s.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded",children:[s.jsx("p",{className:"font-medium",children:"カスタマーサポート"}),s.jsx("p",{children:"📞 0120-XXX-XXX"}),s.jsx("p",{children:"📧 info@dogparkjp.com"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"平日 9:00-18:00"})]})]})]})]})]})]})}export{j as PaymentSetup};

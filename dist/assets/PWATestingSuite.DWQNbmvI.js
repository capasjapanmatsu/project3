var e=(e,s,a)=>new Promise((t,i)=>{var n=e=>{try{c(a.next(e))}catch(s){i(s)}},r=e=>{try{c(a.throw(e))}catch(s){i(s)}},c=e=>e.done?t(e.value):Promise.resolve(e.value).then(n,r);c((a=a.apply(e,s)).next())});import{j as s,B as a,C as t}from"./index.CQlxbczY.js";import{r as i}from"./vendor.CKEClKZl.js";import{R as n,g as r,k as c,f as l,h as o,W as d,aU as m}from"./ui.C72fRZ1L.js";import"./router.B_7Atevv.js";import"./supabase.X3H3st79.js";const p=()=>{const[p,u]=i.useState({installation:[],offline:[],performance:[],security:[],features:[]}),[h,x]=i.useState(!1),[g,f]=i.useState("installation"),y=()=>e(void 0,null,function*(){x(!0);try{const e=yield v(),s=yield j(),a=yield w(),t=yield N(),i=yield b();u({installation:e,offline:s,performance:a,security:t,features:i})}catch(e){}finally{x(!1)}}),v=()=>e(void 0,null,function*(){var e;const s=[];try{const a=yield fetch("/manifest.json");if(s.push({id:"manifest-exists",name:"マニフェストファイル",description:"manifest.jsonファイルが存在するか",status:a.ok?"pass":"fail",details:a.ok?"マニフェストファイルが正常に読み込まれました":"マニフェストファイルが見つかりません"}),a.ok){const t=yield a.json();s.push({id:"manifest-name",name:"アプリ名",description:"manifestにname/short_nameが設定されているか",status:t.name&&t.short_name?"pass":"fail",details:`name: ${t.name||"未設定"}, short_name: ${t.short_name||"未設定"}`}),s.push({id:"manifest-icons",name:"アイコン",description:"manifestに適切なアイコンが設定されているか",status:t.icons&&t.icons.length>0?"pass":"fail",details:`${(null==(e=t.icons)?void 0:e.length)||0}個のアイコンが設定されています`}),s.push({id:"manifest-start-url",name:"スタートURL",description:"manifestにstart_urlが設定されているか",status:t.start_url?"pass":"fail",details:`start_url: ${t.start_url||"未設定"}`}),s.push({id:"manifest-display",name:"表示モード",description:"manifestに適切な表示モードが設定されているか",status:t.display?"pass":"warning",details:`display: ${t.display||"browser (デフォルト)"}`})}}catch(a){s.push({id:"manifest-error",name:"マニフェストエラー",description:"マニフェストファイルの読み込みでエラーが発生",status:"fail",details:`エラー: ${a instanceof Error?a.message:"不明なエラー"}`})}if(s.push({id:"service-worker",name:"Service Worker",description:"Service Workerが登録されているか",status:"serviceWorker"in navigator?"pass":"fail",details:"serviceWorker"in navigator?"Service Workerがサポートされています":"Service Workerがサポートされていません"}),"serviceWorker"in navigator)try{const e=yield navigator.serviceWorker.getRegistration();s.push({id:"service-worker-registered",name:"Service Worker登録状態",description:"Service Workerが実際に登録されているか",status:e?"pass":"warning",details:e?`登録済み: ${e.scope}`:"未登録または登録中"})}catch(a){s.push({id:"service-worker-error",name:"Service Workerエラー",description:"Service Worker確認中にエラーが発生",status:"fail",details:`エラー: ${a instanceof Error?a.message:"不明なエラー"}`})}return s.push({id:"installable",name:"インストール可能性",description:"PWAがインストール可能な状態か",status:window.matchMedia("(display-mode: standalone)").matches?"pass":"warning",details:window.matchMedia("(display-mode: standalone)").matches?"PWAモードで実行中":"ブラウザモードで実行中（インストール可能かもしれません）"}),s}),j=()=>e(void 0,null,function*(){const e=[];try{const s=yield fetch("/offline.html");e.push({id:"offline-page",name:"オフラインページ",description:"オフライン時に表示されるページが存在するか",status:s.ok?"pass":"fail",details:s.ok?"オフラインページが正常に読み込まれました":"オフラインページが見つかりません"})}catch(s){e.push({id:"offline-page-error",name:"オフラインページエラー",description:"オフラインページの確認中にエラーが発生",status:"fail",details:`エラー: ${s instanceof Error?s.message:"不明なエラー"}`})}if(e.push({id:"cache-api",name:"Cache API",description:"Cache APIがサポートされているか",status:"caches"in window?"pass":"fail",details:"caches"in window?"Cache APIがサポートされています":"Cache APIがサポートされていません"}),"caches"in window)try{const s=yield caches.keys();e.push({id:"cache-stored",name:"キャッシュ保存状況",description:"アプリのキャッシュが保存されているか",status:s.length>0?"pass":"warning",details:`${s.length}個のキャッシュが保存されています: ${s.join(", ")}`})}catch(s){e.push({id:"cache-error",name:"キャッシュエラー",description:"キャッシュ確認中にエラーが発生",status:"fail",details:`エラー: ${s instanceof Error?s.message:"不明なエラー"}`})}return e.push({id:"network-status",name:"ネットワーク状態",description:"現在のネットワーク接続状態",status:navigator.onLine?"pass":"warning",details:navigator.onLine?"オンライン":"オフライン"}),e}),w=()=>e(void 0,null,function*(){const e=[];if("performance"in window&&performance.navigation){const s=performance.timing,a=s.loadEventEnd-s.navigationStart;e.push({id:"load-time",name:"ページ読み込み時間",description:"ページの読み込み速度",status:a<3e3?"pass":a<5e3?"warning":"fail",details:`${a}ms（目標: 3秒以下）`});const t=s.domContentLoadedEventEnd-s.navigationStart;e.push({id:"dom-content-loaded",name:"DOM構築時間",description:"DOMContentLoadedまでの時間",status:t<1500?"pass":t<2500?"warning":"fail",details:`${t}ms（目標: 1.5秒以下）`})}if("performance"in window&&performance.getEntriesByType){const s=performance.getEntriesByType("resource").reduce((e,s)=>e+(s.transferSize||0),0);e.push({id:"resource-size",name:"リソースサイズ",description:"読み込まれたリソースの総サイズ",status:s<1e6?"pass":s<2e6?"warning":"fail",details:`${(s/1024).toFixed(2)} KB（目標: 1MB以下）`})}if("memory"in performance){const s=performance.memory;e.push({id:"memory-usage",name:"メモリ使用量",description:"JavaScriptヒープのメモリ使用量",status:s.usedJSHeapSize<5e7?"pass":"warning",details:`${(s.usedJSHeapSize/1024/1024).toFixed(2)} MB`})}return e}),N=()=>e(void 0,null,function*(){const e=[];e.push({id:"https",name:"HTTPS接続",description:"セキュアな接続が使用されているか",status:"https:"===location.protocol||"localhost"===location.hostname?"pass":"fail",details:`プロトコル: ${location.protocol}`});const s=document.querySelector('meta[http-equiv="Content-Security-Policy"]');if(e.push({id:"csp",name:"Content Security Policy",description:"CSPが設定されているか",status:s?"pass":"warning",details:s?"CSPが設定されています":"CSPが設定されていません（推奨）"}),"serviceWorker"in navigator)try{const s=yield navigator.serviceWorker.getRegistration();s&&e.push({id:"sw-scope",name:"Service Worker スコープ",description:"Service Workerのスコープが適切か",status:s.scope.endsWith("/")?"pass":"warning",details:`スコープ: ${s.scope}`})}catch(a){}return e}),b=()=>e(void 0,null,function*(){const e=[],s=document.querySelector('link[rel="manifest"]');e.push({id:"manifest-link",name:"マニフェストリンク",description:"HTMLにマニフェストリンクが設定されているか",status:s?"pass":"fail",details:s?`リンク先: ${s.href}`:"マニフェストリンクが見つかりません"});const a=document.querySelectorAll('link[rel*="icon"]');e.push({id:"favicon",name:"ファビコン",description:"ファビコンが設定されているか",status:a.length>0?"pass":"warning",details:`${a.length}個のアイコンリンクが見つかりました`});const t=document.querySelector('meta[name="viewport"]');e.push({id:"viewport",name:"ビューポート設定",description:"モバイル対応のビューポートが設定されているか",status:t?"pass":"warning",details:t?`設定: ${t.content}`:"ビューポート設定が見つかりません"});const i=document.querySelector('meta[name="theme-color"]');return e.push({id:"theme-color",name:"テーマカラー",description:"アプリのテーマカラーが設定されているか",status:i?"pass":"warning",details:i?`カラー: ${i.content}`:"テーマカラーが設定されていません"}),e.push({id:"push-notifications",name:"Push通知対応",description:"Push通知APIがサポートされているか",status:"PushManager"in window?"pass":"warning",details:"PushManager"in window?"Push通知がサポートされています":"Push通知がサポートされていません"}),e.push({id:"background-sync",name:"Background Sync対応",description:"Background Sync APIがサポートされているか",status:"serviceWorker"in navigator&&"sync"in window.ServiceWorkerRegistration.prototype?"pass":"warning",details:"serviceWorker"in navigator&&"sync"in window.ServiceWorkerRegistration.prototype?"Background Syncがサポートされています":"Background Syncがサポートされていません"}),e}),k=e=>{switch(e){case"pass":return s.jsx(r,{className:"h-5 w-5 text-green-500"});case"fail":return s.jsx(l,{className:"h-5 w-5 text-red-500"});case"warning":return s.jsx(c,{className:"h-5 w-5 text-yellow-500"});case"pending":return s.jsx(n,{className:"h-5 w-5 text-gray-500 animate-spin"});default:return null}},S=e=>{switch(e){case"pass":return"border-green-200 bg-green-50";case"fail":return"border-red-200 bg-red-50";case"warning":return"border-yellow-200 bg-yellow-50";case"pending":return"border-gray-200 bg-gray-50";default:return"border-gray-200 bg-white"}},W={installation:{name:"インストール",icon:s.jsx(m,{className:"h-4 w-4"})},offline:{name:"オフライン機能",icon:s.jsx(d,{className:"h-4 w-4"})},performance:{name:"パフォーマンス",icon:s.jsx(n,{className:"h-4 w-4"})},security:{name:"セキュリティ",icon:s.jsx(r,{className:"h-4 w-4"})},features:{name:"PWA機能",icon:s.jsx(o,{className:"h-4 w-4"})}},P=()=>p[g]||[];i.useEffect(()=>{y()},[]);const $=(()=>{const e=Object.values(p).flat();if(0===e.length)return null;return{passCount:e.filter(e=>"pass"===e.status).length,failCount:e.filter(e=>"fail"===e.status).length,warningCount:e.filter(e=>"warning"===e.status).length,total:e.length}})();return s.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"PWA テスト・チェックリスト"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"Progressive Web App (PWA) の実装状況を包括的にテストし、改善点を特定します。"}),s.jsx("div",{className:"flex justify-center gap-4 mb-6",children:s.jsxs(a,{onClick:y,disabled:h,className:"flex items-center gap-2",children:[s.jsx(n,{className:"h-4 w-4 "+(h?"animate-spin":"")}),h?"テスト実行中...":"テストを再実行"]})}),$&&s.jsxs(t,{className:"p-6 mb-6",children:[s.jsx("h2",{className:"text-xl font-semibold mb-4",children:"テスト結果サマリー"}),s.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-green-600",children:$.passCount}),s.jsx("div",{className:"text-sm text-gray-600",children:"合格"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:$.warningCount}),s.jsx("div",{className:"text-sm text-gray-600",children:"警告"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-red-600",children:$.failCount}),s.jsx("div",{className:"text-sm text-gray-600",children:"失敗"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-gray-600",children:$.total}),s.jsx("div",{className:"text-sm text-gray-600",children:"総数"})]})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:s.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:$.passCount/$.total*100+"%"}})}),s.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["合格率: ",Math.round($.passCount/$.total*100),"%"]})]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[s.jsx("div",{className:"lg:col-span-1",children:s.jsxs(t,{className:"p-4",children:[s.jsx("h3",{className:"font-semibold mb-4",children:"テストカテゴリ"}),s.jsx("div",{className:"space-y-2",children:Object.entries(W).map(([e,a])=>s.jsxs("button",{onClick:()=>f(e),className:"w-full text-left p-3 rounded-lg transition-colors flex items-center gap-2 "+(g===e?"bg-blue-100 text-blue-700 border border-blue-200":"hover:bg-gray-100 text-gray-700"),children:[a.icon,s.jsx("span",{children:a.name}),p[e]&&s.jsx("span",{className:"ml-auto text-sm bg-gray-200 text-gray-600 px-2 py-1 rounded",children:p[e].length})]},e))})]})}),s.jsx("div",{className:"lg:col-span-3",children:s.jsxs(t,{className:"p-6",children:[s.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:[W[g].icon,W[g].name," テスト結果"]}),s.jsx("div",{className:"space-y-4",children:0===P().length?s.jsx("p",{className:"text-gray-500 text-center py-8",children:h?"テスト実行中...":"テスト結果がありません。テストを実行してください。"}):P().map(e=>s.jsx("div",{className:`p-4 rounded-lg border-2 ${S(e.status)}`,children:s.jsxs("div",{className:"flex items-start gap-3",children:[k(e.status),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"font-medium text-gray-900",children:e.name}),s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),e.details&&s.jsx("p",{className:"text-sm text-gray-700 mt-2 bg-white bg-opacity-50 p-2 rounded",children:e.details})]})]})},e.id))})]})})]}),s.jsxs(t,{className:"p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"テスト項目について"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 text-sm",children:[s.jsxs("div",{children:[s.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2",children:[s.jsx(r,{className:"h-4 w-4 text-green-500"}),"合格 (Pass)"]}),s.jsx("p",{className:"text-gray-600",children:"PWAの要件を満たしており、問題ありません。"})]}),s.jsxs("div",{children:[s.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2",children:[s.jsx(c,{className:"h-4 w-4 text-yellow-500"}),"警告 (Warning)"]}),s.jsx("p",{className:"text-gray-600",children:"必須ではありませんが、改善を推奨します。"})]}),s.jsxs("div",{children:[s.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2",children:[s.jsx(l,{className:"h-4 w-4 text-red-500"}),"失敗 (Fail)"]}),s.jsx("p",{className:"text-gray-600",children:"PWAの基本要件を満たしていません。修正が必要です。"})]}),s.jsxs("div",{children:[s.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2",children:[s.jsx(n,{className:"h-4 w-4 text-gray-500"}),"実行中 (Pending)"]}),s.jsx("p",{className:"text-gray-600",children:"テストを実行中です。しばらくお待ちください。"})]})]})]})]})};export{p as default};

import{j as e,C as E,B as w,s as C,h as le,u as ne}from"./index-fyCrE4_U.js";import{r as o,L as D,u as ie}from"./react-vendor-Co5xHYdE.js";import{X as L,A as F,Y as ce,ah as $,ai as oe,C as de,aj as H,a as B,W as me,R as J,ak as xe,H as ue,i as W,t as he,al as I,F as pe,c as ge,J as be,q as z,a2 as V,a0 as Q}from"./ui-vendor-C9ptRAmi.js";import{I as S}from"./Input-B2nqC8Ef.js";import"./supabase-vendor-FDBaXLCh.js";const ye=({type:s,className:c="w-6 h-6"})=>{switch(s){case"network":return e.jsx(me,{className:`${c} text-orange-600`});case"authentication":return e.jsx(B,{className:`${c} text-red-600`});case"authorization":return e.jsx(H,{className:`${c} text-red-600`});case"validation":return e.jsx(F,{className:`${c} text-yellow-600`});case"timeout":return e.jsx(de,{className:`${c} text-blue-600`});case"server":return e.jsx(oe,{className:`${c} text-red-600`});case"not_found":return e.jsx($,{className:`${c} text-gray-600`});case"storage":return e.jsx($,{className:`${c} text-orange-600`});case"payment":return e.jsx(ce,{className:`${c} text-purple-600`});default:return e.jsx(F,{className:`${c} text-gray-600`})}},U=({error:s,onClear:c,onRetry:v,className:d="",showAsModal:u=!1})=>{if(o.useEffect(()=>{if(s&&s.severity==="low"&&s.type==="validation"){const l=setTimeout(()=>{c()},5e3);return()=>clearTimeout(l)}},[s,c]),!s)return null;const m=(l=>{switch(l){case"low":return{bg:"bg-yellow-50",border:"border-yellow-200",text:"text-yellow-800",button:"bg-yellow-600 hover:bg-yellow-700"};case"medium":return{bg:"bg-orange-50",border:"border-orange-200",text:"text-orange-800",button:"bg-orange-600 hover:bg-orange-700"};case"high":return{bg:"bg-red-50",border:"border-red-200",text:"text-red-800",button:"bg-red-600 hover:bg-red-700"};case"critical":return{bg:"bg-red-100",border:"border-red-300",text:"text-red-900",button:"bg-red-700 hover:bg-red-800"};default:return{bg:"bg-gray-50",border:"border-gray-200",text:"text-gray-800",button:"bg-gray-600 hover:bg-gray-700"}}})(s.severity),b=()=>{const l=[];return s.retryable&&v&&l.push(e.jsxs(w,{size:"sm",onClick:()=>void v(),className:m.button,children:[e.jsx(J,{className:"w-4 h-4 mr-1"}),"再試行"]},"retry")),s.type==="authentication"&&l.push(e.jsxs(w,{size:"sm",onClick:()=>window.location.href="/login",className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(xe,{className:"w-4 h-4 mr-1"}),"ログイン"]},"login")),(s.severity==="high"||s.severity==="critical")&&l.push(e.jsxs(w,{size:"sm",variant:"secondary",onClick:()=>window.location.href="/",children:[e.jsx(ue,{className:"w-4 h-4 mr-1"}),"ホームに戻る"]},"home")),l.push(e.jsxs(w,{size:"sm",variant:"secondary",onClick:c,children:[e.jsx(L,{className:"w-4 h-4 mr-1"}),"閉じる"]},"close")),l},j=e.jsx("div",{className:`${m.bg} ${m.border} border rounded-lg p-4 ${d}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(ye,{type:s.type,className:"flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`text-sm font-medium ${m.text} mb-1`,children:"エラーが発生しました"}),e.jsx("p",{className:`text-sm ${m.text} mb-3`,children:s.userMessage}),!1]}),!u&&e.jsx("button",{onClick:c,className:`ml-2 ${m.text} hover:opacity-75`,"aria-label":"エラーを閉じる",children:e.jsx(L,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:b()})]})]})});return u?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx(E,{className:"max-w-md w-full",children:j})}):j};function je({formData:s,onFormDataChange:c,onSubmit:v,error:d,isLoading:u}){const[h,m]=o.useState(""),[b,j]=o.useState(!1),l=t=>{c(t)},g=async t=>{if(!t.trim()){m("");return}j(!0);try{const{data:n,error:r}=await C.from("dog_parks").select("id, name").eq("name",t.trim()).limit(1);if(r){console.error("名前重複チェックエラー:",r),m("");return}n&&n.length>0?m("このドッグラン名は既に使用されています。別の名前を選択してください。"):m("")}catch(n){console.error("名前重複チェックエラー:",n),m("")}finally{j(!1)}};return o.useEffect(()=>{const t=setTimeout(()=>{s.name.trim()?g(s.name):m("")},500);return()=>clearTimeout(t)},[s.name]),e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(W,{className:"w-6 h-6 text-green-600"}),e.jsx("span",{className:"text-green-800 font-medium",children:"第一次審査/本人確認申請中"})]}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"ドッグラン登録 - 詳細情報入力"}),e.jsx("p",{className:"text-gray-600",children:"第一次審査/本人確認申請中です。詳細な施設情報を入力してください。"})]}),e.jsx(E,{className:"mb-6 bg-green-50 border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(W,{className:"w-6 h-6 text-green-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-green-900",children:"第一次審査/本人確認申請中"}),e.jsx("p",{className:"text-sm text-green-800",children:"基本条件と本人確認を申請中です"})]})]}),e.jsx("div",{className:"text-right text-sm text-green-700",children:e.jsx("p",{children:"次のステップ: 第二審査（書類審査）"})})]})}),d&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(F,{className:"w-5 h-5 text-red-600 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-800",children:d})]})}),e.jsx(E,{className:"p-6",children:e.jsxs("form",{onSubmit:v,className:"space-y-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(S,{label:"ドッグラン名 *",value:s.name,onChange:t=>l({name:t.target.value}),placeholder:"例: 渋谷中央ドッグラン",required:!0}),b&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"名前の重複を確認中..."}),h&&e.jsxs("p",{className:"text-xs text-red-600 mt-1 flex items-start space-x-1",children:[e.jsx(F,{className:"w-3 h-3 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:h})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"説明"}),e.jsx("textarea",{value:s.description,onChange:t=>l({description:t.target.value}),placeholder:"ドッグランの特徴や魅力をご紹介ください",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3})]}),e.jsx("div",{className:"mb-4",children:e.jsx(S,{label:"住所 *",value:s.address,onChange:t=>l({address:t.target.value}),placeholder:"例: 東京都渋谷区道玄坂1-1-1",required:!0})}),e.jsxs("div",{className:"mb-4",children:[e.jsx(S,{label:"最大収容頭数 *",type:"number",min:"1",value:s.maxCapacity,onChange:t=>l({maxCapacity:t.target.value}),placeholder:"例: 15",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"同時に利用できる犬の最大頭数を入力してください"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"対応犬種 *"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:s.largeDogArea,onChange:t=>l({largeDogArea:t.target.checked}),className:"rounded text-blue-600"}),e.jsx("span",{children:"大型犬エリア"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:s.smallDogArea,onChange:t=>l({smallDogArea:t.target.checked}),className:"rounded text-blue-600"}),e.jsx("span",{children:"小型犬エリア"})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("input",{type:"checkbox",checked:s.privateBooths,onChange:t=>l({privateBooths:t.target.checked}),className:"rounded text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"貸し切りブース"})]}),s.privateBooths&&e.jsx("div",{className:"ml-6",children:e.jsx(S,{label:"貸し切りブース数",type:"number",min:"1",value:s.privateBoothCount,onChange:t=>l({privateBoothCount:t.target.value}),placeholder:"例: 2"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"設備・サービス（第一審査で選択した内容を確認・修正できます）"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries({parking:"駐車場",shower:"シャワー設備",restroom:"トイレ",agility:"アジリティ設備",rest_area:"休憩スペース",water_station:"給水設備"}).map(([t,n])=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:s.facilities[t],onChange:r=>l({facilities:{...s.facilities,[t]:r.target.checked}}),className:"rounded text-blue-600"}),e.jsx("span",{children:n})]},t))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"設備の詳細情報"}),e.jsx("textarea",{value:s.facilityDetails,onChange:t=>l({facilityDetails:t.target.value}),placeholder:"設備やサービスについての詳細な情報を入力してください",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3})]}),e.jsx(E,{className:"bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(he,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"第二審査について"}),e.jsxs("ul",{className:"space-y-1 text-xs",children:[e.jsx("li",{children:"• 詳細な施設情報と必要書類の審査を行います"}),e.jsx("li",{children:"• 審査期間は通常3-5営業日です"}),e.jsx("li",{children:"• 通過後、QRコード実証検査の日程調整を行います"}),e.jsx("li",{children:"• 実証検査完了後、一般公開となります"})]})]})]})}),e.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[e.jsxs(D,{to:"/owner-payment-system",className:"text-blue-600 hover:text-blue-800 flex items-center",children:[e.jsx(I,{className:"w-4 h-4 mr-1"}),e.jsx("span",{className:"text-sm",children:"収益システムについて"})]}),e.jsx(w,{type:"submit",isLoading:u,disabled:u||!!h||b,className:"bg-blue-600 hover:bg-blue-700",children:"第二審査に申し込む"})]}),h&&e.jsx("div",{className:"mt-2 p-3 bg-red-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-red-800 flex items-start space-x-2",children:[e.jsx(F,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"ドッグラン名に問題があります。名前を変更してから再度お試しください。"})]})})]})})]})}function fe({formData:s,onFormDataChange:c,onSubmit:v,error:d,profileData:u,profileLoading:h,onProfileUpdate:m}){const[b,j]=o.useState(!1),[l,g]=o.useState(u),[t,n]=o.useState(!1),r=a=>{c(a)},p=(a,k)=>{a.target.files&&a.target.files[0]&&r(k==="front"?{identityDocumentFront:a.target.files[0]}:{identityDocumentBack:a.target.files[0]})},N=()=>s.identityDocumentType==="license",f=()=>!(!s.identityDocumentFront||N()&&!s.identityDocumentBack),R=()=>{m(l),j(!1)};return e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold text-center mb-8",children:"ドッグラン登録 - 第一審査・本人確認"}),e.jsx(E,{className:"mb-6 bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(pe,{className:"w-6 h-6 text-blue-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"新しい審査プロセスについて"}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"第一審査・本人確認:"})," 基本的な条件の確認と本人確認書類の審査"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"第二審査:"})," 詳細な施設情報"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"スマートロック実証検査:"})," 実際の施設での動作確認"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"掲載・運営開始:"})," 一般公開と予約受付開始"]})]}),e.jsx("div",{className:"mt-3 flex items-center",children:e.jsxs(D,{to:"/owner-payment-system",className:"text-blue-600 hover:text-blue-800 flex items-center",children:[e.jsx(I,{className:"w-4 h-4 mr-1"}),e.jsx("span",{className:"text-sm font-medium",children:"料金体系と収益システムについて詳しく見る"})]})})]})]})}),e.jsx(E,{className:"mb-6 bg-yellow-50 border-yellow-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(ge,{className:"w-6 h-6 text-yellow-600 mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-yellow-900 mb-2",children:"登録情報の確認"}),e.jsxs("div",{className:"text-sm text-yellow-800 mb-4",children:[e.jsx("p",{children:"本人確認書類に記載された情報と一致するかご確認ください。"}),e.jsx("p",{children:"間違いがある場合は修正してから本人確認書類をアップロードしてください。"})]}),h?e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-yellow-600"}),e.jsx("span",{className:"ml-2 text-yellow-800",children:"プロフィール情報を読み込み中..."})]}):e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-yellow-200",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"氏名"}),e.jsx("p",{className:"font-medium text-gray-900",children:u.name||"未設定"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"郵便番号"}),e.jsx("p",{className:"font-medium text-gray-900",children:u.postal_code||"未設定"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"住所"}),e.jsx("p",{className:"font-medium text-gray-900",children:u.address||"未設定"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"電話番号"}),e.jsx("p",{className:"font-medium text-gray-900",children:u.phone_number||"未設定"})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsxs(w,{variant:"secondary",onClick:()=>{g(u),j(!0)},className:"flex items-center",children:[e.jsx(be,{className:"w-4 h-4 mr-1"}),"情報を修正"]})})]})]})]})}),e.jsx(E,{className:"mb-6 bg-green-50 border-green-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(B,{className:"w-6 h-6 text-green-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-green-900 mb-2",children:"本人確認書類について"}),e.jsxs("div",{className:"text-sm text-green-800 space-y-1",children:[e.jsx("p",{children:"安全なプラットフォーム運営のため、ドッグランオーナーには本人確認が必要です。"}),e.jsxs("p",{children:[e.jsx("strong",{children:"個人の場合："}),"運転免許証（表面・裏面）、マイナンバーカード、パスポートのいずれか"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"法人の場合："}),"登記簿謄本（過去6か月以内に取得したもの）"]}),e.jsx("p",{children:"住所と氏名が登録情報と一致することを確認させていただきます。"})]})]})]})}),e.jsx(E,{className:"mb-6 bg-orange-50 border-orange-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(z,{className:"w-6 h-6 text-orange-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-orange-900 mb-2",children:"重要な注意事項"}),e.jsxs("div",{className:"text-sm text-orange-800 space-y-1",children:[e.jsx("p",{children:e.jsx("strong",{children:"本人確認書類の住所・氏名と上記の登録情報が一致している必要があります。"})}),e.jsx("p",{children:"一致しない場合は審査が通らない場合があります。"}),e.jsx("p",{children:"引っ越しなどで住所が変わった場合は、必ず上記の「情報を修正」から最新の情報に更新してください。"})]})]})]})}),b&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"登録情報の修正"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(S,{label:"氏名",value:l.name,onChange:a=>g({...l,name:a.target.value}),placeholder:"山田太郎"}),e.jsx(S,{label:"郵便番号",value:l.postal_code,onChange:a=>g({...l,postal_code:a.target.value}),placeholder:"123-4567"}),e.jsx(S,{label:"住所",value:l.address,onChange:a=>g({...l,address:a.target.value}),placeholder:"東京都新宿区西新宿1-1-1"}),e.jsx(S,{label:"電話番号",value:l.phone_number,onChange:a=>g({...l,phone_number:a.target.value}),placeholder:"090-1234-5678"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx(w,{variant:"secondary",onClick:()=>j(!1),children:"キャンセル"}),e.jsx(w,{onClick:R,disabled:h,children:"保存"})]})]})}),d&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(F,{className:"w-5 h-5 text-red-600 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-800",children:d})]})}),e.jsx(E,{className:"p-6",children:e.jsxs("form",{onSubmit:v,className:"space-y-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"現在ドッグランを運営していますか？ *"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"isCurrentlyOperating",value:"yes",checked:s.isCurrentlyOperating==="yes",onChange:a=>r({isCurrentlyOperating:a.target.value}),className:"text-blue-600"}),e.jsx("span",{children:"はい（すでに運営中）"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"isCurrentlyOperating",value:"no",checked:s.isCurrentlyOperating==="no",onChange:a=>r({isCurrentlyOperating:a.target.value}),className:"text-blue-600"}),e.jsx("span",{children:"いいえ（新規開設予定）"})]})]}),s.isCurrentlyOperating==="no"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mt-4 pl-4 border-l-4 border-blue-200",children:[e.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"予定地はあなたの所有地ですか？ *"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"isOwnedLand",value:"yes",checked:s.isOwnedLand==="yes",onChange:a=>r({isOwnedLand:a.target.value}),className:"text-blue-600"}),e.jsx("span",{children:"はい（所有地）"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"isOwnedLand",value:"no",checked:s.isOwnedLand==="no",onChange:a=>r({isOwnedLand:a.target.value}),className:"text-blue-600"}),e.jsx("span",{children:"いいえ（借用地）"})]})]}),s.isOwnedLand==="no"&&e.jsxs("div",{className:"mt-4 pl-4 border-l-4 border-yellow-200",children:[e.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"土地所有者の許可は得ていますか？ *"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"hasOwnerPermission",value:"yes",checked:s.hasOwnerPermission==="yes",onChange:a=>r({hasOwnerPermission:a.target.value}),className:"text-blue-600"}),e.jsx("span",{children:"はい"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"hasOwnerPermission",value:"no",checked:s.hasOwnerPermission==="no",onChange:a=>r({hasOwnerPermission:a.target.value}),className:"text-blue-600"}),e.jsx("span",{children:"いいえ"})]})]})]}),e.jsxs("div",{className:"mt-4 pl-4 border-l-4 border-green-200",children:[e.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"近隣住民の理解は得ていますか？ *"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"hasNeighborConsent",value:"yes",checked:s.hasNeighborConsent==="yes",onChange:a=>r({hasNeighborConsent:a.target.value}),className:"text-blue-600"}),e.jsx("span",{children:"はい"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"hasNeighborConsent",value:"no",checked:s.hasNeighborConsent==="no",onChange:a=>r({hasNeighborConsent:a.target.value}),className:"text-blue-600"}),e.jsx("span",{children:"いいえ"})]})]})]})]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx(S,{label:e.jsx("span",{className:"text-lg font-bold text-gray-800",children:"広さ（㎡） *"}),type:"number",min:"1",value:s.landArea,onChange:a=>r({landArea:a.target.value}),placeholder:"例: 500",required:!0}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"ドッグランの運営には最低100㎡以上の広さが必要です"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"施設までは週に1度程度、状況の確認やメンテナンスに行くことができますか？ *"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"canVisitWeekly",value:"yes",checked:s.canVisitWeekly==="yes",onChange:a=>r({canVisitWeekly:a.target.value}),className:"text-blue-600"}),e.jsx("span",{children:"はい"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"canVisitWeekly",value:"no",checked:s.canVisitWeekly==="no",onChange:a=>r({canVisitWeekly:a.target.value}),className:"text-blue-600"}),e.jsx("span",{children:"いいえ"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"緊急時（怪我や事故など）に1時間以内に施設に到着できますか？ *"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"canReachQuickly",value:"yes",checked:s.canReachQuickly==="yes",onChange:a=>r({canReachQuickly:a.target.value}),className:"text-blue-600"}),e.jsx("span",{children:"はい"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"canReachQuickly",value:"no",checked:s.canReachQuickly==="no",onChange:a=>r({canReachQuickly:a.target.value}),className:"text-blue-600"}),e.jsx("span",{children:"いいえ"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"反社会的勢力との関係はありますか？ *"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"isAntiSocialForces",value:"no",checked:s.isAntiSocialForces==="no",onChange:a=>r({isAntiSocialForces:a.target.value}),className:"text-blue-600"}),e.jsx("span",{children:"いいえ（関係なし）"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:"isAntiSocialForces",value:"yes",checked:s.isAntiSocialForces==="yes",onChange:a=>r({isAntiSocialForces:a.target.value}),className:"text-blue-600"}),e.jsx("span",{children:"はい（関係あり）"})]})]}),s.isAntiSocialForces==="yes"&&e.jsx("div",{className:"mt-2 p-3 bg-red-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(H,{className:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-red-800",children:"反社会的勢力との関係がある場合、ドッグランの登録はできません。当社は反社会的勢力との関係を一切認めておりません。"})]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"本人確認書類のアップロード *"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"申請者の種類 *"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"applicantType",value:"individual",checked:s.applicantType==="individual",onChange:a=>r({applicantType:a.target.value,identityDocumentType:"",identityDocumentFront:null,identityDocumentBack:null}),className:"mr-2",required:!0}),e.jsx("span",{children:"個人"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"applicantType",value:"corporate",checked:s.applicantType==="corporate",onChange:a=>r({applicantType:a.target.value,identityDocumentType:"",identityDocumentFront:null,identityDocumentBack:null}),className:"mr-2",required:!0}),e.jsx("span",{children:"法人"})]})]})]}),s.applicantType&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[s.applicantType==="individual"?"提出する書類の種類":"提出書類"," *"]}),e.jsx("div",{className:"space-y-2",children:s.applicantType==="individual"?e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"identityDocumentType",value:"license",checked:s.identityDocumentType==="license",onChange:a=>r({identityDocumentType:a.target.value,identityDocumentFront:null,identityDocumentBack:null}),className:"mr-2",required:!0}),e.jsx("span",{children:"運転免許証（表面・裏面の2枚）"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"identityDocumentType",value:"mynumber",checked:s.identityDocumentType==="mynumber",onChange:a=>r({identityDocumentType:a.target.value,identityDocumentFront:null,identityDocumentBack:null}),className:"mr-2",required:!0}),e.jsx("span",{children:"マイナンバーカード"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"identityDocumentType",value:"passport",checked:s.identityDocumentType==="passport",onChange:a=>r({identityDocumentType:a.target.value,identityDocumentFront:null,identityDocumentBack:null}),className:"mr-2",required:!0}),e.jsx("span",{children:"パスポート"})]})]}):e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"identityDocumentType",value:"registration",checked:s.identityDocumentType==="registration",onChange:a=>r({identityDocumentType:a.target.value,identityDocumentFront:null,identityDocumentBack:null}),className:"mr-2",required:!0}),e.jsx("span",{children:"登記簿謄本（過去6か月以内のもの）"})]})})]}),s.identityDocumentType&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx(V,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("input",{type:"file",accept:"image/jpeg,image/png,image/jpg",onChange:a=>p(a,"front"),className:"hidden",id:"identity-upload-front",required:!0}),e.jsx("label",{htmlFor:"identity-upload-front",className:"cursor-pointer text-blue-600 hover:text-blue-800 font-medium",children:"ファイルを選択"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2 font-medium",children:[s.identityDocumentType==="license"&&"運転免許証の表面",s.identityDocumentType==="mynumber"&&"マイナンバーカード",s.identityDocumentType==="passport"&&"パスポート",s.identityDocumentType==="registration"&&"登記簿謄本"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"JPG・PNG形式のみ、最大ファイルサイズ: 10MB"}),s.identityDocumentFront&&e.jsxs("p",{className:"text-sm text-green-600 mt-2",children:["選択されたファイル: ",s.identityDocumentFront.name]})]}),N()&&e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx(V,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("input",{type:"file",accept:"image/jpeg,image/png,image/jpg",onChange:a=>p(a,"back"),className:"hidden",id:"identity-upload-back",required:!0}),e.jsx("label",{htmlFor:"identity-upload-back",className:"cursor-pointer text-blue-600 hover:text-blue-800 font-medium",children:"ファイルを選択"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2 font-medium",children:"運転免許証の裏面"}),e.jsx("p",{className:"text-sm text-gray-500",children:"JPG・PNG形式のみ、最大ファイルサイズ: 10MB"}),s.identityDocumentBack&&e.jsxs("p",{className:"text-sm text-green-600 mt-2",children:["選択されたファイル: ",s.identityDocumentBack.name]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(z,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-2",children:"アップロードする書類について"}),e.jsxs("ul",{className:"space-y-1 text-sm",children:[e.jsx("li",{children:"• 文字がはっきりと読める鮮明な画像をアップロードしてください"}),e.jsx("li",{children:"• 書類全体が画像に収まっていることを確認してください"}),e.jsx("li",{children:"• 画像は正面から撮影し、傾きがないようにしてください"}),s.identityDocumentType==="registration"&&e.jsx("li",{children:"• 登記簿謄本は取得から6か月以内のものが必要です"}),e.jsx("li",{children:"• 本人確認書類の住所・氏名が上記登録情報と一致している必要があります"})]})]})]})})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"予定設備 *"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Object.entries({parking:"駐車場",shower:"シャワー設備",restroom:"トイレ",agility:"アジリティ設備",rest_area:"休憩スペース",water_station:"給水設備"}).map(([a,k])=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:s.facilities[a],onChange:_=>r({facilities:{...s.facilities,[a]:_.target.checked}}),className:"rounded text-blue-600"}),e.jsx("span",{className:"text-sm",children:k})]},a))})]}),e.jsx(E,{className:"bg-yellow-50 border-yellow-200",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(F,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"第一審査・本人確認について"}),e.jsxs("ul",{className:"space-y-1 text-xs",children:[e.jsx("li",{children:"• 基本的な開設条件を満たしているかを確認します"}),e.jsx("li",{children:"• 本人確認書類の住所・氏名が登録情報と一致することを確認します"}),e.jsx("li",{children:"• 通過後、詳細な施設情報の入力に進みます"}),e.jsx("li",{children:"• 第二審査では書類審査を行います"}),e.jsx("li",{children:"• 最終的にQRコード実証検査を経て掲載開始となります"})]})]})]})}),e.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[e.jsxs(D,{to:"/owner-payment-system",className:"text-blue-600 hover:text-blue-800 flex items-center",children:[e.jsx(I,{className:"w-4 h-4 mr-1"}),e.jsx("span",{className:"text-sm",children:"収益システムについて"})]}),e.jsxs(w,{type:"submit",className:"w-1/2 bg-blue-600 hover:bg-blue-700",disabled:!f()||t,isLoading:t,children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"第一審査・本人確認を申し込む"]})]})]})})]})}function Ne({rejectedParks:s,onUpdateRejectedParks:c,onResubmit:v,onError:d}){const[u,h]=o.useState(!1),[m,b]=o.useState(null),j=async l=>{try{h(!0);const{error:g}=await C.from("dog_parks").delete().eq("id",l);if(g)throw g;const t=s.filter(n=>n.id!==l);c(t),b(null)}catch(g){console.error("Error deleting park:",g),d(g.message||"ドッグランの削除に失敗しました")}finally{h(!1)}};return s.length===0?null:e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"mb-6 bg-red-50 border-red-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(F,{className:"w-6 h-6 text-red-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-red-900 mb-2",children:"却下された申請"}),e.jsx("p",{className:"text-sm text-red-800 mb-4",children:"以下の申請は審査の結果、却下されました。申請内容を見直して再提出するか、削除することができます。"}),e.jsx("div",{className:"space-y-4",children:s.map(l=>e.jsx("div",{className:"bg-white p-4 rounded-lg border border-red-200",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:l.name}),e.jsx("p",{className:"text-sm text-gray-600",children:l.address}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["申請日: ",new Date(l.created_at).toLocaleDateString("ja-JP")]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(w,{size:"sm",variant:"secondary",onClick:()=>v(l),children:[e.jsx(J,{className:"w-4 h-4 mr-1"}),"再申請"]}),e.jsxs(w,{size:"sm",variant:"secondary",className:"text-red-600 hover:text-red-700",onClick:()=>b(l.id),children:[e.jsx(Q,{className:"w-4 h-4 mr-1"}),"削除"]})]})]})},l.id))})]})]})}),m&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"申請を削除しますか？"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"この操作は取り消せません。申請を削除してもよろしいですか？"}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(w,{variant:"secondary",onClick:()=>b(null),children:"キャンセル"}),e.jsxs(w,{className:"bg-red-600 hover:bg-red-700",isLoading:u,onClick:()=>j(m),children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"削除する"]})]})]})})]})}function ve(){const[s,c]=o.useState(null),[v,d]=o.useState(!1),[u,h]=o.useState(null),m=o.useCallback(()=>{c(null),h(null)},[]),b=o.useCallback(t=>{if(t instanceof Error){const n=t.message.toLowerCase();if(n.includes("network")||n.includes("fetch")||n.includes("connection"))return{type:"network",severity:"medium",message:t.message,originalError:t,userMessage:"ネットワーク接続に問題があります。インターネット接続を確認してください。",recoverable:!0,retryable:!0};if(n.includes("timeout")||n.includes("timed out")||t.name==="AbortError")return{type:"timeout",severity:"medium",message:t.message,originalError:t,userMessage:"リクエストがタイムアウトしました。もう一度お試しください。",recoverable:!0,retryable:!0};if(n.includes("jwt")||n.includes("unauthorized")||n.includes("refresh_token"))return{type:"authentication",severity:"high",message:t.message,originalError:t,userMessage:"セッションが期限切れです。再度ログインしてください。",recoverable:!0,retryable:!1};if(n.includes("forbidden")||n.includes("permission")||n.includes("row-level security"))return{type:"authorization",severity:"high",message:t.message,originalError:t,userMessage:"この操作を実行する権限がありません。",recoverable:!1,retryable:!1};if(n.includes("validation")||n.includes("invalid")||n.includes("required"))return{type:"validation",severity:"low",message:t.message,originalError:t,userMessage:"入力内容に問題があります。確認してください。",recoverable:!0,retryable:!1};if(n.includes("storage")||n.includes("bucket")||n.includes("file"))return{type:"storage",severity:"medium",message:t.message,originalError:t,userMessage:"ファイルの処理中にエラーが発生しました。しばらく待ってから再度お試しください。",recoverable:!0,retryable:!0};if(n.includes("payment")||n.includes("stripe")||n.includes("subscription"))return{type:"payment",severity:"high",message:t.message,originalError:t,userMessage:"決済処理中にエラーが発生しました。カード情報を確認してください。",recoverable:!0,retryable:!0};if(n.includes("500")||n.includes("502")||n.includes("503")||n.includes("520"))return{type:"server",severity:"high",message:t.message,originalError:t,userMessage:"サーバーで一時的な問題が発生しています。しばらく待ってから再度お試しください。",recoverable:!0,retryable:!0};if(n.includes("404")||n.includes("not found"))return{type:"not_found",severity:"medium",message:t.message,originalError:t,userMessage:"要求されたリソースが見つかりません。",recoverable:!1,retryable:!1}}if(typeof t=="object"&&t!==null&&"code"in t){const n=le(t);return{type:"server",severity:"medium",message:n,originalError:t,userMessage:n,recoverable:!0,retryable:!0}}return{type:"unknown",severity:"medium",message:t instanceof Error?t.message:String(t),originalError:t,userMessage:"予期しないエラーが発生しました。しばらく待ってから再度お試しください。",recoverable:!0,retryable:!0}},[]),j=o.useCallback(t=>{t.severity==="critical"&&console.error("Critical Error:",{type:t.type,message:t.message,timestamp:t.timestamp,context:t.context})},[]),l=o.useCallback((t,n)=>{const r={...b(t),timestamp:new Date,...n&&{context:n}};j(r),c(r)},[b,j]),g=o.useCallback(async(t,n)=>{d(!0),m();try{const r=await t();return d(!1),r}catch(r){return l(r,n),d(!1),b(r).retryable&&h(()=>async()=>{await g(t,n)}),null}},[l,m,b]);return{error:s,isLoading:v,clearError:m,handleError:l,retryAction:u,executeWithErrorHandling:g}}const we={maxAttempts:3,baseDelay:1e3,maxDelay:1e4,backoffFactor:2,retryableErrors:["network","timeout","server","storage"],autoRetry:!0};function ke(s={}){const c={...we,...s},[v,d]=o.useState({attempts:0,isRetrying:!1,lastError:null,nextRetryIn:0}),u=o.useRef(),h=o.useRef(),m=o.useCallback(()=>{u.current&&clearTimeout(u.current),h.current&&clearInterval(h.current),d({attempts:0,isRetrying:!1,lastError:null,nextRetryIn:0})},[]),b=o.useCallback(()=>{u.current&&clearTimeout(u.current),h.current&&clearInterval(h.current),d(r=>({...r,isRetrying:!1,nextRetryIn:0}))},[]),j=o.useCallback(r=>{const p=c.baseDelay*Math.pow(c.backoffFactor,r);return Math.min(p,c.maxDelay)},[c]),l=o.useCallback(r=>{const p=r.message.toLowerCase();return!!(c.retryableErrors.includes("network")&&(p.includes("network")||p.includes("fetch")||p.includes("connection"))||c.retryableErrors.includes("timeout")&&(p.includes("timeout")||p.includes("timed out")||r.name==="AbortError")||c.retryableErrors.includes("server")&&(p.includes("500")||p.includes("502")||p.includes("503")||p.includes("520"))||c.retryableErrors.includes("storage")&&(p.includes("storage")||p.includes("bucket")))},[c.retryableErrors]),g=o.useCallback((r,p)=>{let N=Math.ceil(r/1e3);d(f=>({...f,nextRetryIn:N})),h.current=setInterval(()=>{N--,d(f=>({...f,nextRetryIn:N})),N<=0&&(h.current&&clearInterval(h.current),p())},1e3)},[]),t=o.useCallback(async(r,p=0)=>{try{d(f=>({...f,attempts:p,lastError:null}));const N=await r();return m(),N}catch(N){const f=N instanceof Error?N:new Error(String(N));if(d(a=>({...a,lastError:f})),p>=c.maxAttempts-1)throw d(a=>({...a,isRetrying:!1})),f;if(!l(f))throw d(a=>({...a,isRetrying:!1})),f;if(!c.autoRetry)throw d(a=>({...a,isRetrying:!1})),f;const R=j(p);return d(a=>({...a,isRetrying:!0})),new Promise((a,k)=>{g(R,()=>{u.current=setTimeout(()=>{t(r,p+1).then(a).catch(k)},0)})})}},[c,l,j,m,g]);return{execute:o.useCallback(r=>t(r,0),[t]),state:v,reset:m,cancelRetry:b}}const G={api:{maxAttempts:3,baseDelay:1e3,maxDelay:5e3,backoffFactor:1.5,retryableErrors:["network","timeout","server"],autoRetry:!0}};function Re(){const s=ie(),{user:c}=ne(),[v,d]=o.useState(!1),[u,h]=o.useState(1),[m,b]=o.useState([]),[j,l]=o.useState(null),[g,t]=o.useState({name:"",postal_code:"",address:"",phone_number:"",email:""}),[n,r]=o.useState(!1),[p,N]=o.useState(!1),{error:f,clearError:R,handleError:a,executeWithErrorHandling:k}=ve(),_=ke(G.api),[y,M]=o.useState({isCurrentlyOperating:"",isOwnedLand:"",hasOwnerPermission:"",hasNeighborConsent:"",landArea:"",isAntiSocialForces:"",canVisitWeekly:"",canReachQuickly:"",applicantType:"",identityDocumentType:"",identityDocumentFront:null,identityDocumentBack:null,name:"",description:"",address:"",maxCapacity:"10",largeDogArea:!0,smallDogArea:!0,privateBooths:!1,privateBoothCount:"0",facilities:{parking:!1,shower:!1,restroom:!1,agility:!1,rest_area:!1,water_station:!1},facilityDetails:""});o.useEffect(()=>{if(!c){s("/login");return}X(),Y(),K()},[c,s]);const X=async()=>{await k(async()=>{const{data:i,error:x}=await C.from("dog_parks").select("*").eq("owner_id",c?.id).eq("status","rejected");if(x)throw x;b(i||[])},{operation:"fetch_rejected_parks"})},Y=async()=>{await k(async()=>{const{data:i,error:x}=await C.from("owner_verifications").select("status").eq("user_id",c?.id).single();if(x&&x.code!=="PGRST116")throw x;l(i?.status||null)},{operation:"check_identity_verification"})},K=async()=>{await k(async()=>{r(!0);const{data:i,error:x}=await C.from("profiles").select("name, postal_code, address, phone_number, email").eq("id",c?.id).single();if(x)throw x;t(i||{name:"",postal_code:"",address:"",phone_number:"",email:""})},{operation:"fetch_profile_data"}),r(!1)},Z=async i=>{await k(async()=>{r(!0);const{error:x}=await C.from("profiles").update(i).eq("id",c?.id);if(x)throw x;t(i),N(!1)},{operation:"update_profile_data"}),r(!1)},q=i=>{M(x=>({...x,...i}))},ee=i=>{b(i)},se=i=>{M(x=>({...x,name:i.name,description:i.description||"",address:i.address,maxCapacity:i.max_capacity?.toString()||"10",largeDogArea:i.large_dog_area||!0,smallDogArea:i.small_dog_area||!0,privateBooths:i.private_booths||!1,privateBoothCount:i.private_booth_count?.toString()||"0",facilities:i.facilities||{parking:!1,shower:!1,restroom:!1,agility:!1,rest_area:!1,water_station:!1},facilityDetails:i.facility_details||""})),h(2)},te=i=>{if(!i.isCurrentlyOperating)throw new Error("現在の運営状況を選択してください。");if(i.isCurrentlyOperating==="no"){if(!i.isOwnedLand)throw new Error("予定地の所有状況を選択してください。");if(i.isOwnedLand==="no"&&!i.hasOwnerPermission)throw new Error("土地所有者の許可について選択してください。");if(!i.hasNeighborConsent)throw new Error("近隣住民の理解について選択してください。")}if(!i.landArea||parseInt(i.landArea)<=0)throw new Error("広さを正しく入力してください。");if(!i.isAntiSocialForces)throw new Error("反社会的勢力との関係について選択してください。");if(i.isAntiSocialForces==="yes")throw new Error("反社会的勢力との関係がある場合、ドッグランの登録はできません。");if(!i.canVisitWeekly)throw new Error("週1回の訪問可否について選択してください。");if(!i.canReachQuickly)throw new Error("緊急時の到着可否について選択してください。");if(!i.identityDocumentFront)throw new Error("本人確認書類をアップロードしてください。");if(i.isCurrentlyOperating==="no"){if(i.isOwnedLand==="no"&&i.hasOwnerPermission==="no")throw new Error("土地所有者の許可を得てからお申し込みください。借用地でのドッグラン運営には所有者の同意が必要です。");if(i.hasNeighborConsent==="no")throw new Error("近隣住民の理解を得てからお申し込みください。地域との良好な関係は運営において重要です。")}if(parseInt(i.landArea)<100)throw new Error("ドッグランの運営には最低100㎡以上の広さが必要です。");if(i.canVisitWeekly==="no")throw new Error("週に1度程度の訪問が必要です。施設の状況確認やメンテナンスのため、定期的な訪問ができる方のみお申し込みください。");if(i.canReachQuickly==="no")throw new Error("緊急時に1時間以内に施設に到着できることが必要です。迅速な対応ができる方のみお申し込みください。")},ae=async i=>{i.preventDefault(),await k(async()=>{if(te(y),!c)throw new Error("ユーザー情報が取得できません。再度ログインしてください。");d(!0);try{if(y.identityDocumentFront){const x=`identity_${c.id}_${Date.now()}_${y.identityDocumentFront.name}`,{data:T,error:P}=await C.storage.from("vaccine-certs").upload(x,y.identityDocumentFront,{upsert:!0});if(P)throw new Error(`ファイルアップロードに失敗しました: ${P.message}`);const O={user_id:c.id,verification_id:T.path,status:"pending",verification_data:{document_url:T.path,uploaded_at:new Date().toISOString(),file_name:y.identityDocumentFront.name,file_size:y.identityDocumentFront.size,file_type:y.identityDocumentFront.type,application_stage:"first_stage"}},{error:A}=await C.from("owner_verifications").upsert(O,{onConflict:"user_id"});if(A)throw new Error(`データベース保存に失敗しました: ${A.message}`)}h(2),window.scrollTo({top:0,behavior:"smooth"})}catch(x){const T=x instanceof Error?x.message:"申込みに失敗しました。";throw new Error(T)}finally{d(!1)}},{operation:"first_stage_submission"})},re=async i=>{i.preventDefault(),d(!0),R();try{await k(async()=>{const{data:{user:x},error:T}=await C.auth.getUser();if(T||!x)throw new Error("ユーザー認証に失敗しました。再度ログインしてください。");const{error:P}=await C.from("profiles").update({user_type:"owner"}).eq("id",x.id);if(P)throw new Error("プロフィールの更新に失敗しました。");const O={owner_id:x.id,name:y.name,description:y.description,address:y.address,price:800,max_capacity:parseInt(y.maxCapacity,10),large_dog_area:y.largeDogArea,small_dog_area:y.smallDogArea,private_booths:y.privateBooths,private_booth_count:parseInt(y.privateBoothCount,10),private_booth_price:0,facilities:y.facilities,facility_details:y.facilityDetails,status:"pending"},{error:A}=await C.from("dog_parks").insert([O]);if(A)throw A;setTimeout(()=>{s("/owner-dashboard")},100)})}catch(x){a(x instanceof Error?x:new Error("不明なエラーが発生しました。"))}finally{d(!1)}};return u===1?e.jsxs("div",{children:[e.jsx(U,{error:f,onClear:R,className:"mb-6"}),e.jsx(Ne,{rejectedParks:m,onUpdateRejectedParks:ee,onResubmit:se,onError:a}),e.jsx(fe,{formData:y,onFormDataChange:q,onSubmit:ae,error:f?.userMessage||"",profileData:g,profileLoading:n,onProfileUpdate:Z})]}):e.jsxs("div",{children:[e.jsx(U,{error:f,onClear:R,..._.state.isRetrying?{}:{onRetry:()=>_.execute(()=>Promise.resolve())},className:"mb-6"}),_.state.isRetrying&&e.jsx("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-800 font-medium",children:"自動リトライ中..."}),e.jsxs("p",{className:"text-blue-600 text-sm",children:["試行回数: ",_.state.attempts+1,"/",G.api.maxAttempts,_.state.nextRetryIn>0&&` | 次の試行まで: ${_.state.nextRetryIn}秒`]})]}),e.jsx("button",{onClick:_.cancelRetry,className:"text-blue-600 hover:text-blue-800 text-sm underline",children:"キャンセル"})]})}),u===2&&e.jsx(je,{formData:y,onFormDataChange:q,onSubmit:re,error:f?.userMessage||"",isLoading:v})]})}export{Re as ParkRegistration};

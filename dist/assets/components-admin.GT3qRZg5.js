/*! Build: 2025-07-17T07:59:15.523Z
Version: 0.0.0 */
import{r as e,j as s,E as a,a as t,G as r,P as i,b as l,T as n,H as c,S as d,C as o,c as m,d as x,e as h,X as u,A as g,Z as j,B as p,L as b,f as y,U as N,F as f,M as v,g as w,R as _,h as I,i as k,k as C,l as S,m as P}from"./vendor-react.D8SVeCGP.js";import{s as D,g as O,a as Z,l as B,h as z,b as M}from"./utils.C9ZsMnW6.js";import{u as A,a as $}from"./hooks.CTtJlocA.js";const W=e.createContext({user:null,session:null,loading:!0,logout:async()=>{await Promise.resolve()},isAuthenticated:!1,signInWithMagicLink:async()=>(await Promise.resolve(),{success:!1}),signInWithPassword:async()=>(await Promise.resolve(),{success:!1}),verify2FA:async()=>(await Promise.resolve(),{success:!1}),setIsTrustedDevice:()=>{},isAdmin:!1,userProfile:null}),L=({children:a})=>{const[t,r]=e.useState(null),[i,l]=e.useState(null),[n,c]=e.useState(!0),[d,o]=e.useState(!1),[m,x]=e.useState(!1),[h,u]=e.useState(null),g=async(e,s)=>{try{const{data:a,error:t}=await D.from("profiles").select("*").eq("id",e).single();if(t){if("PGRST116"===t.code&&s){const a={id:e,name:s.split("@")[0],user_type:"capasjapan@gmail.com"===s?"admin":"user",created_at:(new Date).toISOString()},{data:t,error:r}=await D.from("profiles").insert([a]).select().single();return r?null:t}return null}return a}catch(a){return null}},j=(e,s)=>{if(!e)return!1;const a="capasjapan@gmail.com"===e.email,t="admin"===(null==s?void 0:s.user_type);return a||t};e.useEffect((()=>{let e=!0;(async()=>{try{const{data:{session:s},error:a}=await D.auth.getSession();if(a)return void(e&&(l(null),r(null),o(!1),u(null),x(!1),c(!1)));s&&s.user&&e?(l(s),r(s.user),o(!0),g(s.user.id,s.user.email).then((a=>{e&&(u(a),x(j(s.user,a)))}))):e&&(l(null),r(null),o(!1),u(null),x(!1))}catch(s){e&&(l(null),r(null),o(!1),u(null),x(!1))}finally{e&&c(!1)}})();const{data:{subscription:s}}=D.auth.onAuthStateChange((async(s,a)=>{e&&("SIGNED_IN"===s&&a?(l(a),r(a.user),o(!0),g(a.user.id,a.user.email).then((s=>{e&&(u(s),x(j(a.user,s)))}))):"SIGNED_OUT"===s?e&&(l(null),r(null),o(!1),u(null),x(!1)):"TOKEN_REFRESHED"===s&&a&&e&&(l(a),r(a.user)))}));return()=>{e=!1,s.unsubscribe()}}),[]);const p=e.useCallback((async e=>{try{const{error:s}=await D.auth.signInWithOtp({email:e,options:{emailRedirectTo:`${window.location.origin}/dashboard`}});return s?{success:!1,error:s.message}:{success:!0}}catch(s){return{success:!1,error:String(s)}}}),[]),b=e.useCallback((async(e,s)=>{try{const{data:a,error:t}=await D.auth.signInWithPassword({email:e,password:s});return t?{success:!1,error:t.message}:{success:!0}}catch(a){return{success:!1,error:String(a)}}}),[]),y=e.useCallback((async e=>{try{if(!t)return{success:!1,error:"ユーザーが認証されていません"};const{data:{session:s}}=await D.auth.getSession();if(!(null==s?void 0:s.access_token))return{success:!1,error:"認証が必要です"};const a=await fetch("/functions/v1/verify-2fa",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.access_token}`},body:JSON.stringify({userId:t.id,code:e})});if(!a.ok)return{success:!1,error:(await a.json()).error||"認証に失敗しました"};const r=await a.json();return{success:r.success,...r.error&&{error:r.error}}}catch(s){return{success:!1,error:String(s)}}}),[t]),N=e.useCallback((e=>{try{localStorage.setItem("isTrustedDevice",JSON.stringify(e))}catch(s){}}),[]),f=e.useCallback((async()=>{try{await D.auth.signOut(),l(null),r(null),o(!1),u(null),x(!1);try{localStorage.removeItem("isTrustedDevice"),localStorage.removeItem("pre_payment_auth_state")}catch(e){}}catch(e){}}),[]),v={user:t,session:i,loading:n,logout:f,isAuthenticated:d,signInWithMagicLink:p,signInWithPassword:b,verify2FA:y,setIsTrustedDevice:N,isAdmin:m,userProfile:h};return s.jsx(W.Provider,{value:v,children:a})},E=()=>{const s=e.useContext(W);if(!s)throw new Error("useAuth must be used within an AuthProvider");return s},T=e.createContext({isMaintenanceActive:!1,maintenanceInfo:null,loading:!0,error:null,clientIP:null,isIPWhitelisted:!1,refreshMaintenanceStatus:async()=>{}}),G=({children:a})=>{const[t,r]=e.useState(!1),[i,l]=e.useState(null),[n,c]=e.useState(!0),[d,o]=e.useState(null),[m,x]=e.useState(null),[h,u]=e.useState(!1),g=e.useCallback((async()=>{try{c(!0),o(null);const e=await O();x(e.ip);const{data:s,error:a}=await D.rpc("should_show_maintenance",{client_ip:e.ip});if(a)return l(null),r(!1),u(!0),void o(null);if(s&&s.length>0){const e=s[0];r(e.is_maintenance_active),u(e.is_ip_allowed),e.is_maintenance_active&&e.maintenance_info?l(e.maintenance_info):l(null)}else l(null),r(!1),u(!0)}catch(e){l(null),r(!1),u(!0),o(null)}finally{c(!1)}}),[]),j=e.useCallback((async()=>{await g()}),[g]);e.useEffect((()=>{let e=!0;const s=async()=>{e&&await g()},a=setTimeout((()=>{e&&n&&(c(!1),r(!1),u(!0),l(null),o(null))}),3e4);s().catch((s=>{e&&(c(!1),r(!1),u(!0),l(null),o(null))}));const t=setInterval((()=>{e&&s().catch((e=>{}))}),3e5);return()=>{e=!1,clearTimeout(a),clearInterval(t)}}),[]);const p={isMaintenanceActive:t,maintenanceInfo:i,loading:n,error:d,clientIP:m,isIPWhitelisted:h,refreshMaintenanceStatus:j};return s.jsx(T.Provider,{value:p,children:a})},R=()=>{const s=e.useContext(T);if(!s)throw new Error("useMaintenance must be used within a MaintenanceProvider");return s},H=e.forwardRef((({children:a,variant:t="primary",size:r="md",isLoading:i=!1,fullWidth:l=!1,className:n="",leftIcon:c,rightIcon:d,loadingText:o,ariaLabel:m,ariaDescribedBy:x,tooltip:h,...u},g)=>{const j=e.useId(),p=["inline-flex items-center justify-center","rounded-lg font-medium","transition-all duration-200","disabled:opacity-50 disabled:cursor-not-allowed","focus:outline-none focus:ring-2 focus:ring-offset-2","active:scale-95","min-h-[44px] sm:min-h-[40px]","dark:focus:ring-offset-gray-800"].join(" "),b={primary:["bg-white text-blue-700 border-2 border-blue-700","hover:bg-blue-50 disabled:bg-gray-100","focus:ring-blue-600","dark:bg-white dark:text-blue-700 dark:border-blue-700 dark:hover:bg-blue-50"].join(" "),secondary:["bg-gray-100 text-gray-700 border border-gray-300","hover:bg-gray-200 disabled:bg-gray-50","focus:ring-gray-500","dark:bg-gray-100 dark:text-gray-700 dark:border-gray-300 dark:hover:bg-gray-200"].join(" "),danger:["bg-red-600 text-white","hover:bg-red-700 disabled:bg-red-400","focus:ring-red-500","dark:bg-red-600 dark:hover:bg-red-700"].join(" "),success:["bg-green-600 text-white","hover:bg-green-700 disabled:bg-green-400","focus:ring-green-500","dark:bg-green-600 dark:hover:bg-green-700"].join(" "),warning:["bg-yellow-500 text-white","hover:bg-yellow-600 disabled:bg-yellow-300","focus:ring-yellow-500","dark:bg-yellow-600 dark:hover:bg-yellow-700"].join(" ")},y=l?"w-full":"",N=n.split(" ").filter((e=>!(e.startsWith("bg-")||e.startsWith("text-")||e.startsWith("hover:bg-")||e.startsWith("focus:ring-")))).join(" "),f={"aria-label":m,"aria-describedby":x,"aria-busy":i,"aria-live":i?"polite":void 0,title:h},v=o||`${"string"==typeof a?a:"ボタン"}を処理中...`;return s.jsx("button",{ref:g,className:`${p} ${b[t]} ${{xs:"px-2 py-1 text-xs gap-1",sm:"px-3 py-1.5 text-sm gap-1.5",md:"px-4 py-2 text-base gap-2",lg:"px-6 py-3 text-lg gap-2.5"}[r]} ${y} ${N}`,disabled:i||u.disabled,...f,...u,children:i?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin flex-shrink-0","aria-hidden":"true"}),s.jsx("span",{className:"truncate",children:o||a}),s.jsx("span",{className:"sr-only","aria-live":"polite",id:j,children:v})]}):s.jsxs(s.Fragment,{children:[c&&s.jsx("span",{className:"flex-shrink-0","aria-hidden":"true",children:c}),s.jsx("span",{className:"truncate",children:a}),d&&s.jsx("span",{className:"flex-shrink-0","aria-hidden":"true",children:d})]})})}));H.displayName="Button";const J=e.forwardRef((({children:e,className:a="",onClick:t,elevation:r="md",rounded:i="lg",border:l=!1,hoverEffect:n=!1,as:c="div",...d},o)=>{const m=l?"border border-gray-200":"",x=n?"hover:shadow-lg transition-shadow duration-300":"",h=t?"cursor-pointer":"";return s.jsx(c,{ref:o,className:`bg-white ${{none:"",sm:"shadow-sm",md:"shadow-md",lg:"shadow-lg"}[r]} ${{none:"rounded-none",sm:"rounded-sm",md:"rounded-md",lg:"rounded-lg",full:"rounded-full"}[i]} ${m} ${x} ${h} ${a}`,onClick:t,...d,children:e})}));J.displayName="Card";const q=e.forwardRef((({label:r,error:i,icon:l,helperText:n,showPasswordToggle:c=!1,type:d="text",...o},m)=>{const[x,h]=e.useState(!1),u=c&&"password"===d?x?"text":"password":d;return s.jsxs("div",{className:"mb-4",children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[r,o.required&&s.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),s.jsxs("div",{className:"relative "+(l?"flex items-center":""),children:[l&&s.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:l}),s.jsx("input",{ref:m,type:u,className:`w-full px-3 py-2 ${l?"pl-10":""} border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${i?"border-red-500":"border-gray-300"} ${o.disabled?"bg-gray-100 cursor-not-allowed":""}`,"aria-invalid":i?"true":"false","aria-describedby":i?`${o.id||o.name}-error`:void 0,...o}),c&&"password"===d&&s.jsx("button",{type:"button",className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700",onClick:()=>h(!x),"aria-label":x?"パスワードを隠す":"パスワードを表示",children:x?s.jsx(a,{size:18}):s.jsx(t,{size:18})})]}),i&&s.jsx("p",{className:"mt-1 text-sm text-red-500",id:`${o.id||o.name}-error`,role:"alert",children:i}),n&&!i&&s.jsx("p",{className:"mt-1 text-sm text-gray-500",children:n})]})}));q.displayName="Input";const U=e.forwardRef((({label:e,options:a,error:t,helperText:r,icon:i,...l},n)=>s.jsxs("div",{className:"mb-4",children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e,l.required&&s.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),s.jsxs("div",{className:"relative "+(i?"flex items-center":""),children:[i&&s.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:i}),s.jsxs("select",{ref:n,className:`w-full px-3 py-2 ${i?"pl-10":""} border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ${t?"border-red-500":"border-gray-300"} ${l.disabled?"bg-gray-100 cursor-not-allowed":""} appearance-none`,"aria-invalid":t?"true":"false","aria-describedby":t?`${l.id||l.name}-error`:void 0,...l,children:[!l.required&&s.jsx("option",{value:"",children:"選択してください"}),a.map(((e,a)=>s.jsx("option",{value:e.value,children:e.label},`${e.value}-${a}`)))]}),s.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:s.jsx("svg",{className:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:s.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),t&&s.jsx("p",{className:"mt-1 text-sm text-red-500",id:`${l.id||l.name}-error`,role:"alert",children:t}),r&&!t&&s.jsx("p",{className:"mt-1 text-sm text-gray-500",children:r})]})));U.displayName="Select";const F=({onError:o,onSuccess:m})=>{const{clientIP:x}=R(),[h,u]=e.useState([]),[g,j]=e.useState(!0),[p,b]=e.useState(!1),[y,N]=e.useState(null),[f,v]=e.useState({ip_address:"",description:"",is_active:!0});e.useEffect((()=>{w()}),[]);const w=async()=>{try{j(!0);const{data:e,error:s}=await D.from("ip_whitelist").select("*").order("created_at",{ascending:!1});if(s)return void o(`IPホワイトリストの取得に失敗しました: ${s.message}`);u(e||[])}catch(e){o("IPホワイトリストの取得中にエラーが発生しました")}finally{j(!1)}};return s.jsxs("div",{className:"space-y-6",children:[s.jsx(J,{className:"p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(r,{className:"w-5 h-5 text-blue-500"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold",children:"現在のIPアドレス"}),s.jsx("p",{className:"text-sm text-gray-600",children:x||"取得中..."})]})]}),s.jsxs(H,{variant:"secondary",size:"sm",onClick:()=>{x&&(v({ip_address:`${x}/32`,description:"現在のIPアドレス",is_active:!0}),b(!0))},disabled:!x,children:[s.jsx(i,{className:"w-4 h-4 mr-1"}),"ホワイトリストに追加"]})]})}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h2",{className:"text-xl font-semibold",children:"IPホワイトリスト管理"}),s.jsxs(H,{onClick:()=>b(!0),className:"flex items-center space-x-2",children:[s.jsx(i,{className:"w-4 h-4"}),s.jsx("span",{children:"新規作成"})]})]}),p&&s.jsxs(J,{className:"p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:y?"IPホワイトリスト編集":"IPホワイトリスト作成"}),s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),f.ip_address&&f.description)try{const e={ip_address:f.ip_address,description:f.description,is_active:f.is_active};if(y){const{error:s}=await D.from("ip_whitelist").update(e).eq("id",y.id);if(s)return void o(`IPホワイトリストの更新に失敗しました: ${s.message}`);m("IPホワイトリストを更新しました")}else{const{error:s}=await D.from("ip_whitelist").insert([e]);if(s)return void o(`IPホワイトリストの作成に失敗しました: ${s.message}`);m("IPホワイトリストを作成しました")}v({ip_address:"",description:"",is_active:!0}),b(!1),N(null),await w()}catch(s){o("IPホワイトリストの保存中にエラーが発生しました")}else o("IPアドレスと説明は必須です")},className:"space-y-4",children:[s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium mb-1",children:["IPアドレス/CIDR ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx(q,{type:"text",value:f.ip_address,onChange:e=>v({...f,ip_address:e.target.value}),placeholder:"例: 192.168.1.0/24 または 192.168.1.100/32",label:"IPアドレス/CIDR",required:!0}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"CIDR形式で入力してください。単一IPの場合は /32 を付けてください。"})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium mb-1",children:["説明 ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx(q,{type:"text",value:f.description,onChange:e=>v({...f,description:e.target.value}),placeholder:"例: 本社オフィス",label:"説明",required:!0})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"checkbox",id:"is_active",checked:f.is_active,onChange:e=>v({...f,is_active:e.target.checked}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),s.jsx("label",{htmlFor:"is_active",className:"text-sm font-medium",children:"有効"})]}),s.jsxs("div",{className:"flex justify-end space-x-2",children:[s.jsx(H,{type:"button",variant:"secondary",onClick:()=>{b(!1),N(null),v({ip_address:"",description:"",is_active:!0})},children:"キャンセル"}),s.jsx(H,{type:"submit",children:y?"更新":"作成"})]})]})]}),s.jsxs(J,{className:"p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"IPホワイトリスト一覧"}),g?s.jsx("div",{className:"flex justify-center py-8",children:s.jsx("div",{className:"text-gray-600",children:"読み込み中..."})}):0===h.length?s.jsx("div",{className:"text-center py-8 text-gray-500",children:"IPホワイトリストエントリがありません"}):s.jsx("div",{className:"space-y-4",children:h.map((e=>{return s.jsx("div",{className:"border rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"flex-1",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[(x=e.ip_address,x.includes("127.0.0.1")||x.includes("::1")?s.jsx(c,{className:"w-4 h-4 text-blue-500"}):x.includes("192.168.")||x.includes("10.")||x.includes("172.")?s.jsx(d,{className:"w-4 h-4 text-green-500"}):s.jsx(r,{className:"w-4 h-4 text-orange-500"})),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("h4",{className:"font-medium",children:e.ip_address}),e.is_active&&s.jsx("span",{className:"bg-green-100 text-green-800 text-xs px-2 py-1 rounded",children:"有効"}),!e.is_active&&s.jsx("span",{className:"bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded",children:"無効"})]}),s.jsx("p",{className:"text-sm text-gray-600",children:e.description}),s.jsxs("p",{className:"text-xs text-gray-500",children:["作成: ",(i=e.created_at,new Date(i).toLocaleString("ja-JP",{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"}))]})]})]})}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(H,{variant:e.is_active?"warning":"success",size:"sm",onClick:()=>(async e=>{try{const{error:s}=await D.from("ip_whitelist").update({is_active:!e.is_active}).eq("id",e.id);if(s)return void o(`IPホワイトリストの状態変更に失敗しました: ${s.message}`);m(`IPホワイトリストを${e.is_active?"無効":"有効"}にしました`),await w()}catch(s){o("IPホワイトリストの状態変更中にエラーが発生しました")}})(e),children:e.is_active?s.jsxs(s.Fragment,{children:[s.jsx(a,{className:"w-4 h-4 mr-1"}),"無効化"]}):s.jsxs(s.Fragment,{children:[s.jsx(t,{className:"w-4 h-4 mr-1"}),"有効化"]})}),s.jsx(H,{variant:"secondary",size:"sm",onClick:()=>(e=>{N(e),v({ip_address:e.ip_address,description:e.description,is_active:e.is_active}),b(!0)})(e),children:s.jsx(l,{className:"w-4 h-4"})}),s.jsx(H,{variant:"danger",size:"sm",onClick:()=>(async e=>{if(confirm("このIPホワイトリストエントリを削除しますか？"))try{const{error:s}=await D.from("ip_whitelist").delete().eq("id",e);if(s)return void o(`IPホワイトリストの削除に失敗しました: ${s.message}`);m("IPホワイトリストを削除しました"),await w()}catch(s){o("IPホワイトリストの削除中にエラーが発生しました")}})(e.id),children:s.jsx(n,{className:"w-4 h-4"})})]})]})},e.id);var i,x}))})]})]})},V=e=>e?new Date(e).toISOString():null,Q=e=>{if(!e)return"";const s=new Date(e);return new Date(s.getTime()-6e4*s.getTimezoneOffset()).toISOString().slice(0,16)},X=({onError:a,onSuccess:t})=>{const{refreshMaintenanceStatus:r,isMaintenanceActive:c,maintenanceInfo:u}=R(),[g,j]=e.useState([]),[p,b]=e.useState(!0),[y,N]=e.useState(!1),[f,v]=e.useState(null),[w,_]=e.useState("schedules"),[I,k]=e.useState({title:"",message:"",start_time:"",end_time:"",is_emergency:!1});e.useEffect((()=>{C()}),[]);const C=async()=>{try{b(!0);const{data:e,error:s}=await D.from("maintenance_schedules").select("*").order("created_at",{ascending:!1});if(s)return void a(`メンテナンス予定の取得に失敗しました: ${s.message}`);j(e||[])}catch(e){a("メンテナンス予定の取得中にエラーが発生しました")}finally{b(!1)}},S=e=>e?new Date(e).toLocaleString("ja-JP",{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit",timeZone:"Asia/Tokyo"}):"未設定";return s.jsxs("div",{className:"space-y-6",children:[s.jsx(J,{className:"p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-4 h-4 rounded-full "+(c?"bg-red-500":"bg-green-500")}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold",children:c?"メンテナンス中":"サービス稼働中"}),c&&u&&s.jsx("p",{className:"text-sm text-gray-600",children:u.title})]})]}),s.jsx("div",{className:"flex items-center space-x-2",children:c?s.jsx(o,{className:"w-5 h-5 text-red-500"}):s.jsx(o,{className:"w-5 h-5 text-green-500"})})]})}),s.jsxs("div",{className:"flex space-x-4 border-b",children:[s.jsxs("button",{className:"px-4 py-2 font-medium "+("schedules"===w?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>_("schedules"),children:[s.jsx(m,{className:"w-4 h-4 inline mr-2"}),"メンテナンス予定"]}),s.jsxs("button",{className:"px-4 py-2 font-medium "+("whitelist"===w?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>_("whitelist"),children:[s.jsx(d,{className:"w-4 h-4 inline mr-2"}),"IPホワイトリスト"]})]}),"schedules"===w?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h2",{className:"text-xl font-semibold",children:"メンテナンス予定管理"}),s.jsxs(H,{onClick:()=>N(!0),className:"flex items-center space-x-2",children:[s.jsx(i,{className:"w-4 h-4"}),s.jsx("span",{children:"新規作成"})]})]}),y&&s.jsxs(J,{className:"p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:f?"メンテナンス予定編集":"メンテナンス予定作成"}),s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),I.title&&I.message)try{const e={title:I.title,message:I.message,start_time:V(I.start_time),end_time:V(I.end_time),is_emergency:I.is_emergency};if(f){const{error:s}=await D.from("maintenance_schedules").update(e).eq("id",f.id);if(s)return void a(`メンテナンス予定の更新に失敗しました: ${s.message}`);t("メンテナンス予定を更新しました")}else{const{error:s}=await D.from("maintenance_schedules").insert([e]);if(s)return void a(`メンテナンス予定の作成に失敗しました: ${s.message}`);t("メンテナンス予定を作成しました")}k({title:"",message:"",start_time:"",end_time:"",is_emergency:!1}),N(!1),v(null),await C()}catch(s){a("メンテナンス予定の保存中にエラーが発生しました")}else a("タイトルとメッセージは必須です")},className:"space-y-4",children:[s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium mb-1",children:["タイトル ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx(q,{type:"text",value:I.title,onChange:e=>k({...I,title:e.target.value}),placeholder:"例: システムメンテナンス",label:"タイトル",required:!0})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium mb-1",children:["メッセージ ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("textarea",{value:I.message,onChange:e=>k({...I,message:e.target.value}),placeholder:"メンテナンス中に表示されるメッセージ",className:"w-full p-2 border border-gray-300 rounded-lg",rows:3,required:!0})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"開始時刻（日本時間）"}),s.jsx(q,{type:"datetime-local",value:I.start_time,onChange:e=>k({...I,start_time:e.target.value}),label:"開始時刻"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"日本時間で入力してください"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"終了時刻（日本時間）"}),s.jsx(q,{type:"datetime-local",value:I.end_time,onChange:e=>k({...I,end_time:e.target.value}),label:"終了時刻"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"日本時間で入力してください"})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"checkbox",id:"is_emergency",checked:I.is_emergency,onChange:e=>k({...I,is_emergency:e.target.checked}),className:"w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500"}),s.jsx("label",{htmlFor:"is_emergency",className:"text-sm font-medium",children:"緊急メンテナンス"})]}),s.jsxs("div",{className:"flex justify-end space-x-2",children:[s.jsx(H,{type:"button",variant:"secondary",onClick:()=>{N(!1),v(null),k({title:"",message:"",start_time:"",end_time:"",is_emergency:!1})},children:"キャンセル"}),s.jsx(H,{type:"submit",children:f?"更新":"作成"})]})]})]}),s.jsxs(J,{className:"p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"メンテナンス予定一覧"}),p?s.jsx("div",{className:"flex justify-center py-8",children:s.jsx("div",{className:"text-gray-600",children:"読み込み中..."})}):0===g.length?s.jsx("div",{className:"text-center py-8 text-gray-500",children:"メンテナンス予定がありません"}):s.jsx("div",{className:"space-y-4",children:g.map((e=>s.jsx("div",{className:"border rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("h4",{className:"font-medium",children:e.title}),e.is_active&&s.jsx("span",{className:"bg-red-100 text-red-800 text-xs px-2 py-1 rounded",children:"有効"}),e.is_emergency&&s.jsx("span",{className:"bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded",children:"緊急"})]}),s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.message}),s.jsxs("div",{className:"text-sm text-gray-500 mt-2",children:[s.jsxs("div",{children:["開始: ",S(e.start_time)]}),s.jsxs("div",{children:["終了: ",S(e.end_time)]})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(H,{variant:e.is_active?"danger":"success",size:"sm",onClick:()=>(async e=>{try{const{error:s}=await D.from("maintenance_schedules").update({is_active:!e.is_active}).eq("id",e.id);if(s)return void a(`メンテナンス状態の変更に失敗しました: ${s.message}`);t(`メンテナンスを${e.is_active?"無効":"有効"}にしました`),await C(),await r()}catch(s){a("メンテナンス状態の変更中にエラーが発生しました")}})(e),children:e.is_active?s.jsxs(s.Fragment,{children:[s.jsx(x,{className:"w-4 h-4 mr-1"}),"無効化"]}):s.jsxs(s.Fragment,{children:[s.jsx(h,{className:"w-4 h-4 mr-1"}),"有効化"]})}),s.jsx(H,{variant:"secondary",size:"sm",onClick:()=>(e=>{v(e),k({title:e.title,message:e.message,start_time:Q(e.start_time||""),end_time:Q(e.end_time||""),is_emergency:e.is_emergency}),N(!0)})(e),children:s.jsx(l,{className:"w-4 h-4"})}),s.jsx(H,{variant:"danger",size:"sm",onClick:()=>(async e=>{if(confirm("このメンテナンス予定を削除しますか？"))try{const{error:s}=await D.from("maintenance_schedules").delete().eq("id",e);if(s)return void a(`メンテナンス予定の削除に失敗しました: ${s.message}`);t("メンテナンス予定を削除しました"),await C(),await r()}catch(s){a("メンテナンス予定の削除中にエラーが発生しました")}})(e.id),children:s.jsx(n,{className:"w-4 h-4"})})]})]})},e.id)))})]})]}):s.jsx(F,{onError:a,onSuccess:t})]})},Y=({pendingParks:a,isLoading:r,onApprovalComplete:i,onError:l})=>{var n,c,m,x,h,w;a.forEach(((e,s)=>{}));const[_,I]=e.useState(null),[k,C]=e.useState(""),[S,P]=e.useState(null),[O,Z]=e.useState(!1),[B,z]=e.useState(null),[M,W]=e.useState(null),[L,E]=e.useState(null),[T,G]=e.useState(!1),R=A(),q=$((null==_?void 0:_.id)||null);e.useEffect((()=>{(async()=>{try{const{data:e,error:s}=await D.from("owner_verifications").select("*").order("created_at",{ascending:!1});s||(null==e||e.filter((e=>e.verification_id&&e.verification_id.includes("identity_"))),null==e||e.forEach((e=>{})))}catch(e){}})()}),[]),e.useEffect((()=>{(null==_?void 0:_.owner_id)&&U(_.owner_id)}),[_]);const U=async e=>{try{G(!0),E(null);const{data:s,error:a}=await D.from("profiles").select("name, postal_code, address, phone_number, email").eq("id",e).single();if(a)return void E(`プロフィール情報の取得に失敗しました: ${a.message}`);const{data:t,error:r}=await D.from("owner_verifications").select("*").eq("user_id",e).order("created_at",{ascending:!1}).limit(1);if(t&&t.length>0){const e=t[0];let a="",r="";e.verification_data&&"object"==typeof e.verification_data&&(a=e.verification_data.document_url||e.verification_data.file_path||"",r=e.verification_data.file_name||e.verification_data.filename||""),!a&&e.verification_id&&(a=e.verification_id),r||(r=a.split("/").pop()||"identity_document"),W({id:e.id,owner_name:s.name||"名前未登録",postal_code:s.postal_code||"未登録",address:s.address||"未登録",phone_number:s.phone_number||"未登録",email:s.email||"未登録",identity_document_url:a,identity_document_filename:r,identity_status:e.status||"pending",identity_created_at:e.created_at||(new Date).toISOString()})}else W({id:"",owner_name:s.name||"名前未登録",postal_code:s.postal_code||"未登録",address:s.address||"未登録",phone_number:s.phone_number||"未登録",email:s.email||"未登録",identity_document_url:"",identity_document_filename:"",identity_status:"not_submitted",identity_created_at:""})}catch(s){E(`データの取得に失敗しました: ${s}`)}finally{G(!1)}},F=async(e,s)=>{try{if(s&&q.parkImages.filter((e=>null===e.is_approved||!1===e.is_approved)).length>0)return void l("すべての画像を承認してから施設を承認してください");const a=await R.handleParkApproval(e,s,k);a.success?(i(a.message),I(null),C("")):l(a.message)}catch(a){l(`処理中にエラーが発生しました: ${a.message}`)}},V=async e=>{if(S)try{const s=await R.handleImageApproval(S,e,k);s.success?(i(s.message),await q.fetchParkImages(_.id),Z(!1),P(null),C("")):l(s.message)}catch(s){l(`処理中にエラーが発生しました: ${s.message}`)}},Q=e=>({overview:"施設全景",entrance:"入口",large_dog_area:"大型犬エリア",small_dog_area:"小型犬エリア",private_booth:"プライベートブース",parking:"駐車場",shower:"シャワー設備",restroom:"トイレ",agility:"アジリティ設備",rest_area:"休憩スペース",water_station:"給水設備",exterior:"外観",interior:"内装",equipment:"設備",area:"エリア",other:"その他"}[e]||e);return r?s.jsx("div",{className:"flex justify-center items-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):B?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center p-4 z-50",children:s.jsxs("div",{className:"relative max-w-6xl w-full max-h-[90vh]",children:[s.jsx("button",{onClick:()=>z(null),className:"absolute top-4 right-4 p-2 bg-white bg-opacity-90 shadow-lg rounded-full text-gray-800 hover:bg-opacity-100 transition-all z-10",children:s.jsx(u,{className:"w-6 h-6"})}),s.jsx("img",{src:B,alt:"拡大画像",className:"max-w-full max-h-full mx-auto rounded-lg object-contain",onError:e=>{e.currentTarget.src="https://via.placeholder.com/800x600?text=Image+Not+Available"}})]})}):O&&S?s.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[s.jsx("div",{className:"flex items-center space-x-4 mb-6",children:s.jsxs("button",{onClick:()=>{Z(!1),P(null),C("")},className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[s.jsx(g,{className:"w-4 h-4 mr-2"}),"画像一覧に戻る"]})}),s.jsxs(J,{className:"p-6",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsxs("h2",{className:"text-xl font-bold",children:["画像レビュー: ",Q(S.image_type)]}),s.jsx("div",{className:"flex space-x-2",children:s.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-medium "+(!0===S.is_approved?"bg-green-100 text-green-800":!1===S.is_approved?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:!0===S.is_approved?"承認済み":!1===S.is_approved?"却下":"審査待ち"})})]}),s.jsx("div",{className:"mb-6",children:s.jsxs("div",{className:"w-full h-96 bg-gray-100 rounded-lg overflow-hidden relative group",children:[s.jsx("img",{src:S.image_url,alt:Q(S.image_type),className:"w-full h-full object-contain cursor-pointer",onClick:()=>z(S.image_url),onError:e=>{e.currentTarget.src="https://via.placeholder.com/800x600?text=Image+Not+Available"}}),s.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-200 flex items-center justify-center cursor-pointer",onClick:()=>z(S.image_url),children:s.jsx(j,{className:"w-12 h-12 text-white opacity-0 group-hover:opacity-100 transition-opacity duration-200"})}),s.jsx("div",{className:"absolute bottom-4 right-4",children:s.jsx("span",{className:"px-2 py-1 bg-white bg-opacity-90 text-gray-800 text-xs rounded border shadow-sm",children:"クリックで拡大"})})]})}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"却下理由（却下する場合のみ入力）"}),s.jsx("textarea",{value:k,onChange:e=>C(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,placeholder:"例: 画像が不鮮明です。より明るく鮮明な画像を再アップロードしてください。"})]}),s.jsxs("div",{className:"flex justify-end space-x-3",children:[s.jsx(H,{variant:"secondary",onClick:()=>{Z(!1),P(null),C("")},children:"キャンセル"}),s.jsxs(H,{onClick:()=>{V(!1)},isLoading:R.isProcessing,className:"bg-red-600 hover:bg-red-700",children:[s.jsx(u,{className:"w-4 h-4 mr-2"}),"却下"]}),s.jsxs(H,{onClick:()=>{V(!0)},isLoading:R.isProcessing,className:"bg-green-600 hover:bg-green-700",children:[s.jsx(o,{className:"w-4 h-4 mr-2"}),"承認"]})]})]})]}):O&&S?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h2",{className:"text-xl font-semibold",children:"画像審査"}),s.jsxs(H,{variant:"secondary",onClick:()=>{Z(!1),P(null),C("")},children:[s.jsx(g,{className:"w-4 h-4 mr-2"}),"戻る"]})]}),s.jsxs(J,{className:"p-6",children:[s.jsxs("div",{className:"mb-6",children:[s.jsxs("h3",{className:"font-semibold mb-2",children:["画像タイプ: ",Q(S.image_type)]}),s.jsxs("div",{className:"relative w-full h-96 bg-gray-100 rounded-lg overflow-hidden group",children:[s.jsx("img",{src:S.image_url,alt:Q(S.image_type),className:"w-full h-full object-contain cursor-pointer",onClick:()=>z(S.image_url),onError:e=>{e.currentTarget.src="https://via.placeholder.com/800x600?text=Image+Not+Available"}}),s.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-200 flex items-center justify-center cursor-pointer",onClick:()=>z(S.image_url),children:s.jsx(j,{className:"w-12 h-12 text-white opacity-0 group-hover:opacity-100 transition-opacity duration-200"})}),s.jsx("div",{className:"absolute bottom-4 right-4",children:s.jsx("span",{className:"px-2 py-1 bg-white bg-opacity-90 text-gray-800 text-xs rounded border shadow-sm",children:"クリックで拡大"})})]})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"却下理由（却下する場合のみ入力）"}),s.jsx("textarea",{value:k,onChange:e=>C(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,placeholder:"例: 画像が不鮮明です。より明るく鮮明な画像を再アップロードしてください。"})]}),s.jsxs("div",{className:"flex justify-end space-x-3",children:[s.jsx(H,{variant:"secondary",onClick:()=>{Z(!1),P(null),C("")},children:"キャンセル"}),s.jsxs(H,{onClick:()=>{V(!1)},isLoading:R.isProcessing,className:"bg-red-600 hover:bg-red-700",children:[s.jsx(u,{className:"w-4 h-4 mr-2"}),"却下"]}),s.jsxs(H,{onClick:()=>{V(!0)},isLoading:R.isProcessing,className:"bg-green-600 hover:bg-green-700",children:[s.jsx(o,{className:"w-4 h-4 mr-2"}),"承認"]})]})]}),B&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:s.jsxs("div",{className:"relative max-w-4xl max-h-full p-4",children:[s.jsx("img",{src:B.startsWith("http")?B:`${D.storage.from("vaccine-certs").getPublicUrl(B).data.publicUrl}`,alt:"拡大画像",className:"max-w-full max-h-full object-contain"}),s.jsx(H,{onClick:()=>z(null),className:"absolute top-2 right-2 bg-white text-black hover:bg-gray-100",children:s.jsx(u,{className:"w-4 h-4"})})]})})]}):_?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[s.jsx(p,{className:"w-6 h-6 text-blue-600 mr-2"}),_.name,"の審査"]}),s.jsxs(H,{variant:"secondary",onClick:()=>I(null),children:[s.jsx(g,{className:"w-4 h-4 mr-2"}),"一覧に戻る"]})]}),s.jsxs(J,{className:"p-6",children:[s.jsxs("h3",{className:"font-semibold mb-4 flex items-center",children:[s.jsx(p,{className:"w-5 h-5 mr-2"}),"施設情報"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"施設名"}),s.jsx("p",{className:"font-medium",children:_.name})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"住所"}),s.jsx("p",{className:"font-medium",children:_.address})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"オーナー"}),s.jsx("p",{className:"font-medium",children:_.owner_name})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"申請日"}),s.jsx("p",{className:"font-medium",children:new Date(_.created_at).toLocaleDateString("ja-JP")})]})]})]}),s.jsxs(J,{className:"p-6",children:[s.jsxs("h3",{className:"font-semibold mb-4 flex items-center",children:[s.jsx(d,{className:"w-5 h-5 mr-2"}),"本人確認書類・登録情報"]}),T?s.jsxs("div",{className:"flex justify-center items-center h-32",children:[s.jsx(b,{className:"w-8 h-8 animate-spin text-blue-600"}),s.jsx("span",{className:"ml-2 text-gray-600",children:"データを読み込み中..."})]}):L?s.jsxs("div",{className:"text-center py-8",children:[s.jsx(y,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),s.jsx("p",{className:"text-red-600 mb-2",children:L}),s.jsx(H,{variant:"secondary",onClick:()=>_&&U(_.owner_id),children:"再読み込み"})]}):M?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsxs("h4",{className:"font-medium mb-3 flex items-center",children:[s.jsx(N,{className:"w-4 h-4 mr-2"}),"登録住所情報（照合用）"]}),s.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"氏名"}),s.jsx("p",{className:"font-medium text-blue-900",children:M.owner_name})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"郵便番号"}),s.jsx("p",{className:"font-medium text-blue-900",children:M.postal_code})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"住所"}),s.jsx("p",{className:"font-medium text-blue-900",children:M.address})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"電話番号"}),s.jsx("p",{className:"font-medium text-blue-900",children:M.phone_number})]})]})})]}),M.identity_document_url?s.jsxs("div",{children:[s.jsxs("h4",{className:"font-medium mb-3 flex items-center",children:[s.jsx(f,{className:"w-4 h-4 mr-2"}),"本人確認書類"]}),s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm mb-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"ファイル名"}),s.jsx("p",{className:"font-medium",children:M.identity_document_filename})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"アップロード日"}),s.jsx("p",{className:"font-medium",children:new Date(M.identity_created_at).toLocaleDateString("ja-JP")})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"審査状況"}),s.jsx("p",{className:"font-medium "+("verified"===M.identity_status?"text-green-600":"failed"===M.identity_status?"text-red-600":"text-yellow-600"),children:"verified"===M.identity_status?"承認済み":"failed"===M.identity_status?"却下":"審査待ち"})]})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"本人確認書類画像"}),s.jsxs("div",{className:"relative inline-block",children:[s.jsx("img",{src:`${D.storage.from("vaccine-certs").getPublicUrl(M.identity_document_url).data.publicUrl}`,alt:"本人確認書類",className:"max-w-full h-auto max-h-96 rounded-lg border shadow-sm cursor-pointer hover:shadow-md transition-shadow",onClick:()=>z(M.identity_document_url),onError:e=>{e.currentTarget.src="https://via.placeholder.com/400x300?text=Image+Not+Available"}}),s.jsx("div",{className:"absolute bottom-2 right-2",children:s.jsx("span",{className:"px-2 py-1 bg-white bg-opacity-90 text-gray-800 text-xs rounded border shadow-sm",children:"クリックで拡大"})})]})]}),s.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(y,{className:"w-5 h-5 text-yellow-600 mr-2 mt-0.5"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"照合チェック"}),s.jsx("p",{className:"text-sm text-yellow-700",children:"本人確認書類に記載された住所・氏名と、上記の登録情報が一致するかご確認ください。"})]})]})})]})]}):s.jsxs("div",{children:[s.jsxs("h4",{className:"font-medium mb-3 flex items-center",children:[s.jsx(f,{className:"w-4 h-4 mr-2"}),"本人確認書類"]}),s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(y,{className:"w-5 h-5 text-red-600 mr-2 mt-0.5"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-red-800",children:"not_submitted"===M.identity_status?"本人確認書類が未提出です":"本人確認書類の取得に失敗しました"}),s.jsx("p",{className:"text-sm text-red-700 mt-1",children:"not_submitted"===M.identity_status?"このドッグラン申請には本人確認書類が添付されていません。申請者に本人確認書類の提出を依頼してください。":"システムエラーまたは画像ファイルの問題が発生している可能性があります。"})]})]})})]})]}):s.jsx("div",{className:"text-center py-8",children:s.jsx("p",{className:"text-gray-600",children:"データを読み込み中..."})})]}),("second_stage_review"===_.status||"first_stage_passed"===_.status||_.total_images>0)&&s.jsxs(J,{className:"p-6",children:[s.jsx("h3",{className:"font-semibold mb-4",children:"施設画像"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[s.jsxs("div",{className:"bg-blue-50 p-3 rounded text-center",children:[s.jsx("p",{className:"font-medium text-blue-800",children:"全画像"}),s.jsxs("p",{className:"text-blue-600",children:[_.total_images,"枚"]})]}),s.jsxs("div",{className:"bg-yellow-50 p-3 rounded text-center",children:[s.jsx("p",{className:"font-medium text-yellow-800",children:"審査待ち"}),s.jsxs("p",{className:"text-yellow-600",children:[_.pending_images,"枚"]})]}),s.jsxs("div",{className:"bg-green-50 p-3 rounded text-center",children:[s.jsx("p",{className:"font-medium text-green-800",children:"承認済み"}),s.jsxs("p",{className:"text-green-600",children:[_.approved_images,"枚"]})]}),s.jsxs("div",{className:"bg-red-50 p-3 rounded text-center",children:[s.jsx("p",{className:"font-medium text-red-800",children:"却下"}),s.jsxs("p",{className:"text-red-600",children:[_.rejected_images,"枚"]})]})]}),s.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded text-sm",children:[s.jsx("p",{children:s.jsx("strong",{children:"デバッグ情報:"})}),s.jsxs("p",{children:["Park ID: ",_.id]}),s.jsxs("p",{children:["Status: ",_.status]}),s.jsxs("p",{children:["Images Loading: ",q.isLoading?"Yes":"No"]}),s.jsxs("p",{children:["Images Count: ",q.parkImages.length]}),s.jsxs("p",{children:["Images Error: ",q.error||"None"]}),s.jsxs("p",{children:["Expected Total: ",_.total_images]}),s.jsxs("div",{className:"mt-2 flex space-x-2",children:[s.jsx(H,{size:"sm",variant:"secondary",onClick:()=>{q.fetchParkImages(_.id)},children:"画像再取得"}),s.jsx(H,{size:"sm",variant:"secondary",onClick:async()=>{try{const{data:e,error:s}=await D.from("dog_park_facility_images").select("*").eq("park_id",_.id);s||alert("データベース直接クエリ結果をコンソールに出力しました")}catch(e){}},children:"DB直接確認"})]}),s.jsxs("div",{className:"mt-2",children:[s.jsx("p",{children:s.jsx("strong",{children:"Raw Images Data:"})}),s.jsx("pre",{className:"text-xs bg-white p-2 rounded border max-h-32 overflow-y-auto",children:JSON.stringify(q.parkImages,null,2)})]})]}),q.isLoading?s.jsxs("div",{className:"flex justify-center items-center h-32",children:[s.jsx(b,{className:"w-8 h-8 animate-spin text-blue-600"}),s.jsx("span",{className:"ml-2 text-gray-600",children:"画像を読み込み中..."})]}):q.error?s.jsxs("div",{className:"text-center py-8",children:[s.jsx("p",{className:"text-red-600 mb-2",children:"画像の読み込みに失敗しました"}),s.jsx("p",{className:"text-gray-500 text-sm",children:q.error}),s.jsx(H,{variant:"secondary",onClick:()=>{q.fetchParkImages(_.id)},className:"mt-4",children:"再読み込み"})]}):0===q.parkImages.length?s.jsxs("div",{className:"text-center py-8",children:[s.jsx("p",{className:"text-gray-600",children:"アップロードされた画像がありません"}),s.jsxs("p",{className:"text-gray-500 text-sm",children:["パークステータス: ",_.status]}),s.jsxs("p",{className:"text-gray-500 text-sm",children:["期待される画像数: ",_.total_images]}),s.jsx(H,{variant:"secondary",onClick:()=>{q.fetchParkImages(_.id)},className:"mt-4",children:"手動でリフレッシュ"})]}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:q.parkImages.map(((e,a)=>s.jsxs("div",{className:"relative group",children:[s.jsxs("div",{className:"relative overflow-hidden rounded-lg bg-gray-100",children:[s.jsx("img",{src:e.image_url,alt:Q(e.image_type),className:"w-full h-48 object-cover cursor-pointer hover:scale-105 transition-transform duration-200",onClick:()=>(e=>{P(e),Z(!0),C(e.admin_notes||"")})(e),onLoad:()=>{},onError:e=>{e.currentTarget.src="https://via.placeholder.com/400x300?text=Image+Not+Available"}}),s.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-200 flex items-center justify-center cursor-pointer",onClick:s=>{s.stopPropagation(),z(e.image_url)},children:s.jsx(j,{className:"w-8 h-8 text-white opacity-0 group-hover:opacity-100 transition-opacity duration-200"})})]}),s.jsx("div",{className:"absolute top-2 right-2",children:s.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+(!0===e.is_approved?"bg-green-100 text-green-800":!1===e.is_approved?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:!0===e.is_approved?"承認済み":!1===e.is_approved?"却下":"審査待ち"})}),s.jsx("div",{className:"absolute bottom-2 left-2",children:s.jsx("span",{className:"px-2 py-1 bg-white bg-opacity-90 text-gray-800 text-xs rounded border shadow-sm",children:Q(e.image_type)})}),!1===e.is_approved&&e.admin_notes&&s.jsxs("div",{className:"mt-2 p-2 bg-red-50 rounded text-sm",children:[s.jsx("p",{className:"text-red-800 font-medium",children:"却下理由:"}),s.jsx("p",{className:"text-red-700",children:e.admin_notes})]})]},e.id)))})]}),s.jsxs(J,{className:"p-6",children:[s.jsx("h3",{className:"font-semibold mb-4",children:"審査結果"}),s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"審査チェックリスト"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("span",{className:"w-4 h-4 rounded-full mr-2 "+((null==M?void 0:M.owner_name)&&"名前未登録"!==M.owner_name?"bg-green-500":"bg-red-500")}),s.jsxs("span",{children:["登録氏名: ",(null==M?void 0:M.owner_name)||"未登録"]})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("span",{className:"w-4 h-4 rounded-full mr-2 "+((null==M?void 0:M.address)&&"未登録"!==M.address?"bg-green-500":"bg-red-500")}),s.jsxs("span",{children:["登録住所: ",(null==M?void 0:M.address)||"未登録"]})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("span",{className:"w-4 h-4 rounded-full mr-2 "+((null==M?void 0:M.phone_number)&&"未登録"!==M.phone_number?"bg-green-500":"bg-red-500")}),s.jsxs("span",{children:["電話番号: ",(null==M?void 0:M.phone_number)||"未登録"]})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("span",{className:"w-4 h-4 rounded-full mr-2 "+((null==M?void 0:M.identity_document_url)?"bg-green-500":"bg-red-500")}),s.jsxs("span",{children:["本人確認書類: ",(null==M?void 0:M.identity_document_url)?"提出済み":"未提出"]})]}),(null==M?void 0:M.identity_document_url)&&s.jsxs("div",{className:"flex items-center",children:[s.jsx("span",{className:"w-4 h-4 rounded-full mr-2 "+("verified"===M.identity_status?"bg-green-500":"failed"===M.identity_status?"bg-red-500":"bg-yellow-500")}),s.jsxs("span",{children:["本人確認状況: ","verified"===M.identity_status?"承認済み":"failed"===M.identity_status?"却下":"審査待ち"]})]})]})]})}),(!(null==M?void 0:M.identity_document_url)||"not_submitted"===M.identity_status)&&s.jsx("div",{className:"mb-4",children:s.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(y,{className:"w-5 h-5 text-yellow-600 mr-2 mt-0.5"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"審査判断の推奨事項"}),s.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"本人確認書類が未提出のため、申請を承認する前に申請者に本人確認書類の提出を依頼することを推奨します。 または、不備として一時的に却下し、必要書類の提出を求めてください。"})]})]})})}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"却下理由（却下する場合のみ入力）"}),s.jsx("textarea",{value:k,onChange:e=>C(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,placeholder:"例: 本人確認書類が未提出のため、身元確認ができません。本人確認書類（運転免許証、パスポート、マイナンバーカードなど）を提出してから再度申請してください。"})]}),s.jsxs("div",{className:"flex justify-end space-x-3",children:[s.jsxs(H,{onClick:()=>{F(_.id,!1)},isLoading:R.isProcessing,className:"bg-red-600 hover:bg-red-700",children:[s.jsx(u,{className:"w-4 h-4 mr-2"}),"却下"]}),s.jsxs(H,{onClick:()=>{F(_.id,!0)},isLoading:R.isProcessing,className:"bg-green-600 hover:bg-green-700",disabled:!(null==M?void 0:M.identity_document_url)&&"not_submitted"===(null==M?void 0:M.identity_status),children:[s.jsx(o,{className:"w-4 h-4 mr-2"}),"承認"]})]})]}),B&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:s.jsxs("div",{className:"relative max-w-4xl max-h-full p-4",children:[s.jsx("img",{src:B.startsWith("http")?B:`${D.storage.from("vaccine-certs").getPublicUrl(B).data.publicUrl}`,alt:"拡大画像",className:"max-w-full max-h-full object-contain"}),s.jsx(H,{onClick:()=>z(null),className:"absolute top-2 right-2 bg-white text-black hover:bg-gray-100",children:s.jsx(u,{className:"w-4 h-4"})})]})})]}):s.jsxs("div",{className:"space-y-4",children:[s.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[s.jsx(v,{className:"w-6 h-6 text-blue-600 mr-2"}),"審査待ちドッグラン"]}),s.jsxs("div",{className:"bg-gray-100 p-4 rounded-lg",children:[s.jsx("h3",{className:"font-medium mb-2",children:"デバッグ情報"}),s.jsxs("div",{className:"text-sm space-y-1",children:[s.jsxs("p",{children:["取得したパーク数: ",a.length]}),a.length>0&&s.jsxs("div",{children:[s.jsx("p",{children:"最初のパークの情報:"}),s.jsx("pre",{className:"bg-white p-2 rounded text-xs overflow-x-auto",children:JSON.stringify({name:null==(n=a[0])?void 0:n.name,owner_id:null==(c=a[0])?void 0:c.owner_id,identity_document_url:null==(m=a[0])?void 0:m.identity_document_url,identity_document_filename:null==(x=a[0])?void 0:x.identity_document_filename,identity_status:null==(h=a[0])?void 0:h.identity_status,identity_created_at:null==(w=a[0])?void 0:w.identity_created_at},null,2)})]})]})]}),0===a.length?s.jsxs(J,{className:"text-center py-12",children:[s.jsx(o,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"審査待ちのドッグランはありません"})]}):s.jsx("div",{className:"space-y-4",children:a.map((e=>s.jsx(J,{className:"p-6 hover:shadow-lg transition-shadow",children:s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx("h3",{className:"text-lg font-semibold",children:e.name}),s.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("first_stage_passed"===e.status?"bg-blue-100 text-blue-800":"second_stage_review"===e.status?"bg-purple-100 text-purple-800":"bg-yellow-100 text-yellow-800"),children:"first_stage_passed"===e.status?"第一審査通過":"second_stage_review"===e.status?"第二審査中":"審査待ち"})]}),s.jsx("p",{className:"text-gray-600 mb-3",children:e.address}),s.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg mb-3",children:[s.jsx("h4",{className:"font-medium text-yellow-800 mb-2",children:"デバッグ情報"}),s.jsxs("div",{className:"text-sm text-yellow-700",children:[s.jsxs("p",{children:["Owner ID: ",e.owner_id]}),s.jsxs("p",{children:["Owner Name: ",e.owner_name]}),s.jsxs("p",{children:["Owner Address: ",e.owner_address||"未設定"]}),s.jsxs("p",{children:["Owner Postal Code: ",e.owner_postal_code||"未設定"]}),s.jsxs("p",{children:["Owner Phone: ",e.owner_phone_number||"未設定"]}),s.jsxs("p",{children:["Owner Email: ",e.owner_email||"未設定"]})]})]}),s.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg mb-3",children:[s.jsxs("h4",{className:"font-medium text-gray-900 mb-2 flex items-center",children:[s.jsx(N,{className:"w-4 h-4 mr-2"}),"申請者情報"]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"氏名"}),s.jsx("p",{className:"font-medium",children:e.owner_name})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"電話番号"}),s.jsx("p",{className:"font-medium",children:e.owner_phone_number||"未登録"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"郵便番号"}),s.jsx("p",{className:"font-medium",children:e.owner_postal_code||"未登録"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"住所"}),s.jsx("p",{className:"font-medium",children:e.owner_address||"未登録"})]})]})]}),s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg mb-3",children:[s.jsxs("h4",{className:"font-medium text-blue-900 mb-2 flex items-center",children:[s.jsx(f,{className:"w-4 h-4 mr-2"}),"本人確認書類"]}),s.jsxs("div",{className:"text-xs text-gray-600 mb-2",children:["デバッグ: URL=",e.identity_document_url||"なし",", Status=",e.identity_status]}),e.identity_document_url&&""!==e.identity_document_url?s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs("div",{className:"relative",children:[s.jsx("img",{src:`${D.storage.from("vaccine-certs").getPublicUrl(e.identity_document_url).data.publicUrl}`,alt:"本人確認書類",className:"w-20 h-20 object-cover rounded border shadow-sm cursor-pointer hover:shadow-md transition-shadow",onClick:()=>{z(e.identity_document_url||null)},onLoad:()=>{},onError:e=>{e.currentTarget.src="https://via.placeholder.com/80x80?text=No+Image"}}),s.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition-opacity rounded flex items-center justify-center cursor-pointer",children:s.jsx(t,{className:"w-4 h-4 text-white opacity-0 hover:opacity-100 transition-opacity"})})]}),s.jsx("div",{className:"flex-1",children:s.jsxs("div",{className:"text-sm",children:[s.jsx("p",{className:"font-medium text-blue-900",children:e.identity_document_filename}),s.jsxs("p",{className:"text-blue-700",children:["状況: ","verified"===e.identity_status?"承認済み":"failed"===e.identity_status?"却下":"審査待ち"]}),e.identity_created_at&&s.jsxs("p",{className:"text-blue-600",children:["提出日: ",new Date(e.identity_created_at).toLocaleDateString("ja-JP")]})]})})]}):s.jsxs("div",{className:"flex items-center text-red-600",children:[s.jsx(y,{className:"w-4 h-4 mr-2"}),s.jsx("span",{className:"text-sm",children:"本人確認書類が未提出です"})]})]}),s.jsxs("div",{className:"text-sm text-gray-500",children:[s.jsxs("p",{children:["申請日: ",new Date(e.created_at).toLocaleDateString("ja-JP")]}),e.second_stage_submitted_at&&s.jsxs("p",{children:["第二審査申請日: ",new Date(e.second_stage_submitted_at).toLocaleDateString("ja-JP")]})]}),"second_stage_review"===e.status&&s.jsxs("div",{className:"mt-3 grid grid-cols-4 gap-2 text-sm",children:[s.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[s.jsx("p",{className:"font-medium text-blue-800",children:"全画像"}),s.jsxs("p",{className:"text-blue-600",children:[e.total_images,"枚"]})]}),s.jsxs("div",{className:"bg-yellow-50 p-2 rounded text-center",children:[s.jsx("p",{className:"font-medium text-yellow-800",children:"審査待ち"}),s.jsxs("p",{className:"text-yellow-600",children:[e.pending_images,"枚"]})]}),s.jsxs("div",{className:"bg-green-50 p-2 rounded text-center",children:[s.jsx("p",{className:"font-medium text-green-800",children:"承認済み"}),s.jsxs("p",{className:"text-green-600",children:[e.approved_images,"枚"]})]}),s.jsxs("div",{className:"bg-red-50 p-2 rounded text-center",children:[s.jsx("p",{className:"font-medium text-red-800",children:"却下"}),s.jsxs("p",{className:"text-red-600",children:[e.rejected_images,"枚"]})]})]})]}),s.jsxs("div",{className:"flex flex-col space-y-2",children:[s.jsxs(H,{onClick:()=>I(e),variant:"secondary",children:[s.jsx(t,{className:"w-4 h-4 mr-2"}),"詳細を見る"]}),s.jsxs(H,{onClick:()=>{F(e.id,!0)},className:"bg-green-600 hover:bg-green-700",disabled:R.isProcessing,children:[s.jsx(o,{className:"w-4 h-4 mr-1"}),"承認"]}),s.jsxs(H,{onClick:()=>{F(e.id,!1)},className:"bg-red-600 hover:bg-red-700",disabled:R.isProcessing,children:[s.jsx(u,{className:"w-4 h-4 mr-1"}),"却下"]})]})]})},e.id)))}),B&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:s.jsxs("div",{className:"relative max-w-4xl max-h-full p-4",children:[s.jsx("img",{src:B.startsWith("http")?B:`${D.storage.from("vaccine-certs").getPublicUrl(B).data.publicUrl}`,alt:"拡大画像",className:"max-w-full max-h-full object-contain",onError:e=>{e.currentTarget.src="https://via.placeholder.com/400x300?text=Image+Not+Available"}}),s.jsx(H,{onClick:()=>z(null),className:"absolute top-2 right-2 bg-white text-black hover:bg-gray-100",children:s.jsx(u,{className:"w-4 h-4"})})]})})]})},K=({pendingVaccines:a,isLoading:r,onApprovalComplete:i,onError:l})=>{const[n,c]=e.useState(null),[d,m]=e.useState(""),[x,h]=e.useState({}),[p,b]=e.useState({}),[y,N]=e.useState(null),[f,v]=e.useState(1),[k,C]=e.useState(!1),[S,P]=e.useState({rabies_expiry_date:"",combo_expiry_date:""}),D=A(),O=async(e,s)=>{try{const a=await D.handleVaccineApproval(e,s,d);a.success?(i(a.message),c(null),m("")):l(a.message)}catch(a){l(`処理中にエラーが発生しました: ${a.message}`)}},B=e=>{h((s=>({...s,[e]:!1})))},z=e=>{h((s=>({...s,[e]:!1}))),b((s=>({...s,[e]:!0})))},M=e=>{h((s=>({...s,[e]:!0}))),b((s=>({...s,[e]:!1})))},$=(e,s,a)=>{N({src:e,alt:s,type:a}),v(1)},W=()=>{N(null),v(1)},L=()=>{v((e=>Math.min(e+.5,3)))},E=()=>{v((e=>Math.max(e-.5,.5)))},T=e=>{P({rabies_expiry_date:e.rabies_expiry_date||"",combo_expiry_date:e.combo_expiry_date||""})},G=e=>{if(!e)return"未設定";try{return new Date(e).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})}catch{return"無効な日付"}},R=e=>!!e&&new Date(e)<=new Date((new Date).getTime()+2592e6),q=e=>!!e&&new Date(e)<new Date;return r?s.jsx("div",{className:"flex justify-center items-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):n?(""===S.rabies_expiry_date&&""===S.combo_expiry_date&&T(n),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[s.jsx(w,{className:"w-6 h-6 text-blue-600 mr-2"}),n.dog.name,"のワクチン証明書審査"]}),s.jsxs(H,{variant:"secondary",onClick:()=>{c(null),C(!1),P({rabies_expiry_date:"",combo_expiry_date:""})},children:[s.jsx(g,{className:"w-4 h-4 mr-2"}),"一覧に戻る"]})]}),s.jsxs(J,{className:"p-4",children:[s.jsx("h3",{className:"font-semibold mb-3",children:"犬の基本情報"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"名前"}),s.jsx("p",{className:"font-medium",children:n.dog.name})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"犬種"}),s.jsx("p",{className:"font-medium",children:n.dog.breed})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"性別"}),s.jsx("p",{className:"font-medium",children:n.dog.gender})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"飼い主"}),s.jsx("p",{className:"font-medium",children:n.dog.owner.name})]})]})]}),s.jsxs(J,{className:"p-6",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h3",{className:"font-semibold",children:"ワクチン有効期限"}),s.jsx(H,{size:"sm",variant:"secondary",onClick:()=>C(!k),children:k?"キャンセル":"編集"})]}),k?s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"狂犬病ワクチン有効期限"}),s.jsx("input",{type:"date",value:S.rabies_expiry_date,onChange:e=>P((s=>({...s,rabies_expiry_date:e.target.value}))),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"混合ワクチン有効期限"}),s.jsx("input",{type:"date",value:S.combo_expiry_date,onChange:e=>P((s=>({...s,combo_expiry_date:e.target.value}))),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),s.jsxs("div",{className:"flex justify-end space-x-2",children:[s.jsx(H,{variant:"secondary",onClick:()=>{C(!1),T(n)},children:"キャンセル"}),s.jsx(H,{onClick:()=>{(async()=>{if(n)try{const e=await D.handleVaccineExpiryUpdate(n.id,S.rabies_expiry_date||null,S.combo_expiry_date||null);e.success?(i(e.message),C(!1),n&&(n.rabies_expiry_date=S.rabies_expiry_date||null,n.combo_expiry_date=S.combo_expiry_date||null)):l(e.message)}catch(e){l(`有効期限の更新に失敗しました: ${e.message}`)}})()},isLoading:D.isProcessing,className:"bg-blue-600 hover:bg-blue-700",children:"保存"})]})]}):s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"狂犬病ワクチン有効期限"}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("p",{className:"font-medium "+(q(n.rabies_expiry_date)?"text-red-600":R(n.rabies_expiry_date)?"text-yellow-600":"text-green-600"),children:G(n.rabies_expiry_date)}),q(n.rabies_expiry_date)&&s.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full",children:"期限切れ"}),R(n.rabies_expiry_date)&&!q(n.rabies_expiry_date)&&s.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:"期限間近"})]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"混合ワクチン有効期限"}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("p",{className:"font-medium "+(q(n.combo_expiry_date)?"text-red-600":R(n.combo_expiry_date)?"text-yellow-600":"text-green-600"),children:G(n.combo_expiry_date)}),q(n.combo_expiry_date)&&s.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full",children:"期限切れ"}),R(n.combo_expiry_date)&&!q(n.combo_expiry_date)&&s.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:"期限間近"})]})]})]})]}),s.jsxs(J,{className:"p-6",children:[s.jsx("h3",{className:"font-semibold mb-4",children:"ワクチン証明書"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium mb-2",children:"狂犬病ワクチン"}),n.rabies_vaccine_image?s.jsxs("div",{className:"border rounded-lg overflow-hidden relative",children:[x[`rabies-${n.id}`]&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 z-10",children:s.jsx(_,{className:"w-6 h-6 animate-spin text-gray-600"})}),s.jsx("img",{src:Z(n.rabies_vaccine_image)||"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjNmNGY2Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzM3NDE1MSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPueUu+WDj+OBjOiqreOCgeWFpeOBv+OBvuOBm+OCk+OBp+OBl+OBnw==</dGV4dD48L3N2Zz4=",alt:"狂犬病ワクチン証明書",className:"w-full h-64 object-contain cursor-pointer hover:opacity-80 transition-opacity",onLoadStart:()=>M(`rabies-${n.id}`),onLoad:()=>B(`rabies-${n.id}`),onError:()=>z(`rabies-${n.id}`),onClick:()=>$(Z(n.rabies_vaccine_image)||"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjNmNGY2Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzM3NDE1MSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPueUu+WDj+OBjOiqreOCgeWFpeOBv+OBvuOBm+OCk+OBp+OBl+OBnw==</dGV4dD48L3N2Zz4=","狂犬病ワクチン証明書","rabies")}),s.jsx("div",{className:"absolute top-2 left-2 bg-white bg-opacity-90 text-gray-800 p-1 rounded border shadow-sm",children:s.jsx(j,{className:"w-4 h-4"})}),p[`rabies-${n.id}`]&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-red-50 bg-opacity-90",children:s.jsxs("div",{className:"text-center",children:[s.jsx(u,{className:"w-12 h-12 text-red-500 mx-auto mb-2"}),s.jsx("p",{className:"text-red-700 font-medium",children:"画像が読み込めませんでした"})]})})]}):s.jsx("div",{className:"h-64 bg-gray-100 rounded-lg flex items-center justify-center",children:s.jsx("p",{className:"text-gray-500",children:"画像なし"})})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium mb-2",children:"混合ワクチン"}),n.combo_vaccine_image?s.jsxs("div",{className:"border rounded-lg overflow-hidden relative",children:[x[`combo-${n.id}`]&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 z-10",children:s.jsx(_,{className:"w-6 h-6 animate-spin text-gray-600"})}),s.jsx("img",{src:Z(n.combo_vaccine_image)||"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjNmNGY2Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzM3NDE1MSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPueUu+WDj+OBjOiqreOCgeWFpeOBv+OBvuOBm+OCk+OBp+OBl+OBnw==</dGV4dD48L3N2Zz4=",alt:"混合ワクチン証明書",className:"w-full h-64 object-contain cursor-pointer hover:opacity-80 transition-opacity",onLoadStart:()=>M(`combo-${n.id}`),onLoad:()=>B(`combo-${n.id}`),onError:()=>z(`combo-${n.id}`),onClick:()=>$(Z(n.combo_vaccine_image)||"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjNmNGY2Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzM3NDE1MSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPueUu+WDj+OBjOiqreOCgeWFpeOBv+OBvuOBm+OCk+OBp+OBl+OBnw==</dGV4dD48L3N2Zz4=","混合ワクチン証明書","combo")}),s.jsx("div",{className:"absolute top-2 left-2 bg-white bg-opacity-90 text-gray-800 p-1 rounded border shadow-sm",children:s.jsx(j,{className:"w-4 h-4"})}),p[`combo-${n.id}`]&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-red-50 bg-opacity-90",children:s.jsxs("div",{className:"text-center",children:[s.jsx(u,{className:"w-12 h-12 text-red-500 mx-auto mb-2"}),s.jsx("p",{className:"text-red-700 font-medium",children:"画像が読み込めませんでした"})]})})]}):s.jsx("div",{className:"h-64 bg-gray-100 rounded-lg flex items-center justify-center",children:s.jsx("p",{className:"text-gray-500",children:"画像なし"})})]})]})]}),s.jsxs(J,{className:"p-6",children:[s.jsx("h3",{className:"font-semibold mb-4",children:"審査結果"}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"却下理由（却下する場合のみ入力）"}),s.jsx("textarea",{value:d,onChange:e=>m(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,placeholder:"例: ワクチン証明書の有効期限が切れています。最新の証明書をアップロードしてください。"})]}),s.jsxs("div",{className:"flex justify-end space-x-3",children:[s.jsxs(H,{onClick:()=>{O(n.id,!1)},isLoading:D.isProcessing,className:"bg-red-600 hover:bg-red-700",children:[s.jsx(u,{className:"w-4 h-4 mr-2"}),"却下"]}),s.jsxs(H,{onClick:()=>{O(n.id,!0)},isLoading:D.isProcessing,className:"bg-green-600 hover:bg-green-700",children:[s.jsx(o,{className:"w-4 h-4 mr-2"}),"承認"]})]})]}),y&&s.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4",children:[s.jsxs("div",{className:"relative max-w-full max-h-full",children:[s.jsxs("div",{className:"absolute top-4 right-4 flex items-center space-x-2 z-10",children:[s.jsx("div",{className:"bg-white bg-opacity-90 text-gray-800 px-3 py-1 rounded border shadow-sm text-sm",children:"rabies"===y.type?"狂犬病ワクチン":"混合ワクチン"}),s.jsx(H,{size:"sm",onClick:E,className:"bg-white bg-opacity-90 shadow-lg text-gray-800 hover:bg-opacity-100 border border-gray-300",children:s.jsx(I,{className:"w-4 h-4"})}),s.jsx(H,{size:"sm",onClick:L,className:"bg-white bg-opacity-90 shadow-lg text-gray-800 hover:bg-opacity-100 border border-gray-300",children:s.jsx(j,{className:"w-4 h-4"})}),s.jsx(H,{size:"sm",onClick:W,className:"bg-white bg-opacity-90 shadow-lg text-gray-800 hover:bg-opacity-100 border border-gray-300",children:s.jsx(u,{className:"w-4 h-4"})})]}),s.jsx("div",{className:"overflow-auto max-h-screen",children:s.jsx("img",{src:y.src,alt:y.alt,className:"max-w-none transition-transform duration-200",style:{transform:`scale(${f})`,transformOrigin:"center center"},onError:e=>{e.currentTarget.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjNmNGY2Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzM3NDE1MSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPueUu+WDj+OBjOiqreOCgeWFpeOBv+OBvuOBm+OCk+OBp+OBl+OBnw==</dGV4dD48L3N2Zz4="}})}),s.jsxs("div",{className:"absolute bottom-4 left-4 bg-white bg-opacity-90 text-gray-800 px-3 py-2 rounded border shadow-sm text-sm",children:[s.jsx("p",{children:"拡大/縮小: ズームボタンを使用"}),s.jsx("p",{children:"閉じる: Xボタンまたは画像外をクリック"})]})]}),s.jsx("div",{className:"absolute inset-0 -z-10",onClick:W})]})]})):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[s.jsx(w,{className:"w-6 h-6 text-blue-600 mr-2"}),"審査待ちワクチン証明書"]}),0===a.length?s.jsxs(J,{className:"text-center py-12",children:[s.jsx(o,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"審査待ちのワクチン証明書はありません"})]}):s.jsx("div",{className:"space-y-4",children:a.map((e=>s.jsx(J,{className:"p-6 hover:shadow-lg transition-shadow",children:s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("h3",{className:"text-lg font-semibold mb-2",children:[e.dog.name,"のワクチン証明書"]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"犬種"}),s.jsx("p",{className:"font-medium",children:e.dog.breed})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"性別"}),s.jsx("p",{className:"font-medium",children:e.dog.gender})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"飼い主"}),s.jsx("p",{className:"font-medium",children:e.dog.owner.name})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"申請日"}),s.jsx("p",{className:"font-medium",children:new Date(e.created_at).toLocaleDateString("ja-JP")})]})]})]}),s.jsxs("div",{className:"flex space-x-2 ml-4",children:[s.jsxs(H,{size:"sm",variant:"secondary",onClick:()=>c(e),children:[s.jsx(t,{className:"w-4 h-4 mr-1"}),"詳細"]}),s.jsxs(H,{size:"sm",onClick:()=>{O(e.id,!0)},className:"bg-green-600 hover:bg-green-700",disabled:D.isProcessing,children:[s.jsx(o,{className:"w-4 h-4 mr-1"}),"承認"]}),s.jsxs(H,{size:"sm",onClick:()=>{c(e),O(e.id,!1)},className:"bg-red-600 hover:bg-red-700",disabled:D.isProcessing,children:[s.jsx(u,{className:"w-4 h-4 mr-1"}),"却下"]})]})]})},e.id)))})]}),y&&s.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4",children:[s.jsxs("div",{className:"relative max-w-full max-h-full",children:[s.jsxs("div",{className:"absolute top-4 right-4 flex items-center space-x-2 z-10",children:[s.jsx("div",{className:"bg-white bg-opacity-90 text-gray-800 px-3 py-1 rounded border shadow-sm text-sm",children:"rabies"===y.type?"狂犬病ワクチン":"混合ワクチン"}),s.jsx(H,{size:"sm",onClick:E,className:"bg-white bg-opacity-90 shadow-lg text-gray-800 hover:bg-opacity-100 border border-gray-300",children:s.jsx(I,{className:"w-4 h-4"})}),s.jsx(H,{size:"sm",onClick:L,className:"bg-white bg-opacity-90 shadow-lg text-gray-800 hover:bg-opacity-100 border border-gray-300",children:s.jsx(j,{className:"w-4 h-4"})}),s.jsx(H,{size:"sm",onClick:W,className:"bg-white bg-opacity-90 shadow-lg text-gray-800 hover:bg-opacity-100 border border-gray-300",children:s.jsx(u,{className:"w-4 h-4"})})]}),s.jsx("div",{className:"overflow-auto max-h-screen",children:s.jsx("img",{src:y.src,alt:y.alt,className:"max-w-none transition-transform duration-200",style:{transform:`scale(${f})`,transformOrigin:"center center"},onError:e=>{e.currentTarget.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjNmNGY2Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzM3NDE1MSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPueUu+WDj+OBjOiqreOCgeWFpeOBv+OBvuOBm+OCk+OBp+OBl+OBnw==</dGV4dD48L3N2Zz4="}})}),s.jsxs("div",{className:"absolute bottom-4 left-4 bg-white bg-opacity-90 text-gray-800 px-3 py-2 rounded border shadow-sm text-sm",children:[s.jsx("p",{children:"拡大/縮小: ズームボタンを使用"}),s.jsx("p",{children:"閉じる: Xボタンまたは画像外をクリック"})]})]}),s.jsx("div",{className:"absolute inset-0 -z-10",onClick:W})]})]})};function ee(){const{user:a}=E(),[t,r]=e.useState([]),[l,n]=e.useState({title:"",content:"",category:"news",is_important:!1,image_url:"",link_url:""}),[c,d]=e.useState(null),[m,x]=e.useState(!1),[h,g]=e.useState(!1),[j,p]=e.useState(""),[b,N]=e.useState("");e.useEffect((()=>{w(),v()}),[]);const v=async()=>{if(a)try{const{data:e,error:s}=await D.from("profiles").select("*").eq("id",a.id).single();if(s&&"PGRST116"===s.code){const{data:e,error:s}=await D.from("profiles").insert([{id:a.id,user_type:"admin",name:a.email||"Admin User",email:a.email}]).select().single();s?(B("error","Error creating admin profile:",{createError:s}),p("管理者プロファイルの作成に失敗しました。")):(B("info","Admin profile created successfully:",{newProfile:e}),N("管理者プロファイルを作成しました。"),setTimeout((()=>N("")),3e3))}else if(s)B("error","Error fetching user profile:",{error:s}),p("ユーザープロファイルの取得に失敗しました。");else if(!e||"admin"!==e.user_type){B("info","Updating user to admin...");const{error:e}=await D.from("profiles").update({user_type:"admin"}).eq("id",a.id);e?(B("error","Error updating user to admin:",{updateError:e}),p("管理者権限の設定に失敗しました。")):(B("info","User updated to admin successfully"),N("管理者権限を設定しました。ページを手動でリロードしてください。"),setTimeout((()=>N("")),5e3))}}catch(e){B("error","Error checking user profile:",{error:z(e)}),p("ユーザープロファイルの確認に失敗しました。")}},w=async()=>{try{const e=await M((()=>D.from("news_announcements").select("*").order("created_at",{ascending:!1})));if(e.error)throw e.error;r(e.data||[]),p("")}catch(e){B("error","Error fetching news:",{error:z(e)}),p("新着情報の取得に失敗しました。")}},_=e=>({news:"お知らせ",announcement:"重要なお知らせ",sale:"セール情報"}[e]||e),I=e=>{switch(e){case"news":return s.jsx(f,{className:"w-4 h-4"});case"announcement":return s.jsx(P,{className:"w-4 h-4"});case"sale":return s.jsx(S,{className:"w-4 h-4"});default:return s.jsx(k,{className:"w-4 h-4"})}};return s.jsxs(s.Fragment,{children:[s.jsxs(J,{className:"p-6",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsxs("h2",{className:"text-lg font-semibold flex items-center",children:[s.jsx(k,{className:"w-5 h-5 text-blue-600 mr-2"}),"新着情報管理"]}),s.jsxs(H,{onClick:()=>{d(null),n({title:"",content:"",category:"news",is_important:!1,image_url:"",link_url:""}),x(!0)},children:[s.jsx(i,{className:"w-4 h-4 mr-2"}),"新着情報を追加"]})]}),j&&s.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-start",children:[s.jsx(y,{className:"w-5 h-5 text-red-600 mt-0.5 mr-2 flex-shrink-0"}),s.jsx("p",{className:"text-red-800",children:j})]}),b&&s.jsxs("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-lg flex items-start",children:[s.jsx(o,{className:"w-5 h-5 text-green-600 mt-0.5 mr-2 flex-shrink-0"}),s.jsx("p",{className:"text-green-800",children:b})]}),s.jsx("div",{className:"space-y-4",children:0===t.length?s.jsx("div",{className:"text-center py-8 text-gray-500",children:"新着情報がありません"}):t.map((e=>{return s.jsx("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium flex items-center space-x-1 ${a=e.category,{news:"bg-blue-100 text-blue-800",announcement:"bg-red-100 text-red-800",sale:"bg-green-100 text-green-800"}[a]||"bg-gray-100 text-gray-800"}`,children:[I(e.category),s.jsx("span",{children:_(e.category)})]}),e.is_important&&s.jsx("span",{className:"bg-red-100 text-red-800 px-2 py-1 rounded-full text-xs font-medium",children:"重要"})]}),s.jsx("h3",{className:"font-bold text-lg mb-2",children:e.title}),s.jsx("p",{className:"text-sm text-gray-700 mb-2 line-clamp-2",children:e.content}),s.jsxs("div",{className:"text-xs text-gray-500",children:["作成日: ",new Date(e.created_at).toLocaleString("ja-JP"),e.updated_at!==e.created_at&&s.jsxs("span",{children:[" / 更新日: ",new Date(e.updated_at).toLocaleString("ja-JP")]})]})]}),s.jsxs("div",{className:"flex space-x-2 ml-4",children:[s.jsxs(H,{variant:"secondary",size:"sm",onClick:()=>(e=>{d(e),n({title:e.title,content:e.content,category:e.category,is_important:e.is_important||!1,image_url:"",link_url:""}),x(!0)})(e),disabled:h,children:[s.jsx(C,{className:"w-4 h-4 mr-1"}),"編集"]}),s.jsxs(H,{variant:"danger",size:"sm",onClick:()=>(async e=>{if(confirm("この新着情報を削除してもよろしいですか？"))try{g(!0),p("");const{error:s}=await D.from("news_announcements").delete().eq("id",e);if(s)throw s;N("新着情報を削除しました。"),await w(),setTimeout((()=>{N("")}),3e3)}catch(s){B("error","Error deleting news:",{error:z(s)}),p("新着情報の削除に失敗しました。")}finally{g(!1)}})(e.id),disabled:h,children:[s.jsx(u,{className:"w-4 h-4 mr-1"}),"削除"]})]})]})},e.id);var a}))})]}),m&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h2",{className:"text-xl font-bold",children:c?"新着情報を編集":"新着情報を追加"}),s.jsx("button",{onClick:()=>x(!1),className:"text-gray-500 hover:text-gray-700",disabled:h,children:s.jsx(u,{className:"w-6 h-6"})})]}),s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),l.title.trim())if(l.content.trim())if(a)try{g(!0),p(""),N("");const{data:e,error:s}=await D.from("profiles").select("*").eq("id",a.id).single(),t={title:l.title,content:l.content,category:l.category,is_important:l.is_important,created_by:null==a?void 0:a.id};if(c){const{error:e}=await D.from("news_announcements").update({title:l.title,content:l.content,category:l.category,is_important:l.is_important,updated_at:(new Date).toISOString()}).eq("id",c.id);if(e)throw e;N("新着情報を更新しました。")}else{B("info","Attempting to insert new announcement...");const{data:e,error:s}=await D.from("news_announcements").insert([t]).select();if(B("info","Insert result:",{insertResult:e}),s)throw B("error","Insert error details:",{message:s.message,details:s.details,hint:s.hint,code:s.code}),s;N("新着情報を追加しました。")}n({title:"",content:"",category:"news",is_important:!1,image_url:"",link_url:""}),d(null),x(!1),await w(),setTimeout((()=>{N("")}),3e3)}catch(s){B("error","=== エラー詳細 ==="),B("error","Error saving news:",{error:z(s)});let e="新着情報の保存に失敗しました。";s&&"object"==typeof s&&("message"in s&&"string"==typeof s.message&&(e+=` エラー詳細: ${s.message}`),"details"in s&&"string"==typeof s.details&&(e+=` 詳細: ${s.details}`),"hint"in s&&"string"==typeof s.hint&&(e+=` ヒント: ${s.hint}`),"code"in s&&(e+=` コード: ${s.code}`)),p(e)}finally{g(!1)}else p("ユーザーが認証されていません。ログインしてください。");else p("内容を入力してください。");else p("タイトルを入力してください。")},children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx(q,{label:"タイトル *",value:l.title,onChange:e=>n({...l,title:e.target.value}),required:!0,disabled:h}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"内容 *"}),s.jsx("textarea",{value:l.content,onChange:e=>n({...l,content:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:6,required:!0,disabled:h})]}),s.jsx(U,{label:"カテゴリー *",options:[{value:"news",label:"お知らせ"},{value:"announcement",label:"重要なお知らせ"},{value:"sale",label:"セール情報"}],value:l.category,onChange:e=>n({...l,category:e.target.value}),required:!0,disabled:h}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"checkbox",id:"is_important",checked:l.is_important,onChange:e=>n({...l,is_important:e.target.checked}),className:"rounded text-blue-600",disabled:h}),s.jsx("label",{htmlFor:"is_important",className:"text-sm text-gray-700",children:"重要なお知らせとして表示する"})]})]}),s.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[s.jsx(H,{type:"button",variant:"secondary",onClick:()=>x(!1),disabled:h,children:"キャンセル"}),s.jsx(H,{type:"submit",isLoading:h,children:c?"更新する":"追加する"})]})]})]})})})]})}export{X as A,H as B,J as C,q as I,G as M,ee as N,U as S,Y as a,K as b,R as c,L as d,E as u};

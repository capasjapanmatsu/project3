var e=Object.defineProperty,s=Object.defineProperties,a=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,i=(s,a,t)=>a in s?e(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t,c=(e,s)=>{for(var a in s||(s={}))r.call(s,a)&&i(e,a,s[a]);if(t)for(var a of t(s))l.call(s,a)&&i(e,a,s[a]);return e},n=(e,t)=>s(e,a(t)),d=(e,s,a)=>new Promise(((t,r)=>{var l=e=>{try{c(a.next(e))}catch(s){r(s)}},i=e=>{try{c(a.throw(e))}catch(s){r(s)}},c=e=>e.done?t(e.value):Promise.resolve(e.value).then(l,i);c((a=a.apply(e,s)).next())}));import{u as m,s as x,j as o,C as h,B as g}from"./index.D9xag4tn.js";import{r as p}from"./router.BWT_vQps.js";import{k as j,ad as u,d as N,a7 as b,b as f,P as y,c as v,a as w,X as _,G as S}from"./ui.BPlS2KKq.js";import"./vendor.D1SiiUJb.js";import"./supabase.CZ8ekJUM.js";const P={pet_hotel:"ペットホテル",pet_salon:"ペットサロン",veterinary:"動物病院",pet_cafe:"ペットカフェ",pet_restaurant:"ペット同伴レストラン",pet_shop:"ペットショップ",pet_accommodation:"ペット同伴宿泊"};function k(){const{user:e,isAdmin:s}=m(),[a,t]=p.useState("pending"),[r,l]=p.useState([]),[i,k]=p.useState([]),[O,C]=p.useState([]),[D,$]=p.useState(!0),[z,E]=p.useState(""),[T,q]=p.useState(""),[I,J]=p.useState(!1),[L,A]=p.useState(null),[B,G]=p.useState(!1),X=e=>{E(e),q(""),setTimeout((()=>E("")),8e3)};p.useEffect((()=>{s?F():X("管理者権限が必要です")}),[s]),p.useEffect((()=>{r.length>0&&H()}),[r]);const F=()=>d(null,null,(function*(){try{$(!0),E("");const{data:e,error:s}=yield x.from("pet_facilities").select("*").order("created_at",{ascending:!1});if(s)throw s;const a=yield Promise.all((e||[]).map((e=>d(null,null,(function*(){const{data:s,error:a}=yield x.from("facility_images").select("*").eq("facility_id",e.id).order("is_primary",{ascending:!1});return n(c({},e),a?{images:[]}:{images:s||[]})})))));l(a)}catch(e){X(e instanceof Error?e.message:"データの取得に失敗しました")}finally{$(!1)}})),H=()=>{const e=r.filter((e=>"pending"===e.status)),s=r.filter((e=>"approved"===e.status));k(e),C(s)},K=s=>d(null,null,(function*(){if(window.confirm("この施設を承認してもよろしいですか？"))try{G(!0),E("");const{error:a}=yield x.from("pet_facilities").update({status:"approved",approved_at:(new Date).toISOString(),approved_by:null==e?void 0:e.id}).eq("id",s);if(a)throw a;q("施設を承認しました。"),E(""),setTimeout((()=>q("")),5e3),l((e=>e.map((e=>e.id===s?n(c({},e),{status:"approved"}):e)))),J(!1),A(null)}catch(a){X("施設の承認に失敗しました")}finally{G(!1)}})),M=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},Q=e=>{switch(e){case"pending":return"承認待ち";case"approved":return"承認済み";case"rejected":return"却下";default:return"不明"}};return s?D?o.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),o.jsx("p",{className:"text-gray-600",children:"データを読み込み中..."})]})}):o.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:o.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[o.jsxs("div",{className:"bg-white shadow rounded-lg mb-8",children:[o.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[o.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"ペット関連施設承認管理"}),o.jsx("p",{className:"text-gray-600",children:"登録されたペット関連施設の承認・却下を管理します"})]}),z&&o.jsx("div",{className:"px-6 py-4 bg-red-50 border-l-4 border-red-400",children:o.jsxs("div",{className:"flex",children:[o.jsx(j,{className:"h-5 w-5 text-red-400 mr-2"}),o.jsx("p",{className:"text-sm text-red-700",children:z})]})}),T&&o.jsx("div",{className:"px-6 py-4 bg-green-50 border-l-4 border-green-400",children:o.jsxs("div",{className:"flex",children:[o.jsx(u,{className:"h-5 w-5 text-green-400 mr-2"}),o.jsx("p",{className:"text-sm text-green-700",children:T})]})}),o.jsx("div",{className:"px-6",children:o.jsxs("nav",{className:"flex space-x-8","aria-label":"Tabs",children:[o.jsxs("button",{onClick:()=>t("pending"),className:"whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm "+("pending"===a?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[o.jsx(N,{className:"w-5 h-5 inline mr-2"}),"承認待ち",o.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:i.length})]}),o.jsxs("button",{onClick:()=>t("approved"),className:"whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm "+("approved"===a?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[o.jsx(b,{className:"w-5 h-5 inline mr-2"}),"掲載中施設",o.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:O.length})]})]})})]}),"pending"===a&&o.jsx("div",{className:"space-y-6",children:0===i.length?o.jsxs(h,{className:"text-center py-12",children:[o.jsx(N,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),o.jsx("p",{className:"text-gray-600",children:"承認待ちの施設がありません"})]}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:i.map((e=>o.jsx(h,{className:"overflow-hidden",children:o.jsxs("div",{className:"p-6",children:[o.jsx("div",{className:"flex items-start justify-between mb-4",children:o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:e.name}),o.jsx("p",{className:"text-sm text-gray-600 mb-2",children:P[e.category_id]||e.category_id}),o.jsxs("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${M(e.status)}`,children:[o.jsx(N,{className:"w-3 h-3 mr-1"}),Q(e.status)]})]})}),o.jsxs("div",{className:"space-y-2 mb-4",children:[o.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[o.jsx(f,{className:"w-4 h-4 mr-2"}),o.jsx("span",{className:"truncate",children:e.address})]}),e.phone&&o.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[o.jsx(y,{className:"w-4 h-4 mr-2"}),o.jsx("span",{children:e.phone})]}),o.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[o.jsx(v,{className:"w-4 h-4 mr-2"}),o.jsx("span",{children:new Date(e.created_at).toLocaleDateString("ja-JP")})]})]}),e.images.length>0&&o.jsxs("div",{className:"mb-4",children:[o.jsx("div",{className:"grid grid-cols-3 gap-2",children:e.images.slice(0,3).map(((e,s)=>o.jsx("img",{src:e.image_data,alt:`施設画像 ${s+1}`,className:"w-full h-16 object-cover rounded border"},e.id)))}),e.images.length>3&&o.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["+",e.images.length-3,"枚の画像"]})]}),o.jsxs("div",{className:"flex space-x-2",children:[o.jsx(g,{onClick:()=>{A(e),J(!0)},className:"flex-1",size:"sm",variant:"secondary",children:"詳細を確認"}),o.jsxs(g,{onClick:()=>K(e.id),disabled:B,className:"flex-1 bg-green-600 hover:bg-green-700",size:"sm",children:[o.jsx(w,{className:"w-4 h-4 mr-1"}),"承認"]})]})]})},e.id)))})}),"approved"===a&&o.jsx("div",{className:"space-y-6",children:0===O.length?o.jsxs(h,{className:"text-center py-12",children:[o.jsx(b,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),o.jsx("p",{className:"text-gray-600",children:"掲載中の施設がありません"})]}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:O.map((e=>o.jsx(h,{className:"overflow-hidden",children:o.jsxs("div",{className:"p-6",children:[o.jsx("div",{className:"flex items-start justify-between mb-4",children:o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:e.name}),o.jsx("p",{className:"text-sm text-gray-600 mb-2",children:P[e.category_id]||e.category_id}),o.jsxs("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${M(e.status)}`,children:[o.jsx(w,{className:"w-3 h-3 mr-1"}),Q(e.status)]})]})}),o.jsxs("div",{className:"space-y-2 mb-4",children:[o.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[o.jsx(f,{className:"w-4 h-4 mr-2"}),o.jsx("span",{className:"truncate",children:e.address})]}),e.phone&&o.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[o.jsx(y,{className:"w-4 h-4 mr-2"}),o.jsx("span",{children:e.phone})]}),o.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[o.jsx(v,{className:"w-4 h-4 mr-2"}),o.jsx("span",{children:new Date(e.created_at).toLocaleDateString("ja-JP")})]})]}),e.images.length>0&&o.jsxs("div",{className:"mb-4",children:[o.jsx("div",{className:"grid grid-cols-3 gap-2",children:e.images.slice(0,3).map(((e,s)=>o.jsx("img",{src:e.image_data,alt:`施設画像 ${s+1}`,className:"w-full h-16 object-cover rounded border"},e.id)))}),e.images.length>3&&o.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["+",e.images.length-3,"枚の画像"]})]}),o.jsx(g,{onClick:()=>{A(e),J(!0)},className:"w-full",size:"sm",variant:"secondary",children:"詳細を確認"})]})},e.id)))})}),I&&L&&o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:o.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:o.jsxs("div",{className:"p-6",children:[o.jsxs("div",{className:"flex items-start justify-between mb-6",children:[o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:L.name}),o.jsx("p",{className:"text-gray-600",children:P[L.category_id]||L.category_id})]}),o.jsx("button",{onClick:()=>J(!1),className:"text-gray-400 hover:text-gray-600",children:o.jsx(_,{className:"w-6 h-6"})})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold mb-3",children:"基本情報"}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"flex items-center",children:[o.jsx(f,{className:"w-5 h-5 text-gray-500 mr-3"}),o.jsx("span",{children:L.address})]}),L.phone&&o.jsxs("div",{className:"flex items-center",children:[o.jsx(y,{className:"w-5 h-5 text-gray-500 mr-3"}),o.jsx("span",{children:L.phone})]}),L.website&&o.jsxs("div",{className:"flex items-center",children:[o.jsx(S,{className:"w-5 h-5 text-gray-500 mr-3"}),o.jsx("a",{href:L.website,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800",children:L.website})]})]})]}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold mb-3",children:"ステータス"}),o.jsxs("div",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${M(L.status)}`,children:["pending"===L.status&&o.jsx(N,{className:"w-4 h-4 mr-2"}),"approved"===L.status&&o.jsx(w,{className:"w-4 h-4 mr-2"}),"rejected"===L.status&&o.jsx(_,{className:"w-4 h-4 mr-2"}),Q(L.status)]})]})]}),L.description&&o.jsxs("div",{className:"mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold mb-3",children:"施設紹介"}),o.jsx("p",{className:"text-gray-700 whitespace-pre-line",children:L.description})]}),L.images.length>0&&o.jsxs("div",{className:"mb-6",children:[o.jsxs("h3",{className:"text-lg font-semibold mb-3",children:["施設画像 (",L.images.length,"枚)"]}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:L.images.map(((e,s)=>o.jsxs("div",{className:"relative",children:[o.jsx("img",{src:e.image_data,alt:`施設画像 ${s+1}`,className:"w-full h-32 object-cover rounded-lg border"}),e.is_primary&&o.jsx("div",{className:"absolute top-2 left-2 bg-blue-500 text-white text-xs px-2 py-1 rounded",children:"メイン"})]},e.id)))})]}),"pending"===L.status&&o.jsx("div",{className:"flex space-x-4",children:o.jsxs(g,{onClick:()=>K(L.id),disabled:B,className:"flex-1 bg-green-600 hover:bg-green-700",children:[o.jsx(w,{className:"w-4 h-4 mr-2"}),"承認する"]})})]})})})]})}):o.jsx("div",{className:"max-w-4xl mx-auto p-4",children:o.jsx(h,{className:"p-6",children:o.jsxs("div",{className:"flex items-center justify-center",children:[o.jsx(j,{className:"w-12 h-12 text-red-500 mr-4"}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-xl font-semibold text-red-700",children:"アクセス権限がありません"}),o.jsx("p",{className:"text-red-600",children:"このページは管理者のみアクセス可能です。"})]})]})})})}export{k as default};

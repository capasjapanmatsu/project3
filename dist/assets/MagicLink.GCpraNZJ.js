/*! Build: 2025-07-17T07:59:15.523Z
Version: 0.0.0 */
import{u as e,aF as s,r as a,j as t,L as r,f as o,C as i}from"./vendor-react.D8SVeCGP.js";import{C as n,B as c}from"./components-admin.GT3qRZg5.js";import{s as m,q as l}from"./utils.C9ZsMnW6.js";import"./vendor-misc.qnLj5toF.js";import"./hooks.CTtJlocA.js";import"./vendor-stripe.B5MJ2ewd.js";import"./pages-dog.BrfoFXaJ.js";import"./vendor-supabase.RBPF72ft.js";function d(){const d=e(),x=s(),[u,h]=a.useState(!0),[p,j]=a.useState(null),[f,b]=a.useState(!1);return a.useEffect((()=>{(async()=>{var e;try{h(!0);const s=window.location.hash;if(!s||!s.includes("access_token"))return void j("無効なMagic Linkです。もう一度ログインしてください。");const a=new URLSearchParams(s.substring(1)),t=a.get("access_token"),r=a.get("refresh_token");if(!t||!r)return void j("認証トークンが見つかりません。もう一度ログインしてください。");const{error:o}=await m.auth.setSession({access_token:t,refresh_token:r});if(o)throw o;const{data:{user:i},error:n}=await m.auth.getUser();if(n||!i)throw n||new Error("ユーザー情報の取得に失敗しました");const{data:c,error:x}=await m.from("profiles").select("id").eq("id",i.id).maybeSingle();if(x&&x.code,!c){const s=i.user_metadata||{},{error:a}=await m.from("profiles").upsert([{id:i.id,user_type:s.user_type||"user",name:s.name||(null==(e=i.email)?void 0:e.split("@")[0])||"ユーザー",postal_code:s.postal_code||"",address:s.address||"",phone_number:s.phone_number||""}],{onConflict:"id"})}i&&l(`trusted_device_${i.id}`,"true"),b(!0),setTimeout((()=>{d("/dashboard")}),2e3)}catch(s){j(s.message||"マジックリンクの送信に失敗しました")}finally{h(!1)}})()}),[d,x]),u?t.jsx("div",{className:"max-w-md mx-auto",children:t.jsxs(n,{className:"text-center p-8",children:[t.jsx(r,{className:"w-12 h-12 text-blue-600 mx-auto mb-4 animate-spin"}),t.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"ログイン処理中..."}),t.jsx("p",{className:"text-gray-600",children:"Magic Linkを処理しています。しばらくお待ちください。"})]})}):p?t.jsx("div",{className:"max-w-md mx-auto",children:t.jsxs(n,{className:"text-center p-8",children:[t.jsx(o,{className:"w-12 h-12 text-red-600 mx-auto mb-4"}),t.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"エラーが発生しました"}),t.jsx("p",{className:"text-gray-600 mb-6",children:p}),t.jsx(c,{onClick:()=>d("/login"),children:"ログインページに戻る"})]})}):f?t.jsx("div",{className:"max-w-md mx-auto",children:t.jsxs(n,{className:"text-center p-8",children:[t.jsx(i,{className:"w-12 h-12 text-green-600 mx-auto mb-4"}),t.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"ログイン成功！"}),t.jsx("p",{className:"text-gray-600 mb-4",children:"Magic Linkでのログインに成功しました。ダッシュボードにリダイレクトします..."}),t.jsx(c,{onClick:()=>d("/dashboard"),children:"ダッシュボードへ"})]})}):null}export{d as MagicLink};

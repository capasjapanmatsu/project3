import{j as e,b as s,U as t,i as a,k as n,P as r,W as i,l,R as o,B as c,n as d,T as m,o as x,F as h,p as u,q as g,r as f}from"./ui-vendor-B03FHkej.js";import{r as j,L as p,R as b}from"./react-vendor-BBLDtDmh.js";import{B as w,C as N,u as y,s as v}from"./index-CWMjoAp3.js";import{l as k}from"./logger-hQPzKOcf.js";import"./query-vendor-Cy2yKKks.js";import"./supabase-vendor-BcfcqyaE.js";const D={xs:0,sm:640,md:768,lg:1024,xl:1280,"2xl":1536};function I(e){const s=j.useMemo(()=>({...D,...e}),[e]),[t,a]=j.useState({width:"undefined"!=typeof window?window.innerWidth:1024,height:"undefined"!=typeof window?window.innerHeight:768}),[n,r]=j.useState("md");j.useEffect(()=>{const e=()=>{const e=window.innerWidth;a({width:e,height:window.innerHeight}),e>=s["2xl"]?r("2xl"):e>=s.xl?r("xl"):e>=s.lg?r("lg"):e>=s.md?r("md"):e>=s.sm?r("sm"):r("xs")};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const i=e=>t.width>=s[e],l=e=>t.width<s[e],o=(e,a)=>t.width>=s[e]&&t.width<s[a],c=l("md"),d=o("md","lg"),m=i("lg"),x="ontouchstart"in window||navigator.maxTouchPoints>0,h="undefined"!=typeof window&&window.matchMedia("(prefers-reduced-motion: reduce)").matches,u="undefined"!=typeof window&&window.matchMedia("(prefers-color-scheme: dark)").matches;return{windowSize:t,currentBreakpoint:n,breakpoints:s,isAbove:i,isBelow:l,isBetween:o,isMobile:c,isTablet:d,isDesktop:m,isTouchDevice:x,prefersReducedMotion:h,prefersDarkMode:u}}const M=j.forwardRef(({children:s,animation:t="fadeIn",duration:a="normal",easing:n="ease-out",delay:r=0,repeat:i=!1,triggerOnce:l=!0,threshold:o=.1,as:c="div",respectReducedMotion:d=!0,fallbackAnimation:m="fadeIn",className:x="",...h},u)=>{const{prefersReducedMotion:g}=I(),f=d&&g,j=r>0?{animationDelay:`${r}ms`}:{},p=`${[{fadeIn:f?"opacity-100 transition-opacity":"opacity-0 animate-fade-in",slideUp:f?"transform-none transition-transform":"transform translate-y-4 animate-slide-up",slideDown:f?"transform-none transition-transform":"transform -translate-y-4 animate-slide-down",slideLeft:f?"transform-none transition-transform":"transform translate-x-4 animate-slide-left",slideRight:f?"transform-none transition-transform":"transform -translate-x-4 animate-slide-right",scale:f?"transform-none transition-transform":"transform scale-95 animate-scale-in",bounce:f?"transform-none":"animate-bounce",pulse:f?"opacity-100":"animate-pulse",spin:f?"transform-none":"animate-spin"}[f?m:t],{fast:"duration-200",normal:"duration-500",slow:"duration-1000"}[a],{linear:"ease-linear",ease:"ease","ease-in":"ease-in","ease-out":"ease-out","ease-in-out":"ease-in-out"}[n],!0===i?"animation-iteration-count-infinite":"number"==typeof i?`animation-iteration-count-${i}`:"","transition-all"].filter(Boolean).join(" ")} ${x}`.trim(),b=c;return e.jsx(b,{ref:u,className:p,style:{...j,...h.style},"aria-hidden":f?void 0:"false",...h,children:s})});M.displayName="AnimatedElement";const C=j.forwardRef((s,t)=>e.jsx(M,{ref:t,animation:"fadeIn",...s}));C.displayName="FadeIn";const E=j.forwardRef((s,t)=>e.jsx(M,{ref:t,animation:"slideUp",...s}));E.displayName="SlideUp";j.forwardRef((s,t)=>e.jsx(M,{ref:t,animation:"scale",...s})).displayName="ScaleIn";const L=({isLoggedIn:r})=>{const i=[{icon:e.jsx(s,{className:"h-12 w-12 text-blue-600 mx-auto mb-4 group-hover:scale-110 transition-transform"}),title:"簡単検索",description:"お近くのドッグランを簡単に見つけることができます",linkTo:"/parks",color:"text-blue-600"},{icon:e.jsx(t,{className:"h-12 w-12 text-purple-600 mx-auto mb-4 group-hover:scale-110 transition-transform"}),title:"コミュニティ",description:"愛犬家同士で交流を深めることができます",linkTo:r?"/community":"/login",color:"text-purple-600"},{icon:e.jsx(a,{className:"h-12 w-12 text-orange-600 mx-auto mb-4 group-hover:scale-110 transition-transform"}),title:"予約管理",description:"施設の予約をオンラインで簡単に管理",linkTo:r?"/dashboard":"/login",color:"text-orange-600"},{icon:e.jsx(n,{className:"h-12 w-12 text-green-600 mx-auto mb-4 group-hover:scale-110 transition-transform"}),title:"ペットショップ",description:"ペット用品をワンタッチで簡単注文",linkTo:"/shop",color:"text-green-600"}];return e.jsx("section",{className:"grid md:grid-cols-4 gap-8 mt-12",children:i.map((s,t)=>e.jsxs(p,{to:s.linkTo,className:"text-center p-6 hover:bg-gray-50 rounded-lg transition-colors cursor-pointer group",children:[s.icon,e.jsx("h3",{className:"text-xl font-semibold mb-2",children:s.title}),e.jsx("p",{className:"text-gray-600",children:s.description})]},t))})},R=({isLoggedIn:s})=>s?e.jsxs("section",{className:"text-center py-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"おかえりなさい！"}),e.jsx("p",{className:"text-xl text-gray-600 mb-8",children:"今日も愛犬と素敵な時間をお過ごしください"}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsx(p,{to:"/parks",className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"ドッグランを探す"}),e.jsx(p,{to:"/dashboard",className:"bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors font-medium",children:"マイページ"})]})]}):e.jsxs("section",{className:"text-center py-12",children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"愛犬とのお散歩を、もっと楽しく"}),e.jsx("p",{className:"text-xl text-gray-600 mb-8",children:"近くのドッグランを見つけて、新しい出会いを見つけましょう"}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsx(p,{to:"/register",className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"無料で始める"}),e.jsx(p,{to:"/magic-link",className:"bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition-colors font-medium",children:"Magic Linkで簡単ログイン"})]})]}),S=b.memo(({recentDogs:s,isOffline:t,isLoading:a=!1})=>{const n=j.useMemo(()=>[...s,...s],[s]),i=j.useMemo(()=>Array.isArray(s)&&s.length>0,[s]);return e.jsxs("section",{className:"bg-gray-50 p-6 rounded-lg",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx(r,{className:"w-6 h-6 text-blue-600 mr-2"}),"最近仲間入りしました！"]}),e.jsx("div",{className:"absolute -top-10 -left-16",children:e.jsx("div",{className:"bg-yellow-100 rounded-full px-4 py-2 text-yellow-800 font-bold transform -rotate-12",children:"New"})})]})}),e.jsx("div",{className:"overflow-hidden w-full relative",style:{height:140},children:a?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-gray-600",children:"新しい仲間を探しています..."})]})}):i?e.jsx("div",{className:"flex items-center whitespace-nowrap",style:{width:"max-content",animation:"marquee 45s linear infinite",willChange:"transform",transform:"translateZ(0)"},children:n.map((s,t)=>e.jsx(_,{dog:s},`${s.id}-${t}`))}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500 text-center",children:e.jsxs("div",{children:[e.jsx(r,{className:"w-12 h-12 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-lg font-medium",children:t?"オフライン中です":"新しい仲間を募集中！"}),e.jsx("p",{className:"text-sm mt-1",children:t?"接続を確認してください":"ワンちゃんの登録をお待ちしています"}),!t&&e.jsx("p",{className:"text-xs mt-2 text-gray-400",children:"登録されたワンちゃんがいません"}),e.jsxs("div",{className:"text-xs text-gray-400 mt-2",children:["Debug: dogs=",s?.length||0,", offline=",t?"true":"false",", loading=",a?"true":"false"]})]})})}),e.jsx("style",{children:"\n          @keyframes marquee {\n            0% {\n              transform: translateX(0) translateZ(0);\n            }\n            100% {\n              transform: translateX(-50%) translateZ(0);\n            }\n          }\n          \n          /* GPUアクセラレーション用の最適化 */\n          .marquee-container {\n            backface-visibility: hidden;\n            -webkit-backface-visibility: hidden;\n            -moz-backface-visibility: hidden;\n            -ms-backface-visibility: hidden;\n            -webkit-transform: translateZ(0);\n            -moz-transform: translateZ(0);\n            -ms-transform: translateZ(0);\n            transform: translateZ(0);\n          }\n        "})]})}),_=b.memo(({dog:s})=>{const[t,a]=j.useState(!1),[n,r]=j.useState(!1),i=j.useMemo(()=>s.image_url?s.image_url.includes("supabase")?`${s.image_url}?width=80&height=80&quality=80`:s.image_url:null,[s.image_url]);return j.useEffect(()=>{if(i){(new Image).src=i}},[i]),e.jsxs("div",{className:"inline-block mx-4 text-center",style:{width:100,flexShrink:0},children:[e.jsxs("div",{className:"relative w-20 h-20 mx-auto mb-2 bg-gray-200 rounded-full overflow-hidden",children:[!t&&!n&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100",children:e.jsx("div",{className:"w-4 h-4 border-2 border-gray-400 border-t-transparent rounded-full animate-spin"})}),i&&!n?e.jsx("img",{src:i,alt:s.name,className:"w-full h-full object-cover transition-opacity duration-200 "+(t?"opacity-100":"opacity-0"),onLoad:()=>{a(!0)},onError:()=>{r(!0),a(!0)},loading:"eager",decoding:"sync",width:80,height:80}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400 text-2xl",children:"🐕"})]}),e.jsx("div",{className:"text-xs text-gray-600 truncate font-medium",children:s.name}),e.jsx("div",{className:"text-xs text-gray-500 truncate",children:s.breed})]})});S.displayName="MarqueeDogsSection",_.displayName="DogCard";const O=({isOffline:s,networkError:t,onRetryConnection:a})=>t?e.jsx("div",{className:"border rounded-lg p-4 mb-6 "+(s?"bg-orange-50 border-orange-200":"bg-red-50 border-red-200"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[s?e.jsx(i,{className:"w-6 h-6 text-orange-600"}):e.jsx(l,{className:"w-6 h-6 text-red-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium "+(s?"text-orange-800":"text-red-800"),children:s?"オフラインモード":"接続エラー"}),e.jsx("p",{className:"text-sm whitespace-pre-line "+(s?"text-orange-700":"text-red-700"),children:t})]})]}),e.jsxs(w,{onClick:a,size:"sm",className:(s?"bg-orange-600 hover:bg-orange-700":"bg-red-600 hover:bg-red-700")+" text-white",children:[e.jsx(o,{className:"w-4 h-4 mr-2"}),"再接続"]})]})}):null,T=({news:s,isOffline:t,isLoading:a,onRetryConnection:n})=>{const r=s=>{switch(s){case"news":return e.jsx(h,{className:"w-4 h-4"});case"announcement":return e.jsx(x,{className:"w-4 h-4"});case"sale":return e.jsx(m,{className:"w-4 h-4"});default:return e.jsx(c,{className:"w-4 h-4"})}},l=e=>({news:"お知らせ",announcement:"重要なお知らせ",sale:"セール情報"}[e]||e),u=({message:s})=>e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx(i,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:s}),e.jsxs(w,{onClick:n,size:"sm",variant:"secondary",className:"mt-2",children:[e.jsx(o,{className:"w-4 h-4 mr-2"}),"再接続"]})]})}),g=()=>e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{children:"新着情報を読み込み中..."})]})}),f=()=>e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx(c,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"現在、表示できる新着情報はありません"}),e.jsxs(w,{onClick:n,size:"sm",variant:"secondary",className:"mt-2",children:[e.jsx(o,{className:"w-4 h-4 mr-2"}),"再読み込み"]})]})});return e.jsxs("section",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center",children:[e.jsx(c,{className:"w-5 h-5 text-blue-600 mr-2"}),"新着情報"]}),e.jsxs(p,{to:"/news",className:"text-blue-600 hover:text-blue-800 flex items-center text-sm",children:["すべて見る",e.jsx(d,{className:"w-4 h-4 ml-1"})]})]}),e.jsx("div",{className:"space-y-3",children:t?e.jsx(u,{message:"オフライン：新着情報を読み込めません"}):a?e.jsx(g,{}):0===s.length?e.jsx(f,{}):s.slice(0,2).map(s=>{return e.jsx(p,{to:`/news/${s.id}`,children:e.jsx(N,{className:"p-3 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium flex items-center ${a=s.category,{news:"bg-blue-100 text-blue-800",announcement:"bg-red-100 text-red-800",sale:"bg-green-100 text-green-800"}[a]||"bg-gray-100 text-gray-800"}`,children:[r(s.category),e.jsx("span",{className:"ml-1",children:l(s.category)})]}),s.is_important&&e.jsx("span",{className:"bg-red-100 text-red-800 px-2 py-1 rounded-full text-xs font-medium",children:"重要"})]}),e.jsx("h3",{className:"font-medium text-gray-900 mb-1",children:s.title}),s.content&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-1 mb-1",children:s.content}),e.jsx("p",{className:"text-xs text-gray-500",children:(t=s.created_at,new Date(t).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"}))})]}),e.jsx(d,{className:"w-4 h-4 text-gray-400 ml-4"})]})})},s.id);var t,a})}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx(p,{to:"/news",children:e.jsxs(w,{size:"sm",className:"bg-blue-600 hover:bg-blue-700 text-white",children:["すべての新着情報を見る",e.jsx(d,{className:"w-4 h-4 ml-2"})]})})})]})},$=()=>{const{user:s}=y();return e.jsx("section",{className:"relative overflow-hidden",children:e.jsxs("div",{className:"bg-gradient-to-r from-green-600 via-blue-600 to-purple-600 text-white p-8 rounded-xl shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-full",children:e.jsx(u,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold mb-2 flex items-center",children:[e.jsx(g,{className:"w-6 h-6 mr-2"}),"ドッグランオーナー募集中！"]}),e.jsx("p",{className:"text-lg opacity-90",children:"あなたの土地をドッグランとして活用しませんか？収益化のチャンスです"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(p,{to:s?"/park-registration-agreement":"/register",children:e.jsxs(w,{className:"bg-white hover:bg-gray-100 text-purple-700 font-bold px-6 py-3 text-lg shadow-md",children:[e.jsx(f,{className:"w-5 h-5 mr-2"}),s?"オーナー契約に進む":"オーナー登録"]})}),e.jsx("p",{className:"text-sm opacity-80 mt-2",children:"初期費用無料・サポート充実"})]})]}),e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-16 -mt-16"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white/10 rounded-full -ml-12 -mb-12"})]})})},A=()=>e.jsxs(e.Fragment,{children:[e.jsx("section",{className:"bg-blue-50 p-6 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-bold text-blue-900 mb-4",children:"ご利用前に必ずお読みください"}),e.jsx("p",{className:"text-blue-800 mb-4",children:"安全で楽しいドッグラン利用のため、利用ルールをご確認ください"}),e.jsx(p,{to:"/parks/rules",children:e.jsxs(w,{className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),"ドッグラン利用ルールを確認"]})})]})}),e.jsxs("section",{className:"bg-blue-50 p-6 rounded-lg",children:[e.jsx("h2",{className:"text-2xl font-bold text-center text-blue-900 mb-6",children:"料金体系"}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-3",children:"単発利用"}),e.jsx("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:"¥800"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"1回の利用料金"}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[e.jsx("li",{children:"• 最大3時間まで"}),e.jsx("li",{children:"• 愛犬3頭まで"}),e.jsx("li",{children:"• 全国の提携施設で利用可能"})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-500 to-blue-600 text-white p-6 rounded-lg shadow-lg transform scale-105",children:[e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"サブスクリプション"}),e.jsxs("div",{className:"text-3xl font-bold mb-2",children:["¥3,800",e.jsx("span",{className:"text-lg",children:"/月"})]}),e.jsx("p",{className:"mb-4 opacity-90",children:"使い放題プラン"}),e.jsxs("ul",{className:"text-sm space-y-1 opacity-90",children:[e.jsx("li",{children:"• 全国のドッグラン使い放題"}),e.jsx("li",{children:"• ペットショップ10%OFF"}),e.jsx("li",{children:"• 優先予約権"}),e.jsx("li",{children:"• 専用サポート"})]}),e.jsx("div",{className:"mt-4",children:e.jsx("span",{className:"bg-white text-purple-600 px-3 py-1 rounded-full text-xs font-medium",children:"おすすめ"})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-3",children:"施設貸し切り"}),e.jsx("div",{className:"text-3xl font-bold text-green-600 mb-2",children:"¥4,400"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"1時間の貸し切り料金"}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[e.jsx("li",{children:"• 完全プライベート空間"}),e.jsx("li",{children:"• 愛犬制限なし"}),e.jsx("li",{children:"• イベント・パーティーに最適"})]})]})]}),e.jsx("div",{className:"text-center mt-8",children:e.jsx(p,{to:"/register",children:e.jsx(w,{className:"bg-blue-600 hover:bg-blue-700 text-lg px-8 py-3",children:"今すぐ始める"})})})]})]});function U(){const{user:s}=y(),[t,a]=j.useState([]),[n,r]=j.useState([]),[i,l]=j.useState(!1),[o,c]=j.useState(null),[d,m]=j.useState(!0),[x,h]=j.useState(!0),{isMobile:u,prefersReducedMotion:g}=I();j.useEffect(()=>{const e=document.createElement("link");e.rel="preload",e.href="/images/hero-dogs.jpg",e.as="image",e.fetchPriority="high",document.head.appendChild(e);const s=document.createElement("link");return s.rel="preload",s.href="/fonts/inter-var.woff2",s.as="font",s.type="font/woff2",s.crossOrigin="anonymous",document.head.appendChild(s),()=>{document.head.removeChild(e),document.head.removeChild(s)}},[]),j.useEffect(()=>{const e=()=>{l(!1),c(null)},s=()=>{l(!0),c("インターネット接続が切断されました。\nオフラインモードで表示しています。")};return window.addEventListener("online",e),window.addEventListener("offline",s),navigator.onLine||s(),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",s)}},[]);const f=6e5,p=j.useMemo(()=>new Map,[]),b=j.useCallback(e=>{const s=p.get(e);return s&&Date.now()-s.timestamp<f?s.data:(s&&p.delete(e),null)},[p,f]),w=j.useCallback((e,s)=>{p.set(e,{data:s,timestamp:Date.now()});try{localStorage.setItem(`dogpark_cache_${e}`,JSON.stringify({data:s,timestamp:Date.now()}))}catch(t){}},[p]);j.useEffect(()=>{try{const e=localStorage.getItem("dogpark_cache_recentDogs");if(e){const s=JSON.parse(e);Date.now()-s.timestamp<f&&(p.set("recentDogs",s),a(s.data),m(!1),k.info("✅ ローカルストレージからキャッシュを復元:",s.data.length,"匹"))}}catch(e){}},[p,f]);const N=j.useCallback(async()=>{try{k.info("🐕 最近仲間入りしたワンちゃんを取得中...");const e=b("recentDogs");if(e)return k.info("✅ キャッシュから最近仲間入りしたワンちゃんを取得:",e.length,"匹"),a(e),m(!1),e;m(!0),c(null),k.info("🔍 データベースから直接取得...");const{data:s,error:t}=await v.from("dogs").select("id, owner_id, name, breed, birth_date, gender, image_url, created_at").order("created_at",{ascending:!1}).limit(8);if(t)return k.warn("❌ Database error:",t),a([]),m(!1),[];k.info("✅ 最近仲間入りしたワンちゃん取得成功:",s?.length||0,"匹");const n=s||[];return a(n),w("recentDogs",n),m(!1),n}catch(e){return k.warn("❌ Error fetching recent dogs:",e),a([]),m(!1),[]}},[b,w]),D=j.useCallback(async()=>{try{k.info("📰 新着情報を取得中...");const e=b("news");if(e)return k.info("✅ キャッシュから新着情報を取得:",e.length,"件"),r(e),e;h(!0);const{data:s,error:t}=await v.from("news_announcements").select("*").order("created_at",{ascending:!1}).limit(5);if(t)return k.error("❌ 新着情報取得エラー:",t),r([]),[];k.info("✅ 新着情報取得成功:",s?.length||0,"件");const a=s||[];return r(a),w("news",a),a}catch(e){return k.error("❌ 新着情報取得例外:",e),r([]),[]}finally{h(!1),k.info("📰 新着情報取得処理完了")}},[b,w]),_=j.useCallback(async()=>{k.info("🚀 高速データ取得を開始...");const e=Date.now();try{const s=new Promise((e,s)=>{setTimeout(()=>s(new Error("Timeout")),8e3)}),t=Promise.all([N(),D()]),[a,n]=await Promise.race([t,s]),r=Date.now();return k.info(`✅ 高速データ取得完了: ${r-e}ms`),{dogs:a,news:n}}catch(s){k.error("❌ データ取得エラー:",s);const e={dogs:[],news:[]};try{const s=await N();e.dogs=s}catch(t){k.warn("犬データの取得に失敗:",t)}try{const s=await D();e.news=s}catch(a){k.warn("ニュースデータの取得に失敗:",a)}return e}},[N,D]);j.useEffect(()=>{0===t.length&&0===n.length&&_()},[_,t.length,n.length]);const U=j.useCallback(async()=>{p.clear(),await _()},[_,p]),z=u?"fast":"normal",P=g?0:25,q=j.useMemo(()=>!!s,[s]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"min-h-screen bg-gray-50",role:"main",children:[e.jsx(C,{duration:"fast",children:e.jsx(O,{isOffline:i,networkError:o,onRetryConnection:U})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("section",{id:"hero-section","aria-label":"メインヒーロー",className:"focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 rounded-lg",tabIndex:-1,children:e.jsx(E,{duration:z,delay:0*P,children:e.jsx(R,{isLoggedIn:q})})}),e.jsx("section",{id:"news-section","aria-labelledby":"news-heading",className:"focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 rounded-lg",tabIndex:-1,children:e.jsxs(M,{animation:"slideUp",duration:z,delay:1*P,respectReducedMotion:!0,fallbackAnimation:"fadeIn",children:[e.jsx("h2",{id:"news-heading",className:"sr-only",children:"新着情報とお知らせ"}),e.jsx(T,{isOffline:i,onRetryConnection:U,news:n,isLoading:x})]})}),e.jsx("section",{"aria-label":"最近登録された愛犬たち",className:"focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 rounded-lg",tabIndex:-1,children:e.jsx(M,{animation:"slideUp",duration:z,delay:2*P,respectReducedMotion:!0,fallbackAnimation:"fadeIn",children:e.jsx(S,{recentDogs:t,isOffline:i,isLoading:d})})}),e.jsxs("main",{id:"main-content",className:"space-y-12 py-8",children:[e.jsx("section",{id:"features-section","aria-labelledby":"features-heading",className:"focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 rounded-lg",tabIndex:-1,children:e.jsxs(M,{animation:"slideUp",duration:z,delay:3*P,respectReducedMotion:!0,fallbackAnimation:"fadeIn",children:[e.jsx("h2",{id:"features-heading",className:"sr-only",children:"アプリの主な機能"}),e.jsx(L,{isLoggedIn:q})]})}),e.jsx(M,{animation:"slideUp",duration:z,delay:4*P,respectReducedMotion:!0,fallbackAnimation:"fadeIn",children:e.jsx($,{})}),e.jsx("section",{id:"usage-rules","aria-labelledby":"usage-heading",className:"focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 rounded-lg",tabIndex:-1,children:e.jsxs(M,{animation:"slideUp",duration:z,delay:5*P,respectReducedMotion:!0,fallbackAnimation:"fadeIn",children:[e.jsx("h2",{id:"usage-heading",className:"sr-only",children:"利用方法と料金について"}),e.jsx(A,{})]})})]})]})]}),e.jsxs("div",{"aria-live":"polite","aria-atomic":"true",className:"sr-only",id:"status-region",children:[i&&"オフラインモードです。",o&&"ネットワークエラーが発生しています。",d&&"データを読み込んでいます。"]}),e.jsx("div",{"aria-live":"assertive","aria-atomic":"true",className:"sr-only",id:"announcement-region"})]})}export{U as Home};

var e=Object.defineProperty,s=Object.defineProperties,t=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,i=(s,t,a)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,n=(e,s)=>{for(var t in s||(s={}))r.call(s,t)&&i(e,t,s[t]);if(a)for(var t of a(s))l.call(s,t)&&i(e,t,s[t]);return e},c=(e,a)=>s(e,t(a)),d=(e,s,t)=>new Promise((a,r)=>{var l=e=>{try{n(t.next(e))}catch(s){r(s)}},i=e=>{try{n(t.throw(e))}catch(s){r(s)}},n=e=>e.done?a(e.value):Promise.resolve(e.value).then(l,i);n((t=t.apply(e,s)).next())});import{u as o,j as m,B as x,s as h,C as u}from"./index.CQlxbczY.js";import{r as g}from"./vendor.CKEClKZl.js";import{c as p,u as j,L as f}from"./router.B_7Atevv.js";import{d as b,K as y,g as N,A as v,G as w,i as _,u as k,w as S,p as D,v as I,Q as C,P,C as $,R as T,b as q,U as R,$ as O,a as E,y as F,X as L,a6 as J,a7 as z}from"./ui.C72fRZ1L.js";import{I as M}from"./Input.DMWrIIWM.js";import{S as A}from"./Select.DfMWSl4f.js";import"./supabase.X3H3st79.js";function U({lockId:e,className:s="",variant:t="primary",size:a="md",label:r="ドアを開ける",showStatus:l=!0,onSuccess:i,onError:n,reservationId:c}){const{user:u}=o(),[p,j]=g.useState(!1),[f,k]=g.useState(null),[S,D]=g.useState(null),[I,C]=g.useState(!1),[P,$]=g.useState(""),T=e=>d(this,null,function*(){try{const{data:s,error:t}=yield h.from("reservations").select("\n          *,\n          dog_park:dog_parks(*),\n          dog:dogs(*)\n        ").eq("id",e).single();return t?null:s}catch(s){return null}});g.useEffect(()=>{if(S){const e=setTimeout(()=>{D(null)},3e3);return()=>clearTimeout(e)}},[S]),g.useEffect(()=>{if(f){const e=setTimeout(()=>{k(null)},5e3);return()=>clearTimeout(e)}},[f]);const q=()=>d(this,null,function*(){if(u){j(!0),k(null),D(null);try{const{data:{session:s},error:t}=yield h.auth.getSession();if(t||!(null==s?void 0:s.access_token))throw new Error("認証が必要です");let a=5,r=null;if(c){const e=yield T(c);if(e&&"whole_facility"===e.reservation_type&&(r=(e=>{var s,t;try{const a=new Date(e.date),r=e.start_time.split(":").map(Number),l=null!=(s=r[0])?s:0,i=null!=(t=r[1])?t:0;return a.setHours(l,i,0,0),new Date(a.getTime()+60*e.duration*60*1e3)}catch(a){return null}})(e),r)){const e=new Date,s=r.getTime()-e.getTime();a=Math.max(1,Math.ceil(s/6e4))}}const l=yield fetch("/functions/v1/generate-pin",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.access_token}`},body:JSON.stringify({lock_id:e,purpose:"entry",expiry_minutes:a,reservation_id:c||void 0})});if(!l.ok){const e=yield l.json();throw new Error(e.error||"PINコードの生成に失敗しました")}const{pin:n}=yield l.json();alert(`PINコード: ${n}\n\nこのPINコードをスマートロックのキーパッドに入力してください。`),D(n),i&&i()}catch(s){if(s.message&&s.message.startsWith("PAYMENT_REQUIRED:")){const e=s.message.replace("PAYMENT_REQUIRED:","").trim();$(e),C(!0),k(null)}else k(s.message||"PINコードの生成に失敗しました"),C(!1);n&&n(s.message||"PINコードの生成に失敗しました")}finally{j(!1)}}});return m.jsxs("div",{className:"space-y-2",children:[m.jsxs(x,{onClick:()=>{q()},isLoading:p,variant:t,size:a,className:`flex items-center ${s}`,children:[p?m.jsx(b,{className:"w-4 h-4 mr-2 animate-spin"}):m.jsx(y,{className:"w-4 h-4 mr-2"}),r]}),l&&m.jsxs(m.Fragment,{children:[S&&m.jsxs("div",{className:"flex items-center text-green-600 text-sm mt-1",children:[m.jsx(N,{className:"w-4 h-4 mr-1"}),m.jsx("span",{children:"PINコードを生成しました"})]}),f&&m.jsxs("div",{className:"flex items-center text-red-600 text-sm mt-1",children:[m.jsx(v,{className:"w-4 h-4 mr-1"}),m.jsx("span",{children:f})]}),I&&m.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg border border-blue-200 mt-2",children:[m.jsxs("div",{className:"flex items-start space-x-2 mb-3",children:[m.jsx(w,{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),m.jsxs("div",{children:[m.jsx("h4",{className:"font-medium text-blue-900 mb-1",children:"決済が必要です"}),m.jsx("p",{className:"text-sm text-blue-800",children:P})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs(x,{onClick:()=>window.location.href="/subscription",size:"sm",className:"w-full bg-purple-600 hover:bg-purple-700",children:[m.jsx(w,{className:"w-3 h-3 mr-1"}),"サブスク加入"]}),m.jsxs(x,{onClick:()=>window.location.href="/parks",size:"sm",variant:"secondary",className:"w-full",children:[m.jsx(_,{className:"w-3 h-3 mr-1"}),"1日券購入"]})]})]})]})]})}function K({park:e,parkImages:s,todayRentals:t,onImageClick:a}){const r=function(e,s){const t=e/s*100;return t<25?{text:"空いています",color:"text-green-600 bg-green-100"}:t<50?{text:"やや空いています",color:"text-blue-600 bg-blue-100"}:t<75?{text:"やや混んでいます",color:"text-yellow-600 bg-yellow-100"}:{text:"混んでいます",color:"text-red-600 bg-red-100"}}(e.current_occupancy,e.max_capacity);return m.jsx(m.Fragment,{children:s.length>0&&m.jsxs("div",{className:"relative h-64 rounded-lg overflow-hidden",children:[m.jsx("img",{src:s[0].url,alt:e.name,className:"w-full h-full object-cover cursor-pointer",onClick:()=>a(0),onError:e=>{e.currentTarget.src="https://images.pexels.com/photos/1108099/pexels-photo-1108099.jpeg"}}),m.jsx("div",{className:"absolute top-4 right-4",children:m.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${r.color}`,children:r.text})}),t.length>0&&m.jsx("div",{className:"absolute top-4 left-4",children:m.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-orange-500 text-white",children:"本日貸し切りあり"})})]})})}function Q({parkImages:e,onImageClick:s}){return e.length<=1?null:m.jsxs("div",{className:"grid grid-cols-5 gap-2",children:[e.slice(1,6).map((e,t)=>m.jsx("div",{className:"h-20 rounded-lg overflow-hidden cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>s(t+1),children:m.jsx("img",{src:e.url,alt:e.caption||`画像 ${t+2}`,className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://images.pexels.com/photos/1108099/pexels-photo-1108099.jpeg"}})},e.id)),e.length>6&&m.jsxs("div",{className:"h-20 rounded-lg overflow-hidden cursor-pointer relative bg-gray-200 flex items-center justify-center",onClick:()=>s(6),children:[m.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:m.jsxs("span",{className:"text-white font-medium",children:["+",e.length-6]})}),m.jsx("img",{src:e[6].url,alt:"その他の画像",className:"w-full h-full object-cover opacity-60"})]})]})}function B({park:e}){return m.jsxs(u,{className:"p-6",children:[m.jsx("h2",{className:"text-xl font-semibold mb-4",children:"設備・サービス"}),m.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:Object.entries({parking:"駐車場",shower:"シャワー設備",restroom:"トイレ",agility:"アジリティ設備",rest_area:"休憩スペース",water_station:"給水設備"}).map(([s,t])=>m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx("div",{className:"w-4 h-4 rounded "+(e.facilities[s]?"bg-green-500":"bg-gray-300")}),m.jsx("span",{className:"text-sm",children:t})]},s))}),e.facility_details&&m.jsx("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:m.jsx("p",{className:"text-sm text-gray-700",children:e.facility_details})})]})}function G({park:e,reviews:s,userReview:t,canReview:a,user:r,userDogs:l,showReviewForm:i,setShowReviewForm:d,reviewFormData:o,setReviewFormData:h,isSubmitting:g,handleReviewSubmit:p,handleDeleteReview:j}){return m.jsxs(u,{className:"p-6",children:[m.jsxs("div",{className:"flex justify-between items-center mb-6",children:[m.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[m.jsx(k,{className:"w-6 h-6 mr-2"}),"レビュー (",e.review_count,")"]}),r&&a&&m.jsx(x,{onClick:()=>d(!i),variant:t?"secondary":"primary",size:"sm",children:t?m.jsxs(m.Fragment,{children:[m.jsx(S,{className:"w-4 h-4 mr-2"}),"レビューを編集"]}):m.jsxs(m.Fragment,{children:[m.jsx(D,{className:"w-4 h-4 mr-2"}),"レビューを書く"]})})]}),i&&m.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[m.jsx("h3",{className:"font-semibold text-blue-900 mb-4",children:t?"レビューを編集":"レビューを投稿"}),m.jsxs("form",{onSubmit:p,className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"評価 *"}),m.jsxs("div",{className:"flex items-center space-x-2",children:[[1,2,3,4,5].map(e=>m.jsx("button",{type:"button",onClick:()=>h(c(n({},o),{rating:e})),className:"focus:outline-none",children:m.jsx(I,{className:`w-8 h-8 ${e<=o.rating?"text-yellow-400 fill-current":"text-gray-300 hover:text-yellow-300"} transition-colors`})},e)),m.jsxs("span",{className:"ml-2 text-sm text-gray-600",children:[o.rating,"つ星"]})]})]}),m.jsx(A,{label:"レビューするワンちゃん *",options:l.map(e=>({value:e.id,label:e.name})),value:o.dog_id,onChange:e=>h(c(n({},o),{dog_id:e.target.value})),required:!0}),m.jsx(M,{label:"訪問日 *",type:"date",value:o.visit_date,onChange:e=>h(c(n({},o),{visit_date:e.target.value})),max:(new Date).toISOString().split("T")[0],required:!0}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"レビュー内容"}),m.jsx("textarea",{value:o.review_text,onChange:e=>h(c(n({},o),{review_text:e.target.value})),placeholder:"ドッグランの感想をお聞かせください...",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),m.jsxs("div",{className:"flex justify-between",children:[m.jsxs("div",{className:"flex space-x-2",children:[m.jsx(x,{type:"button",variant:"secondary",onClick:()=>d(!1),children:"キャンセル"}),t&&m.jsxs(x,{type:"button",onClick:j,className:"bg-red-600 hover:bg-red-700",children:[m.jsx(C,{className:"w-4 h-4 mr-2"}),"削除"]})]}),m.jsx(x,{type:"submit",isLoading:g,disabled:!o.dog_id||!o.visit_date,children:t?"更新する":"投稿する"})]})]})]}),0===s.length?m.jsxs("div",{className:"text-center py-8",children:[m.jsx(k,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),m.jsx("p",{className:"text-gray-600",children:"まだレビューがありません"}),r&&a&&m.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"最初のレビューを投稿してみませんか？"})]}):m.jsx("div",{className:"space-y-6",children:s.map(e=>m.jsx("div",{className:"border-b border-gray-200 pb-6 last:border-b-0",children:m.jsxs("div",{className:"flex items-start space-x-4",children:[m.jsx("div",{className:"flex-shrink-0",children:m.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center overflow-hidden",children:e.dog_image_url?m.jsx("img",{src:e.dog_image_url,alt:e.dog_name,className:"w-full h-full object-cover"}):m.jsx(P,{className:"w-6 h-6 text-gray-500"})})}),m.jsxs("div",{className:"flex-1",children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx("h4",{className:"font-semibold text-gray-900",children:e.user_name}),m.jsx("span",{className:"text-sm text-gray-500",children:"と"}),m.jsxs("span",{className:"font-medium text-blue-600",children:[e.dog_name,"ちゃん"]}),m.jsxs("span",{className:"text-xs text-gray-400",children:["(",e.dog_breed,")"]})]}),m.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[m.jsx("div",{className:"flex items-center space-x-1",children:[1,2,3,4,5].map(s=>m.jsx(I,{className:"w-4 h-4 "+(s<=e.rating?"text-yellow-400 fill-current":"text-gray-300")},s))}),m.jsxs("span",{className:"text-sm text-gray-600",children:[new Date(e.visit_date).toLocaleDateString("ja-JP")," に訪問"]})]})]}),m.jsx("span",{className:"text-xs text-gray-400",children:new Date(e.created_at).toLocaleDateString("ja-JP")})]}),e.review_text&&m.jsx("p",{className:"text-gray-700 leading-relaxed mb-3",children:e.review_text}),e.review_images&&e.review_images.length>0&&m.jsx("div",{className:"mt-3",children:m.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:e.review_images.map((e,s)=>m.jsxs("div",{className:"relative group cursor-pointer",children:[m.jsx("img",{src:e.url,alt:e.caption||`レビュー画像 ${s+1}`,className:"w-full h-24 object-cover rounded-lg border border-gray-200 hover:opacity-90 transition-opacity",onClick:()=>window.open(e.url,"_blank")}),e.caption&&m.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white text-xs p-1 rounded-b-lg opacity-0 group-hover:opacity-100 transition-opacity",children:e.caption})]},s))})}),e.main_image_url&&(!e.review_images||0===e.review_images.length)&&m.jsx("div",{className:"mt-3",children:m.jsx("img",{src:e.main_image_url,alt:"レビュー画像",className:"w-full max-w-md h-48 object-cover rounded-lg border border-gray-200 cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>window.open(e.main_image_url,"_blank")})})]})]})},e.id))}),r&&!a&&m.jsx("div",{className:"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:m.jsx("p",{className:"text-sm text-yellow-800",children:"レビューを投稿するには、このドッグランを実際に利用する必要があります。"})})]})}function Y({rentalInfo:e}){return m.jsx(u,{className:"p-6 bg-orange-50 border-orange-200",children:m.jsxs("div",{className:"flex items-start space-x-3",children:[m.jsx(v,{className:"w-6 h-6 text-orange-600 mt-1 flex-shrink-0"}),m.jsxs("div",{children:[m.jsx("h2",{className:"text-xl font-semibold text-orange-900 mb-3",children:"施設貸し切り予約あり"}),m.jsx("p",{className:"text-sm text-orange-800 mb-4",children:"以下の日時は施設貸し切りのため、通常利用（1日券・サブスク）での入場はできません。"}),m.jsx("div",{className:"space-y-4",children:e.map((e,s)=>m.jsxs("div",{className:"bg-white p-3 rounded-lg border border-orange-200",children:[m.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[m.jsx(_,{className:"w-5 h-5 text-orange-600"}),m.jsx("span",{className:"font-medium text-orange-900",children:new Date(e.date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric",weekday:"long"})})]}),m.jsx("div",{className:"space-y-1",children:e.slots.map((e,s)=>m.jsxs("div",{className:"flex items-center text-sm text-orange-800",children:[m.jsx($,{className:"w-4 h-4 mr-2"}),m.jsxs("span",{children:[e.start," 〜 ",e.end]})]},s))})]},s))})]})]})})}function H(){const{parkId:e}=p(),{user:s}=o(),t=j(),[a,r]=g.useState(null),[l,i]=g.useState([]),[n,c]=g.useState(null),[b,w]=g.useState([]),[_,k]=g.useState(!1),[S,D]=g.useState(!0),[C,P]=g.useState(!1),[M,A]=g.useState(!1),[H,V]=g.useState([]),[X,Z]=g.useState([]),[ee,se]=g.useState(null),[te,ae]=g.useState({rating:5,review_text:"",visit_date:"",dog_id:""}),[re,le]=g.useState([]),[ie,ne]=g.useState(!1),[ce,de]=g.useState(0),[oe,me]=g.useState([]),[xe,he]=g.useState(!1),[ue,ge]=g.useState(!1),[pe,je]=g.useState(new Date),[fe,be]=g.useState(null),[ye,Ne]=g.useState([]),[ve,we]=g.useState(null);g.useEffect(()=>{e&&_e()},[e,s]);const _e=()=>d(this,null,function*(){try{const{data:a,error:l}=yield h.from("dog_parks").select("*").eq("id",e).eq("status","approved").single();if(l)return void t("/parks");r(a);const{data:n,error:d}=yield h.from("dog_park_images").select("*").eq("park_id",e).order("display_order",{ascending:!0});if(!d&&n){const e=[];a.image_url&&e.push({id:"main",url:a.image_url,caption:`${a.name} - メイン画像`}),a.cover_image_url&&e.push({id:"cover",url:a.cover_image_url,caption:`${a.name} - カバー画像`}),n.forEach(s=>{e.push({id:s.id,url:s.image_url,caption:s.caption||`${a.name} - 施設画像`})}),le(e)}const{data:o,error:m}=yield h.rpc("get_park_reviews",{park_id_param:e});m||i(o||[]);const{data:x,error:u}=yield h.from("reservations").select("*").eq("park_id",e).eq("reservation_type","whole_facility").eq("status","confirmed").gte("date",(new Date).toISOString().split("T")[0]);if(u);else{V(x||[]);const e=(new Date).toISOString().split("T")[0],s=(null==x?void 0:x.filter(s=>s.date===e))||[];Z(s)}const{data:g,error:p}=yield h.from("smart_locks").select("id, lock_id, lock_name, park_id").eq("park_id",e).eq("status","active");if(p||me(g||[]),s){const{data:t,error:a}=yield h.from("dogs").select("\n            *,\n            vaccine_certifications!inner(*)\n          ").eq("owner_id",s.id).eq("vaccine_certifications.status","approved");a||w(t||[]);const{data:r,error:l}=yield h.rpc("can_user_review_park",{user_id_param:s.id,park_id_param:e});l||k(r);const{data:i,error:n}=yield h.rpc("get_user_park_review",{user_id_param:s.id,park_id_param:e});if(!n&&i&&i.length>0&&(c(i[0]),ae({rating:i[0].rating,review_text:i[0].review_text||"",visit_date:i[0].visit_date,dog_id:i[0].dog_id})),oe.length>0){const{data:e,error:t}=yield h.rpc("check_user_park_access",{p_user_id:s.id,p_lock_id:oe[0].lock_id});!t&&e&&e.has_access&&he(!0)}const d=(new Date).toISOString().split("T")[0],{data:o,error:m}=yield h.from("reservations").select("\n            *,\n            dog_park:dog_parks(*),\n            dog:dogs(*)\n          ").eq("park_id",e).eq("user_id",s.id).eq("status","confirmed").eq("date",d).order("start_time",{ascending:!0}).limit(1).single();!m&&o&&se(o)}const{data:j,error:f}=yield h.from("park_maintenance").select("*").eq("park_id",e).in("status",["scheduled","active"]).gte("end_date",(new Date).toISOString()).order("start_date",{ascending:!0});if(!f&&j){Ne(j);const e=new Date,s=j.find(s=>{const t=new Date(s.start_date),a=new Date(s.end_date);return t<=e&&a>e});we(s||null)}}catch(a){be(a.message||"エラーが発生しました"),t("/parks")}finally{D(!1)}}),ke=e=>{de(e),ne(!0)},Se=()=>{alert("PINコードを生成しました！")},De=e=>{alert(`PINコードの生成に失敗しました: ${e}`)},Ie=()=>d(this,null,function*(){if(e)try{ge(!0);const{data:s,error:t}=yield h.from("dog_parks").select("*").eq("id",e).single();if(t)return;r(s),je(new Date)}catch(s){}finally{ge(!1)}});if(S)return m.jsx("div",{className:"flex justify-center items-center h-64",children:m.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})});if(!a)return m.jsxs("div",{className:"text-center py-12",children:[m.jsx("p",{className:"text-gray-600",children:"ドッグランが見つかりませんでした"}),m.jsx(x,{onClick:()=>t("/parks"),className:"mt-4",children:"ドッグラン一覧に戻る"})]});const Ce=(()=>{if(0===H.length)return[];const e={};return H.forEach(s=>{const t=s.date;e[t]||(e[t]={date:t,slots:[]});const a=parseInt(s.start_time),r=a+s.duration;e[t].slots.push({start:`${a.toString().padStart(2,"0")}:00`,end:`${r.toString().padStart(2,"0")}:00`})}),Object.values(e).sort((e,s)=>new Date(e.date).getTime()-new Date(s.date).getTime())})();return m.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[fe&&m.jsx("div",{className:"mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:fe}),a&&m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"flex justify-between items-start mb-6",children:[m.jsxs("div",{children:[m.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:a.name}),m.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[m.jsx("span",{children:a.address}),m.jsx("span",{children:"•"}),m.jsxs("span",{children:["¥",a.price,"/日"]})]})]}),m.jsxs("div",{className:"flex items-center space-x-3",children:[m.jsxs("div",{className:"text-sm text-gray-600",children:["最終更新: ",pe.toLocaleTimeString("ja-JP")]}),m.jsxs("button",{onClick:()=>{Ie()},disabled:ue,className:"flex items-center space-x-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors "+(ue?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-100 text-blue-700 hover:bg-blue-200"),children:[m.jsx(T,{className:"w-4 h-4 "+(ue?"animate-spin":"")}),m.jsx("span",{children:ue?"更新中...":"更新"})]})]})]}),m.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[m.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[m.jsx(K,{park:a,parkImages:re,todayRentals:X,onImageClick:ke}),m.jsx(Q,{parkImages:re,onImageClick:ke}),m.jsxs(u,{className:"p-6",children:[m.jsxs("div",{className:"flex justify-between items-start mb-4",children:[m.jsxs("div",{children:[m.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:a.name}),m.jsx("div",{className:"flex items-center space-x-4 mb-4",children:m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx("div",{className:"flex items-center space-x-1",children:[1,2,3,4,5].map(e=>m.jsx(I,{className:"w-5 h-5 "+(e<=Math.round(a.average_rating)?"text-yellow-400 fill-current":"text-gray-300")},e))}),m.jsx("span",{className:"text-lg font-semibold text-gray-900",children:a.average_rating.toFixed(1)}),m.jsxs("span",{className:"text-sm text-gray-600",children:["(",a.review_count,"件のレビュー)"]})]})})]}),ve?m.jsx(x,{className:"bg-gray-400 cursor-not-allowed",disabled:!0,title:"メンテナンス中のため予約できません",children:"予約不可"}):m.jsx(f,{to:`/parks/${a.id}/reserve`,children:m.jsx(x,{className:"bg-blue-600 hover:bg-blue-700",children:"予約する"})})]}),m.jsx("p",{className:"text-gray-700 mb-6",children:a.description}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{className:"flex items-center text-gray-600",children:[m.jsx(q,{className:"w-5 h-5 mr-3"}),m.jsx("span",{children:a.address})]}),m.jsxs("div",{className:"flex items-center text-gray-600",children:[m.jsx(R,{className:"w-5 h-5 mr-3"}),m.jsxs("span",{children:["現在の利用者: ",a.current_occupancy,"/",a.max_capacity,"人"]})]}),m.jsxs("div",{className:"flex items-center text-gray-600",children:[m.jsx(O,{className:"w-5 h-5 mr-3"}),m.jsxs("span",{children:["料金: ¥",a.price,"/日"]})]})]}),m.jsxs("div",{className:"space-y-3",children:[a.large_dog_area&&m.jsxs("div",{className:"flex items-center text-blue-600",children:[m.jsx(E,{className:"w-5 h-5 mr-3"}),m.jsx("span",{children:"大型犬OK"})]}),a.small_dog_area&&m.jsxs("div",{className:"flex items-center text-pink-600",children:[m.jsx(F,{className:"w-5 h-5 mr-3"}),m.jsx("span",{children:"小型犬OK"})]}),a.private_booths&&m.jsxs("div",{className:"flex items-center text-purple-600",children:[m.jsx(N,{className:"w-5 h-5 mr-3"}),m.jsxs("span",{children:["プライベートブース ",a.private_booth_count,"室"]})]})]})]})]}),(ve||ye.length>0)&&m.jsxs(u,{className:"p-6",children:[m.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[m.jsx(v,{className:"w-6 h-6 text-yellow-600 mr-2"}),"メンテナンス情報"]}),ve&&m.jsxs("div",{className:`mb-4 p-4 rounded-lg ${ve.is_emergency?"bg-red-50 border-red-200":"bg-yellow-50 border-yellow-200"} border`,children:[m.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[m.jsx(v,{className:"w-5 h-5 "+(ve.is_emergency?"text-red-600":"text-yellow-600")}),m.jsx("span",{className:"text-lg font-semibold "+(ve.is_emergency?"text-red-800":"text-yellow-800"),children:ve.is_emergency?"緊急メンテナンス中":"メンテナンス中"})]}),m.jsx("p",{className:`text-lg font-medium ${ve.is_emergency?"text-red-700":"text-yellow-700"} mb-2`,children:ve.title}),ve.description&&m.jsx("p",{className:`text-sm ${ve.is_emergency?"text-red-600":"text-yellow-600"} mb-3`,children:ve.description}),m.jsx("div",{className:"flex items-center space-x-4 text-sm",children:m.jsxs("div",{className:"flex items-center space-x-1",children:[m.jsx($,{className:"w-4 h-4 "+(ve.is_emergency?"text-red-600":"text-yellow-600")}),m.jsxs("span",{className:"font-medium "+(ve.is_emergency?"text-red-700":"text-yellow-700"),children:[new Date(ve.start_date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})," ",new Date(ve.start_date).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"}),"〜",new Date(ve.end_date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})," ",new Date(ve.end_date).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"})]})]})}),m.jsx("p",{className:`text-sm ${ve.is_emergency?"text-red-600":"text-yellow-600"} mt-3 font-medium`,children:"※メンテナンス期間中は休業となります"})]}),ye.length>0&&m.jsxs("div",{children:[m.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"今後のメンテナンス予定"}),m.jsx("div",{className:"space-y-3",children:ye.filter(e=>"scheduled"===e.status&&new Date(e.start_date)>new Date).slice(0,3).map((e,s)=>m.jsx("div",{className:"p-3 bg-gray-50 rounded-lg",children:m.jsx("div",{className:"flex items-start justify-between",children:m.jsxs("div",{className:"flex-1",children:[m.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[m.jsx($,{className:"w-4 h-4 text-gray-600"}),m.jsx("span",{className:"font-medium text-gray-900",children:e.title}),e.is_emergency&&m.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full",children:"緊急"})]}),m.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[new Date(e.start_date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})," ",new Date(e.start_date).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"}),"〜",new Date(e.end_date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})," ",new Date(e.end_date).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"})]}),e.description&&m.jsx("p",{className:"text-sm text-gray-500",children:e.description})]})})},s))})]})]}),oe.length>0&&xe&&m.jsxs(u,{className:"p-6 bg-blue-50 border-blue-200",children:[m.jsxs("div",{className:"flex items-start space-x-3 mb-4",children:[m.jsx(y,{className:"w-6 h-6 text-blue-600 mt-1 flex-shrink-0"}),m.jsxs("div",{children:[m.jsx("h2",{className:"text-xl font-semibold text-blue-900 mb-2",children:"入口ドアの開錠"}),m.jsx("p",{className:"text-sm text-blue-800 mb-4",children:"PINコードを生成して入口のスマートロックを開錠できます。"})]})]}),m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:oe.map(e=>m.jsx(U,{lockId:e.lock_id,label:`${e.lock_name}のPINコードを生成`,className:"w-full",onSuccess:Se,onError:De,reservationId:null==ee?void 0:ee.id},e.id))})]}),X.length>0&&m.jsx(u,{className:"p-6 bg-orange-50 border-orange-200",children:m.jsxs("div",{className:"flex items-start space-x-3",children:[m.jsx(v,{className:"w-6 h-6 text-orange-600 mt-1 flex-shrink-0"}),m.jsxs("div",{children:[m.jsx("h2",{className:"text-xl font-semibold text-orange-900 mb-3",children:"本日の貸し切り時間"}),m.jsx("p",{className:"text-sm text-orange-800 mb-4",children:"以下の時間帯は施設貸し切りのため、通常利用（1日券・サブスク）での入場はできません。"}),m.jsx("div",{className:"space-y-3",children:X.map((e,s)=>{const t=parseInt(e.start_time),a=t+e.duration;return m.jsx("div",{className:"bg-white p-3 rounded-lg border border-orange-200",children:m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx($,{className:"w-5 h-5 text-orange-600"}),m.jsxs("span",{className:"font-medium text-orange-900",children:[t,":00 〜 ",a,":00"]})]})},s)})})]})]})}),Ce.length>0&&m.jsx(Y,{rentalInfo:Ce}),m.jsx(B,{park:a}),m.jsx(G,{park:a,reviews:l,userReview:n,canReview:_,user:s,userDogs:b,showReviewForm:C,setShowReviewForm:P,reviewFormData:te,setReviewFormData:ae,isSubmitting:M,handleReviewSubmit:t=>d(this,null,function*(){if(t.preventDefault(),s&&a){A(!0);try{if(n){const{error:e}=yield h.from("dog_park_reviews").update({rating:te.rating,review_text:te.review_text,visit_date:te.visit_date,dog_id:te.dog_id,updated_at:(new Date).toISOString()}).eq("id",n.id);if(e)throw e}else{const{error:t}=yield h.from("dog_park_reviews").insert([{park_id:e,user_id:s.id,dog_id:te.dog_id,rating:te.rating,review_text:te.review_text,visit_date:te.visit_date}]);if(t)throw t}yield _e(),P(!1),alert(n?"レビューを更新しました！":"レビューを投稿しました！")}catch(r){alert("レビューの投稿に失敗しました。もう一度お試しください。")}finally{A(!1)}}}),handleDeleteReview:()=>d(this,null,function*(){if(n&&confirm("レビューを削除しますか？"))try{const{error:e}=yield h.from("dog_park_reviews").delete().eq("id",n.id);if(e)throw e;yield _e(),c(null),ae({rating:5,review_text:"",visit_date:"",dog_id:""}),alert("レビューを削除しました。")}catch(e){alert("レビューの削除に失敗しました。")}})})]}),m.jsxs("div",{className:"space-y-6",children:[m.jsx(u,{className:"p-4",children:m.jsx(f,{to:`/parks/${a.id}/reserve`,children:m.jsx(x,{className:"w-full bg-blue-600 hover:bg-blue-700 text-lg py-3",children:"予約する"})})}),oe.length>0&&xe&&m.jsxs(u,{className:"p-4 bg-blue-50 border-blue-200",children:[m.jsxs("h3",{className:"font-semibold text-blue-900 mb-3 flex items-center",children:[m.jsx(y,{className:"w-5 h-5 text-blue-600 mr-2"}),"入口ドアを開ける"]}),m.jsx("div",{className:"space-y-3",children:oe.map(e=>m.jsx(U,{lockId:e.lock_id,label:`${e.lock_name}のPINコードを生成`,className:"w-full",onSuccess:Se,onError:De,reservationId:null==ee?void 0:ee.id},e.id))})]}),m.jsxs(u,{className:"p-4",children:[m.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"料金情報"}),m.jsxs("div",{className:"space-y-2 text-sm",children:[m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{children:"通常利用"}),m.jsxs("span",{className:"font-medium",children:["¥",a.price,"/日"]})]}),a.private_booths&&m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{children:"プライベートブース"}),m.jsx("span",{className:"font-medium text-green-600",children:"追加料金なし"})]}),m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{children:"施設貸し切り"}),m.jsx("span",{className:"font-medium",children:"¥4,400/時間"})]}),m.jsxs("div",{className:"flex justify-between",children:[m.jsx("span",{children:"サブスクリプション"}),m.jsx("span",{className:"font-medium",children:"¥3,800/月"})]})]})]}),m.jsxs(u,{className:"p-4",children:[m.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"現在の状況"}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("span",{className:"text-sm",children:"利用者数"}),m.jsxs("span",{className:"font-medium",children:[a.current_occupancy,"/",a.max_capacity,"人"]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex justify-between text-xs text-gray-600",children:[m.jsxs("span",{children:[a.current_occupancy,"人"]}),m.jsxs("span",{children:[Math.round(a.current_occupancy/a.max_capacity*100),"%"]}),m.jsxs("span",{children:[a.max_capacity,"人"]})]}),m.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:m.jsx("div",{className:`h-3 rounded-full transition-all duration-300 ${W(a.current_occupancy,a.max_capacity).barColor}`,style:{width:a.current_occupancy/a.max_capacity*100+"%"}})})]}),m.jsxs("div",{className:"text-center",children:[m.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-medium flex items-center justify-center space-x-1 ${W(a.current_occupancy,a.max_capacity).color}`,children:[m.jsx("span",{children:W(a.current_occupancy,a.max_capacity).emoji}),m.jsx("span",{children:W(a.current_occupancy,a.max_capacity).text})]}),m.jsx("p",{className:"text-xs text-gray-600 mt-1",children:W(a.current_occupancy,a.max_capacity).description})]}),m.jsxs("div",{className:"flex items-center justify-center space-x-2 text-xs text-gray-500",children:[m.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),m.jsx("span",{children:"リアルタイム更新中"})]})]})]}),m.jsxs(u,{className:"p-4",children:[m.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"評価"}),m.jsxs("div",{className:"text-center mb-4",children:[m.jsx("div",{className:"text-3xl font-bold text-gray-900 mb-1",children:a.average_rating.toFixed(1)}),m.jsx("div",{className:"flex items-center justify-center space-x-1",children:[1,2,3,4,5].map(e=>m.jsx(I,{className:"w-6 h-6 "+(e<=Math.round(a.average_rating)?"text-yellow-400 fill-current":"text-gray-300")},e))}),m.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:[a.review_count,"件のレビュー"]})]}),a.review_count>0&&m.jsx("div",{className:"space-y-2",children:[5,4,3,2,1].map(e=>{const s=l.filter(s=>s.rating===e).length,t=a.review_count>0?s/a.review_count*100:0;return m.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[m.jsx("span",{className:"w-3",children:e}),m.jsx(I,{className:"w-3 h-3 text-yellow-400 fill-current"}),m.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:m.jsx("div",{className:"bg-yellow-400 h-2 rounded-full",style:{width:`${t}%`}})}),m.jsx("span",{className:"w-8 text-right",children:s})]},e)})})]}),m.jsxs(u,{className:"p-4",children:[m.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"アクセス"}),m.jsxs("div",{className:"text-sm text-gray-700 space-y-2",children:[m.jsxs("div",{className:"flex items-start space-x-2",children:[m.jsx(q,{className:"w-4 h-4 text-gray-500 mt-0.5 flex-shrink-0"}),m.jsx("span",{children:a.address})]}),m.jsx("div",{className:"mt-3",children:m.jsx(x,{variant:"secondary",size:"sm",className:"w-full",onClick:()=>{const e=encodeURIComponent(a.address);window.open(`https://maps.google.com/maps?q=${e}`,"_blank")},children:"Google Mapsで開く"})})]})]})]})]}),ie&&re.length>0&&m.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4",children:m.jsxs("div",{className:"relative w-full max-w-4xl",children:[m.jsx("button",{onClick:()=>{ne(!1)},className:"absolute top-4 right-4 text-gray-800 bg-white bg-opacity-90 shadow-lg rounded-full p-2 hover:bg-opacity-100 transition-all z-10",children:m.jsx(L,{className:"w-6 h-6"})}),m.jsx("button",{onClick:()=>{de(e=>(e-1+re.length)%re.length)},className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-800 bg-white bg-opacity-90 shadow-lg rounded-full p-2 hover:bg-opacity-100 transition-all z-10",children:m.jsx(J,{className:"w-6 h-6"})}),m.jsx("button",{onClick:()=>{de(e=>(e+1)%re.length)},className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-800 bg-white bg-opacity-90 shadow-lg rounded-full p-2 hover:bg-opacity-100 transition-all z-10",children:m.jsx(z,{className:"w-6 h-6"})}),m.jsx("div",{className:"flex items-center justify-center h-[80vh]",children:m.jsx("img",{src:re[ce].url,alt:re[ce].caption||`${a.name} - 画像 ${ce+1}`,className:"max-h-full max-w-full object-contain"})}),m.jsxs("div",{className:"absolute bottom-4 left-0 right-0 text-center text-white",children:[m.jsx("p",{className:"text-sm mb-2",children:re[ce].caption}),m.jsxs("p",{className:"text-xs",children:[ce+1," / ",re.length]})]})]})})]})]})}const W=(e,s)=>{const t=e/s*100;return t<25?{text:"空いています",color:"text-green-600 bg-green-100",barColor:"bg-green-500",description:"快適に利用できます",emoji:"😊"}:t<50?{text:"やや空いています",color:"text-blue-600 bg-blue-100",barColor:"bg-blue-500",description:"適度な混雑です",emoji:"🙂"}:t<75?{text:"やや混んでいます",color:"text-yellow-600 bg-yellow-100",barColor:"bg-yellow-500",description:"少し混雑しています",emoji:"😐"}:{text:"混んでいます",color:"text-red-600 bg-red-100",barColor:"bg-red-500",description:"大変混雑しています",emoji:"😰"}};export{H as DogParkDetail};

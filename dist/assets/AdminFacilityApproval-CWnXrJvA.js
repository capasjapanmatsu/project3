import{j as e,l as H,v as le,C,p as K,b as P,u as q,i as Q,g as S,X as T,a0 as M,f as B,aE as ie}from"./ui-vendor-FlUr4cJt.js";import{r as i}from"./react-vendor-_GyjDmDn.js";import{u as ce,s as p,C as b,B as o}from"./index-BSYT0262.js";import"./supabase-vendor-Df9iqQzW.js";const O={pet_hotel:"ペットホテル",pet_salon:"ペットサロン",veterinary:"動物病院",pet_cafe:"ペットカフェ",pet_restaurant:"ペット同伴レストラン",pet_shop:"ペットショップ",pet_accommodation:"ペット同伴宿泊"};function xe(){const{user:m,isAdmin:f}=ce(),[v,G]=i.useState("pending"),[w,y]=i.useState([]),[E,U]=i.useState([]),[k,V]=i.useState([]),[Z,I]=i.useState(!0),[J,h]=i.useState(""),[X,A]=i.useState(""),[ee,g]=i.useState(!1),[t,j]=i.useState(null),[x,u]=i.useState(!1),[D,_]=i.useState(""),[se,N]=i.useState(!1),F=s=>{A(s),h(""),setTimeout(()=>A(""),5e3)},d=s=>{h(s),A(""),setTimeout(()=>h(""),8e3)};i.useEffect(()=>{if(!f){d("管理者権限が必要です");return}console.error("Current user info:",{userId:m?.id,isAdmin:f,userEmail:m?.email}),re()},[f,m]),i.useEffect(()=>{w.length>0&&ae()},[w]);const re=async()=>{try{I(!0),h("");const{data:s,error:l}=await p.from("profiles").select("*").eq("id",m?.id).single();console.error("Current user profile:",s),console.error("Profile error:",l);const{data:r,error:a}=await p.from("pet_facilities").select("*").order("created_at",{ascending:!1});if(console.error("Facilities data:",r),console.error("Facilities error:",a),a)throw console.error("Facilities fetch error:",a),a;const c=await Promise.all((r||[]).map(async n=>{const{data:z,error:Y}=await p.from("facility_images").select("*").eq("facility_id",n.id).order("is_primary",{ascending:!1});return Y?(console.error("Images fetch error:",Y),{...n,images:[]}):{...n,images:z||[]}}));y(c)}catch(s){console.error("Error fetching facilities:",s),d(s instanceof Error?s.message:"データの取得に失敗しました")}finally{I(!1)}},ae=()=>{const s=w.filter(r=>r.status==="pending"),l=w.filter(r=>r.status==="approved");U(s),V(l)},W=async s=>{if(window.confirm("この施設を承認してもよろしいですか？"))try{u(!0),h(""),console.error("Approving facility:",{facilityId:s,userId:m?.id});const{data:r,error:a}=await p.from("pet_facilities").update({status:"approved",approved_at:new Date().toISOString(),approved_by:m?.id}).eq("id",s).select();if(console.error("Approve result:",{data:r,error:a}),a)throw console.error("Approval error details:",{message:a.message,details:a.details,hint:a.hint,code:a.code}),a;F("施設を承認しました。"),y(c=>c.map(n=>n.id===s?{...n,status:"approved"}:n)),g(!1),j(null)}catch(r){if(console.error("Error approving facility:",r),r&&typeof r=="object"){const a=r;a.message?d(`施設の承認に失敗しました: ${a.message}`):d("施設の承認に失敗しました")}else d("施設の承認に失敗しました")}finally{u(!1)}},te=async(s,l)=>{try{u(!0),h(""),console.error("Rejecting facility:",{facilityId:s,reason:l,userId:m?.id});const{data:r,error:a}=await p.from("pet_facilities").update({status:"rejected",rejection_reason:l,rejected_at:new Date().toISOString(),rejected_by:m?.id}).eq("id",s).select();if(console.error("Reject result:",{data:r,error:a}),a)throw console.error("Rejection error details:",{message:a.message,details:a.details,hint:a.hint,code:a.code}),a;F("施設を拒否しました。"),y(c=>c.map(n=>n.id===s?{...n,status:"rejected",rejection_reason:l}:n)),g(!1),N(!1),j(null),_("")}catch(r){if(console.error("Error rejecting facility:",r),r&&typeof r=="object"){const a=r;a.message?d(`施設の拒否に失敗しました: ${a.message}`):d("施設の拒否に失敗しました")}else d("施設の拒否に失敗しました")}finally{u(!1)}},R=async s=>{if(window.confirm("この施設を完全に削除してもよろしいですか？この操作は取り消せません。"))try{u(!0),h(""),console.error("Deleting facility:",{facilityId:s,userId:m?.id});const{error:r}=await p.from("facility_images").delete().eq("facility_id",s);r&&console.error("Error deleting images:",r);const{data:a,error:c}=await p.from("pet_facilities").delete().eq("id",s).select();if(console.error("Delete result:",{data:a,error:c}),c)throw console.error("Deletion error details:",{message:c.message,details:c.details,hint:c.hint,code:c.code}),c;F("施設を削除しました。"),y(n=>n.filter(z=>z.id!==s)),g(!1),j(null)}catch(r){if(console.error("Error deleting facility:",r),r&&typeof r=="object"){const a=r;a.message?d(`施設の削除に失敗しました: ${a.message}`):d("施設の削除に失敗しました")}else d("施設の削除に失敗しました")}finally{u(!1)}},$=s=>{switch(s){case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},L=s=>{switch(s){case"pending":return"承認待ち";case"approved":return"承認済み";case"rejected":return"却下";default:return"不明"}};return f?Z?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"データを読み込み中..."})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"bg-white shadow rounded-lg mb-8",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"ペット関連施設承認管理"}),e.jsx("p",{className:"text-gray-600",children:"登録されたペット関連施設の承認・却下を管理します"})]}),J&&e.jsx("div",{className:"px-6 py-4 bg-red-50 border-l-4 border-red-400",children:e.jsxs("div",{className:"flex",children:[e.jsx(H,{className:"h-5 w-5 text-red-400 mr-2"}),e.jsx("p",{className:"text-sm text-red-700",children:J})]})}),X&&e.jsx("div",{className:"px-6 py-4 bg-green-50 border-l-4 border-green-400",children:e.jsxs("div",{className:"flex",children:[e.jsx(le,{className:"h-5 w-5 text-green-400 mr-2"}),e.jsx("p",{className:"text-sm text-green-700",children:X})]})}),e.jsx("div",{className:"px-6",children:e.jsxs("nav",{className:"flex space-x-8","aria-label":"Tabs",children:[e.jsxs("button",{onClick:()=>G("pending"),className:`whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm ${v==="pending"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(C,{className:"w-5 h-5 inline mr-2"}),"承認待ち",e.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:E.length})]}),e.jsxs("button",{onClick:()=>G("approved"),className:`whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm ${v==="approved"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(K,{className:"w-5 h-5 inline mr-2"}),"掲載中施設",e.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:k.length})]})]})})]}),v==="pending"&&e.jsx("div",{className:"space-y-6",children:E.length===0?e.jsxs(b,{className:"text-center py-12",children:[e.jsx(C,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"承認待ちの施設がありません"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:E.map(s=>e.jsx(b,{className:"overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:O[s.category_id]||s.category_id}),e.jsxs("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${$(s.status)}`,children:[e.jsx(C,{className:"w-3 h-3 mr-1"}),L(s.status)]})]})}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"truncate",children:s.address})]}),s.phone&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:s.phone})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:new Date(s.created_at).toLocaleDateString("ja-JP")})]})]}),s.images.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"grid grid-cols-3 gap-2",children:s.images.slice(0,3).map((l,r)=>e.jsx("img",{src:l.image_data,alt:`施設画像 ${r+1}`,className:"w-full h-16 object-cover rounded border"},l.id))}),s.images.length>3&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["+",s.images.length-3,"枚の画像"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(o,{onClick:()=>{j(s),g(!0)},className:"flex-1",size:"sm",variant:"secondary",children:"詳細を確認"}),e.jsxs(o,{onClick:()=>void W(s.id),disabled:x,className:"flex-1 bg-green-600 hover:bg-green-700",size:"sm",children:[e.jsx(S,{className:"w-4 h-4 mr-1"}),"承認"]})]}),e.jsxs("div",{className:"flex space-x-2 mt-2",children:[e.jsxs(o,{onClick:()=>{j(s),N(!0)},disabled:x,className:"flex-1 bg-red-600 hover:bg-red-700",size:"sm",children:[e.jsx(T,{className:"w-4 h-4 mr-1"}),"拒否"]}),e.jsxs(o,{onClick:()=>void R(s.id),disabled:x,className:"flex-1 bg-gray-600 hover:bg-gray-700",size:"sm",children:[e.jsx(M,{className:"w-4 h-4 mr-1"}),"削除"]})]})]})},s.id))})}),v==="approved"&&e.jsx("div",{className:"space-y-6",children:k.length===0?e.jsxs(b,{className:"text-center py-12",children:[e.jsx(K,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"掲載中の施設がありません"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:k.map(s=>e.jsx(b,{className:"overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:O[s.category_id]||s.category_id}),e.jsxs("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${$(s.status)}`,children:[e.jsx(S,{className:"w-3 h-3 mr-1"}),L(s.status)]})]})}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"truncate",children:s.address})]}),s.phone&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:s.phone})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:new Date(s.created_at).toLocaleDateString("ja-JP")})]})]}),s.images.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"grid grid-cols-3 gap-2",children:s.images.slice(0,3).map((l,r)=>e.jsx("img",{src:l.image_data,alt:`施設画像 ${r+1}`,className:"w-full h-16 object-cover rounded border"},l.id))}),s.images.length>3&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["+",s.images.length-3,"枚の画像"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(o,{onClick:()=>{j(s),g(!0)},className:"flex-1",size:"sm",variant:"secondary",children:"詳細を確認"}),e.jsxs(o,{onClick:()=>void R(s.id),disabled:x,className:"flex-1 bg-red-600 hover:bg-red-700",size:"sm",children:[e.jsx(M,{className:"w-4 h-4 mr-1"}),"削除"]})]})]})},s.id))})}),ee&&t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:t.name}),e.jsx("p",{className:"text-gray-600",children:O[t.category_id]||t.category_id})]}),e.jsx("button",{onClick:()=>g(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(B,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"基本情報"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(P,{className:"w-5 h-5 text-gray-500 mr-3"}),e.jsx("span",{children:t.address})]}),t.phone&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(q,{className:"w-5 h-5 text-gray-500 mr-3"}),e.jsx("span",{children:t.phone})]}),t.website&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(ie,{className:"w-5 h-5 text-gray-500 mr-3"}),e.jsx("a",{href:t.website,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800",children:t.website})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"ステータス"}),e.jsxs("div",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${$(t.status)}`,children:[t.status==="pending"&&e.jsx(C,{className:"w-4 h-4 mr-2"}),t.status==="approved"&&e.jsx(S,{className:"w-4 h-4 mr-2"}),t.status==="rejected"&&e.jsx(B,{className:"w-4 h-4 mr-2"}),L(t.status)]})]})]}),t.description&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"施設紹介"}),e.jsx("p",{className:"text-gray-700 whitespace-pre-line",children:t.description})]}),t.images.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-3",children:["施設画像 (",t.images.length,"枚)"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:t.images.map((s,l)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s.image_data,alt:`施設画像 ${l+1}`,className:"w-full h-32 object-cover rounded-lg border"}),s.is_primary&&e.jsx("div",{className:"absolute top-2 left-2 bg-blue-500 text-white text-xs px-2 py-1 rounded",children:"メイン"})]},s.id))})]}),t.status==="pending"&&e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs(o,{onClick:()=>void W(t.id),disabled:x,className:"flex-1 bg-green-600 hover:bg-green-700",children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"承認する"]}),e.jsxs(o,{onClick:()=>{g(!1),N(!0)},disabled:x,className:"flex-1 bg-red-600 hover:bg-red-700",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"拒否する"]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsxs(o,{onClick:()=>void R(t.id),disabled:x,className:"w-full bg-gray-600 hover:bg-gray-700",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"施設を削除"]})})]})})}),se&&t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-lg max-w-md w-full",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"施設の拒否理由を入力"}),e.jsx("button",{onClick:()=>{N(!1),_("")},className:"text-gray-400 hover:text-gray-600",children:e.jsx(B,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["施設名: ",e.jsx("span",{className:"font-medium",children:t.name})]}),e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"拒否理由を入力してください"}),e.jsx("textarea",{value:D,onChange:s=>_(s.target.value),placeholder:"拒否理由を詳しく入力してください...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",rows:4,required:!0})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(o,{onClick:()=>{N(!1),_("")},variant:"secondary",className:"flex-1",disabled:x,children:"キャンセル"}),e.jsxs(o,{onClick:()=>void te(t.id,D),disabled:x||!D.trim(),className:"flex-1 bg-red-600 hover:bg-red-700",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"拒否する"]})]})]})})})]})}):e.jsx("div",{className:"max-w-4xl mx-auto p-4",children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(H,{className:"w-12 h-12 text-red-500 mr-4"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-red-700",children:"アクセス権限がありません"}),e.jsx("p",{className:"text-red-600",children:"このページは管理者のみアクセス可能です。"})]})]})})})}export{xe as default};

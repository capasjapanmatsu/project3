import{j as e,q as o,k as q,S as B,ap as J,aq as R,_ as z,Q as K,x as W,r as M,J as X,ar as Y}from"./ui-vendor-FlUr4cJt.js";import{r,L as P}from"./react-vendor-_GyjDmDn.js";import{B as g,u as Z,b as ee,s as m,C as L}from"./index-BSYT0262.js";import{I as se}from"./Input-wBkmcJUR.js";import{u as te}from"./useStripe-CyE4J3Un.js";import{p as ae}from"./stripe-config-03sBkt-B.js";import"./supabase-vendor-Df9iqQzW.js";function re({hasSubscription:n=!1,className:d="",variant:N="primary",size:i="md"}){const{createCheckoutSession:y,loading:C,error:x}=te(),[p,f]=r.useState(!1),h=async()=>{f(!1);const j=ae.find(b=>b.mode==="subscription");if(!j){console.error("Subscription product not found");return}try{await y({priceId:j.priceId,mode:"subscription",successUrl:`${window.location.origin}/dashboard?success=true`,cancelUrl:`${window.location.origin}/dashboard?canceled=true`})}catch{f(!0)}};return n?e.jsx(P,{to:"/subscription",children:e.jsxs(g,{variant:N,size:i,className:`flex items-center ${d}`,children:[e.jsx(o,{className:`${i==="sm"?"w-3 h-3":"w-4 h-4"} mr-1`}),"ã‚µãƒ–ã‚¹ã‚¯ç®¡ç†"]})}):e.jsxs("div",{children:[e.jsxs(g,{onClick:()=>void h(),isLoading:C,variant:"primary",size:i,className:`flex items-center bg-purple-600 hover:bg-purple-700 text-white ${d}`,children:[e.jsx(o,{className:`${i==="sm"?"w-3 h-3":"w-4 h-4"} mr-1`}),"ã‚µãƒ–ã‚¹ã‚¯ã«åŠ å…¥"]}),p&&x&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:x})]})}function xe(){const{user:n}=Z(),[d,N]=r.useState([]),[i,y]=r.useState([]),[C,x]=r.useState(!0),[p,f]=r.useState(""),[h,j]=r.useState("all"),[b,O]=r.useState("name"),{isActive:u}=ee(),w=r.useDeferredValue(p),S=r.useDeferredValue(h),T=r.useDeferredValue(b),I=[{value:"all",label:"ã™ã¹ã¦",icon:q},{value:"food",label:"ãƒ‰ãƒƒã‚°ãƒ•ãƒ¼ãƒ‰",icon:z},{value:"treats",label:"ãŠã‚„ã¤",icon:K},{value:"toys",label:"ãŠã‚‚ã¡ã‚ƒ",icon:W},{value:"accessories",label:"ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼",icon:o},{value:"health",label:"ãƒ˜ãƒ«ã‚¹ã‚±ã‚¢",icon:M},{value:"sheets",label:"ãƒšãƒƒãƒˆã‚·ãƒ¼ãƒ„",icon:z}];r.useEffect(()=>{v()},[n]);const v=async()=>{x(!0);try{await Promise.all([Q(),n?V():Promise.resolve()])}catch(s){console.error("ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:",s)}finally{x(!1)}},Q=async()=>{const{data:s,error:t}=await m.from("products").select("*").eq("is_active",!0).order("created_at",{ascending:!1});if(t)throw t;N(s||[])},V=async()=>{const{data:s,error:t}=await m.from("cart_items").select("*, product:products(*)").eq("user_id",n.id);if(t)throw t;y(s||[])},A=async(s,t=1)=>{if(n)try{const a=i.find(l=>l.product_id===s);if(a){const{error:l}=await m.from("cart_items").update({quantity:a.quantity+t}).eq("id",a.id);if(l)throw l}else{const{error:l}=await m.from("cart_items").insert([{user_id:n.id,product_id:s,quantity:t}]);if(l)throw l}await v()}catch(a){console.error("Error adding to cart:",a)}},$=async(s,t)=>{if(t<=0)try{const{error:a}=await m.from("cart_items").delete().eq("id",s);if(a)throw a;await v()}catch(a){console.error("Error removing from cart:",a)}else try{const{error:a}=await m.from("cart_items").update({quantity:t}).eq("id",s);if(a)throw a;await v()}catch(a){console.error("Error updating cart:",a)}},U=s=>{const t=i.find(a=>a.product_id===s);return t?t.quantity:0},_=s=>u?Math.round(s*.9):s,E=r.useMemo(()=>d.filter(t=>{const a=t.name.toLowerCase().includes(w.toLowerCase())||t.description.toLowerCase().includes(w.toLowerCase())||t.brand&&t.brand.toLowerCase().includes(w.toLowerCase()),l=S==="all"||t.category===S;return a&&l}).sort((t,a)=>{switch(T){case"name":return t.name.localeCompare(a.name);case"price":return _(t.price)-_(a.price);case"category":return t.category.localeCompare(a.category);default:return new Date(a.created_at).getTime()-new Date(t.created_at).getTime()}}),[d,w,S,T]),G=s=>{f(s),r.startTransition(()=>{console.log(`ğŸ” Filtering ${d.length} products for "${s}"`)})},D=s=>{r.startTransition(()=>{j(s)})},H=s=>{r.startTransition(()=>{O(s)})};return C?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center",children:[e.jsx(q,{className:"w-8 h-8 text-green-600 mr-3"}),"ãƒšãƒƒãƒˆã‚·ãƒ§ãƒƒãƒ—"]}),e.jsx("p",{className:"text-gray-600",children:"æ„›çŠ¬ã®ãŸã‚ã®å³é¸å•†å“ã‚’ãŠå±Šã‘"})]}),e.jsx(P,{to:"/cart",children:e.jsxs(g,{className:"bg-green-600 hover:bg-green-700",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"ã‚«ãƒ¼ãƒˆ (",i.reduce((s,t)=>s+t.quantity,0),")"]})})]}),e.jsx("div",{className:"relative overflow-hidden",children:u?e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 via-pink-600 to-purple-700 text-white p-8 rounded-xl shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-full",children:e.jsx(o,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold mb-2 flex items-center",children:[e.jsx(J,{className:"w-6 h-6 mr-2"}),"ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ä¼šå“¡ç‰¹å…¸é©ç”¨ä¸­ï¼"]}),e.jsx("p",{className:"text-lg opacity-90",children:"å…¨å•†å“10%OFF + é€æ–™ç„¡æ–™ã§ãŠè²·ã„ç‰©ã‚’ãŠæ¥½ã—ã¿ãã ã•ã„"})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"bg-white/20 px-6 py-3 rounded-lg",children:[e.jsx("p",{className:"text-sm opacity-80",children:"ä»Šæœˆã®ç¯€ç´„é¡"}),e.jsx("p",{className:"text-2xl font-bold",children:"Â¥1,200+"})]})})]}),e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-16 -mt-16"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white/10 rounded-full -ml-12 -mb-12"})]}):e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 text-white p-8 rounded-xl shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-full",children:e.jsx(R,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold mb-2 flex items-center",children:[e.jsx(o,{className:"w-6 h-6 mr-2"}),"ã‚µãƒ–ã‚¹ã‚¯ä¼šå“¡ã¯å…¨å“10ï¼…OFF & é€æ–™ç„¡æ–™ï¼"]}),e.jsx("p",{className:"text-lg opacity-90",children:"æœˆé¡3,800å††ã§ã©ã“ã§ã‚‚ä½¿ã„æ”¾é¡Œ + ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ä½¿ã„æ”¾é¡Œ"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(re,{hasSubscription:u,className:"bg-white text-purple-600 hover:bg-gray-100 font-bold px-6 py-3 text-lg"}),e.jsx("p",{className:"text-sm opacity-80 mt-2",children:"åˆæœˆç„¡æ–™ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ä¸­"})]})]}),e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-16 -mt-16"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white/10 rounded-full -ml-12 -mb-12"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(se,{label:"",value:p,onChange:s=>G(s.target.value),placeholder:"å•†å“åã€ãƒ–ãƒ©ãƒ³ãƒ‰åã§æ¤œç´¢..."})}),e.jsx("div",{children:e.jsx("select",{value:h,onChange:s=>D(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",children:I.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})}),e.jsx("div",{children:e.jsxs("select",{value:b,onChange:s=>H(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",children:[e.jsx("option",{value:"popular",children:"äººæ°—é †"}),e.jsx("option",{value:"name",children:"åå‰é †"}),e.jsx("option",{value:"price",children:"ä¾¡æ ¼ã®å®‰ã„é †"}),e.jsx("option",{value:"category",children:"ã‚«ãƒ†ã‚´ãƒªãƒ¼é †"})]})})]}),e.jsx("div",{className:"flex space-x-2 overflow-x-auto pb-2",children:I.map(s=>{const t=s.icon;return e.jsxs("button",{onClick:()=>D(s.value),className:`flex items-center space-x-2 px-4 py-2 rounded-lg whitespace-nowrap transition-colors ${h===s.value?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(t,{className:"w-4 h-4"}),e.jsx("span",{children:s.label})]},s.value)})}),E.length===0?e.jsxs(L,{className:"text-center py-12",children:[e.jsx(q,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"è©²å½“ã™ã‚‹å•†å“ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:E.map(s=>{const t=U(s.id),a=s.price,l=_(a),F=u&&l<a;return e.jsxs(L,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"relative h-48 mb-4 -m-6 mb-4",children:[e.jsx("img",{src:s.image_url,alt:s.name,className:"w-full h-full object-cover",onError:c=>{c.currentTarget.src="https://images.pexels.com/photos/1108099/pexels-photo-1108099.jpeg"}}),F&&e.jsx("div",{className:"absolute top-3 left-3",children:e.jsxs("span",{className:"bg-purple-500 text-white px-2 py-1 rounded-full text-xs font-medium flex items-center",children:[e.jsx(o,{className:"w-3 h-3 mr-1"}),"10%OFF"]})}),s.stock_quantity<=5&&e.jsx("div",{className:"absolute top-3 right-3",children:e.jsxs("span",{className:"bg-red-500 text-white px-2 py-1 rounded-full text-xs font-medium",children:["æ®‹ã‚Š",s.stock_quantity,"å€‹"]})})]}),e.jsxs("div",{className:"px-6 pb-6",children:[e.jsxs("div",{className:"mb-2",children:[s.brand&&e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:s.brand}),e.jsx("h3",{className:"text-lg font-semibold line-clamp-2",children:s.name})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:s.description}),e.jsxs("div",{className:"space-y-1 text-xs text-gray-500 mb-3",children:[s.weight&&e.jsxs("p",{children:["å†…å®¹é‡: ",s.weight,"g"]}),s.size&&e.jsxs("p",{children:["ã‚µã‚¤ã‚º: ",s.size]}),s.age_group&&s.age_group!=="all"&&e.jsxs("p",{children:["å¯¾è±¡å¹´é½¢: ",s.age_group==="puppy"?"å­çŠ¬":s.age_group==="adult"?"æˆçŠ¬":"ã‚·ãƒ‹ã‚¢çŠ¬"]}),s.dog_size&&s.dog_size!=="all"&&e.jsxs("p",{children:["å¯¾è±¡ã‚µã‚¤ã‚º: ",s.dog_size==="small"?"å°å‹çŠ¬":s.dog_size==="medium"?"ä¸­å‹çŠ¬":"å¤§å‹çŠ¬"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-xl font-bold text-green-600",children:["Â¥",l.toLocaleString()]}),F&&e.jsxs("span",{className:"text-sm text-gray-500 line-through",children:["Â¥",a.toLocaleString()]})]}),u&&e.jsxs("p",{className:"text-xs text-purple-600 flex items-center",children:[e.jsx(o,{className:"w-3 h-3 mr-1"}),"ã‚µãƒ–ã‚¹ã‚¯ä¼šå“¡ä¾¡æ ¼"]})]}),e.jsxs("div",{className:"space-y-2",children:[t>0?e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 rounded-lg p-2",children:[e.jsx("button",{onClick:()=>{const c=i.find(k=>k.product_id===s.id);c&&$(c.id,t-1)},className:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center hover:bg-gray-300 transition-colors",children:e.jsx(X,{className:"w-4 h-4"})}),e.jsx("span",{className:"font-medium",children:t}),e.jsx("button",{onClick:()=>{const c=i.find(k=>k.product_id===s.id);c&&$(c.id,t+1)},className:"w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center hover:bg-green-700 transition-colors",children:e.jsx(M,{className:"w-4 h-4"})})]}):e.jsx(g,{onClick:()=>A(s.id),className:"w-full bg-green-600 hover:bg-green-700",disabled:s.stock_quantity===0,children:s.stock_quantity===0?"åœ¨åº«åˆ‡ã‚Œ":e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"ã‚«ãƒ¼ãƒˆã«è¿½åŠ "]})}),e.jsx(P,{to:`/shop/product/${s.id}`,children:e.jsx(g,{variant:"secondary",className:"w-full",children:"è©³ç´°ã‚’è¦‹ã‚‹"})})]})]})]},s.id)})}),e.jsx(L,{className:"bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Y,{className:"w-6 h-6 text-blue-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"é…é€ã«ã¤ã„ã¦"}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("p",{children:"â€¢ é€æ–™ï¼šå…¨å›½ä¸€å¾‹Â¥690"}),e.jsxs("p",{children:["â€¢ Â¥5,000ä»¥ä¸Šã®ã”æ³¨æ–‡ã§",e.jsx("span",{className:"font-medium",children:"é€æ–™ç„¡æ–™"})]}),e.jsxs("p",{children:["â€¢ ã‚µãƒ–ã‚¹ã‚¯ä¼šå“¡ã¯",e.jsx("span",{className:"font-medium",children:"å¸¸ã«é€æ–™ç„¡æ–™"})]}),e.jsx("p",{children:"â€¢ å¹³æ—¥14æ™‚ã¾ã§ã®ã”æ³¨æ–‡ã§ç¿Œæ—¥ãŠå±Šã‘"}),e.jsx("p",{children:"â€¢ åœŸæ—¥ç¥æ—¥ã‚‚é…é€ã„ãŸã—ã¾ã™"})]})]})]})})]})}export{xe as PetShop};

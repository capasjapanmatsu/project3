import{j as e,R as s,C as a,w as t,y as i,ac as n,ad as r,a9 as c}from"./ui-vendor.5lywbznV.js";import{r as l}from"./react-vendor.C7ykWfwV.js";import{B as o,C as d}from"./admin-pages.BuCPNRRu.js";import"./supabase-vendor.CX-WoPCS.js";const m=()=>{const[m,p]=l.useState({installation:[],offline:[],performance:[],security:[],features:[]}),[h,u]=l.useState(!1),[x,g]=l.useState("installation"),f=async()=>{u(!0);try{const e=await w(),s=await y(),a=await j(),t=await v(),i=await N();p({installation:e,offline:s,performance:a,security:t,features:i})}catch(e){}finally{u(!1)}},w=async()=>{var e;const s=[];try{const a=await fetch("/manifest.json");if(s.push({id:"manifest-exists",name:"マニフェストファイル",description:"manifest.jsonファイルが存在するか",status:a.ok?"pass":"fail",details:a.ok?"マニフェストファイルが正常に読み込まれました":"マニフェストファイルが見つかりません"}),a.ok){const t=await a.json();s.push({id:"manifest-name",name:"アプリ名",description:"manifestにname/short_nameが設定されているか",status:t.name&&t.short_name?"pass":"fail",details:`name: ${t.name||"未設定"}, short_name: ${t.short_name||"未設定"}`}),s.push({id:"manifest-icons",name:"アイコン",description:"manifestに適切なアイコンが設定されているか",status:t.icons&&t.icons.length>0?"pass":"fail",details:`${(null==(e=t.icons)?void 0:e.length)||0}個のアイコンが設定されています`}),s.push({id:"manifest-start-url",name:"スタートURL",description:"manifestにstart_urlが設定されているか",status:t.start_url?"pass":"fail",details:`start_url: ${t.start_url||"未設定"}`}),s.push({id:"manifest-display",name:"表示モード",description:"manifestに適切な表示モードが設定されているか",status:t.display?"pass":"warning",details:`display: ${t.display||"browser (デフォルト)"}`})}}catch(a){s.push({id:"manifest-error",name:"マニフェストエラー",description:"マニフェストファイルの読み込みでエラーが発生",status:"fail",details:`エラー: ${a instanceof Error?a.message:"不明なエラー"}`})}if(s.push({id:"service-worker",name:"Service Worker",description:"Service Workerが登録されているか",status:"serviceWorker"in navigator?"pass":"fail",details:"serviceWorker"in navigator?"Service Workerがサポートされています":"Service Workerがサポートされていません"}),"serviceWorker"in navigator)try{const e=await navigator.serviceWorker.getRegistration();s.push({id:"service-worker-registered",name:"Service Worker登録状態",description:"Service Workerが実際に登録されているか",status:e?"pass":"warning",details:e?`登録済み: ${e.scope}`:"未登録または登録中"})}catch(a){s.push({id:"service-worker-error",name:"Service Workerエラー",description:"Service Worker確認中にエラーが発生",status:"fail",details:`エラー: ${a instanceof Error?a.message:"不明なエラー"}`})}return s.push({id:"installable",name:"インストール可能性",description:"PWAがインストール可能な状態か",status:window.matchMedia("(display-mode: standalone)").matches?"pass":"warning",details:window.matchMedia("(display-mode: standalone)").matches?"PWAモードで実行中":"ブラウザモードで実行中（インストール可能かもしれません）"}),s},y=async()=>{const e=[];try{const s=await fetch("/offline.html");e.push({id:"offline-page",name:"オフラインページ",description:"オフライン時に表示されるページが存在するか",status:s.ok?"pass":"fail",details:s.ok?"オフラインページが正常に読み込まれました":"オフラインページが見つかりません"})}catch(s){e.push({id:"offline-page-error",name:"オフラインページエラー",description:"オフラインページの確認中にエラーが発生",status:"fail",details:`エラー: ${s instanceof Error?s.message:"不明なエラー"}`})}if(e.push({id:"cache-api",name:"Cache API",description:"Cache APIがサポートされているか",status:"caches"in window?"pass":"fail",details:"caches"in window?"Cache APIがサポートされています":"Cache APIがサポートされていません"}),"caches"in window)try{const s=await caches.keys();e.push({id:"cache-stored",name:"キャッシュ保存状況",description:"アプリのキャッシュが保存されているか",status:s.length>0?"pass":"warning",details:`${s.length}個のキャッシュが保存されています: ${s.join(", ")}`})}catch(s){e.push({id:"cache-error",name:"キャッシュエラー",description:"キャッシュ確認中にエラーが発生",status:"fail",details:`エラー: ${s instanceof Error?s.message:"不明なエラー"}`})}return e.push({id:"network-status",name:"ネットワーク状態",description:"現在のネットワーク接続状態",status:navigator.onLine?"pass":"warning",details:navigator.onLine?"オンライン":"オフライン"}),e},j=async()=>{const e=[];if("performance"in window&&performance.navigation){const s=performance.timing,a=s.loadEventEnd-s.navigationStart;e.push({id:"load-time",name:"ページ読み込み時間",description:"ページの読み込み速度",status:a<3e3?"pass":a<5e3?"warning":"fail",details:`${a}ms（目標: 3秒以下）`});const t=s.domContentLoadedEventEnd-s.navigationStart;e.push({id:"dom-content-loaded",name:"DOM構築時間",description:"DOMContentLoadedまでの時間",status:t<1500?"pass":t<2500?"warning":"fail",details:`${t}ms（目標: 1.5秒以下）`})}if("performance"in window&&performance.getEntriesByType){const s=performance.getEntriesByType("resource").reduce((e,s)=>e+(s.transferSize||0),0);e.push({id:"resource-size",name:"リソースサイズ",description:"読み込まれたリソースの総サイズ",status:s<1e6?"pass":s<2e6?"warning":"fail",details:`${(s/1024).toFixed(2)} KB（目標: 1MB以下）`})}if("memory"in performance){const s=performance.memory;e.push({id:"memory-usage",name:"メモリ使用量",description:"JavaScriptヒープのメモリ使用量",status:s.usedJSHeapSize<5e7?"pass":"warning",details:`${(s.usedJSHeapSize/1024/1024).toFixed(2)} MB`})}return e},v=async()=>{const e=[];e.push({id:"https",name:"HTTPS接続",description:"セキュアな接続が使用されているか",status:"https:"===location.protocol||"localhost"===location.hostname?"pass":"fail",details:`プロトコル: ${location.protocol}`});const s=document.querySelector('meta[http-equiv="Content-Security-Policy"]');if(e.push({id:"csp",name:"Content Security Policy",description:"CSPが設定されているか",status:s?"pass":"warning",details:s?"CSPが設定されています":"CSPが設定されていません（推奨）"}),"serviceWorker"in navigator)try{const s=await navigator.serviceWorker.getRegistration();s&&e.push({id:"sw-scope",name:"Service Worker スコープ",description:"Service Workerのスコープが適切か",status:s.scope.endsWith("/")?"pass":"warning",details:`スコープ: ${s.scope}`})}catch(a){}return e},N=async()=>{const e=[],s=document.querySelector('link[rel="manifest"]');e.push({id:"manifest-link",name:"マニフェストリンク",description:"HTMLにマニフェストリンクが設定されているか",status:s?"pass":"fail",details:s?`リンク先: ${s.href}`:"マニフェストリンクが見つかりません"});const a=document.querySelectorAll('link[rel*="icon"]');e.push({id:"favicon",name:"ファビコン",description:"ファビコンが設定されているか",status:a.length>0?"pass":"warning",details:`${a.length}個のアイコンリンクが見つかりました`});const t=document.querySelector('meta[name="viewport"]');e.push({id:"viewport",name:"ビューポート設定",description:"モバイル対応のビューポートが設定されているか",status:t?"pass":"warning",details:t?`設定: ${t.content}`:"ビューポート設定が見つかりません"});const i=document.querySelector('meta[name="theme-color"]');return e.push({id:"theme-color",name:"テーマカラー",description:"アプリのテーマカラーが設定されているか",status:i?"pass":"warning",details:i?`カラー: ${i.content}`:"テーマカラーが設定されていません"}),e.push({id:"push-notifications",name:"Push通知対応",description:"Push通知APIがサポートされているか",status:"PushManager"in window?"pass":"warning",details:"PushManager"in window?"Push通知がサポートされています":"Push通知がサポートされていません"}),e.push({id:"background-sync",name:"Background Sync対応",description:"Background Sync APIがサポートされているか",status:"serviceWorker"in navigator&&"sync"in window.ServiceWorkerRegistration.prototype?"pass":"warning",details:"serviceWorker"in navigator&&"sync"in window.ServiceWorkerRegistration.prototype?"Background Syncがサポートされています":"Background Syncがサポートされていません"}),e},b=n=>{switch(n){case"pass":return e.jsx(a,{className:"h-5 w-5 text-green-500"});case"fail":return e.jsx(i,{className:"h-5 w-5 text-red-500"});case"warning":return e.jsx(t,{className:"h-5 w-5 text-yellow-500"});case"pending":return e.jsx(s,{className:"h-5 w-5 text-gray-500 animate-spin"});default:return null}},k=e=>{switch(e){case"pass":return"border-green-200 bg-green-50";case"fail":return"border-red-200 bg-red-50";case"warning":return"border-yellow-200 bg-yellow-50";case"pending":return"border-gray-200 bg-gray-50";default:return"border-gray-200 bg-white"}},S={installation:{name:"インストール",icon:e.jsx(c,{className:"h-4 w-4"})},offline:{name:"オフライン機能",icon:e.jsx(r,{className:"h-4 w-4"})},performance:{name:"パフォーマンス",icon:e.jsx(s,{className:"h-4 w-4"})},security:{name:"セキュリティ",icon:e.jsx(a,{className:"h-4 w-4"})},features:{name:"PWA機能",icon:e.jsx(n,{className:"h-4 w-4"})}},W=()=>m[x]||[];l.useEffect(()=>{f()},[]);const P=(()=>{const e=Object.values(m).flat();if(0===e.length)return null;return{passCount:e.filter(e=>"pass"===e.status).length,failCount:e.filter(e=>"fail"===e.status).length,warningCount:e.filter(e=>"warning"===e.status).length,total:e.length}})();return e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"PWA テスト・チェックリスト"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Progressive Web App (PWA) の実装状況を包括的にテストし、改善点を特定します。"}),e.jsx("div",{className:"flex justify-center gap-4 mb-6",children:e.jsxs(o,{onClick:f,disabled:h,className:"flex items-center gap-2",children:[e.jsx(s,{className:"h-4 w-4 "+(h?"animate-spin":"")}),h?"テスト実行中...":"テストを再実行"]})}),P&&e.jsxs(d,{className:"p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"テスト結果サマリー"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:P.passCount}),e.jsx("div",{className:"text-sm text-gray-600",children:"合格"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:P.warningCount}),e.jsx("div",{className:"text-sm text-gray-600",children:"警告"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:P.failCount}),e.jsx("div",{className:"text-sm text-gray-600",children:"失敗"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:P.total}),e.jsx("div",{className:"text-sm text-gray-600",children:"総数"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:P.passCount/P.total*100+"%"}})}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["合格率: ",Math.round(P.passCount/P.total*100),"%"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(d,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"テストカテゴリ"}),e.jsx("div",{className:"space-y-2",children:Object.entries(S).map(([s,a])=>e.jsxs("button",{onClick:()=>g(s),className:"w-full text-left p-3 rounded-lg transition-colors flex items-center gap-2 "+(x===s?"bg-blue-100 text-blue-700 border border-blue-200":"hover:bg-gray-100 text-gray-700"),children:[a.icon,e.jsx("span",{children:a.name}),m[s]&&e.jsx("span",{className:"ml-auto text-sm bg-gray-200 text-gray-600 px-2 py-1 rounded",children:m[s].length})]},s))})]})}),e.jsx("div",{className:"lg:col-span-3",children:e.jsxs(d,{className:"p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:[S[x].icon,S[x].name," テスト結果"]}),e.jsx("div",{className:"space-y-4",children:0===W().length?e.jsx("p",{className:"text-gray-500 text-center py-8",children:h?"テスト実行中...":"テスト結果がありません。テストを実行してください。"}):W().map(s=>e.jsx("div",{className:`p-4 rounded-lg border-2 ${k(s.status)}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[b(s.status),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.description}),s.details&&e.jsx("p",{className:"text-sm text-gray-700 mt-2 bg-white bg-opacity-50 p-2 rounded",children:s.details})]})]})},s.id))})]})})]}),e.jsxs(d,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"テスト項目について"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 text-sm",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2",children:[e.jsx(a,{className:"h-4 w-4 text-green-500"}),"合格 (Pass)"]}),e.jsx("p",{className:"text-gray-600",children:"PWAの要件を満たしており、問題ありません。"})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2",children:[e.jsx(t,{className:"h-4 w-4 text-yellow-500"}),"警告 (Warning)"]}),e.jsx("p",{className:"text-gray-600",children:"必須ではありませんが、改善を推奨します。"})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2",children:[e.jsx(i,{className:"h-4 w-4 text-red-500"}),"失敗 (Fail)"]}),e.jsx("p",{className:"text-gray-600",children:"PWAの基本要件を満たしていません。修正が必要です。"})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2",children:[e.jsx(s,{className:"h-4 w-4 text-gray-500"}),"実行中 (Pending)"]}),e.jsx("p",{className:"text-gray-600",children:"テストを実行中です。しばらくお待ちください。"})]})]})]})]})};export{m as default};

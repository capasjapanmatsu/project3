import{u as H,j as e,m as a,v as V,f as o,c as l,B as c,C as p,w as z,x as E,y as L,g as v,z as O}from"./index-B2nIfDq6.js";import{d as B,i as F,r as t}from"./react-vendor-ClX3xUyT.js";import{V as K,i as J,K as y,A as w,P as R}from"./ui-vendor-Bbvw08tP.js";import{A as P}from"./index-t547Jm-c.js";import"./supabase-vendor-CRpuwX9I.js";function Q(){const s=B(),[m]=F(),{user:i}=H(),[S,T]=t.useState(!1),[n,d]=t.useState("processing"),[r,I]=t.useState(5),[C,j]=t.useState(!1),[A,f]=t.useState(!1);t.useEffect(()=>{const h=setTimeout(async()=>{const N=m.get("status"),_=m.get("session_id"),b=m.get("canceled");N==="success"&&_?(d("success"),setTimeout(async()=>{f(!0),await O(),j(!0),setTimeout(()=>{j(!1),f(!1)},3e3)},500)):d(N==="cancel"||b==="true"?"failed":"processing");const g=localStorage.getItem("pre_payment_auth_state");if(g)try{const u=JSON.parse(g);(!i||i.id!==u.user_id)&&b==="true"&&(d("failed"),setTimeout(()=>{s("/login")},5e3)),localStorage.removeItem("pre_payment_auth_state")}catch(u){console.error("Failed to parse pre-payment auth state:",u)}T(!1)},100);return()=>clearTimeout(h)},[m,i,s]),t.useEffect(()=>{if(n==="success"&&r>0){const x=setTimeout(()=>{I(r-1)},1e3);return()=>clearTimeout(x)}else n==="success"&&r===0&&s("/access-control")},[n,r,s]);const k=()=>{s("/access-control")};return S?e.jsx(a.div,{className:"flex justify-center items-center h-64",initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs(a.div,{className:"max-w-2xl mx-auto",initial:"initial",animate:"animate",exit:"exit",variants:V,children:[e.jsxs(a.div,{className:"flex items-center mb-6",variants:o,children:[e.jsx(a.div,{variants:l,whileHover:"hover",whileTap:"tap",children:e.jsxs(c,{variant:"primary",size:"sm",onClick:()=>s(-1),className:"mr-3",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"戻る"]})}),e.jsx("h1",{className:"text-2xl font-bold",children:"決済確認"})]}),e.jsxs(P,{children:[n==="success"&&e.jsx(a.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.4,ease:"easeOut"},children:e.jsxs(p,{className:"text-center p-8 relative overflow-hidden",children:[e.jsx(P,{children:C&&e.jsx("div",{className:"absolute inset-0 pointer-events-none",children:Array.from({length:8}).map((x,h)=>e.jsx(a.div,{className:"absolute w-2 h-2 bg-yellow-400 rounded-full",style:{left:"50%",top:"50%"},variants:z,initial:"initial",animate:"animate",exit:{opacity:0}},h))})}),e.jsx(a.div,{variants:E,initial:"initial",animate:A?"animate":"initial",className:"relative",children:e.jsx(J,{className:"w-16 h-16 text-green-600 mx-auto mb-4"})}),e.jsx(a.h2,{className:"text-2xl font-bold text-green-800 mb-4",variants:o,children:"🎉 決済が完了しました！"}),e.jsx(a.p,{className:"text-gray-600 mb-6",variants:o,children:"ありがとうございます。決済が正常に処理されました。"}),e.jsxs(a.div,{className:"bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg mb-6 border border-blue-200",variants:o,children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[e.jsx(a.div,{animate:{rotate:[0,15,-15,0]},transition:{duration:.6,repeat:2},children:e.jsx(y,{className:"w-5 h-5 text-blue-600"})}),e.jsx("span",{className:"font-semibold text-blue-900",children:"次のステップ"})]}),e.jsx("p",{className:"text-sm text-blue-800",children:"入場にはPINコードが必要です。下のボタンからPINコードを生成してください。"})]}),e.jsx(a.div,{variants:l,whileHover:"hover",whileTap:"tap",className:"mb-4",children:e.jsxs(c,{onClick:k,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white shadow-lg",children:[e.jsx(y,{className:"w-5 h-5 mr-2"}),"🚀 PINコードを生成する"]})}),e.jsx(a.p,{className:"text-sm text-gray-500",variants:o,children:r>0&&e.jsxs(a.span,{animate:{scale:[1,1.1,1]},transition:{duration:1,repeat:1/0},children:["⏰ ",r,"秒後に自動的にPINコード生成画面に移動します..."]})})]})}),n==="failed"&&e.jsx(a.div,{variants:L,initial:"initial",animate:"animate",exit:"exit",children:e.jsxs(p,{className:"text-center p-8",children:[e.jsx(a.div,{animate:{rotate:[-5,5,-5,0]},transition:{duration:.6},children:e.jsx(w,{className:"w-16 h-16 text-red-600 mx-auto mb-4"})}),e.jsx("h2",{className:"text-2xl font-bold text-red-800 mb-4",children:"決済がキャンセルされました"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["決済がキャンセルまたは失敗しました。",i?"":"認証状態を確認してから","再度お試しください。"]}),!i&&e.jsxs(a.div,{className:"bg-orange-50 p-4 rounded-lg mb-6",variants:v,children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[e.jsx(w,{className:"w-5 h-5 text-orange-600"}),e.jsx("span",{className:"font-semibold text-orange-900",children:"認証状態が失われました"})]}),e.jsx("p",{className:"text-sm text-orange-800",children:"セッションが切断されました。3秒後にログインページに移動します。"})]}),e.jsxs(a.div,{className:"bg-yellow-50 p-4 rounded-lg mb-6",variants:v,children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[e.jsx(R,{className:"w-5 h-5 text-yellow-600"}),e.jsx("span",{className:"font-semibold text-yellow-900",children:"ドッグランを利用するには"})]}),e.jsx("p",{className:"text-sm text-yellow-800",children:"入場にはPINコードが必要です。決済完了後にPINコードを生成できます。"})]}),e.jsx("div",{className:"space-y-3",children:i?e.jsxs(e.Fragment,{children:[e.jsx(a.div,{variants:l,whileHover:"hover",whileTap:"tap",children:e.jsx(c,{onClick:()=>s("/parks"),className:"w-full",children:"ドッグラン一覧に戻る"})}),e.jsx(a.div,{variants:l,whileHover:"hover",whileTap:"tap",children:e.jsx(c,{variant:"secondary",onClick:()=>s("/subscription"),className:"w-full",children:"サブスクリプションを検討する"})}),e.jsx(a.div,{variants:l,whileHover:"hover",whileTap:"tap",children:e.jsx(c,{variant:"secondary",onClick:()=>s("/cart"),className:"w-full",children:"カートを確認する"})})]}):e.jsx(a.div,{variants:l,whileHover:"hover",whileTap:"tap",children:e.jsx(c,{onClick:()=>s("/login"),className:"w-full",children:"ログインする"})})})]})}),n==="processing"&&e.jsx(a.div,{variants:v,initial:"initial",animate:"animate",children:e.jsxs(p,{className:"text-center p-8",children:[e.jsx(a.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"inline-block",children:e.jsx("div",{className:"rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"})}),e.jsx("h2",{className:"text-xl font-bold mb-4",children:"決済を処理中..."}),e.jsx("p",{className:"text-gray-600",children:"しばらくお待ちください。決済の処理が完了するまでお時間をいただく場合があります。"})]})})]})]})}export{Q as PaymentConfirmation};

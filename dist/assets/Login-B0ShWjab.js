import{u as e,a as s,j as a,C as t,B as l,b as r,s as i}from"./index-BFgW40ku.js";import{r as c,u as n}from"./vendor-BHVjIt_u.js";import{I as o}from"./Input-BoeHj-kf.js";import{M as m,A as d,h as x,o as h,E as u,p as b,R as j}from"./ui-Qz4g1iz4.js";import"./supabase-CKbzEL5D.js";function p(){const{signInWithMagicLink:p}=e(),[g,f]=c.useState(!1),[N,w]=c.useState(""),[y,v]=c.useState(""),[k,C]=c.useState(""),[S,E]=c.useState(!1),[L,I]=c.useState(!1),[M,q]=c.useState(!1),U=n();c.useEffect((()=>{const e=s("lastUsedEmail");e&&v(e)}),[]);return a.jsxs("div",{className:"max-w-md mx-auto",children:[a.jsx("h1",{className:"text-2xl font-bold text-center mb-8",children:"ログイン"}),a.jsxs(t,{children:[a.jsxs("div",{className:"flex justify-center mb-4 space-x-2",children:[a.jsx(l,{type:"button",onClick:()=>E(!1),variant:S?"secondary":"primary",style:S?{backgroundColor:"white",color:"#2563eb",borderColor:"#2563eb"}:{backgroundColor:"#2563eb",color:"white",borderColor:"#2563eb"},children:"Magic Link"}),a.jsx(l,{type:"button",onClick:()=>E(!0),variant:S?"primary":"secondary",style:S?{backgroundColor:"#2563eb",color:"white",borderColor:"#2563eb"}:{backgroundColor:"white",color:"#2563eb",borderColor:"#2563eb"},children:"パスワード"})]}),S?a.jsxs("form",{onSubmit:e=>{(async e=>{e.preventDefault(),f(!0),w("");try{const{data:e,error:s}=await i.auth.signInWithPassword({email:y,password:k});if(s)throw s;r("lastUsedEmail",y),U("/dashboard")}catch(s){w(s.message||"ログインに失敗しました。メールアドレスとパスワードを確認してください。")}finally{f(!1)}})(e)},className:"p-6",children:[a.jsxs("div",{className:"text-center mb-6",children:[a.jsx(h,{className:"w-12 h-12 text-blue-600 mx-auto mb-4"}),a.jsx("h2",{className:"text-xl font-semibold mb-2",children:"パスワードでログイン"}),a.jsx("p",{className:"text-gray-600",children:"メールアドレスとパスワードを入力してください。"})]}),N&&a.jsxs("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded-lg flex items-start",children:[a.jsx(d,{className:"w-5 h-5 mr-2 flex-shrink-0 mt-0.5"}),a.jsx("p",{children:N})]}),a.jsx(o,{label:"メールアドレス",type:"email",value:y,onChange:e=>v(e.target.value),required:!0,icon:a.jsx(m,{className:"w-4 h-4 text-gray-500"}),placeholder:"example@email.com"}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"パスワード *"}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:L?"text":"password",value:k,onChange:e=>C(e.target.value),required:!0,className:"w-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"パスワード"}),a.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:a.jsx(h,{className:"h-4 w-4 text-gray-500"})}),a.jsx("button",{type:"button",onClick:()=>I(!L),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700",children:L?a.jsx(u,{className:"h-4 w-4"}):a.jsx(b,{className:"h-4 w-4"})})]})]}),a.jsxs(l,{type:"submit",isLoading:g,className:"w-full mt-4 bg-blue-600 hover:bg-blue-700",children:[a.jsx(h,{className:"w-4 h-4 mr-2"}),"ログイン",a.jsx(x,{className:"w-4 h-4 ml-2"})]}),a.jsx("div",{className:"mt-4 text-center",children:a.jsx("a",{href:"/forgot-password",className:"text-blue-600 hover:text-blue-700 font-medium text-sm",children:"パスワードをお忘れですか？"})})]}):a.jsxs("form",{onSubmit:e=>{(async e=>{e.preventDefault(),f(!0),w("");try{r("lastUsedEmail",y);const{error:e}=await p(y);if(e)throw new Error(e);alert("ログインリンクを送信しました。メールをご確認ください。")}catch(s){w(s.message||"ログインリンクの送信に失敗しました。メールアドレスを確認してください。")}finally{f(!1)}})(e)},className:"p-6",children:[a.jsxs("div",{className:"text-center mb-6",children:[a.jsx(m,{className:"w-12 h-12 text-blue-600 mx-auto mb-4"}),a.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Magic Linkでログイン"}),a.jsx("p",{className:"text-gray-600",children:"メールアドレスを入力するだけで、ドッグパークJPにログインできます。"})]}),N&&a.jsxs("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded-lg flex items-start",children:[a.jsx(d,{className:"w-5 h-5 mr-2 flex-shrink-0 mt-0.5"}),a.jsx("p",{children:N})]}),a.jsx(o,{label:"メールアドレス",type:"email",value:y,onChange:e=>v(e.target.value),required:!0,icon:a.jsx(m,{className:"w-4 h-4 text-gray-500"}),placeholder:"example@email.com"}),a.jsxs(l,{type:"submit",isLoading:g,className:"w-full mt-4 bg-blue-600 hover:bg-blue-700",children:[a.jsx(m,{className:"w-4 h-4 mr-2"}),"ログインリンクを送信",a.jsx(x,{className:"w-4 h-4 ml-2"})]}),a.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(m,{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),a.jsxs("div",{className:"text-sm text-blue-800",children:[a.jsx("p",{className:"font-medium mb-1",children:"Magic Linkとは？"}),a.jsx("p",{children:"パスワードを覚える必要がなく、メールに送信されたリンクをクリックするだけで安全にログインできる便利な認証方法です。"}),a.jsxs("ul",{className:"mt-2 space-y-1",children:[a.jsx("li",{children:"• パスワードを忘れる心配なし"}),a.jsx("li",{children:"• より安全なログイン体験"}),a.jsx("li",{children:"• ワンクリックでログイン完了"})]})]})]})}),a.jsx("div",{className:"mt-4 text-center",children:a.jsxs("p",{className:"text-sm text-gray-600",children:["アカウントをお持ちでない方は"," ",a.jsx("a",{href:"/register",className:"text-blue-600 hover:text-blue-700 font-medium",children:"こちらから新規登録"})]})})]}),a.jsxs("div",{className:"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[a.jsxs("button",{type:"button",onClick:()=>q(!M),className:"flex items-center justify-between w-full text-left",children:[a.jsx("span",{className:"text-sm font-medium text-yellow-800",children:"ログインに問題がある場合"}),a.jsx(x,{className:"w-4 h-4 text-yellow-600 transition-transform "+(M?"rotate-90":"")})]}),M&&a.jsxs("div",{className:"mt-4 space-y-3",children:[a.jsx("p",{className:"text-sm text-yellow-700",children:"本番環境でログインに問題が発生する場合は、以下の操作をお試しください。"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs(l,{size:"sm",variant:"secondary",onClick:()=>{(()=>{try{Object.keys(localStorage).filter((e=>e.includes("supabase")||e.includes("auth")))}catch(N){}})(),alert("診断結果をコンソールに出力しました。F12を押してコンソールを確認してください。")},className:"w-full text-left bg-white hover:bg-gray-50",children:[a.jsx(d,{className:"w-4 h-4 mr-2"}),"ログイン問題の診断"]}),a.jsxs(l,{size:"sm",variant:"secondary",onClick:()=>{if(confirm("ローカルストレージをクリアしますか？これによりログイン問題が解決される場合があります。")){(()=>{try{return!("undefined"==typeof window||!window.localStorage)&&(["sb-onmcivwxtzqajcovptgf-auth-token","supabase.auth.token","lastUsedEmail","isTrustedDevice","maintenance_last_check","maintenance_status"].forEach((e=>{try{localStorage.removeItem(e)}catch(N){}})),window.sessionStorage&&window.sessionStorage.clear(),!0)}catch(N){return!1}})()?(alert("ストレージをクリアしました。ページを再読み込みしてください。"),window.location.reload()):alert("ストレージのクリアに失敗しました。")}},className:"w-full text-left bg-white hover:bg-gray-50",children:[a.jsx(j,{className:"w-4 h-4 mr-2"}),"ストレージをクリア"]})]}),a.jsxs("div",{className:"mt-3 p-3 bg-white rounded border text-xs text-gray-600",children:[a.jsx("p",{className:"font-medium mb-1",children:"推奨手順:"}),a.jsxs("ol",{className:"list-decimal list-inside space-y-1",children:[a.jsx("li",{children:"「ログイン問題の診断」を実行"}),a.jsx("li",{children:"「ストレージをクリア」を実行"}),a.jsx("li",{children:"ブラウザを再起動"}),a.jsx("li",{children:"シークレットモードで動作確認"})]})]})]})]})]})]})}export{p as Login};

import{j as e,C as s,B as r,s as a,h as t,u as l}from"./index-uQwv9uAE.js";import{r as n,L as i,u as c}from"./vendor-BHVjIt_u.js";import{A as o,R as d,N as m,F as x,a3 as u,a6 as h,a as g,s as b,i as j,X as p,Z as y,a7 as N,a8 as f,C as v,W as w,a9 as k,c as C}from"./ui-BLTQwnYp.js";import{I as E}from"./Input-Bg5E4HX5.js";import"./supabase-CKbzEL5D.js";function R({rejectedParks:t,onUpdateRejectedParks:l,onResubmit:i,onError:c}){const[x,u]=n.useState(!1),[h,g]=n.useState(null);return 0===t.length?null:e.jsxs(e.Fragment,{children:[e.jsx(s,{className:"mb-6 bg-red-50 border-red-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(o,{className:"w-6 h-6 text-red-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-red-900 mb-2",children:"却下された申請"}),e.jsx("p",{className:"text-sm text-red-800 mb-4",children:"以下の申請は審査の結果、却下されました。申請内容を見直して再提出するか、削除することができます。"}),e.jsx("div",{className:"space-y-4",children:t.map((s=>e.jsx("div",{className:"bg-white p-4 rounded-lg border border-red-200",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.address}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["申請日: ",new Date(s.created_at).toLocaleDateString("ja-JP")]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(r,{size:"sm",variant:"secondary",onClick:i,children:[e.jsx(d,{className:"w-4 h-4 mr-1"}),"再申請"]}),e.jsxs(r,{size:"sm",variant:"secondary",className:"text-red-600 hover:text-red-700",onClick:()=>g(s.id),children:[e.jsx(m,{className:"w-4 h-4 mr-1"}),"削除"]})]})]})},s.id)))})]})]})}),h&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"申請を削除しますか？"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"この操作は取り消せません。申請を削除してもよろしいですか？"}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(r,{variant:"secondary",onClick:()=>g(null),children:"キャンセル"}),e.jsxs(r,{className:"bg-red-600 hover:bg-red-700",isLoading:x,onClick:()=>(async e=>{try{u(!0);const{error:s}=await a.from("dog_parks").delete().eq("id",e);if(s)throw s;const r=t.filter((s=>s.id!==e));l(r),g(null)}catch(s){c(s.message||"ドッグランの削除に失敗しました")}finally{u(!1)}})(h),children:[e.jsx(m,{className:"w-4 h-4 mr-2"}),"削除する"]})]})]})})]})}function _({formData:a,onFormDataChange:t,onSubmit:l,error:n}){const c=e=>{t(e)};return e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold text-center mb-8",children:"ドッグラン登録 - 第一審査"}),e.jsx(s,{className:"mb-6 bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(x,{className:"w-6 h-6 text-blue-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"審査プロセスについて"}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"第一審査:"})," 基本的な条件の確認"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"本人確認:"})," 安全なプラットフォーム運営のための本人確認"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"第二審査:"})," 詳細な施設情報と書類審査"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"QRコード実証検査:"})," 実際の施設での動作確認"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"掲載・運営開始:"})," 一般公開と予約受付開始"]})]}),e.jsx("div",{className:"mt-3 flex items-center",children:e.jsxs(i,{to:"/owner-payment-system",className:"text-blue-600 hover:text-blue-800 flex items-center",children:[e.jsx(u,{className:"w-4 h-4 mr-1"}),e.jsx("span",{className:"text-sm font-medium",children:"料金体系と収益システムについて詳しく見る"})]})})]})]})}),e.jsx(s,{children:e.jsxs("form",{onSubmit:l,children:[n&&e.jsx("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded-lg",children:n}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"予定地は現在すでにドッグランを運営していますか？ *"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center space-x-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",value:"yes",checked:"yes"===a.isCurrentlyOperating,onChange:e=>c({isCurrentlyOperating:e.target.value,isOwnedLand:"",hasOwnerPermission:"",hasNeighborConsent:""}),className:"form-radio text-blue-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"はい"}),e.jsx("p",{className:"text-sm text-gray-600",children:"既にドッグランとして運営している施設です"})]})]}),e.jsxs("label",{className:"flex items-center space-x-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",value:"no",checked:"no"===a.isCurrentlyOperating,onChange:e=>c({isCurrentlyOperating:e.target.value}),className:"form-radio text-blue-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"いいえ"}),e.jsx("p",{className:"text-sm text-gray-600",children:"新規でドッグランを開設予定です"})]})]})]})]}),"no"===a.isCurrentlyOperating&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"予定地は所有地ですか？ *"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center space-x-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",value:"yes",checked:"yes"===a.isOwnedLand,onChange:e=>c({isOwnedLand:e.target.value,hasOwnerPermission:""}),className:"form-radio text-blue-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"はい"}),e.jsx("p",{className:"text-sm text-gray-600",children:"自己所有の土地です"})]})]}),e.jsxs("label",{className:"flex items-center space-x-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",value:"no",checked:"no"===a.isOwnedLand,onChange:e=>c({isOwnedLand:e.target.value}),className:"form-radio text-blue-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"いいえ"}),e.jsx("p",{className:"text-sm text-gray-600",children:"賃貸または借用地です"})]})]})]})]}),"no"===a.isOwnedLand&&e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"土地所有者の許可を得られていますか？ *"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center space-x-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",value:"yes",checked:"yes"===a.hasOwnerPermission,onChange:e=>c({hasOwnerPermission:e.target.value}),className:"form-radio text-blue-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"はい"}),e.jsx("p",{className:"text-sm text-gray-600",children:"土地所有者からドッグラン運営の許可を得ています"})]})]}),e.jsxs("label",{className:"flex items-center space-x-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",value:"no",checked:"no"===a.hasOwnerPermission,onChange:e=>c({hasOwnerPermission:e.target.value}),className:"form-radio text-blue-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"いいえ"}),e.jsx("p",{className:"text-sm text-gray-600",children:"まだ土地所有者の許可を得ていません"})]})]})]})]}),("yes"===a.isOwnedLand||"no"===a.isOwnedLand)&&e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"近隣住民の理解を得られていますか？ *"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center space-x-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",value:"yes",checked:"yes"===a.hasNeighborConsent,onChange:e=>c({hasNeighborConsent:e.target.value}),className:"form-radio text-blue-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"はい"}),e.jsx("p",{className:"text-sm text-gray-600",children:"近隣住民に説明し、理解を得ています"})]})]}),e.jsxs("label",{className:"flex items-center space-x-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",value:"no",checked:"no"===a.hasNeighborConsent,onChange:e=>c({hasNeighborConsent:e.target.value}),className:"form-radio text-blue-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"いいえ"}),e.jsx("p",{className:"text-sm text-gray-600",children:"まだ近隣住民への説明ができていません"})]})]})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx(E,{label:e.jsx("span",{className:"text-lg font-bold text-gray-800",children:"広さ（㎡） *"}),type:"number",min:"1",value:a.landArea,onChange:e=>c({landArea:e.target.value}),placeholder:"例: 500",required:!0}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"ドッグランの運営には最低100㎡以上の広さが必要です"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"施設までは週に1度程度、状況の確認やメンテナンスに行くことができますか？ *"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center space-x-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",value:"yes",checked:"yes"===a.canVisitWeekly,onChange:e=>c({canVisitWeekly:e.target.value}),className:"form-radio text-blue-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"はい"}),e.jsx("p",{className:"text-sm text-gray-600",children:"週に1度程度の訪問が可能です"})]})]}),e.jsxs("label",{className:"flex items-center space-x-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",value:"no",checked:"no"===a.canVisitWeekly,onChange:e=>c({canVisitWeekly:e.target.value}),className:"form-radio text-blue-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"いいえ"}),e.jsx("p",{className:"text-sm text-gray-600",children:"週に1度程度の訪問は難しいです"})]})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"緊急時に1時間以内に施設まで行ける場所ですか？ *"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center space-x-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",value:"yes",checked:"yes"===a.canReachQuickly,onChange:e=>c({canReachQuickly:e.target.value}),className:"form-radio text-blue-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"はい"}),e.jsx("p",{className:"text-sm text-gray-600",children:"緊急時に1時間以内に到着できます"})]})]}),e.jsxs("label",{className:"flex items-center space-x-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",value:"no",checked:"no"===a.canReachQuickly,onChange:e=>c({canReachQuickly:e.target.value}),className:"form-radio text-blue-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"いいえ"}),e.jsx("p",{className:"text-sm text-gray-600",children:"緊急時に1時間以内の到着は難しいです"})]})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"反社会的勢力との関係について *"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center space-x-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",value:"no",checked:"no"===a.isAntiSocialForces,onChange:e=>c({isAntiSocialForces:e.target.value}),className:"form-radio text-blue-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"いいえ"}),e.jsx("p",{className:"text-sm text-gray-600",children:"反社会的勢力との関係はありません"})]})]}),e.jsxs("label",{className:"flex items-center space-x-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",value:"yes",checked:"yes"===a.isAntiSocialForces,onChange:e=>c({isAntiSocialForces:e.target.value}),className:"form-radio text-red-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"はい"}),e.jsx("p",{className:"text-sm text-gray-600",children:"反社会的勢力との関係があります"})]})]})]}),e.jsx("div",{className:"mt-2 p-3 bg-red-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(h,{className:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-red-800",children:"反社会的勢力との関係がある場合、ドッグランの登録はできません。当社は反社会的勢力との関係を一切認めておりません。"})]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-lg font-bold text-gray-800 mb-3",children:"予定設備 *"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Object.entries({parking:"駐車場",shower:"シャワー設備",restroom:"トイレ",agility:"アジリティ設備",rest_area:"休憩スペース",water_station:"給水設備"}).map((([s,r])=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:a.facilities[s],onChange:e=>c({facilities:{...a.facilities,[s]:e.target.checked}}),className:"rounded text-blue-600"}),e.jsx("span",{className:"text-sm",children:r})]},s)))})]}),e.jsx("div",{className:"mt-6 p-4 bg-yellow-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(o,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"第一審査について"}),e.jsxs("ul",{className:"space-y-1 text-xs",children:[e.jsx("li",{children:"• 基本的な開設条件を満たしているかを確認します"}),e.jsx("li",{children:"• 通過後、本人確認を行います"}),e.jsx("li",{children:"• 本人確認後、詳細な施設情報の入力に進みます"}),e.jsx("li",{children:"• 第二審査では書類審査を行います"}),e.jsx("li",{children:"• 最終的にQRコード実証検査を経て掲載開始となります"})]})]})]})}),e.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[e.jsxs(i,{to:"/owner-payment-system",className:"text-blue-600 hover:text-blue-800 flex items-center",children:[e.jsx(u,{className:"w-4 h-4 mr-1"}),e.jsx("span",{className:"text-sm",children:"収益システムについて"})]}),e.jsx(r,{type:"submit",className:"w-1/2 bg-blue-600 hover:bg-blue-700",children:"第一審査を申し込む"})]})]})})]})}function D({onBack:t,onNext:l,onError:i,error:c,user:d}){const[m,x]=n.useState(null),[u,h]=n.useState(!1);return e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold text-center mb-8",children:"ドッグラン登録 - 本人確認"}),e.jsx(s,{className:"mb-6 bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(g,{className:"w-6 h-6 text-blue-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"本人確認について"}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("p",{children:"安全なプラットフォーム運営のため、ドッグランオーナーには本人確認が必要です。"}),e.jsx("p",{children:"運転免許証、マイナンバーカード、パスポートなどの本人確認書類の画像をアップロードしてください。"}),e.jsx("p",{children:"アップロードされた書類は管理者が手動で確認します。"})]})]})]})}),c&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(o,{className:"w-5 h-5 text-red-600 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-800",children:c})]})}),e.jsxs(s,{className:"p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"本人確認書類のアップロード *"}),e.jsx("input",{type:"file",accept:"image/*,application/pdf",onChange:e=>{e.target.files&&e.target.files[0]&&x(e.target.files[0])},className:"block w-full text-sm text-gray-700 border border-gray-300 rounded-lg cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"運転免許証・マイナンバーカード・パスポート等の画像またはPDF"})]}),e.jsxs("div",{className:"flex justify-between items-center mt-6",children:[e.jsx(r,{variant:"secondary",onClick:t,children:"前のステップに戻る"}),e.jsxs(r,{onClick:async()=>{if(m)if(d){h(!0),i("");try{const e=`${d.id}_${Date.now()}_${m.name}`,{data:s,error:r}=await a.storage.from("identity-documents").upload(e,m,{upsert:!0});if(r)throw r;const{error:t}=await a.from("owner_verifications").upsert({user_id:d.id,document_url:s.path,status:"uploaded",created_at:(new Date).toISOString()},{onConflict:"user_id"});if(t)throw t;l()}catch(e){i(e instanceof Error?e.message:"アップロードに失敗しました。")}finally{h(!1)}}else i("ユーザー情報が取得できません。再度ログインしてください。");else i("本人確認書類のファイルを選択してください。")},isLoading:u,className:"bg-blue-600 hover:bg-blue-700",disabled:!m||u,children:[e.jsx(g,{className:"w-4 h-4 mr-2"}),"書類をアップロードして次へ"]})]})]}),e.jsx("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(O,{className:"w-5 h-5 text-gray-600 mt-1"}),e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("p",{className:"font-medium mb-1",children:"プライバシーと安全性"}),e.jsx("p",{children:"アップロードされた本人確認書類は厳重に管理され、管理者以外が閲覧することはありません。 審査完了後、速やかに削除されます。"})]})]})})]})}function O({className:s}){return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]})}function A({formData:a,onFormDataChange:t,onSubmit:l,error:n,isLoading:c}){const o=e=>{t(e)};return e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(b,{className:"w-6 h-6 text-green-600"}),e.jsx("span",{className:"text-green-800 font-medium",children:"第一審査通過・本人確認完了"})]}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"ドッグラン登録 - 詳細情報入力"}),e.jsx("p",{className:"text-gray-600",children:"第一審査を通過し、本人確認が完了しました。詳細な施設情報を入力してください。"})]}),e.jsx(s,{className:"mb-6 bg-green-50 border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(b,{className:"w-6 h-6 text-green-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-green-900",children:"第一審査・本人確認完了"}),e.jsx("p",{className:"text-sm text-green-800",children:"基本条件をクリアしました"})]})]}),e.jsx("div",{className:"text-right text-sm text-green-700",children:e.jsx("p",{children:"次のステップ: 第二審査（書類審査）"})})]})}),e.jsx(s,{children:e.jsxs("form",{onSubmit:l,children:[n&&e.jsx("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded-lg",children:n}),e.jsx(E,{label:"施設名 *",value:a.name,onChange:e=>o({name:e.target.value}),required:!0}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"説明 *"}),e.jsx("textarea",{value:a.description,onChange:e=>o({description:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,required:!0})]}),e.jsx(E,{label:"住所 *",value:a.address,onChange:e=>o({address:e.target.value}),required:!0}),e.jsxs("div",{className:"mb-4 p-4 bg-blue-50 rounded-lg",children:[e.jsxs("h3",{className:"font-semibold text-blue-900 mb-2 flex items-center",children:[e.jsx(u,{className:"w-5 h-5 mr-2"}),"料金情報（全国統一）"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-blue-800",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"通常利用料金"}),e.jsx("p",{children:"¥800/日（固定）"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"施設貸し切り料金"}),e.jsx("p",{children:"¥4,400/時間（固定）"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"サブスクリプション"}),e.jsx("p",{children:"¥3,800/月（全国共通）"})]})]}),e.jsx("p",{className:"text-xs text-blue-600 mt-2",children:"※ 料金はシステムで自動設定されます。オーナー様の取り分は売上の80%です。"})]}),e.jsx(E,{label:"最大収容人数 *",type:"number",min:"1",value:a.maxCapacity,onChange:e=>o({maxCapacity:e.target.value}),required:!0}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"対応犬種サイズ"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:a.largeDogArea,onChange:e=>o({largeDogArea:e.target.checked}),className:"rounded text-blue-600"}),e.jsx("span",{children:"大型犬エリア"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:a.smallDogArea,onChange:e=>o({smallDogArea:e.target.checked}),className:"rounded text-blue-600"}),e.jsx("span",{children:"小型犬エリア"})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"flex items-center space-x-2 mb-3",children:[e.jsx("input",{type:"checkbox",checked:a.privateBooths,onChange:e=>o({privateBooths:e.target.checked,privateBoothCount:e.target.checked?a.privateBoothCount:"0"}),className:"rounded text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"プライベートブースあり"})]}),a.privateBooths&&e.jsxs("div",{className:"ml-6",children:[e.jsx(E,{label:"ブース数",type:"number",min:"1",value:a.privateBoothCount,onChange:e=>o({privateBoothCount:e.target.value})}),e.jsxs("div",{className:"mt-2 p-3 bg-blue-50 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("span",{className:"font-medium",children:"プライベートブース料金:"})," サブスク使い放題・1日券でも利用可能（追加料金なし）"]}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"※ 料金はシステムで自動設定されます"})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"設備・サービス（第一審査で選択した内容を確認・修正できます）"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries({parking:"駐車場",shower:"シャワー設備",restroom:"トイレ",agility:"アジリティ設備",rest_area:"休憩スペース",water_station:"給水設備"}).map((([s,r])=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:a.facilities[s],onChange:e=>o({facilities:{...a.facilities,[s]:e.target.checked}}),className:"rounded text-blue-600"}),e.jsx("span",{children:r})]},s)))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"設備の詳細情報"}),e.jsx("textarea",{value:a.facilityDetails,onChange:e=>o({facilityDetails:e.target.value}),placeholder:"設備やサービスについての詳細な情報を入力してください",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3})]}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(j,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"第二審査について"}),e.jsxs("ul",{className:"space-y-1 text-xs",children:[e.jsx("li",{children:"• 詳細な施設情報と必要書類の審査を行います"}),e.jsx("li",{children:"• 審査期間は通常3-5営業日です"}),e.jsx("li",{children:"• 通過後、QRコード実証検査の日程調整を行います"}),e.jsx("li",{children:"• 実証検査完了後、一般公開となります"})]})]})]})}),e.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[e.jsxs(i,{to:"/owner-payment-system",className:"text-blue-600 hover:text-blue-800 flex items-center",children:[e.jsx(u,{className:"w-4 h-4 mr-1"}),e.jsx("span",{className:"text-sm",children:"収益システムについて"})]}),e.jsx(r,{type:"submit",isLoading:c,className:"bg-blue-600 hover:bg-blue-700",children:"第二審査に申し込む"})]})]})})]})}const S=({type:s,className:r="w-6 h-6"})=>{switch(s){case"network":return e.jsx(w,{className:`${r} text-orange-600`});case"authentication":return e.jsx(g,{className:`${r} text-red-600`});case"authorization":return e.jsx(h,{className:`${r} text-red-600`});case"validation":return e.jsx(o,{className:`${r} text-yellow-600`});case"timeout":return e.jsx(v,{className:`${r} text-blue-600`});case"server":return e.jsx(f,{className:`${r} text-red-600`});case"not_found":return e.jsx(N,{className:`${r} text-gray-600`});case"storage":return e.jsx(N,{className:`${r} text-orange-600`});case"payment":return e.jsx(y,{className:`${r} text-purple-600`});default:return e.jsx(o,{className:`${r} text-gray-600`})}},L=({error:a,onClear:t,onRetry:l,className:i="",showAsModal:c=!1})=>{if(n.useEffect((()=>{if(a&&"low"===a.severity&&"validation"===a.type){const e=setTimeout((()=>{t()}),5e3);return()=>clearTimeout(e)}}),[a,t]),!a)return null;const o=(e=>{switch(e){case"low":return{bg:"bg-yellow-50",border:"border-yellow-200",text:"text-yellow-800",button:"bg-yellow-600 hover:bg-yellow-700"};case"medium":return{bg:"bg-orange-50",border:"border-orange-200",text:"text-orange-800",button:"bg-orange-600 hover:bg-orange-700"};case"high":return{bg:"bg-red-50",border:"border-red-200",text:"text-red-800",button:"bg-red-600 hover:bg-red-700"};case"critical":return{bg:"bg-red-100",border:"border-red-300",text:"text-red-900",button:"bg-red-700 hover:bg-red-800"};default:return{bg:"bg-gray-50",border:"border-gray-200",text:"text-gray-800",button:"bg-gray-600 hover:bg-gray-700"}}})(a.severity),m=e.jsx("div",{className:`${o.bg} ${o.border} border rounded-lg p-4 ${i}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(S,{type:a.type,className:"flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`text-sm font-medium ${o.text} mb-1`,children:"エラーが発生しました"}),e.jsx("p",{className:`text-sm ${o.text} mb-3`,children:a.userMessage}),!1]}),!c&&e.jsx("button",{onClick:t,className:`ml-2 ${o.text} hover:opacity-75`,"aria-label":"エラーを閉じる",children:e.jsx(p,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:(()=>{const s=[];return a.retryable&&l&&s.push(e.jsxs(r,{size:"sm",onClick:()=>{l()},className:o.button,children:[e.jsx(d,{className:"w-4 h-4 mr-1"}),"再試行"]},"retry")),"authentication"===a.type&&s.push(e.jsxs(r,{size:"sm",onClick:()=>window.location.href="/login",className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(k,{className:"w-4 h-4 mr-1"}),"ログイン"]},"login")),"high"!==a.severity&&"critical"!==a.severity||s.push(e.jsxs(r,{size:"sm",variant:"secondary",onClick:()=>window.location.href="/",children:[e.jsx(C,{className:"w-4 h-4 mr-1"}),"ホームに戻る"]},"home")),s.push(e.jsxs(r,{size:"sm",variant:"secondary",onClick:t,children:[e.jsx(p,{className:"w-4 h-4 mr-1"}),"閉じる"]},"close")),s})()})]})]})});return c?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx(s,{className:"max-w-md w-full",children:m})}):m};const $={maxAttempts:3,baseDelay:1e3,maxDelay:1e4,backoffFactor:2,retryableErrors:["network","timeout","server","storage"],autoRetry:!0};const I={maxAttempts:3,baseDelay:1e3,maxDelay:5e3,backoffFactor:1.5,retryableErrors:["network","timeout","server"],autoRetry:!0};function M(){const s=c(),{user:r}=l(),[i,o]=n.useState(!1),[d,m]=n.useState(1),[x,u]=n.useState([]),{error:h,clearError:g,handleError:b,executeWithErrorHandling:j}=function(){const[e,s]=n.useState(null),[r,a]=n.useState(!1),[l,i]=n.useState(null),c=n.useCallback((()=>{s(null),i(null)}),[]),o=n.useCallback((e=>{if(e instanceof Error){const s=e.message.toLowerCase();if(s.includes("network")||s.includes("fetch")||s.includes("connection"))return{type:"network",severity:"medium",message:e.message,originalError:e,userMessage:"ネットワーク接続に問題があります。インターネット接続を確認してください。",recoverable:!0,retryable:!0};if(s.includes("timeout")||s.includes("timed out")||"AbortError"===e.name)return{type:"timeout",severity:"medium",message:e.message,originalError:e,userMessage:"リクエストがタイムアウトしました。もう一度お試しください。",recoverable:!0,retryable:!0};if(s.includes("jwt")||s.includes("unauthorized")||s.includes("refresh_token"))return{type:"authentication",severity:"high",message:e.message,originalError:e,userMessage:"セッションが期限切れです。再度ログインしてください。",recoverable:!0,retryable:!1};if(s.includes("forbidden")||s.includes("permission")||s.includes("row-level security"))return{type:"authorization",severity:"high",message:e.message,originalError:e,userMessage:"この操作を実行する権限がありません。",recoverable:!1,retryable:!1};if(s.includes("validation")||s.includes("invalid")||s.includes("required"))return{type:"validation",severity:"low",message:e.message,originalError:e,userMessage:"入力内容に問題があります。確認してください。",recoverable:!0,retryable:!1};if(s.includes("storage")||s.includes("bucket")||s.includes("file"))return{type:"storage",severity:"medium",message:e.message,originalError:e,userMessage:"ファイルの処理中にエラーが発生しました。しばらく待ってから再度お試しください。",recoverable:!0,retryable:!0};if(s.includes("payment")||s.includes("stripe")||s.includes("subscription"))return{type:"payment",severity:"high",message:e.message,originalError:e,userMessage:"決済処理中にエラーが発生しました。カード情報を確認してください。",recoverable:!0,retryable:!0};if(s.includes("500")||s.includes("502")||s.includes("503")||s.includes("520"))return{type:"server",severity:"high",message:e.message,originalError:e,userMessage:"サーバーで一時的な問題が発生しています。しばらく待ってから再度お試しください。",recoverable:!0,retryable:!0};if(s.includes("404")||s.includes("not found"))return{type:"not_found",severity:"medium",message:e.message,originalError:e,userMessage:"要求されたリソースが見つかりません。",recoverable:!1,retryable:!1}}if("object"==typeof e&&null!==e&&"code"in e){const s=t(e);return{type:"server",severity:"medium",message:s,originalError:e,userMessage:s,recoverable:!0,retryable:!0}}return{type:"unknown",severity:"medium",message:e instanceof Error?e.message:String(e),originalError:e,userMessage:"予期しないエラーが発生しました。しばらく待ってから再度お試しください。",recoverable:!0,retryable:!0}}),[]),d=n.useCallback((e=>{e.severity}),[]),m=n.useCallback(((e,r)=>{const a={...o(e),timestamp:new Date,context:r};d(a),s(a)}),[o,d]),x=n.useCallback((async(e,s)=>{a(!0),c();try{const s=await e();return a(!1),s}catch(r){return m(r,s),a(!1),o(r).retryable&&i((()=>async()=>{await x(e,s)})),null}}),[m,c,o]);return{error:e,isLoading:r,clearError:c,handleError:m,retryAction:l,executeWithErrorHandling:x}}(),p=function(e={}){const s={...$,...e},[r,a]=n.useState({attempts:0,isRetrying:!1,lastError:null,nextRetryIn:0}),t=n.useRef(),l=n.useRef(),i=n.useCallback((()=>{t.current&&clearTimeout(t.current),l.current&&clearInterval(l.current),a({attempts:0,isRetrying:!1,lastError:null,nextRetryIn:0})}),[]),c=n.useCallback((()=>{t.current&&clearTimeout(t.current),l.current&&clearInterval(l.current),a((e=>({...e,isRetrying:!1,nextRetryIn:0})))}),[]),o=n.useCallback((e=>{const r=s.baseDelay*Math.pow(s.backoffFactor,e);return Math.min(r,s.maxDelay)}),[s]),d=n.useCallback((e=>{const r=e.message.toLowerCase();return!!(s.retryableErrors.includes("network")&&(r.includes("network")||r.includes("fetch")||r.includes("connection"))||s.retryableErrors.includes("timeout")&&(r.includes("timeout")||r.includes("timed out")||"AbortError"===e.name)||s.retryableErrors.includes("server")&&(r.includes("500")||r.includes("502")||r.includes("503")||r.includes("520"))||s.retryableErrors.includes("storage")&&(r.includes("storage")||r.includes("bucket")))}),[s.retryableErrors]),m=n.useCallback(((e,s)=>{let r=Math.ceil(e/1e3);a((e=>({...e,nextRetryIn:r}))),l.current=setInterval((()=>{r--,a((e=>({...e,nextRetryIn:r}))),r<=0&&(l.current&&clearInterval(l.current),s())}),1e3)}),[]),x=n.useCallback((async(e,r=0)=>{try{a((e=>({...e,attempts:r,lastError:null})));const s=await e();return i(),s}catch(h){const n=h instanceof Error?h:new Error(String(h));if(a((e=>({...e,lastError:n}))),r>=s.maxAttempts-1)throw a((e=>({...e,isRetrying:!1}))),n;if(!d(n))throw a((e=>({...e,isRetrying:!1}))),n;if(!s.autoRetry)throw a((e=>({...e,isRetrying:!1}))),n;const i=o(r);return a((e=>({...e,isRetrying:!0}))),new Promise(((s,a)=>{m(i,(()=>{t.current=setTimeout((()=>{x(e,r+1).then(s).catch(a)}),0)}))}))}}),[s,d,o,i,m]);return{execute:n.useCallback((e=>x(e,0)),[x]),state:r,reset:i,cancelRetry:c}}(I),[y,N]=n.useState({isCurrentlyOperating:"",isOwnedLand:"",hasOwnerPermission:"",hasNeighborConsent:"",landArea:"",isAntiSocialForces:"",canVisitWeekly:"",canReachQuickly:"",name:"",description:"",address:"",maxCapacity:"10",largeDogArea:!0,smallDogArea:!0,privateBooths:!1,privateBoothCount:"0",facilities:{parking:!1,shower:!1,restroom:!1,agility:!1,rest_area:!1,water_station:!1},facilityDetails:""});n.useEffect((()=>{r?f():s("/login")}),[r,s]);const f=async()=>{await j((async()=>{const{data:e,error:s}=await a.from("dog_parks").select("*").eq("owner_id",r?.id).eq("status","rejected");if(s)throw s;u(e||[])}),{operation:"fetch_rejected_parks"})},v=async e=>{e.preventDefault(),await j((async()=>{(e=>{if(!e.isCurrentlyOperating)throw new Error("現在の運営状況を選択してください。");if("no"===e.isCurrentlyOperating){if(!e.isOwnedLand)throw new Error("予定地の所有状況を選択してください。");if("no"===e.isOwnedLand&&!e.hasOwnerPermission)throw new Error("土地所有者の許可について選択してください。");if(!e.hasNeighborConsent)throw new Error("近隣住民の理解について選択してください。")}if(!e.landArea||parseInt(e.landArea)<=0)throw new Error("広さを正しく入力してください。");if(!e.isAntiSocialForces)throw new Error("反社会的勢力との関係について選択してください。");if("yes"===e.isAntiSocialForces)throw new Error("反社会的勢力との関係がある場合、ドッグランの登録はできません。");if(!e.canVisitWeekly)throw new Error("週1回の訪問可否について選択してください。");if(!e.canReachQuickly)throw new Error("緊急時の到着可否について選択してください。");if("no"===e.isCurrentlyOperating){if("no"===e.isOwnedLand&&"no"===e.hasOwnerPermission)throw new Error("土地所有者の許可を得てからお申し込みください。借用地でのドッグラン運営には所有者の同意が必要です。");if("no"===e.hasNeighborConsent)throw new Error("近隣住民の理解を得てからお申し込みください。地域との良好な関係は運営において重要です。")}if(parseInt(e.landArea)<100)throw new Error("ドッグランの運営には最低100㎡以上の広さが必要です。");if("no"===e.canVisitWeekly)throw new Error("週に1度程度の訪問が必要です。施設の状況確認やメンテナンスのため、定期的な訪問ができる方のみお申し込みください。");if("no"===e.canReachQuickly)throw new Error("緊急時に1時間以内に施設に到着できることが必要です。迅速な対応ができる方のみお申し込みください。")})(y),m(2)}),{operation:"first_stage_validation"})},w=()=>{N({isCurrentlyOperating:"",isOwnedLand:"",hasOwnerPermission:"",hasNeighborConsent:"",landArea:"",isAntiSocialForces:"",canVisitWeekly:"",canReachQuickly:"",name:"",description:"",address:"",maxCapacity:"10",largeDogArea:!0,smallDogArea:!0,privateBooths:!1,privateBoothCount:"0",facilities:{parking:!1,shower:!1,restroom:!1,agility:!1,rest_area:!1,water_station:!1},facilityDetails:""}),m(1),g()},k=e=>{N({...y,...e})},C=e=>{u(e)};return 2===d?e.jsxs("div",{children:[e.jsx(L,{error:h,onClear:g,onRetry:p.state.isRetrying?void 0:()=>p.execute((()=>f())),className:"mb-6"}),p.state.isRetrying&&e.jsx("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-800 font-medium",children:"自動リトライ中..."}),e.jsxs("p",{className:"text-blue-600 text-sm",children:["試行回数: ",p.state.attempts+1,"/",I.maxAttempts,p.state.nextRetryIn>0&&` | 次の試行まで: ${p.state.nextRetryIn}秒`]})]}),e.jsx("button",{onClick:p.cancelRetry,className:"text-blue-600 hover:text-blue-800 text-sm underline",children:"キャンセル"})]})}),e.jsx(D,{onBack:()=>m(1),onNext:()=>m(3),onError:b,error:h?.userMessage||"",user:r})]}):1===d?e.jsxs("div",{children:[e.jsx(L,{error:h,onClear:g,className:"mb-6"}),e.jsx(R,{rejectedParks:x,onUpdateRejectedParks:C,onResubmit:w,onError:b}),e.jsx(_,{formData:y,onFormDataChange:k,onSubmit:v,error:h?.userMessage||""})]}):e.jsxs("div",{children:[e.jsx(L,{error:h,onClear:g,onRetry:p.state.isRetrying?void 0:()=>p.execute((()=>Promise.resolve())),className:"mb-6"}),p.state.isRetrying&&e.jsx("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-800 font-medium",children:"自動リトライ中..."}),e.jsxs("p",{className:"text-blue-600 text-sm",children:["試行回数: ",p.state.attempts+1,"/",I.maxAttempts,p.state.nextRetryIn>0&&` | 次の試行まで: ${p.state.nextRetryIn}秒`]})]}),e.jsx("button",{onClick:p.cancelRetry,className:"text-blue-600 hover:text-blue-800 text-sm underline",children:"キャンセル"})]})}),e.jsx(A,{formData:y,onFormDataChange:k,onSubmit:async e=>{e.preventDefault(),o(!0);try{await p.execute((async()=>{const{data:{user:e},error:r}=await a.auth.getUser();if(r||!e)throw new Error("ユーザー認証に失敗しました。再度ログインしてください。");const{error:t}=await a.from("profiles").update({user_type:"owner"}).eq("id",e.id);if(t)throw new Error("プロフィールの更新に失敗しました。");const{error:l}=await a.from("dog_parks").insert([{owner_id:e.id,name:y.name,description:y.description,address:y.address,price:800,max_capacity:parseInt(y.maxCapacity,10),large_dog_area:y.largeDogArea,small_dog_area:y.smallDogArea,private_booths:y.privateBooths,private_booth_count:parseInt(y.privateBoothCount,10),private_booth_price:0,facilities:y.facilities,facility_details:y.facilityDetails,status:"pending"}]);if(l)throw l;s("/owner-dashboard")}))}catch(r){b(r,{operation:"park_registration_submit",form_data:{name:y.name,address:y.address,max_capacity:y.maxCapacity}})}finally{o(!1)}},error:h?.userMessage||"",isLoading:i||p.state.isRetrying})]})}export{M as ParkRegistration};

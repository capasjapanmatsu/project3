import{u as e,s,j as a,C as t,B as r}from"./index-BFgW40ku.js";import{u as n,r as c,L as l}from"./vendor-BHVjIt_u.js";import{J as i,a4 as d,A as x,t as m,j as o,aE as h,G as u,aq as p,m as j,C as b,F as g}from"./ui-Qz4g1iz4.js";import"./supabase-CKbzEL5D.js";function f(){const{user:f}=e(),N=n(),[_,w]=c.useState(!0),[v,k]=c.useState(""),[S,C]=c.useState(""),[L,E]=c.useState([]),[q,D]=c.useState(null),[$,z]=c.useState(!1),[B,F]=c.useState(!1),[G,J]=c.useState({bank_name:"",bank_code:"",branch_name:"",branch_code:"",account_type:"ordinary",account_number:"",account_holder_name:""}),[M,T]=c.useState(0),[V,A]=c.useState(0);c.useEffect((()=>{f?H():N("/login")}),[f,N]);const H=async()=>{try{w(!0);const{data:e,error:a}=await s.from("monthly_payouts").select("*").order("year",{ascending:!1}).order("month",{ascending:!1});if(a)throw a;E(e||[]);const t=(e||[]).reduce(((e,s)=>e+s.total_revenue),0),r=(e||[]).reduce(((e,s)=>e+s.owner_payout),0);T(t),A(r);const{data:n,error:c}=await s.from("owner_bank_accounts").select("*").eq("owner_id",f?.id).maybeSingle();if(c&&"PGRST116"!==c.code)throw c;D(n),n&&J({id:n.id,bank_name:n.bank_name,bank_code:n.bank_code,branch_name:n.branch_name,branch_code:n.branch_code,account_type:n.account_type,account_number:n.account_number,account_holder_name:n.account_holder_name})}catch(e){k(e.message||"データの取得に失敗しました")}finally{w(!1)}},P=e=>({pending:"振込予定",processing:"振込処理中",completed:"振込完了"}[e]||e);return _?a.jsx("div",{className:"flex justify-center items-center h-64",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):a.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[a.jsx("div",{className:"flex items-center space-x-4 mb-6",children:a.jsxs(l,{to:"/owner-dashboard",className:"flex items-center text-blue-600 hover:text-blue-800",children:[a.jsx(i,{className:"w-4 h-4 mr-2"}),"オーナーダッシュボードに戻る"]})}),a.jsxs("div",{className:"text-center mb-8",children:[a.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-4 flex items-center justify-center",children:[a.jsx(d,{className:"w-8 h-8 text-green-600 mr-3"}),"収益管理システム"]}),a.jsx("p",{className:"text-lg text-gray-600",children:"ドッグラン施設の収益と振込情報を管理します"})]}),v&&a.jsxs("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4 flex items-start",children:[a.jsx(x,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),a.jsx("p",{children:v})]}),S&&a.jsxs("div",{className:"bg-green-100 border border-green-300 text-green-800 rounded-lg p-4 flex items-start",children:[a.jsx(m,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),a.jsx("p",{children:S})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[a.jsx(t,{className:"p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"総売上"}),a.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["¥",M.toLocaleString()]})]}),a.jsx(d,{className:"w-8 h-8 text-green-600"})]})}),a.jsx(t,{className:"p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"プラットフォーム手数料"}),a.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["¥",(.2*M).toLocaleString()]}),a.jsx("p",{className:"text-xs text-blue-600",children:"売上の20%"})]}),a.jsx(o,{className:"w-8 h-8 text-blue-600"})]})}),a.jsx(t,{className:"p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"オーナー取り分"}),a.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:["¥",V.toLocaleString()]}),a.jsx("p",{className:"text-xs text-purple-600",children:"売上の80%"})]}),a.jsx(h,{className:"w-8 h-8 text-purple-600"})]})})]}),a.jsxs(t,{className:"p-6",children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[a.jsx(h,{className:"w-6 h-6 text-blue-600 mr-2"}),"振込先情報"]}),q&&!$?a.jsxs(r,{onClick:()=>z(!0),size:"sm",children:[a.jsx(y,{className:"w-4 h-4 mr-2"}),"編集する"]}):null]}),$?a.jsxs("form",{onSubmit:async e=>{e.preventDefault(),F(!0),k(""),C("");try{if(!G.bank_name)throw new Error("銀行名を入力してください");if(!G.bank_code)throw new Error("銀行コードを入力してください");if(!G.branch_name)throw new Error("支店名を入力してください");if(!G.branch_code)throw new Error("支店コードを入力してください");if(!G.account_number)throw new Error("口座番号を入力してください");if(!G.account_holder_name)throw new Error("口座名義を入力してください");if(!/^\d{4}$/.test(G.bank_code))throw new Error("銀行コードは4桁の数字で入力してください");if(!/^\d{3}$/.test(G.branch_code))throw new Error("支店コードは3桁の数字で入力してください");if(!/^\d{7}$/.test(G.account_number))throw new Error("口座番号は7桁の数字で入力してください");if(q){const{error:e}=await s.from("owner_bank_accounts").update({bank_name:G.bank_name,bank_code:G.bank_code,branch_name:G.branch_name,branch_code:G.branch_code,account_type:G.account_type,account_number:G.account_number,account_holder_name:G.account_holder_name}).eq("id",q.id);if(e)throw e}else{const{error:e}=await s.from("owner_bank_accounts").insert({owner_id:f?.id,bank_name:G.bank_name,bank_code:G.bank_code,branch_name:G.branch_name,branch_code:G.branch_code,account_type:G.account_type,account_number:G.account_number,account_holder_name:G.account_holder_name});if(e)throw e}C("振込先情報を保存しました"),z(!1),await H(),setTimeout((()=>{C("")}),3e3)}catch(a){k(a.message||"振込先情報の保存に失敗しました")}finally{F(!1)}},children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"銀行名 *"}),a.jsx("input",{type:"text",value:G.bank_name,onChange:e=>J({...G,bank_name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例：三菱UFJ銀行",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"銀行コード（4桁） *"}),a.jsx("input",{type:"text",value:G.bank_code,onChange:e=>{const s=e.target.value.replace(/\D/g,"");J({...G,bank_code:s})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例：0005",maxLength:4,required:!0}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"4桁の数字で入力してください"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"支店名 *"}),a.jsx("input",{type:"text",value:G.branch_name,onChange:e=>J({...G,branch_name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例：渋谷支店",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"支店コード（3桁） *"}),a.jsx("input",{type:"text",value:G.branch_code,onChange:e=>{const s=e.target.value.replace(/\D/g,"");J({...G,branch_code:s})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例：135",maxLength:3,required:!0}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"3桁の数字で入力してください"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"口座種別 *"}),a.jsxs("div",{className:"flex space-x-4",children:[a.jsxs("label",{className:"flex items-center space-x-2",children:[a.jsx("input",{type:"radio",checked:"ordinary"===G.account_type,onChange:()=>J({...G,account_type:"ordinary"}),className:"form-radio text-blue-600"}),a.jsx("span",{children:"普通"})]}),a.jsxs("label",{className:"flex items-center space-x-2",children:[a.jsx("input",{type:"radio",checked:"checking"===G.account_type,onChange:()=>J({...G,account_type:"checking"}),className:"form-radio text-blue-600"}),a.jsx("span",{children:"当座"})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"口座番号（7桁） *"}),a.jsx("input",{type:"text",value:G.account_number,onChange:e=>{const s=e.target.value.replace(/\D/g,"");J({...G,account_number:s})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例：1234567",maxLength:7,required:!0}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"7桁の数字で入力してください"})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"口座名義（カタカナ） *"}),a.jsx("input",{type:"text",value:G.account_holder_name,onChange:e=>J({...G,account_holder_name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例：ヤマダ タロウ",required:!0}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"カタカナで入力してください（姓と名の間にスペース）"})]})]}),a.jsxs("div",{className:"flex justify-end space-x-3",children:[q&&a.jsx(r,{type:"button",variant:"secondary",onClick:()=>z(!1),children:"キャンセル"}),a.jsx(r,{type:"submit",isLoading:B,children:"保存する"})]})]}):q?a.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-500",children:"銀行名"}),a.jsx("p",{className:"font-medium",children:q.bank_name})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-500",children:"銀行コード"}),a.jsx("p",{className:"font-medium",children:q.bank_code})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-500",children:"支店名"}),a.jsx("p",{className:"font-medium",children:q.branch_name})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-500",children:"支店コード"}),a.jsx("p",{className:"font-medium",children:q.branch_code})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-500",children:"口座種別"}),a.jsx("p",{className:"font-medium",children:"ordinary"===q.account_type?"普通":"当座"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-500",children:"口座番号"}),a.jsx("p",{className:"font-medium",children:q.account_number})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("p",{className:"text-sm text-gray-500",children:"口座名義"}),a.jsx("p",{className:"font-medium",children:q.account_holder_name})]})]})}):a.jsxs("div",{className:"text-center py-8",children:[a.jsx(h,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600 mb-4",children:"振込先情報が登録されていません"}),a.jsx(r,{onClick:()=>z(!0),children:"振込先情報を登録する"})]})]}),a.jsxs(t,{className:"p-6",children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[a.jsx(u,{className:"w-6 h-6 text-blue-600 mr-2"}),"月別収益"]}),a.jsxs(r,{variant:"secondary",size:"sm",onClick:()=>{alert("CSVダウンロード機能は準備中です")},children:[a.jsx(p,{className:"w-4 h-4 mr-2"}),"CSV出力"]})]}),0===L.length?a.jsxs("div",{className:"text-center py-8",children:[a.jsx(j,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"まだ収益データがありません"}),a.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"ドッグランの利用があると、ここに収益データが表示されます"})]}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full bg-white",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"年月"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"施設名"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"売上合計"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"手数料（20%）"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"振込金額（80%）"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ステータス"})]})}),a.jsx("tbody",{className:"divide-y divide-gray-200",children:L.map((e=>{return a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:[e.year,"年",(t=e.month,["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"][t-1])]}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.park_name}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["¥",e.total_revenue.toLocaleString()]}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:["¥",e.platform_fee.toLocaleString()]}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-green-600",children:["¥",e.owner_payout.toLocaleString()]}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:a.jsx("span",{className:`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${s=e.status,{pending:"bg-yellow-100 text-yellow-800",processing:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800"}[s]||"bg-gray-100 text-gray-800"}`,children:P(e.status)})})]},e.id);var s,t}))})]})})]}),a.jsx(t,{className:"p-6 bg-blue-50 border-blue-200",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(b,{className:"w-6 h-6 text-blue-600 mt-1"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"振込スケジュール"}),a.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[a.jsx("p",{children:"• 振込は毎月15日に前月分を一括で行います"}),a.jsx("p",{children:"• 振込手数料は当社負担です"}),a.jsx("p",{children:"• 振込金額が5,000円未満の場合は翌月に繰り越されます"}),a.jsx("p",{children:"• 振込完了後、メールでお知らせします"}),a.jsx("p",{children:"• 振込先情報に変更がある場合は、前月末日までに更新してください"})]})]})]})}),a.jsx(t,{className:"p-6",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(g,{className:"w-6 h-6 text-gray-600 mt-1"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"収益システムについて"}),a.jsxs("div",{className:"text-sm text-gray-700 space-y-1",children:[a.jsxs("p",{children:["• 売上の",a.jsx("span",{className:"font-medium",children:"80%"}),"がオーナー様に支払われます"]}),a.jsxs("p",{children:["• 残りの",a.jsx("span",{className:"font-medium",children:"20%"}),"は当社の手数料となります"]}),a.jsx("p",{children:"• 手数料には、決済手数料、システム利用料、保険料などが含まれます"}),a.jsx("p",{children:"• 収益は以下の項目から発生します："}),a.jsxs("ul",{className:"list-disc pl-5 space-y-1 mt-1",children:[a.jsx("li",{children:"通常利用（1日券）：800円/日"}),a.jsx("li",{children:"施設貸し切り：4,400円/時間"}),a.jsx("li",{children:"プライベートブース：サブスク使い放題・1日券でも利用可能（追加料金なし）"})]}),a.jsx("p",{children:"• サブスクリプション収益は利用回数に応じて分配されます"})]})]})]})})]})}function y({className:e}){return a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,children:[a.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),a.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}export{f as OwnerPaymentSystem};

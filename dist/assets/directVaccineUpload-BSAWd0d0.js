import{s as g}from"./index-BSYT0262.js";import"./ui-vendor-FlUr4cJt.js";import"./react-vendor-_GyjDmDn.js";import"./supabase-vendor-Df9iqQzW.js";const k=async(a,s,c="vaccine-certs")=>{try{if(console.log("ğŸ” Direct vaccine upload starting..."),console.log("ğŸ“ File path:",a),console.log("ğŸ“„ File details:",{name:s.name,type:s.type,size:s.size,lastModified:s.lastModified,instanceof_File:s instanceof File}),!s||!(s instanceof File))throw new Error("ç„¡åŠ¹ãªãƒ•ã‚¡ã‚¤ãƒ«ã§ã™");let e=s.type;if(!e||e==="application/octet-stream"){const t=s.name.split(".").pop()?.toLowerCase();switch(t){case"jpg":case"jpeg":e="image/jpeg";break;case"png":e="image/png";break;case"gif":e="image/gif";break;case"webp":e="image/webp";break;default:throw new Error(`ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼: ${t}`)}}if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(e))throw new Error(`ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„MIMEã‚¿ã‚¤ãƒ—: ${e}`);console.log("âœ… Using content type:",e);const{data:{session:r},error:n}=await g.auth.getSession();if(console.log("ğŸ”‘ v2 Session check:",{hasSession:!!r,hasAccessToken:!!r?.access_token,sessionError:n,userId:r?.user?.id,userEmail:r?.user?.email}),n)throw console.error("âŒ Session error:",n),new Error("èªè¨¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ");if(!r?.access_token)throw console.error("âŒ No access token found"),new Error("èªè¨¼ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚");const i=r.access_token;console.log("âœ… Access token obtained:",i.substring(0,20)+"...");const l=`https://onmcivwxtzqajcovptgf.supabase.co/storage/v1/object/${c}/${a}`;console.log("ğŸš€ Direct upload URL:",l),console.log("ğŸ”‘ Using authorization token");const o=await fetch(l,{method:"PUT",headers:{Authorization:`Bearer ${i}`,"Content-Type":e,"Cache-Control":"3600","x-upsert":"true"},body:s});if(console.log("ğŸ“¡ Response status:",o.status),console.log("ğŸ“¡ Response headers:",Object.fromEntries(o.headers.entries())),!o.ok){const t=await o.text();throw console.error("âŒ Upload failed:",t),o.status===520?(console.error("ğŸŒ Cloudflare Error 520 detected - temporary server issue"),new Error("ä¸€æ™‚çš„ãªã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚")):o.status>=500?(console.error("ğŸ”§ Server error detected:",o.status),new Error(`ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ (${o.status})ã€‚ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚`)):new Error(`ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ: ${o.status} ${o.statusText}`)}const u=await o.json();console.log("âœ… Upload successful:",u);const{data:{publicUrl:p}}=g.storage.from(c).getPublicUrl(a);return console.log("ğŸŒ Public URL:",p),{success:!0,url:p}}catch(e){return console.error("âŒ Direct vaccine upload error:",e),{success:!1,error:e.message}}};export{k as directVaccineUpload};

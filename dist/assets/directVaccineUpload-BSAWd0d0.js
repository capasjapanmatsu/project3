import{s as g}from"./index-BSYT0262.js";import"./ui-vendor-FlUr4cJt.js";import"./react-vendor-_GyjDmDn.js";import"./supabase-vendor-Df9iqQzW.js";const k=async(a,s,c="vaccine-certs")=>{try{if(console.log("🔍 Direct vaccine upload starting..."),console.log("📁 File path:",a),console.log("📄 File details:",{name:s.name,type:s.type,size:s.size,lastModified:s.lastModified,instanceof_File:s instanceof File}),!s||!(s instanceof File))throw new Error("無効なファイルです");let e=s.type;if(!e||e==="application/octet-stream"){const t=s.name.split(".").pop()?.toLowerCase();switch(t){case"jpg":case"jpeg":e="image/jpeg";break;case"png":e="image/png";break;case"gif":e="image/gif";break;case"webp":e="image/webp";break;default:throw new Error(`サポートされていないファイル形式: ${t}`)}}if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(e))throw new Error(`サポートされていないMIMEタイプ: ${e}`);console.log("✅ Using content type:",e);const{data:{session:r},error:n}=await g.auth.getSession();if(console.log("🔑 v2 Session check:",{hasSession:!!r,hasAccessToken:!!r?.access_token,sessionError:n,userId:r?.user?.id,userEmail:r?.user?.email}),n)throw console.error("❌ Session error:",n),new Error("認証エラーが発生しました");if(!r?.access_token)throw console.error("❌ No access token found"),new Error("認証されていません。ログインしてください。");const i=r.access_token;console.log("✅ Access token obtained:",i.substring(0,20)+"...");const l=`https://onmcivwxtzqajcovptgf.supabase.co/storage/v1/object/${c}/${a}`;console.log("🚀 Direct upload URL:",l),console.log("🔑 Using authorization token");const o=await fetch(l,{method:"PUT",headers:{Authorization:`Bearer ${i}`,"Content-Type":e,"Cache-Control":"3600","x-upsert":"true"},body:s});if(console.log("📡 Response status:",o.status),console.log("📡 Response headers:",Object.fromEntries(o.headers.entries())),!o.ok){const t=await o.text();throw console.error("❌ Upload failed:",t),o.status===520?(console.error("🌐 Cloudflare Error 520 detected - temporary server issue"),new Error("一時的なサーバーエラーが発生しました。しばらく待ってから再度お試しください。")):o.status>=500?(console.error("🔧 Server error detected:",o.status),new Error(`サーバーエラーが発生しました (${o.status})。しばらく待ってから再度お試しください。`)):new Error(`アップロードに失敗しました: ${o.status} ${o.statusText}`)}const u=await o.json();console.log("✅ Upload successful:",u);const{data:{publicUrl:p}}=g.storage.from(c).getPublicUrl(a);return console.log("🌐 Public URL:",p),{success:!0,url:p}}catch(e){return console.error("❌ Direct vaccine upload error:",e),{success:!1,error:e.message}}};export{k as directVaccineUpload};

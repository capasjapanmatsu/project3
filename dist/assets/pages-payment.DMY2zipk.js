/*! Build: 2025-07-17T07:59:15.523Z
Version: 0.0.0 */
import{u as e,r as s,j as a,aC as t,n as r,T as l,f as c,aD as i,P as n,J as d,a3 as x,ac as m,aE as o,aF as h,C as u,s as j,A as p,U as g,O as b,M as N,am as f,S as y,az as v,aG as w,a2 as _,X as S,$ as C,x as k,aj as q,ad as I}from"./vendor-react.D8SVeCGP.js";import{u as M,C as D,B as A,I as L}from"./components-admin.GT3qRZg5.js";import{c as P,d as F}from"./hooks.CTtJlocA.js";import{l as T,s as Y,b as E}from"./utils.C9ZsMnW6.js";const z=Object.freeze(Object.defineProperty({__proto__:null,Cart:function(){const{user:h}=M(),u=e(),[j,p]=s.useState([]),[g,b]=s.useState(!0),{isActive:N}=P(),[f,y]=s.useState(null);s.useEffect((()=>{if(h&&v(),"true"===new URLSearchParams(window.location.search).get("canceled")){y("決済がキャンセルされました。カートから商品を確認できます。"),window.history.replaceState({},document.title,window.location.pathname);const s=localStorage.getItem("pre_payment_auth_state");if(s)try{const e=JSON.parse(s);T("info","🛒 Cart: Pre-payment auth state found",{authState:e}),h&&h.id===e.user_id||(y("セッションが切断されました。再度ログインしてください。"),setTimeout((()=>{u("/login")}),3e3)),localStorage.removeItem("pre_payment_auth_state")}catch(e){T("error","Failed to parse pre-payment auth state",{error:e})}}}),[h,u]);const v=async()=>{try{const{data:e,error:s}=await Y.from("cart_items").select("*, product:products(*)").eq("user_id",null==h?void 0:h.id).order("created_at",{ascending:!1});if(s)throw s;p(e||[])}catch(e){y(e.message||"カート情報の取得に失敗しました")}finally{b(!1)}},w=async(e,s)=>{if(s<=0)await _(e);else try{const a=await E((()=>Y.from("cart_items").update({quantity:s}).eq("id",e)));if(a.error)throw a.error;await v()}catch(a){T("error","Error updating quantity",{error:a,cartItemId:e,newQuantity:s}),y("数量の更新に失敗しました。再度お試しください。")}},_=async e=>{try{const s=await E((()=>Y.from("cart_items").delete().eq("id",e)));if(s.error)throw s.error;await v()}catch(s){T("error","Error removing item",{error:s,cartItemId:e}),y("商品の削除に失敗しました。再度お試しください。")}},S=e=>N?Math.round(.9*e):e,C=()=>{const e=j.reduce(((e,s)=>e+S(s.product.price)*s.quantity),0),s=j.reduce(((e,s)=>e+s.product.price*s.quantity),0),a=e>=5e3||N?0:690;return{subtotal:e,originalSubtotal:s,discountAmount:s-e,shippingFee:a,total:e+a}};return g?a.jsx("div",{className:"flex justify-center items-center h-64",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})}):0===j.length?a.jsxs("div",{className:"max-w-4xl mx-auto",children:[a.jsxs("h1",{className:"text-2xl font-bold mb-8 flex items-center",children:[a.jsx(t,{className:"w-8 h-8 text-green-600 mr-3"}),"ショッピングカート"]}),a.jsxs(D,{className:"text-center py-12",children:[a.jsx(t,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),a.jsx("h2",{className:"text-xl font-semibold text-gray-700 mb-2",children:"カートは空です"}),a.jsx("p",{className:"text-gray-500 mb-6",children:"お気に入りの商品をカートに追加してください"}),a.jsx(r,{to:"/shop",children:a.jsx(A,{className:"bg-green-600 hover:bg-green-700",children:"ショッピングを続ける"})})]})]}):a.jsxs("div",{className:"max-w-6xl mx-auto",children:[a.jsxs("div",{className:"flex justify-between items-center mb-8",children:[a.jsxs("h1",{className:"text-2xl font-bold flex items-center",children:[a.jsx(t,{className:"w-8 h-8 text-green-600 mr-3"}),"ショッピングカート (",j.length,"点)"]}),a.jsxs(A,{variant:"secondary",onClick:async()=>{try{const e=await E((()=>Y.from("cart_items").delete().eq("user_id",null==h?void 0:h.id)));if(e.error)throw e.error;await v()}catch(e){T("error","Error clearing cart",{error:e,userId:null==h?void 0:h.id}),y("カートの削除に失敗しました。再度お試しください。")}},className:"text-red-600 hover:text-red-700",children:[a.jsx(l,{className:"w-4 h-4 mr-2"}),"カートを空にする"]})]}),f&&a.jsxs("div",{className:"mb-6 p-4 bg-red-50 rounded-lg flex items-start",children:[a.jsx(c,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),a.jsx("p",{className:"text-red-800",children:f})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[a.jsx("div",{className:"lg:col-span-2 space-y-4",children:j.map((e=>{const s=e.product.price,t=S(s),r=N&&t<s;return a.jsx(D,{className:"p-4",children:a.jsxs("div",{className:"flex items-start space-x-4",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("img",{src:e.product.image_url,alt:e.product.name,className:"w-20 h-20 object-cover rounded-lg",onError:e=>{e.currentTarget.src="https://images.pexels.com/photos/1108099/pexels-photo-1108099.jpeg"}})}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-lg",children:e.product.name}),e.product.brand&&a.jsx("p",{className:"text-sm text-gray-500",children:e.product.brand}),a.jsxs("div",{className:"mt-1 space-y-1 text-xs text-gray-500",children:[e.product.weight&&a.jsxs("p",{children:["内容量: ",e.product.weight,"g"]}),e.product.size&&a.jsxs("p",{children:["サイズ: ",e.product.size]})]})]}),a.jsx("button",{onClick:()=>_(e.id),className:"text-red-500 hover:text-red-700 p-1",children:a.jsx(l,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs("span",{className:"text-lg font-bold text-green-600",children:["¥",t.toLocaleString()]}),r&&a.jsxs("span",{className:"text-sm text-gray-500 line-through",children:["¥",s.toLocaleString()]})]}),N&&a.jsx("p",{className:"text-xs text-purple-600",children:"サブスク会員価格"})]}),a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("button",{onClick:()=>w(e.id,e.quantity-1),className:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center hover:bg-gray-300 transition-colors",children:a.jsx(i,{className:"w-4 h-4"})}),a.jsx("span",{className:"font-medium w-8 text-center",children:e.quantity}),a.jsx("button",{onClick:()=>w(e.id,e.quantity+1),className:"w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center hover:bg-green-700 transition-colors",children:a.jsx(n,{className:"w-4 h-4"})})]})]}),a.jsx("div",{className:"mt-2 text-right",children:a.jsxs("span",{className:"text-lg font-semibold",children:["小計: ¥",(t*e.quantity).toLocaleString()]})})]})]})},e.id)}))}),a.jsxs("div",{className:"space-y-6",children:[N?a.jsxs(D,{className:"bg-gradient-to-r from-purple-500 to-pink-500 text-white p-4",children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[a.jsx(d,{className:"w-5 h-5"}),a.jsx("span",{className:"font-semibold",children:"サブスク会員特典"})]}),a.jsx("p",{className:"text-sm",children:"全商品10%OFF + 送料無料"})]}):a.jsxs(D,{className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white p-4",children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[a.jsx(d,{className:"w-5 h-5"}),a.jsx("span",{className:"font-semibold",children:"サブスクリプションでもっとお得に！"})]}),a.jsx("p",{className:"text-sm mb-3",children:"全商品10%OFF + 送料無料"}),a.jsx(r,{to:"/subscription",children:a.jsx(A,{size:"sm",className:"bg-white text-purple-600 hover:bg-gray-100",children:"詳細を見る"})})]}),a.jsxs(D,{className:"p-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"注文サマリー"}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"商品小計"}),a.jsxs("span",{children:["¥",C().originalSubtotal.toLocaleString()]})]}),C().discountAmount>0&&a.jsxs("div",{className:"flex justify-between text-purple-600",children:[a.jsx("span",{children:"サブスク割引 (10%)"}),a.jsxs("span",{children:["-¥",C().discountAmount.toLocaleString()]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsxs("span",{className:"flex items-center",children:[a.jsx(x,{className:"w-4 h-4 mr-1"}),"送料"]}),a.jsx("span",{children:0===C().shippingFee?a.jsx("span",{className:"text-green-600",children:"無料"}):`¥${C().shippingFee.toLocaleString()}`})]}),a.jsx("hr",{className:"my-3"}),a.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[a.jsx("span",{children:"合計"}),a.jsxs("span",{className:"text-green-600",children:["¥",C().total.toLocaleString()]})]})]}),!N&&C().subtotal<5e3&&a.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:a.jsxs("p",{className:"text-sm text-blue-800",children:["あと¥",(5e3-C().subtotal).toLocaleString(),"で送料無料！"]})}),a.jsxs("div",{className:"space-y-3 mt-4",children:[a.jsxs(A,{onClick:()=>{0!==j.length?u("/checkout",{state:{cartItems:j.map((e=>e.id)),totals:C()}}):y("カートに商品がありません。")},className:"w-full bg-green-600 hover:bg-green-700 text-lg py-3",children:[a.jsx(m,{className:"w-5 h-5 mr-2"}),"レジに進む",a.jsx(o,{className:"w-5 h-5 ml-2"})]}),a.jsx(r,{to:"/shop",children:a.jsx(A,{variant:"secondary",className:"w-full",children:"ショッピングを続ける"})})]})]}),a.jsx(D,{className:"p-4 bg-blue-50 border-blue-200",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(x,{className:"w-6 h-6 text-blue-600 mt-1"}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold text-blue-900 mb-1",children:"配送について"}),a.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[a.jsx("p",{children:"• 送料：全国一律¥690"}),a.jsxs("p",{children:["• ¥5,000以上のご注文で",a.jsx("span",{className:"font-medium",children:"送料無料"})]}),a.jsxs("p",{children:["• サブスク会員は",a.jsx("span",{className:"font-medium",children:"常に送料無料"})]}),a.jsx("p",{children:"• 平日14時までのご注文で翌日お届け"}),a.jsx("p",{children:"• 土日祝日も配送いたします"}),a.jsx("p",{children:"• 時間指定配送も可能です"})]})]})]})})]})]})]})}},Symbol.toStringTag,{value:"Module"})),O=Object.freeze(Object.defineProperty({__proto__:null,Checkout:function(){const{user:t}=M(),l=e(),i=h(),{createCheckoutSession:n,loading:d,error:o}=F(),[v,w]=s.useState(!0),[_,S]=s.useState(null),[C,k]=s.useState([]),[q,I]=s.useState(!1),[P,T]=s.useState(null),[E,z]=s.useState(!1),[O,H]=s.useState(!1),[V,$]=s.useState({name:"",postalCode:"",address:"",phoneNumber:"",email:"",notes:""}),[R,W]=s.useState({subtotal:0,originalSubtotal:0,discountAmount:0,shippingFee:0,total:0});s.useEffect((()=>{if(!t)return void l("/login");const e=i.state;e?(e.totals&&W(e.totals),X(e)):l("/cart")}),[t,l,i]);const X=async e=>{try{w(!0);const{data:s,error:a}=await Y.from("profiles").select("*").eq("id",null==t?void 0:t.id).single();if(a)throw a;if($({name:s.name||"",postalCode:s.postal_code||"",address:s.address||"",phoneNumber:s.phone_number||"",email:(null==t?void 0:t.email)||"",notes:""}),e.cartItems&&e.cartItems.length>0){const{data:s,error:a}=await Y.from("cart_items").select("*, product:products(*)").in("id",e.cartItems).eq("user_id",null==t?void 0:t.id);if(a)throw a;k(s||[])}else{const{data:e,error:s}=await Y.from("cart_items").select("*, product:products(*)").eq("user_id",null==t?void 0:t.id);if(s)throw s;k(e||[])}const r=new URLSearchParams(window.location.search);if("true"===r.get("success"))z(!0),T(r.get("order_number")||U());else if("true"===r.get("canceled")){H(!0),S("決済がキャンセルされました。必要に応じて再度お試しください。");const{data:{user:e}}=await Y.auth.getUser();e||localStorage.getItem("pre_payment_auth_state")&&(S("セッションが切断されました。再度ログインしてください。"),setTimeout((()=>{l("/login")}),3e3)),window.history.replaceState({},document.title,window.location.pathname)}}catch(s){S(s.message||"データの取得に失敗しました。もう一度お試しください。")}finally{w(!1)}},U=()=>`DP${Date.now()}${Math.floor(1e3*Math.random())}`;return v?a.jsx("div",{className:"flex justify-center items-center h-64",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):E&&P?a.jsx("div",{className:"max-w-4xl mx-auto",children:a.jsxs(D,{className:"p-8 text-center",children:[a.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6",children:a.jsx(u,{className:"w-12 h-12 text-green-600"})}),a.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"ご注文ありがとうございます！"}),a.jsxs("p",{className:"text-lg text-gray-600 mb-6",children:["注文番号: ",a.jsx("span",{className:"font-semibold",children:P})]}),a.jsx("div",{className:"bg-blue-50 p-6 rounded-lg mb-8 max-w-xl mx-auto",children:a.jsxs("div",{className:"text-left",children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx(j,{className:"w-6 h-6 text-blue-600 mr-3"}),a.jsx("h2",{className:"text-xl font-semibold text-blue-900",children:"ショッピング注文"})]}),a.jsx("p",{className:"text-blue-800 mb-2",children:"ご注文ありがとうございます。商品の発送準備を進めています。"}),a.jsx("p",{className:"text-blue-800",children:"注文の詳細は「注文履歴」ページでご確認いただけます。"})]})}),a.jsxs("div",{className:"flex justify-center space-x-4",children:[a.jsx(r,{to:"/orders",children:a.jsx(A,{children:"注文履歴を見る"})}),a.jsx(r,{to:"/shop",children:a.jsx(A,{variant:"secondary",children:"ショッピングを続ける"})})]})]})}):a.jsxs("div",{className:"max-w-6xl mx-auto",children:[a.jsx("div",{className:"flex items-center space-x-4 mb-6",children:a.jsxs(r,{to:"/cart",className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[a.jsx(p,{className:"w-4 h-4 mr-2"}),"カートに戻る"]})}),a.jsxs("h1",{className:"text-2xl font-bold mb-8 flex items-center",children:[a.jsx(j,{className:"w-8 h-8 text-green-600 mr-3"}),"お支払い情報"]}),(_||o)&&a.jsxs("div",{className:"mb-6 p-4 bg-red-50 rounded-lg flex items-start",children:[a.jsx(c,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-red-800",children:"エラーが発生しました"}),a.jsx("p",{className:"text-red-700",children:_||o}),O&&a.jsxs("div",{className:"mt-2",children:[a.jsx("p",{className:"text-sm text-red-700",children:"支払い処理に失敗しました。以下をご確認ください："}),a.jsxs("ul",{className:"list-disc list-inside text-sm text-red-700 mt-1",children:[a.jsx("li",{children:"カード情報が正しいか確認してください"}),a.jsx("li",{children:"別の支払い方法をお試しください"}),a.jsx("li",{children:"しばらく経ってから再度お試しください"})]})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[a.jsx("div",{className:"lg:col-span-2",children:a.jsx(D,{className:"p-6",children:a.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),0!==C.length)try{if(I(!0),S(null),!V.name.trim())throw new Error("お名前を入力してください");if(!V.postalCode.trim())throw new Error("郵便番号を入力してください");if(!V.address.trim())throw new Error("住所を入力してください");if(!V.phoneNumber.trim())throw new Error("電話番号を入力してください");const e=U();T(e),await n({priceId:"price_placeholder",mode:"payment",successUrl:`${window.location.origin}/payment-confirmation?success=true&order_number=${e}`,cancelUrl:`${window.location.origin}/checkout?canceled=true`,cartItems:C.map((e=>e.id)),customParams:{shipping_name:V.name,shipping_address:V.address,shipping_postal_code:V.postalCode,shipping_phone:V.phoneNumber,notes:V.notes,order_number:e}})}catch(s){S(s.message||"エラーが発生しました"),I(!1)}else S("カートに商品がありません。")},children:[a.jsx("h2",{className:"text-xl font-semibold mb-6",children:"配送情報"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[a.jsx(L,{label:"お名前 *",value:V.name,onChange:e=>$({...V,name:e.target.value}),required:!0,icon:a.jsx(g,{className:"w-4 h-4 text-gray-500"})}),a.jsx(L,{label:"電話番号 *",value:V.phoneNumber,onChange:e=>$({...V,phoneNumber:e.target.value}),required:!0,icon:a.jsx(b,{className:"w-4 h-4 text-gray-500"})})]}),a.jsx("div",{className:"mb-6",children:a.jsx(L,{label:"郵便番号 *",value:V.postalCode,onChange:e=>$({...V,postalCode:e.target.value}),required:!0,icon:a.jsx(N,{className:"w-4 h-4 text-gray-500"}),placeholder:"123-4567"})}),a.jsx("div",{className:"mb-6",children:a.jsx(L,{label:"住所 *",value:V.address,onChange:e=>$({...V,address:e.target.value}),required:!0,icon:a.jsx(N,{className:"w-4 h-4 text-gray-500"})})}),a.jsxs("div",{className:"mb-6",children:[a.jsx(L,{label:"メールアドレス *",type:"email",value:V.email,onChange:e=>$({...V,email:e.target.value}),required:!0,disabled:!0}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"注文確認メールがこのアドレスに送信されます"})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"備考"}),a.jsx("textarea",{value:V.notes,onChange:e=>$({...V,notes:e.target.value}),placeholder:"配送に関する特記事項があればご記入ください",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",rows:3})]}),a.jsx("h2",{className:"text-xl font-semibold mb-4 mt-8",children:"支払い方法"}),a.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(m,{className:"w-5 h-5 text-gray-600"}),a.jsx("span",{className:"font-medium",children:"クレジットカード"})]}),a.jsx("p",{className:"text-sm text-gray-600 mt-1 ml-7",children:"VISA, Mastercard, JCB, AMEX"})]}),a.jsx("div",{className:"p-4 bg-yellow-50 rounded-lg mb-6",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(f,{className:"w-5 h-5 text-yellow-600 mt-0.5 flex-shrink-0"}),a.jsxs("div",{className:"text-sm text-yellow-800",children:[a.jsx("p",{className:"font-medium mb-1",children:"支払い処理について"}),a.jsx("p",{children:"「注文を確定する」ボタンをクリックすると、選択した支払い方法の決済画面に移動します。決済が完了すると、自動的に注文が確定します。"})]})]})}),a.jsx("div",{className:"p-4 bg-blue-50 rounded-lg mb-6",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(y,{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),a.jsxs("div",{className:"text-sm text-blue-800",children:[a.jsx("p",{className:"font-medium mb-1",children:"安全な決済"}),a.jsx("p",{children:"すべての支払い情報は暗号化されて安全に処理されます。当サイトでは実際のカード情報を保存しません。"})]})]})}),a.jsxs(A,{type:"submit",isLoading:q||d,className:"w-full bg-green-600 hover:bg-green-700 text-lg py-3",disabled:0===C.length,children:[a.jsx(m,{className:"w-5 h-5 mr-2"}),"注文を確定する (¥",R.total.toLocaleString(),")"]})]})})}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs(D,{className:"p-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"注文内容"}),a.jsx("div",{className:"space-y-4 max-h-80 overflow-y-auto mb-4",children:C.map((e=>a.jsxs("div",{className:"flex items-center space-x-3 pb-3 border-b border-gray-100 last:border-b-0",children:[a.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded overflow-hidden flex-shrink-0",children:a.jsx("img",{src:e.product.image_url,alt:e.product.name,className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://images.pexels.com/photos/1108099/pexels-photo-1108099.jpeg"}})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"font-medium text-sm",children:e.product.name}),a.jsxs("div",{className:"flex justify-between items-center mt-1",children:[a.jsxs("span",{className:"text-xs text-gray-500",children:["数量: ",e.quantity]}),a.jsxs("span",{className:"text-sm font-medium",children:["¥",(e.product.price*e.quantity).toLocaleString()]})]})]})]},e.id)))}),a.jsxs("div",{className:"space-y-2 pt-2 border-t border-gray-200",children:[a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{children:"商品小計"}),a.jsxs("span",{children:["¥",R.originalSubtotal.toLocaleString()]})]}),R.discountAmount>0&&a.jsxs("div",{className:"flex justify-between text-sm text-purple-600",children:[a.jsx("span",{children:"サブスク割引 (10%)"}),a.jsxs("span",{children:["-¥",R.discountAmount.toLocaleString()]})]}),a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{children:"送料"}),a.jsx("span",{children:0===R.shippingFee?a.jsx("span",{className:"text-green-600",children:"無料"}):`¥${R.shippingFee.toLocaleString()}`})]}),a.jsxs("div",{className:"flex justify-between font-bold text-base pt-2 border-t border-gray-200 mt-2",children:[a.jsx("span",{children:"合計"}),a.jsxs("span",{className:"text-green-600",children:["¥",R.total.toLocaleString()]})]})]})]}),a.jsx(D,{className:"p-4 bg-blue-50 border-blue-200",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(x,{className:"w-5 h-5 text-blue-600 mt-1 flex-shrink-0"}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold text-blue-900 mb-1",children:"配送について"}),a.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[a.jsx("p",{children:"• 平日14時までのご注文で翌日お届け"}),a.jsx("p",{children:"• 土日祝日も配送いたします"}),a.jsx("p",{children:"• 配送状況はメールでお知らせします"})]})]})]})}),a.jsx(D,{className:"p-4 bg-gray-50 border-gray-200",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(y,{className:"w-5 h-5 text-gray-600 mt-1 flex-shrink-0"}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:"セキュリティ"}),a.jsxs("div",{className:"text-sm text-gray-700 space-y-1",children:[a.jsx("p",{children:"• SSL暗号化通信で個人情報を保護"}),a.jsx("p",{children:"• クレジットカード情報は保存されません"}),a.jsx("p",{children:"• 第三者認証のセキュリティ対策"})]})]})]})})]})]})]})}},Symbol.toStringTag,{value:"Module"})),H=Object.freeze(Object.defineProperty({__proto__:null,PaymentSetup:function(){const{user:t}=M(),r=e(),[l,i]=s.useState(!1),[n,d]=s.useState(""),[x,o]=s.useState(!1),[h,j]=s.useState({cardNumber:"",cardHolder:"",expiryMonth:"",expiryYear:"",cvv:"",isDefault:!0});return x?a.jsx("div",{className:"max-w-md mx-auto",children:a.jsxs(D,{className:"text-center p-8",children:[a.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:a.jsx(u,{className:"w-8 h-8 text-green-600"})}),a.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"クレジットカードを登録しました"}),a.jsx("p",{className:"text-gray-600 mb-4",children:"入場QRページに戻ります..."}),a.jsx(A,{onClick:()=>r("/entrance-qr"),children:"入場QRページへ"})]})}):a.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[a.jsx("div",{className:"flex items-center space-x-4 mb-6",children:a.jsxs("button",{onClick:()=>r("/entrance-qr"),className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[a.jsx(p,{className:"w-4 h-4 mr-2"}),"入場QRに戻る"]})}),a.jsxs("div",{className:"text-center mb-8",children:[a.jsxs("h1",{className:"text-2xl font-bold text-gray-900 mb-4 flex items-center justify-center",children:[a.jsx(m,{className:"w-8 h-8 text-blue-600 mr-3"}),"クレジットカード登録"]}),a.jsx("p",{className:"text-gray-600",children:"ドッグラン入場QRの発行にはクレジットカードの登録が必要です"})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[a.jsx("div",{className:"lg:col-span-2",children:a.jsx(D,{className:"p-6",children:a.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),d(""),(()=>{if(16!==h.cardNumber.replace(/\s/g,"").length)return d("カード番号は16桁で入力してください。"),!1;if(!h.cardHolder.trim())return d("カード名義人を入力してください。"),!1;if(!h.expiryMonth||!h.expiryYear)return d("有効期限を選択してください。"),!1;if(h.cvv.length<3)return d("CVVを正しく入力してください。"),!1;const e=new Date,s=e.getFullYear()%100,a=e.getMonth()+1,t=parseInt(h.expiryYear),r=parseInt(h.expiryMonth);return!(t<s||t===s&&r<a)||(d("有効期限が過去の日付です。"),!1)})()){i(!0);try{const e=h.cardNumber.replace(/\s/g,""),s="**** **** **** "+e.slice(-4),a=(e=>{const s=e.replace(/\s/g,"");return s.startsWith("4")?"visa":s.startsWith("5")||s.startsWith("2")?"mastercard":s.startsWith("3")?"amex":s.startsWith("35")?"jcb":"visa"})(e),{error:l}=await Y.from("payment_cards").insert([{user_id:null==t?void 0:t.id,card_number_masked:s,card_holder_name:h.cardHolder,expiry_month:parseInt(h.expiryMonth),expiry_year:parseInt(h.expiryYear),card_brand:a,is_default:h.isDefault}]);if(l)throw l;o(!0),setTimeout((()=>{r("/entrance-qr")}),3e3)}catch(s){d(s.message||"決済方法の設定に失敗しました")}finally{i(!1)}}},children:[n&&a.jsxs("div",{className:"mb-4 p-3 bg-red-100 border border-red-300 rounded-lg",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(c,{className:"w-5 h-5 text-red-600"}),a.jsx("span",{className:"text-red-800 font-medium",children:"エラー"})]}),a.jsx("p",{className:"text-red-700 mt-1",children:n})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx(L,{label:"カード番号 *",value:h.cardNumber,onChange:e=>{const s=e.target.value.replace(/\D/g,"").replace(/(.{4})/g,"$1 ").trim().slice(0,19);j({...h,cardNumber:s})},placeholder:"1234 5678 9012 3456",maxLength:19,required:!0}),a.jsx(L,{label:"カード名義人 *",value:h.cardHolder,onChange:e=>j({...h,cardHolder:e.target.value.toUpperCase()}),placeholder:"TARO YAMADA",required:!0}),a.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"有効期限（月） *"}),a.jsxs("select",{value:h.expiryMonth,onChange:e=>j({...h,expiryMonth:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[a.jsx("option",{value:"",children:"月"}),Array.from({length:12},((e,s)=>a.jsx("option",{value:String(s+1).padStart(2,"0"),children:String(s+1).padStart(2,"0")},s+1)))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"有効期限（年） *"}),a.jsxs("select",{value:h.expiryYear,onChange:e=>j({...h,expiryYear:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[a.jsx("option",{value:"",children:"年"}),Array.from({length:10},((e,s)=>{const t=(new Date).getFullYear()+s;return a.jsx("option",{value:String(t).slice(-2),children:t},t)}))]})]}),a.jsx(L,{label:"CVV *",value:h.cvv,onChange:e=>j({...h,cvv:e.target.value.replace(/\D/g,"")}),placeholder:"123",maxLength:4,required:!0})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("input",{type:"checkbox",id:"isDefault",checked:h.isDefault,onChange:e=>j({...h,isDefault:e.target.checked}),className:"rounded text-blue-600"}),a.jsx("label",{htmlFor:"isDefault",className:"text-sm text-gray-700",children:"デフォルトの支払い方法として設定"})]}),a.jsx("div",{className:"bg-yellow-50 p-4 rounded-lg",children:a.jsxs("div",{className:"flex items-start space-x-2",children:[a.jsx(c,{className:"w-5 h-5 text-yellow-600 mt-0.5 flex-shrink-0"}),a.jsxs("div",{className:"text-sm text-yellow-800",children:[a.jsx("p",{className:"font-medium mb-1",children:"重要な注意事項"}),a.jsxs("ul",{className:"space-y-1 text-xs",children:[a.jsx("li",{children:"• カード情報は暗号化して安全に保存されます"}),a.jsx("li",{children:"• 実際のカード番号は保存されません"}),a.jsx("li",{children:"• 入場QR発行時に自動で課金されます"}),a.jsx("li",{children:"• 不正利用防止のため、本人確認が必要な場合があります"})]})]})]})}),a.jsxs(A,{type:"submit",isLoading:l,className:"w-full bg-blue-600 hover:bg-blue-700 text-lg py-3",children:[a.jsx(m,{className:"w-5 h-5 mr-2"}),"クレジットカードを登録"]})]})]})})}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs(D,{className:"p-4 bg-green-50 border-green-200",children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[a.jsx(y,{className:"w-5 h-5 text-green-600"}),a.jsx("h3",{className:"font-semibold text-green-900",children:"セキュリティ"})]}),a.jsxs("div",{className:"text-sm text-green-800 space-y-2",children:[a.jsxs("div",{className:"flex items-start space-x-2",children:[a.jsx(u,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),a.jsx("span",{children:"SSL暗号化通信"})]}),a.jsxs("div",{className:"flex items-start space-x-2",children:[a.jsx(u,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),a.jsx("span",{children:"PCI DSS準拠"})]}),a.jsxs("div",{className:"flex items-start space-x-2",children:[a.jsx(u,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),a.jsx("span",{children:"カード番号は保存されません"})]}),a.jsxs("div",{className:"flex items-start space-x-2",children:[a.jsx(u,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),a.jsx("span",{children:"不正利用監視システム"})]})]})]}),a.jsxs(D,{className:"p-4",children:[a.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"対応カードブランド"}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-gray-50 rounded",children:[a.jsx(m,{className:"w-5 h-5 text-blue-600"}),a.jsx("span",{className:"text-sm font-medium",children:"VISA"})]}),a.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-gray-50 rounded",children:[a.jsx(m,{className:"w-5 h-5 text-red-600"}),a.jsx("span",{className:"text-sm font-medium",children:"Mastercard"})]}),a.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-gray-50 rounded",children:[a.jsx(m,{className:"w-5 h-5 text-green-600"}),a.jsx("span",{className:"text-sm font-medium",children:"JCB"})]}),a.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-gray-50 rounded",children:[a.jsx(m,{className:"w-5 h-5 text-blue-800"}),a.jsx("span",{className:"text-sm font-medium",children:"AMEX"})]})]})]}),a.jsxs(D,{className:"p-4 bg-blue-50 border-blue-200",children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[a.jsx(v,{className:"w-5 h-5 text-blue-600"}),a.jsx("h3",{className:"font-semibold text-blue-900",children:"課金について"})]}),a.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[a.jsx("p",{children:"• 入場QR発行時に自動課金"}),a.jsx("p",{children:"• 単発利用: ¥800/日"}),a.jsx("p",{children:"• サブスク会員は追加料金なし"}),a.jsx("p",{children:"• 利用明細はメールで送信"}),a.jsx("p",{children:"• 返金は利用前のみ可能"})]})]}),a.jsxs(D,{className:"p-4",children:[a.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"サポート"}),a.jsxs("div",{className:"text-sm text-gray-700 space-y-2",children:[a.jsx("p",{children:"カード登録でお困りの場合は、カスタマーサポートまでお問い合わせください。"}),a.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded",children:[a.jsx("p",{className:"font-medium",children:"カスタマーサポート"}),a.jsx("p",{children:"📞 0120-XXX-XXX"}),a.jsx("p",{children:"📧 info@dogparkjp.com"}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"平日 9:00-18:00"})]})]})]})]})]})]})}},Symbol.toStringTag,{value:"Module"})),V=Object.freeze(Object.defineProperty({__proto__:null,PaymentMethodSettings:function(){const{user:t}=M(),i=e(),[d,x]=s.useState(!0),[o,h]=s.useState(""),[b,N]=s.useState(""),[f,y]=s.useState([]),[k,q]=s.useState(!1),[I,P]=s.useState(!1),[F,T]=s.useState({cardNumber:"",cardHolder:"",expiryMonth:"",expiryYear:"",cvv:"",isDefault:!1});s.useEffect((()=>{t?E():i("/login")}),[t,i]);const E=async()=>{try{x(!0);const{data:e,error:s}=await Y.from("payment_cards").select("*").eq("user_id",null==t?void 0:t.id).order("is_default",{ascending:!1}).order("created_at",{ascending:!1});if(s)throw s;y(e||[])}catch(e){h("支払い方法の取得に失敗しました。")}finally{x(!1)}},z=e=>{switch(e){case"visa":return a.jsx("span",{className:"text-blue-600 font-bold",children:"VISA"});case"mastercard":return a.jsx("span",{className:"text-red-600 font-bold",children:"Mastercard"});case"amex":return a.jsx("span",{className:"text-blue-800 font-bold",children:"AMEX"});case"jcb":return a.jsx("span",{className:"text-green-600 font-bold",children:"JCB"});default:return a.jsx(m,{className:"w-5 h-5 text-gray-600"})}};return d?a.jsx("div",{className:"flex justify-center items-center h-64",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):a.jsxs("div",{className:"max-w-3xl mx-auto space-y-6",children:[a.jsx("div",{className:"flex items-center space-x-4 mb-6",children:a.jsxs(r,{to:"/dashboard",className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[a.jsx(p,{className:"w-4 h-4 mr-2"}),"ダッシュボードに戻る"]})}),a.jsxs("div",{className:"text-center mb-8",children:[a.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-4 flex items-center justify-center",children:[a.jsx(m,{className:"w-8 h-8 text-blue-600 mr-3"}),"支払い方法の管理"]}),a.jsx("p",{className:"text-lg text-gray-600",children:"クレジットカード情報を管理します"})]}),a.jsxs("div",{className:"flex flex-wrap justify-center gap-4 mb-6",children:[a.jsx(r,{to:"/profile-settings",children:a.jsxs(A,{variant:"secondary",size:"sm",children:[a.jsx(g,{className:"w-4 h-4 mr-2"}),"プロフィール編集"]})}),a.jsx(r,{to:"/dogpark-history",children:a.jsxs(A,{variant:"secondary",size:"sm",children:[a.jsx(w,{className:"w-4 h-4 mr-2"}),"利用履歴"]})}),a.jsx(r,{to:"/orders",children:a.jsxs(A,{variant:"secondary",size:"sm",children:[a.jsx(_,{className:"w-4 h-4 mr-2"}),"注文履歴"]})}),a.jsx(r,{to:"/shop",children:a.jsxs(A,{variant:"secondary",size:"sm",children:[a.jsx(j,{className:"w-4 h-4 mr-2"}),"ショップ"]})})]}),a.jsxs(D,{className:"p-6",children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[a.jsx(m,{className:"w-6 h-6 text-blue-600 mr-2"}),"登録済みのカード"]}),a.jsx(A,{onClick:()=>q(!k),size:"sm",children:k?a.jsxs(a.Fragment,{children:[a.jsx(S,{className:"w-4 h-4 mr-1"}),"キャンセル"]}):a.jsxs(a.Fragment,{children:[a.jsx(n,{className:"w-4 h-4 mr-1"}),"カードを追加"]})})]}),o&&a.jsxs("div",{className:"mb-6 p-4 bg-red-50 rounded-lg flex items-start",children:[a.jsx(c,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),a.jsx("p",{className:"text-red-800",children:o})]}),b&&a.jsxs("div",{className:"mb-6 p-4 bg-green-50 rounded-lg flex items-start",children:[a.jsx(u,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),a.jsx("p",{className:"text-green-800",children:b})]}),k&&a.jsxs("div",{className:"mb-6 p-6 bg-gray-50 rounded-lg border border-gray-200",children:[a.jsx("h3",{className:"font-semibold mb-4",children:"新しいカードを追加"}),a.jsx("form",{onSubmit:async e=>{if(e.preventDefault(),h(""),N(""),(()=>{if(16!==F.cardNumber.replace(/\s/g,"").length)return h("カード番号は16桁で入力してください。"),!1;if(!F.cardHolder.trim())return h("カード名義人を入力してください。"),!1;if(!F.expiryMonth||!F.expiryYear)return h("有効期限を選択してください。"),!1;if(F.cvv.length<3)return h("CVVを正しく入力してください。"),!1;const e=new Date,s=e.getFullYear()%100,a=e.getMonth()+1,t=parseInt(F.expiryYear),r=parseInt(F.expiryMonth);return!(t<s||t===s&&r<a)||(h("有効期限が過去の日付です。"),!1)})()){P(!0);try{const e=F.cardNumber.replace(/\s/g,""),s="**** **** **** "+e.slice(-4),a=(e=>{const s=e.replace(/\s/g,"");return s.startsWith("4")?"visa":s.startsWith("5")||s.startsWith("2")?"mastercard":s.startsWith("3")?"amex":s.startsWith("35")?"jcb":"visa"})(e),{error:r}=await Y.from("payment_cards").insert([{user_id:null==t?void 0:t.id,card_number_masked:s,card_holder_name:F.cardHolder,expiry_month:parseInt(F.expiryMonth),expiry_year:parseInt(F.expiryYear),card_brand:a,is_default:F.isDefault||0===f.length}]);if(r)throw r;N("クレジットカードを登録しました"),q(!1),T({cardNumber:"",cardHolder:"",expiryMonth:"",expiryYear:"",cvv:"",isDefault:!1}),await E(),setTimeout((()=>{N("")}),3e3)}catch(s){h("クレジットカードの登録に失敗しました。もう一度お試しください。")}finally{P(!1)}}},children:a.jsxs("div",{className:"space-y-4",children:[a.jsx(L,{label:"カード番号 *",value:F.cardNumber,onChange:e=>{const s=e.target.value.replace(/\D/g,"").replace(/(.{4})/g,"$1 ").trim().slice(0,19);T({...F,cardNumber:s})},placeholder:"1234 5678 9012 3456",maxLength:19,required:!0}),a.jsx(L,{label:"カード名義人 *",value:F.cardHolder,onChange:e=>T({...F,cardHolder:e.target.value.toUpperCase()}),placeholder:"TARO YAMADA",required:!0}),a.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"有効期限（月） *"}),a.jsxs("select",{value:F.expiryMonth,onChange:e=>T({...F,expiryMonth:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[a.jsx("option",{value:"",children:"月"}),Array.from({length:12},((e,s)=>a.jsx("option",{value:String(s+1).padStart(2,"0"),children:String(s+1).padStart(2,"0")},s+1)))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"有効期限（年） *"}),a.jsxs("select",{value:F.expiryYear,onChange:e=>T({...F,expiryYear:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[a.jsx("option",{value:"",children:"年"}),Array.from({length:10},((e,s)=>{const t=(new Date).getFullYear()+s;return a.jsx("option",{value:String(t).slice(-2),children:t},t)}))]})]}),a.jsx(L,{label:"CVV *",value:F.cvv,onChange:e=>T({...F,cvv:e.target.value.replace(/\D/g,"")}),placeholder:"123",maxLength:4,required:!0})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("input",{type:"checkbox",id:"isDefault",checked:F.isDefault,onChange:e=>T({...F,isDefault:e.target.checked}),className:"rounded text-blue-600"}),a.jsx("label",{htmlFor:"isDefault",className:"text-sm text-gray-700",children:"デフォルトの支払い方法として設定"})]}),a.jsxs("div",{className:"flex justify-end space-x-3 mt-2",children:[a.jsx(A,{type:"button",variant:"secondary",onClick:()=>q(!1),children:"キャンセル"}),a.jsx(A,{type:"submit",isLoading:I,children:"カードを追加"})]})]})})]}),0===f.length?a.jsxs("div",{className:"text-center py-8",children:[a.jsx(m,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600 mb-4",children:"登録されているカードはありません"}),a.jsxs(A,{onClick:()=>q(!0),children:[a.jsx(n,{className:"w-4 h-4 mr-2"}),"カードを追加する"]})]}):a.jsx("div",{className:"space-y-4",children:f.map((e=>a.jsx("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center border border-gray-300",children:z(e.card_brand)}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("h3",{className:"font-semibold",children:e.card_number_masked}),e.is_default&&a.jsxs("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full flex items-center",children:[a.jsx(C,{className:"w-3 h-3 mr-1"}),"デフォルト"]})]}),a.jsx("p",{className:"text-sm text-gray-600",children:e.card_holder_name}),a.jsxs("p",{className:"text-xs text-gray-500",children:["有効期限: ",e.expiry_month.toString().padStart(2,"0"),"/",e.expiry_year.toString().padStart(2,"0")]})]})]}),a.jsxs("div",{className:"flex space-x-2",children:[!e.is_default&&a.jsxs(A,{size:"sm",variant:"secondary",onClick:()=>(async e=>{try{h(""),N("");const{error:s}=await Y.from("payment_cards").update({is_default:!1}).eq("user_id",null==t?void 0:t.id);if(s)throw s;const{error:a}=await Y.from("payment_cards").update({is_default:!0}).eq("id",e);if(a)throw a;N("デフォルトの支払い方法を変更しました"),await E(),setTimeout((()=>{N("")}),3e3)}catch(s){h("デフォルト設定の変更に失敗しました。")}})(e.id),children:[a.jsx(C,{className:"w-4 h-4 mr-1"}),"デフォルトに設定"]}),a.jsx(A,{size:"sm",variant:"secondary",className:"text-red-600 hover:text-red-700",onClick:()=>(async e=>{if(confirm("このカードを削除してもよろしいですか？"))try{h(""),N("");const{error:s}=await Y.from("payment_cards").delete().eq("id",e);if(s)throw s;N("クレジットカードを削除しました"),await E(),setTimeout((()=>{N("")}),3e3)}catch(s){h(s.message||"決済方法の削除に失敗しました")}})(e.id),children:a.jsx(l,{className:"w-4 h-4"})})]})]})},e.id)))})]}),a.jsx(D,{className:"p-6 bg-blue-50 border-blue-200",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(v,{className:"w-6 h-6 text-blue-600 mt-1"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"セキュリティ情報"}),a.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[a.jsx("p",{children:"• カード情報は暗号化して安全に保存されます"}),a.jsx("p",{children:"• 実際のカード番号は保存されません"}),a.jsx("p",{children:"• 決済処理はSSL暗号化通信で行われます"}),a.jsx("p",{children:"• PCI DSS準拠のセキュリティ基準を満たしています"})]})]})]})})]})}},Symbol.toStringTag,{value:"Module"})),$=Object.freeze(Object.defineProperty({__proto__:null,PaymentConfirmation:function(){const t=e(),[r]=k(),{user:l}=M(),[i,n]=s.useState(!1),[d,x]=s.useState("processing"),[m,o]=s.useState(5);return s.useEffect((()=>{const e=setTimeout((async()=>{const e=r.get("status"),s=r.get("session_id"),a=r.get("canceled");x("success"===e&&s?"success":"cancel"===e||"true"===a?"failed":"processing");const c=localStorage.getItem("pre_payment_auth_state");if(c)try{const e=JSON.parse(c);l&&l.id===e.user_id||"true"===a&&(x("failed"),setTimeout((()=>{t("/login")}),5e3)),localStorage.removeItem("pre_payment_auth_state")}catch(i){}n(!1)}),100);return()=>clearTimeout(e)}),[r,l,t]),s.useEffect((()=>{if("success"===d&&m>0){const e=setTimeout((()=>{o(m-1)}),1e3);return()=>clearTimeout(e)}"success"===d&&0===m&&t("/access-control")}),[d,m,t]),i?a.jsx("div",{className:"flex justify-center items-center h-64",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):a.jsxs("div",{className:"max-w-2xl mx-auto",children:[a.jsxs("div",{className:"flex items-center mb-6",children:[a.jsxs(A,{variant:"primary",size:"sm",onClick:()=>t(-1),className:"mr-3",children:[a.jsx(p,{className:"w-4 h-4 mr-2"}),"戻る"]}),a.jsx("h1",{className:"text-2xl font-bold",children:"決済確認"})]}),"success"===d&&a.jsxs(D,{className:"text-center p-8",children:[a.jsx(u,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),a.jsx("h2",{className:"text-2xl font-bold text-green-800 mb-4",children:"決済が完了しました！"}),a.jsx("p",{className:"text-gray-600 mb-6",children:"ありがとうございます。決済が正常に処理されました。"}),a.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg mb-6",children:[a.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[a.jsx(q,{className:"w-5 h-5 text-blue-600"}),a.jsx("span",{className:"font-semibold text-blue-900",children:"次のステップ"})]}),a.jsx("p",{className:"text-sm text-blue-800",children:"入場にはPINコードが必要です。下のボタンからPINコードを生成してください。"})]}),a.jsxs(A,{onClick:()=>{t("/access-control")},className:"w-full bg-blue-600 hover:bg-blue-700 mb-4",children:[a.jsx(q,{className:"w-5 h-5 mr-2"}),"PINコードを生成する"]}),a.jsx("p",{className:"text-sm text-gray-500",children:m>0&&`${m}秒後に自動的にPINコード生成画面に移動します...`})]}),"failed"===d&&a.jsxs(D,{className:"text-center p-8",children:[a.jsx(c,{className:"w-16 h-16 text-red-600 mx-auto mb-4"}),a.jsx("h2",{className:"text-2xl font-bold text-red-800 mb-4",children:"決済がキャンセルされました"}),a.jsxs("p",{className:"text-gray-600 mb-6",children:["決済がキャンセルまたは失敗しました。",l?"":"認証状態を確認してから","再度お試しください。"]}),!l&&a.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg mb-6",children:[a.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[a.jsx(c,{className:"w-5 h-5 text-orange-600"}),a.jsx("span",{className:"font-semibold text-orange-900",children:"認証状態が失われました"})]}),a.jsx("p",{className:"text-sm text-orange-800",children:"セッションが切断されました。3秒後にログインページに移動します。"})]}),a.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg mb-6",children:[a.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[a.jsx(I,{className:"w-5 h-5 text-yellow-600"}),a.jsx("span",{className:"font-semibold text-yellow-900",children:"ドッグランを利用するには"})]}),a.jsx("p",{className:"text-sm text-yellow-800",children:"入場にはPINコードが必要です。決済完了後にPINコードを生成できます。"})]}),a.jsx("div",{className:"space-y-3",children:l?a.jsxs(a.Fragment,{children:[a.jsx(A,{onClick:()=>t("/parks"),className:"w-full",children:"ドッグラン一覧に戻る"}),a.jsx(A,{variant:"secondary",onClick:()=>t("/subscription"),className:"w-full",children:"サブスクリプションを検討する"}),a.jsx(A,{variant:"secondary",onClick:()=>t("/cart"),className:"w-full",children:"カートを確認する"})]}):a.jsx(A,{onClick:()=>t("/login"),className:"w-full",children:"ログインする"})})]}),"processing"===d&&a.jsxs(D,{className:"text-center p-8",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("h2",{className:"text-xl font-bold mb-4",children:"決済を処理中..."}),a.jsx("p",{className:"text-gray-600",children:"しばらくお待ちください。決済の処理が完了するまでお時間をいただく場合があります。"})]})]})}},Symbol.toStringTag,{value:"Module"}));export{z as C,H as P,O as a,V as b,$ as c};

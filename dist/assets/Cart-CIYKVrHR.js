import{u as e,a as s,b as t,j as a,B as l}from"./index-Dp3tQatg.js";import{u as r,r as c,L as i}from"./vendor-Cwmn0chA.js";import{C as n}from"./Card-CPEZwr97.js";import{S as d,x,l as m,ab as o,e as h,C as j,ac as p,v as u,A as N}from"./ui-BHmKMuva.js";import"./supabase-Dzr8oIt2.js";function g(){const{user:g}=e(),b=r(),[f,w]=c.useState([]),[v,y]=c.useState(!0),{isActive:S}=s(),[q,k]=c.useState(null);c.useEffect((()=>{g&&L()}),[g]);const L=async()=>{try{const{data:e,error:s}=await t.from("cart_items").select("*, product:products(*)").eq("user_id",null==g?void 0:g.id).order("created_at",{ascending:!1});if(s)throw s;w(e||[])}catch(e){k(e.message||"カート情報の取得に失敗しました")}finally{y(!1)}},C=async(e,s)=>{if(s<=0)await _(e);else try{const{error:a}=await t.from("cart_items").update({quantity:s}).eq("id",e);if(a)throw a;await L()}catch(a){k("数量の更新に失敗しました。再度お試しください。")}},_=async e=>{try{const{error:s}=await t.from("cart_items").delete().eq("id",e);if(s)throw s;await L()}catch(s){k("商品の削除に失敗しました。再度お試しください。")}},F=e=>S?Math.round(.9*e):e,A=()=>{const e=f.reduce(((e,s)=>e+F(s.product.price)*s.quantity),0),s=f.reduce(((e,s)=>e+s.product.price*s.quantity),0),t=e>=5e3||S?0:690;return{subtotal:e,originalSubtotal:s,discountAmount:s-e,shippingFee:t,total:e+t}};return v?a.jsx("div",{className:"flex justify-center items-center h-64",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})}):0===f.length?a.jsxs("div",{className:"max-w-4xl mx-auto",children:[a.jsxs("h1",{className:"text-2xl font-bold mb-8 flex items-center",children:[a.jsx(d,{className:"w-8 h-8 text-green-600 mr-3"}),"ショッピングカート"]}),a.jsxs(n,{className:"text-center py-12",children:[a.jsx(d,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),a.jsx("h2",{className:"text-xl font-semibold text-gray-700 mb-2",children:"カートは空です"}),a.jsx("p",{className:"text-gray-500 mb-6",children:"お気に入りの商品をカートに追加してください"}),a.jsx(i,{to:"/shop",children:a.jsx(l,{className:"bg-green-600 hover:bg-green-700",children:"ショッピングを続ける"})})]})]}):a.jsxs("div",{className:"max-w-6xl mx-auto",children:[a.jsxs("div",{className:"flex justify-between items-center mb-8",children:[a.jsxs("h1",{className:"text-2xl font-bold flex items-center",children:[a.jsx(d,{className:"w-8 h-8 text-green-600 mr-3"}),"ショッピングカート (",f.length,"点)"]}),a.jsxs(l,{variant:"secondary",onClick:async()=>{try{const{error:e}=await t.from("cart_items").delete().eq("user_id",null==g?void 0:g.id);if(e)throw e;await L()}catch(e){k("カートの削除に失敗しました。再度お試しください。")}},className:"text-red-600 hover:text-red-700",children:[a.jsx(x,{className:"w-4 h-4 mr-2"}),"カートを空にする"]})]}),q&&a.jsxs("div",{className:"mb-6 p-4 bg-red-50 rounded-lg flex items-start",children:[a.jsx(m,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),a.jsx("p",{className:"text-red-800",children:q})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[a.jsx("div",{className:"lg:col-span-2 space-y-4",children:f.map((e=>{const s=e.product.price,t=F(s),l=S&&t<s;return a.jsx(n,{className:"p-4",children:a.jsxs("div",{className:"flex items-start space-x-4",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("img",{src:e.product.image_url,alt:e.product.name,className:"w-20 h-20 object-cover rounded-lg",onError:e=>{e.currentTarget.src="https://images.pexels.com/photos/1108099/pexels-photo-1108099.jpeg"}})}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-lg",children:e.product.name}),e.product.brand&&a.jsx("p",{className:"text-sm text-gray-500",children:e.product.brand}),a.jsxs("div",{className:"mt-1 space-y-1 text-xs text-gray-500",children:[e.product.weight&&a.jsxs("p",{children:["内容量: ",e.product.weight,"g"]}),e.product.size&&a.jsxs("p",{children:["サイズ: ",e.product.size]})]})]}),a.jsx("button",{onClick:()=>_(e.id),className:"text-red-500 hover:text-red-700 p-1",children:a.jsx(x,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs("span",{className:"text-lg font-bold text-green-600",children:["¥",t.toLocaleString()]}),l&&a.jsxs("span",{className:"text-sm text-gray-500 line-through",children:["¥",s.toLocaleString()]})]}),S&&a.jsx("p",{className:"text-xs text-purple-600",children:"サブスク会員価格"})]}),a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("button",{onClick:()=>C(e.id,e.quantity-1),className:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center hover:bg-gray-300 transition-colors",children:a.jsx(o,{className:"w-4 h-4"})}),a.jsx("span",{className:"font-medium w-8 text-center",children:e.quantity}),a.jsx("button",{onClick:()=>C(e.id,e.quantity+1),className:"w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center hover:bg-green-700 transition-colors",children:a.jsx(h,{className:"w-4 h-4"})})]})]}),a.jsx("div",{className:"mt-2 text-right",children:a.jsxs("span",{className:"text-lg font-semibold",children:["小計: ¥",(t*e.quantity).toLocaleString()]})})]})]})},e.id)}))}),a.jsxs("div",{className:"space-y-6",children:[S?a.jsxs(n,{className:"bg-gradient-to-r from-purple-500 to-pink-500 text-white p-4",children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[a.jsx(j,{className:"w-5 h-5"}),a.jsx("span",{className:"font-semibold",children:"サブスク会員特典"})]}),a.jsx("p",{className:"text-sm",children:"全商品10%OFF + 送料無料"})]}):a.jsxs(n,{className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white p-4",children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[a.jsx(j,{className:"w-5 h-5"}),a.jsx("span",{className:"font-semibold",children:"サブスクリプションでもっとお得に！"})]}),a.jsx("p",{className:"text-sm mb-3",children:"全商品10%OFF + 送料無料"}),a.jsx(i,{to:"/subscription",children:a.jsx(l,{size:"sm",className:"bg-white text-purple-600 hover:bg-gray-100",children:"詳細を見る"})})]}),a.jsxs(n,{className:"p-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"注文サマリー"}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"商品小計"}),a.jsxs("span",{children:["¥",A().originalSubtotal.toLocaleString()]})]}),A().discountAmount>0&&a.jsxs("div",{className:"flex justify-between text-purple-600",children:[a.jsx("span",{children:"サブスク割引 (10%)"}),a.jsxs("span",{children:["-¥",A().discountAmount.toLocaleString()]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsxs("span",{className:"flex items-center",children:[a.jsx(p,{className:"w-4 h-4 mr-1"}),"送料"]}),a.jsx("span",{children:0===A().shippingFee?a.jsx("span",{className:"text-green-600",children:"無料"}):`¥${A().shippingFee.toLocaleString()}`})]}),a.jsx("hr",{className:"my-3"}),a.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[a.jsx("span",{children:"合計"}),a.jsxs("span",{className:"text-green-600",children:["¥",A().total.toLocaleString()]})]})]}),!S&&A().subtotal<5e3&&a.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:a.jsxs("p",{className:"text-sm text-blue-800",children:["あと¥",(5e3-A().subtotal).toLocaleString(),"で送料無料！"]})}),a.jsxs("div",{className:"space-y-3 mt-4",children:[a.jsxs(l,{onClick:()=>{0!==f.length?b("/checkout",{state:{cartItems:f.map((e=>e.id)),totals:A()}}):k("カートに商品がありません。")},className:"w-full bg-green-600 hover:bg-green-700 text-lg py-3",children:[a.jsx(u,{className:"w-5 h-5 mr-2"}),"レジに進む",a.jsx(N,{className:"w-5 h-5 ml-2"})]}),a.jsx(i,{to:"/shop",children:a.jsx(l,{variant:"secondary",className:"w-full",children:"ショッピングを続ける"})})]})]}),a.jsx(n,{className:"p-4 bg-blue-50 border-blue-200",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(p,{className:"w-6 h-6 text-blue-600 mt-1"}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold text-blue-900 mb-1",children:"配送について"}),a.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[a.jsx("p",{children:"• 送料：全国一律¥690"}),a.jsxs("p",{children:["• ¥5,000以上のご注文で",a.jsx("span",{className:"font-medium",children:"送料無料"})]}),a.jsxs("p",{children:["• サブスク会員は",a.jsx("span",{className:"font-medium",children:"常に送料無料"})]}),a.jsx("p",{children:"• 平日14時までのご注文で翌日お届け"}),a.jsx("p",{children:"• 土日祝日も配送いたします"}),a.jsx("p",{children:"• 時間指定配送も可能です"})]})]})]})})]})]})]})}export{g as Cart};

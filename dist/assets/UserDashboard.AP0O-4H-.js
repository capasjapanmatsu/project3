var e=(e,s,a)=>new Promise(((t,l)=>{var r=e=>{try{i(a.next(e))}catch(s){l(s)}},n=e=>{try{i(a.throw(e))}catch(s){l(s)}},i=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,n);i((a=a.apply(e,s)).next())}));import{j as s,C as a,B as t,u as l,c as r,s as n}from"./index.D9xag4tn.js";import{L as i,u as c,b as d,r as o}from"./router.BWT_vQps.js";import{D as m,a as x}from"./DogCard.DW-LSdTa.js";import{t as g,a3 as h,ad as u,a as p,a7 as j,aT as N,c as f,a2 as b,v,p as y,d as w,x as _,o as k,ao as D,u as S,aU as C,_ as E,aV as F,aW as R,C as V,b as q,aa as U,J as $,Y as I}from"./ui.BPlS2KKq.js";import{v as M,h as P}from"./vaccineUploadFixed.BVh3tzvF.js";import"./vendor.D1SiiUJb.js";import"./supabase.CZ8ekJUM.js";import"./Input.tFQgyGuP.js";import"./Select.BO4O17RR.js";import"./dogBreeds.6lxY8Uni.js";import"./VaccineBadge.DLhIwHr_.js";const L=({dogs:e,user:t,selectedDog:l,showDogEditModal:r,isUpdatingDog:n,dogUpdateError:i,dogUpdateSuccess:c,dogFormData:d,dogImageFile:o,dogImagePreview:h,rabiesVaccineFile:u,comboVaccineFile:p,rabiesExpiryDate:j,comboExpiryDate:N,onDogSelect:f,onCloseDogEditModal:b,onUpdateDog:v,onDeleteDog:y,onDogImageSelect:w,onDogImageRemove:_,onRabiesVaccineSelect:k,onComboVaccineSelect:D,onFormDataChange:S,onRabiesExpiryDateChange:C,onComboExpiryDateChange:E})=>s.jsxs(a,{className:"p-6",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[s.jsx("span",{className:"mr-2",children:"🐕"}),"登録済みの愛犬"]}),s.jsxs("a",{href:"/register-dog",className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1.5 rounded-md text-sm font-medium inline-flex items-center",children:[s.jsx(g,{className:"w-4 h-4 mr-2"}),"愛犬を登録"]})]}),0===e.length?s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx("div",{className:"text-6xl mb-4",children:"🐕"}),s.jsx("p",{className:"text-lg font-medium mb-2",children:"まだ愛犬が登録されていません"}),s.jsx("p",{className:"text-sm mb-4",children:"ドッグランを利用するために、愛犬の情報を登録してください"}),s.jsxs("a",{href:"/register-dog",className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md font-medium inline-flex items-center",children:[s.jsx(g,{className:"w-4 h-4 mr-2"}),"愛犬を登録"]})]}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:e.map((e=>s.jsx(m,{dog:e,onEdit:()=>f(e)},e.id)))}),r&&l&&s.jsx(x,{dog:l,isUpdating:n,error:i,success:c,dogFormData:d,dogImagePreview:h,onClose:b,onSubmit:v,onDelete:y,onFormChange:S,onImageSelect:w,onImageRemove:_,rabiesVaccineFile:u,comboVaccineFile:p,rabiesExpiryDate:j,comboExpiryDate:N,onRabiesVaccineSelect:k,onComboVaccineSelect:D,onRabiesExpiryDateChange:C,onComboExpiryDateChange:E})]}),B=({notifications:e,onMarkAsRead:l})=>{const r=e=>{switch(e){case"reservation":return s.jsx(f,{className:"w-4 h-4 text-blue-600"});case"message":return s.jsx(N,{className:"w-4 h-4 text-green-600"});case"park_approval":return s.jsx(j,{className:"w-4 h-4 text-purple-600"});case"vaccine_approval":return s.jsx(p,{className:"w-4 h-4 text-green-600"});default:return s.jsx(h,{className:"w-4 h-4 text-gray-600"})}};return s.jsxs(a,{className:"p-6",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[s.jsx(h,{className:"w-5 h-5 mr-2"}),"通知",e.length>0&&s.jsx("span",{className:"ml-2 bg-red-500 text-white text-xs rounded-full px-2 py-1",children:e.length})]}),e.length>0&&s.jsxs(t,{size:"sm",className:"bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>{e.forEach((e=>{l(e.id)}))},children:[s.jsx(u,{className:"w-4 h-4 mr-2"}),"すべて既読にする"]})]}),0===e.length?s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx("div",{className:"text-4xl mb-4",children:"🔔"}),s.jsx("p",{className:"text-lg font-medium mb-2",children:"新しい通知はありません"}),s.jsx("p",{className:"text-sm",children:"最新の情報やお知らせがあるとここに表示されます"})]}):s.jsx("div",{className:"space-y-4",children:e.map((e=>s.jsxs("div",{className:"flex items-start space-x-3 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[s.jsx("div",{className:"flex-shrink-0 mt-1",children:r(e.type)}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:"font-medium text-gray-900 truncate",children:e.title}),s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.message}),s.jsx("p",{className:"text-xs text-gray-500 mt-2",children:new Date(e.created_at).toLocaleString("ja-JP")})]}),s.jsx("div",{className:"flex-shrink-0",children:s.jsx(t,{size:"sm",onClick:()=>l(e.id),className:"bg-blue-600 hover:bg-blue-700 text-white",children:s.jsx(u,{className:"w-4 h-4"})})})]},e.id)))})]})};function z({park:e,onSelect:a}){return s.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",onClick:()=>a(e),children:[s.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold",children:e.name}),s.jsx("p",{className:"text-sm text-gray-600",children:e.address}),s.jsxs("div",{className:"flex items-center space-x-4 mt-2",children:[s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx(b,{className:"w-4 h-4 text-yellow-400 fill-current"}),s.jsx("span",{className:"text-sm",children:e.average_rating.toFixed(1)})]}),s.jsxs("span",{className:"text-sm text-gray-500",children:[e.review_count,"件のレビュー"]})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[A(e.status),s.jsx(t,{size:"sm",className:"bg-white hover:bg-gray-50 border border-gray-300 text-gray-700",children:s.jsx(v,{className:"w-4 h-4"})})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600",children:[s.jsxs("div",{children:["料金: ¥",e.price,"/日"]}),s.jsxs("div",{children:["収容人数: ",e.max_capacity,"人"]}),s.jsxs("div",{children:["現在の利用者: ",e.current_occupancy,"人"]}),s.jsxs("div",{children:["レビュー: ★",e.average_rating.toFixed(1)]})]}),"pending"===e.status&&s.jsxs("div",{className:"mt-3 p-2 bg-yellow-50 rounded text-sm text-yellow-800",children:[s.jsx(y,{className:"w-4 h-4 inline mr-1"}),"管理者による承認をお待ちください"]}),"first_stage_passed"===e.status&&s.jsxs("div",{className:"mt-3 p-2 bg-blue-50 rounded text-sm text-blue-800",children:[s.jsx(p,{className:"w-4 h-4 inline mr-1"}),"第一審査通過！第二審査の詳細情報を入力してください"]}),"second_stage_review"===e.status&&s.jsxs("div",{className:"mt-3 p-2 bg-purple-50 rounded text-sm text-purple-800",children:[s.jsx(w,{className:"w-4 h-4 inline mr-1"}),"第二審査中です。審査完了までお待ちください"]})]})}function A(e){return s.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${{pending:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",confirmed:"bg-blue-100 text-blue-800",cancelled:"bg-gray-100 text-gray-800",first_stage_passed:"bg-blue-100 text-blue-800",second_stage_review:"bg-purple-100 text-purple-800",qr_testing:"bg-orange-100 text-orange-800"}[e]||"bg-gray-100 text-gray-800"}`,children:{pending:"承認待ち",approved:"承認済み",rejected:"却下",confirmed:"確定",cancelled:"キャンセル",first_stage_passed:"第一審査通過",second_stage_review:"第二審査中",qr_testing:"QR検査中"}[e]||e})}function H({park:e,onClose:a}){return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsxs("h2",{className:"text-xl font-bold",children:[e.name,"の管理"]}),s.jsx("button",{onClick:a,className:"text-gray-500 hover:text-gray-700",children:s.jsx(_,{className:"w-6 h-6"})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold mb-3",children:"基本情報"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("p",{children:[s.jsx("span",{className:"font-medium",children:"住所:"})," ",e.address]}),s.jsxs("p",{children:[s.jsx("span",{className:"font-medium",children:"ステータス:"})," ",A(e.status)]}),s.jsxs("p",{children:[s.jsx("span",{className:"font-medium",children:"料金:"})," ¥",e.price,"/日"]}),s.jsxs("p",{children:[s.jsx("span",{className:"font-medium",children:"最大収容人数:"})," ",e.max_capacity,"人"]}),s.jsxs("p",{children:[s.jsx("span",{className:"font-medium",children:"現在の利用者数:"})," ",e.current_occupancy,"人"]}),s.jsxs("p",{children:[s.jsx("span",{className:"font-medium",children:"評価:"})," ★",e.average_rating.toFixed(1)," (",e.review_count,"件)"]})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold mb-3",children:"設備情報"}),s.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries({parking:"駐車場",shower:"シャワー設備",restroom:"トイレ",agility:"アジリティ設備",rest_area:"休憩スペース",water_station:"給水設備"}).map((([a,t])=>s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-4 h-4 rounded "+(e.facilities[a]?"bg-green-500":"bg-gray-300")}),s.jsx("span",{className:"text-sm",children:t})]},a)))})]})]}),"first_stage_passed"===e.status&&s.jsx("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(p,{className:"w-5 h-5 text-blue-600 mt-1 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"第一審査通過"}),s.jsx("p",{className:"text-sm text-blue-800 mb-3",children:"おめでとうございます！第一審査に通過しました。次は詳細な施設情報と画像のアップロードが必要です。"}),s.jsx(i,{to:`/parks/${e.id}/second-stage`,children:s.jsx(t,{className:"bg-blue-600 hover:bg-blue-700",children:"第二審査を進める"})})]})]})}),"second_stage_review"===e.status&&s.jsx("div",{className:"mb-6 p-4 bg-purple-50 rounded-lg",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(w,{className:"w-5 h-5 text-purple-600 mt-1 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-purple-900 mb-2",children:"第二審査中"}),s.jsx("p",{className:"text-sm text-purple-800",children:"現在、管理者が施設画像を確認しています。審査完了までお待ちください。 審査には通常3-5営業日かかります。結果はメールとアプリ内通知でお知らせします。"})]})]})}),"approved"===e.status&&s.jsxs("div",{className:"mb-6",children:[s.jsx("h3",{className:"font-semibold mb-3",children:"統計情報"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[s.jsx("div",{className:"flex items-center space-x-2 mb-2",children:s.jsx("h4",{className:"font-medium text-blue-900",children:"今月の予約"})}),s.jsx("p",{className:"text-2xl font-bold text-blue-600",children:"32件"}),s.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"前月比 +12%"})]}),s.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(T,{className:"w-5 h-5 text-green-600"}),s.jsx("h4",{className:"font-medium text-green-900",children:"今月の収益"})]}),s.jsx("p",{className:"text-2xl font-bold text-green-600",children:"¥25,600"}),s.jsx("p",{className:"text-xs text-green-700 mt-1",children:"前月比 +8%"})]}),s.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(W,{className:"w-5 h-5 text-purple-600"}),s.jsx("h4",{className:"font-medium text-purple-900",children:"利用者数"})]}),s.jsx("p",{className:"text-2xl font-bold text-purple-600",children:"128人"}),s.jsx("p",{className:"text-xs text-purple-700 mt-1",children:"前月比 +15%"})]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:["approved"===e.status&&s.jsx(i,{to:`/parks/${e.id}`,children:s.jsxs(t,{className:"w-full bg-white hover:bg-gray-50 border border-gray-300 text-gray-700",children:[s.jsx(k,{className:"w-4 h-4 mr-2"}),"公開ページを見る"]})}),"approved"===e.status&&s.jsx(i,{to:"/owner-payment-system",children:s.jsxs(t,{className:"w-full bg-white hover:bg-gray-50 border border-gray-300 text-gray-700",children:[s.jsx(D,{className:"w-4 h-4 mr-2"}),"収益レポート"]})}),"second_stage_review"===e.status?s.jsx("div",{className:"w-full text-center py-3 text-gray-600 text-sm bg-gray-50 rounded border",children:"審査中のため操作できません"}):s.jsx(i,{to:"first_stage_passed"===e.status?`/parks/${e.id}/second-stage`:`/parks/${e.id}/manage`,children:s.jsx(t,{className:"w-full",children:"first_stage_passed"===e.status?s.jsxs(s.Fragment,{children:[s.jsx(J,{className:"w-4 h-4 mr-2"}),"第二審査を進める"]}):s.jsxs(s.Fragment,{children:[s.jsx(v,{className:"w-4 h-4 mr-2"}),"approved"===e.status?"設定を編集":"詳細を見る"]})})})]})]})})})}function T({className:e}){return s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,children:[s.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),s.jsx("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]})}function W({className:e}){return s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,children:[s.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),s.jsx("circle",{cx:"9",cy:"7",r:"4"}),s.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),s.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]})}function J({className:e}){return s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,children:[s.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),s.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}const O=({icon:e,label:t,value:l,color:r,trend:n})=>{const i={up:s.jsx(R,{className:"w-4 h-4 text-green-500"}),down:s.jsx(F,{className:"w-4 h-4 text-red-500"}),neutral:s.jsx(E,{className:"w-4 h-4 text-gray-500"})};return s.jsxs(a,{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${{blue:"bg-blue-50 text-blue-600",green:"bg-green-50 text-green-600",purple:"bg-purple-50 text-purple-600",orange:"bg-orange-50 text-orange-600"}[r]}`,children:e}),s.jsx("div",{className:"flex items-center space-x-1",children:i[n]})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l}),s.jsx("p",{className:"text-sm text-gray-600",children:t})]})]})},Q=({dogs:e,ownedParks:t,recentReservations:l,profile:r})=>{const n={approved:e.filter((e=>{var s;return null==(s=e.vaccine_certifications)?void 0:s.some((e=>"approved"===e.status))})).length,pending:e.filter((e=>{var s;return null==(s=e.vaccine_certifications)?void 0:s.some((e=>"pending"===e.status))})).length,total:e.length},i={approved:t.filter((e=>"approved"===e.status)).length,pending:t.filter((e=>"pending"===e.status)).length,total:t.length},c=(()=>{const e=new Date;e.setDate(1),e.setHours(0,0,0,0);return{monthly:l.filter((s=>new Date(s.created_at)>=e)).length,total:l.length}})();return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsx(O,{icon:s.jsx(S,{className:"w-6 h-6"}),label:"登録済みの愛犬",value:e.length,color:"blue",trend:e.length>0?"up":"neutral"}),s.jsx(O,{icon:s.jsx(f,{className:"w-6 h-6"}),label:"今月の予約",value:c.monthly,color:"green",trend:c.monthly>0?"up":"neutral"}),s.jsx(O,{icon:s.jsx(j,{className:"w-6 h-6"}),label:"所有施設",value:t.length,color:"purple",trend:t.length>0?"up":"neutral"}),s.jsx(O,{icon:s.jsx(C,{className:"w-6 h-6"}),label:"総予約数",value:c.total,color:"orange",trend:c.total>0?"up":"neutral"})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs(a,{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[s.jsx(C,{className:"w-5 h-5 mr-2"}),"ワクチン証明書の状況"]}),s.jsxs("div",{className:"text-sm text-gray-500",children:[n.total,"頭中"]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),s.jsx("span",{className:"text-sm",children:"承認済み"})]}),s.jsxs("span",{className:"text-sm font-medium text-green-600",children:[n.approved,"頭"]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),s.jsx("span",{className:"text-sm",children:"審査中"})]}),s.jsxs("span",{className:"text-sm font-medium text-yellow-600",children:[n.pending,"頭"]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-3 h-3 bg-gray-300 rounded-full"}),s.jsx("span",{className:"text-sm",children:"未登録"})]}),s.jsxs("span",{className:"text-sm font-medium text-gray-600",children:[n.total-n.approved-n.pending,"頭"]})]})]}),n.total>0&&s.jsx("div",{className:"mt-4 bg-gray-200 rounded-full h-2",children:s.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:n.approved/n.total*100+"%"}})})]}),"owner"===(null==r?void 0:r.user_type)&&s.jsxs(a,{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[s.jsx(j,{className:"w-5 h-5 mr-2"}),"施設管理状況"]}),s.jsxs("div",{className:"text-sm text-gray-500",children:[i.total,"施設"]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),s.jsx("span",{className:"text-sm",children:"運営中"})]}),s.jsxs("span",{className:"text-sm font-medium text-green-600",children:[i.approved,"施設"]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),s.jsx("span",{className:"text-sm",children:"審査中"})]}),s.jsxs("span",{className:"text-sm font-medium text-yellow-600",children:[i.pending,"施設"]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-3 h-3 bg-gray-300 rounded-full"}),s.jsx("span",{className:"text-sm",children:"その他"})]}),s.jsxs("span",{className:"text-sm font-medium text-gray-600",children:[i.total-i.approved-i.pending,"施設"]})]})]}),i.total>0&&s.jsx("div",{className:"mt-4 bg-gray-200 rounded-full h-2",children:s.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:i.approved/i.total*100+"%"}})})]})]})]})};function Y(){const{user:m,logout:x,isAdmin:g}=l(),u=c(),N=d(),[f,b]=o.useState(null),[v,y]=o.useState([]),[w,_]=o.useState([]),[k,D]=o.useState([]),[S,C]=o.useState([]),[E,F]=o.useState([]),[R,A]=o.useState([]),[T,W]=o.useState(!0);r();const[J,O]=o.useState(!1),[Y,G]=o.useState(null),[K,X]=o.useState(!1),[Z,ee]=o.useState(null),[se,ae]=o.useState(!1),[te,le]=o.useState(!1),[re,ne]=o.useState(""),[ie,ce]=o.useState(""),[de,oe]=o.useState({name:"",breed:"",gender:"",birthDate:""}),[me,xe]=o.useState(null),[ge,he]=o.useState(null),[ue,pe]=o.useState(null),[je,Ne]=o.useState(null),[fe,be]=o.useState(""),[ve,ye]=o.useState(""),we=()=>e(null,null,(function*(){try{const[s,a,t,l,r,i]=yield Promise.all([n.from("profiles").select("*").eq("id",null==m?void 0:m.id).single(),n.from("dogs").select("*, vaccine_certifications(*)").eq("owner_id",null==m?void 0:m.id).order("created_at",{ascending:!1}),n.from("dog_parks").select("*").eq("owner_id",null==m?void 0:m.id).order("created_at",{ascending:!1}),n.from("reservations").select("*, dog_park:dog_parks(*), dog:dogs(*)").eq("user_id",null==m?void 0:m.id).order("created_at",{ascending:!1}).limit(5),n.from("notifications").select("*").eq("user_id",null==m?void 0:m.id).eq("read",!1).order("created_at",{ascending:!1}).limit(5),n.from("news_announcements").select("*").order("created_at",{ascending:!1}).limit(3)]);let c=[];try{const e=yield n.from("dog_likes").select("\n            *,\n            dog:dogs(\n              *,\n              vaccine_certifications(*)\n            )\n          ").eq("user_id",null==m?void 0:m.id).order("created_at",{ascending:!1}).limit(10);e.data&&(c=e.data)}catch(e){}[s,a,t,l,r,i].forEach(((e,s)=>{e.error})),b(s.data),y(a.data||[]),_(t.data||[]),D(l.data||[]),C(r.data||[]),F(i.data||[]),A(c.map((e=>e.dog)).filter(Boolean))}catch(s){}finally{W(!1)}}));o.useEffect((()=>{m&&we(),N.search.includes("success=true")&&(O(!0),window.history.replaceState({},document.title,N.pathname),setTimeout((()=>O(!1)),5e3))}),[m,u,N]);const _e=e=>{G(e),X(!0)};return T?s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:s.jsx("div",{className:"flex items-center justify-center py-20",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})}):s.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[s.jsxs("div",{className:"flex justify-between items-center mb-8",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"マイページ"}),s.jsxs("p",{className:"text-gray-600 mt-1",children:["ようこそ、",(null==f?void 0:f.name)||"ユーザー","さん！"]})]}),s.jsx("div",{className:"flex items-center space-x-4",children:g&&s.jsxs("a",{href:"/admin",className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md font-medium inline-flex items-center",children:[s.jsx(V,{className:"w-4 h-4 mr-2"}),"管理者画面"]})})]}),J&&s.jsxs("div",{className:"mb-6 p-4 bg-green-100 border border-green-400 text-green-700 rounded-lg flex items-center",children:[s.jsx(p,{className:"w-5 h-5 mr-2"}),"操作が正常に完了しました！"]}),s.jsxs("div",{className:"space-y-8",children:[s.jsx(Q,{dogs:v,ownedParks:w,recentReservations:k,profile:f}),s.jsx(L,{dogs:v,user:m,selectedDog:Z,showDogEditModal:se,isUpdatingDog:te,dogUpdateError:re,dogUpdateSuccess:ie,dogFormData:de,dogImageFile:me,dogImagePreview:ge,rabiesVaccineFile:ue,comboVaccineFile:je,rabiesExpiryDate:fe,comboExpiryDate:ve,onDogSelect:e=>{var s;ee(e);const a=new Date(e.birth_date).toISOString().split("T")[0];oe({name:e.name,breed:e.breed,gender:e.gender,birthDate:a||""}),he(e.image_url||null);const t=null==(s=e.vaccine_certifications)?void 0:s[0];be((null==t?void 0:t.rabies_expiry_date)||""),ye((null==t?void 0:t.combo_expiry_date)||""),ae(!0)},onCloseDogEditModal:()=>ae(!1),onUpdateDog:s=>{(s=>{e(null,null,(function*(){if(s.preventDefault(),Z&&m){le(!0),ne(""),ce("");try{if(!(de.name&&de.breed&&de.gender&&de.birthDate))throw new Error("すべての必須項目を入力してください。");if(!["オス","メス"].includes(de.gender))throw new Error("性別は「オス」または「メス」を選択してください");let e=null;if((ue||je)&&(e=yield P(Z.id,ue||void 0,je||void 0,fe,ve),!e.success))throw new Error(e.error||"ワクチン証明書のアップロードに失敗しました");const s={name:de.name,breed:de.breed,gender:de.gender,birth_date:de.birthDate};if(me){const e=`profile_${Date.now()}_${me.name}`,a=`${Z.id}/${e}`,{error:t}=yield n.storage.from("dog-images").upload(a,me,{upsert:!0});if(t)throw t;s.image_url=n.storage.from("dog-images").getPublicUrl(a).data.publicUrl}const{error:a}=yield n.from("dogs").update(s).eq("id",Z.id);if(a)throw a;ce("ワンちゃんの情報を更新しました！"),ae(!1),yield we(),xe(null),pe(null),Ne(null),be(""),ye("")}catch(e){ne(e instanceof Error?e.message:"ワンちゃんの情報の更新に失敗しました")}finally{le(!1)}}}))})(s)},onDeleteDog:s=>{return a=s,void e(null,null,(function*(){if(window.confirm(`${a.name}の情報を削除しますか？\n\nこの操作は元に戻せません。`))try{le(!0);const{error:e}=yield n.from("dogs").delete().eq("id",a.id);if(e)throw e;ce(`${a.name}の情報を削除しました。`),ae(!1),yield we()}catch(e){ne("ワンちゃんの情報の削除に失敗しました。")}finally{le(!1)}}));var a},onDogImageSelect:s=>e(null,null,(function*(){var e;const a=null==(e=s.target.files)?void 0:e[0];if(a)try{if(a.size>10485760)return void ne("ファイルサイズは10MB以下にしてください。");if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(a.type))return void ne(`サポートされていない画像形式です: ${a.type}`);xe(a);const e=new FileReader;e.onload=e=>{var s;he(null==(s=e.target)?void 0:s.result)},e.readAsDataURL(a),ne("")}catch(t){ne("画像の処理に失敗しました。別の画像をお試しください。")}})),onDogImageRemove:()=>{e(null,null,(function*(){if(null==Z?void 0:Z.image_url)try{le(!0),ne("");const{error:e}=yield n.from("dogs").update({image_url:null}).eq("id",Z.id);if(e)return void ne("画像の削除に失敗しました。");xe(null),he(null),yield we(),ce("画像を削除しました。"),setTimeout((()=>ce("")),3e3)}catch(e){ne("画像の削除に失敗しました。")}finally{le(!1)}}))},onRabiesVaccineSelect:s=>e(null,null,(function*(){var e;const a=null==(e=s.target.files)?void 0:e[0];if(a){const e=M(a);if(!e.isValid)return void ne(e.error||"ファイルの検証に失敗しました");pe(a),ne("")}else pe(null)})),onComboVaccineSelect:s=>e(null,null,(function*(){var e;const a=null==(e=s.target.files)?void 0:e[0];if(a){const e=M(a);if(!e.isValid)return void ne(e.error||"ファイルの検証に失敗しました");Ne(a),ne("")}else Ne(null)})),onFormDataChange:oe,onRabiesExpiryDateChange:be,onComboExpiryDateChange:ye}),w.length>0&&s.jsxs(a,{className:"p-6",children:[s.jsx("div",{className:"mb-4",children:s.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[s.jsx(j,{className:"w-6 h-6 text-green-600 mr-2"}),"管理中のドッグラン (",w.length,"施設)"]})}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:w.map((e=>s.jsx(z,{park:e,onSelect:_e},e.id)))})]}),s.jsxs(a,{className:"p-6",children:[s.jsx("h2",{className:"text-xl font-semibold mb-4",children:"クイックアクション"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.jsx(i,{to:"/parks",className:"group",children:s.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg hover:bg-blue-100 transition-colors",children:[s.jsx(q,{className:"w-8 h-8 text-blue-600 mb-2"}),s.jsx("h3",{className:"font-medium text-blue-900",children:"ドッグラン検索"}),s.jsx("p",{className:"text-sm text-blue-700",children:"近くのドッグランを探す"})]})}),s.jsx(i,{to:"/community",className:"group",children:s.jsxs("div",{className:"p-4 bg-green-50 rounded-lg hover:bg-green-100 transition-colors",children:[s.jsx(U,{className:"w-8 h-8 text-green-600 mb-2"}),s.jsx("h3",{className:"font-medium text-green-900",children:"コミュニティ"}),s.jsx("p",{className:"text-sm text-green-700",children:"他の飼い主と交流"})]})}),s.jsx(i,{to:"/petshop",className:"group",children:s.jsxs("div",{className:"p-4 bg-purple-50 rounded-lg hover:bg-purple-100 transition-colors",children:[s.jsx($,{className:"w-8 h-8 text-purple-600 mb-2"}),s.jsx("h3",{className:"font-medium text-purple-900",children:"ペットショップ"}),s.jsx("p",{className:"text-sm text-purple-700",children:"ペット用品を購入"})]})}),s.jsx(i,{to:"/news",className:"group",children:s.jsxs("div",{className:"p-4 bg-orange-50 rounded-lg hover:bg-orange-100 transition-colors",children:[s.jsx(h,{className:"w-8 h-8 text-orange-600 mb-2"}),s.jsx("h3",{className:"font-medium text-orange-900",children:"新着情報"}),s.jsx("p",{className:"text-sm text-orange-700",children:"最新のお知らせ"})]})}),s.jsx(i,{to:"/liked-dogs",className:"group",children:s.jsxs("div",{className:"p-4 bg-pink-50 rounded-lg hover:bg-pink-100 transition-colors",children:[s.jsx(I,{className:"w-8 h-8 text-pink-600 mb-2"}),s.jsx("h3",{className:"font-medium text-pink-900",children:"いいねしたワンちゃん"}),s.jsx("p",{className:"text-sm text-pink-700",children:"お気に入りのワンちゃん"})]})}),s.jsx(i,{to:"/park-registration-agreement",className:"group",children:s.jsxs("div",{className:"p-4 bg-gradient-to-r from-yellow-50 to-orange-50 rounded-lg hover:from-yellow-100 hover:to-orange-100 transition-colors border-2 border-orange-200",children:[s.jsx(j,{className:"w-8 h-8 text-orange-600 mb-2"}),s.jsx("h3",{className:"font-medium text-orange-900",children:"ドッグランオーナー募集"}),s.jsx("p",{className:"text-sm text-orange-700",children:"あなたのドッグランを登録"}),s.jsx("div",{className:"mt-2 text-xs text-orange-600 font-medium",children:"🎯 収益化のチャンス！"})]})}),s.jsx(i,{to:"/facility-registration",className:"group",children:s.jsxs("div",{className:"p-4 bg-gradient-to-r from-teal-50 to-cyan-50 rounded-lg hover:from-teal-100 hover:to-cyan-100 transition-colors border-2 border-teal-200",children:[s.jsxs("div",{className:"flex items-center mb-2",children:[s.jsx(I,{className:"w-6 h-6 text-teal-600 mr-2"}),s.jsx($,{className:"w-6 h-6 text-teal-600"})]}),s.jsx("h3",{className:"font-medium text-teal-900",children:"ペット関連施設登録"}),s.jsx("p",{className:"text-sm text-teal-700",children:"店舗・宿泊施設・サロンなど"}),s.jsx("div",{className:"mt-2 text-xs text-teal-600 font-medium",children:"🎉 今なら無料掲載！"})]})})]})]}),S.length>0&&s.jsx(B,{notifications:S,onMarkAsRead:s=>{return a=s,void e(null,null,(function*(){try{yield n.from("notifications").update({read:!0}).eq("id",a),C((e=>e.filter((e=>e.id!==a))))}catch(e){}}));var a}}),s.jsxs(a,{className:"p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center",children:[s.jsx(I,{className:"w-6 h-6 text-pink-600 mr-2"}),"いいねしたワンちゃん (",R.length,"匹)"]}),0===R.length?s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx(I,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),s.jsx("p",{className:"text-lg font-medium mb-2",children:"まだいいねしたワンちゃんはいません"}),s.jsx("p",{className:"text-sm",children:"気になるワンちゃんがいたら、いいねしてみましょう！"}),s.jsx(i,{to:"/community",className:"mt-4 inline-block",children:s.jsx(t,{size:"sm",children:"コミュニティを見る"})})]}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:R.map((e=>s.jsxs(i,{to:`/dog/${e.id}`,className:"group block bg-white border border-gray-200 rounded-lg hover:shadow-md transition-shadow overflow-hidden",children:[s.jsx("div",{className:"aspect-square bg-gray-200 overflow-hidden",children:e.image_url?s.jsx("img",{src:e.image_url,alt:e.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-200"}):s.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400 text-4xl",children:"🐕"})}),s.jsxs("div",{className:"p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("h3",{className:"font-semibold text-gray-900 truncate",children:[e.name,"オス"===e.gender?"くん":"ちゃん"]}),s.jsx(I,{className:"w-4 h-4 text-pink-500 fill-current"})]}),s.jsx("p",{className:"text-sm text-gray-600 mb-1",children:e.breed}),s.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[s.jsxs("span",{children:["オス"===e.gender?"♂":"♀"," ",e.gender]}),e.like_count>0&&s.jsxs("span",{children:[e.like_count,"件のいいね"]})]})]})]},e.id)))}),R.length>=10&&s.jsx("div",{className:"mt-4 text-center",children:s.jsx("p",{className:"text-sm text-gray-500",children:"最新の10匹を表示中"})})]})]}),K&&Y&&s.jsx(H,{park:Y,onClose:()=>X(!1)})]})}export{Y as UserDashboard};

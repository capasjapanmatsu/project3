import{u as P,s as x,j as e,B as m,C as l}from"./index-B2nIfDq6.js";import{d as U,h as A,r as i}from"./react-vendor-ClX3xUyT.js";import{V as o,u as q,i as J,h as M,a as B,b as I,x as R,M as $,o as h,C as z,Y as v,aT as j}from"./ui-vendor-Bbvw08tP.js";import"./supabase-vendor-CRpuwX9I.js";function G(){const{isAdmin:p}=P(),c=U(),{userId:n}=A(),[s,w]=i.useState(null),[b,g]=i.useState(!0),[u,N]=i.useState("");i.useEffect(()=>{if(!p){c("/");return}n&&_(n)},[p,c,n]);const _=async t=>{try{g(!0),N("");const{data:a,error:C}=await x.from("profiles").select("*").eq("id",t).single();if(C)throw new Error("ユーザー情報の取得に失敗しました");const{data:k,error:f}=await x.from("dogs").select("id, name, breed, age, gender, image_url").eq("owner_id",t);f&&console.error("Dogs error:",f);const{data:d,error:y}=await x.from("reservations").select(`
          id,
          date,
          time_slot,
          total_amount,
          status,
          dog_parks (
            name
          )
        `).eq("user_id",t).order("date",{ascending:!1}).limit(20);y&&console.error("Reservations error:",y);const T=null,D=(d||[]).reduce((r,L)=>r+(L.total_amount||0),0),E=`user_${t.slice(0,8)}@unknown.com`,S={id:a.id,name:a.name||"Unknown",email:E,phone:a.phone_number||"",postal_code:a.postal_code||"",address:a.address||"",user_type:a.user_type||"user",created_at:a.created_at,is_active:!0,dogs:k||[],reservations:(d||[]).map(r=>({id:r.id,park_name:r.dog_parks?.name||"Unknown Park",date:r.date,time_slot:r.time_slot,total_amount:r.total_amount||0,status:r.status})),subscription_status:"inactive",total_spent:D,last_activity:d?.[0]?.date||""};w(S)}catch(a){console.error("Error fetching user detail:",a),N(a instanceof Error?a.message:"ユーザー詳細の取得に失敗しました")}finally{g(!1)}};return b?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):u?e.jsxs("div",{className:"max-w-4xl mx-auto p-4",children:[e.jsx("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4",children:u}),e.jsxs(m,{onClick:()=>c("/admin/users"),className:"mt-4",variant:"secondary",children:[e.jsx(o,{className:"w-4 h-4 mr-2"}),"ユーザー一覧に戻る"]})]}):s?e.jsxs("div",{className:"max-w-4xl mx-auto p-4 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(m,{onClick:()=>c("/admin/users"),variant:"secondary",size:"sm",children:[e.jsx(o,{className:"w-4 h-4 mr-2"}),"ユーザー一覧に戻る"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[s.subscription_status==="active"&&e.jsxs("span",{className:"bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-sm font-medium flex items-center",children:[e.jsx(q,{className:"w-4 h-4 mr-1"}),"サブスク会員"]}),s.is_active?e.jsxs("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded-full text-sm font-medium flex items-center",children:[e.jsx(J,{className:"w-4 h-4 mr-1"}),"アクティブ"]}):e.jsxs("span",{className:"bg-red-100 text-red-800 px-2 py-1 rounded-full text-sm font-medium flex items-center",children:[e.jsx(M,{className:"w-4 h-4 mr-1"}),"非アクティブ"]})]})]}),e.jsxs(l,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(B,{className:"w-8 h-8 text-blue-600 mr-3"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:s.name})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(I,{className:"w-5 h-5 mr-3 text-gray-400"}),e.jsx("span",{children:s.email})]}),s.phone&&e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(R,{className:"w-5 h-5 mr-3 text-gray-400"}),e.jsx("span",{children:s.phone})]}),s.address&&e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx($,{className:"w-5 h-5 mr-3 text-gray-400"}),e.jsxs("span",{children:[s.postal_code," ",s.address]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(h,{className:"w-5 h-5 mr-3 text-gray-400"}),e.jsxs("span",{children:["登録日: ",new Date(s.created_at).toLocaleDateString("ja-JP")]})]}),s.last_activity&&e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(z,{className:"w-5 h-5 mr-3 text-gray-400"}),e.jsxs("span",{children:["最終活動: ",new Date(s.last_activity).toLocaleDateString("ja-JP")]})]}),e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(v,{className:"w-5 h-5 mr-3 text-gray-400"}),e.jsxs("span",{children:["総支払額: ¥",s.total_spent.toLocaleString()]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(l,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"登録犬数"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:s.dogs.length})]}),e.jsx(j,{className:"w-8 h-8 text-blue-600"})]})}),e.jsx(l,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"予約数"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:s.reservations.length})]}),e.jsx(h,{className:"w-8 h-8 text-green-600"})]})}),e.jsx(l,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"総支払額"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:["¥",s.total_spent.toLocaleString()]})]}),e.jsx(v,{className:"w-8 h-8 text-purple-600"})]})})]}),e.jsxs(l,{className:"p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[e.jsx(j,{className:"w-5 h-5 mr-2"}),"登録犬一覧 (",s.dogs.length,"匹)"]}),s.dogs.length===0?e.jsx("p",{className:"text-gray-500",children:"登録された犬はありません"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.dogs.map(t=>e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[t.image_url?e.jsx("img",{src:t.image_url,alt:t.name,className:"w-12 h-12 rounded-full object-cover"}):e.jsx("div",{className:"w-12 h-12 bg-gray-300 rounded-full flex items-center justify-center",children:e.jsx(j,{className:"w-6 h-6 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-800",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t.breed," • ",t.gender]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[t.age,"歳"]})]})]})},t.id))})]}),e.jsxs(l,{className:"p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[e.jsx(h,{className:"w-5 h-5 mr-2"}),"予約履歴 (",s.reservations.length,"件)"]}),s.reservations.length===0?e.jsx("p",{className:"text-gray-500",children:"予約履歴はありません"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"ドッグパーク"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"予約日"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"時間"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"金額"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"ステータス"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:s.reservations.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:t.park_name}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:new Date(t.date).toLocaleDateString("ja-JP")}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:t.time_slot}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-900",children:["¥",t.total_amount.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t.status==="confirmed"?"bg-green-100 text-green-800":t.status==="cancelled"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:t.status==="confirmed"?"確定":t.status==="cancelled"?"キャンセル":"保留中"})})]},t.id))})]})})]})]}):e.jsx("div",{className:"max-w-4xl mx-auto p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600",children:"ユーザーが見つかりません"}),e.jsxs(m,{onClick:()=>c("/admin/users"),className:"mt-4",variant:"secondary",children:[e.jsx(o,{className:"w-4 h-4 mr-2"}),"ユーザー一覧に戻る"]})]})})}export{G as AdminUserDetail};

import{j as e,B as b,C as A,s as F,u as O}from"./index-BB1ywuBb.js";import{L as _,r as m}from"./react-vendor-Co5xHYdE.js";import{A as E,R as S,l as $,i as R,b as C,C as D,a8 as B,U as z,a9 as I,a7 as H,aa as P,G as T,ab as L,ac as W,H as U,q as G,ad as q,m as Y,O as k}from"./ui-vendor-B2-VOB5s.js";import"./supabase-vendor-FDBaXLCh.js";function J({message:s="データを読み込み中..."}){return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:s})]})})}function K({error:s,onRetry:n}){return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md mx-auto px-4",children:[e.jsx(E,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"エラーが発生しました"}),e.jsx("p",{className:"text-gray-600 mb-4",children:s}),e.jsxs(b,{onClick:n,className:"inline-flex items-center",children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"再試行"]})]})})}function Q({park:s}){const n=()=>{const l=new Date,u=l.getHours()*100+l.getMinutes();if(s.opening_hours&&s.closing_hours){const x=parseInt(s.opening_hours.replace(":",""),10),i=parseInt(s.closing_hours.replace(":",""),10);return u>=x&&u<=i}return!0},o=(()=>{if(!s.current_occupancy||!s.max_capacity)return{label:"情報なし",color:"text-gray-500",bgColor:"bg-gray-100"};const l=s.current_occupancy/s.max_capacity*100;return l>=90?{label:"満員",color:"text-red-600",bgColor:"bg-red-100"}:l>=70?{label:"混雑",color:"text-orange-600",bgColor:"bg-orange-100"}:l>=40?{label:"普通",color:"text-yellow-600",bgColor:"bg-yellow-100"}:{label:"空いている",color:"text-green-600",bgColor:"bg-green-100"}})(),c=n();return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:[s.image_url&&e.jsxs("div",{className:"aspect-video relative overflow-hidden rounded-t-lg",children:[e.jsx("img",{src:s.image_url,alt:s.name,className:"w-full h-full object-cover"}),e.jsx("button",{className:"absolute top-3 right-3 p-2 bg-white/80 backdrop-blur-sm rounded-full hover:bg-white transition-colors",onClick:l=>{l.preventDefault(),l.stopPropagation()},children:e.jsx($,{className:"w-4 h-4 text-gray-600 hover:text-red-500"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-900 flex-1",children:s.name}),e.jsx("div",{className:"flex items-center space-x-2 ml-2",children:c?e.jsxs("span",{className:"flex items-center text-green-600 text-sm",children:[e.jsx(R,{className:"w-4 h-4 mr-1"}),"営業中"]}):e.jsxs("span",{className:"flex items-center text-red-600 text-sm",children:[e.jsx(E,{className:"w-4 h-4 mr-1"}),"営業時間外"]})})]}),s.address&&e.jsxs("div",{className:"flex items-center text-gray-600 text-sm mb-2",children:[e.jsx(C,{className:"w-4 h-4 mr-1 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.address})]}),s.opening_hours&&s.closing_hours&&e.jsxs("div",{className:"flex items-center text-gray-600 text-sm mb-2",children:[e.jsx(D,{className:"w-4 h-4 mr-1"}),e.jsxs("span",{children:[s.opening_hours," - ",s.closing_hours]})]}),s.price_per_hour&&e.jsxs("div",{className:"flex items-center text-gray-600 text-sm mb-3",children:[e.jsx(B,{className:"w-4 h-4 mr-1"}),e.jsxs("span",{children:["¥",s.price_per_hour,"/時間"]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(z,{className:"w-4 h-4 mr-1 text-gray-600"}),e.jsx("span",{className:"text-sm text-gray-600",children:"混雑状況:"})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${o.color} ${o.bgColor}`,children:o.label})]}),s.current_occupancy!==void 0&&s.max_capacity&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-1",children:[e.jsx("span",{children:"現在の利用者"}),e.jsxs("span",{children:[s.current_occupancy," / ",s.max_capacity,"名"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${s.current_occupancy/s.max_capacity>=.9?"bg-red-500":s.current_occupancy/s.max_capacity>=.7?"bg-orange-500":s.current_occupancy/s.max_capacity>=.4?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(s.current_occupancy/s.max_capacity*100,100)}%`}})})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(_,{to:`/parks/${s.id}`,className:"flex-1",children:e.jsxs(b,{variant:"outline",className:"w-full flex items-center justify-center",children:[e.jsx(I,{className:"w-4 h-4 mr-1"}),"詳細を見る"]})}),c&&s.current_occupancy<s.max_capacity&&e.jsx(_,{to:`/parks/${s.id}/reserve`,className:"flex-1",children:e.jsx(b,{className:"w-full",children:"予約する"})})]})]})]})}function Z({icon:s,title:n,description:r,action:o,className:c=""}){return e.jsxs("div",{className:`flex flex-col items-center justify-center py-12 px-4 text-center ${c}`,children:[e.jsx("div",{className:"mb-4 text-gray-400",children:s||e.jsx(H,{className:"w-16 h-16"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:n}),r&&e.jsx("p",{className:"text-gray-600 max-w-md mb-6",children:r}),o&&e.jsx(b,{onClick:o.onClick,variant:"outline",children:o.label})]})}const v={veterinary_clinic:{icon:Y,label:"動物病院",color:"text-red-600"},pet_friendly_restaurant:{icon:q,label:"ペット同伴レストラン",color:"text-orange-600"},pet_shop:{icon:G,label:"ペットショップ",color:"text-blue-600"},pet_friendly_hotel:{icon:U,label:"ペット同伴宿泊",color:"text-green-600"},pet_salon:{icon:L,label:"ペットサロン",color:"text-purple-600"},pet_hotel:{icon:W,label:"ペットホテル",color:"text-indigo-600"},other:{icon:L,label:"その他",color:"text-gray-600"}};function X({facility:s,showDistance:n,distance:r}){const o=()=>{const t=new Date,h=t.getHours()*100+t.getMinutes();if(s.opening_hours&&s.closing_hours){const j=parseInt(s.opening_hours.replace(":",""),10),N=parseInt(s.closing_hours.replace(":",""),10);return h>=j&&h<=N}return!0},l=(t=>!t||!(t in v)?v.other:v[t])(s.category),u=l.icon,x=o(),i=t=>t?e.jsxs("div",{className:"flex items-center space-x-1",children:[[1,2,3,4,5].map(h=>e.jsx(k,{className:`w-4 h-4 ${h<=t?"text-yellow-400 fill-current":"text-gray-300"}`},h)),e.jsxs("span",{className:"text-sm text-gray-600 ml-1",children:["(",t,")"]})]}):null,g=t=>t?t<1?`${Math.round(t*1e3)}m`:`${t.toFixed(1)}km`:"";return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:[s.image_url&&e.jsxs("div",{className:"aspect-video relative overflow-hidden rounded-t-lg",children:[e.jsx("img",{src:s.image_url,alt:s.name,className:"w-full h-full object-cover",loading:"lazy"}),e.jsx("button",{className:"absolute top-3 right-3 p-2 bg-white/80 backdrop-blur-sm rounded-full hover:bg-white transition-colors",onClick:t=>{t.preventDefault(),t.stopPropagation()},children:e.jsx($,{className:"w-4 h-4 text-gray-600 hover:text-red-500"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(u,{className:`w-5 h-5 ${l.color}`}),e.jsx("span",{className:"text-sm text-gray-600",children:l.label})]}),x?e.jsx("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full",children:"営業中"}):e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full",children:"営業時間外"})]}),e.jsx("h3",{className:"font-semibold text-lg text-gray-900 mb-2 line-clamp-2",children:s.name}),s.rating&&e.jsx("div",{className:"mb-2",children:i(s.rating)}),s.address&&e.jsxs("div",{className:"flex items-start text-gray-600 text-sm mb-2",children:[e.jsx(C,{className:"w-4 h-4 mr-1 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"line-clamp-2",children:s.address})]}),n&&r&&e.jsxs("div",{className:"flex items-center text-gray-600 text-sm mb-2",children:[e.jsx(P,{className:"w-4 h-4 mr-1"}),e.jsxs("span",{children:["現在地から ",g(r)]})]}),s.opening_hours&&s.closing_hours&&e.jsxs("div",{className:"flex items-center text-gray-600 text-sm mb-2",children:[e.jsx(D,{className:"w-4 h-4 mr-1"}),e.jsxs("span",{children:[s.opening_hours," - ",s.closing_hours]})]}),s.phone&&e.jsxs("div",{className:"flex items-center text-gray-600 text-sm mb-3",children:[e.jsx(T,{className:"w-4 h-4 mr-1"}),e.jsx("a",{href:`tel:${s.phone}`,className:"hover:text-blue-600 transition-colors",onClick:t=>t.stopPropagation(),children:s.phone})]}),s.description&&e.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(_,{to:`/facilities/${s.id}`,className:"flex-1",children:e.jsxs(b,{variant:"outline",className:"w-full flex items-center justify-center",children:[e.jsx(I,{className:"w-4 h-4 mr-1"}),"詳細を見る"]})}),s.website_url&&e.jsx("a",{href:s.website_url,target:"_blank",rel:"noopener noreferrer",className:"flex-1",onClick:t=>t.stopPropagation(),children:e.jsx(b,{className:"w-full",children:"ウェブサイト"})})]})]})]})}const V={lat:35.6762,lng:139.6503};function ee({parks:s=[],facilities:n=[],activeView:r="dogparks",onLocationSelect:o,center:c=V,className:l=""}){const u=m.useRef(null),[x,i]=m.useState(!1),[g,t]=m.useState(null),h=m.useCallback(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(f=>{const w={lat:f.coords.latitude,lng:f.coords.longitude};t(w)},f=>{console.warn("位置情報の取得に失敗:",f)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e5})},[]);m.useEffect(()=>{const f=async()=>{try{if(!window.google){const d=document.createElement("script");d.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC9sxGamDZmdKIz3vP1CWLJORl-QkoWgHg&libraries=places",d.async=!0,d.defer=!0,await new Promise((a,p)=>{d.onload=()=>a(),d.onerror=()=>p(new Error("Google Maps API の読み込みに失敗しました")),document.head.appendChild(d)})}if(u.current&&window.google){const d=new window.google.maps.Map(u.current,{center:c,zoom:13,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1});w(d),i(!0)}}catch(d){console.warn("Google Maps の初期化に失敗:",d),i(!1)}},w=d=>{(r==="dogparks"||r==="facilities")&&s.forEach(a=>{if(a.latitude&&a.longitude){const p=new window.google.maps.Marker({position:{lat:Number(a.latitude),lng:Number(a.longitude)},map:d,title:a.name,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:8,fillColor:"#3B82F6",fillOpacity:1,strokeWeight:2,strokeColor:"#FFFFFF"}}),y=new window.google.maps.InfoWindow({content:`
                <div style="padding: 8px; max-width: 200px;">
                  <h3 style="font-weight: bold; margin-bottom: 4px; color: #1F2937;">${a.name}</h3>
                  ${a.address?`<p style="font-size: 12px; color: #6B7280; margin-bottom: 8px;">${a.address}</p>`:""}
                  ${a.price?`<p style="font-size: 12px; color: #6B7280;">料金: ¥${a.price}/時間</p>`:""}
                </div>
              `});p.addListener("click",()=>{y.open(d,p)})}}),(r==="facilities"||r==="dogparks")&&n.forEach(a=>{if(a.latitude&&a.longitude){const p=new window.google.maps.Marker({position:{lat:Number(a.latitude),lng:Number(a.longitude)},map:d,title:a.name,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:6,fillColor:"#10B981",fillOpacity:1,strokeWeight:2,strokeColor:"#FFFFFF"}}),y=new window.google.maps.InfoWindow({content:`
                <div style="padding: 8px; max-width: 200px;">
                  <h3 style="font-weight: bold; margin-bottom: 4px; color: #1F2937;">${a.name}</h3>
                  ${a.address?`<p style="font-size: 12px; color: #6B7280; margin-bottom: 8px;">${a.address}</p>`:""}
                  ${a.phone?`<p style="font-size: 12px; color: #6B7280;">TEL: ${a.phone}</p>`:""}
                </div>
              `});p.addListener("click",()=>{y.open(d,p)})}}),g&&new window.google.maps.Marker({position:g,map:d,title:"現在地",icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:6,fillColor:"#EF4444",fillOpacity:1,strokeWeight:2,strokeColor:"#FFFFFF"}})};f()},[s,n,r,c,g]);const N=(r==="dogparks"?s:n).length;return e.jsxs(A,{className:`overflow-hidden ${l}`,children:[e.jsxs("div",{className:"p-4 border-b bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(C,{className:"w-5 h-5 text-blue-600 mr-2"}),e.jsxs("h3",{className:"font-semibold",children:[r==="dogparks"?"ドッグパーク":"ペット施設","マップ"]})]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[N,"件"]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("div",{className:"flex items-center space-x-4 text-xs",children:[r==="dogparks"&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-600 rounded-full mr-2"}),e.jsx("span",{children:"ドッグパーク"})]}),r==="facilities"&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-green-600 rounded-full mr-2"}),e.jsx("span",{children:"ペット施設"})]}),g&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full mr-2"}),e.jsx("span",{children:"現在地"})]})]}),e.jsxs(b,{size:"sm",variant:"secondary",onClick:h,className:"text-xs",children:[e.jsx(P,{className:"w-3 h-3 mr-1"}),"現在地"]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{ref:u,className:"w-full h-96",style:{minHeight:"400px"}}),!x&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"マップを読み込み中..."})]})})]}),e.jsx("div",{className:"p-3 border-t bg-gray-50 text-xs text-gray-500 text-center",children:"マーカーをクリックすると詳細情報が表示されます"})]})}function se({activeView:s,parks:n,facilities:r}){const o=s==="dogparks"?n:r;return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsx(ee,{parks:n,facilities:r,activeView:s})}),e.jsx("div",{children:o.length===0?e.jsx(Z,{title:s==="dogparks"?"ドッグパークが見つかりません":"施設が見つかりません",description:s==="dogparks"?"近くにドッグパークがないか、現在準備中です。":"近くにペット施設がないか、現在準備中です。"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:s==="dogparks"?n.map(c=>e.jsx(Q,{park:c},c.id)):r.map(c=>e.jsx(X,{facility:c},c.id))})})]})}function te({activeView:s,onRefresh:n}){return e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:s==="dogparks"?"ドッグパーク一覧":"ペット施設一覧"}),e.jsx("p",{className:"text-gray-600 mt-1",children:s==="dogparks"?"お近くのドッグパークを見つけましょう":"ペットと一緒に利用できる施設を探しましょう"})]}),e.jsxs(b,{onClick:n,variant:"outline",size:"sm",children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"更新"]})]})})})}function ae(){const[s,n]=m.useState([]),[r,o]=m.useState(!1),[c,l]=m.useState(null),u=m.useCallback(async()=>{try{o(!0),l(null);const{data:x,error:i}=await F.from("dog_parks").select(`
          *,
          profiles:owner_id (
            name,
            address,
            phone_number,
            email,
            postal_code
          )
        `).eq("status","approved").order("created_at",{ascending:!1});if(i)throw i;const g=(x||[]).map(t=>{const h=Array.isArray(t.profiles)?t.profiles[0]:t.profiles;return{id:t.id||"",name:t.name||"",description:t.description||t.facility_details||"",address:t.address||"",latitude:Number(t.latitude)||0,longitude:Number(t.longitude)||0,max_capacity:Number(t.max_capacity)||20,current_occupancy:Number(t.current_occupancy)||0,price:Number(t.price)||Number(t.hourly_rate)||0,status:t.status||"approved",facilities:t.facilities?typeof t.facilities=="object"?Object.entries(t.facilities).filter(([j,N])=>N).map(([j])=>j).join(","):t.facilities:t.facility_details||"",image_url:t.image_url||t.cover_image_url||"https://via.placeholder.com/400x300?text="+encodeURIComponent(t.name||"ドッグパーク"),average_rating:Number(t.average_rating)||4,review_count:Number(t.review_count)||Math.floor(Math.random()*50)+5,created_at:t.created_at||""}});n(g)}catch(x){const i=x instanceof Error?x.message:"データの取得に失敗しました";l(i)}finally{o(!1)}},[]);return{parks:s,isLoading:r,error:c,fetchParkData:u,setError:l,setIsLoading:o}}function re(){const[s,n]=m.useState([]),[r,o]=m.useState(!1),[c,l]=m.useState(null),u=m.useCallback(async()=>{try{o(!0),l(null);const{data:x,error:i}=await F.from("pet_facilities").select(`
          *,
          facility_categories (
            name,
            name_ja
          )
        `).eq("status","approved").order("name");if(i)throw i;const g=(x||[]).map(t=>({id:t.id||"",name:t.name||"",description:t.description||"",category:t.category_id||"other",address:t.address||"",latitude:Number(t.latitude)||0,longitude:Number(t.longitude)||0,phone:t.phone||"",website:t.website||"",status:t.status||"pending",created_at:t.created_at||"",category_name:t.facility_categories?.name_ja||""}));n(g)}catch(x){const i=x instanceof Error?x.message:"施設データの取得に失敗しました";l(i)}finally{o(!1)}},[]);return{facilities:s,facilitiesLoading:r,error:c,fetchFacilities:u,setError:l,setFacilitiesLoading:o}}const ne={pet_hotel:"ペットホテル",pet_salon:"ペットサロン",veterinary:"動物病院",pet_cafe:"ペットカフェ",pet_restaurant:"ペット同伴レストラン",pet_shop:"ペットショップ",pet_accommodation:"ペット同伴宿泊"};function de(){const[s,n]=m.useState("dogparks"),[r,o]=m.useState(null),[c,l]=m.useState(!1),{user:u,isAuthenticated:x}=O(),{parks:i,isLoading:g,error:t,fetchParkData:h}=ae(),{facilities:j,facilitiesLoading:N,error:f,fetchFacilities:w}=re();m.useEffect(()=>{(async()=>{s==="dogparks"?await h():await w()})()},[s,h,w]);const d=s==="dogparks"?g:N,a=s==="dogparks"?t:f,p=()=>{(async()=>{s==="dogparks"?await h():await w()})()};return d?e.jsx(J,{}):a?e.jsx(K,{error:a,onRetry:p}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(te,{activeView:s,onRefresh:p}),!1,e.jsx("div",{className:"bg-white border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex space-x-4 py-4",children:[e.jsx("button",{onClick:()=>n("dogparks"),className:`px-4 py-2 rounded-lg font-medium ${s==="dogparks"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900"}`,children:"ドッグパーク"}),e.jsx("button",{onClick:()=>n("facilities"),className:`px-4 py-2 rounded-lg font-medium ${s==="facilities"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900"}`,children:"ペット施設"})]})})}),s==="facilities"&&e.jsx("div",{className:"bg-white border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(ne).map(([y,M])=>e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded",children:M},y))})})}),e.jsx(se,{activeView:s,parks:i,facilities:j})]})}export{de as DogParkList};

var e=(e,s,a)=>new Promise((t,r)=>{var l=e=>{try{n(a.next(e))}catch(s){r(s)}},i=e=>{try{n(a.throw(e))}catch(s){r(s)}},n=e=>e.done?t(e.value):Promise.resolve(e.value).then(l,i);n((a=a.apply(e,s)).next())});import{j as s,B as a,C as t,s as r,u as l}from"./index.CQlxbczY.js";import{r as i}from"./vendor.CKEClKZl.js";import{A as n,R as c,y as o,g as d,b as m,C as x,$ as p,U as h,a0 as u,_ as g,a1 as f,s as j,a2 as b,a3 as y,H as N,j as w,a4 as v,a5 as _,v as k}from"./ui.C72fRZ1L.js";import{L as C}from"./router.B_7Atevv.js";import"./supabase.X3H3st79.js";function F({message:e="データを読み込み中..."}){return s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:e})]})})}function $({error:e,onRetry:t}){return s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center max-w-md mx-auto px-4",children:[s.jsx(n,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),s.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"エラーが発生しました"}),s.jsx("p",{className:"text-gray-600 mb-4",children:e}),s.jsxs(a,{onClick:t,className:"inline-flex items-center",children:[s.jsx(c,{className:"w-4 h-4 mr-2"}),"再試行"]})]})})}function S({park:e}){const t=(()=>{if(!e.current_occupancy||!e.max_capacity)return{label:"情報なし",color:"text-gray-500",bgColor:"bg-gray-100"};const s=e.current_occupancy/e.max_capacity*100;return s>=90?{label:"満員",color:"text-red-600",bgColor:"bg-red-100"}:s>=70?{label:"混雑",color:"text-orange-600",bgColor:"bg-orange-100"}:s>=40?{label:"普通",color:"text-yellow-600",bgColor:"bg-yellow-100"}:{label:"空いている",color:"text-green-600",bgColor:"bg-green-100"}})(),r=(()=>{const s=new Date,a=100*s.getHours()+s.getMinutes();if(e.opening_hours&&e.closing_hours){const s=parseInt(e.opening_hours.replace(":",""),10),t=parseInt(e.closing_hours.replace(":",""),10);return a>=s&&a<=t}return!0})();return s.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:[e.image_url&&s.jsxs("div",{className:"aspect-video relative overflow-hidden rounded-t-lg",children:[s.jsx("img",{src:e.image_url,alt:e.name,className:"w-full h-full object-cover"}),s.jsx("button",{className:"absolute top-3 right-3 p-2 bg-white/80 backdrop-blur-sm rounded-full hover:bg-white transition-colors",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:s.jsx(o,{className:"w-4 h-4 text-gray-600 hover:text-red-500"})})]}),s.jsxs("div",{className:"p-4",children:[s.jsxs("div",{className:"flex items-start justify-between mb-2",children:[s.jsx("h3",{className:"font-semibold text-lg text-gray-900 flex-1",children:e.name}),s.jsx("div",{className:"flex items-center space-x-2 ml-2",children:r?s.jsxs("span",{className:"flex items-center text-green-600 text-sm",children:[s.jsx(d,{className:"w-4 h-4 mr-1"}),"営業中"]}):s.jsxs("span",{className:"flex items-center text-red-600 text-sm",children:[s.jsx(n,{className:"w-4 h-4 mr-1"}),"営業時間外"]})})]}),e.address&&s.jsxs("div",{className:"flex items-center text-gray-600 text-sm mb-2",children:[s.jsx(m,{className:"w-4 h-4 mr-1 flex-shrink-0"}),s.jsx("span",{className:"truncate",children:e.address})]}),e.opening_hours&&e.closing_hours&&s.jsxs("div",{className:"flex items-center text-gray-600 text-sm mb-2",children:[s.jsx(x,{className:"w-4 h-4 mr-1"}),s.jsxs("span",{children:[e.opening_hours," - ",e.closing_hours]})]}),e.price_per_hour&&s.jsxs("div",{className:"flex items-center text-gray-600 text-sm mb-3",children:[s.jsx(p,{className:"w-4 h-4 mr-1"}),s.jsxs("span",{children:["¥",e.price_per_hour,"/時間"]})]}),s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(h,{className:"w-4 h-4 mr-1 text-gray-600"}),s.jsx("span",{className:"text-sm text-gray-600",children:"混雑状況:"})]}),s.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t.color} ${t.bgColor}`,children:t.label})]}),void 0!==e.current_occupancy&&e.max_capacity&&s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-1",children:[s.jsx("span",{children:"現在の利用者"}),s.jsxs("span",{children:[e.current_occupancy," / ",e.max_capacity,"名"]})]}),s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:s.jsx("div",{className:"h-2 rounded-full transition-all duration-300 "+(e.current_occupancy/e.max_capacity>=.9?"bg-red-500":e.current_occupancy/e.max_capacity>=.7?"bg-orange-500":e.current_occupancy/e.max_capacity>=.4?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(e.current_occupancy/e.max_capacity*100,100)}%`}})})]}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx(C,{to:`/parks/${e.id}`,className:"flex-1",children:s.jsxs(a,{variant:"outline",className:"w-full flex items-center justify-center",children:[s.jsx(u,{className:"w-4 h-4 mr-1"}),"詳細を見る"]})}),r&&e.current_occupancy<e.max_capacity&&s.jsx(C,{to:`/parks/${e.id}/reserve`,className:"flex-1",children:s.jsx(a,{className:"w-full",children:"予約する"})})]})]})]})}function E({icon:e,title:t,description:r,action:l,className:i=""}){return s.jsxs("div",{className:`flex flex-col items-center justify-center py-12 px-4 text-center ${i}`,children:[s.jsx("div",{className:"mb-4 text-gray-400",children:e||s.jsx(g,{className:"w-16 h-16"})}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:t}),r&&s.jsx("p",{className:"text-gray-600 max-w-md mb-6",children:r}),l&&s.jsx(a,{onClick:l.onClick,variant:"outline",children:l.label})]})}const L={veterinary_clinic:{icon:_,label:"動物病院",color:"text-red-600"},pet_friendly_restaurant:{icon:v,label:"ペット同伴レストラン",color:"text-orange-600"},pet_shop:{icon:w,label:"ペットショップ",color:"text-blue-600"},pet_friendly_hotel:{icon:N,label:"ペット同伴宿泊",color:"text-green-600"},pet_salon:{icon:b,label:"ペットサロン",color:"text-purple-600"},pet_hotel:{icon:y,label:"ペットホテル",color:"text-indigo-600"},other:{icon:b,label:"その他",color:"text-gray-600"}};function P({facility:e,showDistance:t,distance:r}){const l=(i=e.category)&&i in L?L[i]:L.other;var i;const n=l.icon,c=(()=>{const s=new Date,a=100*s.getHours()+s.getMinutes();if(e.opening_hours&&e.closing_hours){const s=parseInt(e.opening_hours.replace(":",""),10),t=parseInt(e.closing_hours.replace(":",""),10);return a>=s&&a<=t}return!0})();return s.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:[e.image_url&&s.jsxs("div",{className:"aspect-video relative overflow-hidden rounded-t-lg",children:[s.jsx("img",{src:e.image_url,alt:e.name,className:"w-full h-full object-cover",loading:"lazy"}),s.jsx("button",{className:"absolute top-3 right-3 p-2 bg-white/80 backdrop-blur-sm rounded-full hover:bg-white transition-colors",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:s.jsx(o,{className:"w-4 h-4 text-gray-600 hover:text-red-500"})})]}),s.jsxs("div",{className:"p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(n,{className:`w-5 h-5 ${l.color}`}),s.jsx("span",{className:"text-sm text-gray-600",children:l.label})]}),c?s.jsx("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full",children:"営業中"}):s.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full",children:"営業時間外"})]}),s.jsx("h3",{className:"font-semibold text-lg text-gray-900 mb-2 line-clamp-2",children:e.name}),e.rating&&s.jsx("div",{className:"mb-2",children:(p=e.rating,p?s.jsxs("div",{className:"flex items-center space-x-1",children:[[1,2,3,4,5].map(e=>s.jsx(k,{className:"w-4 h-4 "+(e<=p?"text-yellow-400 fill-current":"text-gray-300")},e)),s.jsxs("span",{className:"text-sm text-gray-600 ml-1",children:["(",p,")"]})]}):null)}),e.address&&s.jsxs("div",{className:"flex items-start text-gray-600 text-sm mb-2",children:[s.jsx(m,{className:"w-4 h-4 mr-1 flex-shrink-0 mt-0.5"}),s.jsx("span",{className:"line-clamp-2",children:e.address})]}),t&&r&&s.jsxs("div",{className:"flex items-center text-gray-600 text-sm mb-2",children:[s.jsx(f,{className:"w-4 h-4 mr-1"}),s.jsxs("span",{children:["現在地から ",(d=r,d?d<1?`${Math.round(1e3*d)}m`:`${d.toFixed(1)}km`:"")]})]}),e.opening_hours&&e.closing_hours&&s.jsxs("div",{className:"flex items-center text-gray-600 text-sm mb-2",children:[s.jsx(x,{className:"w-4 h-4 mr-1"}),s.jsxs("span",{children:[e.opening_hours," - ",e.closing_hours]})]}),e.phone&&s.jsxs("div",{className:"flex items-center text-gray-600 text-sm mb-3",children:[s.jsx(j,{className:"w-4 h-4 mr-1"}),s.jsx("a",{href:`tel:${e.phone}`,className:"hover:text-blue-600 transition-colors",onClick:e=>e.stopPropagation(),children:e.phone})]}),e.description&&s.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-2",children:e.description}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx(C,{to:`/facilities/${e.id}`,className:"flex-1",children:s.jsxs(a,{variant:"outline",className:"w-full flex items-center justify-center",children:[s.jsx(u,{className:"w-4 h-4 mr-1"}),"詳細を見る"]})}),e.website_url&&s.jsx("a",{href:e.website_url,target:"_blank",rel:"noopener noreferrer",className:"flex-1",onClick:e=>e.stopPropagation(),children:s.jsx(a,{className:"w-full",children:"ウェブサイト"})})]})]})]});var d,p}const I={lat:35.6762,lng:139.6503};function M({parks:r=[],facilities:l=[],activeView:n="dogparks",onLocationSelect:c,center:o=I,className:d=""}){const x=i.useRef(null),[p,h]=i.useState(!1),[u,g]=i.useState(null),j=i.useCallback(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{const s={lat:e.coords.latitude,lng:e.coords.longitude};g(s)},e=>{},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e5})},[]);i.useEffect(()=>{const s=e=>{"dogparks"!==n&&"facilities"!==n||r.forEach(s=>{if(s.latitude&&s.longitude){const a=new window.google.maps.Marker({position:{lat:Number(s.latitude),lng:Number(s.longitude)},map:e,title:s.name,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:8,fillColor:"#3B82F6",fillOpacity:1,strokeWeight:2,strokeColor:"#FFFFFF"}}),t=new window.google.maps.InfoWindow({content:`\n                <div style="padding: 8px; max-width: 200px;">\n                  <h3 style="font-weight: bold; margin-bottom: 4px; color: #1F2937;">${s.name}</h3>\n                  ${s.address?`<p style="font-size: 12px; color: #6B7280; margin-bottom: 8px;">${s.address}</p>`:""}\n                  ${s.price?`<p style="font-size: 12px; color: #6B7280;">料金: ¥${s.price}/時間</p>`:""}\n                </div>\n              `});a.addListener("click",()=>{t.open(e,a)})}}),"facilities"!==n&&"dogparks"!==n||l.forEach(s=>{if(s.latitude&&s.longitude){const a=new window.google.maps.Marker({position:{lat:Number(s.latitude),lng:Number(s.longitude)},map:e,title:s.name,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:6,fillColor:"#10B981",fillOpacity:1,strokeWeight:2,strokeColor:"#FFFFFF"}}),t=new window.google.maps.InfoWindow({content:`\n                <div style="padding: 8px; max-width: 200px;">\n                  <h3 style="font-weight: bold; margin-bottom: 4px; color: #1F2937;">${s.name}</h3>\n                  ${s.address?`<p style="font-size: 12px; color: #6B7280; margin-bottom: 8px;">${s.address}</p>`:""}\n                  ${s.phone?`<p style="font-size: 12px; color: #6B7280;">TEL: ${s.phone}</p>`:""}\n                </div>\n              `});a.addListener("click",()=>{t.open(e,a)})}}),u&&new window.google.maps.Marker({position:u,map:e,title:"現在地",icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:6,fillColor:"#EF4444",fillOpacity:1,strokeWeight:2,strokeColor:"#FFFFFF"}})};(()=>{e(this,null,function*(){try{if(!window.google){const e=document.createElement("script");e.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC9sxGamDZmdKIz3vP1CWLJORl-QkoWgHg&libraries=places",e.async=!0,e.defer=!0,yield new Promise((s,a)=>{e.onload=()=>s(),e.onerror=()=>a(new Error("Google Maps API の読み込みに失敗しました")),document.head.appendChild(e)})}if(x.current&&window.google){const e=new window.google.maps.Map(x.current,{center:o,zoom:13,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1});s(e),h(!0)}}catch(e){h(!1)}})})()},[r,l,n,o,u]);const b=("dogparks"===n?r:l).length;return s.jsxs(t,{className:`overflow-hidden ${d}`,children:[s.jsxs("div",{className:"p-4 border-b bg-gray-50",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(m,{className:"w-5 h-5 text-blue-600 mr-2"}),s.jsxs("h3",{className:"font-semibold",children:["dogparks"===n?"ドッグパーク":"ペット施設","マップ"]})]}),s.jsxs("span",{className:"text-sm text-gray-500",children:[b,"件"]})]}),s.jsxs("div",{className:"flex justify-between items-center mt-2",children:[s.jsxs("div",{className:"flex items-center space-x-4 text-xs",children:["dogparks"===n&&s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-3 h-3 bg-blue-600 rounded-full mr-2"}),s.jsx("span",{children:"ドッグパーク"})]}),"facilities"===n&&s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-3 h-3 bg-green-600 rounded-full mr-2"}),s.jsx("span",{children:"ペット施設"})]}),u&&s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full mr-2"}),s.jsx("span",{children:"現在地"})]})]}),s.jsxs(a,{size:"sm",variant:"secondary",onClick:j,className:"text-xs",children:[s.jsx(f,{className:"w-3 h-3 mr-1"}),"現在地"]})]})]}),s.jsxs("div",{className:"relative",children:[s.jsx("div",{ref:x,className:"w-full h-96",style:{minHeight:"400px"}}),!p&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),s.jsx("p",{className:"text-sm text-gray-600",children:"マップを読み込み中..."})]})})]}),s.jsx("div",{className:"p-3 border-t bg-gray-50 text-xs text-gray-500 text-center",children:"マーカーをクリックすると詳細情報が表示されます"})]})}function R({activeView:e,parks:a,facilities:t}){const r="dogparks"===e?a:t;return s.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[s.jsx("div",{className:"mb-8",children:s.jsx(M,{parks:a,facilities:t,activeView:e})}),s.jsx("div",{children:0===r.length?s.jsx(E,{title:"dogparks"===e?"ドッグパークが見つかりません":"施設が見つかりません",description:"dogparks"===e?"近くにドッグパークがないか、現在準備中です。":"近くにペット施設がないか、現在準備中です。"}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:"dogparks"===e?a.map(e=>s.jsx(S,{park:e},e.id)):t.map(e=>s.jsx(P,{facility:e},e.id))})})]})}function z({activeView:e,onRefresh:t}){return s.jsx("div",{className:"bg-white shadow-sm border-b",children:s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"dogparks"===e?"ドッグパーク一覧":"ペット施設一覧"}),s.jsx("p",{className:"text-gray-600 mt-1",children:"dogparks"===e?"お近くのドッグパークを見つけましょう":"ペットと一緒に利用できる施設を探しましょう"})]}),s.jsxs(a,{onClick:t,variant:"outline",size:"sm",children:[s.jsx(c,{className:"w-4 h-4 mr-2"}),"更新"]})]})})})}const A={pet_hotel:"ペットホテル",pet_salon:"ペットサロン",veterinary:"動物病院",pet_cafe:"ペットカフェ",pet_restaurant:"ペット同伴レストラン",pet_shop:"ペットショップ",pet_accommodation:"ペット同伴宿泊"};function D(){const[a,t]=i.useState("dogparks"),[n,c]=i.useState(null),[o,d]=i.useState(!1),{user:m,isAuthenticated:x}=l(),{parks:p,isLoading:h,error:u,fetchParkData:g}=function(){const[s,a]=i.useState([]),[t,l]=i.useState(!1),[n,c]=i.useState(null);return{parks:s,isLoading:t,error:n,fetchParkData:i.useCallback(()=>e(this,null,function*(){try{l(!0),c(null);const{data:e,error:s}=yield r.from("dog_parks").select("\n          *,\n          profiles:owner_id (\n            name,\n            address,\n            phone_number,\n            email,\n            postal_code\n          )\n        ").eq("status","approved").order("created_at",{ascending:!1});if(s)throw s;const t=(e||[]).map(e=>(Array.isArray(e.profiles)?e.profiles[0]:e.profiles,{id:e.id||"",name:e.name||"",description:e.description||e.facility_details||"",address:e.address||"",latitude:Number(e.latitude)||0,longitude:Number(e.longitude)||0,max_capacity:Number(e.max_capacity)||20,current_occupancy:Number(e.current_occupancy)||0,price:Number(e.price)||Number(e.hourly_rate)||0,status:e.status||"approved",facilities:e.facilities?"object"==typeof e.facilities?Object.entries(e.facilities).filter(([e,s])=>s).map(([e])=>e).join(","):e.facilities:e.facility_details||"",image_url:e.image_url||e.cover_image_url||"https://via.placeholder.com/400x300?text="+encodeURIComponent(e.name||"ドッグパーク"),average_rating:Number(e.average_rating)||4,review_count:Number(e.review_count)||Math.floor(50*Math.random())+5,created_at:e.created_at||""}));a(t)}catch(e){const s=e instanceof Error?e.message:"データの取得に失敗しました";c(s)}finally{l(!1)}}),[]),setError:c,setIsLoading:l}}(),{facilities:f,facilitiesLoading:j,error:b,fetchFacilities:y}=function(){const[s,a]=i.useState([]),[t,l]=i.useState(!1),[n,c]=i.useState(null);return{facilities:s,facilitiesLoading:t,error:n,fetchFacilities:i.useCallback(()=>e(this,null,function*(){try{l(!0),c(null);const{data:e,error:s}=yield r.from("pet_facilities").select("\n          *,\n          facility_categories (\n            name,\n            name_ja\n          )\n        ").eq("status","approved").order("name");if(s)throw s;const t=(e||[]).map(e=>{var s;return{id:e.id||"",name:e.name||"",description:e.description||"",category:e.category_id||"other",address:e.address||"",latitude:Number(e.latitude)||0,longitude:Number(e.longitude)||0,phone:e.phone||"",website:e.website||"",status:e.status||"pending",created_at:e.created_at||"",category_name:(null==(s=e.facility_categories)?void 0:s.name_ja)||""}});a(t)}catch(e){const s=e instanceof Error?e.message:"施設データの取得に失敗しました";c(s)}finally{l(!1)}}),[]),setError:c,setFacilitiesLoading:l}}();i.useEffect(()=>{(()=>{e(this,null,function*(){"dogparks"===a?yield g():yield y()})})()},[a,g,y]);const N="dogparks"===a?u:b,w=()=>{(()=>{e(this,null,function*(){"dogparks"===a?yield g():yield y()})})()};return("dogparks"===a?h:j)?s.jsx(F,{}):N?s.jsx($,{error:N,onRetry:w}):s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsx(z,{activeView:a,onRefresh:w}),!1,s.jsx("div",{className:"bg-white border-b",children:s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:s.jsxs("div",{className:"flex space-x-4 py-4",children:[s.jsx("button",{onClick:()=>t("dogparks"),className:"px-4 py-2 rounded-lg font-medium "+("dogparks"===a?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900"),children:"ドッグパーク"}),s.jsx("button",{onClick:()=>t("facilities"),className:"px-4 py-2 rounded-lg font-medium "+("facilities"===a?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900"),children:"ペット施設"})]})})}),"facilities"===a&&s.jsx("div",{className:"bg-white border-b",children:s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:s.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(A).map(([e,a])=>s.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded",children:a},e))})})}),s.jsx(R,{activeView:a,parks:p,facilities:f})]})}export{D as DogParkList};

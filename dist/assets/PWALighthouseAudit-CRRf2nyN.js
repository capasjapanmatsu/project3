import{j as e,R as u,aW as R,g as r,e as q,D as E,l as n,b0 as L,h as V,f as B}from"./ui-vendor-FlUr4cJt.js";import{r as h}from"./react-vendor-_GyjDmDn.js";import{B as D,C as c}from"./index-BSYT0262.js";import"./supabase-vendor-Df9iqQzW.js";const _=()=>{const[g,N]=h.useState(null),[y,v]=h.useState([]),[x,j]=h.useState(!1),[p,S]=h.useState("overview"),f=async()=>{j(!0);try{const s=await b();N(s);const t=await $();v(t)}catch(s){console.error("Lighthouse監査エラー:",s)}finally{j(!1)}},b=async()=>{await new Promise(l=>setTimeout(l,2e3));const s=await k(),t=await W(),i=await P(),a=await A(),o=await C();return{performance:s,accessibility:t,bestPractices:i,seo:a,pwa:o}},k=async()=>{if("performance"in window&&performance.timing){const s=performance.timing,t=s.loadEventEnd-s.navigationStart,i=Math.max(0,Math.min(100,100-t/100));return{score:Math.round(i),displayValue:`${t}ms`,description:"ページの読み込み時間とパフォーマンス指標"}}return{score:85,displayValue:"1.2s",description:"ページの読み込み時間とパフォーマンス指標"}},W=async()=>{let s=100,t=[];const i=document.querySelectorAll("img"),a=Array.from(i).filter(d=>!d.alt);a.length>0&&(s-=10,t.push(`${a.length}個の画像にalt属性がありません`)),document.querySelectorAll("h1, h2, h3, h4, h5, h6").length===0&&(s-=15,t.push("見出し要素が見つかりません"));const l=document.querySelectorAll("a"),m=Array.from(l).filter(d=>!d.textContent?.trim());return m.length>0&&(s-=5,t.push(`${m.length}個のリンクにテキストがありません`)),{score:Math.max(0,s),displayValue:`${Math.max(0,s)}%`,description:t.length>0?t.join(", "):"アクセシビリティ要件を満たしています"}},P=async()=>{let s=100,t=[];location.protocol!=="https:"&&location.hostname!=="localhost"&&(s-=20,t.push("HTTPS接続を使用していません")),document.querySelector('meta[http-equiv="Content-Security-Policy"]')||(s-=10,t.push("Content Security Policyが設定されていません"));const a=console.errors||[];return a.length>0&&(s-=15,t.push(`${a.length}個のJavaScriptエラーが発生しています`)),{score:Math.max(0,s),displayValue:`${Math.max(0,s)}%`,description:t.length>0?t.join(", "):"ベストプラクティスに従っています"}},A=async()=>{let s=100,t=[];const i=document.querySelector("title");return(!i||!i.textContent?.trim())&&(s-=20,t.push("titleタグが設定されていません")),document.querySelector('meta[name="description"]')||(s-=15,t.push("meta descriptionが設定されていません")),document.querySelector('meta[name="viewport"]')||(s-=10,t.push("viewportが設定されていません")),document.documentElement.lang||(s-=5,t.push("html要素にlang属性が設定されていません")),{score:Math.max(0,s),displayValue:`${Math.max(0,s)}%`,description:t.length>0?t.join(", "):"SEO要件を満たしています"}},C=async()=>{let s=0,t=[];try{(await fetch("/manifest.json")).ok&&(s+=20,t.push("マニフェストファイル"))}catch{}return"serviceWorker"in navigator&&await navigator.serviceWorker.getRegistration()&&(s+=30,t.push("Service Worker")),"caches"in window&&(await caches.keys()).length>0&&(s+=25,t.push("オフライン対応")),window.matchMedia("(display-mode: standalone)").matches?(s+=25,t.push("インストール可能")):s+=10,{score:s,displayValue:`${t.length}/4 機能`,description:`実装済み: ${t.join(", ")}`}},$=async()=>{const s=[];try{const a=await fetch("/manifest.json");if(a.ok){const o=await a.json();s.push({id:"manifest-exists",name:"Webアプリマニフェスト",description:"manifest.jsonファイルが存在し、適切に設定されている",status:"compliant",score:100,details:"✓ マニフェストファイルが正常に読み込まれました",recommendation:"引き続き適切に管理してください"});const m=["name","short_name","start_url","display","icons"].filter(d=>!o[d]);m.length===0?s.push({id:"manifest-complete",name:"マニフェスト完全性",description:"マニフェストに必要なフィールドがすべて設定されている",status:"compliant",score:100,details:"✓ すべての必須フィールドが設定されています"}):s.push({id:"manifest-incomplete",name:"マニフェスト完全性",description:"マニフェストに必要なフィールドがすべて設定されている",status:"non-compliant",score:60,details:`✗ 不足フィールド: ${m.join(", ")}`,recommendation:"不足しているフィールドを追加してください"})}else s.push({id:"manifest-missing",name:"Webアプリマニフェスト",description:"manifest.jsonファイルが存在し、適切に設定されている",status:"non-compliant",score:0,details:"✗ マニフェストファイルが見つかりません",recommendation:"manifest.jsonファイルを作成してください"})}catch{s.push({id:"manifest-error",name:"Webアプリマニフェスト",description:"manifest.jsonファイルが存在し、適切に設定されている",status:"non-compliant",score:0,details:"✗ マニフェストファイルの読み込みに失敗しました",recommendation:"マニフェストファイルの構文を確認してください"})}if("serviceWorker"in navigator)try{await navigator.serviceWorker.getRegistration()?s.push({id:"service-worker",name:"Service Worker",description:"Service Workerが登録され、オフライン機能を提供している",status:"compliant",score:100,details:"✓ Service Workerが正常に登録されています"}):s.push({id:"service-worker-missing",name:"Service Worker",description:"Service Workerが登録され、オフライン機能を提供している",status:"non-compliant",score:0,details:"✗ Service Workerが登録されていません",recommendation:"Service Workerを実装してください"})}catch{s.push({id:"service-worker-error",name:"Service Worker",description:"Service Workerが登録され、オフライン機能を提供している",status:"non-compliant",score:0,details:"✗ Service Workerの確認中にエラーが発生しました",recommendation:"Service Workerの実装を確認してください"})}else s.push({id:"service-worker-unsupported",name:"Service Worker",description:"Service Workerが登録され、オフライン機能を提供している",status:"non-compliant",score:0,details:"✗ このブラウザはService Workerをサポートしていません",recommendation:"モダンブラウザでアクセスしてください"});const t=location.protocol==="https:"||location.hostname==="localhost";s.push({id:"https",name:"セキュア接続 (HTTPS)",description:"PWAはHTTPS接続で提供されている必要がある",status:t?"compliant":"non-compliant",score:t?100:0,details:t?"✓ セキュアな接続を使用しています":"✗ HTTPSを使用していません",recommendation:t?void 0:"HTTPSでアプリを提供してください"});const i=document.querySelector('meta[name="viewport"]');if(s.push({id:"responsive",name:"レスポンシブデザイン",description:"アプリが複数のデバイスサイズに対応している",status:i?"compliant":"non-compliant",score:i?100:0,details:i?"✓ ビューポートが適切に設定されています":"✗ ビューポートが設定されていません",recommendation:i?void 0:"ビューポートメタタグを追加してください"}),"caches"in window)try{const a=await caches.keys();s.push({id:"offline",name:"オフライン機能",description:"アプリがオフラインでも動作する",status:a.length>0?"compliant":"non-compliant",score:a.length>0?100:0,details:a.length>0?`✓ ${a.length}個のキャッシュが設定されています`:"✗ キャッシュが設定されていません",recommendation:a.length>0?void 0:"キャッシュ戦略を実装してください"})}catch{s.push({id:"offline-error",name:"オフライン機能",description:"アプリがオフラインでも動作する",status:"unknown",score:0,details:"? キャッシュの確認中にエラーが発生しました",recommendation:"キャッシュ機能を確認してください"})}else s.push({id:"offline-unsupported",name:"オフライン機能",description:"アプリがオフラインでも動作する",status:"non-compliant",score:0,details:"✗ このブラウザはCache APIをサポートしていません",recommendation:"モダンブラウザでアクセスしてください"});return s},w=s=>s>=90?"text-green-600":s>=70?"text-yellow-600":"text-red-600",T=s=>s>=90?"bg-green-100":s>=70?"bg-yellow-100":"bg-red-100",M=s=>{switch(s){case"compliant":return e.jsx(r,{className:"h-5 w-5 text-green-500"});case"non-compliant":return e.jsx(B,{className:"h-5 w-5 text-red-500"});case"unknown":return e.jsx(n,{className:"h-5 w-5 text-yellow-500"})}};return h.useEffect(()=>{f()},[]),e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"PWA Lighthouse 監査"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Google Lighthouseスタイルの包括的なPWA監査を実行し、改善点を特定します。"}),e.jsxs(D,{onClick:f,disabled:x,className:"flex items-center gap-2 mx-auto",children:[e.jsx(u,{className:`h-4 w-4 ${x?"animate-spin":""}`}),x?"監査実行中...":"監査を再実行"]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[{key:"overview",label:"概要",icon:e.jsx(R,{className:"h-4 w-4"})},{key:"requirements",label:"PWA要件",icon:e.jsx(r,{className:"h-4 w-4"})},{key:"suggestions",label:"改善提案",icon:e.jsx(q,{className:"h-4 w-4"})}].map(s=>e.jsxs("button",{onClick:()=>S(s.key),className:`flex items-center gap-2 px-4 py-2 rounded-md transition-colors ${p===s.key?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:[s.icon,s.label]},s.key))})}),p==="overview"&&g&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:Object.entries(g).map(([s,t])=>e.jsxs(c,{className:`p-6 text-center ${T(t.score)}`,children:[e.jsx("div",{className:`text-3xl font-bold ${w(t.score)} mb-2`,children:t.score}),e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1 capitalize",children:s==="bestPractices"?"Best Practices":s==="seo"?"SEO":s==="pwa"?"PWA":s}),e.jsx("div",{className:"text-xs text-gray-600",children:t.displayValue})]},s))}),p==="requirements"&&e.jsx("div",{className:"space-y-4",children:y.map(s=>e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[M(s.status),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.name}),s.score!==void 0&&e.jsxs("span",{className:`text-sm font-medium ${w(s.score)}`,children:[s.score,"/100"]})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-3",children:s.description}),e.jsx("p",{className:"text-sm text-gray-700 mb-2",children:s.details}),s.recommendation&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"推奨事項:"})," ",s.recommendation]})})]})]})},s.id))}),p==="suggestions"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(c,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5"}),"インストール最適化"]}),e.jsxs("ul",{className:"space-y-3 text-sm",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(r,{className:"h-4 w-4 text-green-500 mt-0.5"}),e.jsx("span",{children:"カスタムインストールプロンプトを実装"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(r,{className:"h-4 w-4 text-green-500 mt-0.5"}),e.jsx("span",{children:"アプリアイコンを複数サイズで提供"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(n,{className:"h-4 w-4 text-yellow-500 mt-0.5"}),e.jsx("span",{children:"スプラッシュスクリーン画像を追加"})]})]})]}),e.jsxs(c,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5"}),"オフライン機能強化"]}),e.jsxs("ul",{className:"space-y-3 text-sm",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(r,{className:"h-4 w-4 text-green-500 mt-0.5"}),e.jsx("span",{children:"重要なページのプリキャッシュ"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(n,{className:"h-4 w-4 text-yellow-500 mt-0.5"}),e.jsx("span",{children:"オフライン状態の通知機能"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(n,{className:"h-4 w-4 text-yellow-500 mt-0.5"}),e.jsx("span",{children:"データ同期機能の実装"})]})]})]}),e.jsxs(c,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(u,{className:"h-5 w-5"}),"パフォーマンス向上"]}),e.jsxs("ul",{className:"space-y-3 text-sm",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(r,{className:"h-4 w-4 text-green-500 mt-0.5"}),e.jsx("span",{children:"リソースの圧縮とminify"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(n,{className:"h-4 w-4 text-yellow-500 mt-0.5"}),e.jsx("span",{children:"重要でないリソースの遅延読み込み"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(n,{className:"h-4 w-4 text-yellow-500 mt-0.5"}),e.jsx("span",{children:"CDNの活用"})]})]})]}),e.jsxs(c,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5"}),"ユーザー体験向上"]}),e.jsxs("ul",{className:"space-y-3 text-sm",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(n,{className:"h-4 w-4 text-yellow-500 mt-0.5"}),e.jsx("span",{children:"プッシュ通知機能の実装"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(n,{className:"h-4 w-4 text-yellow-500 mt-0.5"}),e.jsx("span",{children:"バックグラウンド同期"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(n,{className:"h-4 w-4 text-yellow-500 mt-0.5"}),e.jsx("span",{children:"アプリ更新通知"})]})]})]})]}),x&&e.jsx(c,{className:"p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(u,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-blue-500"}),e.jsx("p",{className:"text-gray-600",children:"Lighthouse監査を実行中..."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"パフォーマンス、アクセシビリティ、PWA要件などを総合的に分析しています"})]})})]})};export{_ as default};

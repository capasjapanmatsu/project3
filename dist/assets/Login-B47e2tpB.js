import{u as e,c as s,j as a,B as t,d as l,b as r}from"./index-rzoKNnex.js";import{r as i,u as m}from"./vendor-Cwmn0chA.js";import{C as c}from"./Card-CRM3w0N8.js";import{I as n}from"./Input-DdOgOQvG.js";import{M as x,l as d,A as o,m as h,E as u,n as j}from"./ui-CMSAjam7.js";import"./supabase-Dzr8oIt2.js";function b(){const{signInWithMagicLink:b}=e(),[p,f]=i.useState(!1),[N,g]=i.useState(""),[v,y]=i.useState(""),[w,k]=i.useState(""),[L,C]=i.useState(!1),[S,E]=i.useState(!1),M=m();i.useEffect((()=>{const e=s("lastUsedEmail");e&&y(e)}),[]);return a.jsxs("div",{className:"max-w-md mx-auto",children:[a.jsx("h1",{className:"text-2xl font-bold text-center mb-8",children:"ログイン"}),a.jsxs(c,{children:[a.jsxs("div",{className:"flex justify-center mb-4 space-x-2",children:[a.jsx(t,{type:"button",onClick:()=>C(!1),variant:L?"secondary":"primary",children:"Magic Link"}),a.jsx(t,{type:"button",onClick:()=>C(!0),variant:L?"primary":"secondary",children:"パスワード"})]}),L?a.jsxs("form",{onSubmit:async e=>{e.preventDefault(),f(!0),g("");try{l("lastUsedEmail",v);const{data:e,error:s}=await r.auth.signInWithPassword({email:v,password:w});if(s)throw new Error(s.message);const{data:a}=await r.auth.mfa.getAuthenticatorAssuranceLevel();if("aal2"===(null==a?void 0:a.nextLevel)&&(null==a?void 0:a.nextLevel)!==(null==a?void 0:a.currentLevel))return void M("/two-factor-verify");M("/dashboard")}catch(s){g(s.message||"ログインに失敗しました")}finally{f(!1)}},className:"p-6",children:[a.jsxs("div",{className:"text-center mb-6",children:[a.jsx(h,{className:"w-12 h-12 text-blue-600 mx-auto mb-4"}),a.jsx("h2",{className:"text-xl font-semibold mb-2",children:"パスワードでログイン"}),a.jsx("p",{className:"text-gray-600",children:"メールアドレスとパスワードを入力してください。"})]}),N&&a.jsxs("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded-lg flex items-start",children:[a.jsx(d,{className:"w-5 h-5 mr-2 flex-shrink-0 mt-0.5"}),a.jsx("p",{children:N})]}),a.jsx(n,{label:"メールアドレス",type:"email",value:v,onChange:e=>y(e.target.value),required:!0,icon:a.jsx(x,{className:"w-4 h-4 text-gray-500"}),placeholder:"example@email.com"}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"パスワード *"}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:S?"text":"password",value:w,onChange:e=>k(e.target.value),required:!0,className:"w-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"パスワード"}),a.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:a.jsx(h,{className:"h-4 w-4 text-gray-500"})}),a.jsx("button",{type:"button",onClick:()=>E(!S),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700",children:S?a.jsx(u,{className:"h-4 w-4"}):a.jsx(j,{className:"h-4 w-4"})})]})]}),a.jsxs(t,{type:"submit",isLoading:p,className:"w-full mt-4 bg-blue-600 hover:bg-blue-700",children:[a.jsx(h,{className:"w-4 h-4 mr-2"}),"ログイン",a.jsx(o,{className:"w-4 h-4 ml-2"})]}),a.jsx("div",{className:"mt-4 text-center",children:a.jsx("a",{href:"/forgot-password",className:"text-blue-600 hover:text-blue-700 font-medium text-sm",children:"パスワードをお忘れですか？"})})]}):a.jsxs("form",{onSubmit:async e=>{e.preventDefault(),f(!0),g("");try{l("lastUsedEmail",v);const{error:e}=await b(v);if(e)throw new Error(e);alert("ログインリンクを送信しました。メールをご確認ください。")}catch(s){g(s.message||"ログインリンクの送信に失敗しました。メールアドレスを確認してください。")}finally{f(!1)}},className:"p-6",children:[a.jsxs("div",{className:"text-center mb-6",children:[a.jsx(x,{className:"w-12 h-12 text-blue-600 mx-auto mb-4"}),a.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Magic Linkでログイン"}),a.jsx("p",{className:"text-gray-600",children:"メールアドレスを入力するだけで、ドッグパークJPにログインできます。"})]}),N&&a.jsxs("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded-lg flex items-start",children:[a.jsx(d,{className:"w-5 h-5 mr-2 flex-shrink-0 mt-0.5"}),a.jsx("p",{children:N})]}),a.jsx(n,{label:"メールアドレス",type:"email",value:v,onChange:e=>y(e.target.value),required:!0,icon:a.jsx(x,{className:"w-4 h-4 text-gray-500"}),placeholder:"example@email.com"}),a.jsxs(t,{type:"submit",isLoading:p,className:"w-full mt-4 bg-blue-600 hover:bg-blue-700",children:[a.jsx(x,{className:"w-4 h-4 mr-2"}),"ログインリンクを送信",a.jsx(o,{className:"w-4 h-4 ml-2"})]}),a.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(x,{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),a.jsxs("div",{className:"text-sm text-blue-800",children:[a.jsx("p",{className:"font-medium mb-1",children:"Magic Linkとは？"}),a.jsx("p",{children:"パスワードを覚える必要がなく、メールに送信されたリンクをクリックするだけで安全にログインできる便利な認証方法です。"}),a.jsxs("ul",{className:"mt-2 space-y-1",children:[a.jsx("li",{children:"• パスワードを忘れる心配なし"}),a.jsx("li",{children:"• より安全なログイン体験"}),a.jsx("li",{children:"• ワンクリックでログイン完了"})]})]})]})}),a.jsx("div",{className:"mt-4 text-center",children:a.jsxs("p",{className:"text-sm text-gray-600",children:["アカウントをお持ちでない方は"," ",a.jsx("a",{href:"/register",className:"text-blue-600 hover:text-blue-700 font-medium",children:"こちらから新規登録"})]})})]})]})]})}export{b as Login};

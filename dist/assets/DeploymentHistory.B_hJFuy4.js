import{j as e,L as s,A as t,ae as r,a7 as a,G as l,x as c,f as n}from"./ui-vendor.5lywbznV.js";import{r as i,L as d}from"./react-vendor.C7ykWfwV.js";import{l as x,B as m,C as u}from"./admin-pages.BuCPNRRu.js";import{g as o}from"./deploymentStatus.CgY5_N0o.js";import{a as p,s as h}from"./index.Cy6Rp-9S.js";import"./supabase-vendor.CX-WoPCS.js";import"./park-pages.DqtvJl8J.js";import"./stripe-vendor.CcgPsVUa.js";function j({id:a,onStatusChange:l,className:c=""}){const[n,d]=i.useState(null),[u,p]=i.useState(!1),[h,j]=i.useState(null),f=i.useCallback(async()=>{if(a)try{p(!0),j(null);const e=await o({id:a});d(e),l&&l(e)}catch(e){x("error","Error checking deployment status:",{error:e}),j(e.message||"デプロイステータスの取得に失敗しました")}finally{p(!1)}},[a,l]);i.useEffect(()=>{a&&f()},[a,f]);return u?e.jsxs("div",{className:`flex items-center space-x-2 ${c}`,children:[e.jsx(s,{className:"w-4 h-4 text-blue-600 animate-spin"}),e.jsx("span",{className:"text-sm text-gray-600",children:"ステータスを確認中..."})]}):h?e.jsxs("div",{className:`flex items-center space-x-2 ${c}`,children:[e.jsx(t,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"text-sm text-red-600",children:h}),e.jsx(m,{size:"sm",variant:"secondary",onClick:()=>{f()},children:"再試行"})]}):n?e.jsxs("div",{className:`space-y-2 ${c}`,children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"ステータス:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${(e=>{switch(e){case"ready":return"text-green-600 bg-green-100";case"error":case"failed":return"text-red-600 bg-red-100";case"building":case"enqueued":case"processing":return"text-blue-600 bg-blue-100";default:return"text-gray-600 bg-gray-100"}})(n.status||"")}`,children:(e=>{switch(e){case"ready":return"完了";case"error":case"failed":return"失敗";case"building":return"ビルド中";case"enqueued":return"待機中";case"processing":return"処理中";default:return e}})(n.status||"")})]}),n.deploy_url&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"URL:"}),e.jsxs("a",{href:n.deploy_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-800 flex items-center",children:[n.deploy_url.replace(/^https?:\/\//,""),e.jsx(r,{className:"w-3 h-3 ml-1"})]})]}),e.jsx(m,{size:"sm",variant:"secondary",onClick:()=>{f()},children:"更新"})]}):e.jsx("div",{className:`flex items-center space-x-2 ${c}`,children:e.jsx(m,{size:"sm",onClick:()=>{f()},children:"ステータスを確認"})})}function f(){const[s,x]=i.useState([]),[o,f]=i.useState(!0);i.useEffect(()=>{(()=>{try{const e=p("deploymentHistory");e&&x(JSON.parse(e))}catch(e){}finally{f(!1)}})()},[]);const y=e=>{switch(e){case"ready":return"text-green-600 bg-green-100";case"error":case"failed":return"text-red-600 bg-red-100";case"building":case"enqueued":case"processing":return"text-blue-600 bg-blue-100";default:return"text-gray-600 bg-gray-100"}},b=e=>{switch(e){case"ready":return"完了";case"error":case"failed":return"失敗";case"building":return"ビルド中";case"enqueued":return"待機中";case"processing":return"処理中";default:return e}};return o?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center space-x-4 mb-6",children:e.jsxs(d,{to:"/deploy",className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[e.jsx(a,{className:"w-4 h-4 mr-2"}),"デプロイページに戻る"]})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-4 flex items-center justify-center",children:[e.jsx(l,{className:"w-8 h-8 text-blue-600 mr-3"}),"デプロイ履歴"]}),e.jsx("p",{className:"text-lg text-gray-600",children:"過去のデプロイ履歴を確認できます"})]}),error&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 rounded-lg flex items-start",children:[e.jsx(t,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsx("p",{className:"text-red-800",children:error})]}),0===s.length?e.jsxs(u,{className:"p-6 text-center",children:[e.jsx(c,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-700 mb-2",children:"デプロイ履歴がありません"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"まだデプロイを行っていないようです"}),e.jsx(d,{to:"/deploy",children:e.jsxs(m,{children:[e.jsx(l,{className:"w-4 h-4 mr-2"}),"デプロイを開始する"]})})]}):e.jsx("div",{className:"space-y-4",children:s.map(t=>e.jsx(u,{className:"p-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${y(t.status)}`,children:b(t.status)}),e.jsx("span",{className:"text-sm text-gray-500",children:new Date(t.created_at).toLocaleString("ja-JP")})]}),e.jsxs("h3",{className:"font-semibold mb-2",children:["デプロイID: ",t.id]}),t.deploy_url&&e.jsxs("a",{href:t.deploy_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-800 flex items-center",children:[t.deploy_url.replace(/^https?:\/\//,""),e.jsx(r,{className:"w-3 h-3 ml-1"})]})]}),e.jsx(j,{id:t.id,onStatusChange:e=>{return r=t.id,a=e,x(e=>e.map(e=>e.id===r?{...e,status:a.status||e.status,deploy_url:a.deploy_url||e.deploy_url}:e)),void h("deploymentHistory",JSON.stringify(s.map(e=>e.id===r?{...e,status:a.status||e.status,deploy_url:a.deploy_url||e.deploy_url}:e)));var r,a}})]})},t.id))}),e.jsx(u,{className:"p-6 bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(n,{className:"w-6 h-6 text-blue-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"デプロイ履歴について"}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("p",{children:"• デプロイ履歴はブラウザのローカルストレージに保存されます"}),e.jsx("p",{children:"• 別のブラウザやデバイスでは履歴が共有されません"}),e.jsx("p",{children:"• 各デプロイの最新ステータスを確認できます"}),e.jsx("p",{children:"• 「更新」ボタンをクリックすると最新の状態を取得します"})]})]})]})})]})}export{f as DeploymentHistory};

import{j as e,V as I,ah as L,A as G,g as H,p as J,aD as g,z as O,D as U,i as W,C as K,F as Q}from"./ui-vendor-FlUr4cJt.js";import{u as X,r as n,L as Y}from"./react-vendor-_GyjDmDn.js";import{u as Z,s as m,C as i,B as d}from"./index-BSYT0262.js";import"./supabase-vendor-Df9iqQzW.js";function ne(){const{user:o}=Z(),f=X(),[E,y]=n.useState(!0),[N,h]=n.useState(""),[_,u]=n.useState(""),[w,B]=n.useState([]),[r,D]=n.useState(null),[v,x]=n.useState(!1),[q,k]=n.useState(!1),[s,l]=n.useState({bank_name:"",bank_code:"",branch_name:"",branch_code:"",account_type:"ordinary",account_number:"",account_holder_name:""}),[S,A]=n.useState(0),[F,P]=n.useState(0);n.useEffect(()=>{if(!o){f("/login");return}C()},[o,f]);const C=async()=>{try{y(!0);const{data:t,error:a}=await m.from("monthly_payouts").select("*").order("year",{ascending:!1}).order("month",{ascending:!1});if(a)throw a;B(t||[]);const M=(t||[]).reduce((b,j)=>b+j.total_revenue,0),V=(t||[]).reduce((b,j)=>b+j.owner_payout,0);A(M),P(V);const{data:c,error:p}=await m.from("owner_bank_accounts").select("*").eq("owner_id",o?.id).maybeSingle();if(p&&p.code!=="PGRST116")throw p;D(c),c&&l({id:c.id,bank_name:c.bank_name,bank_code:c.bank_code,branch_name:c.branch_name,branch_code:c.branch_code,account_type:c.account_type,account_number:c.account_number,account_holder_name:c.account_holder_name})}catch(t){console.error("Error fetching data:",t),h(t.message||"データの取得に失敗しました")}finally{y(!1)}},T=async t=>{t.preventDefault(),k(!0),h(""),u("");try{if(!s.bank_name)throw new Error("銀行名を入力してください");if(!s.bank_code)throw new Error("銀行コードを入力してください");if(!s.branch_name)throw new Error("支店名を入力してください");if(!s.branch_code)throw new Error("支店コードを入力してください");if(!s.account_number)throw new Error("口座番号を入力してください");if(!s.account_holder_name)throw new Error("口座名義を入力してください");if(!/^\d{4}$/.test(s.bank_code))throw new Error("銀行コードは4桁の数字で入力してください");if(!/^\d{3}$/.test(s.branch_code))throw new Error("支店コードは3桁の数字で入力してください");if(!/^\d{7}$/.test(s.account_number))throw new Error("口座番号は7桁の数字で入力してください");if(r){const{error:a}=await m.from("owner_bank_accounts").update({bank_name:s.bank_name,bank_code:s.bank_code,branch_name:s.branch_name,branch_code:s.branch_code,account_type:s.account_type,account_number:s.account_number,account_holder_name:s.account_holder_name}).eq("id",r.id);if(a)throw a}else{const{error:a}=await m.from("owner_bank_accounts").insert({owner_id:o?.id,bank_name:s.bank_name,bank_code:s.bank_code,branch_name:s.branch_name,branch_code:s.branch_code,account_type:s.account_type,account_number:s.account_number,account_holder_name:s.account_holder_name});if(a)throw a}u("振込先情報を保存しました"),x(!1),await C(),setTimeout(()=>{u("")},3e3)}catch(a){console.error("Error saving bank account:",a),h(a.message||"振込先情報の保存に失敗しました")}finally{k(!1)}},R=t=>["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"][t-1],z=t=>({pending:"振込予定",processing:"振込処理中",completed:"振込完了"})[t]||t,$=t=>({pending:"bg-yellow-100 text-yellow-800",processing:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800"})[t]||"bg-gray-100 text-gray-800";return E?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center space-x-4 mb-6",children:e.jsxs(Y,{to:"/owner-dashboard",className:"flex items-center text-blue-600 hover:text-blue-800",children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"オーナーダッシュボードに戻る"]})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-4 flex items-center justify-center",children:[e.jsx(L,{className:"w-8 h-8 text-green-600 mr-3"}),"収益管理システム"]}),e.jsx("p",{className:"text-lg text-gray-600",children:"ドッグラン施設の収益と振込情報を管理します"})]}),N&&e.jsxs("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4 flex items-start",children:[e.jsx(G,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsx("p",{children:N})]}),_&&e.jsxs("div",{className:"bg-green-100 border border-green-300 text-green-800 rounded-lg p-4 flex items-start",children:[e.jsx(H,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsx("p",{children:_})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"総売上"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["¥",S.toLocaleString()]})]}),e.jsx(L,{className:"w-8 h-8 text-green-600"})]})}),e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"プラットフォーム手数料"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["¥",(S*.2).toLocaleString()]}),e.jsx("p",{className:"text-xs text-blue-600",children:"売上の20%"})]}),e.jsx(J,{className:"w-8 h-8 text-blue-600"})]})}),e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"オーナー取り分"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:["¥",F.toLocaleString()]}),e.jsx("p",{className:"text-xs text-purple-600",children:"売上の80%"})]}),e.jsx(g,{className:"w-8 h-8 text-purple-600"})]})})]}),e.jsxs(i,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[e.jsx(g,{className:"w-6 h-6 text-blue-600 mr-2"}),"振込先情報"]}),r&&!v?e.jsxs(d,{onClick:()=>x(!0),size:"sm",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"編集する"]}):null]}),v?e.jsxs("form",{onSubmit:T,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"銀行名 *"}),e.jsx("input",{type:"text",value:s.bank_name,onChange:t=>l({...s,bank_name:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例：三菱UFJ銀行",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"銀行コード（4桁） *"}),e.jsx("input",{type:"text",value:s.bank_code,onChange:t=>{const a=t.target.value.replace(/\D/g,"");l({...s,bank_code:a})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例：0005",maxLength:4,required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"4桁の数字で入力してください"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"支店名 *"}),e.jsx("input",{type:"text",value:s.branch_name,onChange:t=>l({...s,branch_name:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例：渋谷支店",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"支店コード（3桁） *"}),e.jsx("input",{type:"text",value:s.branch_code,onChange:t=>{const a=t.target.value.replace(/\D/g,"");l({...s,branch_code:a})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例：135",maxLength:3,required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"3桁の数字で入力してください"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"口座種別 *"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",checked:s.account_type==="ordinary",onChange:()=>l({...s,account_type:"ordinary"}),className:"form-radio text-blue-600"}),e.jsx("span",{children:"普通"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",checked:s.account_type==="checking",onChange:()=>l({...s,account_type:"checking"}),className:"form-radio text-blue-600"}),e.jsx("span",{children:"当座"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"口座番号（7桁） *"}),e.jsx("input",{type:"text",value:s.account_number,onChange:t=>{const a=t.target.value.replace(/\D/g,"");l({...s,account_number:a})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例：1234567",maxLength:7,required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"7桁の数字で入力してください"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"口座名義（カタカナ） *"}),e.jsx("input",{type:"text",value:s.account_holder_name,onChange:t=>l({...s,account_holder_name:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例：ヤマダ タロウ",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"カタカナで入力してください（姓と名の間にスペース）"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[r&&e.jsx(d,{type:"button",variant:"secondary",onClick:()=>x(!1),children:"キャンセル"}),e.jsx(d,{type:"submit",isLoading:q,children:"保存する"})]})]}):r?e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"銀行名"}),e.jsx("p",{className:"font-medium",children:r.bank_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"銀行コード"}),e.jsx("p",{className:"font-medium",children:r.bank_code})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"支店名"}),e.jsx("p",{className:"font-medium",children:r.branch_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"支店コード"}),e.jsx("p",{className:"font-medium",children:r.branch_code})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"口座種別"}),e.jsx("p",{className:"font-medium",children:r.account_type==="ordinary"?"普通":"当座"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"口座番号"}),e.jsx("p",{className:"font-medium",children:r.account_number})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"口座名義"}),e.jsx("p",{className:"font-medium",children:r.account_holder_name})]})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(g,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"振込先情報が登録されていません"}),e.jsx(d,{onClick:()=>x(!0),children:"振込先情報を登録する"})]})]}),e.jsxs(i,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[e.jsx(O,{className:"w-6 h-6 text-blue-600 mr-2"}),"月別収益"]}),e.jsxs(d,{variant:"secondary",size:"sm",onClick:()=>{alert("CSVダウンロード機能は準備中です")},children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"CSV出力"]})]}),w.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(W,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"まだ収益データがありません"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"ドッグランの利用があると、ここに収益データが表示されます"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"年月"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"施設名"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"売上合計"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"手数料（20%）"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"振込金額（80%）"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ステータス"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:w.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:[t.year,"年",R(t.month)]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.park_name}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["¥",t.total_revenue.toLocaleString()]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:["¥",t.platform_fee.toLocaleString()]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-green-600",children:["¥",t.owner_payout.toLocaleString()]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("span",{className:`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${$(t.status)}`,children:z(t.status)})})]},t.id))})]})})]}),e.jsx(i,{className:"p-6 bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(K,{className:"w-6 h-6 text-blue-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"振込スケジュール"}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("p",{children:"• 振込は毎月15日に前月分を一括で行います"}),e.jsx("p",{children:"• 振込手数料は当社負担です"}),e.jsx("p",{children:"• 振込金額が5,000円未満の場合は翌月に繰り越されます"}),e.jsx("p",{children:"• 振込完了後、メールでお知らせします"}),e.jsx("p",{children:"• 振込先情報に変更がある場合は、前月末日までに更新してください"})]})]})]})}),e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Q,{className:"w-6 h-6 text-gray-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"収益システムについて"}),e.jsxs("div",{className:"text-sm text-gray-700 space-y-1",children:[e.jsxs("p",{children:["• 売上の",e.jsx("span",{className:"font-medium",children:"80%"}),"がオーナー様に支払われます"]}),e.jsxs("p",{children:["• 残りの",e.jsx("span",{className:"font-medium",children:"20%"}),"は当社の手数料となります"]}),e.jsx("p",{children:"• 手数料には、決済手数料、システム利用料、保険料などが含まれます"}),e.jsx("p",{children:"• 収益は以下の項目から発生します："}),e.jsxs("ul",{className:"list-disc pl-5 space-y-1 mt-1",children:[e.jsx("li",{children:"通常利用（1日券）：800円/日"}),e.jsx("li",{children:"施設貸し切り：4,400円/時間"}),e.jsx("li",{children:"プライベートブース：サブスク使い放題・1日券でも利用可能（追加料金なし）"})]}),e.jsx("p",{children:"• サブスクリプション収益は利用回数に応じて分配されます"})]})]})]})})]})}function ee({className:o}){return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:o,children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}export{ne as OwnerPaymentSystem};

import{j as e,X as q,V as J,aJ as B,g as V,p as K,a as le,d as ee,A as W,c as se,F as re,b as Q,t as ce,a0 as de,aK as Y,R as ae,aL as te}from"./ui-vendor-FlUr4cJt.js";import{r as v,u as me,L as xe}from"./react-vendor-_GyjDmDn.js";import{s as g,C as E,B as h,x as H,l as $,y as X,u as ge}from"./index-BSYT0262.js";import{u as he,a as ue}from"./useAdminData-BwucJWVJ.js";import"./supabase-vendor-Df9iqQzW.js";const ne=()=>{const[p,x]=v.useState(!1),_=async(m,o,l)=>{try{x(!0),console.log("Processing vaccine approval:",{vaccineId:m,approved:o});const{data:t,error:i}=await g.from("vaccine_certifications").select("*, dog:dogs(name, owner_id)").eq("id",m).single();if(i)throw console.error("Vaccine data fetch error:",i),i;const f=t,u={status:o?"approved":"rejected"};o&&(u.approved_at=new Date().toISOString()),console.log("Updating vaccine with data:",u);const{error:S}=await g.from("vaccine_certifications").update(u).eq("id",m);if(S)throw console.error("Vaccine update error:",S),console.error("Error details:",{message:S.message,code:S.code,details:S.details,hint:S.hint}),new Error(`ワクチン証明書の更新に失敗しました: ${S.message}`);const z=f.rabies_vaccine_image,O=f.combo_vaccine_image;return(z?.includes("/temp/")||O?.includes("/temp/"))&&await C(f),await b(f,o,l),{success:!0,message:`ワクチン証明書を${o?"承認":"却下"}しました`}}catch(t){return console.error("Vaccine approval error:",t),{success:!1,message:`承認処理に失敗しました: ${t.message}`}}finally{x(!1)}},n=async(m,o,l)=>{try{x(!0);const i={status:o?"approved":"rejected"};o&&(i.approved_at=new Date().toISOString());const{error:f}=await g.from("dog_parks").update(i).eq("id",m);if(f)throw f;return await y(m,o,l),await D(m,o,l),{success:!0,message:`施設を${o?"承認":"却下"}しました`}}catch(t){return console.error("Park approval error:",t),{success:!1,message:"承認処理に失敗しました"}}finally{x(!1)}},a=async(m,o,l)=>{try{x(!0);const t={is_approved:o};!o&&l?.trim()?t.admin_notes=l.trim():t.admin_notes=null;const{error:i}=await g.from("dog_park_facility_images").update(t).eq("id",m.id);if(i)throw i;return{success:!0,message:`画像を${o?"承認":"却下"}しました`}}catch(t){return console.error("Image approval error:",t),{success:!1,message:"画像の承認処理に失敗しました"}}finally{x(!1)}},k=async(m,o,l)=>{try{x(!0);const t={};o!==void 0&&(t.rabies_expiry_date=o),l!==void 0&&(t.combo_expiry_date=l),console.log("Updating vaccine expiry dates:",t);const{error:i}=await g.from("vaccine_certifications").update(t).eq("id",m);if(i)throw console.error("Vaccine expiry update error:",i),new Error(`有効期限の更新に失敗しました: ${i.message}`);return{success:!0,message:"有効期限を更新しました"}}catch(t){return console.error("Vaccine expiry update error:",t),{success:!1,message:`有効期限の更新に失敗しました: ${t.message}`}}finally{x(!1)}},C=async m=>{console.log("Deleting temporary vaccine images..."),console.log("Vaccine data:",{rabies_vaccine_image:m.rabies_vaccine_image,combo_vaccine_image:m.combo_vaccine_image});const o=[];if(m.rabies_vaccine_image){let l="";if(m.rabies_vaccine_image.includes("/temp/")){const t=m.rabies_vaccine_image.match(/temp\/[^\/]+\/[^\/\?]+/);t&&(l=t[0])}l&&o.push(l)}if(m.combo_vaccine_image){let l="";if(m.combo_vaccine_image.includes("/temp/")){const t=m.combo_vaccine_image.match(/temp\/[^\/]+\/[^\/\?]+/);t&&(l=t[0])}l&&o.push(l)}if(console.log("Paths to delete:",o),o.length>0)try{const{error:l}=await g.storage.from("vaccine-certs").remove(o);l?console.error("Error deleting images:",l):console.log("Successfully deleted images:",o)}catch(l){console.error("Error deleting images:",l)}else console.log("No temporary images to delete");console.log("Temporary images deletion completed")},b=async(m,o,l)=>{const{error:t}=await g.from("notifications").insert([{user_id:m.dog.owner_id,type:"vaccine_approval_required",title:o?"ワクチン証明書承認のお知らせ":"ワクチン証明書却下のお知らせ",message:o?`${m.dog.name}ちゃんのワクチン証明書が承認されました。ドッグランを利用できるようになりました。`:`${m.dog.name}ちゃんのワクチン証明書が却下されました。${l?`理由: ${l}`:"詳細はマイページをご確認ください。"}`,data:{dog_id:m.dog_id}}]);if(t)throw console.error("Notification error:",t),console.error("Notification error details:",{message:t.message,code:t.code,details:t.details,hint:t.hint}),new Error(`通知の作成に失敗しました: ${t.message}`)},y=async(m,o,l)=>{let t={};const{data:i,error:f}=await g.from("dog_park_review_stages").select("id").eq("park_id",m).maybeSingle();if(f)throw f;if(i){o?t.first_stage_passed_at=new Date().toISOString():(t.rejected_at=new Date().toISOString(),l?.trim()&&(t.rejection_reason=l.trim()));const{error:u}=await g.from("dog_park_review_stages").update(t).eq("park_id",m);if(u)throw u}else{t={park_id:m,first_stage_passed_at:new Date().toISOString()},o?t.first_stage_passed_at=new Date().toISOString():(t.rejected_at=new Date().toISOString(),l?.trim()&&(t.rejection_reason=l.trim()));const{error:u}=await g.from("dog_park_review_stages").insert([t]);if(u)throw u}},D=async(m,o,l)=>{const{data:t,error:i}=await g.from("dog_parks").select("id, name, owner_id").eq("id",m).single();if(i)throw i;const{error:f}=await g.from("notifications").insert([{user_id:t.owner_id,type:"park_approval_required",title:o?"施設承認のお知らせ":"審査結果のお知らせ",message:o?`${t.name}の審査が完了し、承認されました。おめでとうございます！`:`${t.name}の審査結果をお知らせします。${l?`理由: ${l}`:"詳細はオーナーダッシュボードをご確認ください。"}`,data:{park_id:t.id}}]);if(f)throw console.error("Park notification error:",f),console.error("Park notification error details:",{message:f.message,code:f.code,details:f.details,hint:f.hint}),new Error(`施設通知の作成に失敗しました: ${f.message}`)};return{isProcessing:p,handleVaccineApproval:_,handleParkApproval:n,handleImageApproval:a,handleVaccineExpiryUpdate:k}},pe=({pendingParks:p,isLoading:x,onApprovalComplete:_,onError:n})=>{console.log("🔍 AdminParkApproval received parks:",p),p.forEach((r,d)=>{console.log(`🏞️ Park ${d+1}:`,{id:r.id,name:r.name,owner_id:r.owner_id,owner_name:r.owner_name,owner_address:r.owner_address,owner_postal_code:r.owner_postal_code,owner_phone_number:r.owner_phone_number,owner_email:r.owner_email})});const[a,k]=v.useState(null),[C,b]=v.useState(""),[y,D]=v.useState(null),[m,o]=v.useState(!1),[l,t]=v.useState(null),[i,f]=v.useState(null),[u,S]=v.useState(null),[z,O]=v.useState(!1),P=ne(),I=he(a?.id||null);v.useEffect(()=>{(async()=>{console.log("🔍 Debugging owner_verifications table...");try{const{data:d,error:s}=await g.from("owner_verifications").select("*").order("created_at",{ascending:!1});if(s)console.error("❌ Error fetching owner_verifications:",s);else{console.log("✅ Owner verifications data:",d);const A=d?.filter(j=>j.verification_id&&j.verification_id.includes("identity_"));console.log("📄 Identity files found:",A),d?.forEach(j=>{console.log(`🔍 Verification item ${j.id}:`,{user_id:j.user_id,verification_id:j.verification_id,status:j.status,verification_data:j.verification_data})})}}catch(d){console.error("❌ Debug query failed:",d)}})()},[]),v.useEffect(()=>{a?.owner_id&&R(a.owner_id)},[a]);const R=async r=>{try{O(!0),S(null),console.log("🔍 本人確認書類データを取得中:",r);const{data:d,error:s}=await g.from("profiles").select("name, postal_code, address, phone_number, email").eq("id",r).single();if(s){console.error("❌ プロフィール取得エラー:",s),S(`プロフィール情報の取得に失敗しました: ${s.message}`);return}console.log("✅ プロフィール情報:",d);const{data:A,error:j}=await g.from("owner_verifications").select("*").eq("user_id",r).order("created_at",{ascending:!1}).limit(1);if(j&&(console.error("❌ 本人確認書類取得エラー:",j),console.log("⚠️ 本人確認書類がないため、プロフィール情報のみ表示")),console.log("📊 本人確認書類データ:",A),A&&A.length>0){const N=A[0];console.log("📋 本人確認書類詳細:",N),console.log("🔍 verification_data:",N.verification_data);let L="",c="";N.verification_data&&typeof N.verification_data=="object"&&(L=N.verification_data.document_url||N.verification_data.file_path||"",c=N.verification_data.file_name||N.verification_data.filename||""),!L&&N.verification_id&&(L=N.verification_id),c||(c=L.split("/").pop()||"identity_document"),console.log("📄 最終的な画像URL:",L),console.log("📄 ファイル名:",c),f({id:N.id,owner_name:d.name||"名前未登録",postal_code:d.postal_code||"未登録",address:d.address||"未登録",phone_number:d.phone_number||"未登録",email:d.email||"未登録",identity_document_url:L,identity_document_filename:c,identity_status:N.status||"pending",identity_created_at:N.created_at||new Date().toISOString()})}else console.log("📋 本人確認書類未提出のため、プロフィール情報のみ表示"),f({id:"",owner_name:d.name||"名前未登録",postal_code:d.postal_code||"未登録",address:d.address||"未登録",phone_number:d.phone_number||"未登録",email:d.email||"未登録",identity_document_url:"",identity_document_filename:"",identity_status:"not_submitted",identity_created_at:""})}catch(d){console.error("❌ 本人確認書類データ取得エラー:",d),S(`データの取得に失敗しました: ${d}`)}finally{O(!1)}},F=async(r,d)=>{try{if(console.log(`${d?"✅":"❌"} ドッグラン${d?"承認":"却下"}中:`,r),d&&I.parkImages.filter(j=>j.is_approved===null||j.is_approved===!1).length>0){n("すべての画像を承認してから施設を承認してください");return}const s=await P.handleParkApproval(r,d,C);s.success?(_(s.message),k(null),b("")):n(s.message)}catch(s){console.error("❌ ドッグラン承認/却下エラー:",s),n(`処理中にエラーが発生しました: ${s.message}`)}},G=r=>{D(r),o(!0),b(r.admin_notes||"")},M=async r=>{if(y)try{const d=await P.handleImageApproval(y,r,C);d.success?(_(d.message),await I.fetchParkImages(a.id),o(!1),D(null),b("")):n(d.message)}catch(d){console.error("❌ 画像承認エラー:",d),n(`処理中にエラーが発生しました: ${d.message}`)}},Z=async r=>{if(window.confirm("このドッグラン申請を削除してもよろしいですか？この操作は取り消せません。"))try{console.log("🗑️ 関連レコードを削除中...");try{const{error:s}=await g.from("news_announcements").delete().eq("park_id",r);if(s){console.error("❌ ニュース削除エラー:",s),n(`ニュースの削除に失敗しました: ${s.message}`);return}console.log("✅ ニュース削除完了")}catch(s){console.error("❌ ニュース削除処理エラー:",s),n("ニュース削除処理でエラーが発生しました。");return}try{const{error:s}=await g.from("new_park_openings").delete().eq("park_id",r);if(s){console.error("❌ 新規開園情報削除エラー:",s),n(`新規開園情報の削除に失敗しました: ${s.message}`);return}console.log("✅ 新規開園情報削除完了")}catch(s){console.error("❌ 新規開園情報削除処理エラー:",s),n("新規開園情報削除処理でエラーが発生しました。");return}try{const{data:s}=await g.from("smart_locks").select("lock_id").eq("park_id",r);if(s&&s.length>0){const A=s.map(N=>N.lock_id),{error:j}=await g.from("lock_access_logs").delete().in("lock_id",A);if(j){console.error("❌ ロックアクセスログ削除エラー:",j),n(`ロックアクセスログの削除に失敗しました: ${j.message}`);return}}console.log("✅ ロックアクセスログ削除完了")}catch(s){console.error("❌ ロックアクセスログ削除処理エラー:",s),n("ロックアクセスログ削除処理でエラーが発生しました。");return}try{const{error:s}=await g.from("smart_locks").delete().eq("park_id",r);if(s){console.error("❌ スマートロック削除エラー:",s),n(`スマートロックの削除に失敗しました: ${s.message}`);return}console.log("✅ スマートロック削除完了")}catch(s){console.error("❌ スマートロック削除処理エラー:",s),n("スマートロック削除処理でエラーが発生しました。");return}try{const{error:s}=await g.from("user_entry_status").delete().eq("park_id",r);if(s){console.error("❌ エントリーステータス削除エラー:",s),n(`エントリーステータスの削除に失敗しました: ${s.message}`);return}console.log("✅ エントリーステータス削除完了")}catch(s){console.error("❌ エントリーステータス削除処理エラー:",s),n("エントリーステータス削除処理でエラーが発生しました。");return}try{const{error:s}=await g.from("reservations").delete().eq("park_id",r);if(s){console.error("❌ 予約削除エラー:",s),n(`予約の削除に失敗しました: ${s.message}`);return}console.log("✅ 予約削除完了")}catch(s){console.error("❌ 予約削除処理エラー:",s),n("予約削除処理でエラーが発生しました。");return}try{const{error:s}=await g.from("dog_encounters").delete().eq("park_id",r);if(s){console.error("❌ 出会い記録削除エラー:",s),n(`出会い記録の削除に失敗しました: ${s.message}`);return}console.log("✅ 出会い記録削除完了")}catch(s){console.error("❌ 出会い記録削除処理エラー:",s),n("出会い記録削除処理でエラーが発生しました。");return}try{const{data:s}=await g.from("dog_park_reviews").select("id").eq("park_id",r);if(s&&s.length>0){const A=s.map(N=>N.id),{error:j}=await g.from("dog_park_review_images").delete().in("review_id",A);if(j){console.error("❌ レビュー画像削除エラー:",j),n(`レビュー画像の削除に失敗しました: ${j.message}`);return}}console.log("✅ レビュー画像削除完了")}catch(s){console.error("❌ レビュー画像削除処理エラー:",s),n("レビュー画像削除処理でエラーが発生しました。");return}try{const{error:s}=await g.from("dog_park_reviews").delete().eq("park_id",r);if(s){console.error("❌ レビュー削除エラー:",s),n(`レビューの削除に失敗しました: ${s.message}`);return}console.log("✅ レビュー削除完了")}catch(s){console.error("❌ レビュー削除処理エラー:",s),n("レビュー削除処理でエラーが発生しました。");return}try{const{error:s}=await g.from("dog_park_facility_images").delete().eq("park_id",r);if(s){console.error("❌ 施設画像削除エラー:",s),n(`施設画像の削除に失敗しました: ${s.message}`);return}console.log("✅ 施設画像削除完了")}catch(s){console.error("❌ 施設画像削除処理エラー:",s),n("施設画像削除処理でエラーが発生しました。");return}try{const{error:s}=await g.from("dog_park_images").delete().eq("park_id",r);if(s){console.error("❌ パーク画像削除エラー:",s),n(`パーク画像の削除に失敗しました: ${s.message}`);return}console.log("✅ パーク画像削除完了")}catch(s){console.error("❌ パーク画像削除処理エラー:",s),n("パーク画像削除処理でエラーが発生しました。");return}try{const{error:s}=await g.from("dog_park_review_stages").delete().eq("park_id",r);if(s){console.error("❌ レビューステージ削除エラー:",s),n(`レビューステージの削除に失敗しました: ${s.message}`);return}console.log("✅ レビューステージ削除完了")}catch(s){console.error("❌ レビューステージ削除処理エラー:",s),n("レビューステージ削除処理でエラーが発生しました。");return}try{const{error:s}=await g.from("dog_parks").delete().eq("id",r);if(s){console.error("❌ ドッグラン削除エラー:",s),n(`ドッグランの削除に失敗しました: ${s.message}`);return}console.log("✅ ドッグラン本体削除完了")}catch(s){console.error("❌ ドッグラン削除処理エラー:",s),n("ドッグラン削除処理でエラーが発生しました。");return}console.log("✅ ドッグランと関連データの削除完了"),_("ドッグラン申請を削除しました。"),k(null)}catch(s){console.error("❌ ドッグラン削除エラー:",s),n("ドッグランの削除に失敗しました。")}},T=r=>({overview:"施設全景",entrance:"入口",large_dog_area:"大型犬エリア",small_dog_area:"小型犬エリア",private_booth:"プライベートブース",parking:"駐車場",shower:"シャワー設備",restroom:"トイレ",agility:"アジリティ設備",rest_area:"休憩スペース",water_station:"給水設備",exterior:"外観",interior:"内装",equipment:"設備",area:"エリア",other:"その他"})[r]||r;return x?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):l?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"relative max-w-6xl w-full max-h-[90vh]",children:[e.jsx("button",{onClick:()=>t(null),className:"absolute top-4 right-4 p-2 bg-white bg-opacity-90 shadow-lg rounded-full text-gray-800 hover:bg-opacity-100 transition-all z-10",children:e.jsx(q,{className:"w-6 h-6"})}),e.jsx("img",{src:l,alt:"拡大画像",className:"max-w-full max-h-full mx-auto rounded-lg object-contain",onError:r=>{r.currentTarget.src="https://via.placeholder.com/800x600?text=Image+Not+Available"}})]})}):m&&y?e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center space-x-4 mb-6",children:e.jsxs("button",{onClick:()=>{o(!1),D(null),b("")},className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"画像一覧に戻る"]})}),e.jsxs(E,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold",children:["画像レビュー: ",T(y.image_type)]}),e.jsx("div",{className:"flex space-x-2",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${y.is_approved===!0?"bg-green-100 text-green-800":y.is_approved===!1?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:y.is_approved===!0?"承認済み":y.is_approved===!1?"却下":"審査待ち"})})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"w-full h-96 bg-gray-100 rounded-lg overflow-hidden relative group",children:[e.jsx("img",{src:y.image_url,alt:T(y.image_type),className:"w-full h-full object-contain cursor-pointer",onClick:()=>t(y.image_url),onError:r=>{r.currentTarget.src="https://via.placeholder.com/800x600?text=Image+Not+Available"}}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-200 flex items-center justify-center cursor-pointer",onClick:()=>t(y.image_url),children:e.jsx(B,{className:"w-12 h-12 text-white opacity-0 group-hover:opacity-100 transition-opacity duration-200"})}),e.jsx("div",{className:"absolute bottom-4 right-4",children:e.jsx("span",{className:"px-2 py-1 bg-white bg-opacity-90 text-gray-800 text-xs rounded border shadow-sm",children:"クリックで拡大"})})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"却下理由（却下する場合のみ入力）"}),e.jsx("textarea",{value:C,onChange:r=>b(r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,placeholder:"例: 画像が不鮮明です。より明るく鮮明な画像を再アップロードしてください。"})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(h,{variant:"secondary",onClick:()=>{o(!1),D(null),b("")},children:"キャンセル"}),e.jsxs(h,{onClick:()=>void M(!1),isLoading:P.isProcessing,className:"bg-red-600 hover:bg-red-700",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"却下"]}),e.jsxs(h,{onClick:()=>void M(!0),isLoading:P.isProcessing,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"承認"]})]})]})]}):m&&y?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"画像審査"}),e.jsxs(h,{variant:"secondary",onClick:()=>{o(!1),D(null),b("")},children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"戻る"]})]}),e.jsxs(E,{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"font-semibold mb-2",children:["画像タイプ: ",T(y.image_type)]}),e.jsxs("div",{className:"relative w-full h-96 bg-gray-100 rounded-lg overflow-hidden group",children:[e.jsx("img",{src:y.image_url,alt:T(y.image_type),className:"w-full h-full object-contain cursor-pointer",onClick:()=>t(y.image_url),onError:r=>{r.currentTarget.src="https://via.placeholder.com/800x600?text=Image+Not+Available"}}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-200 flex items-center justify-center cursor-pointer",onClick:()=>t(y.image_url),children:e.jsx(B,{className:"w-12 h-12 text-white opacity-0 group-hover:opacity-100 transition-opacity duration-200"})}),e.jsx("div",{className:"absolute bottom-4 right-4",children:e.jsx("span",{className:"px-2 py-1 bg-white bg-opacity-90 text-gray-800 text-xs rounded border shadow-sm",children:"クリックで拡大"})})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"却下理由（却下する場合のみ入力）"}),e.jsx("textarea",{value:C,onChange:r=>b(r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,placeholder:"例: 画像が不鮮明です。より明るく鮮明な画像を再アップロードしてください。"})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(h,{variant:"secondary",onClick:()=>{o(!1),D(null),b("")},children:"キャンセル"}),e.jsxs(h,{onClick:()=>void M(!1),isLoading:P.isProcessing,className:"bg-red-600 hover:bg-red-700",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"却下"]}),e.jsxs(h,{onClick:()=>void M(!0),isLoading:P.isProcessing,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"承認"]})]})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:e.jsxs("div",{className:"relative max-w-4xl max-h-full p-4",children:[e.jsx("img",{src:l.startsWith("http")?l:`${g.storage.from("vaccine-certs").getPublicUrl(l).data.publicUrl}`,alt:"拡大画像",className:"max-w-full max-h-full object-contain"}),e.jsx(h,{onClick:()=>t(null),className:"absolute top-2 right-2 bg-white text-black hover:bg-gray-100",children:e.jsx(q,{className:"w-4 h-4"})})]})})]}):a?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[e.jsx(K,{className:"w-6 h-6 text-blue-600 mr-2"}),a.name,"の審査"]}),e.jsxs(h,{variant:"secondary",onClick:()=>k(null),children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"一覧に戻る"]})]}),e.jsxs(E,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center",children:[e.jsx(K,{className:"w-5 h-5 mr-2"}),"施設情報"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"施設名"}),e.jsx("p",{className:"font-medium",children:a.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"住所"}),e.jsx("p",{className:"font-medium",children:a.address})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"オーナー"}),e.jsx("p",{className:"font-medium",children:a.owner_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"申請日"}),e.jsx("p",{className:"font-medium",children:new Date(a.created_at).toLocaleDateString("ja-JP")})]})]})]}),e.jsxs(E,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center",children:[e.jsx(le,{className:"w-5 h-5 mr-2"}),"本人確認書類・登録情報"]}),z?e.jsxs("div",{className:"flex justify-center items-center h-32",children:[e.jsx(ee,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"データを読み込み中..."})]}):u?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(W,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-red-600 mb-2",children:u}),e.jsx(h,{variant:"secondary",onClick:()=>a&&R(a.owner_id),children:"再読み込み"})]}):i?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-3 flex items-center",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"登録住所情報（照合用）"]}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"氏名"}),e.jsx("p",{className:"font-medium text-blue-900",children:i.owner_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"郵便番号"}),e.jsx("p",{className:"font-medium text-blue-900",children:i.postal_code})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"住所"}),e.jsx("p",{className:"font-medium text-blue-900",children:i.address})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"電話番号"}),e.jsx("p",{className:"font-medium text-blue-900",children:i.phone_number})]})]})})]}),i.identity_document_url?e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-3 flex items-center",children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"本人確認書類"]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"ファイル名"}),e.jsx("p",{className:"font-medium",children:i.identity_document_filename})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"アップロード日"}),e.jsx("p",{className:"font-medium",children:new Date(i.identity_created_at).toLocaleDateString("ja-JP")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"審査状況"}),e.jsx("p",{className:`font-medium ${i.identity_status==="verified"?"text-green-600":i.identity_status==="failed"?"text-red-600":"text-yellow-600"}`,children:i.identity_status==="verified"?"承認済み":i.identity_status==="failed"?"却下":"審査待ち"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"本人確認書類画像"}),e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:`${g.storage.from("vaccine-certs").getPublicUrl(i.identity_document_url).data.publicUrl}`,alt:"本人確認書類",className:"max-w-full h-auto max-h-96 rounded-lg border shadow-sm cursor-pointer hover:shadow-md transition-shadow",onClick:()=>t(i.identity_document_url),onError:r=>{console.error("❌ 画像の読み込みに失敗:",i.identity_document_url),r.currentTarget.src="https://via.placeholder.com/400x300?text=Image+Not+Available"}}),e.jsx("div",{className:"absolute bottom-2 right-2",children:e.jsx("span",{className:"px-2 py-1 bg-white bg-opacity-90 text-gray-800 text-xs rounded border shadow-sm",children:"クリックで拡大"})})]})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(W,{className:"w-5 h-5 text-yellow-600 mr-2 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"照合チェック"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"本人確認書類に記載された住所・氏名と、上記の登録情報が一致するかご確認ください。"})]})]})})]})]}):e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-3 flex items-center",children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"本人確認書類"]}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(W,{className:"w-5 h-5 text-red-600 mr-2 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:i.identity_status==="not_submitted"?"本人確認書類が未提出です":"本人確認書類の取得に失敗しました"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:i.identity_status==="not_submitted"?"このドッグラン申請には本人確認書類が添付されていません。申請者に本人確認書類の提出を依頼してください。":"システムエラーまたは画像ファイルの問題が発生している可能性があります。"})]})]})})]})]}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-600",children:"データを読み込み中..."})})]}),(a.status==="second_stage_review"||a.status==="first_stage_passed"||a.total_images>0)&&e.jsxs(E,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"施設画像"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-blue-50 p-3 rounded text-center",children:[e.jsx("p",{className:"font-medium text-blue-800",children:"全画像"}),e.jsxs("p",{className:"text-blue-600",children:[a.total_images,"枚"]})]}),e.jsxs("div",{className:"bg-yellow-50 p-3 rounded text-center",children:[e.jsx("p",{className:"font-medium text-yellow-800",children:"審査待ち"}),e.jsxs("p",{className:"text-yellow-600",children:[a.pending_images,"枚"]})]}),e.jsxs("div",{className:"bg-green-50 p-3 rounded text-center",children:[e.jsx("p",{className:"font-medium text-green-800",children:"承認済み"}),e.jsxs("p",{className:"text-green-600",children:[a.approved_images,"枚"]})]}),e.jsxs("div",{className:"bg-red-50 p-3 rounded text-center",children:[e.jsx("p",{className:"font-medium text-red-800",children:"却下"}),e.jsxs("p",{className:"text-red-600",children:[a.rejected_images,"枚"]})]})]}),e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded text-sm",children:[e.jsx("p",{children:e.jsx("strong",{children:"デバッグ情報:"})}),e.jsxs("p",{children:["Park ID: ",a.id]}),e.jsxs("p",{children:["Status: ",a.status]}),e.jsxs("p",{children:["Images Loading: ",I.isLoading?"Yes":"No"]}),e.jsxs("p",{children:["Images Count: ",I.parkImages.length]}),e.jsxs("p",{children:["Images Error: ",I.error||"None"]}),e.jsxs("p",{children:["Expected Total: ",a.total_images]}),e.jsxs("div",{className:"mt-2 flex space-x-2",children:[e.jsx(h,{size:"sm",variant:"secondary",onClick:()=>{console.log("🔄 Manual refresh triggered for park:",a.id),I.fetchParkImages(a.id)},children:"画像再取得"}),e.jsx(h,{size:"sm",variant:"secondary",onClick:async()=>{console.log("🗃️ Direct database query for park:",a.id);try{const{data:r,error:d}=await g.from("dog_park_facility_images").select("*").eq("park_id",a.id);d?console.error("❌ Direct query error:",d):(console.log("📋 Direct query result:",r),alert("データベース直接クエリ結果をコンソールに出力しました"))}catch(r){console.error("❌ Direct query failed:",r)}},children:"DB直接確認"})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{children:e.jsx("strong",{children:"Raw Images Data:"})}),e.jsx("pre",{className:"text-xs bg-white p-2 rounded border max-h-32 overflow-y-auto",children:JSON.stringify(I.parkImages,null,2)})]})]}),I.isLoading?e.jsxs("div",{className:"flex justify-center items-center h-32",children:[e.jsx(ee,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"画像を読み込み中..."})]}):I.error?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-red-600 mb-2",children:"画像の読み込みに失敗しました"}),e.jsx("p",{className:"text-gray-500 text-sm",children:I.error}),e.jsx(h,{variant:"secondary",onClick:()=>void I.fetchParkImages(a.id),className:"mt-4",children:"再読み込み"})]}):I.parkImages.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-600",children:"アップロードされた画像がありません"}),e.jsxs("p",{className:"text-gray-500 text-sm",children:["パークステータス: ",a.status]}),e.jsxs("p",{className:"text-gray-500 text-sm",children:["期待される画像数: ",a.total_images]}),e.jsx(h,{variant:"secondary",onClick:()=>{console.log("🔄 Manual refresh triggered for park:",a.id),I.fetchParkImages(a.id)},className:"mt-4",children:"手動でリフレッシュ"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:I.parkImages.map((r,d)=>e.jsxs("div",{className:"relative group",children:[e.jsxs("div",{className:"relative overflow-hidden rounded-lg bg-gray-100",children:[e.jsx("img",{src:r.image_url,alt:T(r.image_type),className:"w-full h-48 object-cover cursor-pointer hover:scale-105 transition-transform duration-200",onClick:()=>G(r),onLoad:()=>console.log(`🖼️ Image ${d+1} loaded successfully:`,r.image_url),onError:s=>{console.error(`❌ Image ${d+1} failed to load:`,r.image_url),s.currentTarget.src="https://via.placeholder.com/400x300?text=Image+Not+Available"}}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-200 flex items-center justify-center cursor-pointer",onClick:s=>{s.stopPropagation(),t(r.image_url)},children:e.jsx(B,{className:"w-8 h-8 text-white opacity-0 group-hover:opacity-100 transition-opacity duration-200"})})]}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${r.is_approved===!0?"bg-green-100 text-green-800":r.is_approved===!1?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:r.is_approved===!0?"承認済み":r.is_approved===!1?"却下":"審査待ち"})}),e.jsx("div",{className:"absolute bottom-2 left-2",children:e.jsx("span",{className:"px-2 py-1 bg-white bg-opacity-90 text-gray-800 text-xs rounded border shadow-sm",children:T(r.image_type)})}),r.is_approved===!1&&r.admin_notes&&e.jsxs("div",{className:"mt-2 p-2 bg-red-50 rounded text-sm",children:[e.jsx("p",{className:"text-red-800 font-medium",children:"却下理由:"}),e.jsx("p",{className:"text-red-700",children:r.admin_notes})]})]},r.id))})]}),e.jsxs(E,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"審査結果"}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"審査チェックリスト"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:`w-4 h-4 rounded-full mr-2 ${i?.owner_name&&i.owner_name!=="名前未登録"?"bg-green-500":"bg-red-500"}`}),e.jsxs("span",{children:["登録氏名: ",i?.owner_name||"未登録"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:`w-4 h-4 rounded-full mr-2 ${i?.address&&i.address!=="未登録"?"bg-green-500":"bg-red-500"}`}),e.jsxs("span",{children:["登録住所: ",i?.address||"未登録"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:`w-4 h-4 rounded-full mr-2 ${i?.phone_number&&i.phone_number!=="未登録"?"bg-green-500":"bg-red-500"}`}),e.jsxs("span",{children:["電話番号: ",i?.phone_number||"未登録"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:`w-4 h-4 rounded-full mr-2 ${i?.identity_document_url?"bg-green-500":"bg-red-500"}`}),e.jsxs("span",{children:["本人確認書類: ",i?.identity_document_url?"提出済み":"未提出"]})]}),i?.identity_document_url&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:`w-4 h-4 rounded-full mr-2 ${i.identity_status==="verified"?"bg-green-500":i.identity_status==="failed"?"bg-red-500":"bg-yellow-500"}`}),e.jsxs("span",{children:["本人確認状況: ",i.identity_status==="verified"?"承認済み":i.identity_status==="failed"?"却下":"審査待ち"]})]})]})]})}),(!i?.identity_document_url||i.identity_status==="not_submitted")&&e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(W,{className:"w-5 h-5 text-yellow-600 mr-2 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"審査判断の推奨事項"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"本人確認書類が未提出のため、申請を承認する前に申請者に本人確認書類の提出を依頼することを推奨します。 または、不備として一時的に却下し、必要書類の提出を求めてください。"})]})]})})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"却下理由（却下する場合のみ入力）"}),e.jsx("textarea",{value:C,onChange:r=>b(r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,placeholder:"例: 本人確認書類が未提出のため、身元確認ができません。本人確認書類（運転免許証、パスポート、マイナンバーカードなど）を提出してから再度申請してください。"})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsxs(h,{onClick:()=>void F(a.id,!1),isLoading:P.isProcessing,className:"bg-red-600 hover:bg-red-700",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"却下"]}),e.jsxs(h,{onClick:()=>void F(a.id,!0),isLoading:P.isProcessing,className:"bg-green-600 hover:bg-green-700",disabled:!i?.identity_document_url&&i?.identity_status==="not_submitted",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"承認"]}),e.jsxs(h,{onClick:()=>void Z(a.id),isLoading:P.isProcessing,className:"bg-red-600 hover:bg-red-700",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"削除"]})]})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:e.jsxs("div",{className:"relative max-w-4xl max-h-full p-4",children:[e.jsx("img",{src:l.startsWith("http")?l:`${g.storage.from("vaccine-certs").getPublicUrl(l).data.publicUrl}`,alt:"拡大画像",className:"max-w-full max-h-full object-contain"}),e.jsx(h,{onClick:()=>t(null),className:"absolute top-2 right-2 bg-white text-black hover:bg-gray-100",children:e.jsx(q,{className:"w-4 h-4"})})]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[e.jsx(Q,{className:"w-6 h-6 text-blue-600 mr-2"}),"ドッグラン審査管理"]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["審査待ち: ",p.length,"件"]})]}),e.jsx(E,{className:"bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-3",children:"審査プロセス概要"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-yellow-600 text-white rounded-full flex items-center justify-center text-sm font-bold mx-auto mb-2",children:"1"}),e.jsx("div",{className:"text-sm font-medium text-blue-900",children:"第一審査"}),e.jsx("div",{className:"text-xs text-blue-700",children:"基本情報・本人確認"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-orange-600 text-white rounded-full flex items-center justify-center text-sm font-bold mx-auto mb-2",children:"2"}),e.jsx("div",{className:"text-sm font-medium text-blue-900",children:"第二審査"}),e.jsx("div",{className:"text-xs text-blue-700",children:"施設画像・詳細審査"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-indigo-600 text-white rounded-full flex items-center justify-center text-sm font-bold mx-auto mb-2",children:"3"}),e.jsx("div",{className:"text-sm font-medium text-blue-900",children:"実証検査"}),e.jsx("div",{className:"text-xs text-blue-700",children:"スマートロック確認"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center text-sm font-bold mx-auto mb-2",children:"4"}),e.jsx("div",{className:"text-sm font-medium text-blue-900",children:"公開承認"}),e.jsx("div",{className:"text-xs text-blue-700",children:"一般公開開始"})]})]})]})}),p.length>0&&e.jsx(E,{className:"bg-gray-50",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-medium mb-3",children:"審査状況統計"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-yellow-600",children:p.filter(r=>r.status==="pending").length}),e.jsx("div",{className:"text-gray-600",children:"第一審査中"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-orange-600",children:p.filter(r=>r.status==="second_stage_waiting").length}),e.jsx("div",{className:"text-gray-600",children:"第二審査待ち"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-purple-600",children:p.filter(r=>r.status==="second_stage_review").length}),e.jsx("div",{className:"text-gray-600",children:"第二審査中"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-indigo-600",children:p.filter(r=>r.status==="smart_lock_testing").length}),e.jsx("div",{className:"text-gray-600",children:"実証検査中"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:p.filter(r=>r.status==="approved").length}),e.jsx("div",{className:"text-gray-600",children:"承認済み"})]})]})]})}),p.length===0?e.jsxs(E,{className:"text-center py-12",children:[e.jsx(V,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"審査待ちのドッグランはありません"})]}):e.jsx("div",{className:"space-y-4",children:p.map(r=>{const s=(A=>{switch(A){case"pending":return{color:"bg-yellow-100 text-yellow-800 border-yellow-300",label:"第一審査中",description:"基本情報と本人確認書類を確認してください",action:"承認または却下"};case"second_stage_waiting":return{color:"bg-orange-100 text-orange-800 border-orange-300",label:"第二審査提出待ち",description:"オーナーが第二審査書類を提出するまで待機",action:"待機中"};case"second_stage_review":return{color:"bg-purple-100 text-purple-800 border-purple-300",label:"第二審査中",description:"施設画像と詳細情報を確認してください",action:"画像審査・承認"};case"smart_lock_testing":return{color:"bg-indigo-100 text-indigo-800 border-indigo-300",label:"スマートロック実証検査中",description:"実際の施設でのスマートロック動作確認",action:"実証検査完了"};default:return{color:"bg-gray-100 text-gray-800 border-gray-300",label:A,description:"",action:""}}})(r.status);return e.jsx(E,{className:`p-6 border-2 ${s.color.includes("border")?s.color:s.color+" border-gray-200"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:r.name}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${s.color}`,children:s.label})]}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600 mb-3",children:[e.jsxs("p",{children:[e.jsx(Q,{className:"w-4 h-4 inline mr-1"}),r.address]}),e.jsxs("p",{children:[e.jsx(se,{className:"w-4 h-4 inline mr-1"}),"オーナー: ",r.owner_name]})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"現在の審査状況"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description}),s.action&&e.jsxs("p",{className:"text-sm font-medium text-blue-600 mt-2",children:["推奨アクション: ",s.action]})]})]}),e.jsxs("div",{className:"ml-4 flex flex-col space-y-2",children:[e.jsxs(h,{onClick:()=>k(r),className:"bg-blue-600 hover:bg-blue-700",size:"sm",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"詳細確認"]}),e.jsxs(h,{onClick:()=>void Z(r.id),className:"bg-red-600 hover:bg-red-700",size:"sm",children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"削除"]}),r.status==="second_stage_waiting"&&e.jsx("div",{className:"text-xs text-gray-500 text-center",children:"オーナーの提出待ち"})]})]})},r.id)})})]})},fe=({pendingVaccines:p,isLoading:x,onApprovalComplete:_,onError:n})=>{const[a,k]=v.useState(null),[C,b]=v.useState(""),[y,D]=v.useState({}),[m,o]=v.useState({}),[l,t]=v.useState(null),[i,f]=v.useState(1),[u,S]=v.useState(!1),[z,O]=v.useState({rabies_expiry_date:"",combo_expiry_date:""}),P=ne(),I=async(c,w)=>{try{const U=await P.handleVaccineApproval(c,w,C);U.success?(_(U.message),k(null),b("")):n(U.message)}catch(U){n(`処理中にエラーが発生しました: ${U.message}`)}},R=c=>{D(w=>({...w,[c]:!1}))},F=c=>{D(w=>({...w,[c]:!1})),o(w=>({...w,[c]:!0}))},G=c=>{D(w=>({...w,[c]:!0})),o(w=>({...w,[c]:!1}))},M=(c,w,U)=>{t({src:c,alt:w,type:U}),f(1)},Z=()=>{t(null),f(1)},T=()=>{f(c=>Math.min(c+.5,3))},r=()=>{f(c=>Math.max(c-.5,.5))},d=c=>{O({rabies_expiry_date:c.rabies_expiry_date||"",combo_expiry_date:c.combo_expiry_date||""})},s=async()=>{if(a)try{const c=await P.handleVaccineExpiryUpdate(a.id,z.rabies_expiry_date||null,z.combo_expiry_date||null);c.success?(_(c.message),S(!1),a&&(a.rabies_expiry_date=z.rabies_expiry_date||null,a.combo_expiry_date=z.combo_expiry_date||null)):n(c.message)}catch(c){n(`有効期限の更新に失敗しました: ${c.message}`)}},A=c=>{if(!c)return"未設定";try{return new Date(c).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})}catch{return"無効な日付"}},j=c=>{if(!c)return!1;const w=new Date(c),U=new Date,oe=new Date(U.getTime()+30*24*60*60*1e3);return w<=oe},N=c=>c?new Date(c)<new Date:!1,L=()=>"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjNmNGY2Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzM3NDE1MSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPueUu+WDj+OBjOiqreOCgeWFpeOBv+OBvuOBm+OCk+OBp+OBl+OBnw==</dGV4dD48L3N2Zz4=";return x?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):a?(z.rabies_expiry_date===""&&z.combo_expiry_date===""&&d(a),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[e.jsx(Y,{className:"w-6 h-6 text-blue-600 mr-2"}),a.dog.name,"のワクチン証明書審査"]}),e.jsxs(h,{variant:"secondary",onClick:()=>{k(null),S(!1),O({rabies_expiry_date:"",combo_expiry_date:""})},children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"一覧に戻る"]})]}),e.jsxs(E,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"犬の基本情報"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"名前"}),e.jsx("p",{className:"font-medium",children:a.dog.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"犬種"}),e.jsx("p",{className:"font-medium",children:a.dog.breed})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"性別"}),e.jsx("p",{className:"font-medium",children:a.dog.gender})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"飼い主"}),e.jsx("p",{className:"font-medium",children:a.dog.owner.name})]})]})]}),e.jsxs(E,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"font-semibold",children:"ワクチン有効期限"}),e.jsx(h,{size:"sm",variant:"secondary",onClick:()=>S(!u),children:u?"キャンセル":"編集"})]}),u?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"狂犬病ワクチン有効期限"}),e.jsx("input",{type:"date",value:z.rabies_expiry_date,onChange:c=>O(w=>({...w,rabies_expiry_date:c.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"混合ワクチン有効期限"}),e.jsx("input",{type:"date",value:z.combo_expiry_date,onChange:c=>O(w=>({...w,combo_expiry_date:c.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(h,{variant:"secondary",onClick:()=>{S(!1),d(a)},children:"キャンセル"}),e.jsx(h,{onClick:()=>void s(),isLoading:P.isProcessing,className:"bg-blue-600 hover:bg-blue-700",children:"保存"})]})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"狂犬病ワクチン有効期限"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:`font-medium ${N(a.rabies_expiry_date)?"text-red-600":j(a.rabies_expiry_date)?"text-yellow-600":"text-green-600"}`,children:A(a.rabies_expiry_date)}),N(a.rabies_expiry_date)&&e.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full",children:"期限切れ"}),j(a.rabies_expiry_date)&&!N(a.rabies_expiry_date)&&e.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:"期限間近"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"混合ワクチン有効期限"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:`font-medium ${N(a.combo_expiry_date)?"text-red-600":j(a.combo_expiry_date)?"text-yellow-600":"text-green-600"}`,children:A(a.combo_expiry_date)}),N(a.combo_expiry_date)&&e.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full",children:"期限切れ"}),j(a.combo_expiry_date)&&!N(a.combo_expiry_date)&&e.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:"期限間近"})]})]})]})]}),e.jsxs(E,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"ワクチン証明書"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"狂犬病ワクチン"}),a.rabies_vaccine_image?e.jsxs("div",{className:"border rounded-lg overflow-hidden relative",children:[y[`rabies-${a.id}`]&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 z-10",children:e.jsx(ae,{className:"w-6 h-6 animate-spin text-gray-600"})}),e.jsx("img",{src:H(a.rabies_vaccine_image)||L(),alt:"狂犬病ワクチン証明書",className:"w-full h-64 object-contain cursor-pointer hover:opacity-80 transition-opacity",onLoadStart:()=>G(`rabies-${a.id}`),onLoad:()=>R(`rabies-${a.id}`),onError:()=>F(`rabies-${a.id}`),onClick:()=>M(H(a.rabies_vaccine_image)||L(),"狂犬病ワクチン証明書","rabies")}),e.jsx("div",{className:"absolute top-2 left-2 bg-white bg-opacity-90 text-gray-800 p-1 rounded border shadow-sm",children:e.jsx(B,{className:"w-4 h-4"})}),m[`rabies-${a.id}`]&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-red-50 bg-opacity-90",children:e.jsxs("div",{className:"text-center",children:[e.jsx(q,{className:"w-12 h-12 text-red-500 mx-auto mb-2"}),e.jsx("p",{className:"text-red-700 font-medium",children:"画像が読み込めませんでした"})]})})]}):e.jsx("div",{className:"h-64 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"画像なし"})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"混合ワクチン"}),a.combo_vaccine_image?e.jsxs("div",{className:"border rounded-lg overflow-hidden relative",children:[y[`combo-${a.id}`]&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 z-10",children:e.jsx(ae,{className:"w-6 h-6 animate-spin text-gray-600"})}),e.jsx("img",{src:H(a.combo_vaccine_image)||L(),alt:"混合ワクチン証明書",className:"w-full h-64 object-contain cursor-pointer hover:opacity-80 transition-opacity",onLoadStart:()=>G(`combo-${a.id}`),onLoad:()=>R(`combo-${a.id}`),onError:()=>F(`combo-${a.id}`),onClick:()=>M(H(a.combo_vaccine_image)||L(),"混合ワクチン証明書","combo")}),e.jsx("div",{className:"absolute top-2 left-2 bg-white bg-opacity-90 text-gray-800 p-1 rounded border shadow-sm",children:e.jsx(B,{className:"w-4 h-4"})}),m[`combo-${a.id}`]&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-red-50 bg-opacity-90",children:e.jsxs("div",{className:"text-center",children:[e.jsx(q,{className:"w-12 h-12 text-red-500 mx-auto mb-2"}),e.jsx("p",{className:"text-red-700 font-medium",children:"画像が読み込めませんでした"})]})})]}):e.jsx("div",{className:"h-64 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"画像なし"})})]})]})]}),e.jsxs(E,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"審査結果"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"却下理由（却下する場合のみ入力）"}),e.jsx("textarea",{value:C,onChange:c=>b(c.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,placeholder:"例: ワクチン証明書の有効期限が切れています。最新の証明書をアップロードしてください。"})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsxs(h,{onClick:()=>void I(a.id,!1),isLoading:P.isProcessing,className:"bg-red-600 hover:bg-red-700",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"却下"]}),e.jsxs(h,{onClick:()=>void I(a.id,!0),isLoading:P.isProcessing,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"承認"]})]})]}),l&&e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4",children:[e.jsxs("div",{className:"relative max-w-full max-h-full",children:[e.jsxs("div",{className:"absolute top-4 right-4 flex items-center space-x-2 z-10",children:[e.jsx("div",{className:"bg-white bg-opacity-90 text-gray-800 px-3 py-1 rounded border shadow-sm text-sm",children:l.type==="rabies"?"狂犬病ワクチン":"混合ワクチン"}),e.jsx(h,{size:"sm",onClick:r,className:"bg-white bg-opacity-90 shadow-lg text-gray-800 hover:bg-opacity-100 border border-gray-300",children:e.jsx(te,{className:"w-4 h-4"})}),e.jsx(h,{size:"sm",onClick:T,className:"bg-white bg-opacity-90 shadow-lg text-gray-800 hover:bg-opacity-100 border border-gray-300",children:e.jsx(B,{className:"w-4 h-4"})}),e.jsx(h,{size:"sm",onClick:Z,className:"bg-white bg-opacity-90 shadow-lg text-gray-800 hover:bg-opacity-100 border border-gray-300",children:e.jsx(q,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"overflow-auto max-h-screen",children:e.jsx("img",{src:l.src,alt:l.alt,className:"max-w-none transition-transform duration-200",style:{transform:`scale(${i})`,transformOrigin:"center center"},onError:c=>{c.currentTarget.src=L()}})}),e.jsxs("div",{className:"absolute bottom-4 left-4 bg-white bg-opacity-90 text-gray-800 px-3 py-2 rounded border shadow-sm text-sm",children:[e.jsx("p",{children:"拡大/縮小: ズームボタンを使用"}),e.jsx("p",{children:"閉じる: Xボタンまたは画像外をクリック"})]})]}),e.jsx("div",{className:"absolute inset-0 -z-10",onClick:Z})]})]})):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[e.jsx(Y,{className:"w-6 h-6 text-blue-600 mr-2"}),"審査待ちワクチン証明書"]}),p.length===0?e.jsxs(E,{className:"text-center py-12",children:[e.jsx(V,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"審査待ちのワクチン証明書はありません"})]}):e.jsx("div",{className:"space-y-4",children:p.map(c=>e.jsx(E,{className:"p-6 hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-2",children:[c.dog.name,"のワクチン証明書"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"犬種"}),e.jsx("p",{className:"font-medium",children:c.dog.breed})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"性別"}),e.jsx("p",{className:"font-medium",children:c.dog.gender})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"飼い主"}),e.jsx("p",{className:"font-medium",children:c.dog.owner.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"申請日"}),e.jsx("p",{className:"font-medium",children:new Date(c.created_at).toLocaleDateString("ja-JP")})]})]})]}),e.jsxs("div",{className:"flex space-x-2 ml-4",children:[e.jsxs(h,{size:"sm",variant:"secondary",onClick:()=>k(c),children:[e.jsx(ce,{className:"w-4 h-4 mr-1"}),"詳細"]}),e.jsxs(h,{size:"sm",onClick:()=>void I(c.id,!0),className:"bg-green-600 hover:bg-green-700",disabled:P.isProcessing,children:[e.jsx(V,{className:"w-4 h-4 mr-1"}),"承認"]}),e.jsxs(h,{size:"sm",onClick:()=>{k(c),I(c.id,!1)},className:"bg-red-600 hover:bg-red-700",disabled:P.isProcessing,children:[e.jsx(q,{className:"w-4 h-4 mr-1"}),"却下"]})]})]})},c.id))})]}),l&&e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4",children:[e.jsxs("div",{className:"relative max-w-full max-h-full",children:[e.jsxs("div",{className:"absolute top-4 right-4 flex items-center space-x-2 z-10",children:[e.jsx("div",{className:"bg-white bg-opacity-90 text-gray-800 px-3 py-1 rounded border shadow-sm text-sm",children:l.type==="rabies"?"狂犬病ワクチン":"混合ワクチン"}),e.jsx(h,{size:"sm",onClick:r,className:"bg-white bg-opacity-90 shadow-lg text-gray-800 hover:bg-opacity-100 border border-gray-300",children:e.jsx(te,{className:"w-4 h-4"})}),e.jsx(h,{size:"sm",onClick:T,className:"bg-white bg-opacity-90 shadow-lg text-gray-800 hover:bg-opacity-100 border border-gray-300",children:e.jsx(B,{className:"w-4 h-4"})}),e.jsx(h,{size:"sm",onClick:Z,className:"bg-white bg-opacity-90 shadow-lg text-gray-800 hover:bg-opacity-100 border border-gray-300",children:e.jsx(q,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"overflow-auto max-h-screen",children:e.jsx("img",{src:l.src,alt:l.alt,className:"max-w-none transition-transform duration-200",style:{transform:`scale(${i})`,transformOrigin:"center center"},onError:c=>{c.currentTarget.src=L()}})}),e.jsxs("div",{className:"absolute bottom-4 left-4 bg-white bg-opacity-90 text-gray-800 px-3 py-2 rounded border shadow-sm text-sm",children:[e.jsx("p",{children:"拡大/縮小: ズームボタンを使用"}),e.jsx("p",{children:"閉じる: Xボタンまたは画像外をクリック"})]})]}),e.jsx("div",{className:"absolute inset-0 -z-10",onClick:Z})]})]})},ie=async p=>{try{$("info","🔧 Checking admin user setup for:",{email:p});const{data:{user:x},error:_}=await g.auth.getUser();if(_)return $("error","❌ Error getting current user:",_),{success:!1,error:_.message};if(!x)return $("error","❌ No user found"),{success:!1,error:"No user found"};$("info","👤 Current user:",{id:x.id,email:x.email,metadata:x.user_metadata});const n=x.user_metadata?.admin===!0;if($("info","🔍 Admin status:",{isAdmin:n}),!n)return $("error","❌ User is not admin"),{success:!1,error:"User is not admin"};const{data:a,error:k}=await g.from("profiles").select("*").eq("id",x.id).single();if(k){if($("error","❌ Error getting profile:",k),k.code==="PGRST116"){$("info","📝 Creating admin profile...");const{data:C,error:b}=await g.from("profiles").insert({id:x.id,name:x.user_metadata?.name||x.email?.split("@")[0]||"Admin",user_type:"admin",email:x.email,postal_code:"",address:"",phone_number:"",created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();return b?($("error","❌ Error creating admin profile:",b),{success:!1,error:b.message}):($("info","✅ Admin profile created successfully:",C),{success:!0,profile:C,message:"Admin profile created successfully"})}return{success:!1,error:k.message}}if(a.user_type!=="admin"){$("info","🔄 Updating user type to admin...");const{data:C,error:b}=await g.from("profiles").update({user_type:"admin",updated_at:new Date().toISOString()}).eq("id",x.id).select().single();return b?($("error","❌ Error updating profile to admin:",b),{success:!1,error:b.message}):($("info","✅ Profile updated to admin successfully:",C),{success:!0,profile:C,message:"Profile updated to admin successfully"})}return $("info","✅ Admin user already set up correctly:",a),{success:!0,profile:a,message:"Admin user already set up correctly"}}catch(x){return $("error","❌ Exception in checkAndSetAdminUser:",{error:X(x)}),{success:!1,error:X(x)}}},be=async(p,x)=>{try{$("info","🔧 Direct update user type:",{userId:p,userType:x});const{data:_,error:n}=await g.from("profiles").update({user_type:x}).eq("id",p).select().single();return n?($("error","❌ Direct update failed:",n),{success:!1,error:n.message}):($("info","✅ Direct update successful:",_),{success:!0,data:_,message:"User type updated successfully"})}catch(_){return $("error","❌ Exception in directUpdateUserType:",{error:X(_)}),{success:!1,error:X(_)}}};function we(){const{user:p,isAdmin:x,userProfile:_}=ge(),n=me(),[a,k]=v.useState("vaccines"),[C,b]=v.useState(""),[y,D]=v.useState(""),m=ue(a),o=u=>{D(u),b(""),setTimeout(()=>D(""),5e3)},l=u=>{b(u),D(""),setTimeout(()=>b(""),8e3)},t=()=>{b(""),D("")};v.useEffect(()=>{p&&!x&&(async()=>{if(p?.email==="capasjapan@gmail.com"&&!x){console.log("🔧 Setting up admin user...");try{(await ie(p.email)).success&&(o("管理者権限を設定しました。ページを再読み込みします..."),setTimeout(()=>window.location.reload(),1500))}catch(S){console.error("Admin setup error:",S)}}})()},[p,x]),v.useEffect(()=>{if(!x){console.log("❌ Admin access denied - redirecting to home"),n("/");return}console.log("✅ Admin access granted - fetching data"),m.refetch()},[x,n,a]);const i=async u=>{o(u),await m.refetch()},f=u=>{l(u)};return e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center space-x-4 mb-6",children:e.jsxs(xe,{to:"/admin",className:"flex items-center text-blue-600 hover:text-blue-800",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"管理者ダッシュボードに戻る"]})}),e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("h1",{className:"text-2xl font-bold flex items-center",children:[e.jsx(le,{className:"w-8 h-8 text-red-600 mr-3"}),"管理者審査ページ"]})}),C&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 rounded-lg flex items-start",children:[e.jsx(W,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsx("p",{className:"text-red-800",children:C})]}),y&&e.jsxs("div",{className:"mb-6 p-4 bg-green-50 rounded-lg flex items-start",children:[e.jsx(V,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsx("p",{className:"text-green-800",children:y})]}),!x&&e.jsxs(E,{className:"p-4 bg-red-50 border-l-4 border-red-500",children:[e.jsx("h3",{className:"font-semibold mb-3 text-red-900",children:"❌ 管理者権限が必要です"}),e.jsxs("div",{className:"text-sm text-red-800 space-y-2",children:[e.jsx("p",{children:e.jsx("strong",{children:"ユーザー情報:"})}),e.jsxs("p",{children:["• Email: ",p?.email||"なし"]}),e.jsxs("p",{children:["• User Type: ",_?.user_type||"undefined"]}),e.jsxs("p",{children:["• Is Admin: ",x?"true":"false"]}),p?.email==="capasjapan@gmail.com"&&e.jsxs("div",{className:"mt-4 space-x-2",children:[e.jsx(h,{size:"sm",onClick:async()=>{t();try{const u=await ie(p.email||"");u.success?(o("管理者権限を設定しました。ページを再読み込みします..."),setTimeout(()=>window.location.reload(),1500)):l(`管理者権限の設定に失敗: ${u.error}`)}catch(u){l(`エラーが発生しました: ${u.message}`)}},className:"bg-blue-600 hover:bg-blue-700",children:"管理者権限を設定"}),e.jsx(h,{size:"sm",onClick:async()=>{if(t(),!p?.id){l("ユーザーIDが見つかりません");return}try{const u=await be(p.id);u.success?(o("プロファイルを更新しました。ページを再読み込みします..."),setTimeout(()=>window.location.reload(),1500)):l(`プロファイル更新に失敗: ${u.error}`)}catch(u){l(`エラーが発生しました: ${u.message}`)}},className:"bg-orange-600 hover:bg-orange-700",children:"直接更新"})]})]})]}),x&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex space-x-4 border-b",children:[e.jsxs("button",{className:`px-4 py-2 font-medium ${a==="parks"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,onClick:()=>k("parks"),children:[e.jsx(Q,{className:"w-4 h-4 inline mr-2"}),"ドッグラン審査"]}),e.jsxs("button",{className:`px-4 py-2 font-medium ${a==="vaccines"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,onClick:()=>k("vaccines"),children:[e.jsx(Y,{className:"w-4 h-4 inline mr-2"}),"ワクチン証明書審査"]})]}),e.jsxs("div",{className:"mt-6",children:[a==="parks"&&e.jsx(pe,{pendingParks:m.pendingParks,isLoading:m.isLoading,onApprovalComplete:i,onError:f}),a==="vaccines"&&e.jsx(fe,{pendingVaccines:m.pendingVaccines,isLoading:m.isLoading,onApprovalComplete:i,onError:f})]})]})]})}export{we as AdminManagement};

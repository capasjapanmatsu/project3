import{j as e,X as q,V as J,aJ as B,g as V,p as K,a as le,d as ee,A as W,c as se,F as re,b as Q,t as ce,a0 as de,aK as Y,R as ae,aL as te}from"./ui-vendor-FlUr4cJt.js";import{r as v,u as me,L as xe}from"./react-vendor-_GyjDmDn.js";import{s as g,C as E,B as h,x as H,l as $,y as X,u as ge}from"./index-BSYT0262.js";import{u as he,a as ue}from"./useAdminData-BwucJWVJ.js";import"./supabase-vendor-Df9iqQzW.js";const ne=()=>{const[p,x]=v.useState(!1),_=async(m,o,l)=>{try{x(!0),console.log("Processing vaccine approval:",{vaccineId:m,approved:o});const{data:t,error:i}=await g.from("vaccine_certifications").select("*, dog:dogs(name, owner_id)").eq("id",m).single();if(i)throw console.error("Vaccine data fetch error:",i),i;const f=t,u={status:o?"approved":"rejected"};o&&(u.approved_at=new Date().toISOString()),console.log("Updating vaccine with data:",u);const{error:S}=await g.from("vaccine_certifications").update(u).eq("id",m);if(S)throw console.error("Vaccine update error:",S),console.error("Error details:",{message:S.message,code:S.code,details:S.details,hint:S.hint}),new Error(`ãƒ¯ã‚¯ãƒãƒ³è¨¼æ˜Žæ›¸ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: ${S.message}`);const z=f.rabies_vaccine_image,O=f.combo_vaccine_image;return(z?.includes("/temp/")||O?.includes("/temp/"))&&await C(f),await b(f,o,l),{success:!0,message:`ãƒ¯ã‚¯ãƒãƒ³è¨¼æ˜Žæ›¸ã‚’${o?"æ‰¿èª":"å´ä¸‹"}ã—ã¾ã—ãŸ`}}catch(t){return console.error("Vaccine approval error:",t),{success:!1,message:`æ‰¿èªå‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ: ${t.message}`}}finally{x(!1)}},n=async(m,o,l)=>{try{x(!0);const i={status:o?"approved":"rejected"};o&&(i.approved_at=new Date().toISOString());const{error:f}=await g.from("dog_parks").update(i).eq("id",m);if(f)throw f;return await y(m,o,l),await D(m,o,l),{success:!0,message:`æ–½è¨­ã‚’${o?"æ‰¿èª":"å´ä¸‹"}ã—ã¾ã—ãŸ`}}catch(t){return console.error("Park approval error:",t),{success:!1,message:"æ‰¿èªå‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ"}}finally{x(!1)}},a=async(m,o,l)=>{try{x(!0);const t={is_approved:o};!o&&l?.trim()?t.admin_notes=l.trim():t.admin_notes=null;const{error:i}=await g.from("dog_park_facility_images").update(t).eq("id",m.id);if(i)throw i;return{success:!0,message:`ç”»åƒã‚’${o?"æ‰¿èª":"å´ä¸‹"}ã—ã¾ã—ãŸ`}}catch(t){return console.error("Image approval error:",t),{success:!1,message:"ç”»åƒã®æ‰¿èªå‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ"}}finally{x(!1)}},k=async(m,o,l)=>{try{x(!0);const t={};o!==void 0&&(t.rabies_expiry_date=o),l!==void 0&&(t.combo_expiry_date=l),console.log("Updating vaccine expiry dates:",t);const{error:i}=await g.from("vaccine_certifications").update(t).eq("id",m);if(i)throw console.error("Vaccine expiry update error:",i),new Error(`æœ‰åŠ¹æœŸé™ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: ${i.message}`);return{success:!0,message:"æœ‰åŠ¹æœŸé™ã‚’æ›´æ–°ã—ã¾ã—ãŸ"}}catch(t){return console.error("Vaccine expiry update error:",t),{success:!1,message:`æœ‰åŠ¹æœŸé™ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: ${t.message}`}}finally{x(!1)}},C=async m=>{console.log("Deleting temporary vaccine images..."),console.log("Vaccine data:",{rabies_vaccine_image:m.rabies_vaccine_image,combo_vaccine_image:m.combo_vaccine_image});const o=[];if(m.rabies_vaccine_image){let l="";if(m.rabies_vaccine_image.includes("/temp/")){const t=m.rabies_vaccine_image.match(/temp\/[^\/]+\/[^\/\?]+/);t&&(l=t[0])}l&&o.push(l)}if(m.combo_vaccine_image){let l="";if(m.combo_vaccine_image.includes("/temp/")){const t=m.combo_vaccine_image.match(/temp\/[^\/]+\/[^\/\?]+/);t&&(l=t[0])}l&&o.push(l)}if(console.log("Paths to delete:",o),o.length>0)try{const{error:l}=await g.storage.from("vaccine-certs").remove(o);l?console.error("Error deleting images:",l):console.log("Successfully deleted images:",o)}catch(l){console.error("Error deleting images:",l)}else console.log("No temporary images to delete");console.log("Temporary images deletion completed")},b=async(m,o,l)=>{const{error:t}=await g.from("notifications").insert([{user_id:m.dog.owner_id,type:"vaccine_approval_required",title:o?"ãƒ¯ã‚¯ãƒãƒ³è¨¼æ˜Žæ›¸æ‰¿èªã®ãŠçŸ¥ã‚‰ã›":"ãƒ¯ã‚¯ãƒãƒ³è¨¼æ˜Žæ›¸å´ä¸‹ã®ãŠçŸ¥ã‚‰ã›",message:o?`${m.dog.name}ã¡ã‚ƒã‚“ã®ãƒ¯ã‚¯ãƒãƒ³è¨¼æ˜Žæ›¸ãŒæ‰¿èªã•ã‚Œã¾ã—ãŸã€‚ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã‚’åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚`:`${m.dog.name}ã¡ã‚ƒã‚“ã®ãƒ¯ã‚¯ãƒãƒ³è¨¼æ˜Žæ›¸ãŒå´ä¸‹ã•ã‚Œã¾ã—ãŸã€‚${l?`ç†ç”±: ${l}`:"è©³ç´°ã¯ãƒžã‚¤ãƒšãƒ¼ã‚¸ã‚’ã”ç¢ºèªãã ã•ã„ã€‚"}`,data:{dog_id:m.dog_id}}]);if(t)throw console.error("Notification error:",t),console.error("Notification error details:",{message:t.message,code:t.code,details:t.details,hint:t.hint}),new Error(`é€šçŸ¥ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ: ${t.message}`)},y=async(m,o,l)=>{let t={};const{data:i,error:f}=await g.from("dog_park_review_stages").select("id").eq("park_id",m).maybeSingle();if(f)throw f;if(i){o?t.first_stage_passed_at=new Date().toISOString():(t.rejected_at=new Date().toISOString(),l?.trim()&&(t.rejection_reason=l.trim()));const{error:u}=await g.from("dog_park_review_stages").update(t).eq("park_id",m);if(u)throw u}else{t={park_id:m,first_stage_passed_at:new Date().toISOString()},o?t.first_stage_passed_at=new Date().toISOString():(t.rejected_at=new Date().toISOString(),l?.trim()&&(t.rejection_reason=l.trim()));const{error:u}=await g.from("dog_park_review_stages").insert([t]);if(u)throw u}},D=async(m,o,l)=>{const{data:t,error:i}=await g.from("dog_parks").select("id, name, owner_id").eq("id",m).single();if(i)throw i;const{error:f}=await g.from("notifications").insert([{user_id:t.owner_id,type:"park_approval_required",title:o?"æ–½è¨­æ‰¿èªã®ãŠçŸ¥ã‚‰ã›":"å¯©æŸ»çµæžœã®ãŠçŸ¥ã‚‰ã›",message:o?`${t.name}ã®å¯©æŸ»ãŒå®Œäº†ã—ã€æ‰¿èªã•ã‚Œã¾ã—ãŸã€‚ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼`:`${t.name}ã®å¯©æŸ»çµæžœã‚’ãŠçŸ¥ã‚‰ã›ã—ã¾ã™ã€‚${l?`ç†ç”±: ${l}`:"è©³ç´°ã¯ã‚ªãƒ¼ãƒŠãƒ¼ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’ã”ç¢ºèªãã ã•ã„ã€‚"}`,data:{park_id:t.id}}]);if(f)throw console.error("Park notification error:",f),console.error("Park notification error details:",{message:f.message,code:f.code,details:f.details,hint:f.hint}),new Error(`æ–½è¨­é€šçŸ¥ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ: ${f.message}`)};return{isProcessing:p,handleVaccineApproval:_,handleParkApproval:n,handleImageApproval:a,handleVaccineExpiryUpdate:k}},pe=({pendingParks:p,isLoading:x,onApprovalComplete:_,onError:n})=>{console.log("ðŸ” AdminParkApproval received parks:",p),p.forEach((r,d)=>{console.log(`ðŸžï¸ Park ${d+1}:`,{id:r.id,name:r.name,owner_id:r.owner_id,owner_name:r.owner_name,owner_address:r.owner_address,owner_postal_code:r.owner_postal_code,owner_phone_number:r.owner_phone_number,owner_email:r.owner_email})});const[a,k]=v.useState(null),[C,b]=v.useState(""),[y,D]=v.useState(null),[m,o]=v.useState(!1),[l,t]=v.useState(null),[i,f]=v.useState(null),[u,S]=v.useState(null),[z,O]=v.useState(!1),P=ne(),I=he(a?.id||null);v.useEffect(()=>{(async()=>{console.log("ðŸ” Debugging owner_verifications table...");try{const{data:d,error:s}=await g.from("owner_verifications").select("*").order("created_at",{ascending:!1});if(s)console.error("âŒ Error fetching owner_verifications:",s);else{console.log("âœ… Owner verifications data:",d);const A=d?.filter(j=>j.verification_id&&j.verification_id.includes("identity_"));console.log("ðŸ“„ Identity files found:",A),d?.forEach(j=>{console.log(`ðŸ” Verification item ${j.id}:`,{user_id:j.user_id,verification_id:j.verification_id,status:j.status,verification_data:j.verification_data})})}}catch(d){console.error("âŒ Debug query failed:",d)}})()},[]),v.useEffect(()=>{a?.owner_id&&R(a.owner_id)},[a]);const R=async r=>{try{O(!0),S(null),console.log("ðŸ” æœ¬äººç¢ºèªæ›¸é¡žãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­:",r);const{data:d,error:s}=await g.from("profiles").select("name, postal_code, address, phone_number, email").eq("id",r).single();if(s){console.error("âŒ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—ã‚¨ãƒ©ãƒ¼:",s),S(`ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ${s.message}`);return}console.log("âœ… ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±:",d);const{data:A,error:j}=await g.from("owner_verifications").select("*").eq("user_id",r).order("created_at",{ascending:!1}).limit(1);if(j&&(console.error("âŒ æœ¬äººç¢ºèªæ›¸é¡žå–å¾—ã‚¨ãƒ©ãƒ¼:",j),console.log("âš ï¸ æœ¬äººç¢ºèªæ›¸é¡žãŒãªã„ãŸã‚ã€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±ã®ã¿è¡¨ç¤º")),console.log("ðŸ“Š æœ¬äººç¢ºèªæ›¸é¡žãƒ‡ãƒ¼ã‚¿:",A),A&&A.length>0){const N=A[0];console.log("ðŸ“‹ æœ¬äººç¢ºèªæ›¸é¡žè©³ç´°:",N),console.log("ðŸ” verification_data:",N.verification_data);let L="",c="";N.verification_data&&typeof N.verification_data=="object"&&(L=N.verification_data.document_url||N.verification_data.file_path||"",c=N.verification_data.file_name||N.verification_data.filename||""),!L&&N.verification_id&&(L=N.verification_id),c||(c=L.split("/").pop()||"identity_document"),console.log("ðŸ“„ æœ€çµ‚çš„ãªç”»åƒURL:",L),console.log("ðŸ“„ ãƒ•ã‚¡ã‚¤ãƒ«å:",c),f({id:N.id,owner_name:d.name||"åå‰æœªç™»éŒ²",postal_code:d.postal_code||"æœªç™»éŒ²",address:d.address||"æœªç™»éŒ²",phone_number:d.phone_number||"æœªç™»éŒ²",email:d.email||"æœªç™»éŒ²",identity_document_url:L,identity_document_filename:c,identity_status:N.status||"pending",identity_created_at:N.created_at||new Date().toISOString()})}else console.log("ðŸ“‹ æœ¬äººç¢ºèªæ›¸é¡žæœªæå‡ºã®ãŸã‚ã€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±ã®ã¿è¡¨ç¤º"),f({id:"",owner_name:d.name||"åå‰æœªç™»éŒ²",postal_code:d.postal_code||"æœªç™»éŒ²",address:d.address||"æœªç™»éŒ²",phone_number:d.phone_number||"æœªç™»éŒ²",email:d.email||"æœªç™»éŒ²",identity_document_url:"",identity_document_filename:"",identity_status:"not_submitted",identity_created_at:""})}catch(d){console.error("âŒ æœ¬äººç¢ºèªæ›¸é¡žãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:",d),S(`ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ${d}`)}finally{O(!1)}},F=async(r,d)=>{try{if(console.log(`${d?"âœ…":"âŒ"} ãƒ‰ãƒƒã‚°ãƒ©ãƒ³${d?"æ‰¿èª":"å´ä¸‹"}ä¸­:`,r),d&&I.parkImages.filter(j=>j.is_approved===null||j.is_approved===!1).length>0){n("ã™ã¹ã¦ã®ç”»åƒã‚’æ‰¿èªã—ã¦ã‹ã‚‰æ–½è¨­ã‚’æ‰¿èªã—ã¦ãã ã•ã„");return}const s=await P.handleParkApproval(r,d,C);s.success?(_(s.message),k(null),b("")):n(s.message)}catch(s){console.error("âŒ ãƒ‰ãƒƒã‚°ãƒ©ãƒ³æ‰¿èª/å´ä¸‹ã‚¨ãƒ©ãƒ¼:",s),n(`å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${s.message}`)}},G=r=>{D(r),o(!0),b(r.admin_notes||"")},M=async r=>{if(y)try{const d=await P.handleImageApproval(y,r,C);d.success?(_(d.message),await I.fetchParkImages(a.id),o(!1),D(null),b("")):n(d.message)}catch(d){console.error("âŒ ç”»åƒæ‰¿èªã‚¨ãƒ©ãƒ¼:",d),n(`å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${d.message}`)}},Z=async r=>{if(window.confirm("ã“ã®ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ç”³è«‹ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚"))try{console.log("ðŸ—‘ï¸ é–¢é€£ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤ä¸­...");try{const{error:s}=await g.from("news_announcements").delete().eq("park_id",r);if(s){console.error("âŒ ãƒ‹ãƒ¥ãƒ¼ã‚¹å‰Šé™¤ã‚¨ãƒ©ãƒ¼:",s),n(`ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ${s.message}`);return}console.log("âœ… ãƒ‹ãƒ¥ãƒ¼ã‚¹å‰Šé™¤å®Œäº†")}catch(s){console.error("âŒ ãƒ‹ãƒ¥ãƒ¼ã‚¹å‰Šé™¤å‡¦ç†ã‚¨ãƒ©ãƒ¼:",s),n("ãƒ‹ãƒ¥ãƒ¼ã‚¹å‰Šé™¤å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");return}try{const{error:s}=await g.from("new_park_openings").delete().eq("park_id",r);if(s){console.error("âŒ æ–°è¦é–‹åœ’æƒ…å ±å‰Šé™¤ã‚¨ãƒ©ãƒ¼:",s),n(`æ–°è¦é–‹åœ’æƒ…å ±ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ${s.message}`);return}console.log("âœ… æ–°è¦é–‹åœ’æƒ…å ±å‰Šé™¤å®Œäº†")}catch(s){console.error("âŒ æ–°è¦é–‹åœ’æƒ…å ±å‰Šé™¤å‡¦ç†ã‚¨ãƒ©ãƒ¼:",s),n("æ–°è¦é–‹åœ’æƒ…å ±å‰Šé™¤å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");return}try{const{data:s}=await g.from("smart_locks").select("lock_id").eq("park_id",r);if(s&&s.length>0){const A=s.map(N=>N.lock_id),{error:j}=await g.from("lock_access_logs").delete().in("lock_id",A);if(j){console.error("âŒ ãƒ­ãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°å‰Šé™¤ã‚¨ãƒ©ãƒ¼:",j),n(`ãƒ­ãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ${j.message}`);return}}console.log("âœ… ãƒ­ãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°å‰Šé™¤å®Œäº†")}catch(s){console.error("âŒ ãƒ­ãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°å‰Šé™¤å‡¦ç†ã‚¨ãƒ©ãƒ¼:",s),n("ãƒ­ãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°å‰Šé™¤å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");return}try{const{error:s}=await g.from("smart_locks").delete().eq("park_id",r);if(s){console.error("âŒ ã‚¹ãƒžãƒ¼ãƒˆãƒ­ãƒƒã‚¯å‰Šé™¤ã‚¨ãƒ©ãƒ¼:",s),n(`ã‚¹ãƒžãƒ¼ãƒˆãƒ­ãƒƒã‚¯ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ${s.message}`);return}console.log("âœ… ã‚¹ãƒžãƒ¼ãƒˆãƒ­ãƒƒã‚¯å‰Šé™¤å®Œäº†")}catch(s){console.error("âŒ ã‚¹ãƒžãƒ¼ãƒˆãƒ­ãƒƒã‚¯å‰Šé™¤å‡¦ç†ã‚¨ãƒ©ãƒ¼:",s),n("ã‚¹ãƒžãƒ¼ãƒˆãƒ­ãƒƒã‚¯å‰Šé™¤å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");return}try{const{error:s}=await g.from("user_entry_status").delete().eq("park_id",r);if(s){console.error("âŒ ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å‰Šé™¤ã‚¨ãƒ©ãƒ¼:",s),n(`ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ${s.message}`);return}console.log("âœ… ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å‰Šé™¤å®Œäº†")}catch(s){console.error("âŒ ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å‰Šé™¤å‡¦ç†ã‚¨ãƒ©ãƒ¼:",s),n("ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å‰Šé™¤å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");return}try{const{error:s}=await g.from("reservations").delete().eq("park_id",r);if(s){console.error("âŒ äºˆç´„å‰Šé™¤ã‚¨ãƒ©ãƒ¼:",s),n(`äºˆç´„ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ${s.message}`);return}console.log("âœ… äºˆç´„å‰Šé™¤å®Œäº†")}catch(s){console.error("âŒ äºˆç´„å‰Šé™¤å‡¦ç†ã‚¨ãƒ©ãƒ¼:",s),n("äºˆç´„å‰Šé™¤å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");return}try{const{error:s}=await g.from("dog_encounters").delete().eq("park_id",r);if(s){console.error("âŒ å‡ºä¼šã„è¨˜éŒ²å‰Šé™¤ã‚¨ãƒ©ãƒ¼:",s),n(`å‡ºä¼šã„è¨˜éŒ²ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ${s.message}`);return}console.log("âœ… å‡ºä¼šã„è¨˜éŒ²å‰Šé™¤å®Œäº†")}catch(s){console.error("âŒ å‡ºä¼šã„è¨˜éŒ²å‰Šé™¤å‡¦ç†ã‚¨ãƒ©ãƒ¼:",s),n("å‡ºä¼šã„è¨˜éŒ²å‰Šé™¤å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");return}try{const{data:s}=await g.from("dog_park_reviews").select("id").eq("park_id",r);if(s&&s.length>0){const A=s.map(N=>N.id),{error:j}=await g.from("dog_park_review_images").delete().in("review_id",A);if(j){console.error("âŒ ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒå‰Šé™¤ã‚¨ãƒ©ãƒ¼:",j),n(`ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ${j.message}`);return}}console.log("âœ… ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒå‰Šé™¤å®Œäº†")}catch(s){console.error("âŒ ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒå‰Šé™¤å‡¦ç†ã‚¨ãƒ©ãƒ¼:",s),n("ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒå‰Šé™¤å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");return}try{const{error:s}=await g.from("dog_park_reviews").delete().eq("park_id",r);if(s){console.error("âŒ ãƒ¬ãƒ“ãƒ¥ãƒ¼å‰Šé™¤ã‚¨ãƒ©ãƒ¼:",s),n(`ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ${s.message}`);return}console.log("âœ… ãƒ¬ãƒ“ãƒ¥ãƒ¼å‰Šé™¤å®Œäº†")}catch(s){console.error("âŒ ãƒ¬ãƒ“ãƒ¥ãƒ¼å‰Šé™¤å‡¦ç†ã‚¨ãƒ©ãƒ¼:",s),n("ãƒ¬ãƒ“ãƒ¥ãƒ¼å‰Šé™¤å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");return}try{const{error:s}=await g.from("dog_park_facility_images").delete().eq("park_id",r);if(s){console.error("âŒ æ–½è¨­ç”»åƒå‰Šé™¤ã‚¨ãƒ©ãƒ¼:",s),n(`æ–½è¨­ç”»åƒã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ${s.message}`);return}console.log("âœ… æ–½è¨­ç”»åƒå‰Šé™¤å®Œäº†")}catch(s){console.error("âŒ æ–½è¨­ç”»åƒå‰Šé™¤å‡¦ç†ã‚¨ãƒ©ãƒ¼:",s),n("æ–½è¨­ç”»åƒå‰Šé™¤å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");return}try{const{error:s}=await g.from("dog_park_images").delete().eq("park_id",r);if(s){console.error("âŒ ãƒ‘ãƒ¼ã‚¯ç”»åƒå‰Šé™¤ã‚¨ãƒ©ãƒ¼:",s),n(`ãƒ‘ãƒ¼ã‚¯ç”»åƒã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ${s.message}`);return}console.log("âœ… ãƒ‘ãƒ¼ã‚¯ç”»åƒå‰Šé™¤å®Œäº†")}catch(s){console.error("âŒ ãƒ‘ãƒ¼ã‚¯ç”»åƒå‰Šé™¤å‡¦ç†ã‚¨ãƒ©ãƒ¼:",s),n("ãƒ‘ãƒ¼ã‚¯ç”»åƒå‰Šé™¤å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");return}try{const{error:s}=await g.from("dog_park_review_stages").delete().eq("park_id",r);if(s){console.error("âŒ ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¸å‰Šé™¤ã‚¨ãƒ©ãƒ¼:",s),n(`ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¸ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ${s.message}`);return}console.log("âœ… ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¸å‰Šé™¤å®Œäº†")}catch(s){console.error("âŒ ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¸å‰Šé™¤å‡¦ç†ã‚¨ãƒ©ãƒ¼:",s),n("ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¹ãƒ†ãƒ¼ã‚¸å‰Šé™¤å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");return}try{const{error:s}=await g.from("dog_parks").delete().eq("id",r);if(s){console.error("âŒ ãƒ‰ãƒƒã‚°ãƒ©ãƒ³å‰Šé™¤ã‚¨ãƒ©ãƒ¼:",s),n(`ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ${s.message}`);return}console.log("âœ… ãƒ‰ãƒƒã‚°ãƒ©ãƒ³æœ¬ä½“å‰Šé™¤å®Œäº†")}catch(s){console.error("âŒ ãƒ‰ãƒƒã‚°ãƒ©ãƒ³å‰Šé™¤å‡¦ç†ã‚¨ãƒ©ãƒ¼:",s),n("ãƒ‰ãƒƒã‚°ãƒ©ãƒ³å‰Šé™¤å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");return}console.log("âœ… ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã¨é–¢é€£ãƒ‡ãƒ¼ã‚¿ã®å‰Šé™¤å®Œäº†"),_("ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ç”³è«‹ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚"),k(null)}catch(s){console.error("âŒ ãƒ‰ãƒƒã‚°ãƒ©ãƒ³å‰Šé™¤ã‚¨ãƒ©ãƒ¼:",s),n("ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}},T=r=>({overview:"æ–½è¨­å…¨æ™¯",entrance:"å…¥å£",large_dog_area:"å¤§åž‹çŠ¬ã‚¨ãƒªã‚¢",small_dog_area:"å°åž‹çŠ¬ã‚¨ãƒªã‚¢",private_booth:"ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ–ãƒ¼ã‚¹",parking:"é§è»Šå ´",shower:"ã‚·ãƒ£ãƒ¯ãƒ¼è¨­å‚™",restroom:"ãƒˆã‚¤ãƒ¬",agility:"ã‚¢ã‚¸ãƒªãƒ†ã‚£è¨­å‚™",rest_area:"ä¼‘æ†©ã‚¹ãƒšãƒ¼ã‚¹",water_station:"çµ¦æ°´è¨­å‚™",exterior:"å¤–è¦³",interior:"å†…è£…",equipment:"è¨­å‚™",area:"ã‚¨ãƒªã‚¢",other:"ãã®ä»–"})[r]||r;return x?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):l?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"relative max-w-6xl w-full max-h-[90vh]",children:[e.jsx("button",{onClick:()=>t(null),className:"absolute top-4 right-4 p-2 bg-white bg-opacity-90 shadow-lg rounded-full text-gray-800 hover:bg-opacity-100 transition-all z-10",children:e.jsx(q,{className:"w-6 h-6"})}),e.jsx("img",{src:l,alt:"æ‹¡å¤§ç”»åƒ",className:"max-w-full max-h-full mx-auto rounded-lg object-contain",onError:r=>{r.currentTarget.src="https://via.placeholder.com/800x600?text=Image+Not+Available"}})]})}):m&&y?e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center space-x-4 mb-6",children:e.jsxs("button",{onClick:()=>{o(!1),D(null),b("")},className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"ç”»åƒä¸€è¦§ã«æˆ»ã‚‹"]})}),e.jsxs(E,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold",children:["ç”»åƒãƒ¬ãƒ“ãƒ¥ãƒ¼: ",T(y.image_type)]}),e.jsx("div",{className:"flex space-x-2",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${y.is_approved===!0?"bg-green-100 text-green-800":y.is_approved===!1?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:y.is_approved===!0?"æ‰¿èªæ¸ˆã¿":y.is_approved===!1?"å´ä¸‹":"å¯©æŸ»å¾…ã¡"})})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"w-full h-96 bg-gray-100 rounded-lg overflow-hidden relative group",children:[e.jsx("img",{src:y.image_url,alt:T(y.image_type),className:"w-full h-full object-contain cursor-pointer",onClick:()=>t(y.image_url),onError:r=>{r.currentTarget.src="https://via.placeholder.com/800x600?text=Image+Not+Available"}}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-200 flex items-center justify-center cursor-pointer",onClick:()=>t(y.image_url),children:e.jsx(B,{className:"w-12 h-12 text-white opacity-0 group-hover:opacity-100 transition-opacity duration-200"})}),e.jsx("div",{className:"absolute bottom-4 right-4",children:e.jsx("span",{className:"px-2 py-1 bg-white bg-opacity-90 text-gray-800 text-xs rounded border shadow-sm",children:"ã‚¯ãƒªãƒƒã‚¯ã§æ‹¡å¤§"})})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"å´ä¸‹ç†ç”±ï¼ˆå´ä¸‹ã™ã‚‹å ´åˆã®ã¿å…¥åŠ›ï¼‰"}),e.jsx("textarea",{value:C,onChange:r=>b(r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,placeholder:"ä¾‹: ç”»åƒãŒä¸é®®æ˜Žã§ã™ã€‚ã‚ˆã‚Šæ˜Žã‚‹ãé®®æ˜Žãªç”»åƒã‚’å†ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚"})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(h,{variant:"secondary",onClick:()=>{o(!1),D(null),b("")},children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),e.jsxs(h,{onClick:()=>void M(!1),isLoading:P.isProcessing,className:"bg-red-600 hover:bg-red-700",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"å´ä¸‹"]}),e.jsxs(h,{onClick:()=>void M(!0),isLoading:P.isProcessing,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"æ‰¿èª"]})]})]})]}):m&&y?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"ç”»åƒå¯©æŸ»"}),e.jsxs(h,{variant:"secondary",onClick:()=>{o(!1),D(null),b("")},children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"æˆ»ã‚‹"]})]}),e.jsxs(E,{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"font-semibold mb-2",children:["ç”»åƒã‚¿ã‚¤ãƒ—: ",T(y.image_type)]}),e.jsxs("div",{className:"relative w-full h-96 bg-gray-100 rounded-lg overflow-hidden group",children:[e.jsx("img",{src:y.image_url,alt:T(y.image_type),className:"w-full h-full object-contain cursor-pointer",onClick:()=>t(y.image_url),onError:r=>{r.currentTarget.src="https://via.placeholder.com/800x600?text=Image+Not+Available"}}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-200 flex items-center justify-center cursor-pointer",onClick:()=>t(y.image_url),children:e.jsx(B,{className:"w-12 h-12 text-white opacity-0 group-hover:opacity-100 transition-opacity duration-200"})}),e.jsx("div",{className:"absolute bottom-4 right-4",children:e.jsx("span",{className:"px-2 py-1 bg-white bg-opacity-90 text-gray-800 text-xs rounded border shadow-sm",children:"ã‚¯ãƒªãƒƒã‚¯ã§æ‹¡å¤§"})})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"å´ä¸‹ç†ç”±ï¼ˆå´ä¸‹ã™ã‚‹å ´åˆã®ã¿å…¥åŠ›ï¼‰"}),e.jsx("textarea",{value:C,onChange:r=>b(r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,placeholder:"ä¾‹: ç”»åƒãŒä¸é®®æ˜Žã§ã™ã€‚ã‚ˆã‚Šæ˜Žã‚‹ãé®®æ˜Žãªç”»åƒã‚’å†ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚"})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(h,{variant:"secondary",onClick:()=>{o(!1),D(null),b("")},children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),e.jsxs(h,{onClick:()=>void M(!1),isLoading:P.isProcessing,className:"bg-red-600 hover:bg-red-700",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"å´ä¸‹"]}),e.jsxs(h,{onClick:()=>void M(!0),isLoading:P.isProcessing,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"æ‰¿èª"]})]})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:e.jsxs("div",{className:"relative max-w-4xl max-h-full p-4",children:[e.jsx("img",{src:l.startsWith("http")?l:`${g.storage.from("vaccine-certs").getPublicUrl(l).data.publicUrl}`,alt:"æ‹¡å¤§ç”»åƒ",className:"max-w-full max-h-full object-contain"}),e.jsx(h,{onClick:()=>t(null),className:"absolute top-2 right-2 bg-white text-black hover:bg-gray-100",children:e.jsx(q,{className:"w-4 h-4"})})]})})]}):a?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[e.jsx(K,{className:"w-6 h-6 text-blue-600 mr-2"}),a.name,"ã®å¯©æŸ»"]}),e.jsxs(h,{variant:"secondary",onClick:()=>k(null),children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"ä¸€è¦§ã«æˆ»ã‚‹"]})]}),e.jsxs(E,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center",children:[e.jsx(K,{className:"w-5 h-5 mr-2"}),"æ–½è¨­æƒ…å ±"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"æ–½è¨­å"}),e.jsx("p",{className:"font-medium",children:a.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"ä½æ‰€"}),e.jsx("p",{className:"font-medium",children:a.address})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"ã‚ªãƒ¼ãƒŠãƒ¼"}),e.jsx("p",{className:"font-medium",children:a.owner_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"ç”³è«‹æ—¥"}),e.jsx("p",{className:"font-medium",children:new Date(a.created_at).toLocaleDateString("ja-JP")})]})]})]}),e.jsxs(E,{className:"p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center",children:[e.jsx(le,{className:"w-5 h-5 mr-2"}),"æœ¬äººç¢ºèªæ›¸é¡žãƒ»ç™»éŒ²æƒ…å ±"]}),z?e.jsxs("div",{className:"flex justify-center items-center h-32",children:[e.jsx(ee,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­..."})]}):u?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(W,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-red-600 mb-2",children:u}),e.jsx(h,{variant:"secondary",onClick:()=>a&&R(a.owner_id),children:"å†èª­ã¿è¾¼ã¿"})]}):i?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-3 flex items-center",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"ç™»éŒ²ä½æ‰€æƒ…å ±ï¼ˆç…§åˆç”¨ï¼‰"]}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"æ°å"}),e.jsx("p",{className:"font-medium text-blue-900",children:i.owner_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"éƒµä¾¿ç•ªå·"}),e.jsx("p",{className:"font-medium text-blue-900",children:i.postal_code})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"ä½æ‰€"}),e.jsx("p",{className:"font-medium text-blue-900",children:i.address})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"é›»è©±ç•ªå·"}),e.jsx("p",{className:"font-medium text-blue-900",children:i.phone_number})]})]})})]}),i.identity_document_url?e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-3 flex items-center",children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"æœ¬äººç¢ºèªæ›¸é¡ž"]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"ãƒ•ã‚¡ã‚¤ãƒ«å"}),e.jsx("p",{className:"font-medium",children:i.identity_document_filename})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ—¥"}),e.jsx("p",{className:"font-medium",children:new Date(i.identity_created_at).toLocaleDateString("ja-JP")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"å¯©æŸ»çŠ¶æ³"}),e.jsx("p",{className:`font-medium ${i.identity_status==="verified"?"text-green-600":i.identity_status==="failed"?"text-red-600":"text-yellow-600"}`,children:i.identity_status==="verified"?"æ‰¿èªæ¸ˆã¿":i.identity_status==="failed"?"å´ä¸‹":"å¯©æŸ»å¾…ã¡"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"æœ¬äººç¢ºèªæ›¸é¡žç”»åƒ"}),e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:`${g.storage.from("vaccine-certs").getPublicUrl(i.identity_document_url).data.publicUrl}`,alt:"æœ¬äººç¢ºèªæ›¸é¡ž",className:"max-w-full h-auto max-h-96 rounded-lg border shadow-sm cursor-pointer hover:shadow-md transition-shadow",onClick:()=>t(i.identity_document_url),onError:r=>{console.error("âŒ ç”»åƒã®èª­ã¿è¾¼ã¿ã«å¤±æ•—:",i.identity_document_url),r.currentTarget.src="https://via.placeholder.com/400x300?text=Image+Not+Available"}}),e.jsx("div",{className:"absolute bottom-2 right-2",children:e.jsx("span",{className:"px-2 py-1 bg-white bg-opacity-90 text-gray-800 text-xs rounded border shadow-sm",children:"ã‚¯ãƒªãƒƒã‚¯ã§æ‹¡å¤§"})})]})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(W,{className:"w-5 h-5 text-yellow-600 mr-2 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"ç…§åˆãƒã‚§ãƒƒã‚¯"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"æœ¬äººç¢ºèªæ›¸é¡žã«è¨˜è¼‰ã•ã‚ŒãŸä½æ‰€ãƒ»æ°åã¨ã€ä¸Šè¨˜ã®ç™»éŒ²æƒ…å ±ãŒä¸€è‡´ã™ã‚‹ã‹ã”ç¢ºèªãã ã•ã„ã€‚"})]})]})})]})]}):e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-3 flex items-center",children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"æœ¬äººç¢ºèªæ›¸é¡ž"]}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(W,{className:"w-5 h-5 text-red-600 mr-2 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:i.identity_status==="not_submitted"?"æœ¬äººç¢ºèªæ›¸é¡žãŒæœªæå‡ºã§ã™":"æœ¬äººç¢ºèªæ›¸é¡žã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:i.identity_status==="not_submitted"?"ã“ã®ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ç”³è«‹ã«ã¯æœ¬äººç¢ºèªæ›¸é¡žãŒæ·»ä»˜ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ç”³è«‹è€…ã«æœ¬äººç¢ºèªæ›¸é¡žã®æå‡ºã‚’ä¾é ¼ã—ã¦ãã ã•ã„ã€‚":"ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ã¾ãŸã¯ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®å•é¡ŒãŒç™ºç”Ÿã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚"})]})]})})]})]}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-600",children:"ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­..."})})]}),(a.status==="second_stage_review"||a.status==="first_stage_passed"||a.total_images>0)&&e.jsxs(E,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"æ–½è¨­ç”»åƒ"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-blue-50 p-3 rounded text-center",children:[e.jsx("p",{className:"font-medium text-blue-800",children:"å…¨ç”»åƒ"}),e.jsxs("p",{className:"text-blue-600",children:[a.total_images,"æžš"]})]}),e.jsxs("div",{className:"bg-yellow-50 p-3 rounded text-center",children:[e.jsx("p",{className:"font-medium text-yellow-800",children:"å¯©æŸ»å¾…ã¡"}),e.jsxs("p",{className:"text-yellow-600",children:[a.pending_images,"æžš"]})]}),e.jsxs("div",{className:"bg-green-50 p-3 rounded text-center",children:[e.jsx("p",{className:"font-medium text-green-800",children:"æ‰¿èªæ¸ˆã¿"}),e.jsxs("p",{className:"text-green-600",children:[a.approved_images,"æžš"]})]}),e.jsxs("div",{className:"bg-red-50 p-3 rounded text-center",children:[e.jsx("p",{className:"font-medium text-red-800",children:"å´ä¸‹"}),e.jsxs("p",{className:"text-red-600",children:[a.rejected_images,"æžš"]})]})]}),e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded text-sm",children:[e.jsx("p",{children:e.jsx("strong",{children:"ãƒ‡ãƒãƒƒã‚°æƒ…å ±:"})}),e.jsxs("p",{children:["Park ID: ",a.id]}),e.jsxs("p",{children:["Status: ",a.status]}),e.jsxs("p",{children:["Images Loading: ",I.isLoading?"Yes":"No"]}),e.jsxs("p",{children:["Images Count: ",I.parkImages.length]}),e.jsxs("p",{children:["Images Error: ",I.error||"None"]}),e.jsxs("p",{children:["Expected Total: ",a.total_images]}),e.jsxs("div",{className:"mt-2 flex space-x-2",children:[e.jsx(h,{size:"sm",variant:"secondary",onClick:()=>{console.log("ðŸ”„ Manual refresh triggered for park:",a.id),I.fetchParkImages(a.id)},children:"ç”»åƒå†å–å¾—"}),e.jsx(h,{size:"sm",variant:"secondary",onClick:async()=>{console.log("ðŸ—ƒï¸ Direct database query for park:",a.id);try{const{data:r,error:d}=await g.from("dog_park_facility_images").select("*").eq("park_id",a.id);d?console.error("âŒ Direct query error:",d):(console.log("ðŸ“‹ Direct query result:",r),alert("ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç›´æŽ¥ã‚¯ã‚¨ãƒªçµæžœã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ã—ã¾ã—ãŸ"))}catch(r){console.error("âŒ Direct query failed:",r)}},children:"DBç›´æŽ¥ç¢ºèª"})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{children:e.jsx("strong",{children:"Raw Images Data:"})}),e.jsx("pre",{className:"text-xs bg-white p-2 rounded border max-h-32 overflow-y-auto",children:JSON.stringify(I.parkImages,null,2)})]})]}),I.isLoading?e.jsxs("div",{className:"flex justify-center items-center h-32",children:[e.jsx(ee,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"ç”»åƒã‚’èª­ã¿è¾¼ã¿ä¸­..."})]}):I.error?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-red-600 mb-2",children:"ç”»åƒã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ"}),e.jsx("p",{className:"text-gray-500 text-sm",children:I.error}),e.jsx(h,{variant:"secondary",onClick:()=>void I.fetchParkImages(a.id),className:"mt-4",children:"å†èª­ã¿è¾¼ã¿"})]}):I.parkImages.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-600",children:"ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸç”»åƒãŒã‚ã‚Šã¾ã›ã‚“"}),e.jsxs("p",{className:"text-gray-500 text-sm",children:["ãƒ‘ãƒ¼ã‚¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ",a.status]}),e.jsxs("p",{className:"text-gray-500 text-sm",children:["æœŸå¾…ã•ã‚Œã‚‹ç”»åƒæ•°: ",a.total_images]}),e.jsx(h,{variant:"secondary",onClick:()=>{console.log("ðŸ”„ Manual refresh triggered for park:",a.id),I.fetchParkImages(a.id)},className:"mt-4",children:"æ‰‹å‹•ã§ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:I.parkImages.map((r,d)=>e.jsxs("div",{className:"relative group",children:[e.jsxs("div",{className:"relative overflow-hidden rounded-lg bg-gray-100",children:[e.jsx("img",{src:r.image_url,alt:T(r.image_type),className:"w-full h-48 object-cover cursor-pointer hover:scale-105 transition-transform duration-200",onClick:()=>G(r),onLoad:()=>console.log(`ðŸ–¼ï¸ Image ${d+1} loaded successfully:`,r.image_url),onError:s=>{console.error(`âŒ Image ${d+1} failed to load:`,r.image_url),s.currentTarget.src="https://via.placeholder.com/400x300?text=Image+Not+Available"}}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-200 flex items-center justify-center cursor-pointer",onClick:s=>{s.stopPropagation(),t(r.image_url)},children:e.jsx(B,{className:"w-8 h-8 text-white opacity-0 group-hover:opacity-100 transition-opacity duration-200"})})]}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${r.is_approved===!0?"bg-green-100 text-green-800":r.is_approved===!1?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:r.is_approved===!0?"æ‰¿èªæ¸ˆã¿":r.is_approved===!1?"å´ä¸‹":"å¯©æŸ»å¾…ã¡"})}),e.jsx("div",{className:"absolute bottom-2 left-2",children:e.jsx("span",{className:"px-2 py-1 bg-white bg-opacity-90 text-gray-800 text-xs rounded border shadow-sm",children:T(r.image_type)})}),r.is_approved===!1&&r.admin_notes&&e.jsxs("div",{className:"mt-2 p-2 bg-red-50 rounded text-sm",children:[e.jsx("p",{className:"text-red-800 font-medium",children:"å´ä¸‹ç†ç”±:"}),e.jsx("p",{className:"text-red-700",children:r.admin_notes})]})]},r.id))})]}),e.jsxs(E,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"å¯©æŸ»çµæžœ"}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"å¯©æŸ»ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:`w-4 h-4 rounded-full mr-2 ${i?.owner_name&&i.owner_name!=="åå‰æœªç™»éŒ²"?"bg-green-500":"bg-red-500"}`}),e.jsxs("span",{children:["ç™»éŒ²æ°å: ",i?.owner_name||"æœªç™»éŒ²"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:`w-4 h-4 rounded-full mr-2 ${i?.address&&i.address!=="æœªç™»éŒ²"?"bg-green-500":"bg-red-500"}`}),e.jsxs("span",{children:["ç™»éŒ²ä½æ‰€: ",i?.address||"æœªç™»éŒ²"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:`w-4 h-4 rounded-full mr-2 ${i?.phone_number&&i.phone_number!=="æœªç™»éŒ²"?"bg-green-500":"bg-red-500"}`}),e.jsxs("span",{children:["é›»è©±ç•ªå·: ",i?.phone_number||"æœªç™»éŒ²"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:`w-4 h-4 rounded-full mr-2 ${i?.identity_document_url?"bg-green-500":"bg-red-500"}`}),e.jsxs("span",{children:["æœ¬äººç¢ºèªæ›¸é¡ž: ",i?.identity_document_url?"æå‡ºæ¸ˆã¿":"æœªæå‡º"]})]}),i?.identity_document_url&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:`w-4 h-4 rounded-full mr-2 ${i.identity_status==="verified"?"bg-green-500":i.identity_status==="failed"?"bg-red-500":"bg-yellow-500"}`}),e.jsxs("span",{children:["æœ¬äººç¢ºèªçŠ¶æ³: ",i.identity_status==="verified"?"æ‰¿èªæ¸ˆã¿":i.identity_status==="failed"?"å´ä¸‹":"å¯©æŸ»å¾…ã¡"]})]})]})]})}),(!i?.identity_document_url||i.identity_status==="not_submitted")&&e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(W,{className:"w-5 h-5 text-yellow-600 mr-2 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"å¯©æŸ»åˆ¤æ–­ã®æŽ¨å¥¨äº‹é …"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"æœ¬äººç¢ºèªæ›¸é¡žãŒæœªæå‡ºã®ãŸã‚ã€ç”³è«‹ã‚’æ‰¿èªã™ã‚‹å‰ã«ç”³è«‹è€…ã«æœ¬äººç¢ºèªæ›¸é¡žã®æå‡ºã‚’ä¾é ¼ã™ã‚‹ã“ã¨ã‚’æŽ¨å¥¨ã—ã¾ã™ã€‚ ã¾ãŸã¯ã€ä¸å‚™ã¨ã—ã¦ä¸€æ™‚çš„ã«å´ä¸‹ã—ã€å¿…è¦æ›¸é¡žã®æå‡ºã‚’æ±‚ã‚ã¦ãã ã•ã„ã€‚"})]})]})})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"å´ä¸‹ç†ç”±ï¼ˆå´ä¸‹ã™ã‚‹å ´åˆã®ã¿å…¥åŠ›ï¼‰"}),e.jsx("textarea",{value:C,onChange:r=>b(r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,placeholder:"ä¾‹: æœ¬äººç¢ºèªæ›¸é¡žãŒæœªæå‡ºã®ãŸã‚ã€èº«å…ƒç¢ºèªãŒã§ãã¾ã›ã‚“ã€‚æœ¬äººç¢ºèªæ›¸é¡žï¼ˆé‹è»¢å…è¨±è¨¼ã€ãƒ‘ã‚¹ãƒãƒ¼ãƒˆã€ãƒžã‚¤ãƒŠãƒ³ãƒãƒ¼ã‚«ãƒ¼ãƒ‰ãªã©ï¼‰ã‚’æå‡ºã—ã¦ã‹ã‚‰å†åº¦ç”³è«‹ã—ã¦ãã ã•ã„ã€‚"})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsxs(h,{onClick:()=>void F(a.id,!1),isLoading:P.isProcessing,className:"bg-red-600 hover:bg-red-700",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"å´ä¸‹"]}),e.jsxs(h,{onClick:()=>void F(a.id,!0),isLoading:P.isProcessing,className:"bg-green-600 hover:bg-green-700",disabled:!i?.identity_document_url&&i?.identity_status==="not_submitted",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"æ‰¿èª"]}),e.jsxs(h,{onClick:()=>void Z(a.id),isLoading:P.isProcessing,className:"bg-red-600 hover:bg-red-700",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"å‰Šé™¤"]})]})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:e.jsxs("div",{className:"relative max-w-4xl max-h-full p-4",children:[e.jsx("img",{src:l.startsWith("http")?l:`${g.storage.from("vaccine-certs").getPublicUrl(l).data.publicUrl}`,alt:"æ‹¡å¤§ç”»åƒ",className:"max-w-full max-h-full object-contain"}),e.jsx(h,{onClick:()=>t(null),className:"absolute top-2 right-2 bg-white text-black hover:bg-gray-100",children:e.jsx(q,{className:"w-4 h-4"})})]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[e.jsx(Q,{className:"w-6 h-6 text-blue-600 mr-2"}),"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³å¯©æŸ»ç®¡ç†"]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["å¯©æŸ»å¾…ã¡: ",p.length,"ä»¶"]})]}),e.jsx(E,{className:"bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-3",children:"å¯©æŸ»ãƒ—ãƒ­ã‚»ã‚¹æ¦‚è¦"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-yellow-600 text-white rounded-full flex items-center justify-center text-sm font-bold mx-auto mb-2",children:"1"}),e.jsx("div",{className:"text-sm font-medium text-blue-900",children:"ç¬¬ä¸€å¯©æŸ»"}),e.jsx("div",{className:"text-xs text-blue-700",children:"åŸºæœ¬æƒ…å ±ãƒ»æœ¬äººç¢ºèª"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-orange-600 text-white rounded-full flex items-center justify-center text-sm font-bold mx-auto mb-2",children:"2"}),e.jsx("div",{className:"text-sm font-medium text-blue-900",children:"ç¬¬äºŒå¯©æŸ»"}),e.jsx("div",{className:"text-xs text-blue-700",children:"æ–½è¨­ç”»åƒãƒ»è©³ç´°å¯©æŸ»"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-indigo-600 text-white rounded-full flex items-center justify-center text-sm font-bold mx-auto mb-2",children:"3"}),e.jsx("div",{className:"text-sm font-medium text-blue-900",children:"å®Ÿè¨¼æ¤œæŸ»"}),e.jsx("div",{className:"text-xs text-blue-700",children:"ã‚¹ãƒžãƒ¼ãƒˆãƒ­ãƒƒã‚¯ç¢ºèª"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center text-sm font-bold mx-auto mb-2",children:"4"}),e.jsx("div",{className:"text-sm font-medium text-blue-900",children:"å…¬é–‹æ‰¿èª"}),e.jsx("div",{className:"text-xs text-blue-700",children:"ä¸€èˆ¬å…¬é–‹é–‹å§‹"})]})]})]})}),p.length>0&&e.jsx(E,{className:"bg-gray-50",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-medium mb-3",children:"å¯©æŸ»çŠ¶æ³çµ±è¨ˆ"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-yellow-600",children:p.filter(r=>r.status==="pending").length}),e.jsx("div",{className:"text-gray-600",children:"ç¬¬ä¸€å¯©æŸ»ä¸­"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-orange-600",children:p.filter(r=>r.status==="second_stage_waiting").length}),e.jsx("div",{className:"text-gray-600",children:"ç¬¬äºŒå¯©æŸ»å¾…ã¡"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-purple-600",children:p.filter(r=>r.status==="second_stage_review").length}),e.jsx("div",{className:"text-gray-600",children:"ç¬¬äºŒå¯©æŸ»ä¸­"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-indigo-600",children:p.filter(r=>r.status==="smart_lock_testing").length}),e.jsx("div",{className:"text-gray-600",children:"å®Ÿè¨¼æ¤œæŸ»ä¸­"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:p.filter(r=>r.status==="approved").length}),e.jsx("div",{className:"text-gray-600",children:"æ‰¿èªæ¸ˆã¿"})]})]})]})}),p.length===0?e.jsxs(E,{className:"text-center py-12",children:[e.jsx(V,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"å¯©æŸ»å¾…ã¡ã®ãƒ‰ãƒƒã‚°ãƒ©ãƒ³ã¯ã‚ã‚Šã¾ã›ã‚“"})]}):e.jsx("div",{className:"space-y-4",children:p.map(r=>{const s=(A=>{switch(A){case"pending":return{color:"bg-yellow-100 text-yellow-800 border-yellow-300",label:"ç¬¬ä¸€å¯©æŸ»ä¸­",description:"åŸºæœ¬æƒ…å ±ã¨æœ¬äººç¢ºèªæ›¸é¡žã‚’ç¢ºèªã—ã¦ãã ã•ã„",action:"æ‰¿èªã¾ãŸã¯å´ä¸‹"};case"second_stage_waiting":return{color:"bg-orange-100 text-orange-800 border-orange-300",label:"ç¬¬äºŒå¯©æŸ»æå‡ºå¾…ã¡",description:"ã‚ªãƒ¼ãƒŠãƒ¼ãŒç¬¬äºŒå¯©æŸ»æ›¸é¡žã‚’æå‡ºã™ã‚‹ã¾ã§å¾…æ©Ÿ",action:"å¾…æ©Ÿä¸­"};case"second_stage_review":return{color:"bg-purple-100 text-purple-800 border-purple-300",label:"ç¬¬äºŒå¯©æŸ»ä¸­",description:"æ–½è¨­ç”»åƒã¨è©³ç´°æƒ…å ±ã‚’ç¢ºèªã—ã¦ãã ã•ã„",action:"ç”»åƒå¯©æŸ»ãƒ»æ‰¿èª"};case"smart_lock_testing":return{color:"bg-indigo-100 text-indigo-800 border-indigo-300",label:"ã‚¹ãƒžãƒ¼ãƒˆãƒ­ãƒƒã‚¯å®Ÿè¨¼æ¤œæŸ»ä¸­",description:"å®Ÿéš›ã®æ–½è¨­ã§ã®ã‚¹ãƒžãƒ¼ãƒˆãƒ­ãƒƒã‚¯å‹•ä½œç¢ºèª",action:"å®Ÿè¨¼æ¤œæŸ»å®Œäº†"};default:return{color:"bg-gray-100 text-gray-800 border-gray-300",label:A,description:"",action:""}}})(r.status);return e.jsx(E,{className:`p-6 border-2 ${s.color.includes("border")?s.color:s.color+" border-gray-200"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:r.name}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${s.color}`,children:s.label})]}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600 mb-3",children:[e.jsxs("p",{children:[e.jsx(Q,{className:"w-4 h-4 inline mr-1"}),r.address]}),e.jsxs("p",{children:[e.jsx(se,{className:"w-4 h-4 inline mr-1"}),"ã‚ªãƒ¼ãƒŠãƒ¼: ",r.owner_name]})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"ç¾åœ¨ã®å¯©æŸ»çŠ¶æ³"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description}),s.action&&e.jsxs("p",{className:"text-sm font-medium text-blue-600 mt-2",children:["æŽ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: ",s.action]})]})]}),e.jsxs("div",{className:"ml-4 flex flex-col space-y-2",children:[e.jsxs(h,{onClick:()=>k(r),className:"bg-blue-600 hover:bg-blue-700",size:"sm",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"è©³ç´°ç¢ºèª"]}),e.jsxs(h,{onClick:()=>void Z(r.id),className:"bg-red-600 hover:bg-red-700",size:"sm",children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"å‰Šé™¤"]}),r.status==="second_stage_waiting"&&e.jsx("div",{className:"text-xs text-gray-500 text-center",children:"ã‚ªãƒ¼ãƒŠãƒ¼ã®æå‡ºå¾…ã¡"})]})]})},r.id)})})]})},fe=({pendingVaccines:p,isLoading:x,onApprovalComplete:_,onError:n})=>{const[a,k]=v.useState(null),[C,b]=v.useState(""),[y,D]=v.useState({}),[m,o]=v.useState({}),[l,t]=v.useState(null),[i,f]=v.useState(1),[u,S]=v.useState(!1),[z,O]=v.useState({rabies_expiry_date:"",combo_expiry_date:""}),P=ne(),I=async(c,w)=>{try{const U=await P.handleVaccineApproval(c,w,C);U.success?(_(U.message),k(null),b("")):n(U.message)}catch(U){n(`å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${U.message}`)}},R=c=>{D(w=>({...w,[c]:!1}))},F=c=>{D(w=>({...w,[c]:!1})),o(w=>({...w,[c]:!0}))},G=c=>{D(w=>({...w,[c]:!0})),o(w=>({...w,[c]:!1}))},M=(c,w,U)=>{t({src:c,alt:w,type:U}),f(1)},Z=()=>{t(null),f(1)},T=()=>{f(c=>Math.min(c+.5,3))},r=()=>{f(c=>Math.max(c-.5,.5))},d=c=>{O({rabies_expiry_date:c.rabies_expiry_date||"",combo_expiry_date:c.combo_expiry_date||""})},s=async()=>{if(a)try{const c=await P.handleVaccineExpiryUpdate(a.id,z.rabies_expiry_date||null,z.combo_expiry_date||null);c.success?(_(c.message),S(!1),a&&(a.rabies_expiry_date=z.rabies_expiry_date||null,a.combo_expiry_date=z.combo_expiry_date||null)):n(c.message)}catch(c){n(`æœ‰åŠ¹æœŸé™ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: ${c.message}`)}},A=c=>{if(!c)return"æœªè¨­å®š";try{return new Date(c).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})}catch{return"ç„¡åŠ¹ãªæ—¥ä»˜"}},j=c=>{if(!c)return!1;const w=new Date(c),U=new Date,oe=new Date(U.getTime()+30*24*60*60*1e3);return w<=oe},N=c=>c?new Date(c)<new Date:!1,L=()=>"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjNmNGY2Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzM3NDE1MSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPueUu+WDj+OBjOiqreOCgeWFpeOBv+OBvuOBm+OCk+OBp+OBl+OBnw==</dGV4dD48L3N2Zz4=";return x?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):a?(z.rabies_expiry_date===""&&z.combo_expiry_date===""&&d(a),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[e.jsx(Y,{className:"w-6 h-6 text-blue-600 mr-2"}),a.dog.name,"ã®ãƒ¯ã‚¯ãƒãƒ³è¨¼æ˜Žæ›¸å¯©æŸ»"]}),e.jsxs(h,{variant:"secondary",onClick:()=>{k(null),S(!1),O({rabies_expiry_date:"",combo_expiry_date:""})},children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"ä¸€è¦§ã«æˆ»ã‚‹"]})]}),e.jsxs(E,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"çŠ¬ã®åŸºæœ¬æƒ…å ±"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"åå‰"}),e.jsx("p",{className:"font-medium",children:a.dog.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"çŠ¬ç¨®"}),e.jsx("p",{className:"font-medium",children:a.dog.breed})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"æ€§åˆ¥"}),e.jsx("p",{className:"font-medium",children:a.dog.gender})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"é£¼ã„ä¸»"}),e.jsx("p",{className:"font-medium",children:a.dog.owner.name})]})]})]}),e.jsxs(E,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"font-semibold",children:"ãƒ¯ã‚¯ãƒãƒ³æœ‰åŠ¹æœŸé™"}),e.jsx(h,{size:"sm",variant:"secondary",onClick:()=>S(!u),children:u?"ã‚­ãƒ£ãƒ³ã‚»ãƒ«":"ç·¨é›†"})]}),u?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ç‹‚çŠ¬ç—…ãƒ¯ã‚¯ãƒãƒ³æœ‰åŠ¹æœŸé™"}),e.jsx("input",{type:"date",value:z.rabies_expiry_date,onChange:c=>O(w=>({...w,rabies_expiry_date:c.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"æ··åˆãƒ¯ã‚¯ãƒãƒ³æœ‰åŠ¹æœŸé™"}),e.jsx("input",{type:"date",value:z.combo_expiry_date,onChange:c=>O(w=>({...w,combo_expiry_date:c.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(h,{variant:"secondary",onClick:()=>{S(!1),d(a)},children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),e.jsx(h,{onClick:()=>void s(),isLoading:P.isProcessing,className:"bg-blue-600 hover:bg-blue-700",children:"ä¿å­˜"})]})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"ç‹‚çŠ¬ç—…ãƒ¯ã‚¯ãƒãƒ³æœ‰åŠ¹æœŸé™"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:`font-medium ${N(a.rabies_expiry_date)?"text-red-600":j(a.rabies_expiry_date)?"text-yellow-600":"text-green-600"}`,children:A(a.rabies_expiry_date)}),N(a.rabies_expiry_date)&&e.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full",children:"æœŸé™åˆ‡ã‚Œ"}),j(a.rabies_expiry_date)&&!N(a.rabies_expiry_date)&&e.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:"æœŸé™é–“è¿‘"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"æ··åˆãƒ¯ã‚¯ãƒãƒ³æœ‰åŠ¹æœŸé™"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:`font-medium ${N(a.combo_expiry_date)?"text-red-600":j(a.combo_expiry_date)?"text-yellow-600":"text-green-600"}`,children:A(a.combo_expiry_date)}),N(a.combo_expiry_date)&&e.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full",children:"æœŸé™åˆ‡ã‚Œ"}),j(a.combo_expiry_date)&&!N(a.combo_expiry_date)&&e.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:"æœŸé™é–“è¿‘"})]})]})]})]}),e.jsxs(E,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"ãƒ¯ã‚¯ãƒãƒ³è¨¼æ˜Žæ›¸"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"ç‹‚çŠ¬ç—…ãƒ¯ã‚¯ãƒãƒ³"}),a.rabies_vaccine_image?e.jsxs("div",{className:"border rounded-lg overflow-hidden relative",children:[y[`rabies-${a.id}`]&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 z-10",children:e.jsx(ae,{className:"w-6 h-6 animate-spin text-gray-600"})}),e.jsx("img",{src:H(a.rabies_vaccine_image)||L(),alt:"ç‹‚çŠ¬ç—…ãƒ¯ã‚¯ãƒãƒ³è¨¼æ˜Žæ›¸",className:"w-full h-64 object-contain cursor-pointer hover:opacity-80 transition-opacity",onLoadStart:()=>G(`rabies-${a.id}`),onLoad:()=>R(`rabies-${a.id}`),onError:()=>F(`rabies-${a.id}`),onClick:()=>M(H(a.rabies_vaccine_image)||L(),"ç‹‚çŠ¬ç—…ãƒ¯ã‚¯ãƒãƒ³è¨¼æ˜Žæ›¸","rabies")}),e.jsx("div",{className:"absolute top-2 left-2 bg-white bg-opacity-90 text-gray-800 p-1 rounded border shadow-sm",children:e.jsx(B,{className:"w-4 h-4"})}),m[`rabies-${a.id}`]&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-red-50 bg-opacity-90",children:e.jsxs("div",{className:"text-center",children:[e.jsx(q,{className:"w-12 h-12 text-red-500 mx-auto mb-2"}),e.jsx("p",{className:"text-red-700 font-medium",children:"ç”»åƒãŒèª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸ"})]})})]}):e.jsx("div",{className:"h-64 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"ç”»åƒãªã—"})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"æ··åˆãƒ¯ã‚¯ãƒãƒ³"}),a.combo_vaccine_image?e.jsxs("div",{className:"border rounded-lg overflow-hidden relative",children:[y[`combo-${a.id}`]&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 z-10",children:e.jsx(ae,{className:"w-6 h-6 animate-spin text-gray-600"})}),e.jsx("img",{src:H(a.combo_vaccine_image)||L(),alt:"æ··åˆãƒ¯ã‚¯ãƒãƒ³è¨¼æ˜Žæ›¸",className:"w-full h-64 object-contain cursor-pointer hover:opacity-80 transition-opacity",onLoadStart:()=>G(`combo-${a.id}`),onLoad:()=>R(`combo-${a.id}`),onError:()=>F(`combo-${a.id}`),onClick:()=>M(H(a.combo_vaccine_image)||L(),"æ··åˆãƒ¯ã‚¯ãƒãƒ³è¨¼æ˜Žæ›¸","combo")}),e.jsx("div",{className:"absolute top-2 left-2 bg-white bg-opacity-90 text-gray-800 p-1 rounded border shadow-sm",children:e.jsx(B,{className:"w-4 h-4"})}),m[`combo-${a.id}`]&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-red-50 bg-opacity-90",children:e.jsxs("div",{className:"text-center",children:[e.jsx(q,{className:"w-12 h-12 text-red-500 mx-auto mb-2"}),e.jsx("p",{className:"text-red-700 font-medium",children:"ç”»åƒãŒèª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸ"})]})})]}):e.jsx("div",{className:"h-64 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"ç”»åƒãªã—"})})]})]})]}),e.jsxs(E,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"å¯©æŸ»çµæžœ"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"å´ä¸‹ç†ç”±ï¼ˆå´ä¸‹ã™ã‚‹å ´åˆã®ã¿å…¥åŠ›ï¼‰"}),e.jsx("textarea",{value:C,onChange:c=>b(c.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,placeholder:"ä¾‹: ãƒ¯ã‚¯ãƒãƒ³è¨¼æ˜Žæ›¸ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¦ã„ã¾ã™ã€‚æœ€æ–°ã®è¨¼æ˜Žæ›¸ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚"})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsxs(h,{onClick:()=>void I(a.id,!1),isLoading:P.isProcessing,className:"bg-red-600 hover:bg-red-700",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"å´ä¸‹"]}),e.jsxs(h,{onClick:()=>void I(a.id,!0),isLoading:P.isProcessing,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"æ‰¿èª"]})]})]}),l&&e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4",children:[e.jsxs("div",{className:"relative max-w-full max-h-full",children:[e.jsxs("div",{className:"absolute top-4 right-4 flex items-center space-x-2 z-10",children:[e.jsx("div",{className:"bg-white bg-opacity-90 text-gray-800 px-3 py-1 rounded border shadow-sm text-sm",children:l.type==="rabies"?"ç‹‚çŠ¬ç—…ãƒ¯ã‚¯ãƒãƒ³":"æ··åˆãƒ¯ã‚¯ãƒãƒ³"}),e.jsx(h,{size:"sm",onClick:r,className:"bg-white bg-opacity-90 shadow-lg text-gray-800 hover:bg-opacity-100 border border-gray-300",children:e.jsx(te,{className:"w-4 h-4"})}),e.jsx(h,{size:"sm",onClick:T,className:"bg-white bg-opacity-90 shadow-lg text-gray-800 hover:bg-opacity-100 border border-gray-300",children:e.jsx(B,{className:"w-4 h-4"})}),e.jsx(h,{size:"sm",onClick:Z,className:"bg-white bg-opacity-90 shadow-lg text-gray-800 hover:bg-opacity-100 border border-gray-300",children:e.jsx(q,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"overflow-auto max-h-screen",children:e.jsx("img",{src:l.src,alt:l.alt,className:"max-w-none transition-transform duration-200",style:{transform:`scale(${i})`,transformOrigin:"center center"},onError:c=>{c.currentTarget.src=L()}})}),e.jsxs("div",{className:"absolute bottom-4 left-4 bg-white bg-opacity-90 text-gray-800 px-3 py-2 rounded border shadow-sm text-sm",children:[e.jsx("p",{children:"æ‹¡å¤§/ç¸®å°: ã‚ºãƒ¼ãƒ ãƒœã‚¿ãƒ³ã‚’ä½¿ç”¨"}),e.jsx("p",{children:"é–‰ã˜ã‚‹: Xãƒœã‚¿ãƒ³ã¾ãŸã¯ç”»åƒå¤–ã‚’ã‚¯ãƒªãƒƒã‚¯"})]})]}),e.jsx("div",{className:"absolute inset-0 -z-10",onClick:Z})]})]})):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[e.jsx(Y,{className:"w-6 h-6 text-blue-600 mr-2"}),"å¯©æŸ»å¾…ã¡ãƒ¯ã‚¯ãƒãƒ³è¨¼æ˜Žæ›¸"]}),p.length===0?e.jsxs(E,{className:"text-center py-12",children:[e.jsx(V,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"å¯©æŸ»å¾…ã¡ã®ãƒ¯ã‚¯ãƒãƒ³è¨¼æ˜Žæ›¸ã¯ã‚ã‚Šã¾ã›ã‚“"})]}):e.jsx("div",{className:"space-y-4",children:p.map(c=>e.jsx(E,{className:"p-6 hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-2",children:[c.dog.name,"ã®ãƒ¯ã‚¯ãƒãƒ³è¨¼æ˜Žæ›¸"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"çŠ¬ç¨®"}),e.jsx("p",{className:"font-medium",children:c.dog.breed})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"æ€§åˆ¥"}),e.jsx("p",{className:"font-medium",children:c.dog.gender})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"é£¼ã„ä¸»"}),e.jsx("p",{className:"font-medium",children:c.dog.owner.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"ç”³è«‹æ—¥"}),e.jsx("p",{className:"font-medium",children:new Date(c.created_at).toLocaleDateString("ja-JP")})]})]})]}),e.jsxs("div",{className:"flex space-x-2 ml-4",children:[e.jsxs(h,{size:"sm",variant:"secondary",onClick:()=>k(c),children:[e.jsx(ce,{className:"w-4 h-4 mr-1"}),"è©³ç´°"]}),e.jsxs(h,{size:"sm",onClick:()=>void I(c.id,!0),className:"bg-green-600 hover:bg-green-700",disabled:P.isProcessing,children:[e.jsx(V,{className:"w-4 h-4 mr-1"}),"æ‰¿èª"]}),e.jsxs(h,{size:"sm",onClick:()=>{k(c),I(c.id,!1)},className:"bg-red-600 hover:bg-red-700",disabled:P.isProcessing,children:[e.jsx(q,{className:"w-4 h-4 mr-1"}),"å´ä¸‹"]})]})]})},c.id))})]}),l&&e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4",children:[e.jsxs("div",{className:"relative max-w-full max-h-full",children:[e.jsxs("div",{className:"absolute top-4 right-4 flex items-center space-x-2 z-10",children:[e.jsx("div",{className:"bg-white bg-opacity-90 text-gray-800 px-3 py-1 rounded border shadow-sm text-sm",children:l.type==="rabies"?"ç‹‚çŠ¬ç—…ãƒ¯ã‚¯ãƒãƒ³":"æ··åˆãƒ¯ã‚¯ãƒãƒ³"}),e.jsx(h,{size:"sm",onClick:r,className:"bg-white bg-opacity-90 shadow-lg text-gray-800 hover:bg-opacity-100 border border-gray-300",children:e.jsx(te,{className:"w-4 h-4"})}),e.jsx(h,{size:"sm",onClick:T,className:"bg-white bg-opacity-90 shadow-lg text-gray-800 hover:bg-opacity-100 border border-gray-300",children:e.jsx(B,{className:"w-4 h-4"})}),e.jsx(h,{size:"sm",onClick:Z,className:"bg-white bg-opacity-90 shadow-lg text-gray-800 hover:bg-opacity-100 border border-gray-300",children:e.jsx(q,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"overflow-auto max-h-screen",children:e.jsx("img",{src:l.src,alt:l.alt,className:"max-w-none transition-transform duration-200",style:{transform:`scale(${i})`,transformOrigin:"center center"},onError:c=>{c.currentTarget.src=L()}})}),e.jsxs("div",{className:"absolute bottom-4 left-4 bg-white bg-opacity-90 text-gray-800 px-3 py-2 rounded border shadow-sm text-sm",children:[e.jsx("p",{children:"æ‹¡å¤§/ç¸®å°: ã‚ºãƒ¼ãƒ ãƒœã‚¿ãƒ³ã‚’ä½¿ç”¨"}),e.jsx("p",{children:"é–‰ã˜ã‚‹: Xãƒœã‚¿ãƒ³ã¾ãŸã¯ç”»åƒå¤–ã‚’ã‚¯ãƒªãƒƒã‚¯"})]})]}),e.jsx("div",{className:"absolute inset-0 -z-10",onClick:Z})]})]})},ie=async p=>{try{$("info","ðŸ”§ Checking admin user setup for:",{email:p});const{data:{user:x},error:_}=await g.auth.getUser();if(_)return $("error","âŒ Error getting current user:",_),{success:!1,error:_.message};if(!x)return $("error","âŒ No user found"),{success:!1,error:"No user found"};$("info","ðŸ‘¤ Current user:",{id:x.id,email:x.email,metadata:x.user_metadata});const n=x.user_metadata?.admin===!0;if($("info","ðŸ” Admin status:",{isAdmin:n}),!n)return $("error","âŒ User is not admin"),{success:!1,error:"User is not admin"};const{data:a,error:k}=await g.from("profiles").select("*").eq("id",x.id).single();if(k){if($("error","âŒ Error getting profile:",k),k.code==="PGRST116"){$("info","ðŸ“ Creating admin profile...");const{data:C,error:b}=await g.from("profiles").insert({id:x.id,name:x.user_metadata?.name||x.email?.split("@")[0]||"Admin",user_type:"admin",email:x.email,postal_code:"",address:"",phone_number:"",created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();return b?($("error","âŒ Error creating admin profile:",b),{success:!1,error:b.message}):($("info","âœ… Admin profile created successfully:",C),{success:!0,profile:C,message:"Admin profile created successfully"})}return{success:!1,error:k.message}}if(a.user_type!=="admin"){$("info","ðŸ”„ Updating user type to admin...");const{data:C,error:b}=await g.from("profiles").update({user_type:"admin",updated_at:new Date().toISOString()}).eq("id",x.id).select().single();return b?($("error","âŒ Error updating profile to admin:",b),{success:!1,error:b.message}):($("info","âœ… Profile updated to admin successfully:",C),{success:!0,profile:C,message:"Profile updated to admin successfully"})}return $("info","âœ… Admin user already set up correctly:",a),{success:!0,profile:a,message:"Admin user already set up correctly"}}catch(x){return $("error","âŒ Exception in checkAndSetAdminUser:",{error:X(x)}),{success:!1,error:X(x)}}},be=async(p,x)=>{try{$("info","ðŸ”§ Direct update user type:",{userId:p,userType:x});const{data:_,error:n}=await g.from("profiles").update({user_type:x}).eq("id",p).select().single();return n?($("error","âŒ Direct update failed:",n),{success:!1,error:n.message}):($("info","âœ… Direct update successful:",_),{success:!0,data:_,message:"User type updated successfully"})}catch(_){return $("error","âŒ Exception in directUpdateUserType:",{error:X(_)}),{success:!1,error:X(_)}}};function we(){const{user:p,isAdmin:x,userProfile:_}=ge(),n=me(),[a,k]=v.useState("vaccines"),[C,b]=v.useState(""),[y,D]=v.useState(""),m=ue(a),o=u=>{D(u),b(""),setTimeout(()=>D(""),5e3)},l=u=>{b(u),D(""),setTimeout(()=>b(""),8e3)},t=()=>{b(""),D("")};v.useEffect(()=>{p&&!x&&(async()=>{if(p?.email==="capasjapan@gmail.com"&&!x){console.log("ðŸ”§ Setting up admin user...");try{(await ie(p.email)).success&&(o("ç®¡ç†è€…æ¨©é™ã‚’è¨­å®šã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¾ã™..."),setTimeout(()=>window.location.reload(),1500))}catch(S){console.error("Admin setup error:",S)}}})()},[p,x]),v.useEffect(()=>{if(!x){console.log("âŒ Admin access denied - redirecting to home"),n("/");return}console.log("âœ… Admin access granted - fetching data"),m.refetch()},[x,n,a]);const i=async u=>{o(u),await m.refetch()},f=u=>{l(u)};return e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center space-x-4 mb-6",children:e.jsxs(xe,{to:"/admin",className:"flex items-center text-blue-600 hover:text-blue-800",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚‹"]})}),e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("h1",{className:"text-2xl font-bold flex items-center",children:[e.jsx(le,{className:"w-8 h-8 text-red-600 mr-3"}),"ç®¡ç†è€…å¯©æŸ»ãƒšãƒ¼ã‚¸"]})}),C&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 rounded-lg flex items-start",children:[e.jsx(W,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsx("p",{className:"text-red-800",children:C})]}),y&&e.jsxs("div",{className:"mb-6 p-4 bg-green-50 rounded-lg flex items-start",children:[e.jsx(V,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsx("p",{className:"text-green-800",children:y})]}),!x&&e.jsxs(E,{className:"p-4 bg-red-50 border-l-4 border-red-500",children:[e.jsx("h3",{className:"font-semibold mb-3 text-red-900",children:"âŒ ç®¡ç†è€…æ¨©é™ãŒå¿…è¦ã§ã™"}),e.jsxs("div",{className:"text-sm text-red-800 space-y-2",children:[e.jsx("p",{children:e.jsx("strong",{children:"ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±:"})}),e.jsxs("p",{children:["â€¢ Email: ",p?.email||"ãªã—"]}),e.jsxs("p",{children:["â€¢ User Type: ",_?.user_type||"undefined"]}),e.jsxs("p",{children:["â€¢ Is Admin: ",x?"true":"false"]}),p?.email==="capasjapan@gmail.com"&&e.jsxs("div",{className:"mt-4 space-x-2",children:[e.jsx(h,{size:"sm",onClick:async()=>{t();try{const u=await ie(p.email||"");u.success?(o("ç®¡ç†è€…æ¨©é™ã‚’è¨­å®šã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¾ã™..."),setTimeout(()=>window.location.reload(),1500)):l(`ç®¡ç†è€…æ¨©é™ã®è¨­å®šã«å¤±æ•—: ${u.error}`)}catch(u){l(`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${u.message}`)}},className:"bg-blue-600 hover:bg-blue-700",children:"ç®¡ç†è€…æ¨©é™ã‚’è¨­å®š"}),e.jsx(h,{size:"sm",onClick:async()=>{if(t(),!p?.id){l("ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");return}try{const u=await be(p.id);u.success?(o("ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¾ã™..."),setTimeout(()=>window.location.reload(),1500)):l(`ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°ã«å¤±æ•—: ${u.error}`)}catch(u){l(`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${u.message}`)}},className:"bg-orange-600 hover:bg-orange-700",children:"ç›´æŽ¥æ›´æ–°"})]})]})]}),x&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex space-x-4 border-b",children:[e.jsxs("button",{className:`px-4 py-2 font-medium ${a==="parks"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,onClick:()=>k("parks"),children:[e.jsx(Q,{className:"w-4 h-4 inline mr-2"}),"ãƒ‰ãƒƒã‚°ãƒ©ãƒ³å¯©æŸ»"]}),e.jsxs("button",{className:`px-4 py-2 font-medium ${a==="vaccines"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,onClick:()=>k("vaccines"),children:[e.jsx(Y,{className:"w-4 h-4 inline mr-2"}),"ãƒ¯ã‚¯ãƒãƒ³è¨¼æ˜Žæ›¸å¯©æŸ»"]})]}),e.jsxs("div",{className:"mt-6",children:[a==="parks"&&e.jsx(pe,{pendingParks:m.pendingParks,isLoading:m.isLoading,onApprovalComplete:i,onError:f}),a==="vaccines"&&e.jsx(fe,{pendingVaccines:m.pendingVaccines,isLoading:m.isLoading,onApprovalComplete:i,onError:f})]})]})]})}export{we as AdminManagement};

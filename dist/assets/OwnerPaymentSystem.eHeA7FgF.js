var e=Object.defineProperty,s=Object.defineProperties,t=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,c=(s,t,a)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,l=(e,s)=>{for(var t in s||(s={}))r.call(s,t)&&c(e,t,s[t]);if(a)for(var t of a(s))n.call(s,t)&&c(e,t,s[t]);return e},i=(e,a)=>s(e,t(a)),d=(e,s,t)=>new Promise(((a,r)=>{var n=e=>{try{l(t.next(e))}catch(s){r(s)}},c=e=>{try{l(t.throw(e))}catch(s){r(s)}},l=e=>e.done?a(e.value):Promise.resolve(e.value).then(n,c);l((t=t.apply(e,s)).next())}));import{u as x,s as o,j as m,C as h,B as u}from"./index.oOj2R_C7.js";import{u as p,r as j,L as b}from"./router.icJHpBzt.js";import{Y as g,a8 as y,A as f,h as N,n as _,aJ as w,Q as v,D as k,q as S,C,F as L}from"./ui.UnEvinBv.js";import"./vendor.D1SiiUJb.js";import"./supabase.CZ8ekJUM.js";function E(){const{user:e}=x(),s=p(),[t,a]=j.useState(!0),[r,n]=j.useState(""),[c,E]=j.useState(""),[O,P]=j.useState([]),[D,$]=j.useState(null),[z,B]=j.useState(!1),[F,J]=j.useState(!1),[M,T]=j.useState({bank_name:"",bank_code:"",branch_name:"",branch_code:"",account_type:"ordinary",account_number:"",account_holder_name:""}),[V,A]=j.useState(0),[G,H]=j.useState(0);j.useEffect((()=>{e?I():s("/login")}),[e,s]);const I=()=>d(null,null,(function*(){try{a(!0);const{data:s,error:t}=yield o.from("monthly_payouts").select("*").order("year",{ascending:!1}).order("month",{ascending:!1});if(t)throw t;P(s||[]);const r=(s||[]).reduce(((e,s)=>e+s.total_revenue),0),n=(s||[]).reduce(((e,s)=>e+s.owner_payout),0);A(r),H(n);const{data:c,error:l}=yield o.from("owner_bank_accounts").select("*").eq("owner_id",null==e?void 0:e.id).maybeSingle();if(l&&"PGRST116"!==l.code)throw l;$(c),c&&T({id:c.id,bank_name:c.bank_name,bank_code:c.bank_code,branch_name:c.branch_name,branch_code:c.branch_code,account_type:c.account_type,account_number:c.account_number,account_holder_name:c.account_holder_name})}catch(s){n(s.message||"データの取得に失敗しました")}finally{a(!1)}})),Q=e=>({pending:"振込予定",processing:"振込処理中",completed:"振込完了"}[e]||e);return t?m.jsx("div",{className:"flex justify-center items-center h-64",children:m.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):m.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[m.jsx("div",{className:"flex items-center space-x-4 mb-6",children:m.jsxs(b,{to:"/owner-dashboard",className:"flex items-center text-blue-600 hover:text-blue-800",children:[m.jsx(g,{className:"w-4 h-4 mr-2"}),"オーナーダッシュボードに戻る"]})}),m.jsxs("div",{className:"text-center mb-8",children:[m.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-4 flex items-center justify-center",children:[m.jsx(y,{className:"w-8 h-8 text-green-600 mr-3"}),"収益管理システム"]}),m.jsx("p",{className:"text-lg text-gray-600",children:"ドッグラン施設の収益と振込情報を管理します"})]}),r&&m.jsxs("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4 flex items-start",children:[m.jsx(f,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),m.jsx("p",{children:r})]}),c&&m.jsxs("div",{className:"bg-green-100 border border-green-300 text-green-800 rounded-lg p-4 flex items-start",children:[m.jsx(N,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),m.jsx("p",{children:c})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[m.jsx(h,{className:"p-6",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-gray-600",children:"総売上"}),m.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["¥",V.toLocaleString()]})]}),m.jsx(y,{className:"w-8 h-8 text-green-600"})]})}),m.jsx(h,{className:"p-6",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-gray-600",children:"プラットフォーム手数料"}),m.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["¥",(.2*V).toLocaleString()]}),m.jsx("p",{className:"text-xs text-blue-600",children:"売上の20%"})]}),m.jsx(_,{className:"w-8 h-8 text-blue-600"})]})}),m.jsx(h,{className:"p-6",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-gray-600",children:"オーナー取り分"}),m.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:["¥",G.toLocaleString()]}),m.jsx("p",{className:"text-xs text-purple-600",children:"売上の80%"})]}),m.jsx(w,{className:"w-8 h-8 text-purple-600"})]})})]}),m.jsxs(h,{className:"p-6",children:[m.jsxs("div",{className:"flex justify-between items-center mb-6",children:[m.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[m.jsx(w,{className:"w-6 h-6 text-blue-600 mr-2"}),"振込先情報"]}),D&&!z?m.jsxs(u,{onClick:()=>B(!0),size:"sm",children:[m.jsx(q,{className:"w-4 h-4 mr-2"}),"編集する"]}):null]}),z?m.jsxs("form",{onSubmit:s=>d(null,null,(function*(){s.preventDefault(),J(!0),n(""),E("");try{if(!M.bank_name)throw new Error("銀行名を入力してください");if(!M.bank_code)throw new Error("銀行コードを入力してください");if(!M.branch_name)throw new Error("支店名を入力してください");if(!M.branch_code)throw new Error("支店コードを入力してください");if(!M.account_number)throw new Error("口座番号を入力してください");if(!M.account_holder_name)throw new Error("口座名義を入力してください");if(!/^\d{4}$/.test(M.bank_code))throw new Error("銀行コードは4桁の数字で入力してください");if(!/^\d{3}$/.test(M.branch_code))throw new Error("支店コードは3桁の数字で入力してください");if(!/^\d{7}$/.test(M.account_number))throw new Error("口座番号は7桁の数字で入力してください");if(D){const{error:e}=yield o.from("owner_bank_accounts").update({bank_name:M.bank_name,bank_code:M.bank_code,branch_name:M.branch_name,branch_code:M.branch_code,account_type:M.account_type,account_number:M.account_number,account_holder_name:M.account_holder_name}).eq("id",D.id);if(e)throw e}else{const{error:s}=yield o.from("owner_bank_accounts").insert({owner_id:null==e?void 0:e.id,bank_name:M.bank_name,bank_code:M.bank_code,branch_name:M.branch_name,branch_code:M.branch_code,account_type:M.account_type,account_number:M.account_number,account_holder_name:M.account_holder_name});if(s)throw s}E("振込先情報を保存しました"),B(!1),yield I(),setTimeout((()=>{E("")}),3e3)}catch(t){n(t.message||"振込先情報の保存に失敗しました")}finally{J(!1)}})),children:[m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"銀行名 *"}),m.jsx("input",{type:"text",value:M.bank_name,onChange:e=>T(i(l({},M),{bank_name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例：三菱UFJ銀行",required:!0})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"銀行コード（4桁） *"}),m.jsx("input",{type:"text",value:M.bank_code,onChange:e=>{const s=e.target.value.replace(/\D/g,"");T(i(l({},M),{bank_code:s}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例：0005",maxLength:4,required:!0}),m.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"4桁の数字で入力してください"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"支店名 *"}),m.jsx("input",{type:"text",value:M.branch_name,onChange:e=>T(i(l({},M),{branch_name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例：渋谷支店",required:!0})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"支店コード（3桁） *"}),m.jsx("input",{type:"text",value:M.branch_code,onChange:e=>{const s=e.target.value.replace(/\D/g,"");T(i(l({},M),{branch_code:s}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例：135",maxLength:3,required:!0}),m.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"3桁の数字で入力してください"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"口座種別 *"}),m.jsxs("div",{className:"flex space-x-4",children:[m.jsxs("label",{className:"flex items-center space-x-2",children:[m.jsx("input",{type:"radio",checked:"ordinary"===M.account_type,onChange:()=>T(i(l({},M),{account_type:"ordinary"})),className:"form-radio text-blue-600"}),m.jsx("span",{children:"普通"})]}),m.jsxs("label",{className:"flex items-center space-x-2",children:[m.jsx("input",{type:"radio",checked:"checking"===M.account_type,onChange:()=>T(i(l({},M),{account_type:"checking"})),className:"form-radio text-blue-600"}),m.jsx("span",{children:"当座"})]})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"口座番号（7桁） *"}),m.jsx("input",{type:"text",value:M.account_number,onChange:e=>{const s=e.target.value.replace(/\D/g,"");T(i(l({},M),{account_number:s}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例：1234567",maxLength:7,required:!0}),m.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"7桁の数字で入力してください"})]}),m.jsxs("div",{className:"md:col-span-2",children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"口座名義（カタカナ） *"}),m.jsx("input",{type:"text",value:M.account_holder_name,onChange:e=>T(i(l({},M),{account_holder_name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"例：ヤマダ タロウ",required:!0}),m.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"カタカナで入力してください（姓と名の間にスペース）"})]})]}),m.jsxs("div",{className:"flex justify-end space-x-3",children:[D&&m.jsx(u,{type:"button",variant:"secondary",onClick:()=>B(!1),children:"キャンセル"}),m.jsx(u,{type:"submit",isLoading:F,children:"保存する"})]})]}):D?m.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-sm text-gray-500",children:"銀行名"}),m.jsx("p",{className:"font-medium",children:D.bank_name})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm text-gray-500",children:"銀行コード"}),m.jsx("p",{className:"font-medium",children:D.bank_code})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm text-gray-500",children:"支店名"}),m.jsx("p",{className:"font-medium",children:D.branch_name})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm text-gray-500",children:"支店コード"}),m.jsx("p",{className:"font-medium",children:D.branch_code})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm text-gray-500",children:"口座種別"}),m.jsx("p",{className:"font-medium",children:"ordinary"===D.account_type?"普通":"当座"})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm text-gray-500",children:"口座番号"}),m.jsx("p",{className:"font-medium",children:D.account_number})]}),m.jsxs("div",{className:"md:col-span-2",children:[m.jsx("p",{className:"text-sm text-gray-500",children:"口座名義"}),m.jsx("p",{className:"font-medium",children:D.account_holder_name})]})]})}):m.jsxs("div",{className:"text-center py-8",children:[m.jsx(w,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),m.jsx("p",{className:"text-gray-600 mb-4",children:"振込先情報が登録されていません"}),m.jsx(u,{onClick:()=>B(!0),children:"振込先情報を登録する"})]})]}),m.jsxs(h,{className:"p-6",children:[m.jsxs("div",{className:"flex justify-between items-center mb-6",children:[m.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[m.jsx(v,{className:"w-6 h-6 text-blue-600 mr-2"}),"月別収益"]}),m.jsxs(u,{variant:"secondary",size:"sm",onClick:()=>{alert("CSVダウンロード機能は準備中です")},children:[m.jsx(k,{className:"w-4 h-4 mr-2"}),"CSV出力"]})]}),0===O.length?m.jsxs("div",{className:"text-center py-8",children:[m.jsx(S,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),m.jsx("p",{className:"text-gray-600",children:"まだ収益データがありません"}),m.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"ドッグランの利用があると、ここに収益データが表示されます"})]}):m.jsx("div",{className:"overflow-x-auto",children:m.jsxs("table",{className:"min-w-full bg-white",children:[m.jsx("thead",{className:"bg-gray-50",children:m.jsxs("tr",{children:[m.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"年月"}),m.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"施設名"}),m.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"売上合計"}),m.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"手数料（20%）"}),m.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"振込金額（80%）"}),m.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ステータス"})]})}),m.jsx("tbody",{className:"divide-y divide-gray-200",children:O.map((e=>{return m.jsxs("tr",{className:"hover:bg-gray-50",children:[m.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:[e.year,"年",(t=e.month,["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"][t-1])]}),m.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.park_name}),m.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["¥",e.total_revenue.toLocaleString()]}),m.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:["¥",e.platform_fee.toLocaleString()]}),m.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-green-600",children:["¥",e.owner_payout.toLocaleString()]}),m.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:m.jsx("span",{className:`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${s=e.status,{pending:"bg-yellow-100 text-yellow-800",processing:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800"}[s]||"bg-gray-100 text-gray-800"}`,children:Q(e.status)})})]},e.id);var s,t}))})]})})]}),m.jsx(h,{className:"p-6 bg-blue-50 border-blue-200",children:m.jsxs("div",{className:"flex items-start space-x-3",children:[m.jsx(C,{className:"w-6 h-6 text-blue-600 mt-1"}),m.jsxs("div",{children:[m.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"振込スケジュール"}),m.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[m.jsx("p",{children:"• 振込は毎月15日に前月分を一括で行います"}),m.jsx("p",{children:"• 振込手数料は当社負担です"}),m.jsx("p",{children:"• 振込金額が5,000円未満の場合は翌月に繰り越されます"}),m.jsx("p",{children:"• 振込完了後、メールでお知らせします"}),m.jsx("p",{children:"• 振込先情報に変更がある場合は、前月末日までに更新してください"})]})]})]})}),m.jsx(h,{className:"p-6",children:m.jsxs("div",{className:"flex items-start space-x-3",children:[m.jsx(L,{className:"w-6 h-6 text-gray-600 mt-1"}),m.jsxs("div",{children:[m.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"収益システムについて"}),m.jsxs("div",{className:"text-sm text-gray-700 space-y-1",children:[m.jsxs("p",{children:["• 売上の",m.jsx("span",{className:"font-medium",children:"80%"}),"がオーナー様に支払われます"]}),m.jsxs("p",{children:["• 残りの",m.jsx("span",{className:"font-medium",children:"20%"}),"は当社の手数料となります"]}),m.jsx("p",{children:"• 手数料には、決済手数料、システム利用料、保険料などが含まれます"}),m.jsx("p",{children:"• 収益は以下の項目から発生します："}),m.jsxs("ul",{className:"list-disc pl-5 space-y-1 mt-1",children:[m.jsx("li",{children:"通常利用（1日券）：800円/日"}),m.jsx("li",{children:"施設貸し切り：4,400円/時間"}),m.jsx("li",{children:"プライベートブース：サブスク使い放題・1日券でも利用可能（追加料金なし）"})]}),m.jsx("p",{children:"• サブスクリプション収益は利用回数に応じて分配されます"})]})]})]})})]})}function q({className:e}){return m.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,children:[m.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),m.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}export{E as OwnerPaymentSystem};

import{s as e,a as s,b as t,j as a,C as r,B as l}from"./index-BFgW40ku.js";import{u as i,r as n,L as c}from"./vendor-BHVjIt_u.js";import{g as d}from"./deploymentStatus-ZklI9i_Q.js";import{J as o,ar as m,A as x,t as u,aQ as y,aJ as h,R as p,b as f,C as j}from"./ui-Qz4g1iz4.js";import"./supabase-CKbzEL5D.js";async function N(s={}){try{const{data:{session:t}}=await e.auth.getSession();if(!t?.access_token)throw new Error("認証が必要です");const a=await fetch("https://onmcivwxtzqajcovptgf.supabase.co/functions/v1/deploy-to-netlify",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.access_token}`},body:JSON.stringify({buildCommand:s.buildCommand||"npm run build",outputDir:s.outputDir||"dist",siteId:s.siteId,deployId:s.deployId,netlifyApiKey:"your_netlify_api_key"})});if(!a.ok){const e=await a.json();throw new Error(e.error||"デプロイに失敗しました")}return await a.json()}catch(t){throw t}}async function g(e,s){try{return await N({siteId:e,deployId:s})}catch(t){throw t}}function b(){const e=i(),[b,w]=n.useState(!1),[v,_]=n.useState(!1),[S,k]=n.useState(null),[L,C]=n.useState(null),[I,J]=n.useState(null),[O,R]=n.useState(!1);n.useEffect((()=>{const e=s("lastDeployment");if(e)try{const s=JSON.parse(e);k(s),s.site_id&&s.deploy_id&&U(s.site_id,s.deploy_id)}catch(t){!function(e){try{"undefined"!=typeof window&&window.localStorage&&window.localStorage.removeItem(e)}catch(s){}}("lastDeployment")}}),[]);const D=async()=>{try{w(!0),C(null),J(null);const e=await N();k(e),J("デプロイが開始されました！ステータスを確認してください。"),t("lastDeployment",JSON.stringify(e)),q(e);const s=setInterval((async()=>{try{const a=await g(e.site_id,e.deploy_id);k(a),["ready","error","failed"].includes(a.status)&&(clearInterval(s),"ready"===a.status?J("デプロイが完了しました！以下のURLでサイトを確認できます。"):C("デプロイに失敗しました。詳細はNetlifyダッシュボードで確認してください。")),t("lastDeployment",JSON.stringify(a)),H(a)}catch(a){}}),5e3);return()=>clearInterval(s)}catch(e){C(e.message||"デプロイに失敗しました")}finally{w(!1)}},U=async(e,s)=>{try{_(!0),C(null);const a=await g(e,s);k(a),t("lastDeployment",JSON.stringify(a)),H(a),"ready"===a.status?J("デプロイが完了しています！以下のURLでサイトを確認できます。"):["error","failed"].includes(a.status)?C("デプロイに失敗しました。詳細はNetlifyダッシュボードで確認してください。"):J("デプロイは進行中です。ステータスを確認してください。")}catch(a){C(a.message||"デプロイステータスの確認に失敗しました")}finally{_(!1)}},q=e=>{try{const a=s("deploymentHistory");let r=a?JSON.parse(a):[];r.unshift({...e,created_at:(new Date).toISOString()}),r.length>10&&(r=r.slice(0,10)),t("deploymentHistory",JSON.stringify(r))}catch(a){}},H=e=>{try{const a=s("deploymentHistory");if(!a)return;let r=JSON.parse(a);r=r.map((s=>s.deploy_id===e.deploy_id?{...s,status:e.status,deploy_url:e.deploy_url}:s)),t("deploymentHistory",JSON.stringify(r))}catch(a){}};return a.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[a.jsx("div",{className:"flex items-center space-x-4 mb-6",children:a.jsxs(c,{to:"/dashboard",className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[a.jsx(o,{className:"w-4 h-4 mr-2"}),"ダッシュボードに戻る"]})}),a.jsxs("div",{className:"text-center mb-8",children:[a.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-4 flex items-center justify-center",children:[a.jsx(m,{className:"w-8 h-8 text-blue-600 mr-3"}),"サイトをデプロイ"]}),a.jsx("p",{className:"text-lg text-gray-600",children:"あなたのアプリケーションをNetlifyにデプロイします"})]}),L&&a.jsxs("div",{className:"mb-6 p-4 bg-red-50 rounded-lg flex items-start",children:[a.jsx(x,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),a.jsx("p",{className:"text-red-800",children:L})]}),I&&a.jsxs("div",{className:"mb-6 p-4 bg-green-50 rounded-lg flex items-start",children:[a.jsx(u,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),a.jsx("p",{className:"text-green-800",children:I})]}),a.jsxs(r,{className:"p-6",children:[a.jsx("h2",{className:"text-xl font-semibold mb-6",children:"デプロイ設定"}),a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(m,{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),a.jsxs("div",{className:"text-sm text-blue-800",children:[a.jsx("p",{className:"font-medium mb-1",children:"Netlifyデプロイについて"}),a.jsx("p",{children:"このツールを使用すると、現在のプロジェクトをNetlifyに自動的にデプロイできます。デプロイが完了すると、公開URLが提供されます。"})]})]})}),S?a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[a.jsx("h3",{className:"font-semibold mb-2",children:"最新のデプロイ情報"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"ステータス:"}),a.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${(e=>{switch(e){case"ready":return"text-green-600 bg-green-100";case"error":case"failed":return"text-red-600 bg-red-100";case"building":case"enqueued":case"processing":return"text-blue-600 bg-blue-100";default:return"text-gray-600 bg-gray-100"}})(S.status)}`,children:(e=>{switch(e){case"ready":return"完了";case"error":case"failed":return"失敗";case"building":return"ビルド中";case"enqueued":return"待機中";case"processing":return"処理中";default:return e}})(S.status)})]}),S.deploy_url&&a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"公開URL:"}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs("a",{href:S.deploy_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-800 flex items-center",children:[S.deploy_url.replace(/^https?:\/\//,""),a.jsx(y,{className:"w-3 h-3 ml-1"})]}),a.jsx("button",{onClick:()=>{return e=S.deploy_url,void navigator.clipboard.writeText(e).then((()=>{R(!0),setTimeout((()=>R(!1)),2e3)}));var e},className:"text-gray-500 hover:text-gray-700",title:"URLをコピー",children:a.jsx(h,{className:"w-4 h-4"})})]})]}),S.claim_url&&!S.claimed&&a.jsx("div",{className:"mt-2",children:a.jsxs("a",{href:S.claim_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-800 flex items-center",children:["Netlifyでサイトを管理する",a.jsx(y,{className:"w-3 h-3 ml-1"})]})})]})]}),a.jsxs("div",{className:"flex space-x-3",children:[a.jsxs(l,{onClick:()=>{S?.site_id&&S?.deploy_id&&U(S.site_id,S.deploy_id)},variant:"secondary",isLoading:v,children:[a.jsx(p,{className:"w-4 h-4 mr-2"}),"ステータスを更新"]}),a.jsxs(l,{onClick:D,isLoading:b,disabled:["building","enqueued","processing"].includes(S.status),children:[a.jsx(m,{className:"w-4 h-4 mr-2"}),"再デプロイ"]}),a.jsxs(l,{onClick:()=>e("/deployment-history"),variant:"secondary",children:[a.jsx(f,{className:"w-4 h-4 mr-2"}),"デプロイ履歴"]})]})]}):a.jsxs("div",{className:"space-y-4",children:[a.jsxs(l,{onClick:D,isLoading:b,className:"w-full",children:[a.jsx(m,{className:"w-4 h-4 mr-2"}),"Netlifyにデプロイ"]}),a.jsxs(l,{onClick:async()=>{try{_(!0),C(null);"ready"===(await d({})).status&&J("デプロイが完了しています！以下のURLでサイトを確認できます。")}catch(e){C(e.message||"デプロイステータスの確認に失敗しました")}finally{_(!1)}},variant:"secondary",isLoading:v,className:"w-full",children:[a.jsx(j,{className:"w-4 h-4 mr-2"}),"デプロイステータスを確認"]})]}),O&&a.jsx("div",{className:"text-center text-sm text-green-600",children:"URLをコピーしました！"})]})]}),a.jsxs(r,{className:"p-6 bg-gray-50",children:[a.jsx("h3",{className:"font-semibold mb-4",children:"デプロイについての注意事項"}),a.jsxs("div",{className:"text-sm text-gray-700 space-y-2",children:[a.jsx("p",{children:"• デプロイには数分かかる場合があります"}),a.jsx("p",{children:"• デプロイが完了すると、公開URLが提供されます"}),a.jsx("p",{children:"• Netlifyアカウントをお持ちの場合は、サイトを自分のアカウントに移行できます"}),a.jsx("p",{children:"• 環境変数は自動的に設定されます"}),a.jsx("p",{children:"• 問題が発生した場合は、Netlifyダッシュボードで詳細を確認してください"})]})]})]})}export{b as Deploy};

var e=Object.defineProperty,s=Object.defineProperties,a=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,n=(s,a,t)=>a in s?e(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t,i=(e,s)=>{for(var a in s||(s={}))l.call(s,a)&&n(e,a,s[a]);if(t)for(var a of t(s))r.call(s,a)&&n(e,a,s[a]);return e},c=(e,t)=>s(e,a(t)),d=(e,s,a)=>new Promise(((t,l)=>{var r=e=>{try{i(a.next(e))}catch(s){l(s)}},n=e=>{try{i(a.throw(e))}catch(s){l(s)}},i=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,n);i((a=a.apply(e,s)).next())}));import{u as o,s as m,j as x,B as u,C as p}from"./index.oOj2R_C7.js";import{u as g,r as h,L as j}from"./router.icJHpBzt.js";import{I as y}from"./Input.DeZ8m3vP.js";import{S as b}from"./Select.Ccsc19kJ.js";import{d as f}from"./csvExport.CYgrbVbx.js";import{Y as v,r as _,A as N,h as w,ar as k,B as C,aC as S,D as L,t as q,O as z,n as D,X as O,as as P,q as I,aM as $}from"./ui.UnEvinBv.js";import"./vendor.D1SiiUJb.js";import"./supabase.CZ8ekJUM.js";function T(){const{user:e,isAdmin:s}=o(),a=g(),[t,l]=h.useState("orders"),[r,n]=h.useState([]),[T,E]=h.useState([]),[R,U]=h.useState([]),[B,A]=h.useState([]),[F,M]=h.useState(!0),[V,W]=h.useState(""),[X,Y]=h.useState(""),[G,H]=h.useState(""),[K,Q]=h.useState("all"),[Z,ee]=h.useState(null),[se,ae]=h.useState(null),[te,le]=h.useState(null),[re,ne]=h.useState(null),[ie,ce]=h.useState(!1),[de,oe]=h.useState({status:"",tracking_number:"",shipping_carrier:"",estimated_delivery_date:"",notes:""}),[me,xe]=h.useState({name:"",description:"",price:0,category:"",stock_quantity:0,is_active:!0,brand:"",weight:0,size:"",ingredients:"",age_group:"",dog_size:"",image_url:""}),[ue,pe]=h.useState({title:"",content:"",category:"news",is_important:!1,image_url:"",link_url:"",park_id:""}),[ge,he]=h.useState({name:"",address:"",image_url:"",opening_date:"",park_id:""}),[je,ye]=h.useState(!1),[be,fe]=h.useState(!1),[ve,_e]=h.useState(!1),[Ne,we]=h.useState([]);h.useEffect((()=>{s?(ke(),Ce()):a("/")}),[s,a,t]);const ke=()=>d(null,null,(function*(){try{if(M(!0),W(""),"orders"===t){const{data:e,error:s}=yield m.from("orders").select("\n            *,\n            order_items (\n              *,\n              product:products(*)\n            )\n          ").order("created_at",{ascending:!1});if(s)throw s;n(e||[])}else if("products"===t){const{data:e,error:s}=yield m.from("products").select("*").order("created_at",{ascending:!1});if(s)throw s;E(e||[])}else if("news"===t){const{data:e,error:s}=yield m.from("news_announcements").select("*").order("created_at",{ascending:!1});if(s)throw s;U(e||[]);const{data:a,error:t}=yield m.from("new_park_openings").select("*").order("created_at",{ascending:!1});if(t)throw t;A(a||[])}}catch(e){W(e.message||"エラーが発生しました")}finally{M(!1)}})),Ce=()=>d(null,null,(function*(){try{const{data:e,error:s}=yield m.from("dog_parks").select("id, name").eq("status","approved");if(s)throw s;we(e||[])}catch(e){}})),Se=e=>({pending:"注文受付中",confirmed:"注文確定",processing:"準備中",shipped:"発送済み",delivered:"配達完了",cancelled:"キャンセル"}[e]||e),Le=e=>({pending:"bg-yellow-100 text-yellow-800",confirmed:"bg-blue-100 text-blue-800",processing:"bg-purple-100 text-purple-800",shipped:"bg-orange-100 text-orange-800",delivered:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"}[e]||"bg-gray-100 text-gray-800"),qe=e=>({credit_card:"クレジットカード",bank_transfer:"銀行振込",cod:"代金引換"}[e]||e),ze=e=>({pending:"未決済",completed:"決済完了",failed:"決済失敗",cancelled:"キャンセル"}[e]||e),De=e=>({pending:"bg-yellow-100 text-yellow-800",completed:"bg-green-100 text-green-800",failed:"bg-red-100 text-red-800",cancelled:"bg-gray-100 text-gray-800"}[e]||"bg-gray-100 text-gray-800"),Oe=e=>({news:"お知らせ",announcement:"重要なお知らせ",sale:"セール情報"}[e]||e),Pe=r.filter((e=>{const s=e.order_number.toLowerCase().includes(G.toLowerCase())||e.shipping_name.toLowerCase().includes(G.toLowerCase())||e.shipping_address.toLowerCase().includes(G.toLowerCase()),a="all"===K||e.status===K;return s&&a})),Ie=T.filter((e=>e.name.toLowerCase().includes(G.toLowerCase())||e.description.toLowerCase().includes(G.toLowerCase())||e.brand&&e.brand.toLowerCase().includes(G.toLowerCase()))),$e=R.filter((e=>e.title.toLowerCase().includes(G.toLowerCase())||e.content.toLowerCase().includes(G.toLowerCase()))),Te=B.filter((e=>e.name.toLowerCase().includes(G.toLowerCase())||e.address.toLowerCase().includes(G.toLowerCase())));return F?x.jsx("div",{className:"flex justify-center items-center h-64",children:x.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):x.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[x.jsx("div",{className:"flex items-center space-x-4 mb-6",children:x.jsxs(j,{to:"/admin",className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[x.jsx(v,{className:"w-4 h-4 mr-2"}),"管理者ダッシュボードに戻る"]})}),x.jsx("div",{className:"flex justify-between items-center",children:x.jsxs("h1",{className:"text-2xl font-bold flex items-center",children:[x.jsx(_,{className:"w-8 h-8 text-green-600 mr-3"}),"ショップ管理"]})}),V&&x.jsxs("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4 flex items-start",children:[x.jsx(N,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),x.jsx("p",{children:V})]}),X&&x.jsxs("div",{className:"bg-green-100 border border-green-300 text-green-800 rounded-lg p-4 flex items-start",children:[x.jsx(w,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),x.jsx("p",{children:X})]}),x.jsxs("div",{className:"flex space-x-4 border-b",children:[x.jsxs("button",{className:"px-4 py-2 font-medium "+("orders"===t?"text-green-600 border-b-2 border-green-600":"text-gray-500 hover:text-gray-700"),onClick:()=>l("orders"),children:[x.jsx(k,{className:"w-4 h-4 inline mr-2"}),"注文管理"]}),x.jsxs("button",{className:"px-4 py-2 font-medium "+("products"===t?"text-green-600 border-b-2 border-green-600":"text-gray-500 hover:text-gray-700"),onClick:()=>l("products"),children:[x.jsx(_,{className:"w-4 h-4 inline mr-2"}),"商品管理"]}),x.jsxs("button",{className:"px-4 py-2 font-medium "+("news"===t?"text-green-600 border-b-2 border-green-600":"text-gray-500 hover:text-gray-700"),onClick:()=>l("news"),children:[x.jsx(C,{className:"w-4 h-4 inline mr-2"}),"新着情報管理"]})]}),"orders"===t&&x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[x.jsx("div",{className:"md:col-span-2",children:x.jsx(y,{label:"",value:G,onChange:e=>H(e.target.value),placeholder:"注文番号、顧客名、住所で検索...",icon:x.jsx(S,{className:"w-4 h-4 text-gray-500"})})}),x.jsx("div",{children:x.jsxs("select",{value:K,onChange:e=>Q(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",children:[x.jsx("option",{value:"all",children:"すべてのステータス"}),x.jsx("option",{value:"pending",children:"注文受付中"}),x.jsx("option",{value:"confirmed",children:"注文確定"}),x.jsx("option",{value:"processing",children:"準備中"}),x.jsx("option",{value:"shipped",children:"発送済み"}),x.jsx("option",{value:"delivered",children:"配達完了"}),x.jsx("option",{value:"cancelled",children:"キャンセル"})]})})]}),x.jsx("div",{className:"flex justify-end",children:x.jsxs(u,{variant:"secondary",size:"sm",onClick:()=>{if(0===r.length)return;const e=r.map((e=>[e.order_number,new Date(e.created_at).toLocaleDateString("ja-JP"),Se(e.status),qe(e.payment_method),ze(e.payment_status),e.total_amount,e.discount_amount,e.shipping_fee,e.final_amount,e.shipping_name,e.shipping_postal_code,e.shipping_address,e.shipping_phone,e.estimated_delivery_date?new Date(e.estimated_delivery_date).toLocaleDateString("ja-JP"):"",e.tracking_number||"",e.shipping_carrier||"",e.notes||""]));f(["注文番号","注文日","ステータス","支払い方法","支払いステータス","合計金額","割引額","送料","最終金額","配送先氏名","配送先郵便番号","配送先住所","配送先電話番号","配送予定日","追跡番号","配送業者","備考"],e,`注文一覧_${(new Date).toISOString().split("T")[0]}.csv`)},disabled:0===r.length,children:[x.jsx(L,{className:"w-4 h-4 mr-2"}),"CSV出力"]})}),0===Pe.length?x.jsxs(p,{className:"text-center py-12",children:[x.jsx(k,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),x.jsx("h2",{className:"text-xl font-semibold text-gray-700 mb-2",children:"注文がありません"}),x.jsx("p",{className:"text-gray-500",children:"該当する注文が見つかりませんでした"})]}):x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"min-w-full bg-white",children:[x.jsx("thead",{className:"bg-gray-50",children:x.jsxs("tr",{children:[x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"注文番号"}),x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"注文日"}),x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"顧客名"}),x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"金額"}),x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ステータス"}),x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"支払い"}),x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"アクション"})]})}),x.jsx("tbody",{className:"divide-y divide-gray-200",children:Pe.map((e=>x.jsxs("tr",{className:"hover:bg-gray-50",children:[x.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.order_number}),x.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.created_at).toLocaleDateString("ja-JP")}),x.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.shipping_name}),x.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:["¥",e.final_amount.toLocaleString()]}),x.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:x.jsx("span",{className:`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${Le(e.status)}`,children:Se(e.status)})}),x.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:x.jsxs("div",{className:"flex flex-col",children:[x.jsx("span",{className:"text-xs text-gray-500",children:qe(e.payment_method)}),x.jsx("span",{className:`mt-1 px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${De(e.payment_status)}`,children:ze(e.payment_status)})]})}),x.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:x.jsxs(u,{size:"sm",variant:"secondary",onClick:()=>(e=>{ee(e),oe({status:e.status,tracking_number:e.tracking_number||"",shipping_carrier:e.shipping_carrier||"",estimated_delivery_date:e.estimated_delivery_date?new Date(e.estimated_delivery_date).toISOString().split("T")[0]:"",notes:e.notes||""})})(e),children:[x.jsx(q,{className:"w-4 h-4 mr-1"}),"詳細"]})})]},e.id)))})]})})]}),"products"===t&&x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"flex justify-between items-center",children:[x.jsx(y,{label:"",value:G,onChange:e=>H(e.target.value),placeholder:"商品名、説明で検索...",icon:x.jsx(S,{className:"w-4 h-4 text-gray-500"}),className:"w-64"}),x.jsxs(u,{onClick:()=>{ae(null),xe({name:"",description:"",price:0,category:"",stock_quantity:0,is_active:!0,brand:"",weight:0,size:"",ingredients:"",age_group:"all",dog_size:"all",image_url:""}),ye(!0)},children:[x.jsx(J,{className:"w-4 h-4 mr-2"}),"新規商品登録"]})]}),x.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:Ie.map((e=>x.jsxs(p,{className:"overflow-hidden",children:[e.image_url&&x.jsx("div",{className:"h-48 -m-6 mb-4",children:x.jsx("img",{src:e.image_url,alt:e.name,className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://images.pexels.com/photos/1108099/pexels-photo-1108099.jpeg"}})}),x.jsxs("div",{className:"px-6 pb-6",children:[x.jsx("h3",{className:"text-lg font-semibold mb-2",children:e.name}),x.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:e.description}),x.jsxs("div",{className:"flex justify-between items-center mb-3",children:[x.jsxs("span",{className:"text-lg font-bold text-green-600",children:["¥",e.price.toLocaleString()]}),x.jsxs("span",{className:"px-2 py-1 rounded-full text-xs "+(e.stock_quantity>0?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:["在庫: ",e.stock_quantity]})]}),x.jsxs(u,{variant:"secondary",className:"w-full",onClick:()=>(e=>{ae(e),xe({name:e.name,description:e.description,price:e.price,category:e.category,stock_quantity:e.stock_quantity,is_active:e.is_active,brand:e.brand||"",weight:e.weight||0,size:e.size||"",ingredients:e.ingredients||"",age_group:e.age_group||"all",dog_size:e.dog_size||"all",image_url:e.image_url}),ye(!0)})(e),children:[x.jsx(z,{className:"w-4 h-4 mr-2"}),"編集"]})]})]},e.id)))})]}),"news"===t&&x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"flex justify-between items-center",children:[x.jsx(y,{label:"",value:G,onChange:e=>H(e.target.value),placeholder:"タイトル、内容で検索...",icon:x.jsx(S,{className:"w-4 h-4 text-gray-500"}),className:"w-64"}),x.jsxs("div",{className:"flex space-x-3",children:[x.jsxs(u,{onClick:()=>{le(null),pe({title:"",content:"",category:"news",is_important:!1,image_url:"",link_url:"",park_id:""}),fe(!0)},children:[x.jsx(C,{className:"w-4 h-4 mr-2"}),"新着情報を追加"]}),x.jsxs(u,{onClick:()=>{ne(null),he({name:"",address:"",image_url:"",opening_date:"",park_id:""}),_e(!0)},children:[x.jsx(D,{className:"w-4 h-4 mr-2"}),"新規オープン情報を追加"]})]})]}),x.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center",children:[x.jsx(C,{className:"w-6 h-6 text-blue-600 mr-2"}),"新着情報"]}),0===$e.length?x.jsxs(p,{className:"text-center py-8",children:[x.jsx(C,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),x.jsx("p",{className:"text-gray-600",children:"新着情報がありません"})]}):x.jsx("div",{className:"space-y-4",children:$e.map((e=>{return x.jsx(p,{className:"p-4",children:x.jsxs("div",{className:"flex justify-between items-start",children:[x.jsxs("div",{className:"flex-1",children:[x.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[x.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s=e.category,{news:"bg-blue-100 text-blue-800",announcement:"bg-red-100 text-red-800",sale:"bg-green-100 text-green-800"}[s]||"bg-gray-100 text-gray-800"}`,children:Oe(e.category)}),e.is_important&&x.jsx("span",{className:"bg-red-100 text-red-800 px-2 py-1 rounded-full text-xs font-medium",children:"重要"}),x.jsx("span",{className:"text-xs text-gray-500",children:new Date(e.created_at).toLocaleDateString("ja-JP")})]}),x.jsx("h3",{className:"font-semibold",children:e.title}),x.jsx("p",{className:"text-sm text-gray-600 line-clamp-2 mt-1",children:e.content})]}),x.jsxs("div",{className:"flex space-x-2",children:[x.jsxs(u,{size:"sm",variant:"secondary",onClick:()=>{return le(s=e),pe({title:s.title,content:s.content,category:s.category,is_important:s.is_important||!1,image_url:s.image_url||"",link_url:s.link_url||"",park_id:s.park_id||""}),void fe(!0);var s},children:[x.jsx(z,{className:"w-4 h-4 mr-1"}),"編集"]}),x.jsx(u,{size:"sm",variant:"secondary",className:"text-red-600 hover:text-red-700",onClick:()=>{return s=e.id,d(null,null,(function*(){if(confirm("この新着情報を削除してもよろしいですか？"))try{ce(!0),W("");const{error:e}=yield m.from("news_announcements").delete().eq("id",s);if(e)throw e;Y("新着情報を削除しました"),yield ke(),setTimeout((()=>{Y("")}),3e3)}catch(e){W("新着情報の削除に失敗しました")}finally{ce(!1)}}));var s},children:x.jsx(O,{className:"w-4 h-4"})})]})]})},e.id);var s}))}),x.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center mt-8",children:[x.jsx(D,{className:"w-6 h-6 text-purple-600 mr-2"}),"新規オープン情報"]}),0===Te.length?x.jsxs(p,{className:"text-center py-8",children:[x.jsx(D,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),x.jsx("p",{className:"text-gray-600",children:"新規オープン情報がありません"})]}):x.jsx("div",{className:"space-y-4",children:Te.map((e=>x.jsx(p,{className:"p-4",children:x.jsxs("div",{className:"flex justify-between items-start",children:[x.jsxs("div",{className:"flex-1",children:[x.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[x.jsx("span",{className:"bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-xs font-medium",children:"新規オープン"}),x.jsx("span",{className:"text-xs text-gray-500",children:new Date(e.created_at).toLocaleDateString("ja-JP")})]}),x.jsx("h3",{className:"font-semibold",children:e.name}),x.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.address}),x.jsxs("p",{className:"text-sm text-blue-600 mt-1",children:["オープン日: ",e.opening_date]})]}),x.jsxs("div",{className:"flex space-x-2",children:[x.jsxs(u,{size:"sm",variant:"secondary",onClick:()=>(e=>{ne(e),he({name:e.name,address:e.address,image_url:e.image_url,opening_date:e.opening_date,park_id:e.park_id||""}),_e(!0)})(e),children:[x.jsx(z,{className:"w-4 h-4 mr-1"}),"編集"]}),x.jsx(u,{size:"sm",variant:"secondary",className:"text-red-600 hover:text-red-700",onClick:()=>{return s=e.id,d(null,null,(function*(){if(confirm("この新規オープン情報を削除してもよろしいですか？"))try{ce(!0),W("");const{error:e}=yield m.from("new_park_openings").delete().eq("id",s);if(e)throw e;Y("新規オープン情報を削除しました"),yield ke(),setTimeout((()=>{Y("")}),3e3)}catch(e){W("新規オープン情報の削除に失敗しました")}finally{ce(!1)}}));var s},children:x.jsx(O,{className:"w-4 h-4"})})]})]})},e.id)))})]}),Z&&x.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:x.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:x.jsxs("div",{className:"p-6",children:[x.jsxs("div",{className:"flex justify-between items-center mb-6",children:[x.jsx("h2",{className:"text-xl font-bold",children:"注文詳細"}),x.jsx("button",{onClick:()=>ee(null),className:"text-gray-500 hover:text-gray-700",children:x.jsx(O,{className:"w-6 h-6"})})]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[x.jsxs("div",{children:[x.jsx("h3",{className:"font-semibold mb-3",children:"注文情報"}),x.jsxs("div",{className:"space-y-2 text-sm",children:[x.jsxs("p",{children:[x.jsx("span",{className:"font-medium",children:"注文番号:"})," ",Z.order_number]}),x.jsxs("p",{children:[x.jsx("span",{className:"font-medium",children:"注文日:"})," ",new Date(Z.created_at).toLocaleDateString("ja-JP")]}),x.jsxs("p",{children:[x.jsx("span",{className:"font-medium",children:"ステータス:"})," ",x.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${Le(Z.status)}`,children:Se(Z.status)})]}),x.jsxs("p",{children:[x.jsx("span",{className:"font-medium",children:"支払い方法:"})," ",qe(Z.payment_method)]}),x.jsxs("p",{children:[x.jsx("span",{className:"font-medium",children:"支払いステータス:"})," ",x.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${De(Z.payment_status)}`,children:ze(Z.payment_status)})]})]})]}),x.jsxs("div",{children:[x.jsx("h3",{className:"font-semibold mb-3",children:"配送先"}),x.jsxs("div",{className:"text-sm",children:[x.jsx("p",{className:"font-medium",children:Z.shipping_name}),x.jsxs("p",{children:["〒",Z.shipping_postal_code]}),x.jsx("p",{children:Z.shipping_address}),x.jsx("p",{children:Z.shipping_phone})]})]})]}),x.jsxs("div",{className:"mb-6",children:[x.jsx("h3",{className:"font-semibold mb-3",children:"注文商品"}),x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[x.jsx("thead",{className:"bg-gray-50",children:x.jsxs("tr",{children:[x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"商品"}),x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"単価"}),x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"数量"}),x.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"小計"})]})}),x.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Z.order_items.map((e=>x.jsxs("tr",{children:[x.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:x.jsxs("div",{className:"flex items-center",children:[x.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:x.jsx("img",{className:"h-10 w-10 rounded-full object-cover",src:e.product.image_url,alt:e.product.name,onError:e=>{e.currentTarget.src="https://images.pexels.com/photos/1108099/pexels-photo-1108099.jpeg"}})}),x.jsxs("div",{className:"ml-4",children:[x.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.product.name}),x.jsx("div",{className:"text-sm text-gray-500",children:e.product.sku||"-"})]})]})}),x.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:["¥",e.unit_price.toLocaleString()]}),x.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.quantity}),x.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:["¥",e.total_price.toLocaleString()]})]},e.id)))})]})})]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[x.jsxs("div",{children:[x.jsx("h3",{className:"font-semibold mb-3",children:"料金詳細"}),x.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:x.jsxs("div",{className:"space-y-2 text-sm",children:[x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{children:"商品小計"}),x.jsxs("span",{children:["¥",Z.total_amount.toLocaleString()]})]}),Z.discount_amount>0&&x.jsxs("div",{className:"flex justify-between text-purple-600",children:[x.jsx("span",{children:"割引"}),x.jsxs("span",{children:["-¥",Z.discount_amount.toLocaleString()]})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{children:"送料"}),x.jsx("span",{children:0===Z.shipping_fee?"無料":`¥${Z.shipping_fee.toLocaleString()}`})]}),x.jsx("hr",{className:"my-2"}),x.jsxs("div",{className:"flex justify-between font-bold",children:[x.jsx("span",{children:"合計"}),x.jsxs("span",{className:"text-green-600",children:["¥",Z.final_amount.toLocaleString()]})]})]})})]}),x.jsxs("form",{onSubmit:e=>d(null,null,(function*(){if(e.preventDefault(),Z)try{ce(!0),W(""),Y("");const{error:e}=yield m.from("orders").update({status:de.status,tracking_number:de.tracking_number||null,shipping_carrier:de.shipping_carrier||null,estimated_delivery_date:de.estimated_delivery_date||null,notes:de.notes||null,updated_at:(new Date).toISOString()}).eq("id",Z.id);if(e)throw e;if("shipped"===de.status&&"shipped"!==Z.status){const{error:e}=yield m.from("notifications").insert([{user_id:Z.user_id,type:"order_shipped",title:"注文が発送されました",message:`注文番号: ${Z.order_number} の商品が発送されました。${de.tracking_number?`追跡番号: ${de.tracking_number}`:""}`,data:{order_id:Z.id,order_number:Z.order_number,tracking_number:de.tracking_number||null}}])}if("delivered"===de.status&&"delivered"!==Z.status){const{error:e}=yield m.from("notifications").insert([{user_id:Z.user_id,type:"order_delivered",title:"注文が配達されました",message:`注文番号: ${Z.order_number} の商品が配達されました。ご利用ありがとうございました。`,data:{order_id:Z.id,order_number:Z.order_number}}])}Y("注文情報を更新しました"),yield ke();const{data:s,error:a}=yield m.from("orders").select("\n          *,\n          order_items (\n            *,\n            product:products(*)\n          )\n        ").eq("id",Z.id).single();!a&&s&&ee(s),setTimeout((()=>{Y("")}),3e3)}catch(s){W("注文の更新に失敗しました")}finally{ce(!1)}})),children:[x.jsx("h3",{className:"font-semibold mb-3",children:"注文ステータス更新"}),x.jsxs("div",{className:"space-y-4",children:[x.jsx(b,{label:"ステータス",options:[{value:"pending",label:"注文受付中"},{value:"confirmed",label:"注文確定"},{value:"processing",label:"準備中"},{value:"shipped",label:"発送済み"},{value:"delivered",label:"配達完了"},{value:"cancelled",label:"キャンセル"}],value:de.status,onChange:e=>oe(c(i({},de),{status:e.target.value})),required:!0}),x.jsx(y,{label:"追跡番号",value:de.tracking_number,onChange:e=>oe(c(i({},de),{tracking_number:e.target.value})),placeholder:"追跡番号を入力",icon:x.jsx(P,{className:"w-4 h-4 text-gray-500"})}),x.jsx(y,{label:"配送業者",value:de.shipping_carrier,onChange:e=>oe(c(i({},de),{shipping_carrier:e.target.value})),placeholder:"配送業者名を入力",icon:x.jsx(P,{className:"w-4 h-4 text-gray-500"})}),x.jsx(y,{label:"お届け予定日",type:"date",value:de.estimated_delivery_date,onChange:e=>oe(c(i({},de),{estimated_delivery_date:e.target.value})),icon:x.jsx(I,{className:"w-4 h-4 text-gray-500"})}),x.jsxs("div",{className:"mb-4",children:[x.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"備考"}),x.jsx("textarea",{value:de.notes,onChange:e=>oe(c(i({},de),{notes:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",rows:3,placeholder:"備考を入力"})]}),x.jsxs(u,{type:"submit",isLoading:ie,className:"w-full",children:[x.jsx($,{className:"w-4 h-4 mr-2"}),"更新する"]})]})]})]})]})})}),je&&x.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:x.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:x.jsxs("div",{className:"p-6",children:[x.jsxs("div",{className:"flex justify-between items-center mb-6",children:[x.jsx("h2",{className:"text-xl font-bold",children:se?"商品編集":"新規商品登録"}),x.jsx("button",{onClick:()=>ye(!1),className:"text-gray-500 hover:text-gray-700",children:x.jsx(O,{className:"w-6 h-6"})})]}),x.jsxs("form",{onSubmit:e=>d(null,null,(function*(){if(e.preventDefault(),se)try{ce(!0),W(""),Y("");const{error:e}=yield m.from("products").update({name:me.name,description:me.description,price:me.price,category:me.category,stock_quantity:me.stock_quantity,is_active:me.is_active,brand:me.brand||null,weight:me.weight||null,size:me.size||null,ingredients:me.ingredients||null,age_group:me.age_group||"all",dog_size:me.dog_size||"all",image_url:me.image_url,updated_at:(new Date).toISOString()}).eq("id",se.id);if(e)throw e;Y("商品情報を更新しました"),yield ke(),ye(!1),setTimeout((()=>{Y("")}),3e3)}catch(s){W("商品の更新に失敗しました")}finally{ce(!1)}})),children:[x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[x.jsx(y,{label:"商品名 *",value:me.name,onChange:e=>xe(c(i({},me),{name:e.target.value})),required:!0}),x.jsx(y,{label:"価格 (円) *",type:"number",value:me.price.toString(),onChange:e=>xe(c(i({},me),{price:parseInt(e.target.value)||0})),required:!0,min:"0"}),x.jsxs("div",{className:"md:col-span-2",children:[x.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"商品説明 *"}),x.jsx("textarea",{value:me.description,onChange:e=>xe(c(i({},me),{description:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",rows:4,required:!0})]}),x.jsx(b,{label:"カテゴリー *",options:[{value:"food",label:"ドッグフード"},{value:"treats",label:"おやつ"},{value:"toys",label:"おもちゃ"},{value:"accessories",label:"アクセサリー"},{value:"health",label:"ヘルスケア"},{value:"sheets",label:"ペットシーツ"}],value:me.category,onChange:e=>xe(c(i({},me),{category:e.target.value})),required:!0}),x.jsx(y,{label:"在庫数 *",type:"number",value:me.stock_quantity.toString(),onChange:e=>xe(c(i({},me),{stock_quantity:parseInt(e.target.value)||0})),required:!0,min:"0"}),x.jsx(y,{label:"ブランド",value:me.brand,onChange:e=>xe(c(i({},me),{brand:e.target.value}))}),x.jsx(y,{label:"重量 (g)",type:"number",value:me.weight.toString(),onChange:e=>xe(c(i({},me),{weight:parseInt(e.target.value)||0})),min:"0"}),x.jsx(y,{label:"サイズ",value:me.size,onChange:e=>xe(c(i({},me),{size:e.target.value})),placeholder:"例: S, M, L, XL"}),x.jsxs("div",{className:"md:col-span-2",children:[x.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"原材料"}),x.jsx("textarea",{value:me.ingredients,onChange:e=>xe(c(i({},me),{ingredients:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",rows:3,placeholder:"原材料を入力（フードやおやつの場合）"})]}),x.jsx(b,{label:"対象年齢",options:[{value:"all",label:"全年齢"},{value:"puppy",label:"子犬"},{value:"adult",label:"成犬"},{value:"senior",label:"シニア犬"}],value:me.age_group,onChange:e=>xe(c(i({},me),{age_group:e.target.value}))}),x.jsx(b,{label:"対象サイズ",options:[{value:"all",label:"全サイズ"},{value:"small",label:"小型犬"},{value:"medium",label:"中型犬"},{value:"large",label:"大型犬"}],value:me.dog_size,onChange:e=>xe(c(i({},me),{dog_size:e.target.value}))}),x.jsx(y,{label:"画像URL *",value:me.image_url,onChange:e=>xe(c(i({},me),{image_url:e.target.value})),placeholder:"https://example.com/image.jpg",required:!0}),x.jsxs("div",{className:"flex items-center space-x-2",children:[x.jsx("input",{type:"checkbox",id:"is_active",checked:me.is_active,onChange:e=>xe(c(i({},me),{is_active:e.target.checked})),className:"rounded text-green-600"}),x.jsx("label",{htmlFor:"is_active",className:"text-sm text-gray-700",children:"商品を有効にする（オンにすると商品が表示されます）"})]})]}),x.jsxs("div",{className:"flex justify-end space-x-3",children:[x.jsx(u,{type:"button",variant:"secondary",onClick:()=>ye(!1),children:"キャンセル"}),x.jsx(u,{type:"submit",isLoading:ie,children:se?"更新する":"登録する"})]})]})]})})}),be&&x.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:x.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:x.jsxs("div",{className:"p-6",children:[x.jsxs("div",{className:"flex justify-between items-center mb-6",children:[x.jsx("h2",{className:"text-xl font-bold",children:te?"新着情報を編集":"新着情報を追加"}),x.jsx("button",{onClick:()=>fe(!1),className:"text-gray-500 hover:text-gray-700",children:x.jsx(O,{className:"w-6 h-6"})})]}),x.jsxs("form",{onSubmit:s=>d(null,null,(function*(){s.preventDefault();try{if(ce(!0),W(""),Y(""),te){const{error:e}=yield m.from("news_announcements").update({title:ue.title,content:ue.content,category:ue.category,is_important:ue.is_important,image_url:ue.image_url||null,link_url:ue.link_url||null,park_id:ue.park_id||null,updated_at:(new Date).toISOString()}).eq("id",te.id);if(e)throw e;Y("新着情報を更新しました")}else{const{error:s}=yield m.from("news_announcements").insert([{title:ue.title,content:ue.content,category:ue.category,is_important:ue.is_important,image_url:ue.image_url||null,link_url:ue.link_url||null,park_id:ue.park_id||null,created_by:null==e?void 0:e.id}]);if(s)throw s;Y("新着情報を作成しました")}yield ke(),fe(!1),le(null),pe({title:"",content:"",category:"news",is_important:!1,image_url:"",link_url:"",park_id:""}),setTimeout((()=>{Y("")}),3e3)}catch(a){W("新着情報の更新に失敗しました")}finally{ce(!1)}})),children:[x.jsxs("div",{className:"space-y-4",children:[x.jsx(y,{label:"タイトル *",value:ue.title,onChange:e=>pe(c(i({},ue),{title:e.target.value})),required:!0}),x.jsxs("div",{className:"mb-4",children:[x.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"内容 *"}),x.jsx("textarea",{value:ue.content,onChange:e=>pe(c(i({},ue),{content:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:6,required:!0})]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[x.jsx(b,{label:"カテゴリー *",options:[{value:"news",label:"お知らせ"},{value:"announcement",label:"重要なお知らせ"},{value:"sale",label:"セール情報"}],value:ue.category,onChange:e=>pe(c(i({},ue),{category:e.target.value})),required:!0}),x.jsxs("div",{className:"flex items-center space-x-2 mt-8",children:[x.jsx("input",{type:"checkbox",id:"is_important",checked:ue.is_important,onChange:e=>pe(c(i({},ue),{is_important:e.target.checked})),className:"rounded text-blue-600"}),x.jsx("label",{htmlFor:"is_important",className:"text-sm text-gray-700",children:"重要なお知らせとして表示する"})]})]}),x.jsx(y,{label:"画像URL",value:ue.image_url,onChange:e=>pe(c(i({},ue),{image_url:e.target.value})),placeholder:"https://example.com/image.jpg"}),x.jsx(y,{label:"リンクURL",value:ue.link_url,onChange:e=>pe(c(i({},ue),{link_url:e.target.value})),placeholder:"https://example.com/page"}),x.jsx(b,{label:"関連ドッグラン",options:[{value:"",label:"関連ドッグランなし"},...Ne.map((e=>({value:e.id,label:e.name})))],value:ue.park_id,onChange:e=>pe(c(i({},ue),{park_id:e.target.value}))})]}),x.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[x.jsx(u,{type:"button",variant:"secondary",onClick:()=>fe(!1),children:"キャンセル"}),x.jsx(u,{type:"submit",isLoading:ie,children:te?"更新する":"追加する"})]})]})]})})}),ve&&x.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:x.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:x.jsxs("div",{className:"p-6",children:[x.jsxs("div",{className:"flex justify-between items-center mb-6",children:[x.jsx("h2",{className:"text-xl font-bold",children:re?"新規オープン情報を編集":"新規オープン情報を追加"}),x.jsx("button",{onClick:()=>_e(!1),className:"text-gray-500 hover:text-gray-700",children:x.jsx(O,{className:"w-6 h-6"})})]}),x.jsxs("form",{onSubmit:e=>d(null,null,(function*(){e.preventDefault();try{if(ce(!0),W(""),Y(""),re){const{error:e}=yield m.from("new_park_openings").update({name:ge.name,address:ge.address,image_url:ge.image_url,opening_date:ge.opening_date,park_id:ge.park_id||null,updated_at:(new Date).toISOString()}).eq("id",re.id);if(e)throw e;Y("新規オープン情報を更新しました")}else{const{error:e}=yield m.from("new_park_openings").insert([{name:ge.name,address:ge.address,image_url:ge.image_url,opening_date:ge.opening_date,park_id:ge.park_id||null}]);if(e)throw e;Y("新規オープン情報を作成しました")}yield ke(),_e(!1),ne(null),he({name:"",address:"",image_url:"",opening_date:"",park_id:""}),setTimeout((()=>{Y("")}),3e3)}catch(s){W("新規オープン情報の更新に失敗しました")}finally{ce(!1)}})),children:[x.jsxs("div",{className:"space-y-4",children:[x.jsx(y,{label:"施設名 *",value:ge.name,onChange:e=>he(c(i({},ge),{name:e.target.value})),required:!0}),x.jsx(y,{label:"住所 *",value:ge.address,onChange:e=>he(c(i({},ge),{address:e.target.value})),required:!0}),x.jsx(y,{label:"画像URL *",value:ge.image_url,onChange:e=>he(c(i({},ge),{image_url:e.target.value})),placeholder:"https://example.com/image.jpg",required:!0}),x.jsx(y,{label:"オープン日 *",value:ge.opening_date,onChange:e=>he(c(i({},ge),{opening_date:e.target.value})),placeholder:"2025年7月1日",required:!0}),x.jsx(b,{label:"関連ドッグラン",options:[{value:"",label:"関連ドッグランなし"},...Ne.map((e=>({value:e.id,label:e.name})))],value:ge.park_id,onChange:e=>he(c(i({},ge),{park_id:e.target.value}))})]}),x.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[x.jsx(u,{type:"button",variant:"secondary",onClick:()=>_e(!1),children:"キャンセル"}),x.jsx(u,{type:"submit",isLoading:ie,children:re?"更新する":"追加する"})]})]})]})})})]})}function J({className:e}){return x.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,children:[x.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),x.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}export{T as AdminShopManagement};

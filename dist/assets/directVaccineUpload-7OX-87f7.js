import{s as i}from"./index-fyCrE4_U.js";import"./react-vendor-Co5xHYdE.js";import"./supabase-vendor-FDBaXLCh.js";import"./ui-vendor-C9ptRAmi.js";const E=async(n,r,c="vaccine-certs")=>{try{if(console.log("ãƒ¯ã‚¯ãƒãƒ³è¨¼æ˜æ›¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰é–‹å§‹:",{name:r.name,type:r.type,size:r.size,lastModified:r.lastModified,instanceof_File:r instanceof File}),!r||!(r instanceof File))throw new Error("ç„¡åŠ¹ãªãƒ•ã‚¡ã‚¤ãƒ«ã§ã™");let e=r.type;if(!e||e==="application/octet-stream"){const t=r.name.split(".").pop()?.toLowerCase();switch(t){case"jpg":case"jpeg":e="image/jpeg";break;case"png":e="image/png";break;case"gif":e="image/gif";break;case"webp":e="image/webp";break;default:throw new Error(`ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼: ${t}`)}}if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(e))throw new Error(`ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„MIMEã‚¿ã‚¤ãƒ—: ${e}`);const{data:{session:s},error:a}=await i.auth.getSession();if(console.log("èªè¨¼æƒ…å ±ç¢ºèª:",{hasSession:!!s,hasAccessToken:!!s?.access_token,sessionError:a,userId:s?.user?.id,userEmail:s?.user?.email}),a)throw console.error("âŒ Session error:",a),new Error("èªè¨¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ");if(!s?.access_token)throw console.error("âŒ No access token found"),new Error("èªè¨¼ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚");const p=s.access_token,l=`https://onmcivwxtzqajcovptgf.supabase.co/storage/v1/object/${c}/${n}`,o=await fetch(l,{method:"PUT",headers:{Authorization:`Bearer ${p}`,"Content-Type":e,"Cache-Control":"3600","x-upsert":"true"},body:r});if(!o.ok){const t=await o.text();throw console.error("âŒ Upload failed:",t),o.status===520?(console.error("ğŸŒ Cloudflare Error 520 detected - temporary server issue"),new Error("ä¸€æ™‚çš„ãªã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚")):o.status>=500?(console.error("ğŸ”§ Server error detected:",o.status),new Error(`ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ (${o.status})ã€‚ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚`)):new Error(`ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ: ${o.status} ${o.statusText}`)}const d=await o.json(),{data:{publicUrl:u}}=i.storage.from(c).getPublicUrl(n);return{success:!0,url:u}}catch(e){return console.error("âŒ Direct vaccine upload error:",e),{success:!1,error:e.message}}};export{E as directVaccineUpload};

import{s as i}from"./index-fyCrE4_U.js";import"./react-vendor-Co5xHYdE.js";import"./supabase-vendor-FDBaXLCh.js";import"./ui-vendor-C9ptRAmi.js";const E=async(n,r,c="vaccine-certs")=>{try{if(console.log("ワクチン証明書アップロード開始:",{name:r.name,type:r.type,size:r.size,lastModified:r.lastModified,instanceof_File:r instanceof File}),!r||!(r instanceof File))throw new Error("無効なファイルです");let e=r.type;if(!e||e==="application/octet-stream"){const t=r.name.split(".").pop()?.toLowerCase();switch(t){case"jpg":case"jpeg":e="image/jpeg";break;case"png":e="image/png";break;case"gif":e="image/gif";break;case"webp":e="image/webp";break;default:throw new Error(`サポートされていないファイル形式: ${t}`)}}if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(e))throw new Error(`サポートされていないMIMEタイプ: ${e}`);const{data:{session:s},error:a}=await i.auth.getSession();if(console.log("認証情報確認:",{hasSession:!!s,hasAccessToken:!!s?.access_token,sessionError:a,userId:s?.user?.id,userEmail:s?.user?.email}),a)throw console.error("❌ Session error:",a),new Error("認証エラーが発生しました");if(!s?.access_token)throw console.error("❌ No access token found"),new Error("認証されていません。ログインしてください。");const p=s.access_token,l=`https://onmcivwxtzqajcovptgf.supabase.co/storage/v1/object/${c}/${n}`,o=await fetch(l,{method:"PUT",headers:{Authorization:`Bearer ${p}`,"Content-Type":e,"Cache-Control":"3600","x-upsert":"true"},body:r});if(!o.ok){const t=await o.text();throw console.error("❌ Upload failed:",t),o.status===520?(console.error("🌐 Cloudflare Error 520 detected - temporary server issue"),new Error("一時的なサーバーエラーが発生しました。しばらく待ってから再度お試しください。")):o.status>=500?(console.error("🔧 Server error detected:",o.status),new Error(`サーバーエラーが発生しました (${o.status})。しばらく待ってから再度お試しください。`)):new Error(`アップロードに失敗しました: ${o.status} ${o.statusText}`)}const d=await o.json(),{data:{publicUrl:u}}=i.storage.from(c).getPublicUrl(n);return{success:!0,url:u}}catch(e){return console.error("❌ Direct vaccine upload error:",e),{success:!1,error:e.message}}};export{E as directVaccineUpload};

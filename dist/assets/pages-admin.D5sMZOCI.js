/*! Build: 2025-07-17T07:59:15.523Z
Version: 0.0.0 */
import{u as e,r as s,j as a,S as t,f as r,C as l,n,o as i,M as c,p as d,D as x,q as m,B as o,s as h,t as p,i as u,c as g,v as j,w as N,A as v,g as f,x as b,y,z as _,a as w,X as k,I as S,J as C,K as L,N as D,O as $,Q as P,V as z,W as q,F as M,Y as O,_ as U,U as T,$ as E,T as I,a0 as F,a1 as R,a2 as A,k as V,a3 as J,a4 as Y,a5 as B,a6 as W,Z as K,a7 as Q,G,a8 as H,a9 as X,aa as Z,ab as ee,ac as se}from"./vendor-react.D8SVeCGP.js";import{u as ae,C as te,B as re,A as le,a as ne,b as ie,I as ce,S as de,N as xe}from"./components-admin.GT3qRZg5.js";import{s as me,d as oe,f as he,l as pe,i as ue}from"./utils.C9ZsMnW6.js";import{b as ge}from"./hooks.CTtJlocA.js";const je=Object.freeze(Object.defineProperty({__proto__:null,AdminDashboard:function(){const{user:v,isAdmin:f}=ae(),b=e(),[y,_]=s.useState("overview"),[w,k]=s.useState({totalUsers:0,totalParks:0,pendingParks:0,pendingVaccines:0,pendingFacilities:0,totalReservations:0,monthlyRevenue:0,lastMonthRevenue:0,totalSubscriptions:0,activeSubscriptions:0,newUsersThisMonth:0,unreadMessages:0}),[S,C]=s.useState(!0),[L,D]=s.useState(""),[$,P]=s.useState("");s.useEffect((()=>{f?z():b("/")}),[f,b]);const z=async()=>{try{C(!0),D(""),P("");const{data:e,error:s}=await me.rpc("get_admin_stats");if(s)throw s;const a=e,{data:t,error:r}=await me.from("pet_facilities").select("id",{count:"exact"}).eq("status","pending"),l=(null==t?void 0:t.length)||0;k({totalUsers:(null==a?void 0:a.total_users)||0,totalParks:(null==a?void 0:a.total_parks)||0,pendingParks:(null==a?void 0:a.pending_parks)||0,pendingVaccines:(null==a?void 0:a.pending_vaccines)||0,pendingFacilities:l,totalReservations:(null==a?void 0:a.total_reservations)||0,monthlyRevenue:(null==a?void 0:a.monthly_revenue)||0,lastMonthRevenue:(null==a?void 0:a.last_month_revenue)||0,totalSubscriptions:(null==a?void 0:a.total_subscriptions)||0,activeSubscriptions:(null==a?void 0:a.active_subscriptions)||0,newUsersThisMonth:(null==a?void 0:a.new_users_this_month)||0,unreadMessages:(null==a?void 0:a.unread_messages)||0})}catch(e){D("統計データの取得に失敗しました。")}finally{C(!1)}};return S?a.jsx("div",{className:"flex justify-center items-center h-64",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{children:[a.jsxs("h1",{className:"text-2xl font-bold flex items-center",children:[a.jsx(t,{className:"w-8 h-8 text-red-600 mr-3"}),"管理者ダッシュボード"]}),a.jsx("p",{className:"text-gray-600",children:"システム全体の管理と監視"})]}),a.jsxs("div",{className:"text-sm text-gray-500",children:["最終更新: ",(new Date).toLocaleString("ja-JP")]})]}),L&&a.jsxs("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4 flex items-start",children:[a.jsx(r,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),a.jsx("p",{children:L})]}),$&&a.jsxs("div",{className:"bg-green-100 border border-green-300 text-green-800 rounded-lg p-4 flex items-start",children:[a.jsx(l,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),a.jsx("p",{children:$})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[a.jsx(n,{to:"/admin/users",children:a.jsx(te,{className:"p-6 hover:shadow-lg transition-all duration-200 cursor-pointer hover:scale-105",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"総ユーザー数"}),a.jsx("p",{className:"text-2xl font-bold text-blue-600",children:w.totalUsers}),a.jsxs("p",{className:"text-xs text-green-600",children:["+",w.newUsersThisMonth," 今月"]})]}),a.jsx(i,{className:"w-8 h-8 text-blue-600"})]})})}),a.jsx(n,{to:"/admin/parks",children:a.jsx(te,{className:"p-6 hover:shadow-lg transition-all duration-200 cursor-pointer hover:scale-105",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"総ドッグラン数"}),a.jsx("p",{className:"text-2xl font-bold text-green-600",children:w.totalParks}),w.pendingParks>0&&a.jsxs("p",{className:"text-xs text-orange-600",children:["承認待ち: ",w.pendingParks]})]}),a.jsx(c,{className:"w-8 h-8 text-green-600"})]})})}),a.jsx(n,{to:"/admin/reservations",children:a.jsx(te,{className:"p-6 hover:shadow-lg transition-all duration-200 cursor-pointer hover:scale-105",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"今月の予約数"}),a.jsx("p",{className:"text-2xl font-bold text-purple-600",children:w.totalReservations}),a.jsxs("p",{className:"text-xs text-purple-600",children:["サブスク会員: ",w.activeSubscriptions]})]}),a.jsx(d,{className:"w-8 h-8 text-purple-600"})]})})}),a.jsx(n,{to:"/admin/sales",children:a.jsx(te,{className:"p-6 hover:shadow-lg transition-all duration-200 cursor-pointer hover:scale-105",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"今月の売上"}),a.jsxs("p",{className:"text-2xl font-bold text-orange-600",children:["¥",w.monthlyRevenue.toLocaleString()]}),w.lastMonthRevenue>0&&a.jsxs("p",{className:"text-xs text-gray-500",children:["前月比: ",Math.round(100*(w.monthlyRevenue/w.lastMonthRevenue-1)),"%"]})]}),a.jsx(x,{className:"w-8 h-8 text-orange-600"})]})})})]}),(w.pendingParks>0||w.pendingVaccines>0||w.pendingFacilities>0)&&a.jsxs(te,{className:"p-6 bg-red-50 border-red-200",children:[a.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[a.jsx(r,{className:"w-6 h-6 text-red-600"}),a.jsx("h2",{className:"text-lg font-semibold text-red-900",children:"緊急対応が必要"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[w.pendingParks>0&&a.jsxs("div",{className:"bg-white p-4 rounded-lg border border-red-200",children:[a.jsx("p",{className:"font-medium text-red-900",children:"ドッグラン承認待ち"}),a.jsxs("p",{className:"text-2xl font-bold text-red-600",children:[w.pendingParks,"件"]}),a.jsx(n,{to:"/admin/parks",children:a.jsx(re,{size:"sm",className:"mt-2",children:"確認する"})})]}),w.pendingVaccines>0&&a.jsxs("div",{className:"bg-white p-4 rounded-lg border border-red-200",children:[a.jsx("p",{className:"font-medium text-red-900",children:"ワクチン証明書承認待ち"}),a.jsxs("p",{className:"text-2xl font-bold text-red-600",children:[w.pendingVaccines,"件"]}),a.jsx(n,{to:"/admin/vaccine-approval",children:a.jsx(re,{size:"sm",className:"mt-2",children:"確認する"})})]}),w.pendingFacilities>0&&a.jsxs("div",{className:"bg-white p-4 rounded-lg border border-red-200",children:[a.jsx("p",{className:"font-medium text-red-900",children:"ペット関連施設承認待ち"}),a.jsxs("p",{className:"text-2xl font-bold text-red-600",children:[w.pendingFacilities,"件"]}),a.jsx(n,{to:"/admin/facility-approval",children:a.jsx(re,{size:"sm",className:"mt-2",children:"確認する"})})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[a.jsx(n,{to:"/admin/vaccine-approval",children:a.jsx(te,{className:"p-6 hover:shadow-lg transition-shadow cursor-pointer",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"bg-blue-100 p-3 rounded-full",children:a.jsx(m,{className:"w-6 h-6 text-blue-600"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"font-semibold",children:"ワクチン証明書管理"}),a.jsx("p",{className:"text-sm text-gray-600",children:"ワクチン証明書の承認・管理"}),w.pendingVaccines>0&&a.jsxs("div",{className:"mt-2 inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[a.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full mr-1"}),w.pendingVaccines,"件の承認待ち"]})]})]})})}),a.jsx(n,{to:"/admin/parks",children:a.jsx(te,{className:"p-6 hover:shadow-lg transition-shadow cursor-pointer",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"bg-green-100 p-3 rounded-full",children:a.jsx(c,{className:"w-6 h-6 text-green-600"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"font-semibold",children:"ドッグラン管理"}),a.jsx("p",{className:"text-sm text-gray-600",children:"ドッグランの審査・管理"}),w.pendingParks>0&&a.jsxs("div",{className:"mt-2 inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[a.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full mr-1"}),w.pendingParks,"件の承認待ち"]})]})]})})}),a.jsx(n,{to:"/admin/facility-approval",children:a.jsx(te,{className:"p-6 hover:shadow-lg transition-shadow cursor-pointer",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"bg-indigo-100 p-3 rounded-full",children:a.jsx(o,{className:"w-6 h-6 text-indigo-600"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"font-semibold",children:"ペット関連施設承認"}),a.jsx("p",{className:"text-sm text-gray-600",children:"ペット関連施設の掲載申請承認・管理"}),w.pendingFacilities>0&&a.jsxs("div",{className:"mt-2 inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[a.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full mr-1"}),w.pendingFacilities,"件の承認待ち"]})]})]})})}),a.jsx(n,{to:"/admin/shop",children:a.jsx(te,{className:"p-6 hover:shadow-lg transition-shadow cursor-pointer",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"bg-green-100 p-3 rounded-full",children:a.jsx(h,{className:"w-6 h-6 text-green-600"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",children:"ショップ管理"}),a.jsx("p",{className:"text-sm text-gray-600",children:"商品管理・注文管理・在庫管理"})]})]})})}),a.jsx(n,{to:"/admin/revenue",children:a.jsx(te,{className:"p-6 hover:shadow-lg transition-shadow cursor-pointer",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"bg-purple-100 p-3 rounded-full",children:a.jsx(p,{className:"w-6 h-6 text-purple-600"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",children:"売上レポート"}),a.jsx("p",{className:"text-sm text-gray-600",children:"ドッグラン別売上・振込管理"})]})]})})}),a.jsx(n,{to:"/admin/news",children:a.jsx(te,{className:"p-6 hover:shadow-lg transition-shadow cursor-pointer",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"bg-yellow-100 p-3 rounded-full",children:a.jsx(u,{className:"w-6 h-6 text-yellow-600"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",children:"新着情報管理"}),a.jsx("p",{className:"text-sm text-gray-600",children:"サイトの新着情報・お知らせを管理"})]})]})})}),a.jsx("div",{onClick:()=>_("maintenance"),children:a.jsx(te,{className:"p-6 hover:shadow-lg transition-shadow cursor-pointer",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"bg-orange-100 p-3 rounded-full",children:a.jsx(g,{className:"w-6 h-6 text-orange-600"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",children:"メンテナンス管理"}),a.jsx("p",{className:"text-sm text-gray-600",children:"システムメンテナンス・IP管理"})]})]})})})]}),a.jsxs("div",{className:"flex space-x-4 border-b",children:[a.jsxs("button",{className:"px-4 py-2 font-medium relative flex items-center space-x-2 "+("overview"===y?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>_("overview"),children:[a.jsx(j,{className:"w-4 h-4"}),a.jsx("span",{children:"概要"})]}),a.jsxs("button",{className:"px-4 py-2 font-medium relative flex items-center space-x-2 "+("parks"===y?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>_("parks"),children:[a.jsx(c,{className:"w-4 h-4"}),a.jsx("span",{children:"ドッグラン管理"}),w.pendingParks>0&&a.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:w.pendingParks})]}),a.jsxs("button",{className:"px-4 py-2 font-medium relative flex items-center space-x-2 "+("vaccines"===y?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>_("vaccines"),children:[a.jsx(m,{className:"w-4 h-4"}),a.jsx("span",{children:"ワクチン承認"}),w.pendingVaccines>0&&a.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:w.pendingVaccines})]}),a.jsxs("button",{className:"px-4 py-2 font-medium relative flex items-center space-x-2 "+("facilities"===y?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>_("facilities"),children:[a.jsx(o,{className:"w-4 h-4"}),a.jsx("span",{children:"施設承認"}),w.pendingFacilities>0&&a.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:w.pendingFacilities})]}),a.jsxs("button",{className:"px-4 py-2 font-medium relative flex items-center space-x-2 "+("users"===y?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>_("users"),children:[a.jsx(i,{className:"w-4 h-4"}),a.jsx("span",{children:"ユーザー管理"})]}),a.jsxs("button",{className:"px-4 py-2 font-medium relative flex items-center space-x-2 "+("maintenance"===y?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>_("maintenance"),children:[a.jsx(g,{className:"w-4 h-4"}),a.jsx("span",{children:"メンテナンス"})]})]}),"overview"===y&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs(te,{className:"p-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"システム概要"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium mb-2",children:"プラットフォーム統計"}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"アクティブユーザー:"}),a.jsxs("span",{className:"font-medium",children:[w.totalUsers,"人"]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"承認済みドッグラン:"}),a.jsxs("span",{className:"font-medium",children:[w.totalParks-w.pendingParks,"施設"]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"今月の予約:"}),a.jsxs("span",{className:"font-medium",children:[w.totalReservations,"件"]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"今月の売上:"}),a.jsxs("span",{className:"font-medium",children:["¥",w.monthlyRevenue.toLocaleString()]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"アクティブサブスク:"}),a.jsxs("span",{className:"font-medium",children:[w.activeSubscriptions,"件"]})]})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium mb-2",children:"承認待ち項目"}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"ドッグラン:"}),a.jsxs("span",{className:"font-medium "+(w.pendingParks>0?"text-red-600":"text-green-600"),children:[w.pendingParks,"件"]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"ワクチン証明書:"}),a.jsxs("span",{className:"font-medium "+(w.pendingVaccines>0?"text-red-600":"text-green-600"),children:[w.pendingVaccines,"件"]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"ペット関連施設:"}),a.jsxs("span",{className:"font-medium "+(w.pendingFacilities>0?"text-red-600":"text-green-600"),children:[w.pendingFacilities,"件"]})]})]})]})]})]}),a.jsxs(te,{className:"p-6",children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold",children:"売上推移"}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsx(n,{to:"/admin/revenue",children:a.jsxs(re,{size:"sm",variant:"secondary",children:[a.jsx(p,{className:"w-4 h-4 mr-1"}),"詳細レポート"]})}),a.jsxs(re,{size:"sm",variant:"secondary",children:[a.jsx(N,{className:"w-4 h-4 mr-1"}),"CSV"]})]})]}),a.jsx("div",{className:"h-64 bg-gray-100 rounded-lg flex items-center justify-center",children:a.jsx("p",{className:"text-gray-500",children:"売上グラフ（実装予定）"})})]}),a.jsxs(te,{className:"p-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"新着情報管理"}),a.jsxs("p",{className:"text-gray-600",children:["サイトの新着情報・お知らせを管理するには",a.jsx(n,{to:"/admin/news",className:"text-blue-600 hover:text-blue-800 mx-1",children:"こちら"}),"からアクセスしてください。"]})]})]}),"parks"===y&&a.jsxs(te,{className:"p-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"ドッグラン管理"}),a.jsxs("p",{className:"text-gray-600",children:["詳細なドッグラン管理は",a.jsx(n,{to:"/admin/parks",className:"text-blue-600 hover:text-blue-800 mx-1",children:"ドッグラン管理ページ"}),"で行えます。"]}),w.pendingParks>0&&a.jsxs("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:[a.jsxs("p",{className:"text-red-700",children:[a.jsxs("strong",{children:[w.pendingParks,"件"]}),"のドッグラン承認待ちがあります。"]}),a.jsx(n,{to:"/admin/parks",children:a.jsx(re,{size:"sm",className:"mt-2",children:"今すぐ確認する"})})]})]}),"vaccines"===y&&a.jsxs(te,{className:"p-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"ワクチン証明書管理"}),a.jsxs("p",{className:"text-gray-600",children:["詳細なワクチン証明書管理は",a.jsx(n,{to:"/admin/vaccine-approval",className:"text-blue-600 hover:text-blue-800 mx-1",children:"ワクチン証明書管理ページ"}),"で行えます。"]}),w.pendingVaccines>0&&a.jsxs("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:[a.jsxs("p",{className:"text-red-700",children:[a.jsxs("strong",{children:[w.pendingVaccines,"件"]}),"のワクチン証明書承認待ちがあります。"]}),a.jsx(n,{to:"/admin/vaccine-approval",children:a.jsx(re,{size:"sm",className:"mt-2",children:"今すぐ確認する"})})]})]}),"facilities"===y&&a.jsxs(te,{className:"p-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"ペット関連施設承認管理"}),a.jsxs("p",{className:"text-gray-600",children:["詳細なペット関連施設の承認管理は",a.jsx(n,{to:"/admin/facility-approval",className:"text-blue-600 hover:text-blue-800 mx-1",children:"施設承認ページ"}),"で行えます。"]}),w.pendingFacilities>0&&a.jsxs("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:[a.jsxs("p",{className:"text-red-700",children:[a.jsxs("strong",{children:[w.pendingFacilities,"件"]}),"の施設承認待ちがあります。"]}),a.jsx(n,{to:"/admin/facility-approval",children:a.jsx(re,{size:"sm",className:"mt-2",children:"今すぐ確認する"})})]})]}),"users"===y&&a.jsxs(te,{className:"p-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"ユーザー管理"}),a.jsxs("p",{className:"text-gray-600",children:["詳細なユーザー管理は",a.jsx(n,{to:"/admin/users",className:"text-blue-600 hover:text-blue-800 mx-1",children:"ユーザー管理ページ"}),"で行えます。"]})]}),"maintenance"===y&&a.jsx(le,{onError:D,onSuccess:P})]})}},Symbol.toStringTag,{value:"Module"})),Ne=Object.freeze(Object.defineProperty({__proto__:null,AdminManagement:function(){const{user:i,isAdmin:d,userProfile:x}=ae(),m=e(),[o,h]=s.useState("vaccines"),[p,u]=s.useState(""),[g,j]=s.useState(""),N=ge(o),b=e=>{j(e),u(""),setTimeout((()=>j("")),5e3)},y=e=>{u(e),j(""),setTimeout((()=>u("")),8e3)},_=()=>{u(""),j("")};s.useEffect((()=>{i&&!d&&(async()=>{if("capasjapan@gmail.com"===(null==i?void 0:i.email)&&!d)try{(await oe(i.email)).success&&(b("管理者権限を設定しました。ページを再読み込みします..."),setTimeout((()=>window.location.reload()),1500))}catch(e){}})()}),[i,d]),s.useEffect((()=>{d?N.refetch():m("/")}),[d,m,o]);const w=async e=>{b(e),await N.refetch()},k=e=>{y(e)};return a.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[a.jsx("div",{className:"flex items-center space-x-4 mb-6",children:a.jsxs(n,{to:"/admin",className:"flex items-center text-blue-600 hover:text-blue-800",children:[a.jsx(v,{className:"w-4 h-4 mr-2"}),"管理者ダッシュボードに戻る"]})}),a.jsx("div",{className:"flex justify-between items-center",children:a.jsxs("h1",{className:"text-2xl font-bold flex items-center",children:[a.jsx(t,{className:"w-8 h-8 text-red-600 mr-3"}),"管理者審査ページ"]})}),p&&a.jsxs("div",{className:"mb-6 p-4 bg-red-50 rounded-lg flex items-start",children:[a.jsx(r,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),a.jsx("p",{className:"text-red-800",children:p})]}),g&&a.jsxs("div",{className:"mb-6 p-4 bg-green-50 rounded-lg flex items-start",children:[a.jsx(l,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),a.jsx("p",{className:"text-green-800",children:g})]}),!d&&a.jsxs(te,{className:"p-4 bg-red-50 border-l-4 border-red-500",children:[a.jsx("h3",{className:"font-semibold mb-3 text-red-900",children:"❌ 管理者権限が必要です"}),a.jsxs("div",{className:"text-sm text-red-800 space-y-2",children:[a.jsx("p",{children:a.jsx("strong",{children:"ユーザー情報:"})}),a.jsxs("p",{children:["• Email: ",(null==i?void 0:i.email)||"なし"]}),a.jsxs("p",{children:["• User Type: ",(null==x?void 0:x.user_type)||"undefined"]}),a.jsxs("p",{children:["• Is Admin: ",d?"true":"false"]}),"capasjapan@gmail.com"===(null==i?void 0:i.email)&&a.jsxs("div",{className:"mt-4 space-x-2",children:[a.jsx(re,{size:"sm",onClick:async()=>{_();try{const e=await oe(i.email||"");e.success?(b("管理者権限を設定しました。ページを再読み込みします..."),setTimeout((()=>window.location.reload()),1500)):y(`管理者権限の設定に失敗: ${e.error}`)}catch(e){y(`エラーが発生しました: ${e.message}`)}},className:"bg-blue-600 hover:bg-blue-700",children:"管理者権限を設定"}),a.jsx(re,{size:"sm",onClick:async()=>{if(_(),null==i?void 0:i.id)try{const e=await he(i.id);e.success?(b("プロファイルを更新しました。ページを再読み込みします..."),setTimeout((()=>window.location.reload()),1500)):y(`プロファイル更新に失敗: ${e.error}`)}catch(e){y(`エラーが発生しました: ${e.message}`)}else y("ユーザーIDが見つかりません")},className:"bg-orange-600 hover:bg-orange-700",children:"直接更新"})]})]})]}),d&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex space-x-4 border-b",children:[a.jsxs("button",{className:"px-4 py-2 font-medium "+("parks"===o?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>h("parks"),children:[a.jsx(c,{className:"w-4 h-4 inline mr-2"}),"ドッグラン審査"]}),a.jsxs("button",{className:"px-4 py-2 font-medium "+("vaccines"===o?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>h("vaccines"),children:[a.jsx(f,{className:"w-4 h-4 inline mr-2"}),"ワクチン証明書審査"]})]}),a.jsxs("div",{className:"mt-6",children:["parks"===o&&a.jsx(ne,{pendingParks:N.pendingParks,isLoading:N.isLoading,onApprovalComplete:w,onError:k}),"vaccines"===o&&a.jsx(ie,{pendingVaccines:N.pendingVaccines,isLoading:N.isLoading,onApprovalComplete:w,onError:k})]})]})]})}},Symbol.toStringTag,{value:"Module"})),ve=Object.freeze(Object.defineProperty({__proto__:null,AdminTasks:function(){const[e]=b(),[i,c]=s.useState({pendingVaccines:0,pendingParks:0,unreadMessages:0,pendingUsers:0}),[d,x]=s.useState([]),[m,h]=s.useState([]),[p,u]=s.useState(!0),[g,j]=s.useState(""),[N,S]=s.useState(""),[C,L]=s.useState("overview"),[D,$]=s.useState(!1);s.useEffect((()=>{const s=e.get("tab");s&&["overview","vaccines","parks","messages"].includes(s)&&L(s),P()}),[e]);const P=async()=>{try{u(!0);const{data:e,error:s}=await me.from("vaccine_certifications").select("\n          *,\n          dog:dogs(\n            *,\n            owner:profiles(*)\n          )\n        ").eq("status","pending").order("created_at",{ascending:!0});if(s)throw s;const{data:a,error:t}=await me.from("dog_parks").select("*").in("status",["pending","second_stage_review"]).order("created_at",{ascending:!0});if(t)throw t;x(e||[]),h(a||[]),c({pendingVaccines:(null==e?void 0:e.length)||0,pendingParks:(null==a?void 0:a.length)||0,unreadMessages:0,pendingUsers:0})}catch(e){pe("error","Error fetching task data",{error:e}),j("タスクデータの取得に失敗しました")}finally{u(!1)}},z=async(e,s)=>{$(!0),j(""),S("");try{const a=d.find((s=>s.id===e));if(!a)throw new Error("ワクチン証明書が見つかりません");const{error:t}=await me.from("vaccine_certifications").update({status:s?"approved":"rejected",reviewed_at:(new Date).toISOString()}).eq("id",e);if(t)throw t;const{error:r}=await me.from("notifications").insert([{user_id:a.dog.owner.id,type:"vaccine_review",title:s?"ワクチン証明書が承認されました":"ワクチン証明書について",message:s?`${a.dog.name}のワクチン証明書が承認されました。ドッグランのご利用が可能になりました。`:`${a.dog.name}のワクチン証明書の確認が必要です。マイページから再度アップロードしてください。`,data:{vaccine_id:e,dog_id:a.dog_id}}]);if(r)throw r;S(`ワクチン証明書を${s?"承認":"却下"}しました`),await P()}catch(a){pe("error","Error processing vaccine",{error:a}),j("ワクチン証明書の処理に失敗しました")}finally{$(!1)}},q=async(e,s)=>{$(!0),j(""),S("");try{const a=m.find((s=>s.id===e));if(!a)throw new Error("ドッグランが見つかりません");let t="";t=s?"pending"===a.status?"first_stage_passed":"qr_testing":"rejected";const{error:r}=await me.from("dog_parks").update({status:t,reviewed_at:(new Date).toISOString()}).eq("id",e);if(r)throw r;const{error:l}=await me.from("notifications").insert([{user_id:a.owner_id,type:"park_review",title:s?"審査結果のお知らせ":"審査結果について",message:s?`${a.name}の審査が通過しました。${"pending"===a.status?"詳細情報の入力にお進みください。":"QRコード実証検査の準備に入ります。"}`:`${a.name}の審査が不通過となりました。詳細はダッシュボードをご確認ください。`,data:{park_id:e}}]);if(l)throw l;S(`ドッグランを${s?"承認":"却下"}しました`),await P()}catch(a){pe("error","Error processing park",{error:a}),j("ドッグランの処理に失敗しました")}finally{$(!1)}},M=()=>i.pendingVaccines+i.pendingParks+i.unreadMessages+i.pendingUsers;return p?a.jsx("div",{className:"flex justify-center items-center h-64",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):a.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[a.jsx("div",{className:"flex items-center space-x-4 mb-6",children:a.jsxs(n,{to:"/admin",className:"flex items-center text-blue-600 hover:text-blue-800",children:[a.jsx(v,{className:"w-4 h-4 mr-2"}),"管理者ダッシュボードに戻る"]})}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{children:[a.jsxs("h1",{className:"text-2xl font-bold flex items-center",children:[a.jsx(r,{className:"w-8 h-8 text-red-600 mr-3"}),"緊急対応タスク"]}),a.jsx("p",{className:"text-gray-600",children:"承認待ちの項目を確認・処理してください"})]}),a.jsxs("div",{className:"text-sm text-gray-500",children:["合計タスク数: ",M(),"件"]})]}),g&&a.jsxs("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4 flex items-start",children:[a.jsx(r,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),a.jsx("p",{children:g})]}),N&&a.jsxs("div",{className:"bg-green-100 border border-green-300 text-green-800 rounded-lg p-4 flex items-start",children:[a.jsx(l,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),a.jsx("p",{children:N})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[a.jsx(te,{className:"p-6 cursor-pointer transition-all "+("vaccines"===C?"ring-2 ring-blue-500 bg-blue-50":"hover:shadow-lg"),onClick:()=>L("vaccines"),children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"ワクチン証明書"}),a.jsx("p",{className:"text-2xl font-bold text-red-600",children:i.pendingVaccines}),a.jsx("p",{className:"text-xs text-gray-500",children:"承認待ち"})]}),a.jsx(f,{className:"w-8 h-8 text-red-600"})]})}),a.jsx(te,{className:"p-6 cursor-pointer transition-all "+("parks"===C?"ring-2 ring-blue-500 bg-blue-50":"hover:shadow-lg"),onClick:()=>L("parks"),children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"ドッグラン審査"}),a.jsx("p",{className:"text-2xl font-bold text-orange-600",children:i.pendingParks}),a.jsx("p",{className:"text-xs text-gray-500",children:"審査待ち"})]}),a.jsx(o,{className:"w-8 h-8 text-orange-600"})]})}),a.jsx(te,{className:"p-6 cursor-pointer transition-all "+("messages"===C?"ring-2 ring-blue-500 bg-blue-50":"hover:shadow-lg"),onClick:()=>L("messages"),children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"お問い合わせ"}),a.jsx("p",{className:"text-2xl font-bold text-purple-600",children:i.unreadMessages}),a.jsx("p",{className:"text-xs text-gray-500",children:"未読"})]}),a.jsx(y,{className:"w-8 h-8 text-purple-600"})]})}),a.jsx(te,{className:"p-6 cursor-pointer transition-all "+("overview"===C?"ring-2 ring-blue-500 bg-blue-50":"hover:shadow-lg"),onClick:()=>L("overview"),children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"全体概要"}),a.jsx("p",{className:"text-2xl font-bold text-blue-600",children:M()}),a.jsx("p",{className:"text-xs text-gray-500",children:"総タスク数"})]}),a.jsx(t,{className:"w-8 h-8 text-blue-600"})]})})]}),"overview"===C&&a.jsx("div",{className:"space-y-6",children:a.jsxs(te,{className:"p-6",children:[a.jsx("h2",{className:"text-lg font-semibold mb-4",children:"タスク概要"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium mb-3",children:"優先度の高いタスク"}),a.jsxs("div",{className:"space-y-2",children:[i.pendingVaccines>0&&a.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded-lg",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(f,{className:"w-4 h-4 text-red-600"}),a.jsx("span",{className:"text-sm",children:"ワクチン証明書承認"})]}),a.jsxs("span",{className:"text-sm font-medium text-red-600",children:[i.pendingVaccines,"件"]})]}),i.pendingParks>0&&a.jsxs("div",{className:"flex items-center justify-between p-3 bg-orange-50 rounded-lg",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(o,{className:"w-4 h-4 text-orange-600"}),a.jsx("span",{className:"text-sm",children:"ドッグラン審査"})]}),a.jsxs("span",{className:"text-sm font-medium text-orange-600",children:[i.pendingParks,"件"]})]}),i.unreadMessages>0&&a.jsxs("div",{className:"flex items-center justify-between p-3 bg-purple-50 rounded-lg",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(y,{className:"w-4 h-4 text-purple-600"}),a.jsx("span",{className:"text-sm",children:"お問い合わせ対応"})]}),a.jsxs("span",{className:"text-sm font-medium text-purple-600",children:[i.unreadMessages,"件"]})]}),0===M()&&a.jsxs("div",{className:"text-center py-8",children:[a.jsx(l,{className:"w-12 h-12 text-green-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"すべてのタスクが完了しています"})]})]})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium mb-3",children:"処理時間の目安"}),a.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(_,{className:"w-4 h-4"}),a.jsx("span",{children:"ワクチン証明書: 2-3分/件"})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(_,{className:"w-4 h-4"}),a.jsx("span",{children:"ドッグラン審査: 5-10分/件"})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(_,{className:"w-4 h-4"}),a.jsx("span",{children:"お問い合わせ: 3-5分/件"})]})]})]})]})]})}),"vaccines"===C&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h2",{className:"text-lg font-semibold",children:"ワクチン証明書承認待ち"}),a.jsxs("div",{className:"text-sm text-gray-500",children:[i.pendingVaccines,"件の承認待ち"]})]}),0===d.length?a.jsxs(te,{className:"text-center py-12",children:[a.jsx(l,{className:"w-12 h-12 text-green-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"承認待ちのワクチン証明書はありません"})]}):a.jsx("div",{className:"space-y-4",children:d.map((e=>a.jsx(te,{className:"p-6",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[a.jsx("h3",{className:"font-semibold",children:e.dog.name}),a.jsxs("span",{className:"text-sm text-gray-500",children:["飼い主: ",e.dog.owner.name]}),a.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full",children:"承認待ち"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[a.jsxs("div",{children:[a.jsxs("p",{className:"text-gray-600",children:["犬種: ",e.dog.breed]}),a.jsxs("p",{className:"text-gray-600",children:["性別: ",e.dog.gender]}),a.jsxs("p",{className:"text-gray-600",children:["申請日: ",new Date(e.created_at).toLocaleDateString("ja-JP")]})]}),a.jsxs("div",{children:[a.jsxs("p",{className:"text-gray-600",children:["狂犬病ワクチン期限: ",e.rabies_expiry_date?new Date(e.rabies_expiry_date).toLocaleDateString("ja-JP"):"未設定"]}),a.jsxs("p",{className:"text-gray-600",children:["混合ワクチン期限: ",e.combo_expiry_date?new Date(e.combo_expiry_date).toLocaleDateString("ja-JP"):"未設定"]})]})]})]}),a.jsxs("div",{className:"flex space-x-2 ml-4",children:[a.jsx(n,{to:`/admin/management?tab=vaccines&vaccine=${e.id}`,children:a.jsxs(re,{size:"sm",variant:"secondary",children:[a.jsx(w,{className:"w-4 h-4 mr-1"}),"詳細"]})}),a.jsxs(re,{size:"sm",onClick:()=>z(e.id,!0),className:"bg-green-600 hover:bg-green-700",disabled:D,children:[a.jsx(l,{className:"w-4 h-4 mr-1"}),"承認"]}),a.jsxs(re,{size:"sm",onClick:()=>z(e.id,!1),className:"bg-red-600 hover:bg-red-700",disabled:D,children:[a.jsx(k,{className:"w-4 h-4 mr-1"}),"却下"]})]})]})},e.id)))})]}),"parks"===C&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h2",{className:"text-lg font-semibold",children:"ドッグラン審査待ち"}),a.jsxs("div",{className:"text-sm text-gray-500",children:[i.pendingParks,"件の審査待ち"]})]}),0===m.length?a.jsxs(te,{className:"text-center py-12",children:[a.jsx(l,{className:"w-12 h-12 text-green-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"審査待ちのドッグランはありません"})]}):a.jsx("div",{className:"space-y-4",children:m.map((e=>a.jsx(te,{className:"p-6",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[a.jsx("h3",{className:"font-semibold",children:e.name}),a.jsx("span",{className:"text-xs bg-orange-100 text-orange-800 px-2 py-1 rounded-full",children:"pending"===e.status?"第一審査待ち":"第二審査待ち"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[a.jsxs("div",{children:[a.jsxs("p",{className:"text-gray-600",children:["住所: ",e.address]}),a.jsxs("p",{className:"text-gray-600",children:["料金: ¥",e.price,"/時間"]})]}),a.jsxs("div",{children:[a.jsxs("p",{className:"text-gray-600",children:["申請日: ",new Date(e.created_at).toLocaleDateString("ja-JP")]}),a.jsxs("p",{className:"text-gray-600",children:["審査段階: ","pending"===e.status?"第一審査":"第二審査"]})]})]})]}),a.jsxs("div",{className:"flex space-x-2 ml-4",children:[a.jsx(n,{to:`/admin/management?tab=parks&park=${e.id}`,children:a.jsxs(re,{size:"sm",variant:"secondary",children:[a.jsx(w,{className:"w-4 h-4 mr-1"}),"詳細"]})}),a.jsxs(re,{size:"sm",onClick:()=>q(e.id,!0),className:"bg-green-600 hover:bg-green-700",disabled:D,children:[a.jsx(l,{className:"w-4 h-4 mr-1"}),"承認"]}),a.jsxs(re,{size:"sm",onClick:()=>q(e.id,!1),className:"bg-red-600 hover:bg-red-700",disabled:D,children:[a.jsx(k,{className:"w-4 h-4 mr-1"}),"却下"]})]})]})},e.id)))})]}),"messages"===C&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h2",{className:"text-lg font-semibold",children:"お問い合わせ対応"}),a.jsxs("div",{className:"text-sm text-gray-500",children:[i.unreadMessages,"件の未読"]})]}),a.jsxs(te,{className:"text-center py-12",children:[a.jsx(y,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600 mb-4",children:"お問い合わせ機能は準備中です"}),a.jsx("p",{className:"text-sm text-gray-500",children:"現在はメールでのお問い合わせ対応となります"})]})]})]})}},Symbol.toStringTag,{value:"Module"})),fe=Object.freeze(Object.defineProperty({__proto__:null,AdminUserManagement:function(){const{isAdmin:t}=ae(),r=e(),[l,c]=s.useState([]),[x,m]=s.useState([]),[o,h]=s.useState(!0),[p,u]=s.useState(""),[g,j]=s.useState(""),[f,b]=s.useState("all"),[y,_]=s.useState("created_at"),[k,q]=s.useState("desc");s.useEffect((()=>{t?M():r("/")}),[t,r]),s.useEffect((()=>{O()}),[l,g,f,y,k]);const M=async()=>{try{h(!0),u("");const{data:e,error:s}=await me.from("profiles").select("\n          id,\n          name,\n          user_type,\n          postal_code,\n          address,\n          phone_number,\n          created_at\n        ");if(s)throw new Error("プロファイル情報の取得に失敗しました");if(!e||0===e.length)return void c([]);const a=e.map((async e=>{try{const{count:s}=await me.from("dogs").select("id",{count:"exact"}).eq("owner_id",e.id),a=new Date;a.setDate(1),a.setHours(0,0,0,0);const{count:t}=await me.from("reservations").select("id",{count:"exact"}).eq("user_id",e.id).gte("created_at",a.toISOString()),{data:r}=await me.from("reservations").select("total_amount").eq("user_id",e.id).not("total_amount","is",null),l=(r||[]).reduce(((e,s)=>e+(s.total_amount||0)),0),n=`user_${e.id.slice(0,8)}@unknown.com`;return{id:e.id,name:e.name||"Unknown",email:n,phone:e.phone_number||"",created_at:e.created_at,last_sign_in_at:"",is_active:!0,subscription_status:"inactive",dog_count:s||0,reservation_count:t||0,total_spent:l}}catch(s){return{id:e.id,name:e.name||"Unknown",email:`user_${e.id.slice(0,8)}@unknown.com`,phone:e.phone_number||"",created_at:e.created_at,last_sign_in_at:"",is_active:!0,subscription_status:"inactive",dog_count:0,reservation_count:0,total_spent:0}}})),t=await Promise.all(a);c(t)}catch(e){u(e instanceof Error?e.message:"ユーザー情報の取得に失敗しました")}finally{h(!1)}},O=()=>{let e=[...l];g&&(e=e.filter((e=>e.name.toLowerCase().includes(g.toLowerCase())||e.email.toLowerCase().includes(g.toLowerCase())))),"all"!==f&&(e=e.filter((e=>{switch(f){case"active":return e.is_active;case"inactive":return!e.is_active;case"subscribers":return"active"===e.subscription_status;default:return!0}}))),e.sort(((e,s)=>{const a=e[y]||"",t=s[y]||"";return"asc"===k?a>t?1:-1:a<t?1:-1})),m(e)},U=e=>"active"===e.subscription_status?a.jsxs("span",{className:"bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-xs font-medium flex items-center",children:[a.jsx(C,{className:"w-3 h-3 mr-1"}),"サブスク"]}):e.is_active?a.jsxs("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium flex items-center",children:[a.jsx(S,{className:"w-3 h-3 mr-1"}),"アクティブ"]}):a.jsxs("span",{className:"bg-gray-100 text-gray-800 px-2 py-1 rounded-full text-xs font-medium flex items-center",children:[a.jsx(z,{className:"w-3 h-3 mr-1"}),"非アクティブ"]});return o?a.jsx("div",{className:"flex justify-center items-center h-64",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"flex items-center space-x-4 mb-6",children:a.jsxs(n,{to:"/admin",className:"flex items-center text-gray-600 hover:text-gray-800",children:[a.jsx(v,{className:"w-4 h-4 mr-2"}),"ダッシュボードに戻る"]})}),a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("div",{children:[a.jsxs("h1",{className:"text-2xl font-bold flex items-center",children:[a.jsx(i,{className:"w-8 h-8 text-blue-600 mr-3"}),"ユーザー管理"]}),a.jsx("p",{className:"text-gray-600",children:"登録ユーザーの詳細情報と管理"})]}),a.jsxs("div",{className:"text-sm text-gray-500",children:["総ユーザー数: ",l.length,"人"]})]}),p&&a.jsx("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4",children:p}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsx(te,{className:"p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"総ユーザー数"}),a.jsx("p",{className:"text-xl font-bold text-blue-600",children:l.length})]}),a.jsx(i,{className:"w-6 h-6 text-blue-600"})]})}),a.jsx(te,{className:"p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"アクティブユーザー"}),a.jsx("p",{className:"text-xl font-bold text-green-600",children:l.filter((e=>e.is_active)).length})]}),a.jsx(S,{className:"w-6 h-6 text-green-600"})]})}),a.jsx(te,{className:"p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"サブスク会員"}),a.jsx("p",{className:"text-xl font-bold text-purple-600",children:l.filter((e=>"active"===e.subscription_status)).length})]}),a.jsx(C,{className:"w-6 h-6 text-purple-600"})]})}),a.jsx(te,{className:"p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"今月新規登録"}),a.jsx("p",{className:"text-xl font-bold text-orange-600",children:l.filter((e=>{const s=new Date(e.created_at),a=new Date;return s.getMonth()===a.getMonth()&&s.getFullYear()===a.getFullYear()})).length})]}),a.jsx(d,{className:"w-6 h-6 text-orange-600"})]})})]}),a.jsxs(te,{className:"p-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsx("div",{className:"md:col-span-2",children:a.jsx(ce,{label:"検索",placeholder:"名前またはメールアドレスで検索...",value:g,onChange:e=>j(e.target.value),icon:a.jsx(L,{className:"w-4 h-4 text-gray-500"})})}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ステータス"}),a.jsxs("select",{value:f,onChange:e=>b(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:"all",children:"すべて"}),a.jsx("option",{value:"active",children:"アクティブ"}),a.jsx("option",{value:"inactive",children:"非アクティブ"}),a.jsx("option",{value:"subscribers",children:"サブスク会員"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"並び順"}),a.jsxs("select",{value:`${y}-${k}`,onChange:e=>{const[s,a]=e.target.value.split("-");_(s),q(a)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:"created_at-desc",children:"登録日（新しい順）"}),a.jsx("option",{value:"created_at-asc",children:"登録日（古い順）"}),a.jsx("option",{value:"name-asc",children:"名前（昇順）"}),a.jsx("option",{value:"name-desc",children:"名前（降順）"}),a.jsx("option",{value:"total_spent-desc",children:"支払額（高い順）"}),a.jsx("option",{value:"total_spent-asc",children:"支払額（低い順）"})]})]})]}),a.jsxs("div",{className:"flex justify-between items-center mt-4",children:[a.jsxs("p",{className:"text-sm text-gray-600",children:[x.length,"件のユーザーが見つかりました"]}),a.jsxs(re,{variant:"secondary",size:"sm",onClick:()=>{const e=[["名前","メールアドレス","電話番号","登録日","犬数","予約数","支払額","サブスクリプション"].join(","),...x.map((e=>[e.name,e.email,e.phone||"",new Date(e.created_at).toLocaleDateString("ja-JP"),e.dog_count,e.reservation_count,e.total_spent,e.subscription_status].join(",")))].join("\n"),s=new Blob([e],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");a.href=URL.createObjectURL(s),a.download=`users-${(new Date).toISOString().split("T")[0]}.csv`,a.click()},children:[a.jsx(N,{className:"w-4 h-4 mr-1"}),"CSV出力"]})]})]}),a.jsx(te,{children:a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ユーザー"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"連絡先"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"登録日"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"最終ログイン"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ステータス"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"統計"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"操作"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:x.map((e=>a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.name}),a.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",e.id.slice(0,8),"..."]})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex items-center text-sm text-gray-900",children:[a.jsx(D,{className:"w-4 h-4 mr-2 text-gray-400"}),e.email]}),e.phone&&a.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[a.jsx($,{className:"w-4 h-4 mr-2 text-gray-400"}),e.phone]})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.created_at).toLocaleDateString("ja-JP")}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.last_sign_in_at?new Date(e.last_sign_in_at).toLocaleDateString("ja-JP"):"未ログイン"}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:U(e)}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"space-y-1 text-sm",children:[a.jsxs("div",{className:"flex items-center text-gray-900",children:[a.jsx(P,{className:"w-4 h-4 mr-1 text-gray-400"}),"犬: ",e.dog_count,"匹"]}),a.jsxs("div",{className:"text-gray-500",children:["予約: ",e.reservation_count,"件"]}),a.jsxs("div",{className:"text-gray-500",children:["支払: ¥",e.total_spent.toLocaleString()]})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:a.jsx("div",{className:"flex items-center space-x-2",children:a.jsx(re,{size:"sm",variant:"secondary",onClick:()=>r(`/admin/users/${e.id}`),children:a.jsx(w,{className:"w-4 h-4"})})})})]},e.id)))})]})})})]})}},Symbol.toStringTag,{value:"Module"})),be=Object.freeze(Object.defineProperty({__proto__:null,AdminParkManagement:function(){const{isAdmin:t}=ae(),l=e(),[m,h]=s.useState("applications"),[p,u]=s.useState([]),[g,j]=s.useState([]),[N,v]=s.useState([]),[f,b]=s.useState([]),[y,_]=s.useState([]),[S,C]=s.useState(!0),[D,$]=s.useState(""),[P,z]=s.useState(""),[F,R]=s.useState(""),[A,V]=s.useState("all"),[J,Y]=s.useState("created_at"),[B,W]=s.useState("desc"),[K,Q]=s.useState(null),G=ge("parks"),H=()=>{Q(null)},X=e=>{z(e),$(""),setTimeout((()=>z("")),5e3)},Z=e=>{$(e),z(""),setTimeout((()=>$("")),8e3)},ee=async e=>{if(window.confirm("このドッグラン申請を削除してもよろしいですか？この操作は取り消せません。"))try{$(""),z("");const{error:s}=await me.from("dog_parks").delete().eq("id",e);if(s)return void Z("ドッグランの削除に失敗しました。");X("ドッグラン申請を削除しました。"),u((s=>s.filter((s=>s.id!==e))))}catch(s){Z("ドッグランの削除に失敗しました。")}},se=e=>({id:e.id,name:e.name,description:e.description||"",address:e.address,price:e.price||0,status:e.status,owner_id:e.owner_id,created_at:e.created_at,max_capacity:e.max_capacity||0,large_dog_area:e.large_dog_area||!1,small_dog_area:e.small_dog_area||!1,private_booths:e.private_booths||!1,facilities:e.facilities||{parking:!1,shower:!1,restroom:!1,agility:!1,rest_area:!1,water_station:!1},average_rating:e.average_rating||0,review_count:e.review_count||0,facility_details:e.facility_details||"",private_booth_count:e.private_booth_count||0,image_url:e.image_url||"",cover_image_url:e.cover_image_url||"",owner_name:e.owner_name||"Unknown",owner_email:e.owner_email||"Unknown",owner_phone:e.owner_phone_number||"",owner_address:e.owner_address||"",facility_images:e.facility_images||[],identity_document_url:e.identity_document_url||"",identity_document_filename:e.identity_document_filename||"",identity_status:e.identity_status||"not_submitted",identity_created_at:e.identity_created_at||""});s.useEffect((()=>{t||l("/admin-dashboard")}),[t,l]),s.useEffect((()=>{if(G.isLoading)C(!0);else{const e=G.pendingParks.map(se);u(e),C(!1),ne(),(async()=>{try{const{data:e,error:s}=await me.from("dog_parks").select("\n          *,\n          profiles:owner_id (\n            name,\n            address,\n            phone_number,\n            email,\n            postal_code\n          )\n        ").eq("status","approved").order("created_at",{ascending:!1});return s?[]:e.map(se)}catch(e){return[]}})().then((e=>{b(e),le(e)}))}}),[G.pendingParks,G.isLoading]);const le=e=>{let s=e.filter((e=>(!F||e.name.toLowerCase().includes(F.toLowerCase())||e.address.toLowerCase().includes(F.toLowerCase())||e.owner_name.toLowerCase().includes(F.toLowerCase()))&&("all"===A||"approved"===A)));s=s.sort(((e,s)=>{let a,t;switch(J){case"name":a=e.name,t=s.name;break;case"average_rating":a=e.average_rating||0,t=s.average_rating||0;break;default:a=e.created_at,t=s.created_at}return"asc"===B?a>t?1:-1:a<t?1:-1})),v(s)};s.useEffect((()=>{f.length>0&&le(f)}),[F,A,J,B,f]),s.useEffect((()=>{p.length>0&&ne()}),[F,A,J,B,p]);const ne=()=>{const e=["pending","first_stage_passed","second_stage_review"];let s=p.filter((e=>{const s=!F||e.name.toLowerCase().includes(F.toLowerCase())||e.address.toLowerCase().includes(F.toLowerCase())||e.owner_name.toLowerCase().includes(F.toLowerCase()),a="all"===A||e.status===A;return s&&a}));s=s.sort(((e,s)=>{let a,t;switch(J){case"name":a=e.name,t=s.name;break;case"average_rating":a=e.average_rating||0,t=s.average_rating||0;break;default:a=e.created_at,t=s.created_at}return"asc"===B?a>t?1:-1:a<t?1:-1}));const a=s.filter((s=>e.includes(s.status)));_(a),j(s)},ie=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"first_stage_passed":return"bg-blue-100 text-blue-800";case"second_stage_review":return"bg-purple-100 text-purple-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},xe=e=>{switch(e){case"pending":return"一次審査中";case"first_stage_passed":return"二次審査提出待ち";case"second_stage_review":return"二次審査中";case"qr_testing_ready":return"公開準備中";case"editing":return"編集中";case"ready_to_publish":return"公開準備完了";case"qr_testing":return"QRテスト中";case"approved":return"承認済み";case"rejected":return"却下";default:return"不明"}},oe=e=>`¥${e.toLocaleString()}`,he=e=>new Date(e).toLocaleDateString("ja-JP",{year:"numeric",month:"short",day:"numeric"});return S?a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"データを読み込み中..."})]})}):a.jsxs("div",{className:"min-h-screen bg-gray-50 py-8",children:[a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[a.jsxs("div",{className:"bg-white shadow rounded-lg mb-8",children:[a.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"ドッグラン管理"}),a.jsx("p",{className:"text-gray-600",children:"ドッグラン施設の詳細情報と申請管理"})]}),D&&a.jsx("div",{className:"px-6 py-4 bg-red-50 border-l-4 border-red-400",children:a.jsxs("div",{className:"flex",children:[a.jsx(r,{className:"h-5 w-5 text-red-400 mr-2"}),a.jsx("p",{className:"text-sm text-red-700",children:D})]})}),P&&a.jsx("div",{className:"px-6 py-4 bg-green-50 border-l-4 border-green-400",children:a.jsxs("div",{className:"flex",children:[a.jsx(q,{className:"h-5 w-5 text-green-400 mr-2"}),a.jsx("p",{className:"text-sm text-green-700",children:P})]})}),a.jsx("div",{className:"px-6",children:a.jsxs("nav",{className:"flex space-x-8","aria-label":"Tabs",children:[a.jsxs("button",{onClick:()=>h("applications"),className:"whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm "+("applications"===m?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[a.jsx(M,{className:"w-5 h-5 inline mr-2"}),"ドッグラン申請",a.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:y.length})]}),a.jsxs("button",{onClick:()=>h("parks"),className:"whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm "+("parks"===m?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[a.jsx(o,{className:"w-5 h-5 inline mr-2"}),"ドッグラン一覧",a.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:N.length})]})]})})]}),"parks"===m&&a.jsxs("div",{className:"space-y-6",children:[a.jsx(te,{className:"p-6",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsxs("div",{className:"relative",children:[a.jsx(L,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(ce,{label:"",placeholder:"施設名、住所、オーナー名で検索...",value:F,onChange:e=>R(e.target.value),className:"pl-10"})]}),a.jsx(de,{label:"",options:[{value:"all",label:"全ステータス"},{value:"approved",label:"承認済み"}],value:A,onChange:e=>V(e.target.value)}),a.jsx(de,{label:"",options:[{value:"created_at",label:"作成日時"},{value:"name",label:"施設名"},{value:"average_rating",label:"平均評価"}],value:J,onChange:e=>Y(e.target.value)}),a.jsxs(re,{variant:"secondary",onClick:()=>W("asc"===B?"desc":"asc"),className:"flex items-center justify-center",children:["asc"===B?a.jsx(O,{className:"w-4 h-4 mr-2"}):a.jsx(U,{className:"w-4 h-4 mr-2"}),"asc"===B?"昇順":"降順"]})]})}),0===N.length?a.jsxs(te,{className:"text-center py-12",children:[a.jsx(o,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:F||"all"!==A?"条件に一致するドッグランが見つかりません":"承認済みのドッグランがありません"})]}):a.jsx("div",{className:"grid grid-cols-1 gap-6",children:N.map((e=>a.jsx(te,{className:"p-6",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),a.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${ie(e.status)}`,children:xe(e.status)})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[a.jsx(c,{className:"w-4 h-4 mr-1"}),e.address]}),a.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[a.jsx(x,{className:"w-4 h-4 mr-1"}),oe(e.price)]}),a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(d,{className:"w-4 h-4 mr-1"}),he(e.created_at)]})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[a.jsx(T,{className:"w-4 h-4 mr-1"}),e.owner_name]}),a.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-1",children:[a.jsx(i,{className:"w-4 h-4 mr-1"}),"定員: ",e.max_capacity,"頭"]}),e.average_rating&&e.average_rating>0&&a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(E,{className:"w-4 h-4 mr-1"}),e.average_rating.toFixed(1)," (",e.review_count||0,"件)"]})]})]}),e.description&&a.jsx("p",{className:"text-sm text-gray-600 mb-3",children:e.description}),a.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.large_dog_area&&a.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:"大型犬エリア"}),e.small_dog_area&&a.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded",children:"小型犬エリア"}),e.private_booths&&a.jsx("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded",children:"個室あり"}),e.facilities.parking&&a.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"駐車場"}),e.facilities.shower&&a.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"シャワー"})]})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs(n,{to:`/parks/${e.id}`,className:"flex items-center px-3 py-1 text-sm bg-blue-100 text-blue-800 rounded-md hover:bg-blue-200",children:[a.jsx(w,{className:"w-4 h-4 mr-1"}),"詳細"]}),a.jsxs(re,{size:"sm",variant:"secondary",onClick:()=>ee(e.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[a.jsx(I,{className:"w-4 h-4 mr-1"}),"削除"]})]})]})},e.id)))})]}),"applications"===m&&a.jsxs("div",{className:"space-y-6",children:[a.jsx(te,{className:"p-6",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsxs("div",{className:"relative",children:[a.jsx(L,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),a.jsx(ce,{label:"",placeholder:"施設名、住所、オーナー名で検索...",value:F,onChange:e=>R(e.target.value),className:"pl-10"})]}),a.jsx(de,{label:"",options:[{value:"all",label:"全ステータス"},{value:"pending",label:"審査中"},{value:"first_stage_passed",label:"二次審査提出待ち"},{value:"second_stage_review",label:"2次審査中"},{value:"rejected",label:"却下"}],value:A,onChange:e=>V(e.target.value)}),a.jsx(de,{label:"",options:[{value:"created_at",label:"作成日時"},{value:"name",label:"施設名"},{value:"average_rating",label:"平均評価"}],value:J,onChange:e=>Y(e.target.value)}),a.jsxs(re,{variant:"secondary",onClick:()=>W("asc"===B?"desc":"asc"),className:"flex items-center justify-center",children:["asc"===B?a.jsx(O,{className:"w-4 h-4 mr-2"}):a.jsx(U,{className:"w-4 h-4 mr-2"}),"asc"===B?"昇順":"降順"]})]})}),0===y.length?a.jsxs(te,{className:"text-center py-12",children:[a.jsx(M,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:F||"all"!==A?"条件に一致する申請が見つかりません":"審査中の申請がありません"})]}):a.jsx("div",{className:"grid grid-cols-1 gap-6",children:y.map((e=>a.jsxs(te,{className:"p-6",children:[a.jsx("div",{className:"flex items-start justify-between mb-4",children:a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),a.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${ie(e.status)}`,children:xe(e.status)})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-4",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"申請者情報"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(T,{className:"w-4 h-4 mr-2"}),e.owner_name]}),a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(c,{className:"w-4 h-4 mr-2"}),e.owner_address||"住所未登録"]}),a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(d,{className:"w-4 h-4 mr-2"}),"申請日: ",he(e.created_at)]})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"施設情報"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(c,{className:"w-4 h-4 mr-2"}),e.address]}),a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(x,{className:"w-4 h-4 mr-2"}),oe(e.price)]}),a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(i,{className:"w-4 h-4 mr-2"}),"定員: ",e.max_capacity,"頭"]})]})]})]}),a.jsxs("div",{className:"mb-4",children:[a.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center",children:[a.jsx(M,{className:"w-4 h-4 mr-2"}),"本人確認書類"]}),a.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.identity_document_url&&""!==e.identity_document_url?a.jsxs("div",{className:"flex items-start space-x-4",children:[a.jsx("div",{className:"relative",children:a.jsx("img",{src:`${me.storage.from("vaccine-certs").getPublicUrl(e.identity_document_url||"").data.publicUrl}`,alt:"本人確認書類",className:"w-32 h-32 object-cover rounded border shadow-sm cursor-pointer hover:shadow-md transition-shadow",onClick:()=>{window.open(`${me.storage.from("vaccine-certs").getPublicUrl(e.identity_document_url||"").data.publicUrl}`,"_blank")}})}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"mb-2",children:[a.jsx("span",{className:"text-sm font-medium text-gray-700",children:"ファイル名:"}),a.jsx("span",{className:"text-sm text-gray-600 ml-2",children:e.identity_document_filename||"identity_document"})]}),a.jsxs("div",{className:"mb-2",children:[a.jsx("span",{className:"text-sm font-medium text-gray-700",children:"審査状況:"}),a.jsx("span",{className:"text-sm ml-2 px-2 py-1 rounded-full "+("approved"===e.identity_status?"bg-green-100 text-green-800":"rejected"===e.identity_status?"bg-red-100 text-red-800":"submitted"===e.identity_status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:"approved"===e.identity_status?"承認済み":"rejected"===e.identity_status?"却下":"submitted"===e.identity_status?"審査中":"未提出"})]}),e.identity_created_at&&a.jsxs("div",{className:"mb-2",children:[a.jsx("span",{className:"text-sm font-medium text-gray-700",children:"提出日:"}),a.jsx("span",{className:"text-sm text-gray-600 ml-2",children:he(e.identity_created_at)})]}),a.jsx("div",{className:"text-xs text-gray-500 mt-2",children:"クリックして拡大表示"})]})]}):a.jsxs("div",{className:"text-center py-8",children:[a.jsx(M,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),a.jsx("p",{className:"text-sm text-gray-600",children:"本人確認書類が提出されていません"})]})})]}),e.description&&a.jsxs("div",{className:"mb-4",children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"施設説明"}),a.jsx("p",{className:"text-sm text-gray-600",children:e.description})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"設備・サービス"}),a.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.large_dog_area&&a.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:"大型犬エリア"}),e.small_dog_area&&a.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded",children:"小型犬エリア"}),e.private_booths&&a.jsx("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded",children:"個室あり"}),e.facilities.parking&&a.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"駐車場"}),e.facilities.shower&&a.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"シャワー"}),e.facilities.restroom&&a.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"トイレ"}),e.facilities.agility&&a.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"アジリティ"}),e.facilities.rest_area&&a.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"休憩エリア"}),e.facilities.water_station&&a.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded",children:"給水設備"})]})]}),"second_stage_review"===e.status&&e.facility_images&&e.facility_images.length>0&&a.jsxs("div",{className:"mb-4",children:[a.jsxs("h4",{className:"font-medium text-gray-900 mb-2",children:["設備画像 (",e.facility_images.length,"枚)"]}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:e.facility_images.map(((s,t)=>a.jsxs("div",{className:"relative",children:[a.jsx("img",{src:s.image_url,alt:`設備画像 ${t+1}`,className:"w-full h-24 object-cover rounded-md border cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>{return a=s.image_url,t=s.image_type,r=e.name,void Q({url:a,type:t,parkName:r});var a,t,r}}),a.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded-b-md",children:s.image_type})]},s.id)))})]})]})}),a.jsxs("div",{className:"flex justify-end space-x-2",children:[("pending"===e.status||"first_stage_passed"===e.status||"second_stage_review"===e.status)&&a.jsxs(a.Fragment,{children:[a.jsxs(re,{size:"sm",onClick:()=>(async e=>{const s=p.find((s=>s.id===e));if(!s)return;let a,t,r,l,n;switch(s.status){case"pending":a="first_stage_passed",t="このドッグランの第一審査を承認してもよろしいですか？\n承認後、オーナーは第二審査（設備画像の提出）を行うことができます。",r="ドッグランの第一審査を承認しました。オーナーに通知されます。",l="ドッグラン第一審査承認",n=`${s.name}の第一審査が承認されました。第二審査の詳細情報を入力してください。`;break;case"first_stage_passed":return a="first_stage_passed",t="このドッグランは既に第一審査を通過しています。オーナーが第二審査（設備画像）を提出するのをお待ちください。",void Z("このドッグランは既に第一審査を通過しています。");case"second_stage_review":a="qr_testing_ready",t="このドッグランの第二審査を承認してもよろしいですか？\n承認後、オーナーがスマートロックのテストと掲載ページの編集を行い、公開準備を完了させることができます。",r="ドッグランの第二審査を承認しました。オーナーが公開準備を行います。",l="ドッグラン第二審査承認",n=`${s.name}の第二審査が承認されました。おめでとうございます！次に、スマートロックのテストと掲載ページの編集を行い、公開準備を完了させてください。`;break;case"approved":return void Z("このドッグランは既に承認済みです。");default:return void Z("このドッグランの現在のステータスでは承認できません。")}if(window.confirm(t))try{$(""),z("");const{error:t}=await me.from("dog_parks").update({status:a}).eq("id",e);if(t)return void Z("承認の処理に失敗しました。");await me.from("notifications").insert([{user_id:s.owner_id,title:l,message:n,type:"approved"===a?"park_approved":"park_first_stage_passed",created_at:(new Date).toISOString(),read:!1}]),X(r),u((s=>s.map((s=>s.id===e?{...s,status:a}:s))))}catch(i){Z("承認の処理に失敗しました。")}})(e.id),className:"bg-green-600 hover:bg-green-700",children:[a.jsx(q,{className:"w-4 h-4 mr-1"}),"pending"===e.status?"第一審査承認":"second_stage_review"===e.status?"第二審査承認":"承認"]}),a.jsxs(re,{size:"sm",variant:"secondary",onClick:()=>(async e=>{if(window.confirm("このドッグラン申請を却下してもよろしいですか？"))try{$(""),z("");const{error:s}=await me.from("dog_parks").update({status:"rejected"}).eq("id",e);if(s)return void Z("却下の処理に失敗しました。");const a=p.find((s=>s.id===e));a&&await me.from("notifications").insert([{user_id:a.owner_id,title:"ドッグラン申請却下",message:`${a.name}の申請が却下されました。詳細については管理者までお問い合わせください。`,type:"park_rejected",created_at:(new Date).toISOString(),read:!1}]),X("ドッグラン申請を却下しました。"),u((s=>s.map((s=>s.id===e?{...s,status:"rejected"}:s))))}catch(s){Z("却下の処理に失敗しました。")}})(e.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[a.jsx(k,{className:"w-4 h-4 mr-1"}),"却下"]})]}),a.jsxs(re,{size:"sm",variant:"secondary",onClick:()=>ee(e.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[a.jsx(I,{className:"w-4 h-4 mr-1"}),"削除"]})]})]},e.id)))})]})]}),K&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",onClick:H,onKeyDown:e=>{"Escape"===e.key&&H()},tabIndex:0,children:a.jsxs("div",{className:"relative max-w-4xl max-h-full",children:[a.jsx("img",{src:K.url,alt:`${K.parkName} - ${K.type}`,className:"max-w-full max-h-full object-contain rounded-lg",onClick:e=>e.stopPropagation()}),a.jsxs("div",{className:"absolute bottom-4 left-4 right-4 bg-black bg-opacity-50 text-white p-3 rounded-lg",children:[a.jsx("h3",{className:"font-medium text-lg",children:K.parkName}),a.jsx("p",{className:"text-sm text-gray-300",children:K.type})]}),a.jsx("button",{onClick:H,className:"absolute top-4 right-4 text-white hover:text-gray-300 bg-black bg-opacity-50 rounded-full p-2",children:a.jsx(k,{className:"w-6 h-6"})})]})})]})}},Symbol.toStringTag,{value:"Module"})),ye=Object.freeze(Object.defineProperty({__proto__:null,AdminReservationManagement:function(){const{isAdmin:t}=ae(),i=e(),[c,m]=s.useState([]),[o,h]=s.useState([]),[p,u]=s.useState(null),[g,j]=s.useState(!0),[f,b]=s.useState(""),[y,k]=s.useState(""),[S,D]=s.useState("all"),[$,P]=s.useState(""),[z,q]=s.useState("reservation_date"),[M,O]=s.useState("desc");s.useEffect((()=>{t?(U(),T()):i("/")}),[t,i]),s.useEffect((()=>{E()}),[c,y,S,$,z,M]);const U=async()=>{try{j(!0),b("");const{data:s,error:a}=await me.from("reservations").select("\n          id,\n          user_id,\n          park_id,\n          dog_id,\n          date,\n          start_time,\n          duration,\n          status,\n          total_amount,\n          reservation_type,\n          created_at,\n          updated_at\n        ").order("created_at",{ascending:!1});if(a)throw new Error("予約情報の取得に失敗しました");if(!s||0===s.length)return void m([]);let t=null;try{const{data:e,error:s}=await me.auth.admin.listUsers();s||(t=e)}catch(e){}const r=s.map((async e=>{var s;try{const{data:r}=await me.from("profiles").select("name, user_type").eq("id",e.user_id).single(),{data:l}=await me.from("dog_parks").select("name, address").eq("id",e.park_id).single(),{data:n}=await me.from("dogs").select("name, breed").eq("id",e.dog_id).single();let i=null;try{const{data:s}=await me.from("stripe_subscriptions").select("status").eq("user_id",e.user_id).eq("status","active").maybeSingle();i=s}catch(a){}const c=null==(s=null==t?void 0:t.users)?void 0:s.find((s=>s.id===e.user_id)),d=null==c?void 0:c.email;return{id:e.id,user_name:(null==r?void 0:r.name)||"Unknown",user_email:d||`user_${e.user_id.slice(0,8)}@unknown.com`,park_id:e.park_id,park_name:(null==l?void 0:l.name)||"Unknown Park",park_address:(null==l?void 0:l.address)||"Unknown Address",dog_name:(null==n?void 0:n.name)||"Unknown Dog",dog_breed:(null==n?void 0:n.breed)||"Unknown Breed",dog_count:1,reservation_date:e.date,start_time:e.start_time,duration:e.duration||1,total_price:e.total_amount||0,status:e.status,reservation_type:e.reservation_type,is_subscription:!!i,payment_status:e.total_amount>0?"paid":"pending",created_at:e.created_at,updated_at:e.updated_at}}catch(r){return{id:e.id,user_name:"Unknown",user_email:`user_${e.user_id.slice(0,8)}@unknown.com`,park_id:e.park_id,park_name:"Unknown Park",park_address:"Unknown Address",dog_name:"Unknown Dog",dog_breed:"Unknown Breed",dog_count:1,reservation_date:e.date,start_time:e.start_time,duration:e.duration||1,total_price:e.total_amount||0,status:e.status,reservation_type:e.reservation_type,is_subscription:!1,payment_status:"pending",created_at:e.created_at,updated_at:e.updated_at}}})),l=await Promise.all(r);m(l)}catch(s){b(`予約データの取得に失敗しました: ${s instanceof Error?s.message:"不明なエラー"}`)}finally{j(!1)}},T=async()=>{try{const{data:e,error:s}=await me.rpc("get_admin_reservation_stats");if(s)throw s;u(e)}catch(e){}},E=()=>{let e=[...c];if(y&&(e=e.filter((e=>e.user_name.toLowerCase().includes(y.toLowerCase())||e.user_email.toLowerCase().includes(y.toLowerCase())||e.park_name.toLowerCase().includes(y.toLowerCase())))),"all"!==S&&(e=e.filter((e=>e.status===S))),$){const s=new Date($);e=e.filter((e=>new Date(e.reservation_date).toDateString()===s.toDateString()))}e.sort(((e,s)=>{let a=e[z],t=s[z];return"reservation_date"!==z&&"created_at"!==z||(a=new Date(a).getTime(),t=new Date(t).getTime()),"asc"===M?a>t?1:-1:a<t?1:-1})),h(e)},I=e=>({confirmed:"確定",cancelled:"キャンセル",completed:"完了"}[e]||e),A=e=>({pending:"未払い",paid:"支払済み",refunded:"返金済み"}[e]||e),V=e=>{const s={confirmed:{color:"bg-green-100 text-green-800",icon:l},cancelled:{color:"bg-red-100 text-red-800",icon:R},completed:{color:"bg-blue-100 text-blue-800",icon:l}},t=s[e]||s.confirmed,r=t.icon;return a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx(r,{className:"w-4 h-4"}),a.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${t.color}`,children:I(e)})]})},J=e=>{const s={pending:{color:"bg-yellow-100 text-yellow-800",icon:_},paid:{color:"bg-green-100 text-green-800",icon:l},refunded:{color:"bg-gray-100 text-gray-800",icon:r}},t=s[e]||s.pending,n=t.icon;return a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx(n,{className:"w-4 h-4"}),a.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${t.color}`,children:A(e)})]})};if(g)return a.jsx("div",{className:"flex justify-center items-center h-64",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})});const Y=o.reduce(((e,s)=>e+s.total_price),0),B=o.length>0?Y/o.length:0,W=o.filter((e=>e.is_subscription)).length,K=c.length>0?c.filter((e=>"cancelled"===e.status)).length/c.length*100:0;return a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"flex items-center space-x-4 mb-6",children:a.jsxs(n,{to:"/admin",className:"flex items-center text-gray-600 hover:text-gray-800",children:[a.jsx(v,{className:"w-4 h-4 mr-2"}),"ダッシュボードに戻る"]})}),a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("div",{children:[a.jsxs("h1",{className:"text-2xl font-bold flex items-center",children:[a.jsx(d,{className:"w-8 h-8 text-purple-600 mr-3"}),"予約管理"]}),a.jsx("p",{className:"text-gray-600",children:"予約の詳細情報と統計分析"})]}),a.jsxs("div",{className:"text-sm text-gray-500",children:["総予約数: ",c.length,"件"]})]}),f&&a.jsx("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4",children:f}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsx(te,{className:"p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"総予約数"}),a.jsx("p",{className:"text-xl font-bold text-purple-600",children:c.length})]}),a.jsx(d,{className:"w-6 h-6 text-purple-600"})]})}),a.jsx(te,{className:"p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"サブスク予約"}),a.jsx("p",{className:"text-xl font-bold text-blue-600",children:W}),a.jsxs("p",{className:"text-xs text-gray-500",children:[c.length>0?Math.round(W/c.length*100):0,"%"]})]}),a.jsx(C,{className:"w-6 h-6 text-blue-600"})]})}),a.jsx(te,{className:"p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"平均単価"}),a.jsxs("p",{className:"text-xl font-bold text-green-600",children:["¥",Math.round(B).toLocaleString()]})]}),a.jsx(x,{className:"w-6 h-6 text-green-600"})]})}),a.jsx(te,{className:"p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"キャンセル率"}),a.jsxs("p",{className:"text-xl font-bold text-orange-600",children:[K.toFixed(1),"%"]})]}),a.jsx(F,{className:"w-6 h-6 text-orange-600"})]})})]}),p&&p.daily_stats.length>0&&a.jsxs(te,{className:"p-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"日別予約統計（直近30日）"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-sm text-gray-600",children:"平均日次予約数"}),a.jsx("p",{className:"text-2xl font-bold text-purple-600",children:Math.round(p.daily_stats.reduce(((e,s)=>e+s.count),0)/p.daily_stats.length)})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-sm text-gray-600",children:"平均日次売上"}),a.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["¥",Math.round(p.daily_stats.reduce(((e,s)=>e+s.revenue),0)/p.daily_stats.length).toLocaleString()]})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-sm text-gray-600",children:"平均キャンセル率"}),a.jsxs("p",{className:"text-2xl font-bold text-orange-600",children:[(p.daily_stats.reduce(((e,s)=>e+s.cancellation_rate),0)/p.daily_stats.length).toFixed(1),"%"]})]})]})]}),p&&p.top_parks.length>0&&a.jsxs(te,{className:"p-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"人気ドッグランランキング"}),a.jsx("div",{className:"space-y-3",children:p.top_parks.slice(0,5).map(((e,s)=>a.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white font-bold "+(0===s?"bg-yellow-500":1===s?"bg-gray-400":2===s?"bg-orange-600":"bg-blue-500"),children:s+1}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium",children:e.park_name}),a.jsxs("p",{className:"text-sm text-gray-600",children:[e.reservation_count,"件の予約"]})]})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("p",{className:"font-bold text-green-600",children:["¥",e.revenue.toLocaleString()]}),a.jsx("p",{className:"text-sm text-gray-600",children:"売上"})]})]},e.park_name)))})]}),a.jsxs(te,{className:"p-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[a.jsx("div",{className:"md:col-span-2",children:a.jsx(ce,{label:"検索",placeholder:"ユーザー名、メール、ドッグラン名で検索...",value:y,onChange:e=>k(e.target.value),icon:a.jsx(L,{className:"w-4 h-4 text-gray-500"})})}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ステータス"}),a.jsxs("select",{value:S,onChange:e=>D(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",children:[a.jsx("option",{value:"all",children:"すべて"}),a.jsx("option",{value:"confirmed",children:"確定"}),a.jsx("option",{value:"cancelled",children:"キャンセル"}),a.jsx("option",{value:"completed",children:"完了"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"予約日"}),a.jsx("input",{type:"date",value:$,onChange:e=>P(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"並び順"}),a.jsxs("select",{value:`${z}-${M}`,onChange:e=>{const[s,a]=e.target.value.split("-");q(s),O(a)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",children:[a.jsx("option",{value:"reservation_date-desc",children:"予約日（新しい順）"}),a.jsx("option",{value:"reservation_date-asc",children:"予約日（古い順）"}),a.jsx("option",{value:"created_at-desc",children:"登録日（新しい順）"}),a.jsx("option",{value:"created_at-asc",children:"登録日（古い順）"}),a.jsx("option",{value:"total_price-desc",children:"料金（高い順）"}),a.jsx("option",{value:"total_price-asc",children:"料金（低い順）"})]})]})]}),a.jsxs("div",{className:"flex justify-between items-center mt-4",children:[a.jsxs("p",{className:"text-sm text-gray-600",children:[o.length,"件の予約が見つかりました",o.length>0&&a.jsxs("span",{className:"ml-2",children:["（合計売上: ¥",Y.toLocaleString(),"）"]})]}),a.jsxs(re,{variant:"secondary",size:"sm",onClick:()=>{const e=[["予約ID","ユーザー名","メール","ドッグラン","予約日","開始時間","時間","料金","ステータス","支払状況","登録日"],...o.map((e=>[e.id,e.user_name,e.user_email,e.park_name,new Date(e.reservation_date).toLocaleDateString("ja-JP"),`${e.start_time}:00`,`${e.duration}時間`,`¥${e.total_price.toLocaleString()}`,I(e.status),A(e.payment_status),new Date(e.created_at).toLocaleDateString("ja-JP")]))].map((e=>e.join(","))).join("\n"),s=new Blob([e],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");a.href=URL.createObjectURL(s),a.download=`reservations_${(new Date).toISOString().split("T")[0]}.csv`,a.click()},children:[a.jsx(N,{className:"w-4 h-4 mr-1"}),"CSV出力"]})]})]}),a.jsx(te,{children:a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ユーザー"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ドッグラン"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"予約日時"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"料金"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ステータス"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"支払状況"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"操作"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o.map((e=>a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.user_name}),e.is_subscription&&a.jsx(C,{className:"w-4 h-4 text-purple-600 ml-2"})]}),a.jsx("div",{className:"text-sm text-gray-500",children:e.user_email}),a.jsxs("div",{className:"text-xs text-gray-400",children:["犬: ",e.dog_count,"匹"]})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.park_name})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"space-y-1 text-sm",children:[a.jsx("div",{className:"text-gray-900",children:new Date(e.reservation_date).toLocaleDateString("ja-JP")}),a.jsxs("div",{className:"text-gray-500",children:[e.start_time,":00 (",e.duration,"時間)"]})]})}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[a.jsxs("div",{className:"text-sm font-medium text-gray-900",children:["¥",e.total_price.toLocaleString()]}),e.is_subscription&&a.jsx("div",{className:"text-xs text-purple-600",children:"サブスク割引適用"})]}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:V(e.status)}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:J(e.payment_status)}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:a.jsx("div",{className:"flex items-center space-x-2",children:a.jsx(re,{size:"sm",variant:"secondary",onClick:()=>i(`/parks/${e.park_id}`),children:a.jsx(w,{className:"w-4 h-4"})})})})]},e.id)))})]})})})]})}},Symbol.toStringTag,{value:"Module"}));function _e({className:e}){return a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e,children:[a.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),a.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}const we=Object.freeze(Object.defineProperty({__proto__:null,AdminShopManagement:function(){const{user:t,isAdmin:i}=ae(),c=e(),[x,m]=s.useState("orders"),[p,g]=s.useState([]),[j,f]=s.useState([]),[b,y]=s.useState([]),[_,S]=s.useState([]),[C,D]=s.useState(!0),[$,P]=s.useState(""),[z,q]=s.useState(""),[M,O]=s.useState(""),[U,T]=s.useState("all"),[E,I]=s.useState(null),[F,R]=s.useState(null),[B,W]=s.useState(null),[K,Q]=s.useState(null),[G,H]=s.useState(!1),[X,Z]=s.useState({status:"",tracking_number:"",shipping_carrier:"",estimated_delivery_date:"",notes:""}),[ee,se]=s.useState({name:"",description:"",price:0,category:"",stock_quantity:0,is_active:!0,brand:"",weight:0,size:"",ingredients:"",age_group:"",dog_size:"",image_url:""}),[le,ne]=s.useState({title:"",content:"",category:"news",is_important:!1,image_url:"",link_url:"",park_id:""}),[ie,xe]=s.useState({name:"",address:"",image_url:"",opening_date:"",park_id:""}),[oe,he]=s.useState(!1),[pe,ge]=s.useState(!1),[je,Ne]=s.useState(!1),[ve,fe]=s.useState([]);s.useEffect((()=>{i?(be(),ye()):c("/")}),[i,c,x]);const be=async()=>{try{if(D(!0),P(""),"orders"===x){const{data:e,error:s}=await me.from("orders").select("\n            *,\n            order_items (\n              *,\n              product:products(*)\n            )\n          ").order("created_at",{ascending:!1});if(s)throw s;g(e||[])}else if("products"===x){const{data:e,error:s}=await me.from("products").select("*").order("created_at",{ascending:!1});if(s)throw s;f(e||[])}else if("news"===x){const{data:e,error:s}=await me.from("news_announcements").select("*").order("created_at",{ascending:!1});if(s)throw s;y(e||[]);const{data:a,error:t}=await me.from("new_park_openings").select("*").order("created_at",{ascending:!1});if(t)throw t;S(a||[])}}catch(e){P(e.message||"エラーが発生しました")}finally{D(!1)}},ye=async()=>{try{const{data:e,error:s}=await me.from("dog_parks").select("id, name").eq("status","approved");if(s)throw s;fe(e||[])}catch(e){}},we=e=>({pending:"注文受付中",confirmed:"注文確定",processing:"準備中",shipped:"発送済み",delivered:"配達完了",cancelled:"キャンセル"}[e]||e),ke=e=>({pending:"bg-yellow-100 text-yellow-800",confirmed:"bg-blue-100 text-blue-800",processing:"bg-purple-100 text-purple-800",shipped:"bg-orange-100 text-orange-800",delivered:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"}[e]||"bg-gray-100 text-gray-800"),Se=e=>({credit_card:"クレジットカード",bank_transfer:"銀行振込",cod:"代金引換"}[e]||e),Ce=e=>({pending:"未決済",completed:"決済完了",failed:"決済失敗",cancelled:"キャンセル"}[e]||e),Le=e=>({pending:"bg-yellow-100 text-yellow-800",completed:"bg-green-100 text-green-800",failed:"bg-red-100 text-red-800",cancelled:"bg-gray-100 text-gray-800"}[e]||"bg-gray-100 text-gray-800"),De=e=>({news:"お知らせ",announcement:"重要なお知らせ",sale:"セール情報"}[e]||e),$e=p.filter((e=>{const s=e.order_number.toLowerCase().includes(M.toLowerCase())||e.shipping_name.toLowerCase().includes(M.toLowerCase())||e.shipping_address.toLowerCase().includes(M.toLowerCase()),a="all"===U||e.status===U;return s&&a})),Pe=j.filter((e=>e.name.toLowerCase().includes(M.toLowerCase())||e.description.toLowerCase().includes(M.toLowerCase())||e.brand&&e.brand.toLowerCase().includes(M.toLowerCase()))),ze=b.filter((e=>e.title.toLowerCase().includes(M.toLowerCase())||e.content.toLowerCase().includes(M.toLowerCase()))),qe=_.filter((e=>e.name.toLowerCase().includes(M.toLowerCase())||e.address.toLowerCase().includes(M.toLowerCase())));return C?a.jsx("div",{className:"flex justify-center items-center h-64",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):a.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[a.jsx("div",{className:"flex items-center space-x-4 mb-6",children:a.jsxs(n,{to:"/admin",className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[a.jsx(v,{className:"w-4 h-4 mr-2"}),"管理者ダッシュボードに戻る"]})}),a.jsx("div",{className:"flex justify-between items-center",children:a.jsxs("h1",{className:"text-2xl font-bold flex items-center",children:[a.jsx(h,{className:"w-8 h-8 text-green-600 mr-3"}),"ショップ管理"]})}),$&&a.jsxs("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4 flex items-start",children:[a.jsx(r,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),a.jsx("p",{children:$})]}),z&&a.jsxs("div",{className:"bg-green-100 border border-green-300 text-green-800 rounded-lg p-4 flex items-start",children:[a.jsx(l,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),a.jsx("p",{children:z})]}),a.jsxs("div",{className:"flex space-x-4 border-b",children:[a.jsxs("button",{className:"px-4 py-2 font-medium "+("orders"===x?"text-green-600 border-b-2 border-green-600":"text-gray-500 hover:text-gray-700"),onClick:()=>m("orders"),children:[a.jsx(A,{className:"w-4 h-4 inline mr-2"}),"注文管理"]}),a.jsxs("button",{className:"px-4 py-2 font-medium "+("products"===x?"text-green-600 border-b-2 border-green-600":"text-gray-500 hover:text-gray-700"),onClick:()=>m("products"),children:[a.jsx(h,{className:"w-4 h-4 inline mr-2"}),"商品管理"]}),a.jsxs("button",{className:"px-4 py-2 font-medium "+("news"===x?"text-green-600 border-b-2 border-green-600":"text-gray-500 hover:text-gray-700"),onClick:()=>m("news"),children:[a.jsx(u,{className:"w-4 h-4 inline mr-2"}),"新着情報管理"]})]}),"orders"===x&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsx("div",{className:"md:col-span-2",children:a.jsx(ce,{label:"",value:M,onChange:e=>O(e.target.value),placeholder:"注文番号、顧客名、住所で検索...",icon:a.jsx(L,{className:"w-4 h-4 text-gray-500"})})}),a.jsx("div",{children:a.jsxs("select",{value:U,onChange:e=>T(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",children:[a.jsx("option",{value:"all",children:"すべてのステータス"}),a.jsx("option",{value:"pending",children:"注文受付中"}),a.jsx("option",{value:"confirmed",children:"注文確定"}),a.jsx("option",{value:"processing",children:"準備中"}),a.jsx("option",{value:"shipped",children:"発送済み"}),a.jsx("option",{value:"delivered",children:"配達完了"}),a.jsx("option",{value:"cancelled",children:"キャンセル"})]})})]}),a.jsx("div",{className:"flex justify-end",children:a.jsxs(re,{variant:"secondary",size:"sm",onClick:()=>{if(0===p.length)return;const e=p.map((e=>[e.order_number,new Date(e.created_at).toLocaleDateString("ja-JP"),we(e.status),Se(e.payment_method),Ce(e.payment_status),e.total_amount,e.discount_amount,e.shipping_fee,e.final_amount,e.shipping_name,e.shipping_postal_code,e.shipping_address,e.shipping_phone,e.estimated_delivery_date?new Date(e.estimated_delivery_date).toLocaleDateString("ja-JP"):"",e.tracking_number||"",e.shipping_carrier||"",e.notes||""]));ue(["注文番号","注文日","ステータス","支払い方法","支払いステータス","合計金額","割引額","送料","最終金額","配送先氏名","配送先郵便番号","配送先住所","配送先電話番号","配送予定日","追跡番号","配送業者","備考"],e,`注文一覧_${(new Date).toISOString().split("T")[0]}.csv`)},disabled:0===p.length,children:[a.jsx(N,{className:"w-4 h-4 mr-2"}),"CSV出力"]})}),0===$e.length?a.jsxs(te,{className:"text-center py-12",children:[a.jsx(A,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),a.jsx("h2",{className:"text-xl font-semibold text-gray-700 mb-2",children:"注文がありません"}),a.jsx("p",{className:"text-gray-500",children:"該当する注文が見つかりませんでした"})]}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full bg-white",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"注文番号"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"注文日"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"顧客名"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"金額"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ステータス"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"支払い"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"アクション"})]})}),a.jsx("tbody",{className:"divide-y divide-gray-200",children:$e.map((e=>a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.order_number}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.created_at).toLocaleDateString("ja-JP")}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.shipping_name}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:["¥",e.final_amount.toLocaleString()]}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsx("span",{className:`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${ke(e.status)}`,children:we(e.status)})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-xs text-gray-500",children:Se(e.payment_method)}),a.jsx("span",{className:`mt-1 px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${Le(e.payment_status)}`,children:Ce(e.payment_status)})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:a.jsxs(re,{size:"sm",variant:"secondary",onClick:()=>(e=>{I(e),Z({status:e.status,tracking_number:e.tracking_number||"",shipping_carrier:e.shipping_carrier||"",estimated_delivery_date:e.estimated_delivery_date?new Date(e.estimated_delivery_date).toISOString().split("T")[0]:"",notes:e.notes||""})})(e),children:[a.jsx(w,{className:"w-4 h-4 mr-1"}),"詳細"]})})]},e.id)))})]})})]}),"products"===x&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx(ce,{label:"",value:M,onChange:e=>O(e.target.value),placeholder:"商品名、説明で検索...",icon:a.jsx(L,{className:"w-4 h-4 text-gray-500"}),className:"w-64"}),a.jsxs(re,{onClick:()=>{R(null),se({name:"",description:"",price:0,category:"",stock_quantity:0,is_active:!0,brand:"",weight:0,size:"",ingredients:"",age_group:"all",dog_size:"all",image_url:""}),he(!0)},children:[a.jsx(_e,{className:"w-4 h-4 mr-2"}),"新規商品登録"]})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:Pe.map((e=>a.jsxs(te,{className:"overflow-hidden",children:[e.image_url&&a.jsx("div",{className:"h-48 -m-6 mb-4",children:a.jsx("img",{src:e.image_url,alt:e.name,className:"w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://images.pexels.com/photos/1108099/pexels-photo-1108099.jpeg"}})}),a.jsxs("div",{className:"px-6 pb-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-2",children:e.name}),a.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:e.description}),a.jsxs("div",{className:"flex justify-between items-center mb-3",children:[a.jsxs("span",{className:"text-lg font-bold text-green-600",children:["¥",e.price.toLocaleString()]}),a.jsxs("span",{className:"px-2 py-1 rounded-full text-xs "+(e.stock_quantity>0?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:["在庫: ",e.stock_quantity]})]}),a.jsxs(re,{variant:"secondary",className:"w-full",onClick:()=>(e=>{R(e),se({name:e.name,description:e.description,price:e.price,category:e.category,stock_quantity:e.stock_quantity,is_active:e.is_active,brand:e.brand||"",weight:e.weight||0,size:e.size||"",ingredients:e.ingredients||"",age_group:e.age_group||"all",dog_size:e.dog_size||"all",image_url:e.image_url}),he(!0)})(e),children:[a.jsx(V,{className:"w-4 h-4 mr-2"}),"編集"]})]})]},e.id)))})]}),"news"===x&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx(ce,{label:"",value:M,onChange:e=>O(e.target.value),placeholder:"タイトル、内容で検索...",icon:a.jsx(L,{className:"w-4 h-4 text-gray-500"}),className:"w-64"}),a.jsxs("div",{className:"flex space-x-3",children:[a.jsxs(re,{onClick:()=>{W(null),ne({title:"",content:"",category:"news",is_important:!1,image_url:"",link_url:"",park_id:""}),ge(!0)},children:[a.jsx(u,{className:"w-4 h-4 mr-2"}),"新着情報を追加"]}),a.jsxs(re,{onClick:()=>{Q(null),xe({name:"",address:"",image_url:"",opening_date:"",park_id:""}),Ne(!0)},children:[a.jsx(o,{className:"w-4 h-4 mr-2"}),"新規オープン情報を追加"]})]})]}),a.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center",children:[a.jsx(u,{className:"w-6 h-6 text-blue-600 mr-2"}),"新着情報"]}),0===ze.length?a.jsxs(te,{className:"text-center py-8",children:[a.jsx(u,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"新着情報がありません"})]}):a.jsx("div",{className:"space-y-4",children:ze.map((e=>{return a.jsx(te,{className:"p-4",children:a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[a.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s=e.category,{news:"bg-blue-100 text-blue-800",announcement:"bg-red-100 text-red-800",sale:"bg-green-100 text-green-800"}[s]||"bg-gray-100 text-gray-800"}`,children:De(e.category)}),e.is_important&&a.jsx("span",{className:"bg-red-100 text-red-800 px-2 py-1 rounded-full text-xs font-medium",children:"重要"}),a.jsx("span",{className:"text-xs text-gray-500",children:new Date(e.created_at).toLocaleDateString("ja-JP")})]}),a.jsx("h3",{className:"font-semibold",children:e.title}),a.jsx("p",{className:"text-sm text-gray-600 line-clamp-2 mt-1",children:e.content})]}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsxs(re,{size:"sm",variant:"secondary",onClick:()=>{return W(s=e),ne({title:s.title,content:s.content,category:s.category,is_important:s.is_important||!1,image_url:s.image_url||"",link_url:s.link_url||"",park_id:s.park_id||""}),void ge(!0);var s},children:[a.jsx(V,{className:"w-4 h-4 mr-1"}),"編集"]}),a.jsx(re,{size:"sm",variant:"secondary",className:"text-red-600 hover:text-red-700",onClick:()=>(async e=>{if(confirm("この新着情報を削除してもよろしいですか？"))try{H(!0),P("");const{error:s}=await me.from("news_announcements").delete().eq("id",e);if(s)throw s;q("新着情報を削除しました"),await be(),setTimeout((()=>{q("")}),3e3)}catch(s){P("新着情報の削除に失敗しました")}finally{H(!1)}})(e.id),children:a.jsx(k,{className:"w-4 h-4"})})]})]})},e.id);var s}))}),a.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center mt-8",children:[a.jsx(o,{className:"w-6 h-6 text-purple-600 mr-2"}),"新規オープン情報"]}),0===qe.length?a.jsxs(te,{className:"text-center py-8",children:[a.jsx(o,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"新規オープン情報がありません"})]}):a.jsx("div",{className:"space-y-4",children:qe.map((e=>a.jsx(te,{className:"p-4",children:a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[a.jsx("span",{className:"bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-xs font-medium",children:"新規オープン"}),a.jsx("span",{className:"text-xs text-gray-500",children:new Date(e.created_at).toLocaleDateString("ja-JP")})]}),a.jsx("h3",{className:"font-semibold",children:e.name}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.address}),a.jsxs("p",{className:"text-sm text-blue-600 mt-1",children:["オープン日: ",e.opening_date]})]}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsxs(re,{size:"sm",variant:"secondary",onClick:()=>(e=>{Q(e),xe({name:e.name,address:e.address,image_url:e.image_url,opening_date:e.opening_date,park_id:e.park_id||""}),Ne(!0)})(e),children:[a.jsx(V,{className:"w-4 h-4 mr-1"}),"編集"]}),a.jsx(re,{size:"sm",variant:"secondary",className:"text-red-600 hover:text-red-700",onClick:()=>(async e=>{if(confirm("この新規オープン情報を削除してもよろしいですか？"))try{H(!0),P("");const{error:s}=await me.from("new_park_openings").delete().eq("id",e);if(s)throw s;q("新規オープン情報を削除しました"),await be(),setTimeout((()=>{q("")}),3e3)}catch(s){P("新規オープン情報の削除に失敗しました")}finally{H(!1)}})(e.id),children:a.jsx(k,{className:"w-4 h-4"})})]})]})},e.id)))})]}),E&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsx("h2",{className:"text-xl font-bold",children:"注文詳細"}),a.jsx("button",{onClick:()=>I(null),className:"text-gray-500 hover:text-gray-700",children:a.jsx(k,{className:"w-6 h-6"})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold mb-3",children:"注文情報"}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("p",{children:[a.jsx("span",{className:"font-medium",children:"注文番号:"})," ",E.order_number]}),a.jsxs("p",{children:[a.jsx("span",{className:"font-medium",children:"注文日:"})," ",new Date(E.created_at).toLocaleDateString("ja-JP")]}),a.jsxs("p",{children:[a.jsx("span",{className:"font-medium",children:"ステータス:"})," ",a.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${ke(E.status)}`,children:we(E.status)})]}),a.jsxs("p",{children:[a.jsx("span",{className:"font-medium",children:"支払い方法:"})," ",Se(E.payment_method)]}),a.jsxs("p",{children:[a.jsx("span",{className:"font-medium",children:"支払いステータス:"})," ",a.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${Le(E.payment_status)}`,children:Ce(E.payment_status)})]})]})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold mb-3",children:"配送先"}),a.jsxs("div",{className:"text-sm",children:[a.jsx("p",{className:"font-medium",children:E.shipping_name}),a.jsxs("p",{children:["〒",E.shipping_postal_code]}),a.jsx("p",{children:E.shipping_address}),a.jsx("p",{children:E.shipping_phone})]})]})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("h3",{className:"font-semibold mb-3",children:"注文商品"}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"商品"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"単価"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"数量"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"小計"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:E.order_items.map((e=>a.jsxs("tr",{children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:a.jsx("img",{className:"h-10 w-10 rounded-full object-cover",src:e.product.image_url,alt:e.product.name,onError:e=>{e.currentTarget.src="https://images.pexels.com/photos/1108099/pexels-photo-1108099.jpeg"}})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.product.name}),a.jsx("div",{className:"text-sm text-gray-500",children:e.product.sku||"-"})]})]})}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:["¥",e.unit_price.toLocaleString()]}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.quantity}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:["¥",e.total_price.toLocaleString()]})]},e.id)))})]})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold mb-3",children:"料金詳細"}),a.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"商品小計"}),a.jsxs("span",{children:["¥",E.total_amount.toLocaleString()]})]}),E.discount_amount>0&&a.jsxs("div",{className:"flex justify-between text-purple-600",children:[a.jsx("span",{children:"割引"}),a.jsxs("span",{children:["-¥",E.discount_amount.toLocaleString()]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"送料"}),a.jsx("span",{children:0===E.shipping_fee?"無料":`¥${E.shipping_fee.toLocaleString()}`})]}),a.jsx("hr",{className:"my-2"}),a.jsxs("div",{className:"flex justify-between font-bold",children:[a.jsx("span",{children:"合計"}),a.jsxs("span",{className:"text-green-600",children:["¥",E.final_amount.toLocaleString()]})]})]})})]}),a.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),E)try{H(!0),P(""),q("");const{error:e}=await me.from("orders").update({status:X.status,tracking_number:X.tracking_number||null,shipping_carrier:X.shipping_carrier||null,estimated_delivery_date:X.estimated_delivery_date||null,notes:X.notes||null,updated_at:(new Date).toISOString()}).eq("id",E.id);if(e)throw e;if("shipped"===X.status&&"shipped"!==E.status){const{error:e}=await me.from("notifications").insert([{user_id:E.user_id,type:"order_shipped",title:"注文が発送されました",message:`注文番号: ${E.order_number} の商品が発送されました。${X.tracking_number?`追跡番号: ${X.tracking_number}`:""}`,data:{order_id:E.id,order_number:E.order_number,tracking_number:X.tracking_number||null}}])}if("delivered"===X.status&&"delivered"!==E.status){const{error:e}=await me.from("notifications").insert([{user_id:E.user_id,type:"order_delivered",title:"注文が配達されました",message:`注文番号: ${E.order_number} の商品が配達されました。ご利用ありがとうございました。`,data:{order_id:E.id,order_number:E.order_number}}])}q("注文情報を更新しました"),await be();const{data:s,error:a}=await me.from("orders").select("\n          *,\n          order_items (\n            *,\n            product:products(*)\n          )\n        ").eq("id",E.id).single();!a&&s&&I(s),setTimeout((()=>{q("")}),3e3)}catch(s){P("注文の更新に失敗しました")}finally{H(!1)}},children:[a.jsx("h3",{className:"font-semibold mb-3",children:"注文ステータス更新"}),a.jsxs("div",{className:"space-y-4",children:[a.jsx(de,{label:"ステータス",options:[{value:"pending",label:"注文受付中"},{value:"confirmed",label:"注文確定"},{value:"processing",label:"準備中"},{value:"shipped",label:"発送済み"},{value:"delivered",label:"配達完了"},{value:"cancelled",label:"キャンセル"}],value:X.status,onChange:e=>Z({...X,status:e.target.value}),required:!0}),a.jsx(ce,{label:"追跡番号",value:X.tracking_number,onChange:e=>Z({...X,tracking_number:e.target.value}),placeholder:"追跡番号を入力",icon:a.jsx(J,{className:"w-4 h-4 text-gray-500"})}),a.jsx(ce,{label:"配送業者",value:X.shipping_carrier,onChange:e=>Z({...X,shipping_carrier:e.target.value}),placeholder:"配送業者名を入力",icon:a.jsx(J,{className:"w-4 h-4 text-gray-500"})}),a.jsx(ce,{label:"お届け予定日",type:"date",value:X.estimated_delivery_date,onChange:e=>Z({...X,estimated_delivery_date:e.target.value}),icon:a.jsx(d,{className:"w-4 h-4 text-gray-500"})}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"備考"}),a.jsx("textarea",{value:X.notes,onChange:e=>Z({...X,notes:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",rows:3,placeholder:"備考を入力"})]}),a.jsxs(re,{type:"submit",isLoading:G,className:"w-full",children:[a.jsx(Y,{className:"w-4 h-4 mr-2"}),"更新する"]})]})]})]})]})})}),oe&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsx("h2",{className:"text-xl font-bold",children:F?"商品編集":"新規商品登録"}),a.jsx("button",{onClick:()=>he(!1),className:"text-gray-500 hover:text-gray-700",children:a.jsx(k,{className:"w-6 h-6"})})]}),a.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),F)try{H(!0),P(""),q("");const{error:e}=await me.from("products").update({name:ee.name,description:ee.description,price:ee.price,category:ee.category,stock_quantity:ee.stock_quantity,is_active:ee.is_active,brand:ee.brand||null,weight:ee.weight||null,size:ee.size||null,ingredients:ee.ingredients||null,age_group:ee.age_group||"all",dog_size:ee.dog_size||"all",image_url:ee.image_url,updated_at:(new Date).toISOString()}).eq("id",F.id);if(e)throw e;q("商品情報を更新しました"),await be(),he(!1),setTimeout((()=>{q("")}),3e3)}catch(s){P("商品の更新に失敗しました")}finally{H(!1)}},children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[a.jsx(ce,{label:"商品名 *",value:ee.name,onChange:e=>se({...ee,name:e.target.value}),required:!0}),a.jsx(ce,{label:"価格 (円) *",type:"number",value:ee.price.toString(),onChange:e=>se({...ee,price:parseInt(e.target.value)||0}),required:!0,min:"0"}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"商品説明 *"}),a.jsx("textarea",{value:ee.description,onChange:e=>se({...ee,description:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",rows:4,required:!0})]}),a.jsx(de,{label:"カテゴリー *",options:[{value:"food",label:"ドッグフード"},{value:"treats",label:"おやつ"},{value:"toys",label:"おもちゃ"},{value:"accessories",label:"アクセサリー"},{value:"health",label:"ヘルスケア"},{value:"sheets",label:"ペットシーツ"}],value:ee.category,onChange:e=>se({...ee,category:e.target.value}),required:!0}),a.jsx(ce,{label:"在庫数 *",type:"number",value:ee.stock_quantity.toString(),onChange:e=>se({...ee,stock_quantity:parseInt(e.target.value)||0}),required:!0,min:"0"}),a.jsx(ce,{label:"ブランド",value:ee.brand,onChange:e=>se({...ee,brand:e.target.value})}),a.jsx(ce,{label:"重量 (g)",type:"number",value:ee.weight.toString(),onChange:e=>se({...ee,weight:parseInt(e.target.value)||0}),min:"0"}),a.jsx(ce,{label:"サイズ",value:ee.size,onChange:e=>se({...ee,size:e.target.value}),placeholder:"例: S, M, L, XL"}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"原材料"}),a.jsx("textarea",{value:ee.ingredients,onChange:e=>se({...ee,ingredients:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",rows:3,placeholder:"原材料を入力（フードやおやつの場合）"})]}),a.jsx(de,{label:"対象年齢",options:[{value:"all",label:"全年齢"},{value:"puppy",label:"子犬"},{value:"adult",label:"成犬"},{value:"senior",label:"シニア犬"}],value:ee.age_group,onChange:e=>se({...ee,age_group:e.target.value})}),a.jsx(de,{label:"対象サイズ",options:[{value:"all",label:"全サイズ"},{value:"small",label:"小型犬"},{value:"medium",label:"中型犬"},{value:"large",label:"大型犬"}],value:ee.dog_size,onChange:e=>se({...ee,dog_size:e.target.value})}),a.jsx(ce,{label:"画像URL *",value:ee.image_url,onChange:e=>se({...ee,image_url:e.target.value}),placeholder:"https://example.com/image.jpg",required:!0}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("input",{type:"checkbox",id:"is_active",checked:ee.is_active,onChange:e=>se({...ee,is_active:e.target.checked}),className:"rounded text-green-600"}),a.jsx("label",{htmlFor:"is_active",className:"text-sm text-gray-700",children:"商品を有効にする（オンにすると商品が表示されます）"})]})]}),a.jsxs("div",{className:"flex justify-end space-x-3",children:[a.jsx(re,{type:"button",variant:"secondary",onClick:()=>he(!1),children:"キャンセル"}),a.jsx(re,{type:"submit",isLoading:G,children:F?"更新する":"登録する"})]})]})]})})}),pe&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsx("h2",{className:"text-xl font-bold",children:B?"新着情報を編集":"新着情報を追加"}),a.jsx("button",{onClick:()=>ge(!1),className:"text-gray-500 hover:text-gray-700",children:a.jsx(k,{className:"w-6 h-6"})})]}),a.jsxs("form",{onSubmit:async e=>{e.preventDefault();try{if(H(!0),P(""),q(""),B){const{error:e}=await me.from("news_announcements").update({title:le.title,content:le.content,category:le.category,is_important:le.is_important,image_url:le.image_url||null,link_url:le.link_url||null,park_id:le.park_id||null,updated_at:(new Date).toISOString()}).eq("id",B.id);if(e)throw e;q("新着情報を更新しました")}else{const{error:e}=await me.from("news_announcements").insert([{title:le.title,content:le.content,category:le.category,is_important:le.is_important,image_url:le.image_url||null,link_url:le.link_url||null,park_id:le.park_id||null,created_by:null==t?void 0:t.id}]);if(e)throw e;q("新着情報を作成しました")}await be(),ge(!1),W(null),ne({title:"",content:"",category:"news",is_important:!1,image_url:"",link_url:"",park_id:""}),setTimeout((()=>{q("")}),3e3)}catch(s){P("新着情報の更新に失敗しました")}finally{H(!1)}},children:[a.jsxs("div",{className:"space-y-4",children:[a.jsx(ce,{label:"タイトル *",value:le.title,onChange:e=>ne({...le,title:e.target.value}),required:!0}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"内容 *"}),a.jsx("textarea",{value:le.content,onChange:e=>ne({...le,content:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:6,required:!0})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(de,{label:"カテゴリー *",options:[{value:"news",label:"お知らせ"},{value:"announcement",label:"重要なお知らせ"},{value:"sale",label:"セール情報"}],value:le.category,onChange:e=>ne({...le,category:e.target.value}),required:!0}),a.jsxs("div",{className:"flex items-center space-x-2 mt-8",children:[a.jsx("input",{type:"checkbox",id:"is_important",checked:le.is_important,onChange:e=>ne({...le,is_important:e.target.checked}),className:"rounded text-blue-600"}),a.jsx("label",{htmlFor:"is_important",className:"text-sm text-gray-700",children:"重要なお知らせとして表示する"})]})]}),a.jsx(ce,{label:"画像URL",value:le.image_url,onChange:e=>ne({...le,image_url:e.target.value}),placeholder:"https://example.com/image.jpg"}),a.jsx(ce,{label:"リンクURL",value:le.link_url,onChange:e=>ne({...le,link_url:e.target.value}),placeholder:"https://example.com/page"}),a.jsx(de,{label:"関連ドッグラン",options:[{value:"",label:"関連ドッグランなし"},...ve.map((e=>({value:e.id,label:e.name})))],value:le.park_id,onChange:e=>ne({...le,park_id:e.target.value})})]}),a.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[a.jsx(re,{type:"button",variant:"secondary",onClick:()=>ge(!1),children:"キャンセル"}),a.jsx(re,{type:"submit",isLoading:G,children:B?"更新する":"追加する"})]})]})]})})}),je&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsx("h2",{className:"text-xl font-bold",children:K?"新規オープン情報を編集":"新規オープン情報を追加"}),a.jsx("button",{onClick:()=>Ne(!1),className:"text-gray-500 hover:text-gray-700",children:a.jsx(k,{className:"w-6 h-6"})})]}),a.jsxs("form",{onSubmit:async e=>{e.preventDefault();try{if(H(!0),P(""),q(""),K){const{error:e}=await me.from("new_park_openings").update({name:ie.name,address:ie.address,image_url:ie.image_url,opening_date:ie.opening_date,park_id:ie.park_id||null,updated_at:(new Date).toISOString()}).eq("id",K.id);if(e)throw e;q("新規オープン情報を更新しました")}else{const{error:e}=await me.from("new_park_openings").insert([{name:ie.name,address:ie.address,image_url:ie.image_url,opening_date:ie.opening_date,park_id:ie.park_id||null}]);if(e)throw e;q("新規オープン情報を作成しました")}await be(),Ne(!1),Q(null),xe({name:"",address:"",image_url:"",opening_date:"",park_id:""}),setTimeout((()=>{q("")}),3e3)}catch(s){P("新規オープン情報の更新に失敗しました")}finally{H(!1)}},children:[a.jsxs("div",{className:"space-y-4",children:[a.jsx(ce,{label:"施設名 *",value:ie.name,onChange:e=>xe({...ie,name:e.target.value}),required:!0}),a.jsx(ce,{label:"住所 *",value:ie.address,onChange:e=>xe({...ie,address:e.target.value}),required:!0}),a.jsx(ce,{label:"画像URL *",value:ie.image_url,onChange:e=>xe({...ie,image_url:e.target.value}),placeholder:"https://example.com/image.jpg",required:!0}),a.jsx(ce,{label:"オープン日 *",value:ie.opening_date,onChange:e=>xe({...ie,opening_date:e.target.value}),placeholder:"2025年7月1日",required:!0}),a.jsx(de,{label:"関連ドッグラン",options:[{value:"",label:"関連ドッグランなし"},...ve.map((e=>({value:e.id,label:e.name})))],value:ie.park_id,onChange:e=>xe({...ie,park_id:e.target.value})})]}),a.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[a.jsx(re,{type:"button",variant:"secondary",onClick:()=>Ne(!1),children:"キャンセル"}),a.jsx(re,{type:"submit",isLoading:G,children:K?"更新する":"追加する"})]})]})]})})})]})}},Symbol.toStringTag,{value:"Module"})),ke=Object.freeze(Object.defineProperty({__proto__:null,AdminSalesManagement:function(){const{isAdmin:t}=ae(),r=e(),[l,i]=s.useState([]),[d,m]=s.useState([]),[o,u]=s.useState(null),[g,j]=s.useState(!0),[f,b]=s.useState(""),[y,_]=s.useState(""),[w,k]=s.useState("all"),[S,D]=s.useState(""),[$,P]=s.useState("transaction_date"),[z,q]=s.useState("desc");s.useEffect((()=>{t?(M(),O()):r("/")}),[t,r]),s.useEffect((()=>{U()}),[l,y,w,S,$,z]);const M=async()=>{try{j(!0),b("");const{data:a,error:t}=await me.from("reservations").select("\n          id,\n          user_id,\n          park_id,\n          total_amount,\n          status,\n          reservation_type,\n          created_at\n        ").not("total_amount","is",null).order("created_at",{ascending:!1});if(t)throw new Error("予約売上データの取得に失敗しました");let r=null,l=null;try{const{data:e,error:s}=await me.from("stripe_subscriptions").select("\n            id,\n            customer_id,\n            status,\n            current_period_start,\n            current_period_end,\n            created_at\n          ").in("status",["active","trialing","past_due","canceled"]).not("deleted_at","is",null);r=e,l=s}catch(e){r=[],l=null}let n=null;try{const{data:e,error:s}=await me.auth.admin.listUsers();s||(n=e)}catch(s){}const c=await Promise.all((a||[]).map((async e=>{var s;try{const{data:a}=await me.from("profiles").select("name").eq("id",e.user_id).single(),{data:t}=await me.from("dog_parks").select("name").eq("id",e.park_id).single(),r=e.total_amount||0,l=Math.round(.2*r),i=r-l,c=null==(s=null==n?void 0:n.users)?void 0:s.find((s=>s.id===e.user_id)),d=null==c?void 0:c.email;return{id:e.id,user_name:(null==a?void 0:a.name)||"Unknown",user_email:d||`user_${e.user_id.slice(0,8)}@unknown.com`,transaction_type:"reservation",transaction_date:e.created_at,amount:r,commission:l,commission_rate:.2,net_amount:i,payment_method:"card",payment_status:"confirmed"===e.status?"paid":"pending",description:`${(null==t?void 0:t.name)||"Unknown Park"} - 予約料金`,is_subscription_user:"subscription"===e.reservation_type,created_at:e.created_at}}catch(a){return{id:e.id,user_name:"Unknown",user_email:`user_${e.user_id.slice(0,8)}@unknown.com`,transaction_type:"reservation",transaction_date:e.created_at,amount:e.total_amount||0,commission:0,commission_rate:.2,net_amount:e.total_amount||0,payment_method:"card",payment_status:"pending",description:"予約料金",is_subscription_user:!1,created_at:e.created_at}}}))),d=await Promise.all((r||[]).map((async e=>{var s;try{let a=null;if("user_id"in e)a=e.user_id;else{const{data:s}=await me.from("stripe_customers").select("user_id").eq("customer_id",e.customer_id).not("deleted_at","is",null).single();a=null==s?void 0:s.user_id}if(!a)throw new Error("User ID not found for subscription");const{data:t}=await me.from("profiles").select("name").eq("id",a).single(),r=2980,l=Math.round(.1*r),i=r-l,c=null==(s=null==n?void 0:n.users)?void 0:s.find((e=>e.id===a)),d=null==c?void 0:c.email;return{id:e.id,user_name:(null==t?void 0:t.name)||"Unknown",user_email:d||`user_${a.slice(0,8)}@unknown.com`,transaction_type:"subscription",transaction_date:e.created_at,amount:r,commission:l,commission_rate:.1,net_amount:i,payment_method:"card",payment_status:"active"===e.status?"paid":"pending",description:`月額サブスクリプション - ${e.status}`,is_subscription_user:!0,created_at:e.created_at}}catch(a){return{id:e.id,user_name:"Unknown",user_email:"unknown@unknown.com",transaction_type:"subscription",transaction_date:e.created_at,amount:2980,commission:298,commission_rate:.1,net_amount:2682,payment_method:"card",payment_status:"pending",description:"月額サブスクリプション",is_subscription_user:!0,created_at:e.created_at}}}))),x=[...c,...d];x.sort(((e,s)=>new Date(s.transaction_date).getTime()-new Date(e.transaction_date).getTime())),i(x)}catch(a){b(`売上データの取得に失敗しました: ${a instanceof Error?a.message:"不明なエラー"}`)}finally{j(!1)}},O=async()=>{try{const e=new Date,s=new Date(e.getFullYear(),e.getMonth(),1),a=new Date(e.getFullYear(),e.getMonth()-1,1),t=new Date(e.getFullYear(),e.getMonth(),0),{data:r}=await me.from("reservations").select("total_amount").gte("created_at",s.toISOString()).not("total_amount","is",null),{data:l}=await me.from("reservations").select("total_amount").gte("created_at",a.toISOString()).lt("created_at",t.toISOString()).not("total_amount","is",null),{count:n}=await me.from("stripe_subscriptions").select("id",{count:"exact"}).eq("status","active").gte("created_at",s.toISOString()),{count:i}=await me.from("stripe_subscriptions").select("id",{count:"exact"}).eq("status","active").gte("created_at",a.toISOString()).lt("created_at",t.toISOString()),c=(r||[]).reduce(((e,s)=>e+(s.total_amount||0)),0),d=((l||[]).reduce(((e,s)=>e+(s.total_amount||0)),0),2980*(n||0)),x=c+d,{count:m}=await me.from("reservations").select("id",{count:"exact"}).gte("created_at",s.toISOString()),o=(m||0)+(n||0);o>0&&Math.round(x/o),Math.round(.2*c+.1*d),u({daily_revenue:[],top_products:[],top_parks:[],payment_methods:[{method:"card",count:o,total_amount:x}]})}catch(e){}},U=()=>{let e=[...l];if(y&&(e=e.filter((e=>e.user_name.toLowerCase().includes(y.toLowerCase())||e.user_email.toLowerCase().includes(y.toLowerCase())||e.park_name&&e.park_name.toLowerCase().includes(y.toLowerCase())||e.product_name&&e.product_name.toLowerCase().includes(y.toLowerCase())))),"all"!==w&&(e=e.filter((e=>e.transaction_type===w))),S){const s=new Date(S);e=e.filter((e=>new Date(e.transaction_date).toDateString()===s.toDateString()))}e.sort(((e,s)=>{let a=e[$],t=s[$];return"transaction_date"===$&&(a=new Date(a).getTime(),t=new Date(t).getTime()),"asc"===z?a>t?1:-1:a<t?1:-1})),m(e)},T=e=>({reservation:"ドッグラン予約",shop_order:"ショップ注文",subscription:"サブスクリプション"}[e]||e),E=e=>{const s={reservation:{color:"bg-blue-100 text-blue-800",icon:c},shop_order:{color:"bg-green-100 text-green-800",icon:h},subscription:{color:"bg-purple-100 text-purple-800",icon:C}},t=s[e]||s.reservation,r=t.icon;return a.jsxs("div",{className:"flex items-center space-x-1",children:[a.jsx(r,{className:"w-4 h-4"}),a.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${t.color}`,children:T(e)})]})};if(g)return a.jsx("div",{className:"flex justify-center items-center h-64",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600"})});const I=d.reduce(((e,s)=>e+s.amount),0),R=d.reduce(((e,s)=>e+(s.amount-s.net_amount)),0),A=d.reduce(((e,s)=>e+s.net_amount),0),V=d.length>0?I/d.length:0,J=(new Date).getMonth(),Y=(new Date).getFullYear(),K=l.filter((e=>{const s=new Date(e.transaction_date);return s.getMonth()===J&&s.getFullYear()===Y})),Q=0===J?11:J-1,G=0===J?Y-1:Y,H=l.filter((e=>{const s=new Date(e.transaction_date);return s.getMonth()===Q&&s.getFullYear()===G})),X=K.reduce(((e,s)=>e+s.amount),0),Z=0===(ee=H.reduce(((e,s)=>e+s.amount),0))?0:(X-ee)/ee*100;var ee;return a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"flex items-center space-x-4 mb-6",children:a.jsxs(n,{to:"/admin",className:"flex items-center text-gray-600 hover:text-gray-800",children:[a.jsx(v,{className:"w-4 h-4 mr-2"}),"ダッシュボードに戻る"]})}),a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("div",{children:[a.jsxs("h1",{className:"text-2xl font-bold flex items-center",children:[a.jsx(x,{className:"w-8 h-8 text-orange-600 mr-3"}),"売上管理"]}),a.jsx("p",{className:"text-gray-600",children:"売上の詳細分析と収益レポート"})]}),a.jsxs("div",{className:"text-sm text-gray-500",children:["総取引数: ",l.length,"件"]})]}),f&&a.jsx("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4",children:f}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsx(te,{className:"p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"今月の売上"}),a.jsxs("p",{className:"text-xl font-bold text-orange-600",children:["¥",X.toLocaleString()]}),a.jsxs("div",{className:"flex items-center mt-1",children:[Z>=0?a.jsx(p,{className:"w-4 h-4 text-green-600 mr-1"}):a.jsx(B,{className:"w-4 h-4 text-red-600 mr-1"}),a.jsxs("span",{className:"text-xs "+(Z>=0?"text-green-600":"text-red-600"),children:[Math.abs(Z).toFixed(1),"% vs 前月"]})]})]}),a.jsx(x,{className:"w-6 h-6 text-orange-600"})]})}),a.jsx(te,{className:"p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"平均取引額"}),a.jsxs("p",{className:"text-xl font-bold text-blue-600",children:["¥",Math.round(V).toLocaleString()]})]}),a.jsx(F,{className:"w-6 h-6 text-blue-600"})]})}),a.jsx(te,{className:"p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"手数料収入"}),a.jsxs("p",{className:"text-xl font-bold text-green-600",children:["¥",R.toLocaleString()]})]}),a.jsx(W,{className:"w-6 h-6 text-green-600"})]})}),a.jsx(te,{className:"p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"純売上"}),a.jsxs("p",{className:"text-xl font-bold text-purple-600",children:["¥",A.toLocaleString()]})]}),a.jsx(p,{className:"w-6 h-6 text-purple-600"})]})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[a.jsxs(te,{className:"p-4",children:[a.jsxs("h3",{className:"font-semibold mb-3 flex items-center",children:[a.jsx(c,{className:"w-5 h-5 text-blue-600 mr-2"}),"ドッグラン予約"]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"取引数:"}),a.jsxs("span",{className:"font-medium",children:[l.filter((e=>"reservation"===e.transaction_type)).length,"件"]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"売上:"}),a.jsxs("span",{className:"font-medium text-blue-600",children:["¥",l.filter((e=>"reservation"===e.transaction_type)).reduce(((e,s)=>e+s.amount),0).toLocaleString()]})]})]})]}),a.jsxs(te,{className:"p-4",children:[a.jsxs("h3",{className:"font-semibold mb-3 flex items-center",children:[a.jsx(h,{className:"w-5 h-5 text-green-600 mr-2"}),"ショップ注文"]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"取引数:"}),a.jsxs("span",{className:"font-medium",children:[l.filter((e=>"shop_order"===e.transaction_type)).length,"件"]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"売上:"}),a.jsxs("span",{className:"font-medium text-green-600",children:["¥",l.filter((e=>"shop_order"===e.transaction_type)).reduce(((e,s)=>e+s.amount),0).toLocaleString()]})]})]})]}),a.jsxs(te,{className:"p-4",children:[a.jsxs("h3",{className:"font-semibold mb-3 flex items-center",children:[a.jsx(C,{className:"w-5 h-5 text-purple-600 mr-2"}),"サブスクリプション"]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"取引数:"}),a.jsxs("span",{className:"font-medium",children:[l.filter((e=>"subscription"===e.transaction_type)).length,"件"]})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"売上:"}),a.jsxs("span",{className:"font-medium text-purple-600",children:["¥",l.filter((e=>"subscription"===e.transaction_type)).reduce(((e,s)=>e+s.amount),0).toLocaleString()]})]})]})]})]}),a.jsxs(te,{className:"p-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[a.jsx("div",{className:"md:col-span-2",children:a.jsx(ce,{label:"検索",placeholder:"ユーザー名、メール、商品名、施設名で検索...",value:y,onChange:e=>_(e.target.value),icon:a.jsx(L,{className:"w-4 h-4 text-gray-500"})})}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"取引タイプ"}),a.jsxs("select",{value:w,onChange:e=>k(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",children:[a.jsx("option",{value:"all",children:"すべて"}),a.jsx("option",{value:"reservation",children:"ドッグラン予約"}),a.jsx("option",{value:"shop_order",children:"ショップ注文"}),a.jsx("option",{value:"subscription",children:"サブスクリプション"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"取引日"}),a.jsx("input",{type:"date",value:S,onChange:e=>D(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"並び順"}),a.jsxs("select",{value:`${$}-${z}`,onChange:e=>{const[s,a]=e.target.value.split("-");P(s),q(a)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",children:[a.jsx("option",{value:"transaction_date-desc",children:"取引日（新しい順）"}),a.jsx("option",{value:"transaction_date-asc",children:"取引日（古い順）"}),a.jsx("option",{value:"amount-desc",children:"金額（高い順）"}),a.jsx("option",{value:"amount-asc",children:"金額（低い順）"}),a.jsx("option",{value:"net_amount-desc",children:"純売上（高い順）"}),a.jsx("option",{value:"net_amount-asc",children:"純売上（低い順）"})]})]})]}),a.jsxs("div",{className:"flex justify-between items-center mt-4",children:[a.jsxs("p",{className:"text-sm text-gray-600",children:[d.length,"件の取引が見つかりました",d.length>0&&a.jsxs("span",{className:"ml-2",children:["（合計売上: ¥",I.toLocaleString(),"）"]})]}),a.jsxs(re,{variant:"secondary",size:"sm",onClick:()=>{const e=[["取引ID","タイプ","ユーザー名","メール","商品/施設","金額","手数料","純売上","決済方法","取引日"],...d.map((e=>[e.id,T(e.transaction_type),e.user_name,e.user_email,e.park_name||e.product_name||"-",`¥${e.amount.toLocaleString()}`,`${(100*e.commission_rate).toFixed(1)}%`,`¥${e.net_amount.toLocaleString()}`,e.payment_method,new Date(e.transaction_date).toLocaleDateString("ja-JP")]))].map((e=>e.join(","))).join("\n"),s=new Blob([e],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");a.href=URL.createObjectURL(s),a.download=`sales_${(new Date).toISOString().split("T")[0]}.csv`,a.click()},children:[a.jsx(N,{className:"w-4 h-4 mr-1"}),"CSV出力"]})]})]}),a.jsx(te,{children:a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ユーザー"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"取引タイプ"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"商品/施設"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"取引日"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"金額"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"手数料・純売上"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"決済方法"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:d.map((e=>a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.user_name}),e.is_subscription_user&&a.jsx(C,{className:"w-4 h-4 text-purple-600 ml-2"})]}),a.jsx("div",{className:"text-sm text-gray-500",children:e.user_email})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:E(e.transaction_type)}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[a.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.park_name||e.product_name||"-"}),e.quantity&&a.jsxs("div",{className:"text-sm text-gray-500",children:["数量: ",e.quantity]})]}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.transaction_date).toLocaleDateString("ja-JP")}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"text-sm font-medium text-gray-900",children:["¥",e.amount.toLocaleString()]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"space-y-1 text-sm",children:[a.jsxs("div",{className:"text-gray-500",children:["手数料: ",(100*e.commission_rate).toFixed(1),"%"]}),a.jsxs("div",{className:"font-medium text-green-600",children:["純売上: ¥",e.net_amount.toLocaleString()]})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.payment_method})]},e.id)))})]})})})]})}},Symbol.toStringTag,{value:"Module"})),Se=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const{user:t,isAdmin:n}=ae(),i=e(),[d,x]=s.useState([]),[m,o]=s.useState([]),[h,p]=s.useState([]),[u,g]=s.useState(!0),[j,N]=s.useState(""),[v,f]=s.useState(""),[b,y]=s.useState("pending"),[_,k]=s.useState(null),[S,C]=s.useState(!1),[L,z]=s.useState(!1),[q,O]=s.useState(null);s.useEffect((()=>{n?I():i("/")}),[n,i]),s.useEffect((()=>{d.length>0&&E()}),[d]);const U=e=>{N(e),f(""),setTimeout((()=>N("")),8e3)},E=()=>{const e=d.filter((e=>"pending"===e.status)),s=d.filter((e=>"approved"===e.status));o(e),p(s)},I=async()=>{try{g(!0),N("");const{data:e,error:s}=await me.from("vaccine_certifications").select("\n          *,\n          dog:dogs (\n            id,\n            name,\n            breed,\n            gender,\n            birth_date,\n            owner:profiles (\n              id,\n              name,\n              email,\n              phone_number,\n              address,\n              postal_code\n            )\n          )\n        ").order("created_at",{ascending:!1});if(s)throw s;const a=(e||[]).map((e=>{var s,a,t,r,l,n,i,c,d,x,m,o,h,p;return{id:e.id,dog_id:e.dog_id,dog_name:(null==(s=e.dog)?void 0:s.name)||"不明",dog_breed:(null==(a=e.dog)?void 0:a.breed)||"不明",dog_gender:(null==(t=e.dog)?void 0:t.gender)||"不明",dog_birth_date:(null==(r=e.dog)?void 0:r.birth_date)||"",owner_id:e.owner_id,owner_name:(null==(n=null==(l=e.dog)?void 0:l.owner)?void 0:n.name)||"不明",owner_email:(null==(c=null==(i=e.dog)?void 0:i.owner)?void 0:c.email)||"不明",owner_phone:(null==(x=null==(d=e.dog)?void 0:d.owner)?void 0:x.phone_number)||"",owner_address:(null==(o=null==(m=e.dog)?void 0:m.owner)?void 0:o.address)||"",owner_postal_code:(null==(p=null==(h=e.dog)?void 0:h.owner)?void 0:p.postal_code)||"",rabies_vaccine_image:e.rabies_vaccine_image||"",combo_vaccine_image:e.combo_vaccine_image||"",rabies_expiry_date:e.rabies_expiry_date||"",combo_expiry_date:e.combo_expiry_date||"",status:e.status||"pending",created_at:e.created_at,admin_notes:e.admin_notes||""}}));x(a)}catch(e){U("ワクチン証明書申請の取得に失敗しました。")}finally{g(!1)}},F=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},R=e=>{switch(e){case"pending":return"承認待ち";case"approved":return"承認済み";case"rejected":return"却下";default:return"不明"}},A=e=>new Date(e).toLocaleDateString("ja-JP"),V=e=>{if(!e)return"不明";const s=new Date,a=new Date(e),t=s.getFullYear()-a.getFullYear(),r=s.getMonth()-a.getMonth();return r<0||0===r&&s.getDate()<a.getDate()?t-1+"歳":`${t}歳`};return n?u?a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"データを読み込み中..."})]})}):a.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[a.jsxs("div",{className:"bg-white shadow rounded-lg mb-8",children:[a.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"ワクチン証明書 承認管理"}),a.jsx("p",{className:"text-gray-600",children:"登録されたワクチン証明書の承認・却下を管理します。"})]}),j&&a.jsx("div",{className:"px-6 py-4 bg-red-50 border-l-4 border-red-400",children:a.jsxs("div",{className:"flex",children:[a.jsx(r,{className:"h-5 w-5 text-red-400 mr-2"}),a.jsx("p",{className:"text-sm text-red-700",children:j})]})}),v&&a.jsx("div",{className:"px-6 py-4 bg-green-50 border-l-4 border-green-400",children:a.jsxs("div",{className:"flex",children:[a.jsx(l,{className:"h-5 w-5 text-green-400 mr-2"}),a.jsx("p",{className:"text-sm text-green-700",children:v})]})}),a.jsx("div",{className:"px-6",children:a.jsxs("nav",{className:"flex space-x-8","aria-label":"Tabs",children:[a.jsxs("button",{onClick:()=>y("pending"),className:"whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm "+("pending"===b?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[a.jsx(M,{className:"w-5 h-5 inline mr-2"}),"承認待ち",a.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:m.length})]}),a.jsxs("button",{onClick:()=>y("approved"),className:"whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm "+("approved"===b?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[a.jsx(P,{className:"w-5 h-5 inline mr-2"}),"登録中のワンちゃん",a.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:h.length})]})]})})]}),"pending"===b&&a.jsx("div",{className:"space-y-6",children:0===m.length?a.jsxs(te,{className:"text-center py-12",children:[a.jsx(M,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"承認待ちのワクチン証明書申請がありません"})]}):a.jsx("div",{className:"space-y-4",children:m.map((e=>a.jsx(te,{className:"p-6",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[a.jsx(P,{className:"w-5 h-5 text-blue-600"}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:e.dog_name}),a.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${F(e.status)}`,children:R(e.status)})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"ワンちゃん情報"}),a.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[a.jsxs("div",{children:["犬種: ",e.dog_breed]}),a.jsxs("div",{children:["性別: ",e.dog_gender]}),a.jsxs("div",{children:["年齢: ",V(e.dog_birth_date)]})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"飼い主情報"}),a.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(T,{className:"w-4 h-4 mr-1"}),e.owner_name]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx(D,{className:"w-4 h-4 mr-1"}),e.owner_email]}),e.owner_phone&&a.jsxs("div",{className:"flex items-center",children:[a.jsx($,{className:"w-4 h-4 mr-1"}),e.owner_phone]}),e.owner_address&&a.jsxs("div",{className:"flex items-center",children:[a.jsx(c,{className:"w-4 h-4 mr-1"}),"〒",e.owner_postal_code," ",e.owner_address]})]})]})]}),a.jsxs("div",{className:"text-sm text-gray-500",children:["申請日: ",A(e.created_at)]})]}),a.jsxs("div",{className:"flex space-x-2 ml-4",children:[a.jsxs(re,{size:"sm",variant:"secondary",onClick:()=>{k(e),C(!0)},children:[a.jsx(w,{className:"w-4 h-4 mr-1"}),"詳細"]}),a.jsxs(re,{size:"sm",onClick:()=>(async e=>{if(window.confirm("このワクチン証明書申請を承認してもよろしいですか？"))try{z(!0),N(""),f("");const{error:s}=await me.from("vaccine_certifications").update({status:"approved",approved_at:(new Date).toISOString()}).eq("id",e);if(s)throw s;const a=d.find((s=>s.id===e));a&&await me.from("notifications").insert([{user_id:a.owner_id,title:"ワクチン証明書承認",message:`${a.dog_name}ちゃんのワクチン証明書が承認されました。`,type:"vaccine_approved",created_at:(new Date).toISOString(),read:!1}]),f("ワクチン証明書を承認しました。"),N(""),setTimeout((()=>f("")),5e3),x((s=>s.map((s=>s.id===e?{...s,status:"approved"}:s))))}catch(s){U("承認処理に失敗しました。")}finally{z(!1)}})(e.id),className:"bg-green-600 hover:bg-green-700",disabled:L,children:[a.jsx(l,{className:"w-4 h-4 mr-1"}),"承認"]})]})]})},e.id)))})}),"approved"===b&&a.jsx("div",{className:"space-y-6",children:0===h.length?a.jsxs(te,{className:"text-center py-12",children:[a.jsx(P,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"承認済みのワクチン証明書がありません"})]}):a.jsx("div",{className:"space-y-4",children:h.map((e=>a.jsx(te,{className:"p-6",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[a.jsx(P,{className:"w-5 h-5 text-green-600"}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:e.dog_name}),a.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${F(e.status)}`,children:R(e.status)})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"ワンちゃん情報"}),a.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[a.jsxs("div",{children:["犬種: ",e.dog_breed]}),a.jsxs("div",{children:["性別: ",e.dog_gender]}),a.jsxs("div",{children:["年齢: ",V(e.dog_birth_date)]})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"飼い主情報"}),a.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(T,{className:"w-4 h-4 mr-1"}),e.owner_name]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx(D,{className:"w-4 h-4 mr-1"}),e.owner_email]}),e.owner_phone&&a.jsxs("div",{className:"flex items-center",children:[a.jsx($,{className:"w-4 h-4 mr-1"}),e.owner_phone]}),e.owner_address&&a.jsxs("div",{className:"flex items-center",children:[a.jsx(c,{className:"w-4 h-4 mr-1"}),"〒",e.owner_postal_code," ",e.owner_address]})]})]})]}),a.jsxs("div",{className:"text-sm text-gray-500",children:["申請日: ",A(e.created_at)]})]}),a.jsx("div",{className:"flex space-x-2 ml-4",children:a.jsxs(re,{size:"sm",variant:"secondary",onClick:()=>{k(e),C(!0)},children:[a.jsx(w,{className:"w-4 h-4 mr-1"}),"詳細"]})})]})},e.id)))})}),S&&_&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsx("h2",{className:"text-xl font-bold",children:"ワクチン証明書詳細"}),a.jsx("button",{onClick:()=>{C(!1),k(null)},className:"text-gray-500 hover:text-gray-700",children:"×"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"ワンちゃん情報"}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{children:[a.jsx("strong",{children:"名前:"})," ",_.dog_name]}),a.jsxs("div",{children:[a.jsx("strong",{children:"犬種:"})," ",_.dog_breed]}),a.jsxs("div",{children:[a.jsx("strong",{children:"性別:"})," ",_.dog_gender]}),a.jsxs("div",{children:[a.jsx("strong",{children:"年齢:"})," ",V(_.dog_birth_date)]})]})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"飼い主情報"}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{children:[a.jsx("strong",{children:"名前:"})," ",_.owner_name]}),a.jsxs("div",{children:[a.jsx("strong",{children:"メール:"})," ",_.owner_email]}),_.owner_phone&&a.jsxs("div",{children:[a.jsx("strong",{children:"電話:"})," ",_.owner_phone]}),_.owner_address&&a.jsxs("div",{children:[a.jsx("strong",{children:"住所:"})," 〒",_.owner_postal_code," ",_.owner_address]})]})]})]}),a.jsxs("div",{className:"mt-6",children:[a.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"ワクチン証明書画像"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[_.rabies_vaccine_image&&a.jsxs("div",{children:[a.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:["狂犬病ワクチン",_.rabies_expiry_date&&a.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(有効期限: ",A(_.rabies_expiry_date),")"]})]}),a.jsxs("div",{className:"relative",children:[a.jsx("img",{src:_.rabies_vaccine_image,alt:"狂犬病ワクチン証明書",className:"w-full h-48 object-cover rounded-lg border cursor-pointer",onClick:()=>O(_.rabies_vaccine_image)}),a.jsx("div",{className:"absolute top-2 right-2",children:a.jsx("button",{onClick:()=>O(_.rabies_vaccine_image),className:"bg-black bg-opacity-50 text-white p-1 rounded-full hover:bg-opacity-70",children:a.jsx(K,{className:"w-4 h-4"})})})]})]}),_.combo_vaccine_image&&a.jsxs("div",{children:[a.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:["混合ワクチン",_.combo_expiry_date&&a.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(有効期限: ",A(_.combo_expiry_date),")"]})]}),a.jsxs("div",{className:"relative",children:[a.jsx("img",{src:_.combo_vaccine_image,alt:"混合ワクチン証明書",className:"w-full h-48 object-cover rounded-lg border cursor-pointer",onClick:()=>O(_.combo_vaccine_image)}),a.jsx("div",{className:"absolute top-2 right-2",children:a.jsx("button",{onClick:()=>O(_.combo_vaccine_image),className:"bg-black bg-opacity-50 text-white p-1 rounded-full hover:bg-opacity-70",children:a.jsx(K,{className:"w-4 h-4"})})})]})]})]})]}),a.jsxs("div",{className:"mt-6 text-sm text-gray-500",children:["申請日: ",A(_.created_at)]})]})})}),q&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"relative max-w-4xl max-h-full",children:[a.jsx("button",{onClick:()=>O(null),className:"absolute top-4 right-4 text-white bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-70",children:"×"}),a.jsx("img",{src:q,alt:"拡大画像",className:"max-w-full max-h-full object-contain"})]})})]})}):a.jsx("div",{className:"max-w-4xl mx-auto p-4",children:a.jsx(te,{className:"p-6",children:a.jsxs("div",{className:"flex items-center justify-center",children:[a.jsx(r,{className:"w-12 h-12 text-red-500 mr-4"}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold text-red-700",children:"アクセス権限がありません"}),a.jsx("p",{className:"text-red-600",children:"このページは管理者のみアクセス可能です。"})]})]})})})}},Symbol.toStringTag,{value:"Module"})),Ce={pet_hotel:"ペットホテル",pet_salon:"ペットサロン",veterinary:"動物病院",pet_cafe:"ペットカフェ",pet_restaurant:"ペット同伴レストラン",pet_shop:"ペットショップ",pet_accommodation:"ペット同伴宿泊"},Le=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const{user:e,isAdmin:t}=ae(),[r,n]=s.useState("pending"),[i,x]=s.useState([]),[m,h]=s.useState([]),[p,u]=s.useState([]),[g,j]=s.useState(!0),[N,v]=s.useState(""),[f,b]=s.useState(""),[y,w]=s.useState(!1),[S,C]=s.useState(!1),[L,D]=s.useState(null),[P,z]=s.useState(!1),[O,U]=s.useState(null),E=e=>{v(e),b(""),setTimeout((()=>v("")),8e3)};s.useEffect((()=>{t?I():E("管理者権限が必要です")}),[t]),s.useEffect((()=>{i.length>0&&F()}),[i]);const I=async()=>{try{j(!0),v("");const{data:e,error:s}=await me.from("pet_facilities").select("\n          *,\n          profiles:owner_id (\n            name,\n            address,\n            phone_number,\n            email\n          )\n        ").order("created_at",{ascending:!1});if(s)throw s;const a=await Promise.all((e||[]).map((async e=>{var s,a,t,r,l,n,i,c;const{data:d,error:x}=await me.from("facility_images").select("*").eq("facility_id",e.id).order("is_primary",{ascending:!1});return x?{...e,images:[],owner_name:(null==(s=e.profiles)?void 0:s.name)||"Unknown",owner_address:(null==(a=e.profiles)?void 0:a.address)||"住所未登録",owner_phone:(null==(t=e.profiles)?void 0:t.phone_number)||"",owner_email:(null==(r=e.profiles)?void 0:r.email)||""}:(d&&d.length>0&&d.forEach(((e,s)=>{})),{...e,images:d||[],owner_name:(null==(l=e.profiles)?void 0:l.name)||"Unknown",owner_address:(null==(n=e.profiles)?void 0:n.address)||"住所未登録",owner_phone:(null==(i=e.profiles)?void 0:i.phone_number)||"",owner_email:(null==(c=e.profiles)?void 0:c.email)||""})})));x(a)}catch(e){E(e instanceof Error?e.message:"データの取得に失敗しました")}finally{j(!1)}},F=()=>{const e=i.filter((e=>"pending"===e.status)),s=i.filter((e=>"approved"===e.status));h(e),u(s)},A=async s=>{w(!0),v(""),b("");try{const{error:a}=await me.from("pet_facilities").update({status:"approved",approved_at:(new Date).toISOString(),approved_by:null==e?void 0:e.id}).eq("id",s);if(a)throw a;b("施設を承認しました"),await I()}catch(a){v(a instanceof Error?a.message:"承認に失敗しました")}finally{w(!1)}},V=e=>{U(e),z(!0)},J=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},Y=e=>{switch(e){case"pending":return"承認待ち";case"approved":return"承認済み";case"rejected":return"却下";default:return"不明"}};return t?g?a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"データを読み込み中..."})]})}):a.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[a.jsxs("div",{className:"bg-white shadow rounded-lg mb-8",children:[a.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"ペット関連施設承認管理"}),a.jsx("p",{className:"text-gray-600",children:"登録されたペット関連施設の承認・却下を管理します"})]}),N&&a.jsx("div",{className:"px-6 py-4 bg-red-50 border-l-4 border-red-400",children:a.jsxs("div",{className:"flex",children:[a.jsx(Q,{className:"h-5 w-5 text-red-400 mr-2"}),a.jsx("p",{className:"text-sm text-red-700",children:N})]})}),f&&a.jsx("div",{className:"px-6 py-4 bg-green-50 border-l-4 border-green-400",children:a.jsxs("div",{className:"flex",children:[a.jsx(q,{className:"h-5 w-5 text-green-400 mr-2"}),a.jsx("p",{className:"text-sm text-green-700",children:f})]})}),a.jsx("div",{className:"px-6",children:a.jsxs("nav",{className:"flex space-x-8","aria-label":"Tabs",children:[a.jsxs("button",{onClick:()=>n("pending"),className:"whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm "+("pending"===r?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[a.jsx(_,{className:"w-5 h-5 inline mr-2"}),"承認待ち",a.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:m.length})]}),a.jsxs("button",{onClick:()=>n("approved"),className:"whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm "+("approved"===r?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[a.jsx(o,{className:"w-5 h-5 inline mr-2"}),"掲載中施設",a.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:p.length})]})]})})]}),"pending"===r&&a.jsx("div",{className:"space-y-6",children:0===m.length?a.jsxs(te,{className:"text-center py-12",children:[a.jsx(_,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"承認待ちの施設がありません"})]}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:m.map((e=>a.jsx(te,{className:"overflow-hidden",children:a.jsxs("div",{className:"p-6",children:[a.jsx("div",{className:"flex items-start justify-between mb-4",children:a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:e.name}),a.jsx("p",{className:"text-sm text-gray-600 mb-2",children:Ce[e.category_id]||e.category_id}),a.jsxs("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${J(e.status)}`,children:[a.jsx(_,{className:"w-3 h-3 mr-1"}),Y(e.status)]})]})}),a.jsxs("div",{className:"space-y-2 mb-4",children:[a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(c,{className:"w-4 h-4 mr-2"}),a.jsx("span",{className:"truncate",children:e.address})]}),e.phone&&a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx($,{className:"w-4 h-4 mr-2"}),a.jsx("span",{children:e.phone})]}),a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(d,{className:"w-4 h-4 mr-2"}),a.jsx("span",{children:new Date(e.created_at).toLocaleDateString("ja-JP")})]})]}),e.images.length>0&&a.jsxs("div",{className:"mb-4",children:[a.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["画像データ: ",e.images.length,"枚"]}),a.jsxs("div",{className:"bg-gray-100 p-3 rounded",children:[a.jsx("p",{className:"text-xs text-gray-500",children:"デバッグ情報: ブラウザのコンソールで画像データを確認してください"}),e.images.map(((e,s)=>{var t;return a.jsxs("div",{className:"text-xs mt-1",children:[s+1,". ID: ",e.id,", データ長: ",(null==(t=e.image_data)?void 0:t.length)||0]},e.id)}))]})]}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsx(re,{onClick:()=>{D(e),C(!0)},className:"flex-1",size:"sm",variant:"secondary",children:"詳細を確認"}),a.jsxs(re,{onClick:()=>A(e.id),disabled:y,className:"flex-1 bg-green-600 hover:bg-green-700",size:"sm",children:[a.jsx(l,{className:"w-4 h-4 mr-1"}),"承認"]}),a.jsx(re,{onClick:()=>V(e),disabled:y,className:"px-3 bg-red-600 hover:bg-red-700",size:"sm",children:a.jsx(k,{className:"w-4 h-4"})})]})]})},e.id)))})}),"approved"===r&&a.jsx("div",{className:"space-y-6",children:0===p.length?a.jsxs(te,{className:"text-center py-12",children:[a.jsx(o,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"掲載中の施設がありません"})]}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:p.map((e=>{var s,t,r,n,i,x;return a.jsx(te,{className:"overflow-hidden",children:a.jsxs("div",{className:"p-6",children:[a.jsx("div",{className:"flex items-start justify-between mb-4",children:a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:e.name}),a.jsx("p",{className:"text-sm text-gray-600 mb-2",children:Ce[e.category_id]||e.category_id}),a.jsxs("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${J(e.status)}`,children:[a.jsx(l,{className:"w-3 h-3 mr-1"}),Y(e.status)]})]})}),a.jsxs("div",{className:"space-y-2 mb-4",children:[a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(c,{className:"w-4 h-4 mr-2"}),a.jsx("span",{className:"truncate",children:e.address})]}),e.phone&&a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx($,{className:"w-4 h-4 mr-2"}),a.jsx("span",{children:e.phone})]}),a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(d,{className:"w-4 h-4 mr-2"}),a.jsx("span",{children:new Date(e.created_at).toLocaleDateString("ja-JP")})]})]}),e.images.length>0&&a.jsxs("div",{className:"mb-4",children:[a.jsxs("div",{className:"mb-2 p-2 bg-yellow-50 border border-yellow-200 rounded text-xs",children:[a.jsx("p",{className:"font-semibold",children:"🔧 デバッグ情報:"}),a.jsxs("p",{children:["画像数: ",e.images.length]}),a.jsxs("p",{children:["最初の画像データ長: ",(null==(t=null==(s=e.images[0])?void 0:s.image_data)?void 0:t.length)||0]}),a.jsxs("p",{children:["データ形式: ",(null==(n=null==(r=e.images[0])?void 0:r.image_data)?void 0:n.startsWith("data:"))?"Data URL":"Base64"]}),a.jsxs("p",{children:["データ開始: ",(null==(x=null==(i=e.images[0])?void 0:i.image_data)?void 0:x.substring(0,20))||"なし"]}),a.jsx("button",{onClick:()=>{const s=e.images[0];if(s&&s.image_data){let e="image/png";s.image_data.startsWith("iVBORw0KGgo")?e="image/png":s.image_data.startsWith("/9j/4")&&(e="image/jpeg");const a=s.image_data.startsWith("data:")?s.image_data:`data:${e};base64,${s.image_data}`,t=window.open("","_blank");t&&t.document.write(`\n                                      <html>\n                                        <head><title>画像テスト</title></head>\n                                        <body style="margin:0; padding:20px; background:#f0f0f0;">\n                                          <h2>画像テスト結果</h2>\n                                          <p>MIME Type: ${e}</p>\n                                          <p>Data Length: ${s.image_data.length}</p>\n                                          <p>Data Start: ${s.image_data.substring(0,50)}...</p>\n                                          <img src="${a}" style="max-width: 100%; border: 1px solid #ccc;" \n                                               onload="console.log('✅ テスト画像読み込み成功')" \n                                               onerror="console.log('❌ テスト画像読み込み失敗')" />\n                                        </body>\n                                      </html>\n                                    `)}},className:"mt-1 px-2 py-1 bg-blue-500 text-white rounded text-xs hover:bg-blue-600",children:"新しいタブで画像テスト"})]}),a.jsx("div",{className:"grid grid-cols-3 gap-2",children:e.images.slice(0,3).map(((e,s)=>{const t=e.image_data||"";if(!t)return a.jsx("div",{className:"w-full h-16 bg-gray-200 rounded border flex items-center justify-center",children:a.jsx("span",{className:"text-gray-500 text-xs",children:"No Data"})},e.id);const r=t.startsWith("data:")?t:`data:image/png;base64,${t}`;return a.jsxs("div",{className:"relative bg-gray-100 rounded border overflow-hidden",children:[a.jsx("img",{src:r,alt:`施設画像 ${s+1}`,className:"w-full h-16 object-cover",onLoad:()=>{},onError:e=>{const s=`data:image/png;base64,${t}`;e.currentTarget.src=s}}),a.jsx("button",{onClick:()=>{const e=window.open("","_blank");e&&e.document.write(`\n                                          <html>\n                                            <head><title>画像テスト ${s+1}</title></head>\n                                            <body style="margin:20px; background:#f0f0f0;">\n                                              <h3>画像テスト ${s+1}</h3>\n                                              <p>データ長: ${t.length}</p>\n                                              <p>開始: ${t.substring(0,50)}...</p>\n                                              <hr/>\n                                              <img src="${r}" style="max-width: 100%; border: 1px solid #ccc; background: white;" />\n                                            </body>\n                                          </html>\n                                        `)},className:"absolute top-1 right-1 bg-blue-500 text-white text-xs px-1 py-0.5 rounded hover:bg-blue-600",title:"新しいタブで画像テスト",children:"TEST"})]},e.id)}))}),e.images.length>3&&a.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["+",e.images.length-3,"枚の画像"]})]}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsx(re,{onClick:()=>{D(e),C(!0)},className:"flex-1",size:"sm",variant:"secondary",children:"詳細を確認"}),a.jsx(re,{onClick:()=>V(e),disabled:y,className:"px-3 bg-red-600 hover:bg-red-700",size:"sm",children:a.jsx(k,{className:"w-4 h-4"})})]})]})},e.id)}))})}),S&&L&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex items-start justify-between mb-6",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:L.name}),a.jsx("p",{className:"text-gray-600",children:Ce[L.category_id]||L.category_id})]}),a.jsx("button",{onClick:()=>C(!1),className:"text-gray-400 hover:text-gray-600",children:a.jsx(R,{className:"w-6 h-6"})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold mb-3",children:"基本情報"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(c,{className:"w-4 h-4 mr-2"}),a.jsx("span",{children:L.address})]}),L.phone&&a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx($,{className:"w-4 h-4 mr-2"}),a.jsx("span",{children:L.phone})]}),L.website&&a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(G,{className:"w-4 h-4 mr-2"}),a.jsx("a",{href:L.website,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800",children:L.website})]}),a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(d,{className:"w-4 h-4 mr-2"}),a.jsx("span",{children:new Date(L.created_at).toLocaleDateString("ja-JP")})]})]})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold mb-3",children:"オーナー情報"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(T,{className:"w-4 h-4 mr-2"}),a.jsx("span",{children:L.owner_name})]}),a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(c,{className:"w-4 h-4 mr-2"}),a.jsx("span",{children:L.owner_address})]}),L.owner_phone&&a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx($,{className:"w-4 h-4 mr-2"}),a.jsx("span",{children:L.owner_phone})]}),L.owner_email&&a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(G,{className:"w-4 h-4 mr-2"}),a.jsx("span",{children:L.owner_email})]})]})]})]}),a.jsxs("div",{className:"mb-6",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center",children:[a.jsx(M,{className:"w-5 h-5 mr-2"}),"本人確認書類"]}),a.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:L.identity_document_url&&""!==L.identity_document_url?a.jsxs("div",{className:"flex items-start space-x-4",children:[a.jsx("div",{className:"relative",children:a.jsx("img",{src:`${me.storage.from("vaccine-certs").getPublicUrl(L.identity_document_url||"").data.publicUrl}`,alt:"本人確認書類",className:"w-48 h-32 object-cover rounded border shadow-sm cursor-pointer hover:shadow-md transition-shadow",onClick:()=>{window.open(`${me.storage.from("vaccine-certs").getPublicUrl(L.identity_document_url||"").data.publicUrl}`,"_blank")}})}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"mb-2",children:[a.jsx("span",{className:"text-sm font-medium text-gray-700",children:"ファイル名:"}),a.jsx("span",{className:"text-sm text-gray-600 ml-2",children:L.identity_document_filename||"identity_document"})]}),a.jsxs("div",{className:"mb-2",children:[a.jsx("span",{className:"text-sm font-medium text-gray-700",children:"登録者情報:"}),a.jsxs("div",{className:"text-sm text-gray-600 ml-2",children:[a.jsxs("p",{children:["氏名: ",L.owner_name]}),a.jsxs("p",{children:["住所: ",L.owner_address]})]})]}),a.jsx("div",{className:"text-xs text-gray-500 mt-2",children:"クリックして拡大表示"})]})]}):a.jsxs("div",{className:"text-center py-8",children:[a.jsx(M,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),a.jsx("p",{className:"text-sm text-gray-600",children:"本人確認書類が提出されていません"})]})})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-3",children:"ステータス"}),a.jsxs("div",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${J(L.status)}`,children:["pending"===L.status&&a.jsx(_,{className:"w-4 h-4 mr-2"}),"approved"===L.status&&a.jsx(l,{className:"w-4 h-4 mr-2"}),"rejected"===L.status&&a.jsx(R,{className:"w-4 h-4 mr-2"}),Y(L.status)]})]}),L.description&&a.jsxs("div",{className:"mb-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-3",children:"施設紹介"}),a.jsx("p",{className:"text-gray-700 whitespace-pre-line",children:L.description})]}),L.images.length>0&&a.jsxs("div",{className:"mb-6",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-3",children:["施設画像 (",L.images.length,"枚)"]}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:L.images.map(((e,s)=>{const t=e.image_data.startsWith("data:")?e.image_data:`data:image/png;base64,${e.image_data}`;return a.jsxs("div",{className:"relative",children:[a.jsx("img",{src:t,alt:`施設画像 ${s+1}`,className:"w-full h-32 object-cover rounded-lg border",onLoad:()=>{},onError:e=>{e.currentTarget.src="https://via.placeholder.com/400x300?text=Load+Error"}}),e.is_primary&&a.jsx("div",{className:"absolute top-2 left-2 bg-blue-500 text-white text-xs px-2 py-1 rounded",children:"メイン"})]},e.id)}))})]}),"pending"===L.status&&a.jsx("div",{className:"flex space-x-4",children:a.jsxs(re,{onClick:()=>A(L.id),disabled:y,className:"flex-1 bg-green-600 hover:bg-green-700",children:[a.jsx(l,{className:"w-4 h-4 mr-2"}),"承認する"]})})]})})}),P&&O&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsx("div",{className:"bg-white rounded-lg max-w-md w-full",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex items-start justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx(Q,{className:"w-8 h-8 text-red-500"})}),a.jsx("div",{className:"ml-3",children:a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"施設申請を削除"})})]}),a.jsx("button",{onClick:()=>z(!1),className:"text-gray-400 hover:text-gray-600",children:a.jsx(k,{className:"w-6 h-6"})})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"以下の施設申請を削除してもよろしいですか？この操作は取り消せません。"}),a.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[a.jsx("p",{className:"font-medium text-gray-900",children:O.name}),a.jsx("p",{className:"text-sm text-gray-600",children:O.address}),a.jsx("p",{className:"text-sm text-gray-600",children:Ce[O.category_id]||O.category_id})]})]}),a.jsxs("div",{className:"flex space-x-3",children:[a.jsx(re,{onClick:()=>z(!1),variant:"secondary",className:"flex-1",disabled:y,children:"キャンセル"}),a.jsxs(re,{onClick:()=>(async e=>{w(!0),v(""),b("");try{const{error:s}=await me.from("facility_images").delete().eq("facility_id",e),{error:a}=await me.from("pet_facilities").delete().eq("id",e);if(a)throw a;b("施設申請を削除しました"),await I()}catch(s){v(s instanceof Error?s.message:"削除に失敗しました")}finally{w(!1),z(!1),U(null)}})(O.id),disabled:y,className:"flex-1 bg-red-600 hover:bg-red-700",children:[a.jsx(k,{className:"w-4 h-4 mr-2"}),"削除する"]})]})]})})})]})}):a.jsx("div",{className:"max-w-4xl mx-auto p-4",children:a.jsx(te,{className:"p-6",children:a.jsxs("div",{className:"flex items-center justify-center",children:[a.jsx(Q,{className:"w-12 h-12 text-red-500 mr-4"}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-semibold text-red-700",children:"アクセス権限がありません"}),a.jsx("p",{className:"text-red-600",children:"このページは管理者のみアクセス可能です。"})]})]})})})}},Symbol.toStringTag,{value:"Module"})),De=Object.freeze(Object.defineProperty({__proto__:null,AdminRevenueReport:function(){const{user:t,isAdmin:l}=ae(),i=e(),[c,m]=s.useState(!0),[h,p]=s.useState(""),[u,g]=s.useState([]),[j,f]=s.useState([]),[b,y]=s.useState(""),[_,w]=s.useState((new Date).getFullYear()),[k,S]=s.useState((new Date).getMonth()),[C,D]=s.useState(0),[$,P]=s.useState(0),[z,q]=s.useState(0),M=Array.from({length:4},((e,s)=>{const a=(new Date).getFullYear()-s;return{value:a,label:`${a}年`}}));s.useEffect((()=>{l?O():i("/")}),[l,i,_,k]),s.useEffect((()=>{u.length>0&&U()}),[u,b]);const O=async()=>{try{m(!0),p("");const e=new Date(_,k,1),s=new Date(_,k+1,0),a=e.toISOString().split("T")[0],t=s.toISOString().split("T")[0],{data:r,error:l}=await me.rpc("get_monthly_revenue_by_park",{start_date_param:a,end_date_param:t});if(l)throw l;const n=(r||[]).map((e=>({owner_id:e.owner_id,owner_name:e.owner_name,park_id:e.park_id,park_name:e.park_name,total_revenue:e.total_revenue,platform_fee:Math.round(.2*e.total_revenue),owner_payout:Math.round(.8*e.total_revenue),bank_name:e.bank_name||"未設定",bank_code:e.bank_code||"未設定",branch_name:e.branch_name||"未設定",branch_code:e.branch_code||"未設定",account_type:e.account_type||"ordinary",account_number:e.account_number||"未設定",month:k+1,year:_})));g(n);const i=n.reduce(((e,s)=>(e.totalRevenue+=s.total_revenue,e.totalPlatformFee+=s.platform_fee,e.totalOwnerPayout+=s.owner_payout,e)),{totalRevenue:0,totalPlatformFee:0,totalOwnerPayout:0});D(i.totalRevenue),P(i.totalPlatformFee),q(i.totalOwnerPayout),U()}catch(e){p("売上データの取得に失敗しました。")}finally{m(!1)}},U=()=>{if(!b.trim())return void f(u);const e=u.filter((e=>e.owner_name.toLowerCase().includes(b.toLowerCase())||e.park_name.toLowerCase().includes(b.toLowerCase())));f(e)};return c?a.jsx("div",{className:"flex justify-center items-center h-64",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):a.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[a.jsx("div",{className:"flex items-center space-x-4 mb-6",children:a.jsxs(n,{to:"/admin",className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[a.jsx(v,{className:"w-4 h-4 mr-2"}),"管理者ダッシュボードに戻る"]})}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("h1",{className:"text-2xl font-bold flex items-center",children:[a.jsx(x,{className:"w-8 h-8 text-green-600 mr-3"}),"ドッグラン売上レポート"]}),a.jsxs(re,{onClick:()=>{const e=j.map((e=>[e.owner_name,e.park_name,e.total_revenue,e.platform_fee,e.owner_payout,e.bank_name,e.bank_code,e.branch_name,e.branch_code,"ordinary"===e.account_type?"普通":"当座",e.account_number,e.year,e.month]));ue(["オーナー名","ドッグラン名","売上合計額","プラットフォーム手数料（20%）","振込金額（80%）","銀行名","銀行コード","支店名","支店コード","口座種別","口座番号","年","月"],e,`ドッグラン売上_${_}年${k+1}月.csv`)},disabled:0===j.length,children:[a.jsx(N,{className:"w-4 h-4 mr-2"}),"CSV出力"]})]}),h&&a.jsxs("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4 flex items-start",children:[a.jsx(r,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),a.jsx("p",{children:h})]}),a.jsx(te,{className:"p-6",children:a.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx(re,{variant:"secondary",size:"sm",onClick:()=>{0===k?(w(_-1),S(11)):S(k-1)},children:a.jsx(H,{className:"w-4 h-4"})}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("select",{value:_,onChange:e=>w(Number(e.target.value)),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:M.map((e=>a.jsx("option",{value:e.value,children:e.label},e.value)))}),a.jsx("select",{value:k,onChange:e=>S(Number(e.target.value)),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[{value:0,label:"1月"},{value:1,label:"2月"},{value:2,label:"3月"},{value:3,label:"4月"},{value:4,label:"5月"},{value:5,label:"6月"},{value:6,label:"7月"},{value:7,label:"8月"},{value:8,label:"9月"},{value:9,label:"10月"},{value:10,label:"11月"},{value:11,label:"12月"}].map((e=>a.jsx("option",{value:e.value,children:e.label},e.value)))})]}),a.jsx(re,{variant:"secondary",size:"sm",onClick:()=>{const e=new Date,s=e.getFullYear(),a=e.getMonth();_===s&&k===a||(11===k?(w(_+1),S(0)):S(k+1))},disabled:_===(new Date).getFullYear()&&k===(new Date).getMonth(),children:a.jsx(X,{className:"w-4 h-4"})})]}),a.jsx("div",{className:"w-full md:w-64",children:a.jsx(ce,{label:"",value:b,onChange:e=>y(e.target.value),placeholder:"オーナー名・ドッグラン名で検索...",icon:a.jsx(L,{className:"w-4 h-4 text-gray-500"})})})]})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[a.jsx(te,{className:"p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"総売上"}),a.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["¥",C.toLocaleString()]})]}),a.jsx(x,{className:"w-8 h-8 text-green-600"})]})}),a.jsx(te,{className:"p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"プラットフォーム手数料（20%）"}),a.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["¥",$.toLocaleString()]})]}),a.jsx(o,{className:"w-8 h-8 text-blue-600"})]})}),a.jsx(te,{className:"p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"オーナー振込額（80%）"}),a.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:["¥",z.toLocaleString()]})]}),a.jsx(Z,{className:"w-8 h-8 text-purple-600"})]})})]}),a.jsxs(te,{className:"p-6",children:[a.jsx("h2",{className:"text-xl font-semibold mb-4",children:"ドッグラン別売上"}),0===j.length?a.jsxs("div",{className:"text-center py-8",children:[a.jsx(d,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"この月の売上データはありません"})]}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full bg-white",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"オーナー名"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ドッグラン名"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"売上合計"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"手数料（20%）"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"振込金額（80%）"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"振込先"})]})}),a.jsx("tbody",{className:"divide-y divide-gray-200",children:j.map((e=>a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.owner_name}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.park_name}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:["¥",e.total_revenue.toLocaleString()]}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:["¥",e.platform_fee.toLocaleString()]}),a.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-green-600",children:["¥",e.owner_payout.toLocaleString()]}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:"未設定"!==e.bank_name?a.jsxs("div",{children:[a.jsxs("p",{children:[e.bank_name,"（",e.bank_code,"）"]}),a.jsxs("p",{children:[e.branch_name,"（",e.branch_code,"）"]}),a.jsxs("p",{children:["ordinary"===e.account_type?"普通":"当座"," ",e.account_number]})]}):a.jsx("span",{className:"text-red-600",children:"未設定"})})]},`${e.park_id}-${e.month}-${e.year}`)))})]})})]}),a.jsx(te,{className:"p-6 bg-blue-50 border-blue-200",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(Z,{className:"w-6 h-6 text-blue-600 mt-1 flex-shrink-0"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"振込情報について"}),a.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[a.jsx("p",{children:"• 振込は毎月15日に前月分を一括で行います"}),a.jsx("p",{children:"• 振込手数料は当社負担です"}),a.jsx("p",{children:"• 振込先情報が未設定のオーナーには振込ができません"}),a.jsx("p",{children:"• 振込金額が5,000円未満の場合は翌月に繰り越されます"}),a.jsx("p",{children:"• 振込完了後、オーナーに自動でメールが送信されます"})]})]})]})})]})}},Symbol.toStringTag,{value:"Module"})),$e=Object.freeze(Object.defineProperty({__proto__:null,AdminUserDetail:function(){const{isAdmin:t}=ae(),r=e(),{userId:n}=ee(),[i,x]=s.useState(null),[m,o]=s.useState(!0),[h,p]=s.useState("");s.useEffect((()=>{t?n&&u(n):r("/")}),[t,r,n]);const u=async e=>{var s;try{o(!0),p("");const{data:a,error:t}=await me.from("profiles").select("*").eq("id",e).single();if(t)throw new Error("ユーザー情報の取得に失敗しました");const{data:r,error:l}=await me.from("dogs").select("id, name, breed, age, gender, image_url").eq("owner_id",e),{data:n,error:i}=await me.from("reservations").select("\n          id,\n          date,\n          time_slot,\n          total_amount,\n          status,\n          dog_parks (\n            name\n          )\n        ").eq("user_id",e).order("date",{ascending:!1}).limit(20),c=(n||[]).reduce(((e,s)=>e+(s.total_amount||0)),0),d=`user_${e.slice(0,8)}@unknown.com`,m={id:a.id,name:a.name||"Unknown",email:d,phone:a.phone_number||"",postal_code:a.postal_code||"",address:a.address||"",user_type:a.user_type||"user",created_at:a.created_at,is_active:!0,dogs:r||[],reservations:(n||[]).map((e=>{var s;return{id:e.id,park_name:(null==(s=e.dog_parks)?void 0:s.name)||"Unknown Park",date:e.date,time_slot:e.time_slot,total_amount:e.total_amount||0,status:e.status}})),subscription_status:"inactive",total_spent:c,last_activity:(null==(s=null==n?void 0:n[0])?void 0:s.date)||""};x(m)}catch(a){p(a instanceof Error?a.message:"ユーザー詳細の取得に失敗しました")}finally{o(!1)}};return m?a.jsx("div",{className:"flex justify-center items-center h-screen",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):h?a.jsxs("div",{className:"max-w-4xl mx-auto p-4",children:[a.jsx("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4",children:h}),a.jsxs(re,{onClick:()=>r("/admin/users"),className:"mt-4",variant:"secondary",children:[a.jsx(v,{className:"w-4 h-4 mr-2"}),"ユーザー一覧に戻る"]})]}):i?a.jsxs("div",{className:"max-w-4xl mx-auto p-4 space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs(re,{onClick:()=>r("/admin/users"),variant:"secondary",size:"sm",children:[a.jsx(v,{className:"w-4 h-4 mr-2"}),"ユーザー一覧に戻る"]}),a.jsxs("div",{className:"flex items-center space-x-2",children:["active"===i.subscription_status&&a.jsxs("span",{className:"bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-sm font-medium flex items-center",children:[a.jsx(C,{className:"w-4 h-4 mr-1"}),"サブスク会員"]}),i.is_active?a.jsxs("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded-full text-sm font-medium flex items-center",children:[a.jsx(l,{className:"w-4 h-4 mr-1"}),"アクティブ"]}):a.jsxs("span",{className:"bg-red-100 text-red-800 px-2 py-1 rounded-full text-sm font-medium flex items-center",children:[a.jsx(R,{className:"w-4 h-4 mr-1"}),"非アクティブ"]})]})]}),a.jsxs(te,{className:"p-6",children:[a.jsxs("div",{className:"flex items-center mb-6",children:[a.jsx(T,{className:"w-8 h-8 text-blue-600 mr-3"}),a.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:i.name})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center text-gray-600",children:[a.jsx(D,{className:"w-5 h-5 mr-3 text-gray-400"}),a.jsx("span",{children:i.email})]}),i.phone&&a.jsxs("div",{className:"flex items-center text-gray-600",children:[a.jsx($,{className:"w-5 h-5 mr-3 text-gray-400"}),a.jsx("span",{children:i.phone})]}),i.address&&a.jsxs("div",{className:"flex items-center text-gray-600",children:[a.jsx(c,{className:"w-5 h-5 mr-3 text-gray-400"}),a.jsxs("span",{children:[i.postal_code," ",i.address]})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center text-gray-600",children:[a.jsx(d,{className:"w-5 h-5 mr-3 text-gray-400"}),a.jsxs("span",{children:["登録日: ",new Date(i.created_at).toLocaleDateString("ja-JP")]})]}),i.last_activity&&a.jsxs("div",{className:"flex items-center text-gray-600",children:[a.jsx(_,{className:"w-5 h-5 mr-3 text-gray-400"}),a.jsxs("span",{children:["最終活動: ",new Date(i.last_activity).toLocaleDateString("ja-JP")]})]}),a.jsxs("div",{className:"flex items-center text-gray-600",children:[a.jsx(se,{className:"w-5 h-5 mr-3 text-gray-400"}),a.jsxs("span",{children:["総支払額: ¥",i.total_spent.toLocaleString()]})]})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsx(te,{className:"p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"登録犬数"}),a.jsx("p",{className:"text-2xl font-bold text-blue-600",children:i.dogs.length})]}),a.jsx(P,{className:"w-8 h-8 text-blue-600"})]})}),a.jsx(te,{className:"p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"予約数"}),a.jsx("p",{className:"text-2xl font-bold text-green-600",children:i.reservations.length})]}),a.jsx(d,{className:"w-8 h-8 text-green-600"})]})}),a.jsx(te,{className:"p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"総支払額"}),a.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:["¥",i.total_spent.toLocaleString()]})]}),a.jsx(se,{className:"w-8 h-8 text-purple-600"})]})})]}),a.jsxs(te,{className:"p-6",children:[a.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[a.jsx(P,{className:"w-5 h-5 mr-2"}),"登録犬一覧 (",i.dogs.length,"匹)"]}),0===i.dogs.length?a.jsx("p",{className:"text-gray-500",children:"登録された犬はありません"}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.dogs.map((e=>a.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[e.image_url?a.jsx("img",{src:e.image_url,alt:e.name,className:"w-12 h-12 rounded-full object-cover"}):a.jsx("div",{className:"w-12 h-12 bg-gray-300 rounded-full flex items-center justify-center",children:a.jsx(P,{className:"w-6 h-6 text-gray-600"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-gray-800",children:e.name}),a.jsxs("p",{className:"text-sm text-gray-600",children:[e.breed," • ",e.gender]}),a.jsxs("p",{className:"text-sm text-gray-500",children:[e.age,"歳"]})]})]})},e.id)))})]}),a.jsxs(te,{className:"p-6",children:[a.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[a.jsx(d,{className:"w-5 h-5 mr-2"}),"予約履歴 (",i.reservations.length,"件)"]}),0===i.reservations.length?a.jsx("p",{className:"text-gray-500",children:"予約履歴はありません"}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"ドッグパーク"}),a.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"予約日"}),a.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"時間"}),a.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"金額"}),a.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"ステータス"})]})}),a.jsx("tbody",{className:"divide-y divide-gray-200",children:i.reservations.map((e=>a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.park_name}),a.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:new Date(e.date).toLocaleDateString("ja-JP")}),a.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.time_slot}),a.jsxs("td",{className:"px-4 py-3 text-sm text-gray-900",children:["¥",e.total_amount.toLocaleString()]}),a.jsx("td",{className:"px-4 py-3",children:a.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("confirmed"===e.status?"bg-green-100 text-green-800":"cancelled"===e.status?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:"confirmed"===e.status?"確定":"cancelled"===e.status?"キャンセル":"保留中"})})]},e.id)))})]})})]})]}):a.jsx("div",{className:"max-w-4xl mx-auto p-4",children:a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-gray-600",children:"ユーザーが見つかりません"}),a.jsxs(re,{onClick:()=>r("/admin/users"),className:"mt-4",variant:"secondary",children:[a.jsx(v,{className:"w-4 h-4 mr-2"}),"ユーザー一覧に戻る"]})]})})}},Symbol.toStringTag,{value:"Module"})),Pe=Object.freeze(Object.defineProperty({__proto__:null,AdminNewsManagement:function(){const{user:t,isAdmin:r}=ae(),l=e();return s.useEffect((()=>{r||l("/")}),[r,l]),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx(n,{to:"/admin",children:a.jsx("button",{className:"p-2 text-gray-600 hover:text-gray-900 transition-colors",children:a.jsx(v,{className:"w-5 h-5"})})}),a.jsxs("div",{children:[a.jsxs("h1",{className:"text-2xl font-bold flex items-center",children:[a.jsx(u,{className:"w-8 h-8 text-yellow-600 mr-3"}),"新着情報管理"]}),a.jsx("p",{className:"text-gray-600",children:"サイトの新着情報を管理します"})]})]}),a.jsxs("div",{className:"text-sm text-gray-500",children:["最終更新: ",(new Date).toLocaleString("ja-JP")]})]}),a.jsx(xe,{})]})}},Symbol.toStringTag,{value:"Module"}));export{je as A,Ne as a,ve as b,fe as c,be as d,ye as e,we as f,ke as g,Se as h,Le as i,De as j,$e as k,Pe as l};

import{u as we,j as e,B as y,s as h,C as N}from"./index-B2nIfDq6.js";import{r as n,h as Ye,d as Qe,L as fe}from"./react-vendor-ClX3xUyT.js";import{L as We,K as re,i as _e,A as z,Y as Ne,o as ke,z as be,J as Xe,n as Ve,G as H,a0 as Ze,P as Fe,C as W,R as es,M as ye,U as ss,a5 as ts,d as as,m as rs,X as ls,ab as ns,ac as is}from"./ui-vendor-Bbvw08tP.js";import{I as cs}from"./Input-_c6WZwIR.js";import{S as os}from"./Select-DMnQLiAJ.js";import"./supabase-vendor-CRpuwX9I.js";function ve({lockId:r,className:l="",variant:i="primary",size:t="md",label:g="ドアを開ける",showStatus:S=!0,onSuccess:C,onError:b,reservationId:m}){const{user:D}=we(),[L,R]=n.useState(!1),[P,a]=n.useState(null),[p,I]=n.useState(null),[A,B]=n.useState(!1),[G,K]=n.useState(""),X=async o=>{try{const{data:j,error:x}=await h.from("reservations").select(`
          *,
          dog_park:dog_parks(*),
          dog:dogs(*)
        `).eq("id",o).single();return x?(console.error("Error fetching reservation:",x),null):j}catch(j){return console.error("Error fetching reservation:",j),null}},O=o=>{try{const j=new Date(o.date),x=o.start_time.split(":").map(Number),_=x[0]??0,u=x[1]??0;return j.setHours(_,u,0,0),new Date(j.getTime()+o.duration*60*60*1e3)}catch(j){return console.error("Error calculating reservation end time:",j),null}};n.useEffect(()=>{if(p){const o=setTimeout(()=>{I(null)},3e3);return()=>clearTimeout(o)}},[p]),n.useEffect(()=>{if(P){const o=setTimeout(()=>{a(null)},5e3);return()=>clearTimeout(o)}},[P]);const V=async()=>{if(D){R(!0),a(null),I(null);try{const{data:{session:o},error:j}=await h.auth.getSession();if(j||!o?.access_token)throw new Error("認証が必要です");let x=5,_=null;if(m){const $=await X(m);if($&&$.reservation_type==="whole_facility"&&(_=O($),_)){const Y=new Date,T=_.getTime()-Y.getTime();x=Math.max(1,Math.ceil(T/(1e3*60)))}}const u=await fetch("https://onmcivwxtzqajcovptgf.supabase.co/functions/v1/generate-pin",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o.access_token}`},body:JSON.stringify({lock_id:r,purpose:"entry",expiry_minutes:x,reservation_id:m||void 0})});if(!u.ok){const $=await u.json();throw new Error($.error||"PINコードの生成に失敗しました")}const{pin:U}=await u.json();alert(`PINコード: ${U}

このPINコードをスマートロックのキーパッドに入力してください。`),I(U),C&&C()}catch(o){if(console.error("Error generating PIN:",o),o.message&&o.message.startsWith("PAYMENT_REQUIRED:")){const j=o.message.replace("PAYMENT_REQUIRED:","").trim();K(j),B(!0),a(null)}else a(o.message||"PINコードの生成に失敗しました"),B(!1);b&&b(o.message||"PINコードの生成に失敗しました")}finally{R(!1)}}};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(y,{onClick:()=>void V(),isLoading:L,variant:i,size:t,className:`flex items-center ${l}`,children:[L?e.jsx(We,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(re,{className:"w-4 h-4 mr-2"}),g]}),S&&e.jsxs(e.Fragment,{children:[p&&e.jsxs("div",{className:"flex items-center text-green-600 text-sm mt-1",children:[e.jsx(_e,{className:"w-4 h-4 mr-1"}),e.jsx("span",{children:"PINコードを生成しました"})]}),P&&e.jsxs("div",{className:"flex items-center text-red-600 text-sm mt-1",children:[e.jsx(z,{className:"w-4 h-4 mr-1"}),e.jsx("span",{children:P})]}),A&&e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg border border-blue-200 mt-2",children:[e.jsxs("div",{className:"flex items-start space-x-2 mb-3",children:[e.jsx(Ne,{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-1",children:"決済が必要です"}),e.jsx("p",{className:"text-sm text-blue-800",children:G})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(y,{onClick:()=>window.location.href="/subscription",size:"sm",className:"w-full bg-purple-600 hover:bg-purple-700",children:[e.jsx(Ne,{className:"w-3 h-3 mr-1"}),"サブスク加入"]}),e.jsxs(y,{onClick:()=>window.location.href="/parks",size:"sm",variant:"secondary",className:"w-full",children:[e.jsx(ke,{className:"w-3 h-3 mr-1"}),"1日券購入"]})]})]})]})]})}function ds({park:r,parkImages:l,todayRentals:i,onImageClick:t}){const g=ms(r.current_occupancy,r.max_capacity);return e.jsx(e.Fragment,{children:l.length>0&&e.jsxs("div",{className:"relative h-64 rounded-lg overflow-hidden",children:[e.jsx("img",{src:l[0].url,alt:r.name,className:"w-full h-full object-cover cursor-pointer",onClick:()=>t(0),onError:S=>{S.currentTarget.src="https://images.pexels.com/photos/1108099/pexels-photo-1108099.jpeg"}}),e.jsx("div",{className:"absolute top-4 right-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${g.color}`,children:g.text})}),i.length>0&&e.jsx("div",{className:"absolute top-4 left-4",children:e.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-orange-500 text-white",children:"本日貸し切りあり"})})]})})}function ms(r,l){const i=r/l*100;return i<25?{text:"空いています",color:"text-green-600 bg-green-100"}:i<50?{text:"やや空いています",color:"text-blue-600 bg-blue-100"}:i<75?{text:"やや混んでいます",color:"text-yellow-600 bg-yellow-100"}:{text:"混んでいます",color:"text-red-600 bg-red-100"}}function xs({parkImages:r,onImageClick:l}){return r.length<=1?null:e.jsxs("div",{className:"grid grid-cols-5 gap-2",children:[r.slice(1,6).map((i,t)=>e.jsx("div",{className:"h-20 rounded-lg overflow-hidden cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>l(t+1),children:e.jsx("img",{src:i.url,alt:i.caption||`画像 ${t+2}`,className:"w-full h-full object-cover",onError:g=>{g.currentTarget.src="https://images.pexels.com/photos/1108099/pexels-photo-1108099.jpeg"}})},i.id)),r.length>6&&e.jsxs("div",{className:"h-20 rounded-lg overflow-hidden cursor-pointer relative bg-gray-200 flex items-center justify-center",onClick:()=>l(6),children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:e.jsxs("span",{className:"text-white font-medium",children:["+",r.length-6]})}),e.jsx("img",{src:r[6].url,alt:"その他の画像",className:"w-full h-full object-cover opacity-60"})]})]})}function hs({park:r}){return e.jsxs(N,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"設備・サービス"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:Object.entries({parking:"駐車場",shower:"シャワー設備",restroom:"トイレ",agility:"アジリティ設備",rest_area:"休憩スペース",water_station:"給水設備"}).map(([l,i])=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-4 h-4 rounded ${r.facilities[l]?"bg-green-500":"bg-gray-300"}`}),e.jsx("span",{className:"text-sm",children:i})]},l))}),r.facility_details&&e.jsx("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-700",children:r.facility_details})})]})}function us({park:r,reviews:l,userReview:i,canReview:t,user:g,userDogs:S,showReviewForm:C,setShowReviewForm:b,reviewFormData:m,setReviewFormData:D,isSubmitting:L,handleReviewSubmit:R,handleDeleteReview:P}){return e.jsxs(N,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[e.jsx(be,{className:"w-6 h-6 mr-2"}),"レビュー (",r.review_count,")"]}),g&&t&&e.jsx(y,{onClick:()=>b(!C),variant:i?"secondary":"primary",size:"sm",children:i?e.jsxs(e.Fragment,{children:[e.jsx(Xe,{className:"w-4 h-4 mr-2"}),"レビューを編集"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"}),"レビューを書く"]})})]}),C&&e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-4",children:i?"レビューを編集":"レビューを投稿"}),e.jsxs("form",{onSubmit:R,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"評価 *"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[[1,2,3,4,5].map(a=>e.jsx("button",{type:"button",onClick:()=>D({...m,rating:a}),className:"focus:outline-none",children:e.jsx(H,{className:`w-8 h-8 ${a<=m.rating?"text-yellow-400 fill-current":"text-gray-300 hover:text-yellow-300"} transition-colors`})},a)),e.jsxs("span",{className:"ml-2 text-sm text-gray-600",children:[m.rating,"つ星"]})]})]}),e.jsx(os,{label:"レビューするワンちゃん *",options:S.map(a=>({value:a.id,label:a.name})),value:m.dog_id,onChange:a=>D({...m,dog_id:a.target.value}),required:!0}),e.jsx(cs,{label:"訪問日 *",type:"date",value:m.visit_date,onChange:a=>D({...m,visit_date:a.target.value}),max:new Date().toISOString().split("T")[0],required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"レビュー内容"}),e.jsx("textarea",{value:m.review_text,onChange:a=>D({...m,review_text:a.target.value}),placeholder:"ドッグランの感想をお聞かせください...",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(y,{type:"button",variant:"secondary",onClick:()=>b(!1),children:"キャンセル"}),i&&e.jsxs(y,{type:"button",onClick:P,className:"bg-red-600 hover:bg-red-700",children:[e.jsx(Ze,{className:"w-4 h-4 mr-2"}),"削除"]})]}),e.jsx(y,{type:"submit",isLoading:L,disabled:!m.dog_id||!m.visit_date,children:i?"更新する":"投稿する"})]})]})]}),l.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(be,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"まだレビューがありません"}),g&&t&&e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"最初のレビューを投稿してみませんか？"})]}):e.jsx("div",{className:"space-y-6",children:l.map(a=>e.jsx("div",{className:"border-b border-gray-200 pb-6 last:border-b-0",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center overflow-hidden",children:a.dog_image_url?e.jsx("img",{src:a.dog_image_url,alt:a.dog_name,className:"w-full h-full object-cover"}):e.jsx(Fe,{className:"w-6 h-6 text-gray-500"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:a.user_name}),e.jsx("span",{className:"text-sm text-gray-500",children:"と"}),e.jsxs("span",{className:"font-medium text-blue-600",children:[a.dog_name,"ちゃん"]}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",a.dog_breed,")"]})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("div",{className:"flex items-center space-x-1",children:[1,2,3,4,5].map(p=>e.jsx(H,{className:`w-4 h-4 ${p<=a.rating?"text-yellow-400 fill-current":"text-gray-300"}`},p))}),e.jsxs("span",{className:"text-sm text-gray-600",children:[new Date(a.visit_date).toLocaleDateString("ja-JP")," に訪問"]})]})]}),e.jsx("span",{className:"text-xs text-gray-400",children:new Date(a.created_at).toLocaleDateString("ja-JP")})]}),a.review_text&&e.jsx("p",{className:"text-gray-700 leading-relaxed mb-3",children:a.review_text}),a.review_images&&a.review_images.length>0&&e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:a.review_images.map((p,I)=>e.jsxs("div",{className:"relative group cursor-pointer",children:[e.jsx("img",{src:p.url,alt:p.caption||`レビュー画像 ${I+1}`,className:"w-full h-24 object-cover rounded-lg border border-gray-200 hover:opacity-90 transition-opacity",onClick:()=>window.open(p.url,"_blank")}),p.caption&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white text-xs p-1 rounded-b-lg opacity-0 group-hover:opacity-100 transition-opacity",children:p.caption})]},I))})}),a.main_image_url&&(!a.review_images||a.review_images.length===0)&&e.jsx("div",{className:"mt-3",children:e.jsx("img",{src:a.main_image_url,alt:"レビュー画像",className:"w-full max-w-md h-48 object-cover rounded-lg border border-gray-200 cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>window.open(a.main_image_url,"_blank")})})]})]})},a.id))}),g&&!t&&e.jsx("div",{className:"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-yellow-800",children:"レビューを投稿するには、このドッグランを実際に利用する必要があります。"})})]})}function gs({rentalInfo:r}){return e.jsx(N,{className:"p-6 bg-orange-50 border-orange-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(z,{className:"w-6 h-6 text-orange-600 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-orange-900 mb-3",children:"施設貸し切り予約あり"}),e.jsx("p",{className:"text-sm text-orange-800 mb-4",children:"以下の日時は施設貸し切りのため、通常利用（1日券・サブスク）での入場はできません。"}),e.jsx("div",{className:"space-y-4",children:r.map((l,i)=>e.jsxs("div",{className:"bg-white p-3 rounded-lg border border-orange-200",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(ke,{className:"w-5 h-5 text-orange-600"}),e.jsx("span",{className:"font-medium text-orange-900",children:new Date(l.date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric",weekday:"long"})})]}),e.jsx("div",{className:"space-y-1",children:l.slots.map((t,g)=>e.jsxs("div",{className:"flex items-center text-sm text-orange-800",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),e.jsxs("span",{children:[t.start," 〜 ",t.end]})]},g))})]},i))})]})]})})}function vs(){const{parkId:r}=Ye(),{user:l}=we(),i=Qe(),[t,g]=n.useState(null),[S,C]=n.useState([]),[b,m]=n.useState(null),[D,L]=n.useState([]),[R,P]=n.useState(!1),[a,p]=n.useState(!0),[I,A]=n.useState(!1),[B,G]=n.useState(!1),[K,X]=n.useState([]),[O,V]=n.useState([]),[o,j]=n.useState(null),[x,_]=n.useState({rating:5,review_text:"",visit_date:"",dog_id:""}),[u,U]=n.useState([]),[$,Y]=n.useState(!1),[T,Z]=n.useState(0),[q,Se]=n.useState([]),[le,De]=n.useState(!1),[Q,ne]=n.useState(!1),[Pe,Ie]=n.useState(new Date),[ie,Ee]=n.useState(null),[F,Ce]=n.useState([]),[d,$e]=n.useState(null);n.useEffect(()=>{r&&ee()},[r,l]);const ee=async()=>{try{const{data:s,error:c}=await h.from("dog_parks").select("*").eq("id",r).eq("status","approved").single();if(c){console.error("Park not found:",c),i("/parks");return}g(s);const{data:f,error:E}=await h.from("dog_park_images").select("*").eq("park_id",r).order("display_order",{ascending:!0});if(!E&&f){const v=[];s.image_url&&v.push({id:"main",url:s.image_url,caption:`${s.name} - メイン画像`}),s.cover_image_url&&v.push({id:"cover",url:s.cover_image_url,caption:`${s.name} - カバー画像`}),f.forEach(w=>{v.push({id:w.id,url:w.image_url,caption:w.caption||`${s.name} - 施設画像`})}),U(v)}const{data:se,error:xe}=await h.rpc("get_park_reviews",{park_id_param:r});xe?console.error("Error fetching reviews:",xe):C(se||[]);const{data:he,error:ue}=await h.from("reservations").select("*").eq("park_id",r).eq("reservation_type","whole_facility").eq("status","confirmed").gte("date",new Date().toISOString().split("T")[0]);if(ue)console.error("Error fetching facility rentals:",ue);else{X(he||[]);const v=new Date().toISOString().split("T")[0],w=he?.filter(M=>M.date===v)||[];V(w)}const{data:ze,error:ge}=await h.from("smart_locks").select("id, lock_id, lock_name, park_id").eq("park_id",r).eq("status","active");if(ge?console.error("Error fetching smart locks:",ge):Se(ze||[]),l){const{data:v,error:w}=await h.from("dogs").select(`
            *,
            vaccine_certifications!inner(*)
          `).eq("owner_id",l.id).eq("vaccine_certifications.status","approved");w?console.error("Error fetching dogs:",w):L(v||[]);const{data:M,error:ae}=await h.rpc("can_user_review_park",{user_id_param:l.id,park_id_param:r});ae||P(M);const{data:k,error:Ae}=await h.rpc("get_user_park_review",{user_id_param:l.id,park_id_param:r});if(!Ae&&k&&k.length>0&&(m(k[0]),_({rating:k[0].rating,review_text:k[0].review_text||"",visit_date:k[0].visit_date,dog_id:k[0].dog_id})),q.length>0){const{data:je,error:Ke}=await h.rpc("check_user_park_access",{p_user_id:l.id,p_lock_id:q[0].lock_id});!Ke&&je&&je.has_access&&De(!0)}const Be=new Date().toISOString().split("T")[0],{data:pe,error:Ge}=await h.from("reservations").select(`
            *,
            dog_park:dog_parks(*),
            dog:dogs(*)
          `).eq("park_id",r).eq("user_id",l.id).eq("status","confirmed").eq("date",Be).order("start_time",{ascending:!0}).limit(1).single();!Ge&&pe&&j(pe)}const{data:te,error:He}=await h.from("park_maintenance").select("*").eq("park_id",r).in("status",["scheduled","active"]).gte("end_date",new Date().toISOString()).order("start_date",{ascending:!0});if(!He&&te){Ce(te);const v=new Date,w=te.find(M=>{const ae=new Date(M.start_date),k=new Date(M.end_date);return ae<=v&&k>v});$e(w||null)}}catch(s){Ee(s.message||"エラーが発生しました"),i("/parks")}finally{p(!1)}},Te=async s=>{if(s.preventDefault(),!(!l||!t)){G(!0);try{if(b){const{error:c}=await h.from("dog_park_reviews").update({rating:x.rating,review_text:x.review_text,visit_date:x.visit_date,dog_id:x.dog_id,updated_at:new Date().toISOString()}).eq("id",b.id);if(c)throw c}else{const{error:c}=await h.from("dog_park_reviews").insert([{park_id:r,user_id:l.id,dog_id:x.dog_id,rating:x.rating,review_text:x.review_text,visit_date:x.visit_date}]);if(c)throw c}await ee(),A(!1),alert(b?"レビューを更新しました！":"レビューを投稿しました！")}catch(c){console.error("Error submitting review:",c),alert("レビューの投稿に失敗しました。もう一度お試しください。")}finally{G(!1)}}},Le=async()=>{if(!(!b||!confirm("レビューを削除しますか？")))try{const{error:s}=await h.from("dog_park_reviews").delete().eq("id",b.id);if(s)throw s;await ee(),m(null),_({rating:5,review_text:"",visit_date:"",dog_id:""}),alert("レビューを削除しました。")}catch(s){console.error("Error deleting review:",s),alert("レビューの削除に失敗しました。")}},Re=()=>{if(K.length===0)return[];const s={};return K.forEach(c=>{const f=c.date;s[f]||(s[f]={date:f,slots:[]});const E=parseInt(c.start_time),se=E+c.duration;s[f].slots.push({start:`${E.toString().padStart(2,"0")}:00`,end:`${se.toString().padStart(2,"0")}:00`})}),Object.values(s).sort((c,f)=>new Date(c.date).getTime()-new Date(f.date).getTime())},ce=s=>{Z(s),Y(!0)},qe=()=>{Y(!1)},Me=()=>{Z(s=>(s+1)%u.length)},Oe=()=>{Z(s=>(s-1+u.length)%u.length)},oe=()=>{alert("PINコードを生成しました！")},de=s=>{alert(`PINコードの生成に失敗しました: ${s}`)},Ue=async()=>{if(r)try{ne(!0),console.log("Updating park data...");const{data:s,error:c}=await h.from("dog_parks").select("*").eq("id",r).single();if(c){console.error("Error updating park data:",c);return}g(s),Ie(new Date),console.log("Park data updated successfully")}catch(s){console.error("Error updating park data:",s)}finally{ne(!1)}},Je=()=>{Ue()};if(a)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})});if(!t)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-600",children:"ドッグランが見つかりませんでした"}),e.jsx(y,{onClick:()=>i("/parks"),className:"mt-4",children:"ドッグラン一覧に戻る"})]});const me=Re();return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[ie&&e.jsx("div",{className:"mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:ie}),t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:t.name}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[e.jsx("span",{children:t.address}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["¥",t.price,"/日"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["最終更新: ",Pe.toLocaleTimeString("ja-JP")]}),e.jsxs("button",{onClick:Je,disabled:Q,className:`flex items-center space-x-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${Q?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-100 text-blue-700 hover:bg-blue-200"}`,children:[e.jsx(es,{className:`w-4 h-4 ${Q?"animate-spin":""}`}),e.jsx("span",{children:Q?"更新中...":"更新"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(ds,{park:t,parkImages:u,todayRentals:O,onImageClick:ce}),e.jsx(xs,{parkImages:u,onImageClick:ce}),e.jsxs(N,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:t.name}),e.jsx("div",{className:"flex items-center space-x-4 mb-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"flex items-center space-x-1",children:[1,2,3,4,5].map(s=>e.jsx(H,{className:`w-5 h-5 ${s<=Math.round(t.average_rating)?"text-yellow-400 fill-current":"text-gray-300"}`},s))}),e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:t.average_rating.toFixed(1)}),e.jsxs("span",{className:"text-sm text-gray-600",children:["(",t.review_count,"件のレビュー)"]})]})})]}),d?e.jsx(y,{className:"bg-gray-400 cursor-not-allowed",disabled:!0,title:"メンテナンス中のため予約できません",children:"予約不可"}):e.jsx(fe,{to:`/parks/${t.id}/reserve`,children:e.jsx(y,{className:"bg-blue-600 hover:bg-blue-700",children:"予約する"})})]}),e.jsx("p",{className:"text-gray-700 mb-6",children:t.description}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(ye,{className:"w-5 h-5 mr-3"}),e.jsx("span",{children:t.address})]}),e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(ss,{className:"w-5 h-5 mr-3"}),e.jsxs("span",{children:["現在の利用者: ",t.current_occupancy,"/",t.max_capacity,"人"]})]}),e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(ts,{className:"w-5 h-5 mr-3"}),e.jsxs("span",{children:["料金: ¥",t.price,"/日"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[t.large_dog_area&&e.jsxs("div",{className:"flex items-center text-blue-600",children:[e.jsx(as,{className:"w-5 h-5 mr-3"}),e.jsx("span",{children:"大型犬OK"})]}),t.small_dog_area&&e.jsxs("div",{className:"flex items-center text-pink-600",children:[e.jsx(rs,{className:"w-5 h-5 mr-3"}),e.jsx("span",{children:"小型犬OK"})]}),t.private_booths&&e.jsxs("div",{className:"flex items-center text-purple-600",children:[e.jsx(_e,{className:"w-5 h-5 mr-3"}),e.jsxs("span",{children:["プライベートブース ",t.private_booth_count,"室"]})]})]})]})]}),(d||F.length>0)&&e.jsxs(N,{className:"p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(z,{className:"w-6 h-6 text-yellow-600 mr-2"}),"メンテナンス情報"]}),d&&e.jsxs("div",{className:`mb-4 p-4 rounded-lg ${d.is_emergency?"bg-red-50 border-red-200":"bg-yellow-50 border-yellow-200"} border`,children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(z,{className:`w-5 h-5 ${d.is_emergency?"text-red-600":"text-yellow-600"}`}),e.jsx("span",{className:`text-lg font-semibold ${d.is_emergency?"text-red-800":"text-yellow-800"}`,children:d.is_emergency?"緊急メンテナンス中":"メンテナンス中"})]}),e.jsx("p",{className:`text-lg font-medium ${d.is_emergency?"text-red-700":"text-yellow-700"} mb-2`,children:d.title}),d.description&&e.jsx("p",{className:`text-sm ${d.is_emergency?"text-red-600":"text-yellow-600"} mb-3`,children:d.description}),e.jsx("div",{className:"flex items-center space-x-4 text-sm",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(W,{className:`w-4 h-4 ${d.is_emergency?"text-red-600":"text-yellow-600"}`}),e.jsxs("span",{className:`font-medium ${d.is_emergency?"text-red-700":"text-yellow-700"}`,children:[new Date(d.start_date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})," ",new Date(d.start_date).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"}),"〜",new Date(d.end_date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})," ",new Date(d.end_date).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"})]})]})}),e.jsx("p",{className:`text-sm ${d.is_emergency?"text-red-600":"text-yellow-600"} mt-3 font-medium`,children:"※メンテナンス期間中は休業となります"})]}),F.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"今後のメンテナンス予定"}),e.jsx("div",{className:"space-y-3",children:F.filter(s=>s.status==="scheduled"&&new Date(s.start_date)>new Date).slice(0,3).map((s,c)=>e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx(W,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"font-medium text-gray-900",children:s.title}),s.is_emergency&&e.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full",children:"緊急"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[new Date(s.start_date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})," ",new Date(s.start_date).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"}),"〜",new Date(s.end_date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})," ",new Date(s.end_date).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"})]}),s.description&&e.jsx("p",{className:"text-sm text-gray-500",children:s.description})]})})},c))})]})]}),q.length>0&&le&&e.jsxs(N,{className:"p-6 bg-blue-50 border-blue-200",children:[e.jsxs("div",{className:"flex items-start space-x-3 mb-4",children:[e.jsx(re,{className:"w-6 h-6 text-blue-600 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-blue-900 mb-2",children:"入口ドアの開錠"}),e.jsx("p",{className:"text-sm text-blue-800 mb-4",children:"PINコードを生成して入口のスマートロックを開錠できます。"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:q.map(s=>e.jsx(ve,{lockId:s.lock_id,label:`${s.lock_name}のPINコードを生成`,className:"w-full",onSuccess:oe,onError:de,reservationId:o?.id},s.id))})]}),O.length>0&&e.jsx(N,{className:"p-6 bg-orange-50 border-orange-200",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(z,{className:"w-6 h-6 text-orange-600 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-orange-900 mb-3",children:"本日の貸し切り時間"}),e.jsx("p",{className:"text-sm text-orange-800 mb-4",children:"以下の時間帯は施設貸し切りのため、通常利用（1日券・サブスク）での入場はできません。"}),e.jsx("div",{className:"space-y-3",children:O.map((s,c)=>{const f=parseInt(s.start_time),E=f+s.duration;return e.jsx("div",{className:"bg-white p-3 rounded-lg border border-orange-200",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(W,{className:"w-5 h-5 text-orange-600"}),e.jsxs("span",{className:"font-medium text-orange-900",children:[f,":00 〜 ",E,":00"]})]})},c)})})]})]})}),me.length>0&&e.jsx(gs,{rentalInfo:me}),e.jsx(hs,{park:t}),e.jsx(us,{park:t,reviews:S,userReview:b,canReview:R,user:l,userDogs:D,showReviewForm:I,setShowReviewForm:A,reviewFormData:x,setReviewFormData:_,isSubmitting:B,handleReviewSubmit:Te,handleDeleteReview:Le})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(N,{className:"p-4",children:e.jsx(fe,{to:`/parks/${t.id}/reserve`,children:e.jsx(y,{className:"w-full bg-blue-600 hover:bg-blue-700 text-lg py-3",children:"予約する"})})}),q.length>0&&le&&e.jsxs(N,{className:"p-4 bg-blue-50 border-blue-200",children:[e.jsxs("h3",{className:"font-semibold text-blue-900 mb-3 flex items-center",children:[e.jsx(re,{className:"w-5 h-5 text-blue-600 mr-2"}),"入口ドアを開ける"]}),e.jsx("div",{className:"space-y-3",children:q.map(s=>e.jsx(ve,{lockId:s.lock_id,label:`${s.lock_name}のPINコードを生成`,className:"w-full",onSuccess:oe,onError:de,reservationId:o?.id},s.id))})]}),e.jsxs(N,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"料金情報"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"通常利用"}),e.jsxs("span",{className:"font-medium",children:["¥",t.price,"/日"]})]}),t.private_booths&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"プライベートブース"}),e.jsx("span",{className:"font-medium text-green-600",children:"追加料金なし"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"施設貸し切り"}),e.jsx("span",{className:"font-medium",children:"¥4,400/時間"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"サブスクリプション"}),e.jsx("span",{className:"font-medium",children:"¥3,800/月"})]})]})]}),e.jsxs(N,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"現在の状況"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"利用者数"}),e.jsxs("span",{className:"font-medium",children:[t.current_occupancy,"/",t.max_capacity,"人"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-600",children:[e.jsxs("span",{children:[t.current_occupancy,"人"]}),e.jsxs("span",{children:[Math.round(t.current_occupancy/t.max_capacity*100),"%"]}),e.jsxs("span",{children:[t.max_capacity,"人"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:`h-3 rounded-full transition-all duration-300 ${J(t.current_occupancy,t.max_capacity).barColor}`,style:{width:`${t.current_occupancy/t.max_capacity*100}%`}})})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-medium flex items-center justify-center space-x-1 ${J(t.current_occupancy,t.max_capacity).color}`,children:[e.jsx("span",{children:J(t.current_occupancy,t.max_capacity).emoji}),e.jsx("span",{children:J(t.current_occupancy,t.max_capacity).text})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:J(t.current_occupancy,t.max_capacity).description})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-xs text-gray-500",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{children:"リアルタイム更新中"})]})]})]}),e.jsxs(N,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"評価"}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"text-3xl font-bold text-gray-900 mb-1",children:t.average_rating.toFixed(1)}),e.jsx("div",{className:"flex items-center justify-center space-x-1",children:[1,2,3,4,5].map(s=>e.jsx(H,{className:`w-6 h-6 ${s<=Math.round(t.average_rating)?"text-yellow-400 fill-current":"text-gray-300"}`},s))}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:[t.review_count,"件のレビュー"]})]}),t.review_count>0&&e.jsx("div",{className:"space-y-2",children:[5,4,3,2,1].map(s=>{const c=S.filter(E=>E.rating===s).length,f=t.review_count>0?c/t.review_count*100:0;return e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("span",{className:"w-3",children:s}),e.jsx(H,{className:"w-3 h-3 text-yellow-400 fill-current"}),e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-yellow-400 h-2 rounded-full",style:{width:`${f}%`}})}),e.jsx("span",{className:"w-8 text-right",children:c})]},s)})})]}),e.jsxs(N,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"アクセス"}),e.jsxs("div",{className:"text-sm text-gray-700 space-y-2",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(ye,{className:"w-4 h-4 text-gray-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:t.address})]}),e.jsx("div",{className:"mt-3",children:e.jsx(y,{variant:"secondary",size:"sm",className:"w-full",onClick:()=>{const s=encodeURIComponent(t.address);window.open(`https://maps.google.com/maps?q=${s}`,"_blank")},children:"Google Mapsで開く"})})]})]})]})]}),$&&u.length>0&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"relative w-full max-w-4xl",children:[e.jsx("button",{onClick:qe,className:"absolute top-4 right-4 text-gray-800 bg-white bg-opacity-90 shadow-lg rounded-full p-2 hover:bg-opacity-100 transition-all z-10",children:e.jsx(ls,{className:"w-6 h-6"})}),e.jsx("button",{onClick:Oe,className:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-800 bg-white bg-opacity-90 shadow-lg rounded-full p-2 hover:bg-opacity-100 transition-all z-10",children:e.jsx(ns,{className:"w-6 h-6"})}),e.jsx("button",{onClick:Me,className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-800 bg-white bg-opacity-90 shadow-lg rounded-full p-2 hover:bg-opacity-100 transition-all z-10",children:e.jsx(is,{className:"w-6 h-6"})}),e.jsx("div",{className:"flex items-center justify-center h-[80vh]",children:e.jsx("img",{src:u[T].url,alt:u[T].caption||`${t.name} - 画像 ${T+1}`,className:"max-h-full max-w-full object-contain"})}),e.jsxs("div",{className:"absolute bottom-4 left-0 right-0 text-center text-white",children:[e.jsx("p",{className:"text-sm mb-2",children:u[T].caption}),e.jsxs("p",{className:"text-xs",children:[T+1," / ",u.length]})]})]})})]})]})}const J=(r,l)=>{const i=r/l*100;return i<25?{text:"空いています",color:"text-green-600 bg-green-100",barColor:"bg-green-500",description:"快適に利用できます",emoji:"😊"}:i<50?{text:"やや空いています",color:"text-blue-600 bg-blue-100",barColor:"bg-blue-500",description:"適度な混雑です",emoji:"🙂"}:i<75?{text:"やや混んでいます",color:"text-yellow-600 bg-yellow-100",barColor:"bg-yellow-500",description:"少し混雑しています",emoji:"😐"}:{text:"混んでいます",color:"text-red-600 bg-red-100",barColor:"bg-red-500",description:"大変混雑しています",emoji:"😰"}};export{vs as DogParkDetail};

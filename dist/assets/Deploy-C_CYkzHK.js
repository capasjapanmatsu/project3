import{j as e,V as s,aD as t,A as a,f as r,ab as l,am as i,R as n,Z as c,C as d}from"./ui-vendor-CTwuE44L.js";import{u as o,r as m,L as x}from"./react-vendor-BBLDtDmh.js";import{s as u,f as y,a as h,C as p,B as f}from"./index-BbveZyU8.js";import{g as j}from"./deploymentStatus-Cv1hyokG.js";import"./query-vendor-9fkSW1iq.js";import"./supabase-vendor-BcfcqyaE.js";async function N(e={}){try{const{data:{session:s}}=await u.auth.getSession();if(!s?.access_token)throw new Error("認証が必要です");const t=await fetch("https://onmcivwxtzqajcovptgf.supabase.co/functions/v1/deploy-to-netlify",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.access_token}`},body:JSON.stringify({buildCommand:e.buildCommand||"npm run build",outputDir:e.outputDir||"dist",siteId:e.siteId,deployId:e.deployId,netlifyApiKey:"your_netlify_api_key"})});if(!t.ok){const e=await t.json();throw new Error(e.error||"デプロイに失敗しました")}return await t.json()}catch(s){throw s}}async function g(e,s){try{return await N({siteId:e,deployId:s})}catch(t){throw t}}function b(){const u=o(),[b,w]=m.useState(!1),[v,_]=m.useState(!1),[S,k]=m.useState(null),[L,C]=m.useState(null),[I,O]=m.useState(null),[D,J]=m.useState(!1);m.useEffect(()=>{const e=y("lastDeployment");if(e)try{const s=JSON.parse(e);k(s),s.site_id&&s.deploy_id&&U(s.site_id,s.deploy_id)}catch(s){!function(e){try{"undefined"!=typeof window&&window.localStorage&&window.localStorage.removeItem(e)}catch(s){}}("lastDeployment")}},[]);const R=async()=>{try{w(!0),C(null),O(null);const e=await N();k(e),O("デプロイが開始されました！ステータスを確認してください。"),h("lastDeployment",JSON.stringify(e)),q(e);const s=setInterval(async()=>{try{const t=await g(e.site_id,e.deploy_id);k(t),["ready","error","failed"].includes(t.status)&&(clearInterval(s),"ready"===t.status?O("デプロイが完了しました！以下のURLでサイトを確認できます。"):C("デプロイに失敗しました。詳細はNetlifyダッシュボードで確認してください。")),h("lastDeployment",JSON.stringify(t)),H(t)}catch(t){}},5e3);return()=>clearInterval(s)}catch(e){C(e.message||"デプロイに失敗しました")}finally{w(!1)}},U=async(e,s)=>{try{_(!0),C(null);const t=await g(e,s);k(t),h("lastDeployment",JSON.stringify(t)),H(t),"ready"===t.status?O("デプロイが完了しています！以下のURLでサイトを確認できます。"):["error","failed"].includes(t.status)?C("デプロイに失敗しました。詳細はNetlifyダッシュボードで確認してください。"):O("デプロイは進行中です。ステータスを確認してください。")}catch(t){C(t.message||"デプロイステータスの確認に失敗しました")}finally{_(!1)}},q=e=>{try{const s=y("deploymentHistory");let t=s?JSON.parse(s):[];t.unshift({...e,created_at:(new Date).toISOString()}),t.length>10&&(t=t.slice(0,10)),h("deploymentHistory",JSON.stringify(t))}catch(s){}},H=e=>{try{const s=y("deploymentHistory");if(!s)return;let t=JSON.parse(s);t=t.map(s=>s.deploy_id===e.deploy_id?{...s,status:e.status,deploy_url:e.deploy_url}:s),h("deploymentHistory",JSON.stringify(t))}catch(s){}};return e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center space-x-4 mb-6",children:e.jsxs(x,{to:"/dashboard",className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[e.jsx(s,{className:"w-4 h-4 mr-2"}),"ダッシュボードに戻る"]})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-4 flex items-center justify-center",children:[e.jsx(t,{className:"w-8 h-8 text-blue-600 mr-3"}),"サイトをデプロイ"]}),e.jsx("p",{className:"text-lg text-gray-600",children:"あなたのアプリケーションをNetlifyにデプロイします"})]}),L&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 rounded-lg flex items-start",children:[e.jsx(a,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsx("p",{className:"text-red-800",children:L})]}),I&&e.jsxs("div",{className:"mb-6 p-4 bg-green-50 rounded-lg flex items-start",children:[e.jsx(r,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsx("p",{className:"text-green-800",children:I})]}),e.jsxs(p,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-6",children:"デプロイ設定"}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(t,{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"Netlifyデプロイについて"}),e.jsx("p",{children:"このツールを使用すると、現在のプロジェクトをNetlifyに自動的にデプロイできます。デプロイが完了すると、公開URLが提供されます。"})]})]})}),S?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"最新のデプロイ情報"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"ステータス:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${(e=>{switch(e){case"ready":return"text-green-600 bg-green-100";case"error":case"failed":return"text-red-600 bg-red-100";case"building":case"enqueued":case"processing":return"text-blue-600 bg-blue-100";default:return"text-gray-600 bg-gray-100"}})(S.status)}`,children:(e=>{switch(e){case"ready":return"完了";case"error":case"failed":return"失敗";case"building":return"ビルド中";case"enqueued":return"待機中";case"processing":return"処理中";default:return e}})(S.status)})]}),S.deploy_url&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"公開URL:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("a",{href:S.deploy_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-800 flex items-center",children:[S.deploy_url.replace(/^https?:\/\//,""),e.jsx(l,{className:"w-3 h-3 ml-1"})]}),e.jsx("button",{onClick:()=>{return e=S.deploy_url,void navigator.clipboard.writeText(e).then(()=>{J(!0),setTimeout(()=>J(!1),2e3)});var e},className:"text-gray-500 hover:text-gray-700",title:"URLをコピー",children:e.jsx(i,{className:"w-4 h-4"})})]})]}),S.claim_url&&!S.claimed&&e.jsx("div",{className:"mt-2",children:e.jsxs("a",{href:S.claim_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-800 flex items-center",children:["Netlifyでサイトを管理する",e.jsx(l,{className:"w-3 h-3 ml-1"})]})})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(f,{onClick:()=>{S?.site_id&&S?.deploy_id&&U(S.site_id,S.deploy_id)},variant:"secondary",isLoading:v,children:[e.jsx(n,{className:"w-4 h-4 mr-2"}),"ステータスを更新"]}),e.jsxs(f,{onClick:R,isLoading:b,disabled:["building","enqueued","processing"].includes(S.status),children:[e.jsx(t,{className:"w-4 h-4 mr-2"}),"再デプロイ"]}),e.jsxs(f,{onClick:()=>u("/deployment-history"),variant:"secondary",children:[e.jsx(c,{className:"w-4 h-4 mr-2"}),"デプロイ履歴"]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(f,{onClick:R,isLoading:b,className:"w-full",children:[e.jsx(t,{className:"w-4 h-4 mr-2"}),"Netlifyにデプロイ"]}),e.jsxs(f,{onClick:async()=>{try{_(!0),C(null);"ready"===(await j({})).status&&O("デプロイが完了しています！以下のURLでサイトを確認できます。")}catch(e){C(e.message||"デプロイステータスの確認に失敗しました")}finally{_(!1)}},variant:"secondary",isLoading:v,className:"w-full",children:[e.jsx(d,{className:"w-4 h-4 mr-2"}),"デプロイステータスを確認"]})]}),D&&e.jsx("div",{className:"text-center text-sm text-green-600",children:"URLをコピーしました！"})]})]}),e.jsxs(p,{className:"p-6 bg-gray-50",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"デプロイについての注意事項"}),e.jsxs("div",{className:"text-sm text-gray-700 space-y-2",children:[e.jsx("p",{children:"• デプロイには数分かかる場合があります"}),e.jsx("p",{children:"• デプロイが完了すると、公開URLが提供されます"}),e.jsx("p",{children:"• Netlifyアカウントをお持ちの場合は、サイトを自分のアカウントに移行できます"}),e.jsx("p",{children:"• 環境変数は自動的に設定されます"}),e.jsx("p",{children:"• 問題が発生した場合は、Netlifyダッシュボードで詳細を確認してください"})]})]})]})}export{b as Deploy};

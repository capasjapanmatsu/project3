var e=Object.defineProperty,s=Object.defineProperties,r=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,c=(s,r,a)=>r in s?e(s,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[r]=a,i=(e,s)=>{for(var r in s||(s={}))l.call(s,r)&&c(e,r,s[r]);if(a)for(var r of a(s))t.call(s,r)&&c(e,r,s[r]);return e},n=(e,a)=>s(e,r(a));import{u as d,j as x,C as m,B as o,s as h}from"./index.CQlxbczY.js";import{r as p}from"./vendor.CKEClKZl.js";import{I as j}from"./Input.DMWrIIWM.js";import{u}from"./router.B_7Atevv.js";import{g,z as b,G as N,A as f,a as v,q as y}from"./ui.C72fRZ1L.js";import"./supabase.X3H3st79.js";function w(){const{user:e}=d(),s=u(),[r,a]=p.useState(!1),[l,t]=p.useState(""),[c,w]=p.useState(!1),[S,k]=p.useState({cardNumber:"",cardHolder:"",expiryMonth:"",expiryYear:"",cvv:"",isDefault:!0});return c?x.jsx("div",{className:"max-w-md mx-auto",children:x.jsxs(m,{className:"text-center p-8",children:[x.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:x.jsx(g,{className:"w-8 h-8 text-green-600"})}),x.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"クレジットカードを登録しました"}),x.jsx("p",{className:"text-gray-600 mb-4",children:"入場QRページに戻ります..."}),x.jsx(o,{onClick:()=>s("/entrance-qr"),children:"入場QRページへ"})]})}):x.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[x.jsx("div",{className:"flex items-center space-x-4 mb-6",children:x.jsxs("button",{onClick:()=>s("/entrance-qr"),className:"flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[x.jsx(b,{className:"w-4 h-4 mr-2"}),"入場QRに戻る"]})}),x.jsxs("div",{className:"text-center mb-8",children:[x.jsxs("h1",{className:"text-2xl font-bold text-gray-900 mb-4 flex items-center justify-center",children:[x.jsx(N,{className:"w-8 h-8 text-blue-600 mr-3"}),"クレジットカード登録"]}),x.jsx("p",{className:"text-gray-600",children:"ドッグラン入場QRの発行にはクレジットカードの登録が必要です"})]}),x.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[x.jsx("div",{className:"lg:col-span-2",children:x.jsx(m,{className:"p-6",children:x.jsxs("form",{onSubmit:r=>{return l=this,c=null,i=function*(){if(r.preventDefault(),t(""),(()=>{if(16!==S.cardNumber.replace(/\s/g,"").length)return t("カード番号は16桁で入力してください。"),!1;if(!S.cardHolder.trim())return t("カード名義人を入力してください。"),!1;if(!S.expiryMonth||!S.expiryYear)return t("有効期限を選択してください。"),!1;if(S.cvv.length<3)return t("CVVを正しく入力してください。"),!1;const e=new Date,s=e.getFullYear()%100,r=e.getMonth()+1,a=parseInt(S.expiryYear),l=parseInt(S.expiryMonth);return!(a<s||a===s&&l<r)||(t("有効期限が過去の日付です。"),!1)})()){a(!0);try{const r=S.cardNumber.replace(/\s/g,""),a="**** **** **** "+r.slice(-4),l=(e=>{const s=e.replace(/\s/g,"");return s.startsWith("4")?"visa":s.startsWith("5")||s.startsWith("2")?"mastercard":s.startsWith("3")?"amex":s.startsWith("35")?"jcb":"visa"})(r),{error:t}=yield h.from("payment_cards").insert([{user_id:null==e?void 0:e.id,card_number_masked:a,card_holder_name:S.cardHolder,expiry_month:parseInt(S.expiryMonth),expiry_year:parseInt(S.expiryYear),card_brand:l,is_default:S.isDefault}]);if(t)throw t;w(!0),setTimeout(()=>{s("/entrance-qr")},3e3)}catch(l){t(l.message||"決済方法の設定に失敗しました")}finally{a(!1)}}},new Promise((e,s)=>{var a=e=>{try{n(i.next(e))}catch(r){s(r)}},t=e=>{try{n(i.throw(e))}catch(r){s(r)}},n=s=>s.done?e(s.value):Promise.resolve(s.value).then(a,t);n((i=i.apply(l,c)).next())});var l,c,i},children:[l&&x.jsxs("div",{className:"mb-4 p-3 bg-red-100 border border-red-300 rounded-lg",children:[x.jsxs("div",{className:"flex items-center space-x-2",children:[x.jsx(f,{className:"w-5 h-5 text-red-600"}),x.jsx("span",{className:"text-red-800 font-medium",children:"エラー"})]}),x.jsx("p",{className:"text-red-700 mt-1",children:l})]}),x.jsxs("div",{className:"space-y-4",children:[x.jsx(j,{label:"カード番号 *",value:S.cardNumber,onChange:e=>{const s=e.target.value.replace(/\D/g,"").replace(/(.{4})/g,"$1 ").trim().slice(0,19);k(n(i({},S),{cardNumber:s}))},placeholder:"1234 5678 9012 3456",maxLength:19,required:!0}),x.jsx(j,{label:"カード名義人 *",value:S.cardHolder,onChange:e=>k(n(i({},S),{cardHolder:e.target.value.toUpperCase()})),placeholder:"TARO YAMADA",required:!0}),x.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"有効期限（月） *"}),x.jsxs("select",{value:S.expiryMonth,onChange:e=>k(n(i({},S),{expiryMonth:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[x.jsx("option",{value:"",children:"月"}),Array.from({length:12},(e,s)=>x.jsx("option",{value:String(s+1).padStart(2,"0"),children:String(s+1).padStart(2,"0")},s+1))]})]}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"有効期限（年） *"}),x.jsxs("select",{value:S.expiryYear,onChange:e=>k(n(i({},S),{expiryYear:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[x.jsx("option",{value:"",children:"年"}),Array.from({length:10},(e,s)=>{const r=(new Date).getFullYear()+s;return x.jsx("option",{value:String(r).slice(-2),children:r},r)})]})]}),x.jsx(j,{label:"CVV *",value:S.cvv,onChange:e=>k(n(i({},S),{cvv:e.target.value.replace(/\D/g,"")})),placeholder:"123",maxLength:4,required:!0})]}),x.jsxs("div",{className:"flex items-center space-x-2",children:[x.jsx("input",{type:"checkbox",id:"isDefault",checked:S.isDefault,onChange:e=>k(n(i({},S),{isDefault:e.target.checked})),className:"rounded text-blue-600"}),x.jsx("label",{htmlFor:"isDefault",className:"text-sm text-gray-700",children:"デフォルトの支払い方法として設定"})]}),x.jsx("div",{className:"bg-yellow-50 p-4 rounded-lg",children:x.jsxs("div",{className:"flex items-start space-x-2",children:[x.jsx(f,{className:"w-5 h-5 text-yellow-600 mt-0.5 flex-shrink-0"}),x.jsxs("div",{className:"text-sm text-yellow-800",children:[x.jsx("p",{className:"font-medium mb-1",children:"重要な注意事項"}),x.jsxs("ul",{className:"space-y-1 text-xs",children:[x.jsx("li",{children:"• カード情報は暗号化して安全に保存されます"}),x.jsx("li",{children:"• 実際のカード番号は保存されません"}),x.jsx("li",{children:"• 入場QR発行時に自動で課金されます"}),x.jsx("li",{children:"• 不正利用防止のため、本人確認が必要な場合があります"})]})]})]})}),x.jsxs(o,{type:"submit",isLoading:r,className:"w-full bg-blue-600 hover:bg-blue-700 text-lg py-3",children:[x.jsx(N,{className:"w-5 h-5 mr-2"}),"クレジットカードを登録"]})]})]})})}),x.jsxs("div",{className:"space-y-6",children:[x.jsxs(m,{className:"p-4 bg-green-50 border-green-200",children:[x.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[x.jsx(v,{className:"w-5 h-5 text-green-600"}),x.jsx("h3",{className:"font-semibold text-green-900",children:"セキュリティ"})]}),x.jsxs("div",{className:"text-sm text-green-800 space-y-2",children:[x.jsxs("div",{className:"flex items-start space-x-2",children:[x.jsx(g,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),x.jsx("span",{children:"SSL暗号化通信"})]}),x.jsxs("div",{className:"flex items-start space-x-2",children:[x.jsx(g,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),x.jsx("span",{children:"PCI DSS準拠"})]}),x.jsxs("div",{className:"flex items-start space-x-2",children:[x.jsx(g,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),x.jsx("span",{children:"カード番号は保存されません"})]}),x.jsxs("div",{className:"flex items-start space-x-2",children:[x.jsx(g,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),x.jsx("span",{children:"不正利用監視システム"})]})]})]}),x.jsxs(m,{className:"p-4",children:[x.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"対応カードブランド"}),x.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[x.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-gray-50 rounded",children:[x.jsx(N,{className:"w-5 h-5 text-blue-600"}),x.jsx("span",{className:"text-sm font-medium",children:"VISA"})]}),x.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-gray-50 rounded",children:[x.jsx(N,{className:"w-5 h-5 text-red-600"}),x.jsx("span",{className:"text-sm font-medium",children:"Mastercard"})]}),x.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-gray-50 rounded",children:[x.jsx(N,{className:"w-5 h-5 text-green-600"}),x.jsx("span",{className:"text-sm font-medium",children:"JCB"})]}),x.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-gray-50 rounded",children:[x.jsx(N,{className:"w-5 h-5 text-blue-800"}),x.jsx("span",{className:"text-sm font-medium",children:"AMEX"})]})]})]}),x.jsxs(m,{className:"p-4 bg-blue-50 border-blue-200",children:[x.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[x.jsx(y,{className:"w-5 h-5 text-blue-600"}),x.jsx("h3",{className:"font-semibold text-blue-900",children:"課金について"})]}),x.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[x.jsx("p",{children:"• 入場QR発行時に自動課金"}),x.jsx("p",{children:"• 単発利用: ¥800/日"}),x.jsx("p",{children:"• サブスク会員は追加料金なし"}),x.jsx("p",{children:"• 利用明細はメールで送信"}),x.jsx("p",{children:"• 返金は利用前のみ可能"})]})]}),x.jsxs(m,{className:"p-4",children:[x.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"サポート"}),x.jsxs("div",{className:"text-sm text-gray-700 space-y-2",children:[x.jsx("p",{children:"カード登録でお困りの場合は、カスタマーサポートまでお問い合わせください。"}),x.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded",children:[x.jsx("p",{className:"font-medium",children:"カスタマーサポート"}),x.jsx("p",{children:"📞 0120-XXX-XXX"}),x.jsx("p",{children:"📧 info@dogparkjp.com"}),x.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"平日 9:00-18:00"})]})]})]})]})]})]})}export{w as PaymentSetup};

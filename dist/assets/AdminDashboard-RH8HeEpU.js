import{u as e,s,j as t,C as a,B as i,d as r}from"./index-BFgW40ku.js";import{r as n,u as l,L as c}from"./vendor-BHVjIt_u.js";import{I as d}from"./Input-BoeHj-kf.js";import{S as m}from"./Select-_iZBaDNw.js";import{B as x,l as o,A as h,t as j,D as u,X as p,T as g,i as f,F as N,ar as v,E as b,p as y,as as w,O as _,H as k,c as S,f as P,at as C,au as I,U as q,d as $,m as R,a4 as D,av as z,n as M,V as T,G as V,aq as E}from"./ui-Qz4g1iz4.js";import"./supabase-CKbzEL5D.js";function F(){const{user:r}=e(),[l,c]=n.useState([]),[v,b]=n.useState({title:"",content:"",category:"news",is_important:!1,image_url:"",link_url:""}),[y,w]=n.useState(null),[_,k]=n.useState(!1),[S,P]=n.useState(!1),[C,I]=n.useState(""),[q,$]=n.useState("");n.useEffect((()=>{D(),R()}),[]);const R=async()=>{if(r)try{const{data:e,error:t}=await s.from("profiles").select("*").eq("id",r.id).single();if(t&&"PGRST116"===t.code){const{data:e,error:t}=await s.from("profiles").insert([{id:r.id,user_type:"admin",name:r.email||"Admin User",email:r.email}]).select().single();t?I("管理者プロファイルの作成に失敗しました。"):($("管理者プロファイルを作成しました。"),setTimeout((()=>$("")),3e3))}else if(t)I("ユーザープロファイルの取得に失敗しました。");else if(!e||"admin"!==e.user_type){const{error:e}=await s.from("profiles").update({user_type:"admin"}).eq("id",r.id);e?I("管理者権限の設定に失敗しました。"):($("管理者権限を設定しました。ページを手動でリロードしてください。"),setTimeout((()=>$("")),5e3))}}catch(e){I("ユーザープロファイルの確認に失敗しました。")}},D=async()=>{try{const{data:e,error:t}=await s.from("news_announcements").select("*").order("created_at",{ascending:!1});if(t)throw t;c(e||[]),I("")}catch(e){I("新着情報の取得に失敗しました。")}},z=e=>({news:"お知らせ",announcement:"重要なお知らせ",sale:"セール情報"}[e]||e),M=e=>{switch(e){case"news":return t.jsx(N,{className:"w-4 h-4"});case"announcement":return t.jsx(f,{className:"w-4 h-4"});case"sale":return t.jsx(g,{className:"w-4 h-4"});default:return t.jsx(x,{className:"w-4 h-4"})}};return t.jsxs(t.Fragment,{children:[t.jsxs(a,{className:"p-6",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsxs("h2",{className:"text-lg font-semibold flex items-center",children:[t.jsx(x,{className:"w-5 h-5 text-blue-600 mr-2"}),"新着情報管理"]}),t.jsxs(i,{onClick:()=>{w(null),b({title:"",content:"",category:"news",is_important:!1,image_url:"",link_url:""}),k(!0)},children:[t.jsx(o,{className:"w-4 h-4 mr-2"}),"新着情報を追加"]})]}),C&&t.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-start",children:[t.jsx(h,{className:"w-5 h-5 text-red-600 mt-0.5 mr-2 flex-shrink-0"}),t.jsx("p",{className:"text-red-800",children:C})]}),q&&t.jsxs("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-lg flex items-start",children:[t.jsx(j,{className:"w-5 h-5 text-green-600 mt-0.5 mr-2 flex-shrink-0"}),t.jsx("p",{className:"text-green-800",children:q})]}),t.jsx("div",{className:"space-y-4",children:0===l.length?t.jsx("div",{className:"text-center py-8 text-gray-500",children:"新着情報がありません"}):l.map((e=>{return t.jsx("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium flex items-center space-x-1 ${a=e.category,{news:"bg-blue-100 text-blue-800",announcement:"bg-red-100 text-red-800",sale:"bg-green-100 text-green-800"}[a]||"bg-gray-100 text-gray-800"}`,children:[M(e.category),t.jsx("span",{children:z(e.category)})]}),e.is_important&&t.jsx("span",{className:"bg-red-100 text-red-800 px-2 py-1 rounded-full text-xs font-medium",children:"重要"})]}),t.jsx("h3",{className:"font-bold text-lg mb-2",children:e.title}),t.jsx("p",{className:"text-sm text-gray-700 mb-2 line-clamp-2",children:e.content}),t.jsxs("div",{className:"text-xs text-gray-500",children:["作成日: ",new Date(e.created_at).toLocaleString("ja-JP"),e.updated_at!==e.created_at&&t.jsxs("span",{children:[" / 更新日: ",new Date(e.updated_at).toLocaleString("ja-JP")]})]})]}),t.jsxs("div",{className:"flex space-x-2 ml-4",children:[t.jsxs(i,{variant:"secondary",size:"sm",onClick:()=>(e=>{w(e),b({title:e.title,content:e.content,category:e.category,is_important:e.is_important||!1,image_url:"",link_url:""}),k(!0)})(e),disabled:S,children:[t.jsx(u,{className:"w-4 h-4 mr-1"}),"編集"]}),t.jsxs(i,{variant:"danger",size:"sm",onClick:()=>(async e=>{if(confirm("この新着情報を削除してもよろしいですか？"))try{P(!0),I("");const{error:t}=await s.from("news_announcements").delete().eq("id",e);if(t)throw t;$("新着情報を削除しました。"),await D(),setTimeout((()=>{$("")}),3e3)}catch(t){I("新着情報の削除に失敗しました。")}finally{P(!1)}})(e.id),disabled:S,children:[t.jsx(p,{className:"w-4 h-4 mr-1"}),"削除"]})]})]})},e.id);var a}))})]}),_&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:t.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsx("h2",{className:"text-xl font-bold",children:y?"新着情報を編集":"新着情報を追加"}),t.jsx("button",{onClick:()=>k(!1),className:"text-gray-500 hover:text-gray-700",disabled:S,children:t.jsx(p,{className:"w-6 h-6"})})]}),t.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),v.title.trim())if(v.content.trim())if(r)try{P(!0),I(""),$("");const{data:e,error:t}=await s.from("profiles").select("*").eq("id",r.id).single(),a={title:v.title,content:v.content,category:v.category,is_important:v.is_important,created_by:r?.id};if(y){const{error:e}=await s.from("news_announcements").update({title:v.title,content:v.content,category:v.category,is_important:v.is_important,updated_at:(new Date).toISOString()}).eq("id",y.id);if(e)throw e;$("新着情報を更新しました。")}else{const{data:e,error:t}=await s.from("news_announcements").insert([a]).select();if(t)throw t;$("新着情報を追加しました。")}b({title:"",content:"",category:"news",is_important:!1,image_url:"",link_url:""}),w(null),k(!1),await D(),setTimeout((()=>{$("")}),3e3)}catch(t){let e="新着情報の保存に失敗しました。";t&&"object"==typeof t&&("message"in t&&"string"==typeof t.message&&(e+=` エラー詳細: ${t.message}`),"details"in t&&"string"==typeof t.details&&(e+=` 詳細: ${t.details}`),"hint"in t&&"string"==typeof t.hint&&(e+=` ヒント: ${t.hint}`),"code"in t&&(e+=` コード: ${t.code}`)),I(e)}finally{P(!1)}else I("ユーザーが認証されていません。ログインしてください。");else I("内容を入力してください。");else I("タイトルを入力してください。")},children:[t.jsxs("div",{className:"space-y-4",children:[t.jsx(d,{label:"タイトル *",value:v.title,onChange:e=>b({...v,title:e.target.value}),required:!0,disabled:S}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"内容 *"}),t.jsx("textarea",{value:v.content,onChange:e=>b({...v,content:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:6,required:!0,disabled:S})]}),t.jsx(m,{label:"カテゴリー *",options:[{value:"news",label:"お知らせ"},{value:"announcement",label:"重要なお知らせ"},{value:"sale",label:"セール情報"}],value:v.category,onChange:e=>b({...v,category:e.target.value}),required:!0,disabled:S}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("input",{type:"checkbox",id:"is_important",checked:v.is_important,onChange:e=>b({...v,is_important:e.target.checked}),className:"rounded text-blue-600",disabled:S}),t.jsx("label",{htmlFor:"is_important",className:"text-sm text-gray-700",children:"重要なお知らせとして表示する"})]})]}),t.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[t.jsx(i,{type:"button",variant:"secondary",onClick:()=>k(!1),disabled:S,children:"キャンセル"}),t.jsx(i,{type:"submit",isLoading:S,children:y?"更新する":"追加する"})]})]})]})})})]})}const L=({onError:e,onSuccess:l})=>{const{clientIP:c}=r(),[m,x]=n.useState([]),[h,j]=n.useState(!0),[u,p]=n.useState(!1),[g,f]=n.useState(null),[N,P]=n.useState({ip_address:"",description:"",is_active:!0});n.useEffect((()=>{C()}),[]);const C=async()=>{try{j(!0);const{data:t,error:a}=await s.from("ip_whitelist").select("*").order("created_at",{ascending:!1});if(a)return void e(`IPホワイトリストの取得に失敗しました: ${a.message}`);x(t||[])}catch(t){e("IPホワイトリストの取得中にエラーが発生しました")}finally{j(!1)}};return t.jsxs("div",{className:"space-y-6",children:[t.jsx(a,{className:"p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(v,{className:"w-5 h-5 text-blue-500"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold",children:"現在のIPアドレス"}),t.jsx("p",{className:"text-sm text-gray-600",children:c||"取得中..."})]})]}),t.jsxs(i,{variant:"secondary",size:"sm",onClick:()=>{c&&(P({ip_address:`${c}/32`,description:"現在のIPアドレス",is_active:!0}),p(!0))},disabled:!c,children:[t.jsx(o,{className:"w-4 h-4 mr-1"}),"ホワイトリストに追加"]})]})}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("h2",{className:"text-xl font-semibold",children:"IPホワイトリスト管理"}),t.jsxs(i,{onClick:()=>p(!0),className:"flex items-center space-x-2",children:[t.jsx(o,{className:"w-4 h-4"}),t.jsx("span",{children:"新規作成"})]})]}),u&&t.jsxs(a,{className:"p-6",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:g?"IPホワイトリスト編集":"IPホワイトリスト作成"}),t.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),N.ip_address&&N.description)try{const t={ip_address:N.ip_address,description:N.description,is_active:N.is_active};if(g){const{error:a}=await s.from("ip_whitelist").update(t).eq("id",g.id);if(a)return void e(`IPホワイトリストの更新に失敗しました: ${a.message}`);l("IPホワイトリストを更新しました")}else{const{error:a}=await s.from("ip_whitelist").insert([t]);if(a)return void e(`IPホワイトリストの作成に失敗しました: ${a.message}`);l("IPホワイトリストを作成しました")}P({ip_address:"",description:"",is_active:!0}),p(!1),f(null),await C()}catch(a){e("IPホワイトリストの保存中にエラーが発生しました")}else e("IPアドレスと説明は必須です")},className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium mb-1",children:["IPアドレス/CIDR ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx(d,{type:"text",value:N.ip_address,onChange:e=>P({...N,ip_address:e.target.value}),placeholder:"例: 192.168.1.0/24 または 192.168.1.100/32",label:"IPアドレス/CIDR",required:!0}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"CIDR形式で入力してください。単一IPの場合は /32 を付けてください。"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium mb-1",children:["説明 ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx(d,{type:"text",value:N.description,onChange:e=>P({...N,description:e.target.value}),placeholder:"例: 本社オフィス",label:"説明",required:!0})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("input",{type:"checkbox",id:"is_active",checked:N.is_active,onChange:e=>P({...N,is_active:e.target.checked}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),t.jsx("label",{htmlFor:"is_active",className:"text-sm font-medium",children:"有効"})]}),t.jsxs("div",{className:"flex justify-end space-x-2",children:[t.jsx(i,{type:"button",variant:"secondary",onClick:()=>{p(!1),f(null),P({ip_address:"",description:"",is_active:!0})},children:"キャンセル"}),t.jsx(i,{type:"submit",children:g?"更新":"作成"})]})]})]}),t.jsxs(a,{className:"p-6",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"IPホワイトリスト一覧"}),h?t.jsx("div",{className:"flex justify-center py-8",children:t.jsx("div",{className:"text-gray-600",children:"読み込み中..."})}):0===m.length?t.jsx("div",{className:"text-center py-8 text-gray-500",children:"IPホワイトリストエントリがありません"}):t.jsx("div",{className:"space-y-4",children:m.map((a=>{return t.jsx("div",{className:"border rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[(n=a.ip_address,n.includes("127.0.0.1")||n.includes("::1")?t.jsx(k,{className:"w-4 h-4 text-blue-500"}):n.includes("192.168.")||n.includes("10.")||n.includes("172.")?t.jsx(S,{className:"w-4 h-4 text-green-500"}):t.jsx(v,{className:"w-4 h-4 text-orange-500"})),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("h4",{className:"font-medium",children:a.ip_address}),a.is_active&&t.jsx("span",{className:"bg-green-100 text-green-800 text-xs px-2 py-1 rounded",children:"有効"}),!a.is_active&&t.jsx("span",{className:"bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded",children:"無効"})]}),t.jsx("p",{className:"text-sm text-gray-600",children:a.description}),t.jsxs("p",{className:"text-xs text-gray-500",children:["作成: ",(r=a.created_at,new Date(r).toLocaleString("ja-JP",{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"}))]})]})]})}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(i,{variant:a.is_active?"warning":"success",size:"sm",onClick:()=>(async t=>{try{const{error:a}=await s.from("ip_whitelist").update({is_active:!t.is_active}).eq("id",t.id);if(a)return void e(`IPホワイトリストの状態変更に失敗しました: ${a.message}`);l(`IPホワイトリストを${t.is_active?"無効":"有効"}にしました`),await C()}catch(a){e("IPホワイトリストの状態変更中にエラーが発生しました")}})(a),children:a.is_active?t.jsxs(t.Fragment,{children:[t.jsx(b,{className:"w-4 h-4 mr-1"}),"無効化"]}):t.jsxs(t.Fragment,{children:[t.jsx(y,{className:"w-4 h-4 mr-1"}),"有効化"]})}),t.jsx(i,{variant:"secondary",size:"sm",onClick:()=>(e=>{f(e),P({ip_address:e.ip_address,description:e.description,is_active:e.is_active}),p(!0)})(a),children:t.jsx(w,{className:"w-4 h-4"})}),t.jsx(i,{variant:"danger",size:"sm",onClick:()=>(async t=>{if(confirm("このIPホワイトリストエントリを削除しますか？"))try{const{error:a}=await s.from("ip_whitelist").delete().eq("id",t);if(a)return void e(`IPホワイトリストの削除に失敗しました: ${a.message}`);l("IPホワイトリストを削除しました"),await C()}catch(a){e("IPホワイトリストの削除中にエラーが発生しました")}})(a.id),children:t.jsx(_,{className:"w-4 h-4"})})]})]})},a.id);var r,n}))})]})]})},U=e=>{if(!e)return null;return new Date(e).toISOString()},A=e=>{if(!e)return"";const s=new Date(e);return new Date(s.getTime()-6e4*s.getTimezoneOffset()).toISOString().slice(0,16)},J=({onError:e,onSuccess:l})=>{const{refreshMaintenanceStatus:c,isMaintenanceActive:m,maintenanceInfo:x}=r(),[h,u]=n.useState([]),[p,g]=n.useState(!0),[f,N]=n.useState(!1),[v,b]=n.useState(null),[y,k]=n.useState("schedules"),[q,$]=n.useState({title:"",message:"",start_time:"",end_time:"",is_emergency:!1});n.useEffect((()=>{R()}),[]);const R=async()=>{try{g(!0);const{data:t,error:a}=await s.from("maintenance_schedules").select("*").order("created_at",{ascending:!1});if(a)return void e(`メンテナンス予定の取得に失敗しました: ${a.message}`);u(t||[])}catch(t){e("メンテナンス予定の取得中にエラーが発生しました")}finally{g(!1)}},D=e=>e?new Date(e).toLocaleString("ja-JP",{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit",timeZone:"Asia/Tokyo"}):"未設定";return t.jsxs("div",{className:"space-y-6",children:[t.jsx(a,{className:"p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-4 h-4 rounded-full "+(m?"bg-red-500":"bg-green-500")}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold",children:m?"メンテナンス中":"サービス稼働中"}),m&&x&&t.jsx("p",{className:"text-sm text-gray-600",children:x.title})]})]}),t.jsx("div",{className:"flex items-center space-x-2",children:m?t.jsx(j,{className:"w-5 h-5 text-red-500"}):t.jsx(j,{className:"w-5 h-5 text-green-500"})})]})}),t.jsxs("div",{className:"flex space-x-4 border-b",children:[t.jsxs("button",{className:"px-4 py-2 font-medium "+("schedules"===y?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>k("schedules"),children:[t.jsx(P,{className:"w-4 h-4 inline mr-2"}),"メンテナンス予定"]}),t.jsxs("button",{className:"px-4 py-2 font-medium "+("whitelist"===y?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>k("whitelist"),children:[t.jsx(S,{className:"w-4 h-4 inline mr-2"}),"IPホワイトリスト"]})]}),"schedules"===y?t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("h2",{className:"text-xl font-semibold",children:"メンテナンス予定管理"}),t.jsxs(i,{onClick:()=>N(!0),className:"flex items-center space-x-2",children:[t.jsx(o,{className:"w-4 h-4"}),t.jsx("span",{children:"新規作成"})]})]}),f&&t.jsxs(a,{className:"p-6",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:v?"メンテナンス予定編集":"メンテナンス予定作成"}),t.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),q.title&&q.message)try{const t={title:q.title,message:q.message,start_time:U(q.start_time),end_time:U(q.end_time),is_emergency:q.is_emergency};if(v){const{error:a}=await s.from("maintenance_schedules").update(t).eq("id",v.id);if(a)return void e(`メンテナンス予定の更新に失敗しました: ${a.message}`);l("メンテナンス予定を更新しました")}else{const{error:a}=await s.from("maintenance_schedules").insert([t]);if(a)return void e(`メンテナンス予定の作成に失敗しました: ${a.message}`);l("メンテナンス予定を作成しました")}$({title:"",message:"",start_time:"",end_time:"",is_emergency:!1}),N(!1),b(null),await R()}catch(a){e("メンテナンス予定の保存中にエラーが発生しました")}else e("タイトルとメッセージは必須です")},className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium mb-1",children:["タイトル ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx(d,{type:"text",value:q.title,onChange:e=>$({...q,title:e.target.value}),placeholder:"例: システムメンテナンス",label:"タイトル",required:!0})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium mb-1",children:["メッセージ ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("textarea",{value:q.message,onChange:e=>$({...q,message:e.target.value}),placeholder:"メンテナンス中に表示されるメッセージ",className:"w-full p-2 border border-gray-300 rounded-lg",rows:3,required:!0})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"開始時刻（日本時間）"}),t.jsx(d,{type:"datetime-local",value:q.start_time,onChange:e=>$({...q,start_time:e.target.value}),label:"開始時刻"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"日本時間で入力してください"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"終了時刻（日本時間）"}),t.jsx(d,{type:"datetime-local",value:q.end_time,onChange:e=>$({...q,end_time:e.target.value}),label:"終了時刻"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"日本時間で入力してください"})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("input",{type:"checkbox",id:"is_emergency",checked:q.is_emergency,onChange:e=>$({...q,is_emergency:e.target.checked}),className:"w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500"}),t.jsx("label",{htmlFor:"is_emergency",className:"text-sm font-medium",children:"緊急メンテナンス"})]}),t.jsxs("div",{className:"flex justify-end space-x-2",children:[t.jsx(i,{type:"button",variant:"secondary",onClick:()=>{N(!1),b(null),$({title:"",message:"",start_time:"",end_time:"",is_emergency:!1})},children:"キャンセル"}),t.jsx(i,{type:"submit",children:v?"更新":"作成"})]})]})]}),t.jsxs(a,{className:"p-6",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"メンテナンス予定一覧"}),p?t.jsx("div",{className:"flex justify-center py-8",children:t.jsx("div",{className:"text-gray-600",children:"読み込み中..."})}):0===h.length?t.jsx("div",{className:"text-center py-8 text-gray-500",children:"メンテナンス予定がありません"}):t.jsx("div",{className:"space-y-4",children:h.map((a=>t.jsx("div",{className:"border rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("h4",{className:"font-medium",children:a.title}),a.is_active&&t.jsx("span",{className:"bg-red-100 text-red-800 text-xs px-2 py-1 rounded",children:"有効"}),a.is_emergency&&t.jsx("span",{className:"bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded",children:"緊急"})]}),t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:a.message}),t.jsxs("div",{className:"text-sm text-gray-500 mt-2",children:[t.jsxs("div",{children:["開始: ",D(a.start_time)]}),t.jsxs("div",{children:["終了: ",D(a.end_time)]})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(i,{variant:a.is_active?"danger":"success",size:"sm",onClick:()=>(async t=>{try{const{error:a}=await s.from("maintenance_schedules").update({is_active:!t.is_active}).eq("id",t.id);if(a)return void e(`メンテナンス状態の変更に失敗しました: ${a.message}`);l(`メンテナンスを${t.is_active?"無効":"有効"}にしました`),await R(),await c()}catch(a){e("メンテナンス状態の変更中にエラーが発生しました")}})(a),children:a.is_active?t.jsxs(t.Fragment,{children:[t.jsx(C,{className:"w-4 h-4 mr-1"}),"無効化"]}):t.jsxs(t.Fragment,{children:[t.jsx(I,{className:"w-4 h-4 mr-1"}),"有効化"]})}),t.jsx(i,{variant:"secondary",size:"sm",onClick:()=>(e=>{b(e),$({title:e.title,message:e.message,start_time:A(e.start_time||""),end_time:A(e.end_time||""),is_emergency:e.is_emergency}),N(!0)})(a),children:t.jsx(w,{className:"w-4 h-4"})}),t.jsx(i,{variant:"danger",size:"sm",onClick:()=>(async t=>{if(confirm("このメンテナンス予定を削除しますか？"))try{const{error:a}=await s.from("maintenance_schedules").delete().eq("id",t);if(a)return void e(`メンテナンス予定の削除に失敗しました: ${a.message}`);l("メンテナンス予定を削除しました"),await R(),await c()}catch(a){e("メンテナンス予定の削除中にエラーが発生しました")}})(a.id),children:t.jsx(_,{className:"w-4 h-4"})})]})]})},a.id)))})]})]}):t.jsx(L,{onError:e,onSuccess:l})]})};function O(){const{user:r,isAdmin:d}=e(),m=l(),[x,o]=n.useState("overview"),[u,p]=n.useState({totalUsers:0,totalParks:0,pendingParks:0,pendingVaccines:0,totalReservations:0,monthlyRevenue:0,lastMonthRevenue:0,totalSubscriptions:0,activeSubscriptions:0,newUsersThisMonth:0,unreadMessages:0}),[g,f]=n.useState(!0),[N,v]=n.useState(""),[b,y]=n.useState("");n.useEffect((()=>{d?w():m("/")}),[d,m]);const w=async()=>{try{f(!0),v(""),y("");const{data:e,error:t}=await s.rpc("get_admin_stats");if(t)throw t;const a=e;p({totalUsers:a?.total_users||0,totalParks:a?.total_parks||0,pendingParks:a?.pending_parks||0,pendingVaccines:a?.pending_vaccines||0,totalReservations:a?.total_reservations||0,monthlyRevenue:a?.monthly_revenue||0,lastMonthRevenue:a?.last_month_revenue||0,totalSubscriptions:a?.total_subscriptions||0,activeSubscriptions:a?.active_subscriptions||0,newUsersThisMonth:a?.new_users_this_month||0,unreadMessages:a?.unread_messages||0})}catch(e){v("統計データの取得に失敗しました。")}finally{f(!1)}};return g?t.jsx("div",{className:"flex justify-center items-center h-64",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsxs("h1",{className:"text-2xl font-bold flex items-center",children:[t.jsx(S,{className:"w-8 h-8 text-red-600 mr-3"}),"管理者ダッシュボード"]}),t.jsx("p",{className:"text-gray-600",children:"システム全体の管理と監視"})]}),t.jsxs("div",{className:"text-sm text-gray-500",children:["最終更新: ",(new Date).toLocaleString("ja-JP")]})]}),N&&t.jsxs("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4 flex items-start",children:[t.jsx(h,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),t.jsx("p",{children:N})]}),b&&t.jsxs("div",{className:"bg-green-100 border border-green-300 text-green-800 rounded-lg p-4 flex items-start",children:[t.jsx(j,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),t.jsx("p",{children:b})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[t.jsx(c,{to:"/admin/users",children:t.jsx(a,{className:"p-6 hover:shadow-lg transition-all duration-200 cursor-pointer hover:scale-105",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"総ユーザー数"}),t.jsx("p",{className:"text-2xl font-bold text-blue-600",children:u.totalUsers}),t.jsxs("p",{className:"text-xs text-green-600",children:["+",u.newUsersThisMonth," 今月"]})]}),t.jsx(q,{className:"w-8 h-8 text-blue-600"})]})})}),t.jsx(c,{to:"/admin/parks",children:t.jsx(a,{className:"p-6 hover:shadow-lg transition-all duration-200 cursor-pointer hover:scale-105",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"総ドッグラン数"}),t.jsx("p",{className:"text-2xl font-bold text-green-600",children:u.totalParks}),u.pendingParks>0&&t.jsxs("p",{className:"text-xs text-orange-600",children:["承認待ち: ",u.pendingParks]})]}),t.jsx($,{className:"w-8 h-8 text-green-600"})]})})}),t.jsx(c,{to:"/admin/reservations",children:t.jsx(a,{className:"p-6 hover:shadow-lg transition-all duration-200 cursor-pointer hover:scale-105",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"今月の予約数"}),t.jsx("p",{className:"text-2xl font-bold text-purple-600",children:u.totalReservations}),t.jsxs("p",{className:"text-xs text-purple-600",children:["サブスク会員: ",u.activeSubscriptions]})]}),t.jsx(R,{className:"w-8 h-8 text-purple-600"})]})})}),t.jsx(c,{to:"/admin/sales",children:t.jsx(a,{className:"p-6 hover:shadow-lg transition-all duration-200 cursor-pointer hover:scale-105",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"今月の売上"}),t.jsxs("p",{className:"text-2xl font-bold text-orange-600",children:["¥",u.monthlyRevenue.toLocaleString()]}),u.lastMonthRevenue>0&&t.jsxs("p",{className:"text-xs text-gray-500",children:["前月比: ",Math.round(100*(u.monthlyRevenue/u.lastMonthRevenue-1)),"%"]})]}),t.jsx(D,{className:"w-8 h-8 text-orange-600"})]})})})]}),(u.pendingParks>0||u.pendingVaccines>0)&&t.jsxs(a,{className:"p-6 bg-red-50 border-red-200",children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[t.jsx(h,{className:"w-6 h-6 text-red-600"}),t.jsx("h2",{className:"text-lg font-semibold text-red-900",children:"緊急対応が必要"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[u.pendingParks>0&&t.jsxs("div",{className:"bg-white p-4 rounded-lg border border-red-200",children:[t.jsx("p",{className:"font-medium text-red-900",children:"ドッグラン承認待ち"}),t.jsxs("p",{className:"text-2xl font-bold text-red-600",children:[u.pendingParks,"件"]}),t.jsx(c,{to:"/admin/management",children:t.jsx(i,{size:"sm",className:"mt-2",children:"確認する"})})]}),u.pendingVaccines>0&&t.jsxs("div",{className:"bg-white p-4 rounded-lg border border-red-200",children:[t.jsx("p",{className:"font-medium text-red-900",children:"ワクチン証明書承認待ち"}),t.jsxs("p",{className:"text-2xl font-bold text-red-600",children:[u.pendingVaccines,"件"]}),t.jsx(c,{to:"/admin/management",children:t.jsx(i,{size:"sm",className:"mt-2",children:"確認する"})})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsx(c,{to:"/admin/management",children:t.jsx(a,{className:"p-6 hover:shadow-lg transition-shadow cursor-pointer",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"bg-blue-100 p-3 rounded-full",children:t.jsx(z,{className:"w-6 h-6 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold",children:"ワクチン証明書・ドッグラン管理"}),t.jsx("p",{className:"text-sm text-gray-600",children:"ワクチン証明書の承認・ドッグランの審査管理"})]})]})})}),t.jsx(c,{to:"/admin/shop",children:t.jsx(a,{className:"p-6 hover:shadow-lg transition-shadow cursor-pointer",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"bg-green-100 p-3 rounded-full",children:t.jsx(M,{className:"w-6 h-6 text-green-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold",children:"ショップ管理"}),t.jsx("p",{className:"text-sm text-gray-600",children:"商品管理・注文管理・在庫管理"})]})]})})}),t.jsx(c,{to:"/admin/revenue",children:t.jsx(a,{className:"p-6 hover:shadow-lg transition-shadow cursor-pointer",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"bg-purple-100 p-3 rounded-full",children:t.jsx(T,{className:"w-6 h-6 text-purple-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold",children:"売上レポート"}),t.jsx("p",{className:"text-sm text-gray-600",children:"ドッグラン別売上・振込管理"})]})]})})})]}),t.jsxs("div",{className:"flex space-x-4 border-b",children:[t.jsxs("button",{className:"px-4 py-2 font-medium relative flex items-center space-x-2 "+("overview"===x?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>o("overview"),children:[t.jsx(V,{className:"w-4 h-4"}),t.jsx("span",{children:"概要"})]}),t.jsxs("button",{className:"px-4 py-2 font-medium relative flex items-center space-x-2 "+("parks"===x?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>o("parks"),children:[t.jsx($,{className:"w-4 h-4"}),t.jsx("span",{children:"ドッグラン管理"}),u.pendingParks>0&&t.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:u.pendingParks})]}),t.jsxs("button",{className:"px-4 py-2 font-medium relative flex items-center space-x-2 "+("vaccines"===x?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>o("vaccines"),children:[t.jsx(z,{className:"w-4 h-4"}),t.jsx("span",{children:"ワクチン承認"}),u.pendingVaccines>0&&t.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:u.pendingVaccines})]}),t.jsxs("button",{className:"px-4 py-2 font-medium relative flex items-center space-x-2 "+("users"===x?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>o("users"),children:[t.jsx(q,{className:"w-4 h-4"}),t.jsx("span",{children:"ユーザー管理"})]}),t.jsxs("button",{className:"px-4 py-2 font-medium relative flex items-center space-x-2 "+("maintenance"===x?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),onClick:()=>o("maintenance"),children:[t.jsx(P,{className:"w-4 h-4"}),t.jsx("span",{children:"メンテナンス"})]})]}),"overview"===x&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs(a,{className:"p-6",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"システム概要"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium mb-2",children:"プラットフォーム統計"}),t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"アクティブユーザー:"}),t.jsxs("span",{className:"font-medium",children:[u.totalUsers,"人"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"承認済みドッグラン:"}),t.jsxs("span",{className:"font-medium",children:[u.totalParks-u.pendingParks,"施設"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"今月の予約:"}),t.jsxs("span",{className:"font-medium",children:[u.totalReservations,"件"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"今月の売上:"}),t.jsxs("span",{className:"font-medium",children:["¥",u.monthlyRevenue.toLocaleString()]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"アクティブサブスク:"}),t.jsxs("span",{className:"font-medium",children:[u.activeSubscriptions,"件"]})]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium mb-2",children:"承認待ち項目"}),t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"ドッグラン:"}),t.jsxs("span",{className:"font-medium "+(u.pendingParks>0?"text-red-600":"text-green-600"),children:[u.pendingParks,"件"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"ワクチン証明書:"}),t.jsxs("span",{className:"font-medium "+(u.pendingVaccines>0?"text-red-600":"text-green-600"),children:[u.pendingVaccines,"件"]})]})]})]})]})]}),t.jsxs(a,{className:"p-6",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold",children:"売上推移"}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsx(c,{to:"/admin/revenue",children:t.jsxs(i,{size:"sm",variant:"secondary",children:[t.jsx(T,{className:"w-4 h-4 mr-1"}),"詳細レポート"]})}),t.jsxs(i,{size:"sm",variant:"secondary",children:[t.jsx(E,{className:"w-4 h-4 mr-1"}),"CSV"]})]})]}),t.jsx("div",{className:"h-64 bg-gray-100 rounded-lg flex items-center justify-center",children:t.jsx("p",{className:"text-gray-500",children:"売上グラフ（実装予定）"})})]}),t.jsx(F,{})]}),"parks"===x&&t.jsxs(a,{className:"p-6",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"ドッグラン管理"}),t.jsxs("p",{className:"text-gray-600",children:["詳細なドッグラン管理は",t.jsx(c,{to:"/admin/management",className:"text-blue-600 hover:text-blue-800 mx-1",children:"管理ページ"}),"で行えます。"]})]}),"vaccines"===x&&t.jsxs(a,{className:"p-6",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"ワクチン証明書管理"}),t.jsxs("p",{className:"text-gray-600",children:["詳細なワクチン証明書管理は",t.jsx(c,{to:"/admin/management",className:"text-blue-600 hover:text-blue-800 mx-1",children:"管理ページ"}),"で行えます。"]})]}),"users"===x&&t.jsxs(a,{className:"p-6",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"ユーザー管理"}),t.jsxs("p",{className:"text-gray-600",children:["詳細なユーザー管理は",t.jsx(c,{to:"/admin/management",className:"text-blue-600 hover:text-blue-800 mx-1",children:"管理ページ"}),"で行えます。"]})]}),"maintenance"===x&&t.jsx(J,{onError:v,onSuccess:y})]})}export{O as AdminDashboard};

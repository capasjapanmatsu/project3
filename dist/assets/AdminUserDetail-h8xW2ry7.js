import{u as e,s,j as a,B as t,C as l}from"./index-BFgW40ku.js";import{u as r,h as c,r as n}from"./vendor-BHVjIt_u.js";import{J as i,k as d,t as x,aB as m,e as o,M as h,r as j,d as g,m as p,C as N,_ as u,az as y}from"./ui-Qz4g1iz4.js";import"./supabase-CKbzEL5D.js";function f(){const{isAdmin:f}=e(),v=r(),{userId:w}=c(),[b,_]=n.useState(null),[k,S]=n.useState(!0),[D,L]=n.useState("");n.useEffect((()=>{f?w&&C(w):v("/")}),[f,v,w]);const C=async e=>{try{S(!0),L("");const{data:a,error:t}=await s.from("profiles").select("*").eq("id",e).single();if(t)throw new Error("ユーザー情報の取得に失敗しました");const{data:l,error:r}=await s.from("dogs").select("id, name, breed, age, gender, image_url").eq("owner_id",e),{data:c,error:n}=await s.from("reservations").select("\n          id,\n          date,\n          time_slot,\n          total_amount,\n          status,\n          dog_parks (\n            name\n          )\n        ").eq("user_id",e).order("date",{ascending:!1}).limit(20),i=(c||[]).reduce(((e,s)=>e+(s.total_amount||0)),0),d=`user_${e.slice(0,8)}@unknown.com`,x={id:a.id,name:a.name||"Unknown",email:d,phone:a.phone_number||"",postal_code:a.postal_code||"",address:a.address||"",user_type:a.user_type||"user",created_at:a.created_at,is_active:!0,dogs:l||[],reservations:(c||[]).map((e=>({id:e.id,park_name:e.dog_parks?.name||"Unknown Park",date:e.date,time_slot:e.time_slot,total_amount:e.total_amount||0,status:e.status}))),subscription_status:"inactive",total_spent:i,last_activity:c?.[0]?.date||""};_(x)}catch(a){L(a instanceof Error?a.message:"ユーザー詳細の取得に失敗しました")}finally{S(!1)}};return k?a.jsx("div",{className:"flex justify-center items-center h-screen",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):D?a.jsxs("div",{className:"max-w-4xl mx-auto p-4",children:[a.jsx("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4",children:D}),a.jsxs(t,{onClick:()=>v("/admin/users"),className:"mt-4",variant:"secondary",children:[a.jsx(i,{className:"w-4 h-4 mr-2"}),"ユーザー一覧に戻る"]})]}):b?a.jsxs("div",{className:"max-w-4xl mx-auto p-4 space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs(t,{onClick:()=>v("/admin/users"),variant:"secondary",size:"sm",children:[a.jsx(i,{className:"w-4 h-4 mr-2"}),"ユーザー一覧に戻る"]}),a.jsxs("div",{className:"flex items-center space-x-2",children:["active"===b.subscription_status&&a.jsxs("span",{className:"bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-sm font-medium flex items-center",children:[a.jsx(d,{className:"w-4 h-4 mr-1"}),"サブスク会員"]}),b.is_active?a.jsxs("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded-full text-sm font-medium flex items-center",children:[a.jsx(x,{className:"w-4 h-4 mr-1"}),"アクティブ"]}):a.jsxs("span",{className:"bg-red-100 text-red-800 px-2 py-1 rounded-full text-sm font-medium flex items-center",children:[a.jsx(m,{className:"w-4 h-4 mr-1"}),"非アクティブ"]})]})]}),a.jsxs(l,{className:"p-6",children:[a.jsxs("div",{className:"flex items-center mb-6",children:[a.jsx(o,{className:"w-8 h-8 text-blue-600 mr-3"}),a.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:b.name})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center text-gray-600",children:[a.jsx(h,{className:"w-5 h-5 mr-3 text-gray-400"}),a.jsx("span",{children:b.email})]}),b.phone&&a.jsxs("div",{className:"flex items-center text-gray-600",children:[a.jsx(j,{className:"w-5 h-5 mr-3 text-gray-400"}),a.jsx("span",{children:b.phone})]}),b.address&&a.jsxs("div",{className:"flex items-center text-gray-600",children:[a.jsx(g,{className:"w-5 h-5 mr-3 text-gray-400"}),a.jsxs("span",{children:[b.postal_code," ",b.address]})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center text-gray-600",children:[a.jsx(p,{className:"w-5 h-5 mr-3 text-gray-400"}),a.jsxs("span",{children:["登録日: ",new Date(b.created_at).toLocaleDateString("ja-JP")]})]}),b.last_activity&&a.jsxs("div",{className:"flex items-center text-gray-600",children:[a.jsx(N,{className:"w-5 h-5 mr-3 text-gray-400"}),a.jsxs("span",{children:["最終活動: ",new Date(b.last_activity).toLocaleDateString("ja-JP")]})]}),a.jsxs("div",{className:"flex items-center text-gray-600",children:[a.jsx(u,{className:"w-5 h-5 mr-3 text-gray-400"}),a.jsxs("span",{children:["総支払額: ¥",b.total_spent.toLocaleString()]})]})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsx(l,{className:"p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"登録犬数"}),a.jsx("p",{className:"text-2xl font-bold text-blue-600",children:b.dogs.length})]}),a.jsx(y,{className:"w-8 h-8 text-blue-600"})]})}),a.jsx(l,{className:"p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"予約数"}),a.jsx("p",{className:"text-2xl font-bold text-green-600",children:b.reservations.length})]}),a.jsx(p,{className:"w-8 h-8 text-green-600"})]})}),a.jsx(l,{className:"p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"総支払額"}),a.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:["¥",b.total_spent.toLocaleString()]})]}),a.jsx(u,{className:"w-8 h-8 text-purple-600"})]})})]}),a.jsxs(l,{className:"p-6",children:[a.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[a.jsx(y,{className:"w-5 h-5 mr-2"}),"登録犬一覧 (",b.dogs.length,"匹)"]}),0===b.dogs.length?a.jsx("p",{className:"text-gray-500",children:"登録された犬はありません"}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:b.dogs.map((e=>a.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[e.image_url?a.jsx("img",{src:e.image_url,alt:e.name,className:"w-12 h-12 rounded-full object-cover"}):a.jsx("div",{className:"w-12 h-12 bg-gray-300 rounded-full flex items-center justify-center",children:a.jsx(y,{className:"w-6 h-6 text-gray-600"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-gray-800",children:e.name}),a.jsxs("p",{className:"text-sm text-gray-600",children:[e.breed," • ",e.gender]}),a.jsxs("p",{className:"text-sm text-gray-500",children:[e.age,"歳"]})]})]})},e.id)))})]}),a.jsxs(l,{className:"p-6",children:[a.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[a.jsx(p,{className:"w-5 h-5 mr-2"}),"予約履歴 (",b.reservations.length,"件)"]}),0===b.reservations.length?a.jsx("p",{className:"text-gray-500",children:"予約履歴はありません"}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"ドッグパーク"}),a.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"予約日"}),a.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"時間"}),a.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"金額"}),a.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"ステータス"})]})}),a.jsx("tbody",{className:"divide-y divide-gray-200",children:b.reservations.map((e=>a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.park_name}),a.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:new Date(e.date).toLocaleDateString("ja-JP")}),a.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.time_slot}),a.jsxs("td",{className:"px-4 py-3 text-sm text-gray-900",children:["¥",e.total_amount.toLocaleString()]}),a.jsx("td",{className:"px-4 py-3",children:a.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("confirmed"===e.status?"bg-green-100 text-green-800":"cancelled"===e.status?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:"confirmed"===e.status?"確定":"cancelled"===e.status?"キャンセル":"保留中"})})]},e.id)))})]})})]})]}):a.jsx("div",{className:"max-w-4xl mx-auto p-4",children:a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-gray-600",children:"ユーザーが見つかりません"}),a.jsxs(t,{onClick:()=>v("/admin/users"),className:"mt-4",variant:"secondary",children:[a.jsx(i,{className:"w-4 h-4 mr-2"}),"ユーザー一覧に戻る"]})]})})}export{f as AdminUserDetail};

import{j as e,B as o,s as p}from"./index-fyCrE4_U.js";import{r,u as f}from"./react-vendor-Co5xHYdE.js";import{V as j,A as b}from"./ui-vendor-C9ptRAmi.js";import"./supabase-vendor-FDBaXLCh.js";function w(){const[c,x]=r.useState(null),[n,u]=r.useState(null),[t,i]=r.useState(null),[d,m]=r.useState(!1),a=f();r.useEffect(()=>{(async()=>{m(!0),i(null);try{console.log("2FA enrollment を開始...");const{data:s,error:l}=await p.auth.mfa.enroll({factorType:"totp",issuer:"DogParkJP",friendlyName:"DogPark Device"});if(l)throw console.error("MFA enrollment エラー:",l),new Error(`2FA登録に失敗しました: ${l.message}`);if(console.log("MFA enrollment 成功:",s),!s||!s.totp||!s.totp.qr_code)throw new Error("QRコードの生成に失敗しました");x(s.totp.qr_code),u(s.id)}catch(s){console.error("2FA セットアップエラー:",s),i(s.message||"2FAセットアップに失敗しました")}finally{m(!1)}})()},[]);const h=()=>{n&&a(`/two-factor-verify?factorId=${n}`)};return e.jsxs("div",{className:"max-w-md mx-auto p-8",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsxs(o,{variant:"secondary",size:"sm",onClick:()=>a("/profile-settings"),className:"mr-3",children:[e.jsx(j,{className:"w-4 h-4 mr-1"}),"戻る"]}),e.jsx("h2",{className:"text-xl font-semibold",children:"2ファクタ認証セットアップ"})]}),d&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{children:"2FAセットアップを準備中..."})]}),t&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-red-800",children:[e.jsx(b,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:t})]}),e.jsx(o,{variant:"secondary",onClick:()=>a("/profile-settings"),className:"mt-3",children:"プロフィール設定に戻る"})]}),c&&!d&&!t&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-md",children:[e.jsx("p",{className:"text-sm text-blue-800 mb-2",children:e.jsx("strong",{children:"手順："})}),e.jsxs("ol",{className:"text-sm text-blue-700 list-decimal list-inside space-y-1",children:[e.jsx("li",{children:"認証アプリ（Google Authenticator等）を開く"}),e.jsx("li",{children:"「アカウント追加」→「QRコードをスキャン」を選択"}),e.jsx("li",{children:"下のQRコードをスキャン"}),e.jsx("li",{children:"「次へ」ボタンで認証コードを入力"})]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"mb-3 font-medium",children:"QRコードをスキャンしてください："}),e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:`https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=${encodeURIComponent(c)}`,alt:"2FA QR Code",className:"border border-gray-300 rounded"})}),e.jsx("p",{className:"text-xs text-gray-600 mb-4",children:"QRコードをスキャンできない場合は、手動でキーを入力してください"}),e.jsx(o,{onClick:h,className:"w-full",children:"次へ（認証コード入力）"})]})]})]})}export{w as default};

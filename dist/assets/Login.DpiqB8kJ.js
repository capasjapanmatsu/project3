var e=(e,s,t)=>new Promise((a,r)=>{var l=e=>{try{n(t.next(e))}catch(s){r(s)}},o=e=>{try{n(t.throw(e))}catch(s){r(s)}},n=e=>e.done?a(e.value):Promise.resolve(e.value).then(l,o);n((t=t.apply(e,s)).next())});import{u as s,j as t,C as a,B as r,n as l}from"./index.Drgpoyph.js";import{r as o}from"./vendor.CKEClKZl.js";import{I as n}from"./Input.CUuxlVXM.js";import{l as c}from"./logger.X2WpaG9g.js";import{u as i}from"./router.B_7Atevv.js";import{q as m,A as x,M as d,E as h,r as u,l as b}from"./ui.C72fRZ1L.js";import"./supabase.X3H3st79.js";function j(){const{signInWithMagicLink:j,signInWithPassword:g}=s(),[p,N]=o.useState(!1),[y,f]=o.useState(""),[v,w]=o.useState(""),[k,C]=o.useState(""),[A,S]=o.useState(!0),[L,M]=o.useState(!1),P=i();o.useEffect(()=>{},[]);const E=s=>e(this,null,function*(){s.preventDefault(),N(!0),f("");try{const e=yield j(v);e.success?(localStorage.setItem("lastUsedEmail",v),l.success("ログインリンクを送信しました。メールをご確認ください。")):f(e.error||"Magic Linkの送信に失敗しました。もう一度お試しください。")}catch(e){c.error("❌ Magic link error:",e),f(e instanceof Error?e.message:"メールの送信に失敗しました。もう一度お試しください。")}finally{N(!1)}}),I=s=>e(this,null,function*(){s.preventDefault(),N(!0),f("");try{const e=yield g(v,k);e.success?(l.success("ログインしました。"),P("/dashboard")):f(e.error||"ログインに失敗しました。もう一度お試しください。")}catch(e){c.error("❌ Password login error:",e),f(e instanceof Error?e.message:"ログインに失敗しました。もう一度お試しください。")}finally{N(!1)}});return t.jsxs("div",{className:"max-w-md mx-auto",children:[t.jsx("h1",{className:"text-2xl font-bold text-center mb-8",children:"ログイン"}),t.jsxs(a,{children:[t.jsxs("div",{className:"flex mb-6 bg-gray-100 p-1 rounded-lg",children:[t.jsx(r,{type:"button",onClick:()=>S(!0),variant:A?"primary":"secondary",style:A?{backgroundColor:"#2563eb",color:"white",borderColor:"#2563eb"}:{backgroundColor:"white",color:"#2563eb",borderColor:"#2563eb"},children:"パスワード"}),t.jsx(r,{type:"button",onClick:()=>S(!1),variant:A?"secondary":"primary",style:A?{backgroundColor:"white",color:"#2563eb",borderColor:"#2563eb"}:{backgroundColor:"#2563eb",color:"white",borderColor:"#2563eb"},children:"Magic Link"})]}),A?t.jsxs("form",{onSubmit:e=>{I(e)},className:"p-6",children:[t.jsxs("div",{className:"text-center mb-6",children:[t.jsx(m,{className:"w-12 h-12 text-blue-600 mx-auto mb-4"}),t.jsx("h2",{className:"text-xl font-semibold mb-2",children:"パスワードでログイン"}),t.jsx("p",{className:"text-gray-600",children:"メールアドレスとパスワードを入力してください。"})]}),y&&t.jsxs("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded-lg flex items-start",children:[t.jsx(x,{className:"w-5 h-5 mr-2 flex-shrink-0 mt-0.5"}),t.jsx("p",{children:y})]}),t.jsx(n,{label:"メールアドレス",type:"email",value:v,onChange:e=>w(e.target.value),required:!0,icon:t.jsx(d,{className:"w-4 h-4 text-gray-500"}),placeholder:"capasjapan@gmail.com"}),t.jsxs("div",{className:"relative",children:[t.jsx(n,{label:"パスワード",type:L?"text":"password",value:k,onChange:e=>C(e.target.value),required:!0,icon:t.jsx(m,{className:"w-4 h-4 text-gray-500"}),placeholder:"パスワードを入力"}),t.jsx("button",{type:"button",onClick:()=>M(!L),className:"absolute right-3 top-9 text-gray-500 hover:text-gray-700",children:L?t.jsx(h,{className:"w-4 h-4"}):t.jsx(u,{className:"w-4 h-4"})})]}),t.jsxs(r,{type:"submit",isLoading:p,className:"w-full mt-6",children:[t.jsx(m,{className:"w-4 h-4 mr-2"}),"ログイン",t.jsx(b,{className:"w-4 h-4 ml-2"})]}),t.jsx("div",{className:"mt-4 text-center",children:t.jsx("button",{type:"button",onClick:()=>P("/forgot-password"),className:"text-sm text-blue-600 hover:text-blue-700",children:"パスワードをお忘れですか？"})})]}):t.jsxs("form",{onSubmit:e=>{E(e)},className:"p-6",children:[t.jsxs("div",{className:"text-center mb-6",children:[t.jsx(d,{className:"w-12 h-12 text-blue-600 mx-auto mb-4"}),t.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Magic Linkでログイン"}),t.jsx("p",{className:"text-gray-600",children:"メールアドレスを入力するだけで、ドッグパークJPにログインできます。"})]}),y&&t.jsxs("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded-lg flex items-start",children:[t.jsx(x,{className:"w-5 h-5 mr-2 flex-shrink-0 mt-0.5"}),t.jsx("p",{children:y})]}),t.jsx(n,{label:"メールアドレス",type:"email",value:v,onChange:e=>w(e.target.value),required:!0,icon:t.jsx(d,{className:"w-4 h-4 text-gray-500"}),placeholder:"example@example.com"}),t.jsxs(r,{type:"submit",isLoading:p,className:"w-full mt-6",children:[t.jsx(d,{className:"w-4 h-4 mr-2"}),"ログインリンクを送信",t.jsx(b,{className:"w-4 h-4 ml-2"})]})]})]}),t.jsx("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg border",children:t.jsxs("div",{className:"text-center",children:[t.jsx(x,{className:"w-6 h-6 text-orange-600 mx-auto mb-2"}),t.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-1",children:"ログインできない場合"}),t.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"管理者向けに不具合を報告できます"}),t.jsxs("button",{type:"button",onClick:()=>window.open("mailto:info@dogparkjp.com?subject=ドッグパークJP - ログイン不具合報告&body=ログインに関する不具合を報告いたします。%0A%0A【発生状況】%0A%0A【エラー内容】%0A%0A【ブラウザ情報】%0A"+navigator.userAgent,"_blank"),className:"inline-flex items-center px-4 py-2 bg-orange-600 text-white text-sm font-medium rounded-lg hover:bg-orange-700 transition-colors",children:[t.jsx(d,{className:"w-4 h-4 mr-2"}),"管理者に報告する"]})]})}),t.jsx("div",{className:"mt-6 text-center",children:t.jsxs("p",{className:"text-sm text-gray-600",children:["アカウントをお持ちでない方は"," ",t.jsx("button",{onClick:()=>P("/register"),className:"text-blue-600 hover:text-blue-700 font-medium",children:"こちらから新規登録"})]})})]})}export{j as Login};

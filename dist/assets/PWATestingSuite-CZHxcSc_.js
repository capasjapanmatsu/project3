import{j as e,B as T,C as d}from"./index-fyCrE4_U.js";import{r as m}from"./react-vendor-Co5xHYdE.js";import{R as p,i as h,q as w,h as y,j as A,W as M,b0 as E}from"./ui-vendor-C9ptRAmi.js";import"./supabase-vendor-FDBaXLCh.js";const _=()=>{const[c,j]=m.useState({installation:[],offline:[],performance:[],security:[],features:[]}),[o,g]=m.useState(!1),[l,v]=m.useState("installation"),x=async()=>{g(!0);try{const s=await N(),t=await b(),a=await S(),n=await k(),i=await C();j({installation:s,offline:t,performance:a,security:n,features:i})}catch{}finally{g(!1)}},N=async()=>{const s=[];try{const t=await fetch("/manifest.json");if(s.push({id:"manifest-exists",name:"マニフェストファイル",description:"manifest.jsonファイルが存在するか",status:t.ok?"pass":"fail",details:t.ok?"マニフェストファイルが正常に読み込まれました":"マニフェストファイルが見つかりません"}),t.ok){const a=await t.json();s.push({id:"manifest-name",name:"アプリ名",description:"manifestにname/short_nameが設定されているか",status:a.name&&a.short_name?"pass":"fail",details:`name: ${a.name||"未設定"}, short_name: ${a.short_name||"未設定"}`}),s.push({id:"manifest-icons",name:"アイコン",description:"manifestに適切なアイコンが設定されているか",status:a.icons&&a.icons.length>0?"pass":"fail",details:`${a.icons?.length||0}個のアイコンが設定されています`}),s.push({id:"manifest-start-url",name:"スタートURL",description:"manifestにstart_urlが設定されているか",status:a.start_url?"pass":"fail",details:`start_url: ${a.start_url||"未設定"}`}),s.push({id:"manifest-display",name:"表示モード",description:"manifestに適切な表示モードが設定されているか",status:a.display?"pass":"warning",details:`display: ${a.display||"browser (デフォルト)"}`})}}catch(t){s.push({id:"manifest-error",name:"マニフェストエラー",description:"マニフェストファイルの読み込みでエラーが発生",status:"fail",details:`エラー: ${t instanceof Error?t.message:"不明なエラー"}`})}if(s.push({id:"service-worker",name:"Service Worker",description:"Service Workerが登録されているか",status:"serviceWorker"in navigator?"pass":"fail",details:"serviceWorker"in navigator?"Service Workerがサポートされています":"Service Workerがサポートされていません"}),"serviceWorker"in navigator)try{const t=await navigator.serviceWorker.getRegistration();s.push({id:"service-worker-registered",name:"Service Worker登録状態",description:"Service Workerが実際に登録されているか",status:t?"pass":"warning",details:t?`登録済み: ${t.scope}`:"未登録または登録中"})}catch(t){s.push({id:"service-worker-error",name:"Service Workerエラー",description:"Service Worker確認中にエラーが発生",status:"fail",details:`エラー: ${t instanceof Error?t.message:"不明なエラー"}`})}return s.push({id:"installable",name:"インストール可能性",description:"PWAがインストール可能な状態か",status:window.matchMedia("(display-mode: standalone)").matches?"pass":"warning",details:window.matchMedia("(display-mode: standalone)").matches?"PWAモードで実行中":"ブラウザモードで実行中（インストール可能かもしれません）"}),s},b=async()=>{const s=[];try{const t=await fetch("/offline.html");s.push({id:"offline-page",name:"オフラインページ",description:"オフライン時に表示されるページが存在するか",status:t.ok?"pass":"fail",details:t.ok?"オフラインページが正常に読み込まれました":"オフラインページが見つかりません"})}catch(t){s.push({id:"offline-page-error",name:"オフラインページエラー",description:"オフラインページの確認中にエラーが発生",status:"fail",details:`エラー: ${t instanceof Error?t.message:"不明なエラー"}`})}if(s.push({id:"cache-api",name:"Cache API",description:"Cache APIがサポートされているか",status:"caches"in window?"pass":"fail",details:"caches"in window?"Cache APIがサポートされています":"Cache APIがサポートされていません"}),"caches"in window)try{const t=await caches.keys();s.push({id:"cache-stored",name:"キャッシュ保存状況",description:"アプリのキャッシュが保存されているか",status:t.length>0?"pass":"warning",details:`${t.length}個のキャッシュが保存されています: ${t.join(", ")}`})}catch(t){s.push({id:"cache-error",name:"キャッシュエラー",description:"キャッシュ確認中にエラーが発生",status:"fail",details:`エラー: ${t instanceof Error?t.message:"不明なエラー"}`})}return s.push({id:"network-status",name:"ネットワーク状態",description:"現在のネットワーク接続状態",status:navigator.onLine?"pass":"warning",details:navigator.onLine?"オンライン":"オフライン"}),s},S=async()=>{const s=[];if("performance"in window&&performance.navigation){const t=performance.timing,a=t.loadEventEnd-t.navigationStart;s.push({id:"load-time",name:"ページ読み込み時間",description:"ページの読み込み速度",status:a<3e3?"pass":a<5e3?"warning":"fail",details:`${a}ms（目標: 3秒以下）`});const n=t.domContentLoadedEventEnd-t.navigationStart;s.push({id:"dom-content-loaded",name:"DOM構築時間",description:"DOMContentLoadedまでの時間",status:n<1500?"pass":n<2500?"warning":"fail",details:`${n}ms（目標: 1.5秒以下）`})}if("performance"in window&&performance.getEntriesByType){const a=performance.getEntriesByType("resource").reduce((n,i)=>n+(i.transferSize||0),0);s.push({id:"resource-size",name:"リソースサイズ",description:"読み込まれたリソースの総サイズ",status:a<1e6?"pass":a<2e6?"warning":"fail",details:`${(a/1024).toFixed(2)} KB（目標: 1MB以下）`})}if("memory"in performance){const t=performance.memory;s.push({id:"memory-usage",name:"メモリ使用量",description:"JavaScriptヒープのメモリ使用量",status:t.usedJSHeapSize<5e7?"pass":"warning",details:`${(t.usedJSHeapSize/1024/1024).toFixed(2)} MB`})}return s},k=async()=>{const s=[];s.push({id:"https",name:"HTTPS接続",description:"セキュアな接続が使用されているか",status:location.protocol==="https:"||location.hostname==="localhost"?"pass":"fail",details:`プロトコル: ${location.protocol}`});const t=document.querySelector('meta[http-equiv="Content-Security-Policy"]');if(s.push({id:"csp",name:"Content Security Policy",description:"CSPが設定されているか",status:t?"pass":"warning",details:t?"CSPが設定されています":"CSPが設定されていません（推奨）"}),"serviceWorker"in navigator)try{const a=await navigator.serviceWorker.getRegistration();a&&s.push({id:"sw-scope",name:"Service Worker スコープ",description:"Service Workerのスコープが適切か",status:a.scope.endsWith("/")?"pass":"warning",details:`スコープ: ${a.scope}`})}catch{}return s},C=async()=>{const s=[],t=document.querySelector('link[rel="manifest"]');s.push({id:"manifest-link",name:"マニフェストリンク",description:"HTMLにマニフェストリンクが設定されているか",status:t?"pass":"fail",details:t?`リンク先: ${t.href}`:"マニフェストリンクが見つかりません"});const a=document.querySelectorAll('link[rel*="icon"]');s.push({id:"favicon",name:"ファビコン",description:"ファビコンが設定されているか",status:a.length>0?"pass":"warning",details:`${a.length}個のアイコンリンクが見つかりました`});const n=document.querySelector('meta[name="viewport"]');s.push({id:"viewport",name:"ビューポート設定",description:"モバイル対応のビューポートが設定されているか",status:n?"pass":"warning",details:n?`設定: ${n.content}`:"ビューポート設定が見つかりません"});const i=document.querySelector('meta[name="theme-color"]');return s.push({id:"theme-color",name:"テーマカラー",description:"アプリのテーマカラーが設定されているか",status:i?"pass":"warning",details:i?`カラー: ${i.content}`:"テーマカラーが設定されていません"}),s.push({id:"push-notifications",name:"Push通知対応",description:"Push通知APIがサポートされているか",status:"PushManager"in window?"pass":"warning",details:"PushManager"in window?"Push通知がサポートされています":"Push通知がサポートされていません"}),s.push({id:"background-sync",name:"Background Sync対応",description:"Background Sync APIがサポートされているか",status:"serviceWorker"in navigator&&"sync"in window.ServiceWorkerRegistration.prototype?"pass":"warning",details:"serviceWorker"in navigator&&"sync"in window.ServiceWorkerRegistration.prototype?"Background Syncがサポートされています":"Background Syncがサポートされていません"}),s},W=s=>{switch(s){case"pass":return e.jsx(h,{className:"h-5 w-5 text-green-500"});case"fail":return e.jsx(y,{className:"h-5 w-5 text-red-500"});case"warning":return e.jsx(w,{className:"h-5 w-5 text-yellow-500"});case"pending":return e.jsx(p,{className:"h-5 w-5 text-gray-500 animate-spin"});default:return null}},P=s=>{switch(s){case"pass":return"border-green-200 bg-green-50";case"fail":return"border-red-200 bg-red-50";case"warning":return"border-yellow-200 bg-yellow-50";case"pending":return"border-gray-200 bg-gray-50";default:return"border-gray-200 bg-white"}},u={installation:{name:"インストール",icon:e.jsx(E,{className:"h-4 w-4"})},offline:{name:"オフライン機能",icon:e.jsx(M,{className:"h-4 w-4"})},performance:{name:"パフォーマンス",icon:e.jsx(p,{className:"h-4 w-4"})},security:{name:"セキュリティ",icon:e.jsx(h,{className:"h-4 w-4"})},features:{name:"PWA機能",icon:e.jsx(A,{className:"h-4 w-4"})}},f=()=>c[l]||[],$=()=>{const s=Object.values(c).flat();if(s.length===0)return null;const t=s.filter(i=>i.status==="pass").length,a=s.filter(i=>i.status==="fail").length,n=s.filter(i=>i.status==="warning").length;return{passCount:t,failCount:a,warningCount:n,total:s.length}};m.useEffect(()=>{x()},[]);const r=$();return e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"PWA テスト・チェックリスト"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Progressive Web App (PWA) の実装状況を包括的にテストし、改善点を特定します。"}),e.jsx("div",{className:"flex justify-center gap-4 mb-6",children:e.jsxs(T,{onClick:x,disabled:o,className:"flex items-center gap-2",children:[e.jsx(p,{className:`h-4 w-4 ${o?"animate-spin":""}`}),o?"テスト実行中...":"テストを再実行"]})}),r&&e.jsxs(d,{className:"p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"テスト結果サマリー"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:r.passCount}),e.jsx("div",{className:"text-sm text-gray-600",children:"合格"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:r.warningCount}),e.jsx("div",{className:"text-sm text-gray-600",children:"警告"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:r.failCount}),e.jsx("div",{className:"text-sm text-gray-600",children:"失敗"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:r.total}),e.jsx("div",{className:"text-sm text-gray-600",children:"総数"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:`${r.passCount/r.total*100}%`}})}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["合格率: ",Math.round(r.passCount/r.total*100),"%"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(d,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"テストカテゴリ"}),e.jsx("div",{className:"space-y-2",children:Object.entries(u).map(([s,t])=>e.jsxs("button",{onClick:()=>v(s),className:`w-full text-left p-3 rounded-lg transition-colors flex items-center gap-2 ${l===s?"bg-blue-100 text-blue-700 border border-blue-200":"hover:bg-gray-100 text-gray-700"}`,children:[t.icon,e.jsx("span",{children:t.name}),c[s]&&e.jsx("span",{className:"ml-auto text-sm bg-gray-200 text-gray-600 px-2 py-1 rounded",children:c[s].length})]},s))})]})}),e.jsx("div",{className:"lg:col-span-3",children:e.jsxs(d,{className:"p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:[u[l].icon,u[l].name," テスト結果"]}),e.jsx("div",{className:"space-y-4",children:f().length===0?e.jsx("p",{className:"text-gray-500 text-center py-8",children:o?"テスト実行中...":"テスト結果がありません。テストを実行してください。"}):f().map(s=>e.jsx("div",{className:`p-4 rounded-lg border-2 ${P(s.status)}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[W(s.status),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.description}),s.details&&e.jsx("p",{className:"text-sm text-gray-700 mt-2 bg-white bg-opacity-50 p-2 rounded",children:s.details})]})]})},s.id))})]})})]}),e.jsxs(d,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"テスト項目について"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 text-sm",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2",children:[e.jsx(h,{className:"h-4 w-4 text-green-500"}),"合格 (Pass)"]}),e.jsx("p",{className:"text-gray-600",children:"PWAの要件を満たしており、問題ありません。"})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4 text-yellow-500"}),"警告 (Warning)"]}),e.jsx("p",{className:"text-gray-600",children:"必須ではありませんが、改善を推奨します。"})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2",children:[e.jsx(y,{className:"h-4 w-4 text-red-500"}),"失敗 (Fail)"]}),e.jsx("p",{className:"text-gray-600",children:"PWAの基本要件を満たしていません。修正が必要です。"})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2",children:[e.jsx(p,{className:"h-4 w-4 text-gray-500"}),"実行中 (Pending)"]}),e.jsx("p",{className:"text-gray-600",children:"テストを実行中です。しばらくお待ちください。"})]})]})]})]})};export{_ as default};

import{j as e,B as s,u as a,a as t,b as r}from"./index-Dp3tQatg.js";import{L as l,u as i,b as n,r as c}from"./vendor-Cwmn0chA.js";import{C as d}from"./Card-CPEZwr97.js";import{S as x}from"./SubscriptionButton-1fLZjB7i.js";import{g as o,D as m,a as h}from"./DogCard-ssyGJeF-.js";import{o as j,p as g,l as u,i as p,q as N,X as f,E as b,r as v,B as w,g as y,s as _,t as k,u as S,K as C,C as L,P as D,d as T,H as q,b as $,h as F,f as B,U as P,v as z,w as R,L as U}from"./ui-BHmKMuva.js";import"./supabase-Dzr8oIt2.js";import"./useStripe-03xu2ek0.js";import"./stripe-config-03sBkt-B.js";import"./Input-BBpqNzSy.js";import"./Select-vo9_bICo.js";import"./dogBreeds-6lxY8Uni.js";function E({park:a,onSelect:t}){return e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",onClick:()=>t(a),children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:a.name}),e.jsx("p",{className:"text-sm text-gray-600",children:a.address}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(j,{className:"w-4 h-4 text-yellow-400 fill-current"}),e.jsx("span",{className:"text-sm",children:a.average_rating.toFixed(1)})]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[a.review_count,"件のレビュー"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[I(a.status),e.jsx(s,{size:"sm",variant:"secondary",children:e.jsx(g,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600",children:[e.jsxs("div",{children:["料金: ¥",a.price,"/日"]}),e.jsxs("div",{children:["収容人数: ",a.max_capacity,"人"]}),e.jsxs("div",{children:["現在の利用者: ",a.current_occupancy,"人"]}),e.jsxs("div",{children:["レビュー: ★",a.average_rating.toFixed(1)]})]}),"pending"===a.status&&e.jsxs("div",{className:"mt-3 p-2 bg-yellow-50 rounded text-sm text-yellow-800",children:[e.jsx(u,{className:"w-4 h-4 inline mr-1"}),"管理者による承認をお待ちください"]}),"first_stage_passed"===a.status&&e.jsxs("div",{className:"mt-3 p-2 bg-blue-50 rounded text-sm text-blue-800",children:[e.jsx(p,{className:"w-4 h-4 inline mr-1"}),"第一審査通過！第二審査の詳細情報を入力してください"]}),"second_stage_review"===a.status&&e.jsxs("div",{className:"mt-3 p-2 bg-purple-50 rounded text-sm text-purple-800",children:[e.jsx(N,{className:"w-4 h-4 inline mr-1"}),"第二審査中です。審査結果をお待ちください"]})]})}function I(s){return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${{pending:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",confirmed:"bg-blue-100 text-blue-800",cancelled:"bg-gray-100 text-gray-800",first_stage_passed:"bg-blue-100 text-blue-800",second_stage_review:"bg-purple-100 text-purple-800",qr_testing:"bg-orange-100 text-orange-800"}[s]||"bg-gray-100 text-gray-800"}`,children:{pending:"承認待ち",approved:"承認済み",rejected:"却下",confirmed:"確定",cancelled:"キャンセル",first_stage_passed:"第一審査通過",second_stage_review:"第二審査中",qr_testing:"QR検査中"}[s]||s})}function M({park:a,onClose:t}){return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold",children:[a.name,"の管理"]}),e.jsx("button",{onClick:t,className:"text-gray-500 hover:text-gray-700",children:e.jsx(f,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"基本情報"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"住所:"})," ",a.address]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"ステータス:"})," ",I(a.status)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"料金:"})," ¥",a.price,"/日"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"最大収容人数:"})," ",a.max_capacity,"人"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"現在の利用者数:"})," ",a.current_occupancy,"人"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"評価:"})," ★",a.average_rating.toFixed(1)," (",a.review_count,"件)"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"設備情報"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries({parking:"駐車場",shower:"シャワー設備",restroom:"トイレ",agility:"アジリティ設備",rest_area:"休憩スペース",water_station:"給水設備"}).map((([s,t])=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 rounded "+(a.facilities[s]?"bg-green-500":"bg-gray-300")}),e.jsx("span",{className:"text-sm",children:t})]},s)))})]})]}),"first_stage_passed"===a.status&&e.jsx("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(p,{className:"w-5 h-5 text-blue-600 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"第一審査通過"}),e.jsx("p",{className:"text-sm text-blue-800 mb-3",children:"おめでとうございます！第一審査に通過しました。次は詳細な施設情報と画像のアップロードが必要です。"}),e.jsx(l,{to:`/parks/${a.id}/second-stage`,children:e.jsx(s,{className:"bg-blue-600 hover:bg-blue-700",children:"第二審査を進める"})})]})]})}),"second_stage_review"===a.status&&e.jsx("div",{className:"mb-6 p-4 bg-purple-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(N,{className:"w-5 h-5 text-purple-600 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-purple-900 mb-2",children:"第二審査中"}),e.jsx("p",{className:"text-sm text-purple-800",children:"現在、管理者が施設画像を確認しています。審査には通常3-5営業日かかります。 結果はメールとアプリ内通知でお知らせします。"})]})]})}),"approved"===a.status&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"統計情報"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-2",children:e.jsx("h4",{className:"font-medium text-blue-900",children:"今月の予約"})}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:"32件"}),e.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"前月比 +12%"})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(W,{className:"w-5 h-5 text-green-600"}),e.jsx("h4",{className:"font-medium text-green-900",children:"今月の収益"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:"¥25,600"}),e.jsx("p",{className:"text-xs text-green-700 mt-1",children:"前月比 +8%"})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(H,{className:"w-5 h-5 text-purple-600"}),e.jsx("h4",{className:"font-medium text-purple-900",children:"利用者数"})]}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:"128人"}),e.jsx("p",{className:"text-xs text-purple-700 mt-1",children:"前月比 +15%"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:["approved"===a.status&&e.jsx(l,{to:`/parks/${a.id}`,children:e.jsxs(s,{variant:"secondary",className:"w-full",children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"公開ページを見る"]})}),"approved"===a.status&&e.jsx(l,{to:"/owner-payment-system",children:e.jsxs(s,{variant:"secondary",className:"w-full",children:[e.jsx(v,{className:"w-4 h-4 mr-2"}),"収益レポート"]})}),e.jsx(l,{to:"first_stage_passed"===a.status?`/parks/${a.id}/second-stage`:`/parks/${a.id}/manage`,children:e.jsx(s,{className:"w-full",children:"first_stage_passed"===a.status?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"第二審査を進める"]}):e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"w-4 h-4 mr-2"}),"approved"===a.status?"設定を編集":"詳細を見る"]})})})]})]})})})}function W({className:s}){return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:[e.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),e.jsx("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]})}function H({className:s}){return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:[e.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]})}function J({className:s}){return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}function O({reservation:s}){var a,t,r;const l=s.dog?o(s.dog.gender):"ちゃん";return e.jsx("div",{className:"p-4 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:null==(a=s.dog_park)?void 0:a.name}),e.jsx("p",{className:"text-sm text-gray-600",children:null==(t=s.dog_park)?void 0:t.address}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-sm text-gray-600",children:[e.jsxs("span",{children:["日付: ",new Date(s.date).toLocaleDateString("ja-JP")]}),e.jsxs("span",{children:["時間: ",s.start_time]}),e.jsxs("span",{children:["ワンちゃん: ",null==(r=s.dog)?void 0:r.name,l]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[I(s.status),e.jsxs("span",{className:"text-sm font-medium",children:["¥",s.total_amount.toLocaleString()]})]})]})})}function A({notification:s,onRead:a}){const t=function(s){switch(s){case"friend_request":return e.jsx(k,{className:"w-5 h-5 text-blue-600"});case"friend_accepted":return e.jsx(_,{className:"w-5 h-5 text-green-600"});case"friend_at_park":return e.jsx(_,{className:"w-5 h-5 text-purple-600"});case"reservation_reminder":return e.jsx(y,{className:"w-5 h-5 text-orange-600"});case"blacklisted_dog_nearby":return e.jsx(u,{className:"w-5 h-5 text-red-600"});default:return e.jsx(w,{className:"w-5 h-5 text-gray-600"})}}(s.type),r=function(e){switch(e){case"friend_request":return"bg-blue-50";case"friend_accepted":return"bg-green-50";case"friend_at_park":return"bg-purple-50";case"reservation_reminder":return"bg-orange-50";case"blacklisted_dog_nearby":return"bg-red-50";default:return"bg-gray-50"}}(s.type);return e.jsx("div",{className:`p-3 ${s.read?"":"border-l-4 border-blue-500"} ${r}`,onClick:()=>!s.read&&a&&a(s.id),children:e.jsxs("div",{className:"flex items-start space-x-3",children:[t,e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold",children:s.title}),e.jsx("p",{className:"text-sm text-gray-700",children:s.message}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[new Date(s.created_at).toLocaleDateString("ja-JP")," ",new Date(s.created_at).toLocaleTimeString("ja-JP")]})]}),!s.read&&e.jsx("div",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full",children:"新着"})]})})}function Q({icon:s,count:a,label:t,linkTo:r,linkText:i,iconColor:n}){return e.jsx(l,{to:r,className:"block",children:e.jsxs(d,{className:"text-center p-6 hover:shadow-lg transition-shadow cursor-pointer",children:[e.jsx("div",{className:`w-8 h-8 ${n} mx-auto mb-2`,children:s}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a}),e.jsx("p",{className:"text-sm text-gray-600",children:t}),e.jsxs("div",{className:"mt-3 text-blue-600 text-sm flex items-center justify-center",children:[e.jsx("span",{children:i}),e.jsx(S,{className:"w-4 h-4 ml-1"})]})]})})}function K(){const{user:o,logout:j}=a(),g=i(),u=n(),[N,f]=c.useState(null),[b,v]=c.useState([]),[_,k]=c.useState([]),[S,I]=c.useState([]),[W,H]=c.useState([]),[J,K]=c.useState(!0),{isActive:V}=t(),[X,Y]=c.useState(!1),[Z,ee]=c.useState(null),[se,ae]=c.useState(!1),[te,re]=c.useState(null),[le,ie]=c.useState(!1),[ne,ce]=c.useState(!1),[de,xe]=c.useState(""),[oe,me]=c.useState(""),[he,je]=c.useState({name:"",breed:"",gender:"",birthDate:""}),[ge,ue]=c.useState(null),[pe,Ne]=c.useState(null);c.useEffect((()=>{o&&fe(),u.search.includes("success=true")&&(Y(!0),window.history.replaceState({},document.title,u.pathname),setTimeout((()=>{Y(!1)}),5e3))}),[o,u]);const fe=async()=>{try{const[e,s,a,t,l]=await Promise.all([r.from("profiles").select("*").eq("id",null==o?void 0:o.id).single(),r.from("dogs").select("*, vaccine_certifications(*)").eq("owner_id",null==o?void 0:o.id).order("created_at",{ascending:!1}),r.from("dog_parks").select("*").eq("owner_id",null==o?void 0:o.id).order("created_at",{ascending:!1}),r.from("reservations").select("*, dog_park:dog_parks(*), dog:dogs(*)").eq("user_id",null==o?void 0:o.id).order("created_at",{ascending:!1}).limit(5),r.from("notifications").select("*").eq("user_id",null==o?void 0:o.id).eq("read",!1).order("created_at",{ascending:!1}).limit(5)]);if(e.error)throw e.error;if(s.error)throw s.error;if(a.error)throw a.error;if(t.error)throw t.error;if(l.error)throw l.error;f(e.data),v(s.data||[]),k(a.data||[]),I(t.data||[]),H(l.data||[])}catch(e){}finally{K(!1)}},be=e=>{ee(e),ae(!0)},ve=e=>{re(e);const s=new Date(e.birth_date).toISOString().split("T")[0];je({name:e.name,breed:e.breed,gender:e.gender,birthDate:s}),Ne(e.image_url||null),ie(!0)},we=async e=>{try{const{error:s}=await r.from("notifications").update({read:!0}).eq("id",e);if(s)throw s;H((s=>s.map((s=>s.id===e?{...s,read:!0}:s))))}catch(s){}};return J?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-8",children:[X&&e.jsxs("div",{className:"bg-green-100 border border-green-300 text-green-800 rounded-lg p-4 flex items-start",children:[e.jsx(p,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"サブスクリプションの登録が完了しました！"}),e.jsx("p",{className:"text-sm mt-1",children:"全国のドッグランが使い放題になりました。ペットショップでの10%割引も適用されます。"})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:["こんにちは、",(null==N?void 0:N.name)||"ユーザー","さん"]}),e.jsx("p",{className:"text-gray-600",children:"ドッグパークJPへようこそ"})]}),e.jsx("div",{className:"flex space-x-3",children:e.jsx(l,{to:"/access-control",children:e.jsxs(s,{className:"bg-green-600 hover:bg-green-700",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"入退場"]})})})]}),V?e.jsx(d,{className:"bg-gradient-to-r from-purple-500 to-pink-500 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(L,{className:"w-8 h-8"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"サブスクリプション会員"}),e.jsx("p",{className:"text-sm opacity-90",children:"全国のドッグラン使い放題 + ペットショップ10%OFF"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm opacity-80",children:"月額"}),e.jsx("p",{className:"text-2xl font-bold",children:"¥3,800"}),e.jsx(l,{to:"/subscription",children:e.jsx(s,{size:"sm",className:"mt-2 bg-white text-purple-600 hover:bg-gray-100 hover:text-gray-900",children:"詳細を見る"})})]})]})}):e.jsx(d,{className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(L,{className:"w-8 h-8"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"サブスクリプションでもっとお得に！"}),e.jsx("p",{className:"text-sm opacity-90",children:"月額3,800円で全国のドッグラン使い放題"})]})]}),e.jsx(x,{hasSubscription:V,className:"bg-white text-purple-600 hover:bg-gray-100"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(Q,{icon:e.jsx(D,{className:"w-8 h-8 text-blue-600"}),count:b.length,label:"登録済みワンちゃん",linkTo:"/register-dog",linkText:"管理する",iconColor:"text-blue-600"}),e.jsx(Q,{icon:e.jsx(y,{className:"w-8 h-8 text-green-600"}),count:S.length,label:"今月の予約",linkTo:"/parks",linkText:"予約する",iconColor:"text-green-600"}),e.jsx(Q,{icon:e.jsx(w,{className:"w-8 h-8 text-orange-600"}),count:W.length,label:"未読通知",linkTo:"/community",linkText:"確認する",iconColor:"text-orange-600"}),e.jsx(Q,{icon:e.jsx(T,{className:"w-8 h-8 text-purple-600"}),count:_.length>0?_.length:"登録する",label:_.length>0?"運営中ドッグラン":"ドッグラン登録",linkTo:_.length>0?"/owner-dashboard":"/park-registration-agreement",linkText:_.length>0?"管理する":"登録する",iconColor:"text-purple-600"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[e.jsxs(d,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[e.jsx(D,{className:"w-6 h-6 text-blue-600 mr-2"}),"ワンちゃん管理"]}),e.jsx(l,{to:"/register-dog",children:e.jsxs(s,{size:"sm",children:[e.jsx(G,{className:"w-4 h-4 mr-1"}),"新規登録"]})})]}),0===b.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(D,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"まだワンちゃんが登録されていません"}),e.jsx(l,{to:"/register-dog",children:e.jsx(s,{children:"ワンちゃんを登録する"})})]}):e.jsx("div",{className:"space-y-4",children:b.map((s=>e.jsx(m,{dog:s,onEdit:ve},s.id)))})]}),e.jsxs(d,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[e.jsx(T,{className:"w-6 h-6 text-purple-600 mr-2"}),"ドッグラン管理"]}),e.jsx(l,{to:"/park-registration-agreement",children:e.jsxs(s,{size:"sm",children:[e.jsx(G,{className:"w-4 h-4 mr-1"}),"新規登録"]})})]}),0===_.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(T,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"まだドッグランが登録されていません"}),e.jsx(l,{to:"/park-registration-agreement",children:e.jsx(s,{children:"ドッグランを登録する"})})]}):e.jsxs("div",{className:"space-y-4",children:[_.map((s=>e.jsx(E,{park:s,onSelect:be},s.id))),e.jsx(l,{to:"/owner-dashboard",children:e.jsx(s,{variant:"secondary",className:"w-full",children:"すべてのドッグランを管理"})})]})]}),e.jsxs(d,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[e.jsx(y,{className:"w-6 h-6 text-green-600 mr-2"}),"最近の予約"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(l,{to:"/dogpark-history",children:e.jsxs(s,{size:"sm",variant:"secondary",children:[e.jsx(q,{className:"w-4 h-4 mr-1"}),"利用履歴"]})}),e.jsx(l,{to:"/parks",children:e.jsx(s,{size:"sm",children:"新しい予約"})})]})]}),0===S.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(y,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"まだ予約がありません"}),e.jsx(l,{to:"/parks",children:e.jsx(s,{children:"ドッグランを予約する"})})]}):e.jsxs("div",{className:"space-y-4",children:[S.map((s=>e.jsx(O,{reservation:s},s.id))),e.jsx(l,{to:"/dogpark-history",children:e.jsxs(s,{variant:"secondary",className:"w-full",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"すべての利用履歴を見る"]})})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(d,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"クイックアクション"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(l,{to:"/access-control",children:e.jsxs(s,{className:"w-full bg-green-600 hover:bg-green-700",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"入退場"]})}),e.jsx(l,{to:"/parks",children:e.jsxs(s,{variant:"secondary",className:"w-full",children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"ドッグラン検索"]})}),e.jsx(l,{to:"/shop",children:e.jsxs(s,{variant:"secondary",className:"w-full",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"ペットショップ"]})}),e.jsx(l,{to:"/community",children:e.jsxs(s,{variant:"secondary",className:"w-full",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"コミュニティ"]})}),e.jsx(l,{to:"/dogpark-history",children:e.jsxs(s,{variant:"secondary",className:"w-full",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"利用履歴"]})}),e.jsx(x,{hasSubscription:V,variant:"secondary",className:"w-full"})]})]}),e.jsxs(d,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"最新の通知"}),e.jsx(l,{to:"/community",className:"text-sm text-blue-600 hover:text-blue-700",children:"すべて見る"})]}),0===W.length?e.jsx("p",{className:"text-gray-600 text-sm",children:"新しい通知はありません"}):e.jsx("div",{className:"space-y-3",children:W.map((s=>e.jsx(A,{notification:s,onRead:we},s.id)))})]}),e.jsxs(d,{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"アカウント設定"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(l,{to:"/profile-settings",className:"w-full text-left p-2 hover:bg-gray-50 rounded flex items-center",children:[e.jsx(P,{className:"w-4 h-4 mr-3 text-gray-500"}),e.jsx("span",{className:"text-sm",children:"プロフィール編集"})]}),e.jsxs(l,{to:"/payment-method-settings",className:"w-full text-left p-2 hover:bg-gray-50 rounded flex items-center",children:[e.jsx(z,{className:"w-4 h-4 mr-3 text-gray-500"}),e.jsx("span",{className:"text-sm",children:"支払い方法"})]}),e.jsxs(l,{to:"/orders",className:"w-full text-left p-2 hover:bg-gray-50 rounded flex items-center",children:[e.jsx(R,{className:"w-4 h-4 mr-3 text-gray-500"}),e.jsx("span",{className:"text-sm",children:"注文履歴"})]}),e.jsxs(l,{to:"/profile-settings",className:"w-full text-left p-2 hover:bg-gray-50 rounded flex items-center",children:[e.jsx(C,{className:"w-4 h-4 mr-3 text-gray-500"}),e.jsx("span",{className:"text-sm",children:"パスワード変更"})]}),e.jsxs("button",{onClick:async()=>{try{await j(),g("/")}catch(e){}},className:"w-full text-left p-2 hover:bg-gray-50 rounded flex items-center text-red-600",children:[e.jsx(U,{className:"w-4 h-4 mr-3"}),e.jsx("span",{className:"text-sm",children:"ログアウト"})]})]})]})]})]}),se&&Z&&e.jsx(M,{park:Z,onClose:()=>ae(!1)}),le&&te&&e.jsx(h,{dog:te,isUpdating:ne,error:de,success:oe,dogFormData:he,dogImagePreview:pe,onClose:()=>{ie(!1),ue(null),Ne(null)},onSubmit:async e=>{if(e.preventDefault(),te){ce(!0),xe(""),me("");try{let e;if("オス"===he.gender||"male"===he.gender||"male"===he.gender.toLowerCase())e="オス";else{if("メス"!==he.gender&&"female"!==he.gender&&"female"!==he.gender.toLowerCase())throw new Error("性別は「オス」または「メス」を選択してください");e="メス"}let a=te.image_url;if(ge)try{const e=ge.name.split(".").pop()||"jpg",s=Date.now(),t=`${te.id}/profile_${s}.${e}`,{error:l}=await r.storage.from("dog-images").upload(t,ge,{cacheControl:"3600",upsert:!0});if(l)throw new Error(`画像のアップロードに失敗しました: ${l.message}`);const{data:{publicUrl:i}}=r.storage.from("dog-images").getPublicUrl(t);a=i}catch(s){xe("画像のアップロードに失敗しましたが、ワンちゃんの情報は更新されました。")}const{error:t}=await r.from("dogs").update({name:he.name,breed:he.breed,gender:e,birth_date:he.birthDate,image_url:a}).eq("id",te.id);if(t)throw t;me("ワンちゃん情報を更新しました");const{data:l,error:i}=await r.from("dogs").select("*, vaccine_certifications(*)").eq("owner_id",null==o?void 0:o.id).order("created_at",{ascending:!1});if(i)throw i;v(l||[]),setTimeout((()=>{ie(!1),me(""),ue(null),Ne(null)}),2e3)}catch(a){xe(a.message||"ワンちゃん情報の更新に失敗しました")}finally{ce(!1)}}},onFormChange:je,onImageSelect:e=>{var s;const a=null==(s=e.target.files)?void 0:s[0];if(a){if(a.size>10485760)return void xe("画像ファイルは10MB以下にしてください。");if(!a.type.startsWith("image/"))return void xe("画像ファイルを選択してください。");ue(a);const e=new FileReader;e.onload=e=>{var s;Ne(null==(s=e.target)?void 0:s.result)},e.readAsDataURL(a),xe("")}},onImageRemove:()=>{ue(null),Ne(null)}})]})}function G({className:s}){return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}export{K as UserDashboard};

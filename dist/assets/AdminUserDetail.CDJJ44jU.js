import{j as e,a7 as s,$ as a,C as t,y as r,r as l,u as n,v as c,M as i,f as d,x,z as m,t as o}from"./ui-vendor.5lywbznV.js";import{u as h,a as j,r as g}from"./react-vendor.C7ykWfwV.js";import{u as p,s as u,B as N,C as y}from"./admin-pages.BuCPNRRu.js";import"./supabase-vendor.CX-WoPCS.js";function f(){const{isAdmin:f}=p(),v=h(),{userId:w}=j(),[b,_]=g.useState(null),[k,S]=g.useState(!0),[D,L]=g.useState("");g.useEffect(()=>{f?w&&C(w):v("/")},[f,v,w]);const C=async e=>{var s;try{S(!0),L("");const{data:a,error:t}=await u.from("profiles").select("*").eq("id",e).single();if(t)throw new Error("ユーザー情報の取得に失敗しました");const{data:r,error:l}=await u.from("dogs").select("id, name, breed, age, gender, image_url").eq("owner_id",e),{data:n,error:c}=await u.from("reservations").select("\n          id,\n          date,\n          time_slot,\n          total_amount,\n          status,\n          dog_parks (\n            name\n          )\n        ").eq("user_id",e).order("date",{ascending:!1}).limit(20),i=(n||[]).reduce((e,s)=>e+(s.total_amount||0),0),d=`user_${e.slice(0,8)}@unknown.com`,x={id:a.id,name:a.name||"Unknown",email:d,phone:a.phone_number||"",postal_code:a.postal_code||"",address:a.address||"",user_type:a.user_type||"user",created_at:a.created_at,is_active:!0,dogs:r||[],reservations:(n||[]).map(e=>{var s;return{id:e.id,park_name:(null==(s=e.dog_parks)?void 0:s.name)||"Unknown Park",date:e.date,time_slot:e.time_slot,total_amount:e.total_amount||0,status:e.status}}),subscription_status:"inactive",total_spent:i,last_activity:(null==(s=null==n?void 0:n[0])?void 0:s.date)||""};_(x)}catch(a){L(a instanceof Error?a.message:"ユーザー詳細の取得に失敗しました")}finally{S(!1)}};return k?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):D?e.jsxs("div",{className:"max-w-4xl mx-auto p-4",children:[e.jsx("div",{className:"bg-red-100 border border-red-300 text-red-800 rounded-lg p-4",children:D}),e.jsxs(N,{onClick:()=>v("/admin/users"),className:"mt-4",variant:"secondary",children:[e.jsx(s,{className:"w-4 h-4 mr-2"}),"ユーザー一覧に戻る"]})]}):b?e.jsxs("div",{className:"max-w-4xl mx-auto p-4 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(N,{onClick:()=>v("/admin/users"),variant:"secondary",size:"sm",children:[e.jsx(s,{className:"w-4 h-4 mr-2"}),"ユーザー一覧に戻る"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:["active"===b.subscription_status&&e.jsxs("span",{className:"bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-sm font-medium flex items-center",children:[e.jsx(a,{className:"w-4 h-4 mr-1"}),"サブスク会員"]}),b.is_active?e.jsxs("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded-full text-sm font-medium flex items-center",children:[e.jsx(t,{className:"w-4 h-4 mr-1"}),"アクティブ"]}):e.jsxs("span",{className:"bg-red-100 text-red-800 px-2 py-1 rounded-full text-sm font-medium flex items-center",children:[e.jsx(r,{className:"w-4 h-4 mr-1"}),"非アクティブ"]})]})]}),e.jsxs(y,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(l,{className:"w-8 h-8 text-blue-600 mr-3"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:b.name})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(n,{className:"w-5 h-5 mr-3 text-gray-400"}),e.jsx("span",{children:b.email})]}),b.phone&&e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(c,{className:"w-5 h-5 mr-3 text-gray-400"}),e.jsx("span",{children:b.phone})]}),b.address&&e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(i,{className:"w-5 h-5 mr-3 text-gray-400"}),e.jsxs("span",{children:[b.postal_code," ",b.address]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(d,{className:"w-5 h-5 mr-3 text-gray-400"}),e.jsxs("span",{children:["登録日: ",new Date(b.created_at).toLocaleDateString("ja-JP")]})]}),b.last_activity&&e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(x,{className:"w-5 h-5 mr-3 text-gray-400"}),e.jsxs("span",{children:["最終活動: ",new Date(b.last_activity).toLocaleDateString("ja-JP")]})]}),e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(m,{className:"w-5 h-5 mr-3 text-gray-400"}),e.jsxs("span",{children:["総支払額: ¥",b.total_spent.toLocaleString()]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"登録犬数"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:b.dogs.length})]}),e.jsx(o,{className:"w-8 h-8 text-blue-600"})]})}),e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"予約数"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:b.reservations.length})]}),e.jsx(d,{className:"w-8 h-8 text-green-600"})]})}),e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"総支払額"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:["¥",b.total_spent.toLocaleString()]})]}),e.jsx(m,{className:"w-8 h-8 text-purple-600"})]})})]}),e.jsxs(y,{className:"p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[e.jsx(o,{className:"w-5 h-5 mr-2"}),"登録犬一覧 (",b.dogs.length,"匹)"]}),0===b.dogs.length?e.jsx("p",{className:"text-gray-500",children:"登録された犬はありません"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:b.dogs.map(s=>e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[s.image_url?e.jsx("img",{src:s.image_url,alt:s.name,className:"w-12 h-12 rounded-full object-cover"}):e.jsx("div",{className:"w-12 h-12 bg-gray-300 rounded-full flex items-center justify-center",children:e.jsx(o,{className:"w-6 h-6 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-800",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.breed," • ",s.gender]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.age,"歳"]})]})]})},s.id))})]}),e.jsxs(y,{className:"p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[e.jsx(d,{className:"w-5 h-5 mr-2"}),"予約履歴 (",b.reservations.length,"件)"]}),0===b.reservations.length?e.jsx("p",{className:"text-gray-500",children:"予約履歴はありません"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"ドッグパーク"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"予約日"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"時間"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"金額"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-500",children:"ステータス"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:b.reservations.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:s.park_name}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:new Date(s.date).toLocaleDateString("ja-JP")}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:s.time_slot}),e.jsxs("td",{className:"px-4 py-3 text-sm text-gray-900",children:["¥",s.total_amount.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("confirmed"===s.status?"bg-green-100 text-green-800":"cancelled"===s.status?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:"confirmed"===s.status?"確定":"cancelled"===s.status?"キャンセル":"保留中"})})]},s.id))})]})})]})]}):e.jsx("div",{className:"max-w-4xl mx-auto p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600",children:"ユーザーが見つかりません"}),e.jsxs(N,{onClick:()=>v("/admin/users"),className:"mt-4",variant:"secondary",children:[e.jsx(s,{className:"w-4 h-4 mr-2"}),"ユーザー一覧に戻る"]})]})})}export{f as AdminUserDetail};

import{j as e,B as s,d as a,b as l}from"./index-Dp3tQatg.js";import{u as t,r,L as n}from"./vendor-Cwmn0chA.js";import{I as i}from"./Input-BBpqNzSy.js";import{C as m}from"./Card-CPEZwr97.js";import{l as c,f as d}from"./postalCodeLookup-BVBMVLy5.js";import{M as o,l as x,U as u,b as h,m as p,n as j,a as g}from"./ui-BHmKMuva.js";import"./supabase-Dzr8oIt2.js";function b(){const b=t(),[N,f]=r.useState(!1),[v,y]=r.useState(""),[w,C]=r.useState(!1),[k,S]=r.useState(!1),[T,L]=r.useState(""),[q,$]=r.useState({email:"",userType:"user",name:"",postalCode:"",address:"",phoneNumber:""}),D=async e=>{const s=(e=>{const s=e.replace(/\D/g,"");return s.length<=7?s.length>3?s.slice(0,3)+"-"+s.slice(3):s:q.postalCode})(e);if($({...q,postalCode:s}),7===s.replace(/-/g,"").length){S(!0),L("");try{const e=await c(s);if(e.success&&e.results&&e.results.length>0){const s=d(e.results[0]);$((e=>({...e,address:s})))}else L(e.message||"住所が見つかりませんでした")}catch(a){L("住所の検索中にエラーが発生しました")}finally{S(!1)}}};return w?e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs(m,{className:"text-center p-8",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(o,{className:"w-8 h-8 text-green-600"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"メールを確認してください"}),e.jsxs("p",{className:"text-gray-600 mb-4",children:[q.email,"にログインリンクを送信しました。メールを確認してリンクをクリックしてください。"]}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"メールが届かない場合は、迷惑メールフォルダを確認するか、別のメールアドレスでお試しください。"}),e.jsx(s,{onClick:()=>b("/login"),children:"ログイン画面に戻る"})]})}):e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold text-center mb-8",children:"新規登録"}),e.jsx(m,{children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),f(!0),y(""),!q.name.trim())return y("お名前を入力してください"),void f(!1);if(!q.postalCode.trim())return y("郵便番号を入力してください"),void f(!1);if(!q.address.trim())return y("住所を入力してください"),void f(!1);if(!q.phoneNumber.trim())return y("電話番号を入力してください"),void f(!1);if(!/^\d{3}-\d{4}$/.test(q.postalCode))return y("郵便番号は7桁の数字で入力してください（例：1234567）"),void f(!1);if(!/^0\d{2,3}-\d{1,4}-\d{4}$/.test(q.phoneNumber))return y("電話番号は正しい形式で入力してください（例：09012345678）"),void f(!1);try{a("lastUsedEmail",q.email);const{error:e}=await l.auth.signInWithOtp({email:q.email,options:{emailRedirectTo:`${window.location.origin}/dashboard`,data:{user_type:q.userType,name:q.name,postal_code:q.postalCode,address:q.address,phone_number:q.phoneNumber}}});if(e)throw e;C(!0)}catch(s){y(s.message||"登録に失敗しました")}finally{f(!1)}},className:"p-6",children:[v&&e.jsxs("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded-lg flex items-start",children:[e.jsx(x,{className:"w-5 h-5 mr-2 flex-shrink-0 mt-0.5"}),e.jsx("div",{children:e.jsx("p",{children:v})})]}),e.jsx(i,{label:"お名前 *",value:q.name,onChange:e=>$({...q,name:e.target.value}),required:!0,placeholder:"山田太郎",icon:e.jsx(u,{className:"w-4 h-4 text-gray-500"})}),e.jsxs("div",{className:"mb-4 relative",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["郵便番号 * ",e.jsx("span",{className:"text-xs text-blue-600",children:"(入力すると住所が自動入力されます)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(h,{className:"h-4 w-4 text-gray-500"})}),e.jsx("input",{type:"text",value:q.postalCode,onChange:e=>D(e.target.value),className:`w-full pl-10 pr-10 py-2 border ${T?"border-red-500":"border-gray-300"} rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500`,placeholder:"123-4567（数字のみ入力）",maxLength:8,required:!0}),k&&e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx(p,{className:"h-4 w-4 text-blue-500 animate-spin"})})]}),T&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:T})]}),e.jsx(i,{label:"住所 *",value:q.address,onChange:e=>$({...q,address:e.target.value}),required:!0,placeholder:"東京都渋谷区渋谷1-1-1",icon:e.jsx(h,{className:"w-4 h-4 text-gray-500"})}),e.jsx(i,{label:"電話番号 *",type:"tel",value:q.phoneNumber,onChange:e=>{const s=(e=>{const s=e.replace(/\D/g,"");return s.length<=11?s.length>7?s.slice(0,3)+"-"+s.slice(3,7)+"-"+s.slice(7):s.length>3?s.slice(0,3)+"-"+s.slice(3):s:q.phoneNumber})(e.target.value);$({...q,phoneNumber:s})},required:!0,placeholder:"09012345678（数字のみ入力）",maxLength:13,helperText:"認証に使用します。正確に入力してください。",icon:e.jsx(j,{className:"w-4 h-4 text-gray-500"})}),e.jsx(i,{label:"メールアドレス *",type:"email",value:q.email,onChange:e=>$({...q,email:e.target.value}),required:!0,placeholder:"example@email.com",icon:e.jsx(o,{className:"w-4 h-4 text-gray-500"})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"アカウントタイプ *"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",value:"user",checked:"user"===q.userType,onChange:e=>$({...q,userType:e.target.value}),className:"mr-2"}),"利用者"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",value:"owner",checked:"owner"===q.userType,onChange:e=>$({...q,userType:e.target.value}),className:"mr-2"}),"施設オーナー"]})]})]}),e.jsx("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("span",{className:"font-medium",children:"※ 入力のヒント"}),e.jsx("br",{}),"• 郵便番号：数字のみ入力（例：1234567）",e.jsx("br",{}),"• 電話番号：数字のみ入力（例：09012345678）",e.jsx("br",{}),"ハイフンは自動で挿入されます。"]})}),e.jsx("div",{className:"mb-4 p-3 bg-yellow-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(g,{className:"w-5 h-5 text-yellow-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-yellow-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"Magic Linkについて"}),e.jsx("p",{children:"登録後、入力したメールアドレスにログイン用のリンクが送信されます。リンクをクリックするだけで簡単にログインできます。"})]})]})}),e.jsxs(s,{type:"submit",isLoading:N,className:"w-full",children:[e.jsx(g,{className:"w-4 h-4 mr-2"}),"登録する"]}),e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["すでにアカウントをお持ちの方は",e.jsx(n,{to:"/login",className:"text-blue-600 hover:underline ml-1",children:"こちらからログイン"})]})})]})})]})}export{b as Register};

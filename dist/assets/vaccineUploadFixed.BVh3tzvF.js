var e=Object.defineProperty,r=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,i=(r,t,s)=>t in r?e(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,c=(e,c)=>{for(var o in c||(c={}))t.call(c,o)&&i(e,o,c[o]);if(r)for(var o of r(c))s.call(c,o)&&i(e,o,c[o]);return e},o=(e,r,t)=>new Promise(((s,i)=>{var c=e=>{try{a(t.next(e))}catch(r){i(r)}},o=e=>{try{a(t.throw(e))}catch(r){i(r)}},a=e=>e.done?s(e.value):Promise.resolve(e.value).then(c,o);a((t=t.apply(e,r)).next())}));import{s as a}from"./index.D9xag4tn.js";const n=e=>{if(!e)return{isValid:!1,error:"ファイルが選択されていません"};if(e.size>10485760)return{isValid:!1,error:"ファイルサイズは10MB以下にしてください"};return["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(e.type)?{isValid:!0}:{isValid:!1,error:`サポートされていない画像形式です: ${e.type}`}},l=(e,r,t)=>o(null,null,(function*(){try{const s=e.name.split(".").pop()||"jpg",i=Date.now(),c=`${r}/${t}_${i}.${s}`;if(!(e instanceof File))throw new Error("Invalid file object: expected File, got "+typeof e);const{data:o,error:n}=yield a.storage.from("vaccine-certs").upload(c,e,{cacheControl:"3600",upsert:!0,contentType:e.type});if(n)return{success:!1,error:`アップロードに失敗しました: ${n.message}`};const{data:{publicUrl:l}}=a.storage.from("vaccine-certs").getPublicUrl(c);return{success:!0,filePath:c}}catch(s){return{success:!1,error:s.message}}})),u=(e,r,t,s,i)=>o(null,null,(function*(){try{let o,n;if(r){const t=yield l(r,e,"rabies");if(!t.success)return{success:!1,error:`狂犬病ワクチン証明書: ${t.error}`};o=t.filePath}if(t){const r=yield l(t,e,"combo");if(!r.success)return{success:!1,error:`混合ワクチン証明書: ${r.error}`};n=r.filePath}const{data:u,error:f}=yield a.from("vaccine_certifications").select("id").eq("dog_id",e).maybeSingle();if(f&&"PGRST116"!==f.code)return{success:!1,error:`データベース確認エラー: ${f.message}`};const p={status:"pending"};if(o&&(p.rabies_vaccine_image=o),n&&(p.combo_vaccine_image=n),s&&(p.rabies_expiry_date=s),i&&(p.combo_expiry_date=i),u){const{error:e}=yield a.from("vaccine_certifications").update(p).eq("id",u.id);if(e)return{success:!1,error:`証明書更新エラー: ${e.message}`}}else{const{error:r}=yield a.from("vaccine_certifications").insert([c({dog_id:e},p)]);if(r)return{success:!1,error:`証明書作成エラー: ${r.message}`}}return{success:!0}}catch(o){return{success:!1,error:o.message}}}));export{u as h,n as v};
